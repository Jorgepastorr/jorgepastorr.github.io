



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://jorgepastorr.github.io/apuntes/seguridad/cortafuegos/Iptables/">
      
      
        <meta name="author" content="Jorge Pastor">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>Iptables - Apuntes</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#7e57c2">
      
    
    
      <script src="../../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#iptables" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://jorgepastorr.github.io/apuntes/" title="Apuntes" aria-label="Apuntes" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Apuntes
            </span>
            <span class="md-header-nav__topic">
              
                Iptables
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/jorgepastorr/apuntes/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    jorgepastorr/apuntes
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://jorgepastorr.github.io/apuntes/" title="Apuntes" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Apuntes
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/jorgepastorr/apuntes/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    jorgepastorr/apuntes
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Apuntes Jorgepastorr" class="md-nav__link">
      Apuntes Jorgepastorr
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Administracion
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Administracion
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/Configurar_pantallas_manualmente/" title="Configurar pantallas manualmente" class="md-nav__link">
      Configurar pantallas manualmente
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/Debian_hostname_dinamico/" title="Debian hostname dinamico" class="md-nav__link">
      Debian hostname dinamico
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/Mutt/" title="Que es mutt?" class="md-nav__link">
      Que es mutt?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/Procesos/" title="Procesos" class="md-nav__link">
      Procesos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/Resetear_la_password_root/" title="Resetear la password root." class="md-nav__link">
      Resetear la password root.
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/Vim/" title="Vim atajos básicos" class="md-nav__link">
      Vim atajos básicos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/awk/" title="Uso básico de AWK" class="md-nav__link">
      Uso básico de AWK
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/freeipa/" title="FreeIpa" class="md-nav__link">
      FreeIpa
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/instalar_webmin/" title="instalar webmin" class="md-nav__link">
      instalar webmin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/per/" title="PER" class="md-nav__link">
      PER
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/permisos_avanzados/" title="Permisos avanzados" class="md-nav__link">
      Permisos avanzados
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/samba/" title="Samba" class="md-nav__link">
      Samba
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/server-correo/" title="Servidor Correo" class="md-nav__link">
      Servidor Correo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/server-mensajeria/" title="Server mensajeria instantanea" class="md-nav__link">
      Server mensajeria instantanea
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/ssh/" title="ssh" class="md-nav__link">
      ssh
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/sudo/" title="sudo" class="md-nav__link">
      sudo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/umask/" title="umask" class="md-nav__link">
      umask
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/usuarios/" title="Usuarios" class="md-nav__link">
      Usuarios
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/vnc/" title="vnc" class="md-nav__link">
      vnc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/webdav/" title="webdav" class="md-nav__link">
      webdav
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-21" type="checkbox" id="nav-2-21">
    
    <label class="md-nav__link" for="nav-2-21">
      Ldap
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-21">
        Ldap
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/ldap/Ldap-Samba-Hostpam/" title="Ldap - Samba - Hostpam" class="md-nav__link">
      Ldap - Samba - Hostpam
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/ldap/acl_ejercicios/" title="Acl ejercicios" class="md-nav__link">
      Acl ejercicios
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/ldap/host-kerberos-con-ldap/" title="Instalación host ldap-kerberos" class="md-nav__link">
      Instalación host  ldap-kerberos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/ldap/ldap/" title="ldap" class="md-nav__link">
      ldap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-22" type="checkbox" id="nav-2-22">
    
    <label class="md-nav__link" for="nav-2-22">
      Pxe
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-22">
        Pxe
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/pxe/Servidor-pxe-con-rapberry/" title="Servidor pxe con rapberry" class="md-nav__link">
      Servidor pxe con rapberry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/pxe/guiapxe-fedora/" title="Guiapxe fedora" class="md-nav__link">
      Guiapxe fedora
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-23" type="checkbox" id="nav-2-23">
    
    <label class="md-nav__link" for="nav-2-23">
      Redes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-23">
        Redes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/redes/apuntes-xarxa/" title="APUNTS DE XARXES" class="md-nav__link">
      APUNTS DE XARXES
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/redes/comandos_router_switch/" title="Configuració de Routers" class="md-nav__link">
      Configuració de Routers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/redes/haproxy/" title="Haproxy" class="md-nav__link">
      Haproxy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administracion/redes/redes2/" title="Redes2" class="md-nav__link">
      Redes2
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Auditoria
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Auditoria
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../auditoria/apuntes_hacking/" title="Haking ético" class="md-nav__link">
      Haking ético
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Bases datos
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Bases datos
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      Mongo
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        Mongo
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../bases_datos/mongo/Mongo/" title="Mongo" class="md-nav__link">
      Mongo
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      Postgres
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        Postgres
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../bases_datos/postgres/bases/" title="Postgres" class="md-nav__link">
      Postgres
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../bases_datos/postgres/modificaciones/" title="Modificación tablas" class="md-nav__link">
      Modificación tablas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../bases_datos/postgres/plpgsql/" title="Plpgsql" class="md-nav__link">
      Plpgsql
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../bases_datos/postgres/postgresql-intalacion/" title="Postgresql intalacion" class="md-nav__link">
      Postgresql intalacion
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Cloud
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Cloud
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cloud/aws/" title="aws" class="md-nav__link">
      aws
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Curiosidades
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Curiosidades
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../curiosidades/Eliminar_contrase%C3%B1a_windows/" title="Eliminar contraseña windows" class="md-nav__link">
      Eliminar contraseña windows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../curiosidades/Lanzador_aplicaciones_en_gnome/" title="Lanzador aplicaciones en gnome" class="md-nav__link">
      Lanzador aplicaciones en gnome
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../curiosidades/cambiar_color_promp_terminal/" title="Cambiar color promp terminal" class="md-nav__link">
      Cambiar color promp terminal
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../curiosidades/conky/" title="conky" class="md-nav__link">
      conky
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../curiosidades/openbox/" title="Openbox" class="md-nav__link">
      Openbox
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../curiosidades/qbit/" title="Qbit" class="md-nav__link">
      Qbit
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../curiosidades/tmux/" title="Tmux" class="md-nav__link">
      Tmux
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Desatendidas
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Desatendidas
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../desatendidas/" title="Desatendidas" class="md-nav__link">
      Desatendidas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../desatendidas/Instalacion-desatendida-debian/" title="Instalacion desatendida debian" class="md-nav__link">
      Instalacion desatendida debian
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../desatendidas/desatendida-windows/" title="Desatendida windows" class="md-nav__link">
      Desatendida windows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../desatendidas/kikstart/" title="Kikstart" class="md-nav__link">
      Kikstart
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Generar doc
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Generar doc
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../generar_doc/docsify/" title="Docsify" class="md-nav__link">
      Docsify
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../generar_doc/remark/" title="Remark" class="md-nav__link">
      Remark
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Lenguajes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Lenguajes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lenguajes/Fundamentos_php/" title="Fundamentos php" class="md-nav__link">
      Fundamentos php
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lenguajes/Shell/" title="Shell" class="md-nav__link">
      Shell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-3" type="checkbox" id="nav-9-3">
    
    <label class="md-nav__link" for="nav-9-3">
      Python3
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-9-3">
        Python3
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lenguajes/python3/Apuntes-Metodos/" title="Métodos de colecciones" class="md-nav__link">
      Métodos de colecciones
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lenguajes/python3/apuntes-Funcionalidades_avanzadas/" title="apuntes Funcionalidades avanzadas" class="md-nav__link">
      apuntes Funcionalidades avanzadas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lenguajes/python3/apuntes-Herencia/" title="Herencias" class="md-nav__link">
      Herencias
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lenguajes/python3/apuntes-distribucion/" title="Distribución" class="md-nav__link">
      Distribución
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lenguajes/python3/apuntes-documentacion/" title="Documentación" class="md-nav__link">
      Documentación
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lenguajes/python3/apuntes-ficheros/" title="Apuntes ficheros" class="md-nav__link">
      Apuntes ficheros
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lenguajes/python3/apuntes-fundamento/" title="Python fundamentos" class="md-nav__link">
      Python fundamentos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lenguajes/python3/apuntes-modulos/" title="Módulos" class="md-nav__link">
      Módulos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lenguajes/python3/apuntes-orientado-objetos/" title="Orientado a objetos" class="md-nav__link">
      Orientado a objetos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lenguajes/python3/apuntes-test/" title="Test" class="md-nav__link">
      Test
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lenguajes/python3/apuntes-tkinter/" title="Tkinter" class="md-nav__link">
      Tkinter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lenguajes/python3/apuntes_bases/" title="Apuntes bases" class="md-nav__link">
      Apuntes bases
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lenguajes/python3/argparse/" title="Argparse" class="md-nav__link">
      Argparse
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10" checked>
    
    <label class="md-nav__link" for="nav-10">
      Seguridad
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Seguridad
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Certificados-Digitales/" title="Certificados Digitales" class="md-nav__link">
      Certificados Digitales
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Kerberos/" title="Kerberos" class="md-nav__link">
      Kerberos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../OpenVpn/" title="OpenVpn" class="md-nav__link">
      OpenVpn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../The-crazy-thing/" title="The crazy thing!" class="md-nav__link">
      The crazy thing!
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../TunelSSH/" title="Tunel SSH" class="md-nav__link">
      Tunel SSH
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../gpg/" title="GPG" class="md-nav__link">
      GPG
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lvm/" title="Lvm logical volum manager" class="md-nav__link">
      Lvm logical volum manager
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../practica-ssl-tls/" title="Practica ssl tls" class="md-nav__link">
      Practica ssl tls
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../raid/" title="Raid" class="md-nav__link">
      Raid
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10-10" type="checkbox" id="nav-10-10">
    
    <label class="md-nav__link" for="nav-10-10">
      Backups
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-10-10">
        Backups
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../backups/Borg_basico/" title="Borg básico" class="md-nav__link">
      Borg básico
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../backups/Tar/" title="Tar" class="md-nav__link">
      Tar
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../backups/rdiff-backup/" title="rdiff-backup" class="md-nav__link">
      rdiff-backup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../backups/rsync/" title="rsync" class="md-nav__link">
      rsync
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10-11" type="checkbox" id="nav-10-11" checked>
    
    <label class="md-nav__link" for="nav-10-11">
      Cortafuegos
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-10-11">
        Cortafuegos
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Iptables
      </label>
    
    <a href="./" title="Iptables" class="md-nav__link md-nav__link--active">
      Iptables
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#reglas-y-acciones" class="md-nav__link">
    Reglas y Acciones
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#activar-host-hacer-router" class="md-nav__link">
    Activar host hacer router
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#borrar-reglas-actuales" class="md-nav__link">
    Borrar reglas actuales
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#borrar-una-regla" class="md-nav__link">
    Borrar una regla
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#politica-por-defecto" class="md-nav__link">
    Politica por defecto
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#accept" class="md-nav__link">
    Accept
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drop" class="md-nav__link">
    Drop
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permitir-todo-via-localhost" class="md-nav__link">
    Permitir todo vía localhost
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permitir-todo-en-propia-ip" class="md-nav__link">
    Permitir todo en propia ip
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permitir-una-ipred-a-puerto" class="md-nav__link">
    Permitir una ip/red a puerto
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cerrar-puerto-al-exterior" class="md-nav__link">
    Cerrar puerto al exterior
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#guardar-reglas-actuales" class="md-nav__link">
    Guardar reglas actuales
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#backup" class="md-nav__link">
    Backup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sourceport" class="md-nav__link">
    sourceport
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permitir-trafico-establecido" class="md-nav__link">
    Permitir trafico establecido
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servicios-en-drop" class="md-nav__link">
    Servicios en drop
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forwarding" class="md-nav__link">
    Forwarding
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nat" class="md-nav__link">
    Nat
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forward" class="md-nav__link">
    Forward
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dnat" class="md-nav__link">
    Dnat
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#icmp" class="md-nav__link">
    Icmp
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ejemplo-drop" class="md-nav__link">
    Ejemplo Drop
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ejemplo-dmz" class="md-nav__link">
    Ejemplo DMZ
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Sistemas
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Sistemas
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../sistemas/Actualizar_hora_sys_o_bios/" title="Gestionar Hora" class="md-nav__link">
      Gestionar Hora
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../sistemas/Arranque-del-sistema/" title="Arranque del sistema" class="md-nav__link">
      Arranque del sistema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../sistemas/Estructura_de_directorios/" title="Estructura de directorios" class="md-nav__link">
      Estructura de directorios
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../sistemas/Logs/" title="Logs del sistema" class="md-nav__link">
      Logs del sistema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../sistemas/Systemd/" title="Systemd" class="md-nav__link">
      Systemd
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../sistemas/chroot/" title="Chroot" class="md-nav__link">
      Chroot
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../sistemas/disco/" title="Disco" class="md-nav__link">
      Disco
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../sistemas/gestores_de_paquetes/" title="Gestores de paquetes" class="md-nav__link">
      Gestores de paquetes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../sistemas/getenforce/" title="getenforce" class="md-nav__link">
      getenforce
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../sistemas/grub/" title="Grub" class="md-nav__link">
      Grub
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../sistemas/home/" title="Cambiar /home" class="md-nav__link">
      Cambiar /home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../sistemas/ip_est%C3%A1tica/" title="ip estática raspberry" class="md-nav__link">
      ip estática raspberry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../sistemas/pam/" title="Pam" class="md-nav__link">
      Pam
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../sistemas/raid/" title="Raid" class="md-nav__link">
      Raid
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../sistemas/xinetd/" title="xinetd" class="md-nav__link">
      xinetd
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11-16" type="checkbox" id="nav-11-16">
    
    <label class="md-nav__link" for="nav-11-16">
      Automatizacion
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-11-16">
        Automatizacion
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../sistemas/automatizacion/ansible/" title="Ansible" class="md-nav__link">
      Ansible
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../sistemas/automatizacion/tareas_programadas/" title="Tareas Programadas" class="md-nav__link">
      Tareas Programadas
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      Virtualizacion
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        Virtualizacion
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../virtualizacion/Docker-basico/" title="Docker" class="md-nav__link">
      Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../virtualizacion/Lxc/" title="LXC y LXD" class="md-nav__link">
      LXC y LXD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../virtualizacion/Vagrant/" title="Vagrant" class="md-nav__link">
      Vagrant
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../virtualizacion/kubernetes/" title="Kubernetes" class="md-nav__link">
      Kubernetes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../virtualizacion/swarm/" title="Swarm" class="md-nav__link">
      Swarm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12-6" type="checkbox" id="nav-12-6">
    
    <label class="md-nav__link" for="nav-12-6">
      Virt manager
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-12-6">
        Virt manager
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../virtualizacion/virt-manager/Backing_chain/" title="Backing_chain" class="md-nav__link">
      Backing_chain
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../virtualizacion/virt-manager/Clonar/" title="Clonar de virtual a físico y de físico a virtual." class="md-nav__link">
      Clonar de virtual a físico y de físico a virtual.
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../virtualizacion/virt-manager/Instalacion_de_virtualizacion_fedora/" title="Instalación de virtualización fedora" class="md-nav__link">
      Instalación de virtualización fedora
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../virtualizacion/virt-manager/acceder_consola_desde_virsh/" title="acceder consola desde virsh" class="md-nav__link">
      acceder consola desde virsh
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../virtualizacion/virt-manager/crear_red_aislada/" title="Crear red aislada" class="md-nav__link">
      Crear red aislada
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../virtualizacion/virt-manager/instalar_maquina_virtual_virt-install/" title="virt" class="md-nav__link">
      virt
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#reglas-y-acciones" class="md-nav__link">
    Reglas y Acciones
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#activar-host-hacer-router" class="md-nav__link">
    Activar host hacer router
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#borrar-reglas-actuales" class="md-nav__link">
    Borrar reglas actuales
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#borrar-una-regla" class="md-nav__link">
    Borrar una regla
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#politica-por-defecto" class="md-nav__link">
    Politica por defecto
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#accept" class="md-nav__link">
    Accept
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drop" class="md-nav__link">
    Drop
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permitir-todo-via-localhost" class="md-nav__link">
    Permitir todo vía localhost
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permitir-todo-en-propia-ip" class="md-nav__link">
    Permitir todo en propia ip
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permitir-una-ipred-a-puerto" class="md-nav__link">
    Permitir una ip/red a puerto
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cerrar-puerto-al-exterior" class="md-nav__link">
    Cerrar puerto al exterior
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#guardar-reglas-actuales" class="md-nav__link">
    Guardar reglas actuales
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#backup" class="md-nav__link">
    Backup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sourceport" class="md-nav__link">
    sourceport
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permitir-trafico-establecido" class="md-nav__link">
    Permitir trafico establecido
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servicios-en-drop" class="md-nav__link">
    Servicios en drop
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forwarding" class="md-nav__link">
    Forwarding
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nat" class="md-nav__link">
    Nat
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forward" class="md-nav__link">
    Forward
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dnat" class="md-nav__link">
    Dnat
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#icmp" class="md-nav__link">
    Icmp
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ejemplo-drop" class="md-nav__link">
    Ejemplo Drop
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ejemplo-dmz" class="md-nav__link">
    Ejemplo DMZ
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/jorgepastorr/apuntes/edit/master/docs/seguridad/cortafuegos/Iptables.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="iptables">Iptables</h1>
<h2 id="reglas-y-acciones">Reglas y Acciones</h2>
<p>Las reglas se evalúan una a una secuencial mente en orden descendente, si una orden coincide con otra hace match, se aplica la primera, es decir si hay una regla que abre el puerto 5000 para la ip 1 y mas abajo hay otra regla que cierra el puerto 5000 para la ip 1,  la segunda nunca se aplicara.</p>
<h2 id="activar-host-hacer-router">Activar host hacer router</h2>
<div class="codehilite"><pre><span></span><code><span class="nb">echo</span> <span class="m">1</span> &gt; /proc/sys/net/ipv4/ip_forward
</code></pre></div>

<h2 id="borrar-reglas-actuales">Borrar reglas actuales</h2>
<div class="codehilite"><pre><span></span><code>sudo iptables -F
sudo iptables -X
sudo iptables -Z
sudo iptables -t nat -F
</code></pre></div>

<h3 id="borrar-una-regla">Borrar una regla</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Primer les mostrem amb nº de línia</span>
iptables -t filter -n -L -v --line-numbers
iptables -t nat -n -L -v --line-numbers
iptables -t mangle -n -L -v --line-numbers

<span class="c1"># Esborrar la 4</span>
iptables -D INPUT <span class="m">4</span>
</code></pre></div>

<h2 id="politica-por-defecto">Politica por defecto</h2>
<p>Existen dos políticas por defecto ACCEPT y DROP, generalmente se establece en el inicio de los scripts cual sera su política,  aceptar todo por defecto o denegar todo por defecto.</p>
<h3 id="accept">Accept</h3>
<p>En la política Accept todo esta permitido excepto lo que explícitamente se deniegue, en este caso las reglas de firewall son una lista de lo que está prohibido. Esta política es la mas fácil de configurar pero el firewall nunca será del todo seguro.</p>
<div class="codehilite"><pre><span></span><code>sudo iptables -P INPUT ACCEPT
sudo iptables -P OUTPUT ACCEPT
sudo iptables -P FORWARD ACCEPT
sudo iptables -t nat -P PREROUTING ACCEPT
sudo iptables -t nat -P POSTROUTING ACCEPT
</code></pre></div>

<h3 id="drop">Drop</h3>
<p>Esta es la política mas difícil de configurar pero es mas segura, por que por defecto todo esta denegado y se han de asignar en las reglas del firewall  todo lo que se permita, asegurándote no olvidarte ninguna opción imprescindible.</p>
<div class="codehilite"><pre><span></span><code>sudo iptables -P INPUT DROP
sudo iptables -P OUTPUT DROP
sudo iptables -P FORWARD DROP
sudo iptables -t nat -P PREROUTING DROP
sudo iptables -t nat -P POSTROUTING DROP
</code></pre></div>

<p>Uno de los errores que pueden ocurrir si las reglas no se han asignado bien, es que el sistema se quede bloqueado por haber cerrado demasiados servicios necesarios para el funcionamiento.</p>
<ul>
<li>toda comunicación de red tiene dos sentidos.</li>
<li>hace falta permitir los dos sentidos para considerar accesible un servicio.</li>
<li>el trafico de respuesta se puede identificar con modificadores tipo related, established.</li>
<li>el trafico necesario para el sistema a de estar abierto</li>
<li>dns, sincronización horaria, pings, Ldap, Kerberos, NFS, samba, sgún de que dependa la máquina para su funcionamiento.</li>
</ul>
<h2 id="permitir-todo-via-localhost">Permitir todo vía localhost</h2>
<div class="codehilite"><pre><span></span><code>sudo iptables -A INPUT -i lo -j ACCEPT
sudo iptables -A OUTPUT -o lo -j ACCEPT
</code></pre></div>

<p><code>-i</code> input-interface, <code>-o</code> output-interface</p>
<h2 id="permitir-todo-en-propia-ip">Permitir todo en propia ip</h2>
<div class="codehilite"><pre><span></span><code>sudo iptables -A INPUT -s <span class="m">192</span>.168.88.2 -j ACCEPT
sudo iptables -A OUTPUT -d <span class="m">192</span>.168.88.2 -j ACCEPT
</code></pre></div>

<p><code>-s</code>  source(origen) <code>-d</code> destination</p>
<h2 id="permitir-una-ipred-a-puerto">Permitir una ip/red a puerto</h2>
<div class="codehilite"><pre><span></span><code><span class="c1"># permitir acceder una red a un puerto</span>
sudo iptables -A INPUT -s <span class="m">192</span>.168.88.0/24 -p tcp --dport <span class="m">5432</span> -j ACCEPT
<span class="c1"># permitir una ip a un rango de puertos</span>
sudo iptables -A INPUT -s <span class="m">80</span>.37.45.194 -p tcp --dport <span class="m">20</span>:21 -j ACCEPT
<span class="c1"># permitir una ip a un puerto</span>
sudo iptables -A INPUT -s <span class="m">80</span>.37.45.194 -p tcp --dport <span class="m">80</span> -j ACCEPT
</code></pre></div>

<h2 id="cerrar-puerto-al-exterior">Cerrar puerto al exterior</h2>
<div class="codehilite"><pre><span></span><code>sudo iptables -A INPUT -p tcp --dport <span class="m">20</span>:21 -j DROP
sudo iptables -A INPUT -p tcp --dport <span class="m">5432</span> -j DROP
sudo iptables -A INPUT -p tcp --dport <span class="m">80</span> -j DROP
</code></pre></div>

<h2 id="guardar-reglas-actuales">Guardar reglas actuales</h2>
<div class="codehilite"><pre><span></span><code>sudo iptables-save &gt; /etc/sysconfig/iptables
</code></pre></div>

<h3 id="backup">Backup</h3>
<div class="codehilite"><pre><span></span><code>sudo iptables-save &gt; arxiu.regles.iptables <span class="c1"># exportar</span>
sudo iptables-restore &lt; arxiu.regles.iptables <span class="c1"># inportar</span>
</code></pre></div>

<h2 id="sourceport">sourceport</h2>
<p>En este ejemplo quiero que el host pueda navegar por internet, pero este mismo host tiene un servidor web y  quiero que desde el exterior puedan acceder, por lo tanto añado la regla de aceptar entrada por source port (esto solo es estrictamente necesario en la política drop). </p>
<div class="codehilite"><pre><span></span><code>sudo iptables -A INPUT -p tcp -m tcp --sport <span class="m">80</span> -m state <span class="se">\</span>
                    --state RELATED,ESTABLISHED -j ACCEPT
sudo iptables -A OUTPUT -p tcp -m tcp --dport <span class="m">80</span> -j ACCEPT

sudo iptables -A INPUT -p tcp -m tcp --sport <span class="m">443</span> -m state <span class="se">\</span>
                    --state RELATED,ESTABLISHED -j ACCEPT
sudo iptables -A OUTPUT -p tcp -m tcp --dport <span class="m">443</span> -j ACCEPT

sudo iptables -A INPUT -p tcp --dport <span class="m">80</span> -j DROP
sudo iptables -A INPUT -p tcp --dport <span class="m">443</span> -j DROP
</code></pre></div>

<p><strong>ESTABLECIDO</strong> significa que el paquete está asociado con una conexión que  ha visto paquetes en ambos direcciones</p>
<p><strong>NUEVO</strong> que significa que el  paquete ha comenzado una nueva conexión, o asociado con una conexión que no ha visto paquetes en ambas direcciones,</p>
<p><strong>RELACIONADO</strong> que significa  que el paquete está iniciando una nueva conexión, pero está asociado con una conexión existente, como una transferencia de datos FTP o un ICMP</p>
<hr />
<p>En este caso el ejemplo es de un host/firewall con política DROP que almacena un servidor web pero no tiene acceso de salida a internet, es decir el servidor web no puede hacer nuevas peticiones por http/s, pero si le permitimos que mande respuestas a las peticiones que le llegan.</p>
<div class="codehilite"><pre><span></span><code>iptables -A INTPUT -p tcp -m tcp --dport <span class="m">80</span> -j ACCEPT
iptables -A OUTPUT -p tcp -m tcp --sport <span class="m">80</span> -m state <span class="se">\</span>
                        --state RELATED,ESTABLISHED -j ACCEPT

iptables -A INTPUT  -p tcp -m tcp --dport <span class="m">443</span> -j ACCEPT
iptables -A OUTPUT -p tcp -m tcp --sport <span class="m">443</span> -m state <span class="se">\</span>
                            --state RELATED,ESTABLISHED -j ACCEPT

iptables -A OUTPUT -p tcp --dport <span class="m">443</span> -j DROP
iptables -A OUTPUT -p tcp --dport <span class="m">80</span> -j DROP
</code></pre></div>

<h2 id="permitir-trafico-establecido">Permitir trafico establecido</h2>
<div class="codehilite"><pre><span></span><code>iptables -t filter -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -t filter -A OUPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
</code></pre></div>

<h2 id="servicios-en-drop">Servicios en drop</h2>
<div class="codehilite"><pre><span></span><code><span class="c1"># Permetre consultes DNS (primari i secundari)</span>
/sbin/iptables -A INPUT  -s <span class="m">80</span>.58.61.250 -p udp --sport <span class="m">53</span> -j ACCEPT
/sbin/iptables -A OUTPUT -d <span class="m">80</span>.58.61.250 -p udp --dport <span class="m">53</span> -j ACCEPT

/sbin/iptables -A INPUT  -s <span class="m">80</span>.58.61.254 -p udp --sport <span class="m">53</span> -j ACCEPT
/sbin/iptables -A OUTPUT -d <span class="m">80</span>.58.61.254 -p udp --dport <span class="m">53</span> -j ACCEPT

<span class="c1"># Actuar de servidor web el host/firewall</span>
/sbin/iptables -A INPUT -p tcp -m tcp --dport <span class="m">80</span> -j ACCEPT
/sbin/iptables -A OUTPUT -p tcp -m tcp --sport <span class="m">80</span> -m state <span class="se">\</span>
                        --state RELATED,ESTABLISHED -j ACCEPT

<span class="c1"># Permetre al host/firewall navegar per internet</span>
/sbin/iptables -A INPUT -p tcp -m tcp --sport <span class="m">80</span> -m state <span class="se">\</span>
                        --state RELATED,ESTABLISHED -j ACCEPT
/sbin/iptables -A OUTPUT -p tcp -m tcp --dport <span class="m">80</span> -j ACCEPT

/sbin/iptables -A INPUT  -p tcp -m tcp --sport <span class="m">443</span> -m state <span class="se">\</span>
                        --state RELATED,ESTABLISHED -j ACCEPT
/sbin/iptables -A OUTPUT -p tcp -m tcp --dport <span class="m">443</span> -j ACCEPT

<span class="c1"># Consultar al servidor de temps per permetre la sincronització horària</span>
/sbin/iptables -A INPUT  -p udp -m udp --dport <span class="m">123</span> -j ACCEPT
/sbin/iptables -A OUTPUT -p udp -m udp --sport <span class="m">123</span> -j ACCEPT

<span class="c1"># Permetre el tràfic SMTP d’entrada i sortida</span>
iptables -A INPUT  -s <span class="m">0</span>.0.0.0/0 -p tcp --dport <span class="m">25</span> -j ACCEPT
iptables -A OUTPUT -s <span class="m">0</span>.0.0.0/0 -p tcp --dport <span class="m">25</span> -j ACCEPT

<span class="c1"># Servei FTP actiu i passiu</span>
/sbin/iptables -A INPUT -p tcp -m tcp --sport <span class="m">20</span>:21 -m state <span class="se">\</span>
                            --state RELATED,ESTABLISHED -j ACCEPT
/sbin/iptables -A OUTPUT -p tcp -m tcp --dport <span class="m">20</span>:21 -j ACCEPT

<span class="c1"># puertos no sistema</span>
/sbin/iptables -A INPUT -p tcp -m tcp --sport <span class="m">1024</span>:65535 --dport <span class="m">1024</span>:65535 -m state <span class="se">\</span>
                            --state ESTABLISHED -j ACCEPT
/sbin/iptables -A OUTPUT -p tcp -m tcp --dport <span class="m">1024</span>:65535 -m state <span class="se">\</span>
                            --state NEW,RELATED,ESTABLISHED -j ACCEPT
</code></pre></div>

<p>En ocasiones la política drop hace demasiado bien su trabajo y al abrir nuevos servicios, fallan por que les esta cortando el firewall y se pone en política accept temporalmente mientras se soluciona el script por prisas o etc..  por esto mismo es una buena practica al final del script  poner la barrera drop y así no exponer datos sensibles que podamos tener..</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Barrera final DROP per si es canvia a ACCEPT temporalment</span>
<span class="c1"># tancar tràfic no desitjat</span>
/sbin/iptables -A INPUT -p tcp -m tcp --dport <span class="m">1</span>:1024 -j DROP
/sbin/iptables -A INPUT -p udp -m udp --dport <span class="m">1</span>:1024 -j DROP
/sbin/iptables -A INPUT -p tcp -m tcp --dport <span class="m">1723</span> -j DROP
/sbin/iptables -A INPUT -p tcp -m tcp --dport <span class="m">3306</span> -j DROP
/sbin/iptables -A INPUT -p tcp -m tcp --dport <span class="m">5432</span> -j DROP
</code></pre></div>

<h2 id="forwarding">Forwarding</h2>
<div class="codehilite"><pre><span></span><code>$ <span class="nb">echo</span> <span class="m">1</span> &gt; /proc/sys/net/ipv4/ip_forward
<span class="c1"># o be:</span>
sysctl net.ipv4.ip_forward<span class="o">=</span><span class="m">1</span>

sysctl -a <span class="p">|</span> grep ip_forward
net.ipv4.ip_forward <span class="o">=</span> <span class="m">1</span>
</code></pre></div>

<p>En un firewall por defecto la red externa suele tener todos los puertos cerrados y la interna abiertos, <code>eth0</code> interficie externa, <code>eth1</code> interficie interna.</p>
<div class="codehilite"><pre><span></span><code>iptables -A INPUT -s <span class="m">0</span>.0.0.0  -i eth0 -j DROP
iptables -A INPUT -s <span class="m">172</span>.16.10.0/24 -i eth1 -j ACCEPT
</code></pre></div>

<h3 id="nat">Nat</h3>
<p><strong>Network Addres Translation</strong> se le aplica cuando en un router o host/firewall con dos o mas interficies, recibe peticiones por un red y las devuelve por otra con una ip diferente, en este proceso se a aplicado un <code>forward</code> a recibido un paquete por una red, a mirado de quien era y se lo a enviado estando en una red diferente el destinatario.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># NAT usant la IP pública de eth0</span>
iptables -t nat -A POSTROUTING -s <span class="m">172</span>.16.10.0/24 -o eth0 -j MASQUERADE
</code></pre></div>

<h3 id="forward">Forward</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># no deixar sortir de la lan a exterior a serveis concrets</span>
iptables -A FORWARD -s <span class="m">172</span>.16.100.0/24 -p tcp --dport <span class="m">7</span> -j REJECT
iptables -A FORWARD -s <span class="m">172</span>.16.100.11 -p tcp --dport <span class="m">13</span> -j REJECT

<span class="c1"># no deixar sortir de la lan a exterior segons destí</span>
iptables -A FORWARD -s <span class="m">172</span>.16.100.0/24 -d <span class="m">192</span>.168.1.34 -p tcp --dport <span class="m">23</span> -j REJECT
iptables -A FORWARD -i em1 -d <span class="m">192</span>.168.1.0/24 -p tcp --dport <span class="m">82</span> -j REJECT

<span class="c1"># un host de la lan concret no pot accedir a un servei extern (segons destí)</span>
iptables -A FORWARD -s <span class="m">172</span>.16.100.11 -d <span class="m">192</span>.168.1.34 -p tcp --dport <span class="m">110</span> -j REJECT
iptables -A FORWARD -s <span class="m">172</span>.16.100.11 -d <span class="m">192</span>.168.1.0/24 -p tcp --dport <span class="m">143</span> -j REJECT

<span class="c1"># evitar que des de dins de la LAN es falsifiqui ip origen (spoofing)</span>
iptables -A FORWARD ! -s <span class="m">172</span>.16.100.0/24 -i em1 -j REJECT
</code></pre></div>

<h3 id="dnat">Dnat</h3>
<p><strong>Destination network address translation</strong> es muy similar a NAT pero en DNAT se redirige el puerto a otro diferente, igual que NAT también se puede redirigir el destino. Es decir en NAT redirigimos de <code>ip a ip</code> y en DNAT de <code>ip:puerto a ip:puerto</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># dirigir tot el tràfic http port 80 a un altre host de la LAN</span>
iptables -t nat -A PREROUTING -i eth0 -p tcp --dport <span class="m">80</span> -j DNAT --to <span class="m">192</span>.168.10.12:80
iptables -t nat -A PREROUTING -i eth0 -p tcp --dport <span class="m">443</span> -j DNAT --to <span class="m">192</span>.168.10.12:443

<span class="c1"># si el tràfic hhtp prové de de casa meva (221.15.15.15) enviar-lo a un altre web server</span>
<span class="c1"># (aquesta regla ha d’anar abans de les anteriors)</span>
iptables -t nat -A PREROUTING -s <span class="m">221</span>.15.15.15 -i eth0 -p tcp --dport <span class="m">80</span> -j DNAT <span class="se">\</span>
                            --to <span class="m">192</span>.168.10.10:80
iptables -t nat -A PREROUTING -s <span class="m">221</span>.15.15.15 -i eth0 -p tcp --dport <span class="m">443</span> -j DNAT <span class="se">\</span>
                            --to <span class="m">192</span>.168.10.10:443

<span class="c1"># obrir puerto 2022 e la interfaz enp3s0 y redirigir a 192.168.10.10:22</span>
iptables -t nat -A PREROUTING -i eth0 -p tcp --dport <span class="m">2022</span> -j DNAT --to <span class="m">192</span>.168.10.10:22

<span class="c1"># port forwarding según la red de origen</span>
iptables -t nat -A PREROUTING -s <span class="m">172</span>.17.0.0/24 -i eth0 -p tcp --dport <span class="m">2022</span> -j DNAT --to <span class="m">192</span>.168.10.10:22
</code></pre></div>

<h2 id="icmp">Icmp</h2>
<div class="codehilite"><pre><span></span><code>iptables -A FORWARD -p icmp --icmp-type <span class="m">8</span> -j DROP

<span class="c1"># habilitar ping</span>
iptables -A INPUT -p icmp --icmp-type echo-reply -j ACCEPT
iptables -A OUTPUT -p icmp --icmp-type echo-request -j ACCEPT

<span class="c1"># no aceptar ping</span>
iptables -A INPUT -p ICMP -j DROP
<span class="c1"># o</span>
iptables -A INPUT -p icmp --icmp-type <span class="m">8</span> -j DROP
iptables -A OUTPUT -p icmp --icmp-type <span class="m">8</span> -j DROP
</code></pre></div>

<p>echo-reply (pong)</p>
<p>echo-request (ping)</p>
<p>=&gt; <strong>Zero</strong> (0) is for echo-reply</p>
<p>=&gt; <strong>Eight</strong> (8) is for echo-request.</p>
<h2 id="ejemplo-drop">Ejemplo Drop</h2>
<div class="codehilite"><pre><span></span><code><span class="c1"># Regles Flush: buidar les regles actuals</span>
iptables -F
iptables -X
iptables -Z
iptables -t nat -F

<span class="c1"># Establir la politica per defecte (ACCEPT o DROP)</span>
iptables -P INPUT DROP
iptables -P OUTPUT DROP
iptables -P FORWARD DROP

<span class="c1"># Permetre totes les pròpies connexions via localhost</span>
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT

<span class="c1"># Permetre tot el trafic de la pròpia ip(192.168.1.49))</span>
iptables -A INPUT -s <span class="m">192</span>.168.1.35 -j ACCEPT
iptables -A OUTPUT -d <span class="m">192</span>.168.1.35 -j ACCEPT
<span class="c1">#exit 0</span>
<span class="c1"># -----------------------------------------------------------</span>

<span class="c1"># consulta dns primari</span>
iptables -A INPUT -s <span class="m">80</span>.58.61.250 -p udp -m udp --sport <span class="m">53</span> -j ACCEPT
iptables -A OUTPUT -d <span class="m">80</span>.58.61.250 -p udp -m udp --dport <span class="m">53</span> -j ACCEPT

<span class="c1"># consulta dns secundari</span>
iptables -A INPUT -s <span class="m">80</span>.58.61.254 -p udp -m udp --sport <span class="m">53</span> -j ACCEPT
iptables -A OUTPUT -d <span class="m">80</span>.58.61.254 -p udp -m udp --dport <span class="m">53</span> -j ACCEPT

<span class="c1"># consulta ntp</span>
iptables -A INPUT -p udp -m udp --dport <span class="m">123</span> -j ACCEPT
iptables -A OUTPUT -p udp -m udp --sport <span class="m">123</span> -j ACCEPT

<span class="c1"># ----------------------------------------------------------</span>
<span class="c1"># servei cups</span>
iptables -A INPUT -p tcp --dport <span class="m">631</span> -j ACCEPT
iptables -A OUTPUT -p tcp --sport <span class="m">631</span> -j ACCEPT

<span class="c1"># port xinetd</span>
iptables -A INPUT -p tcp --dport <span class="m">3411</span> -j ACCEPT
iptables -A OUTPUT -p tcp --sport <span class="m">3411</span> -j ACCEPT

<span class="c1"># port x11-x-forwarding</span>
iptables -A INPUT -p tcp --dport <span class="m">6010</span> -j ACCEPT
iptables -A OUTPUT -p tcp --sport <span class="m">6010</span> -j ACCEPT

<span class="c1"># servei rpc</span>
iptables -A INPUT -p tcp --dport <span class="m">111</span> -j ACCEPT
iptables -A OUTPUT -p tcp --sport <span class="m">111</span> -j ACCEPT

<span class="c1"># -----------------------------------------------------------</span>

<span class="c1"># icmp</span>
iptables -A INPUT -p icmp --icmp-type echo-reply -j ACCEPT
iptables -A OUTPUT -p icmp --icmp-type echo-request -j ACCEPT

<span class="c1"># -----------------------------------------------------------</span>

<span class="c1"># servei ssh</span>
iptables -A INPUT -p tcp --dport <span class="m">22</span> -j ACCEPT
iptables -A OUTPUT -p tcp --sport <span class="m">22</span> -j ACCEPT

<span class="c1"># servei http</span>
iptables -A INPUT -p tcp --dport <span class="m">80</span> -j ACCEPT
iptables -A OUTPUT -p tcp --sport <span class="m">80</span> -j ACCEPT

<span class="c1"># servei daytime</span>
iptables -A INPUT -p tcp --dport <span class="m">13</span> -j ACCEPT
iptables -A OUTPUT -p tcp --sport <span class="m">13</span> -j ACCEPT

<span class="c1"># servei echo</span>
iptables -A INPUT -p tcp --dport <span class="m">7</span> -j ACCEPT
iptables -A OUTPUT -p tcp --sport <span class="m">7</span> -j ACCEPT

<span class="c1"># servei smtp</span>
iptables -A INPUT -p tcp --dport <span class="m">25</span> -j ACCEPT
iptables -A OUTPUT -p tcp --sport <span class="m">25</span> -j ACCEPT
<span class="c1"># exit 0</span>

<span class="c1"># ==============================================================</span>
<span class="c1"># atencio: cal millorar aquestes regles!!!          *****</span>
<span class="c1"># cal que nomes es permeti trafic relacionat        *****</span>
<span class="c1"># ==============================================================</span>

<span class="c1"># navegar web</span>
<span class="c1">#iptables -A INPUT -p tcp --sport 80 -j ACCEPT</span>
iptables -A OUTPUT -p tcp --dport <span class="m">80</span> -j ACCEPT
iptables -A INPUT -p tcp --sport <span class="m">443</span> -j ACCEPT
iptables -A OUTPUT -p tcp --dport <span class="m">443</span> -j ACCEPT

<span class="c1"># accedir a servei echo</span>
<span class="c1">#iptables -A INPUT -p tcp --sport 7 -j ACCEPT</span>
iptables -A OUTPUT -p tcp --dport <span class="m">7</span> -j ACCEPT

<span class="c1"># accedir al servei daytime</span>
<span class="c1">#iptables -A INPUT -p tcp --sport 13 -j ACCEPT</span>
iptables -A OUTPUT -p tcp --dport <span class="m">13</span> -j ACCEPT

<span class="c1"># accedir al servei ssh</span>
<span class="c1">#iptables -A INPUT -p tcp --sport 22 -j ACCEPT</span>
iptables -A OUTPUT -p tcp --dport <span class="m">22</span> -j ACCEPT

iptables -A INPUT -m state --state ESTABLISHED,RELATED
iptables -A OUTPUT -m state --state ESTABLISHED,RELATED

<span class="c1"># -----------------------------------------------------------------</span>
<span class="c1"># ftp i tftp (trafic udp)               *****</span>
<span class="c1"># -----------------------------------------------------------------</span>

<span class="c1"># oferir servei tftp</span>
iptables -A INPUT -p udp --dport <span class="m">69</span> -j ACCEPT
iptables -A OUTPUT -p udp --sport <span class="m">69</span> -j ACCEPT

<span class="c1"># accedir a serveis tftp externs</span>
iptables -A INPUT -p udp --sport <span class="m">69</span> -j ACCEPT
iptables -A OUTPUT -p udp --dport <span class="m">69</span> -j ACCEPT

<span class="c1"># pendent obrir ports dinamics</span>
<span class="c1"># oferir servei ftp</span>
iptables -A INPUT -p tcp --dport <span class="m">20</span>:21 -j ACCEPT
iptables -A OUTPUT -p tcp --sport <span class="m">20</span>:21 -j ACCEPT

<span class="c1"># accdir a serveis ftp externs</span>
iptables -A INPUT -p tcp --sport <span class="m">20</span>:21 -j ACCEPT
iptables -A OUTPUT -p tcp --dport <span class="m">20</span>:21 -j ACCEPT

<span class="c1"># pendent obrir ports dinamics!</span>
<span class="c1"># --------------------------------------------------------------</span>
<span class="c1"># Barrera per tancar els serveis/ports en cas de passar a drop</span>
<span class="c1"># ...</span>
</code></pre></div>

<h2 id="ejemplo-dmz">Ejemplo DMZ</h2>
<div class="codehilite"><pre><span></span><code><span class="c1"># Activar si el host ha de fer de router</span>
<span class="nb">echo</span> <span class="m">1</span> &gt; /proc/sys/net/ipv4/ip_forward

<span class="c1"># Regles Flush: buidar les regles actuals</span>
iptables -F
iptables -X
iptables -Z
iptables -t nat -F

<span class="c1"># Establir la politica per defecte (ACCEPT o DROP)</span>
iptables -P INPUT ACCEPT
iptables -P OUTPUT ACCEPT
iptables -P FORWARD ACCEPT
iptables -t nat -P PREROUTING ACCEPT
iptables -t nat -P POSTROUTING ACCEPT

<span class="c1"># Permetre totes les pròpies connexions via localhost</span>
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT

<span class="c1"># Permetre tot el trafic de la propia ip exterior (wlan0:192.168.1.41))</span>
iptables -A INPUT -s <span class="m">192</span>.168.1.41 -j ACCEPT
iptables -A OUTPUT -d <span class="m">192</span>.168.1.41 -j ACCEPT

<span class="c1"># Permetre tot el trafic de la propia ip interior (em1:172.16.100.1))</span>
iptables -A INPUT -s <span class="m">172</span>.16.100.1 -j ACCEPT
iptables -A OUTPUT -d <span class="m">172</span>.16.100.1 -j ACCEPT

<span class="c1"># Permetre tot el trafic de la propia ip interior (em1:172.32.1.1))</span>
iptables -A INPUT -s <span class="m">172</span>.32.1.1 -j ACCEPT
iptables -A OUTPUT -d <span class="m">172</span>.32.1.1 -j ACCEPT
<span class="c1">#exit 0</span>

<span class="c1"># Ahora hacemos enmascaramiento de la red local (HACIA FUERA)</span>
iptables -t nat -A POSTROUTING -s <span class="m">172</span>.16.100.0/24 -o wlan0 -j MASQUERADE
iptables -t nat -A POSTROUTING -s <span class="m">172</span>.32.1.0/24 -o wlan0 -j MASQUERADE
<span class="c1">#exit 0</span>

<span class="c1"># ==========================================================</span>
<span class="c1"># Regles de: xarxa_local-(R/F)-xarxa_externa</span>
<span class="c1">#</span>
<span class="c1"># LOCAL_LAN ---(em1)Router/Firewall(wlan0)-- PUBLIC_LAN</span>
<span class="c1">#               |</span>
<span class="c1">#               DMZ (em1)</span>
<span class="c1"># ========================================================</span>

<span class="c1"># de la lan no accedir al router/fireall, excepte ssh, telnet i daytime</span>
iptables -A INPUT -s <span class="m">172</span>.16.100.0/24 -p tcp --dport <span class="m">22</span> -j ACCEPT
iptables -A INPUT -s <span class="m">172</span>.16.100.0/24 -p tcp --dport <span class="m">23</span> -j ACCEPT
iptables -A INPUT -s <span class="m">172</span>.16.100.0/24 -p tcp --dport <span class="m">13</span> -j ACCEPT
iptables -A INPUT -s <span class="m">172</span>.16.100.0/24 -j DROP
<span class="c1">#exit 0</span>

<span class="c1"># de la lan NO es pot navegar,telnet,ssh a fora</span>
iptables -A FORWARD -s <span class="m">172</span>.16.100.0/24 -p tcp --dport <span class="m">80</span> -j DROP
iptables -A FORWARD -s <span class="m">172</span>.16.100.0/24 -p tcp --dport <span class="m">23</span> -j DROP
iptables -A FORWARD -s <span class="m">172</span>.16.100.0/24 -p tcp --dport <span class="m">22</span> -j DROP

<span class="c1"># de la lan acces al servidor web de la dmz: intranet</span>
iptables -A INPUT -s <span class="m">172</span>.16.100.0/24 -p tcp --dport <span class="m">80</span> -j ACCEPT
iptables -A INPUT -s <span class="m">172</span>.16.100.0/24 -p tcp --dport <span class="m">443</span> -j ACCEPT

<span class="c1"># de exterior acces ports 3081:3085 redirigits a servers dins dmz</span>
iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport <span class="m">3081</span> -j DNAT <span class="se">\</span>
                                        --to <span class="m">172</span>.32.1.11:81
iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport <span class="m">3082</span> -j DNAT <span class="se">\</span>
                                        --to <span class="m">172</span>.32.1.11:82
iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport <span class="m">3083</span> -j DNAT <span class="se">\</span>
                                        --to <span class="m">172</span>.32.1.11:83
iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport <span class="m">3084</span> -j DNAT <span class="se">\</span>
                                        --to <span class="m">172</span>.32.1.11:84
iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport <span class="m">3085</span> -j DNAT <span class="se">\</span>
                                        --to <span class="m">172</span>.32.1.11:85

<span class="c1"># des de exteriors ports 3022:3025 redirigits a ssh host de la lan</span>
iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport <span class="m">3022</span> -j DNAT <span class="se">\</span>
                                        --to <span class="m">172</span>.16.100.11:22
iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport <span class="m">3023</span> -j DNAT <span class="se">\</span>
                                        --to <span class="m">172</span>.16.100.12:22
iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport <span class="m">3024</span> -j DNAT <span class="se">\</span>
                                        --to <span class="m">172</span>.16.100.13:22
</code></pre></div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../backups/rsync/" title="rsync" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                rsync
              </span>
            </div>
          </a>
        
        
          <a href="../../../sistemas/Actualizar_hora_sys_o_bios/" title="Gestionar Hora" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Gestionar Hora
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:"../../.."}})</script>
      
    
  </body>
</html>